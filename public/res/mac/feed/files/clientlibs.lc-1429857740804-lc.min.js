var origAttr=jQuery.fn.attr;
jQuery.fn.attr=function(a,b){if(arguments.length!=2||typeof a!="string"||b!==origAttr.call(this,a)){return origAttr.apply(this,arguments)
}else{return this
}};
$(function(){$(".team-table").on("click",".close",function(d){$(this).closest("tr").remove()
});
$(".team-member-add").click(function(g){g.preventDefault();
var f=$(this).closest(".team");
var d=$(".team-member-userId input",f);
if(d.val().length>0){var h=$(".team-member-role-add select",f).val();
a(f,d.val(),$(".team-member-message",f).val(),h);
$(".team-member-form :input",f).val("");
b(f)
}});
$(".team-member-userId").parent().on("keyup keydown change click",function(f){var d=$(this).closest(".team");
b(d)
}).on("keydown change click",function(f){if(f.type!="keydown"||f.which==13){var g=$("input",this),d=g.val();
if(d.indexOf("&lt;")!==-1){d=$("<div>").html(d).text();
g.val(d)
}}}).find("input").val("");
function b(e){var d=$(".team-member-add",e);
if(d.length>0){d.attr("disabled",$(".team-member-userId input",e).val().length==0)
}}function c(){var e=$(".team-member-userId input"),d=e.val();
if(d.indexOf("&lt;")!==-1){d=$("<div>").html(d).text();
e.val(d)
}}function a(g,h,m,f){var d=$.trim(h).toLowerCase();
var e=$(".team-member-userId li",g).filter(function(){return $.trim($(this).text()).toLowerCase()===d
});
if(e.length==0){if(window.console){console.log("Warning: No used matching "+h+" was found in options, user not added to list")
}}else{var i=jQuery.extend({message:m,roleId:f,allowEdit:true},e.data());
if(!i.avatar){i.avatar="/etc/designs/default/images/collab/avatar.png.prof.thumbnail.0.32.png"
}addTeamMember(g,i);
var k=$(".team-member-role-add select");
var j=$(".team-member-userId").find("li.focus").attr("data-user-id");
var l=$(".team").find("input[value="+j+"]").closest("tr").find(".team-member-role");
$(k).find("option").each(function(n){l.find("select").append('<option value="'+$(this).val()+'">'+$(this).text()+"</option>")
});
l.select();
updateEditRoles()
}}});
var teamRoles={};
function addTeamRoles(a){teamRoles=a
}function addTeamMember(d,c){c.name=c.name||c.userId;
c.role=teamRoles[c.roleId]||c.roleId;
var a=$(".team-table",d);
a.find("input[name='teamMemberUserId']").filter(function(){return $(this).val()===c.userId
}).closest("tr").remove();
$.each(c,function(e,f){if("string"===typeof f){c[e]=$("<div/>").text(f).html()
}});
var b=Handlebars.compile($("#team-member-template").html());
a.append(b(c))
}function updateEditRoles(){$(".team-member-role").each(function(c){var b=$(this).closest(".role").find(".teamMemberRoleId").val();
if(b){var a=$(this).closest(".role").find(".team-member-role").find("[value="+b+"]").text();
$(this).closest(".role").find(".team-member-role").find("button").text(a)
}});
$(".team-member-role").off();
$(".team-member-role").on("change selected",function(c){var a=$(c.target).find(":selected").val();
var b=$(this).closest(".role").find(".teamMemberRoleId");
if(b){b.val(a)
}})
};