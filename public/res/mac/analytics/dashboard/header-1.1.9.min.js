/*!
 * ************************************************************************
 *
 *  ADOBE CONFIDENTIAL
 *  ___________________
 *
 *   (c) Copyright 2014 Adobe Systems Incorporated
 *   All Rights Reserved.
 *
 *  NOTICE:  All information contained herein is, and remains
 *  the property of Adobe Systems Incorporated and its suppliers,
 *  if any.  The intellectual and technical concepts contained
 *  herein are proprietary to Adobe Systems Incorporated and its
 *  suppliers and may be covered by U.S. and Foreign Patents,
 *  patents in process, and are protected by trade secret or copyright law.
 *  Dissemination of this information or reproduction of this material
 *  is strictly forbidden unless prior written permission is obtained
 *  from Adobe Systems Incorporated.
 * ************************************************************************
 */

"use strict";!function(){window.adobe=window.adobe||{},adobe.CloudHeader=function(a){function b(){O("help-button","click",c),O("user-selector-button","click",c);var a=N("notifications-badge");a&&O(a,"click",c);var b=N("beta-feedback-button");b&&O(b,"click",B);var d=N("link-wizard-button");d&&O(d,"click",D),O("user-selector-dropdown","click",i),O(document,"click",g),M()||O(window,"resize",h)}function c(a){L(a);var b=S(a);!b.hasAttribute("data-toggle")&&b.parentNode.hasAttribute("data-toggle")&&(b=b.parentNode);var c=b.getAttribute("data-toggle");if("none"==N(c).style.display){V&&f(),V=N(c),X.hasImsSession&&"notifications-dropdown"==c&&!T&&k({apiName:"notifications",success:q});var e=b.offsetLeft;e+=b.offsetWidth/2,d({left:e,top:58})}else f()}function d(a){"help-dropdown"==V.getAttribute("id")&&(N("clear-search").style.display="none",N("cloud-header-search").value=""),V.style.display="block";var b=a.left;b-=P(V,"arrow-pos-right")?V.offsetWidth-15:V.offsetWidth/2,V.style.left=b+"px",V.style.top=a.top+"px","help-dropdown"==V.getAttribute("id")&&N("cloud-header-search").focus()}function e(){N("user_loading_background").style.display="block",N("user_loading_spinner").style.display="block"}function f(){V&&(V.style.display="none",V=null)}function g(){f()}function h(){f()}function i(a){var b=S(a);"cloud-header-account-btn"!=b.getAttribute("id")&&"cloud-header-logout-btn"!=b.getAttribute("id")&&L(a)}function j(){var a=N("cloud-header-search");O(a,"keyup",function(b){if(b||(b=window.event),13==b.keyCode){var c="jp_JP"==X.lang?"ja_JP":X.lang,d=encodeURIComponent(N("cloud-header-search").value);window.open(X.helpModuleBase+"/t2/help/"+c+"/home/index.html?q="+d+"&r="+X.searchProduct,"_helpWindow"),f()}N("clear-search").style.display=""===a.value?"none":"block"}),O(a,"click",i),O("clear-search","click",function(a){L(a),N("cloud-header-search").value="",N("clear-search").style.display="none",N("cloud-header-search").focus()})}function k(a){I({url:X.server+Y[a.apiName]+"?callback=?",timeout:X.timeout,data:a.data?a.data:r(a.apiName),success:function(b){a.success&&a.success.apply(this,[b])},error:function(b,c){a.error?a.error.apply(c):l(a)}})}function l(a){J({tenantId:X.tenantId,success:function(){a.error=function(){window.console&&console.log("unable to call "+a.apiName+" after re-logging into the marketing cloud.")},k(a)}})}function m(a,b){if(a){U=a.notificationCount,a.homeLink&&""!==a.homeLink&&N("marketing-cloud-link").setAttribute("href",a.homeLink),a.helpText&&""!==a.helpText&&(N("help-button").innerHTML=a.helpText);var c="one-char";c=0===U?"one-char empty":10>U?"one-char":100>U?"two-char":"three-char";var d=N("notifications-badge");d&&(d.innerHTML='<span class="'+c+'">'+U+"</span>"),b&&window.sessionStorage&&window.JSON&&sessionStorage.setItem("lastHeaderData",JSON.stringify(a))}}function n(a){if(a){N("user-displayname").innerHTML=a.info.displayName,""!==a.info.title&&(N("user-title").innerHTML=a.info.title),a.info.avatar&&""!==a.info.avatar&&(N("user-avatar").setAttribute("src",a.info.avatar),N("user-avatar").style.display="inline"),X.logoutCallback&&O("cloud-header-logout-btn","click",function(){X.logoutCallback.call()});var b=0;for(b=0;b<a.actions.length;b++){var c=a.actions[b];"settings"==c.id?(N("cloud-header-account-btn").innerHTML=c.text,N("cloud-header-account-btn").setAttribute("href",c.url)):"logout"==c.id&&(N("cloud-header-logout-btn").innerHTML=c.text,X.logoutCallback||N("cloud-header-logout-btn").setAttribute("href",c.url))}if(a.organizations.length>0)for(W={},N("company-selector-list").innerHTML="",b=0;b<a.organizations.length;b++){var d=a.organizations[b];W[d.orgId]=d;var e=o(d);N("company-selector-list").appendChild(e)}a.organizations.length>5&&(N("company-selector-list").style["overflow-y"]="scroll"),X.hasImsSession&&N("notifications-badge")&&k({apiName:"notifications",success:q})}}function o(a){var b=document.createElement("li"),c=null;(X.activeOrgId&&X.activeOrgId==a.orgId||!X.activeOrgId&&a.active)&&(c="current"),a.tenantId&&b.setAttribute("id",a.tenantId),a.orgId?O(b,"click",function(){e(),k({apiName:"setActiveOrg",success:function(){p(a)},data:{orgId:a.orgId}})}):c="inactive";var d="<a "+(c?' class="'+c+'"':"")+'><div class="user-companies-content">';return a.avatar&&(d+='<img id="company_logo" width="25px" height="25px" src="'+a.avatar+'" />'),d+=a.name+"</div></a>",b.innerHTML=d,b}function p(a){J({tenantId:a.tenantId,success:function(){var b=X.server.replace(X.tenantId,a.tenantId);window.location.href=b}})}function q(a){if(a){T=!0;var b,c=N("notifications-list"),e=N("notifications-badge");if(N("notifications-list").innerHTML="",a.newNotifications.length>0){R(e,"empty");for(var f=0;f<a.newNotifications.length;f++)b=document.createElement("div"),b.className="notification-box",b.innerHTML=a.newNotifications[f].html,c.appendChild(b);if("none"!=N("notifications-dropdown").style.display){var g=e.offsetLeft;g+=e.offsetWidth/2,d({left:g,top:58})}}else Q(e,"empty"),b=document.createElement("div"),b.className="notification-box",b.innerHTML="You have no new notifications.",c.appendChild(b);if(a.viewAll){var h=N("view-all-notifications");h.innerHTML=a.viewAll.text,h.setAttribute("href",a.viewAll.url)}}}function r(a){return"/help"==a?{lang:X.lang,product:X.searchProduct}:{lang:X.lang}}function s(){if(X.preConfiguredData&&(m(X.preConfiguredData),X.preConfiguredData.notifications&&N("notifications-badge")&&q(X.preConfiguredData.notifications),X.preConfiguredData.user&&n(X.preConfiguredData.user)),X.hasImsSession){var a={apiName:"header",success:function(a){m(a),k({apiName:"user",success:n})}};X.activeOrgId?k({apiName:"tenant",data:{orgId:X.activeOrgId},success:function(b){b&&b.tenantUrl&&(X.baseURL=X.server,X.server=b.tenantUrl),b&&b.tenantId&&(X.tenantId=b.tenantId),k(a)},error:function(){window.console&&console.log("Unable to get the tenant id falling back to the tartan base url"),k(a)}}):k(a)}}function t(){var a=N("cloud-header");if(!a){a=document.createElement("div"),a.setAttribute("id","cloud-header");var b=X.parentid?N(X.parentid):document.body;b.appendChild(a)}Q(a,"cloud-header"),X.activeCapability?Q(a,"include-capability"):Q(a,"exclude-capability"),"Microsoft Internet Explorer"==navigator.appName&&Q(a,"ie"),M()&&Q(a,"lte8");var c='<div class="crumbs">'+u()+(X.activeSolution?v():"")+w()+x()+"</div>";c+=C(),c+='<div class="drawer">'+A()+E()+(X.notificationsEnabled?G():"")+y()+"</div>",c+='<div id="wizard-button-container"></div>',c+=z()+(X.notificationsEnabled?H():"")+F(),a.innerHTML=c}function u(){return'<a id="marketing-cloud-link"><div class="logo"></div><span class="marketing-cloud-label">Adobe Marketing Cloud</span></a>'}function v(){if(X.activeSolution){var a=X.activeSolution,b='<i class="chevron"></i>';return a.split(" ").length>1&&(a="A"+X.activeSolution.match(/\b(\w)/g).join("").toUpperCase()),X.solutionHome?(b+='<a class="solutions-crumb" href="'+X.solutionHome+'">'+X.activeSolution+"</a>",b+='<a class="solutions-crumb-acronym" href="'+X.solutionHome+'">'+a+"</a>"):(b+='<label class="solutions-crumb" >'+X.activeSolution+"</label>",b+='<label class="solutions-crumb-acronym" >'+a+"</label>"),b}return""}function w(){return X.activeCapability?'<i class="chevron"></i><label class="capabilities-crumb">'+X.activeCapability+"</label>":""}function x(){return X.betaVersion?'<label class="beta-feedback-version">'+X.betaVersion+"</label>":""}function y(){return'<span id="user-selector-button" data-toggle="user-selector-dropdown" class="userIcon" ></span>'}function z(){return'<div id="user-selector-dropdown" class="header-popover arrow-top arrow-pos-right" style="display: none;"><div class="inner-border"><div class="user-information"><img id="user-avatar" width="34px" height="34px" style="display:none;"/><div id="user-displayname" class="user-name"></div><div id="user-title" class="user-title"></div></div><div><ul id="company-selector-list"></ul></div><div class="user-information-buttons"><div><a id="cloud-header-account-btn" class="button default">Account Settings</a></div><div><a id="cloud-header-logout-btn" class="button">Sign Out</a></div><div id="user_loading_background" style="display:none;"></div><div id="user_loading_spinner" style="display:none;"><span class="spinner" ></span></div></div></div></div>'}function A(){return X.betaFeedbackCallback?'<a id="beta-feedback-button" class="button">'+X.betaFeedbackLabel+"</a>":""}function B(){X.betaFeedbackCallback.call()}function C(){return X.imsLinkingToken?'<a id="link-wizard-button" class="button">'+X.linkWizardLabel+"</a>":""}function D(){X.linkWizardCallback.call()}function E(){return'<label id="help-button" data-toggle="help-dropdown">Help</label>'}function F(){var a="header-popover arrow-top",b="jp_JP"==X.lang?"ja_JP":X.lang;return X.notificationsEnabled||(a+=" arrow-pos-right"),'<div id="help-dropdown" class="'+a+'" style="display: none;"><div class="suite-search-container"><input id="cloud-header-search" autocomplete="off" placeholder="'+X.searchPlaceholderLabel+'" data-search-enhanced="true" type="text" ><a id="clear-search" class="clear-search" style="display:none;" ></a></div><ul><li><a href="'+X.helpModuleBase+"/t2/help/"+b+"/home/index.html?r="+X.searchProduct+'&f=release" target="_blank" >'+X.whatsNewLabel+'</a></li><li><a href="'+X.helpModuleBase+"/t2/help/"+b+"/home/index.html?r="+X.searchProduct+'&f=home" target="_blank" >'+X.helpHomeLabel+'</a></li><li><a href="'+X.customerCareLink+'" target="_blank" >'+X.customerCareLabel+"</a></li></ul></div>"}function G(){return'<div id="notifications-badge" data-toggle="notifications-dropdown" ><span class="empty one-char">0<span></div>'}function H(){return'<div id="notifications-dropdown" class="header-popover arrow-top arrow-pos-right" style="display: none;"><div class="header"><h3>'+X.notificationsTitleLabel+'</h3></div><ul id="notifications-list"><div class="notification-box">You have no new notifications</div></ul><div class="footer"><a id="view-all-notifications" href="#">'+X.viewAllNotificationsLabel+"</a></div></div>"}function I(a){function b(){window.clearTimeout(h);try{delete window.x}catch(a){window.x=void 0}g.removeChild(f)}var c="jsonp_"+(new Date).getTime();window[c]=function(c){a.success&&a.success(c),b()};var d=a.url.replace("=?","="+c),e=a.data?K(a.data):null;e&&(d+=-1==d.indexOf("?")?"?"+e:"&"+e);var f=document.createElement("script");f.async=!0,f.src=d,f.onerror=function(){b(),a.error&&a.error(null,"error"),a.complete&&a.complete()};var g=document.getElementsByTagName("head")[0];g.appendChild(f);var h;a.timeout&&(h=window.setTimeout(function(){b(),a.error&&a.error(null,"timeout"),a.complete&&a.complete()},a.timeout))}function J(a){var b=X.baseURL?X.baseURL:X.server;a.tenantId&&(b=b.replace(/(:\/\/)([^.]+)(.marketing)/i,"$1"+a.tenantId+"$3"));var c=b+"/libs/granite/core/content/login.autologin.html",d=document.createElement("iframe");d.setAttribute("src",c),d.style.display="none",O(window,"message",function(b){if(b=b||window.event,0===c.indexOf(b.origin+"/")){document.body.removeChild(d);var e=JSON?JSON.parse(b.data):{success:!0};e.redirect&&(X.server=e.redirect.replace(/^(.*\/\/[^\/?#]*).*$/,"$1")),e.success?a.success&&a.success():a.error&&a.error(),a.complete&&a.complete()}}),document.body.appendChild(d)}function K(a,b){var c=[];for(var d in a)if(a.hasOwnProperty(d)){var e=b?b+"["+d+"]":d,f=a[d];c.push("object"==typeof f?K(f,e):encodeURIComponent(e)+"="+encodeURIComponent(f))}return c.join("&")}function L(a){return a||(a=window.event),a.cancelBubble=!0,a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),!1}function M(){if("Microsoft Internet Explorer"==navigator.appName){var a=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(null!=b.exec(a))return parseFloat(RegExp.$1)<=8}return!1}function N(a){return document.getElementById(a)}function O(a,b,c){"string"==typeof a&&(a=N(a)),a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function P(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function Q(a,b){P(a,b)||(a.className+=" "+b)}function R(a,b){if(P(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}}function S(a){return a=a||window.event,a.target?a.target:a.srcElement}var T=!1,U=0,V=null,W=null,X={timeout:5e3,server:"https://marketing-dev.corp.adobe.com",lang:"en_US",hasImsSession:!0,activeSolution:null,solutionHome:null,activeCapability:null,betaFeedbackCallback:null,linkWizardCallback:null,betaVersion:null,logoutCallback:null,searchProduct:"analytics",notificationsEnabled:!0,activeOrgId:null,betaFeedbackLabel:"Beta Feedback",linkWizardLabel:"Link Accounts",whatsNewLabel:"What's New",helpHomeLabel:"Help Home",customerCareLabel:"Customer Care",searchPlaceholderLabel:"Search",notificationsTitleLabel:"Notifications",viewAllNotificationsLabel:"View All",helpModuleBase:"https://microsite.omniture.com",customerCareLink:"https://helpx.adobe.com/marketing-cloud/contact-support.html"},Y={header:"/content/mac/default/header.jsonp",notifications:"/content/mac/default/header/notifications.jsonp",user:"/content/mac/default/header/user.jsonp",setActiveOrg:"/content/mac/default/header.setActiveOrg.jsonp",tenant:"/content/mac/default/services/tenant.jsonp"};if(a)for(var Z in a)a.hasOwnProperty(Z)&&(X[Z]=a[Z]);t(),b(),s(),j()}}();