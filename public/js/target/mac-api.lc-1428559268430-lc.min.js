tartan=window.tartan||{};
tartan.api=(function(){return{shareCard:function(c){if(!c||(!c.url&&!c.cardDataPath)){if(window.console){window.console.error("tartan.shareCard() needs 'options.url'")
}return false
}var o=function(){document.body.removeChild(s);
document.body.removeChild(u);
window[A](w,h,false);
if((typeof c.onclose)=="function"){c.onclose()
}};
var h=function(C){var i=JSON.parse(C.data);
if(i.action=="login"){q&&q(C,i);
return
}if(i.show){s.style.visibility="visible"
}if(i.loaded){s.contentWindow.postMessage(JSON.stringify(c),"*")
}if(i.share){if(window.console){window.console.log("card shared")
}}if(i.close){o()
}};
var u=document.createElement("div");
u.id="share_frame_shadow_box";
var v=/^(https?:\/\/[^\/?#]+)(.*\/mac\/mac-api.js)(\?.*)?$/i;
var j=/^(?:http|https):\/\/[^\/]+(\/[^\/]+)\/(?:etc|libs|apps)\/.*\.js(\?.*)?$/;
var a="";
var b=document.getElementsByTagName("script");
var p="";
for(var x=0;
x<b.length;
x++){var g=b[x].getAttribute("src");
if(g){var l=g.match(v);
if(l){var n=j.exec(g);
if(n){a=n[1]
}p=l[1]+a;
break
}}}var s=document.createElement("iframe");
var z=document.createElement("style");
z.type="text/css";
z.innerHTML="#share_frame_shadow_box {position:fixed;left:0;top:0;z-index:999;width:100%;height:100%;opacity:0.7;background-color:#000000}#share_frame {outline:12px solid rgba(0,0,0,0.7);overflow:hidden;position:fixed;left:50%;top:50%;background-color:white;z-index:1001;width:860px;height:440px;margin-left:-430px;margin-top:-220px;visibility:hidden;}@media all and (max-width: 875px) {#share_frame {width:660px;margin-left:-330px;}}";
s.id="share_frame";
s.src="about:blank";
s.frameBorder=0;
s.scrolling="no";
s.hspace=0;
s.vspace=0;
s.marginheight=0;
s.marginwidth=0;
var y=window.addEventListener?"addEventListener":"attachEvent";
var A=window.removeEventListener?"removeEventListener":"removeEvent";
var w=y=="attachEvent"?"onmessage":"message";
window[y](w,h,false);
document.head.appendChild(z);
document.body.appendChild(u);
document.body.appendChild(s);
var d=function(i){s.src=i+"/target/default/tools/shareframe.html"
};
var f=function(){alert("Sharing is not possible at this time. Please try again later.");
o()
};
if(!p||p.charAt(0)=="/"){d(p);
return true
}var m=c.imsOrgId;
if(m){var e="tartanServer-"+m;
var t=window.sessionStorage&&sessionStorage.getItem(e);
if(t){k(t,false)
}else{B({url:p+"/target/default/services/tenant.jsonp?callback=?&orgId="+m,timeout:5000,success:function(C){var i=C.tenantUrl;
if(i){window.sessionStorage&&sessionStorage.setItem(e,i);
k(i,false)
}else{window.console&&console.error("Error while resolving tenant for organization: "+m,C);
f()
}},error:f})
}}else{var t=window.sessionStorage&&sessionStorage.getItem("lastTartanServer");
if(!t){window.console&&console.log("lastTartanServer is not set.");
t=p
}k(t,true)
}function k(C,i){r({server:C,success:function(E,F){if(E.redirect){if(i){var F=E.redirect;
var D=F.indexOf("/",8);
if(D!=-1){F=F.substr(0,D)
}k(F,true)
}else{window.console&&console.error("User cannot login on server: ",C);
f()
}}else{window.sessionStorage&&sessionStorage.setItem("lastTartanServer",C);
d(F)
}},error:f})
}var q;
function r(C){var i=C.server+"/libs/granite/core/content/login.autologin.html";
var D=document.createElement("iframe");
D.style.display="none";
D.src=i;
document.body.appendChild(D);
q=function(F,E){if(i.indexOf(F.origin+"/")===0){q=null;
D.parentNode.removeChild(D);
if(E.success){C.success&&C.success(E,C.server)
}else{C.error&&C.error(null,E.error)
}C.complete&&C.complete()
}}
}function B(D){var G="jsonp_"+new Date().getTime();
window[G]=function(H){D.success&&D.success(H);
E()
};
var C=D.url.replace("=?","="+G);
var i=document.createElement("script");
i.async=true;
i.src=C;
i.onerror=function(){E();
D.error&&D.error(null,"error");
D.complete&&D.complete()
};
document.head.appendChild(i);
var F;
if(D.timeout){F=window.setTimeout(function(){E();
D.error&&D.error(null,"timeout");
D.complete&&D.complete()
},D.timeout)
}function E(){window.clearTimeout(F);
delete window[G];
i.parentNode&&i.parentNode.removeChild(i)
}}return true
},shareOembedResource:function(){var d=this;
var b=location.protocol==="https:";
var c=document.querySelector("link[rel^='alternat'][type='application/json+oembed']");
if(c==undefined){alert("Web page does not support oEmbed");
return
}var a=c.href;
var e=this.createCORSRequest("GET",a,true,function(k){var i=false;
try{i=("response" in k&&k.responseType=="json")
}catch(f){}var j=i?k.response:JSON.parse(k.responseText);
if(j==null){alert("Server response not in JSON format.");
return
}var l=(b&&j.thumbnail_url)?j.thumbnail_url.replace(/http:/gi,"https:"):j.thumbnail_url;
var h=j.type;
var g=(b&&j.html)?j.html.replace(/http:/gi,"https:"):j.html;
d.shareCard({url:window.location.href,title:j.title,product:j.provider_name,type:"oembed",data:{thumbnailUrl:l,type:h,html:g},auth:{type:"bearer",token:"sally_token"}})
},function(f){alert("Error loading oEmbed document at "+a)
});
e?e.send():alert("Browser does not support CORS Requests")
},createCORSRequest:function(f,a,b,e,c){var d=new XMLHttpRequest();
if("withCredentials" in d){d.open(f,a,b);
d.onreadystatechange=function(){if(d.readyState==4){if(d.status==200){if(e){e(d)
}}else{if(c){c(d)
}}}}
}else{if(typeof XDomainRequest!="undefined"){d=new XDomainRequest();
d.open(f,a,b);
d.onerror=c;
d.ontimeout=c;
d.onload=e
}else{d=null
}}return d
},ssoKeepalive:function(b,f,g,e){if(typeof b=="undefined"||typeof f=="undefined"){throw new Error("Client and/or host for SSO keepalive not supplied.")
}var d="ssoKeepalive_"+new Date().getTime();
window[d]=function(h){};
g=typeof g!=="undefined"?g:d;
e=typeof e!=="undefined"?e:"AdobeID,openid";
var a=document.getElementsByTagName("body")[0];
var c=document.createElement("script");
c.type="text/javascript";
c.src="https://"+f+"/ims/check/v1/token?callback="+g+"&client_id="+b+"&scope="+e+"&_="+new Date().getTime();
a.appendChild(c)
}}
}());
tartan.shareCard=tartan.api.shareCard;
tartan.createCORSRequest=tartan.api.createCORSRequest;
tartan.ssoKeepalive=tartan.api.ssoKeepalive;