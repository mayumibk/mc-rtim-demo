(function(){var w=this;
var k=w._;
var G={};
var E=Array.prototype,f=Object.prototype,r=Function.prototype;
var K=E.push,o=E.slice,A=E.concat,d=f.toString,j=f.hasOwnProperty;
var O=E.forEach,q=E.map,H=E.reduce,c=E.reduceRight,b=E.filter,D=E.every,p=E.some,n=E.indexOf,l=E.lastIndexOf,u=Array.isArray,e=Object.keys,I=r.bind;
var P=function(Q){if(Q instanceof P){return Q
}if(!(this instanceof P)){return new P(Q)
}this._wrapped=Q
};
if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=P
}exports._=P
}else{w._=P
}P.VERSION="1.5.2";
var L=P.each=P.forEach=function(V,S,R){if(V==null){return
}if(O&&V.forEach===O){V.forEach(S,R)
}else{if(V.length===+V.length){for(var Q=0,U=V.length;
Q<U;
Q++){if(S.call(R,V[Q],Q,V)===G){return
}}}else{var T=P.keys(V);
for(var Q=0,U=T.length;
Q<U;
Q++){if(S.call(R,V[T[Q]],T[Q],V)===G){return
}}}}};
P.map=P.collect=function(T,S,R){var Q=[];
if(T==null){return Q
}if(q&&T.map===q){return T.map(S,R)
}L(T,function(W,U,V){Q.push(S.call(R,W,U,V))
});
return Q
};
var g="Reduce of empty array with no initial value";
P.reduce=P.foldl=P.inject=function(U,T,Q,S){var R=arguments.length>2;
if(U==null){U=[]
}if(H&&U.reduce===H){if(S){T=P.bind(T,S)
}return R?U.reduce(T,Q):U.reduce(T)
}L(U,function(X,V,W){if(!R){Q=X;
R=true
}else{Q=T.call(S,Q,X,V,W)
}});
if(!R){throw new TypeError(g)
}return Q
};
P.reduceRight=P.foldr=function(W,T,Q,S){var R=arguments.length>2;
if(W==null){W=[]
}if(c&&W.reduceRight===c){if(S){T=P.bind(T,S)
}return R?W.reduceRight(T,Q):W.reduceRight(T)
}var V=W.length;
if(V!==+V){var U=P.keys(W);
V=U.length
}L(W,function(Z,X,Y){X=U?U[--V]:--V;
if(!R){Q=W[X];
R=true
}else{Q=T.call(S,Q,W[X],X,Y)
}});
if(!R){throw new TypeError(g)
}return Q
};
P.find=P.detect=function(T,S,R){var Q;
C(T,function(W,U,V){if(S.call(R,W,U,V)){Q=W;
return true
}});
return Q
};
P.filter=P.select=function(T,S,R){var Q=[];
if(T==null){return Q
}if(b&&T.filter===b){return T.filter(S,R)
}L(T,function(W,U,V){if(S.call(R,W,U,V)){Q.push(W)
}});
return Q
};
P.reject=function(S,R,Q){return P.filter(S,function(V,T,U){return !R.call(Q,V,T,U)
},Q)
};
P.every=P.all=function(T,S,R){S||(S=P.identity);
var Q=true;
if(T==null){return Q
}if(D&&T.every===D){return T.every(S,R)
}L(T,function(W,U,V){if(!(Q=Q&&S.call(R,W,U,V))){return G
}});
return !!Q
};
var C=P.some=P.any=function(T,S,R){S||(S=P.identity);
var Q=false;
if(T==null){return Q
}if(p&&T.some===p){return T.some(S,R)
}L(T,function(W,U,V){if(Q||(Q=S.call(R,W,U,V))){return G
}});
return !!Q
};
P.contains=P.include=function(R,Q){if(R==null){return false
}if(n&&R.indexOf===n){return R.indexOf(Q)!=-1
}return C(R,function(S){return S===Q
})
};
P.invoke=function(S,T){var Q=o.call(arguments,2);
var R=P.isFunction(T);
return P.map(S,function(U){return(R?T:U[T]).apply(U,Q)
})
};
P.pluck=function(R,Q){return P.map(R,function(S){return S[Q]
})
};
P.where=function(R,Q,S){if(P.isEmpty(Q)){return S?void 0:[]
}return P[S?"find":"filter"](R,function(U){for(var T in Q){if(Q[T]!==U[T]){return false
}}return true
})
};
P.findWhere=function(R,Q){return P.where(R,Q,true)
};
P.max=function(T,S,R){if(!S&&P.isArray(T)&&T[0]===+T[0]&&T.length<65535){return Math.max.apply(Math,T)
}if(!S&&P.isEmpty(T)){return -Infinity
}var Q={computed:-Infinity,value:-Infinity};
L(T,function(X,U,W){var V=S?S.call(R,X,U,W):X;
V>Q.computed&&(Q={value:X,computed:V})
});
return Q.value
};
P.min=function(T,S,R){if(!S&&P.isArray(T)&&T[0]===+T[0]&&T.length<65535){return Math.min.apply(Math,T)
}if(!S&&P.isEmpty(T)){return Infinity
}var Q={computed:Infinity,value:Infinity};
L(T,function(X,U,W){var V=S?S.call(R,X,U,W):X;
V<Q.computed&&(Q={value:X,computed:V})
});
return Q.value
};
P.shuffle=function(T){var S;
var R=0;
var Q=[];
L(T,function(U){S=P.random(R++);
Q[R-1]=Q[S];
Q[S]=U
});
return Q
};
P.sample=function(R,S,Q){if(arguments.length<2||Q){return R[P.random(R.length-1)]
}return P.shuffle(R).slice(0,Math.max(0,S))
};
var a=function(Q){return P.isFunction(Q)?Q:function(R){return R[Q]
}
};
P.sortBy=function(T,S,Q){var R=a(S);
return P.pluck(P.map(T,function(W,U,V){return{value:W,index:U,criteria:R.call(Q,W,U,V)}
}).sort(function(X,W){var V=X.criteria;
var U=W.criteria;
if(V!==U){if(V>U||V===void 0){return 1
}if(V<U||U===void 0){return -1
}}return X.index-W.index
}),"value")
};
var t=function(Q){return function(V,U,S){var R={};
var T=U==null?P.identity:a(U);
L(V,function(Y,W){var X=T.call(S,Y,W,V);
Q(R,X,Y)
});
return R
}
};
P.groupBy=t(function(Q,R,S){(P.has(Q,R)?Q[R]:(Q[R]=[])).push(S)
});
P.indexBy=t(function(Q,R,S){Q[R]=S
});
P.countBy=t(function(Q,R){P.has(Q,R)?Q[R]++:Q[R]=1
});
P.sortedIndex=function(X,W,T,S){T=T==null?P.identity:a(T);
var V=T.call(S,W);
var Q=0,U=X.length;
while(Q<U){var R=(Q+U)>>>1;
T.call(S,X[R])<V?Q=R+1:U=R
}return Q
};
P.toArray=function(Q){if(!Q){return[]
}if(P.isArray(Q)){return o.call(Q)
}if(Q.length===+Q.length){return P.map(Q,P.identity)
}return P.values(Q)
};
P.size=function(Q){if(Q==null){return 0
}return(Q.length===+Q.length)?Q.length:P.keys(Q).length
};
P.first=P.head=P.take=function(S,R,Q){if(S==null){return void 0
}return(R==null)||Q?S[0]:o.call(S,0,R)
};
P.initial=function(S,R,Q){return o.call(S,0,S.length-((R==null)||Q?1:R))
};
P.last=function(S,R,Q){if(S==null){return void 0
}if((R==null)||Q){return S[S.length-1]
}else{return o.call(S,Math.max(S.length-R,0))
}};
P.rest=P.tail=P.drop=function(S,R,Q){return o.call(S,(R==null)||Q?1:R)
};
P.compact=function(Q){return P.filter(Q,P.identity)
};
var z=function(R,S,Q){if(S&&P.every(R,P.isArray)){return A.apply(Q,R)
}L(R,function(T){if(P.isArray(T)||P.isArguments(T)){S?K.apply(Q,T):z(T,S,Q)
}else{Q.push(T)
}});
return Q
};
P.flatten=function(R,Q){return z(R,Q,[])
};
P.without=function(Q){return P.difference(Q,o.call(arguments,1))
};
P.uniq=P.unique=function(W,V,U,T){if(P.isFunction(V)){T=U;
U=V;
V=false
}var R=U?P.map(W,U,T):W;
var S=[];
var Q=[];
L(R,function(Y,X){if(V?(!X||Q[Q.length-1]!==Y):!P.contains(Q,Y)){Q.push(Y);
S.push(W[X])
}});
return S
};
P.union=function(){return P.uniq(P.flatten(arguments,true))
};
P.intersection=function(R){var Q=o.call(arguments,1);
return P.filter(P.uniq(R),function(S){return P.every(Q,function(T){return P.indexOf(T,S)>=0
})
})
};
P.difference=function(R){var Q=A.apply(E,o.call(arguments,1));
return P.filter(R,function(S){return !P.contains(Q,S)
})
};
P.zip=function(){var S=P.max(P.pluck(arguments,"length").concat(0));
var R=new Array(S);
for(var Q=0;
Q<S;
Q++){R[Q]=P.pluck(arguments,""+Q)
}return R
};
P.object=function(U,R){if(U==null){return{}
}var Q={};
for(var S=0,T=U.length;
S<T;
S++){if(R){Q[U[S]]=R[S]
}else{Q[U[S][0]]=U[S][1]
}}return Q
};
P.indexOf=function(U,S,T){if(U==null){return -1
}var Q=0,R=U.length;
if(T){if(typeof T=="number"){Q=(T<0?Math.max(0,R+T):T)
}else{Q=P.sortedIndex(U,S);
return U[Q]===S?Q:-1
}}if(n&&U.indexOf===n){return U.indexOf(S,T)
}for(;
Q<R;
Q++){if(U[Q]===S){return Q
}}return -1
};
P.lastIndexOf=function(U,S,T){if(U==null){return -1
}var Q=T!=null;
if(l&&U.lastIndexOf===l){return Q?U.lastIndexOf(S,T):U.lastIndexOf(S)
}var R=(Q?T:U.length);
while(R--){if(U[R]===S){return R
}}return -1
};
P.range=function(V,S,U){if(arguments.length<=1){S=V||0;
V=0
}U=arguments[2]||1;
var T=Math.max(Math.ceil((S-V)/U),0);
var Q=0;
var R=new Array(T);
while(Q<T){R[Q++]=V;
V+=U
}return R
};
var J=function(){};
P.bind=function(T,R){var Q,S;
if(I&&T.bind===I){return I.apply(T,o.call(arguments,1))
}if(!P.isFunction(T)){throw new TypeError
}Q=o.call(arguments,2);
return S=function(){if(!(this instanceof S)){return T.apply(R,Q.concat(o.call(arguments)))
}J.prototype=T.prototype;
var V=new J;
J.prototype=null;
var U=T.apply(V,Q.concat(o.call(arguments)));
if(Object(U)===U){return U
}return V
}
};
P.partial=function(R){var Q=o.call(arguments,1);
return function(){return R.apply(this,Q.concat(o.call(arguments)))
}
};
P.bindAll=function(R){var Q=o.call(arguments,1);
if(Q.length===0){throw new Error("bindAll must be passed function names")
}L(Q,function(S){R[S]=P.bind(R[S],R)
});
return R
};
P.memoize=function(S,R){var Q={};
R||(R=P.identity);
return function(){var T=R.apply(this,arguments);
return P.has(Q,T)?Q[T]:(Q[T]=S.apply(this,arguments))
}
};
P.delay=function(R,S){var Q=o.call(arguments,2);
return setTimeout(function(){return R.apply(null,Q)
},S)
};
P.defer=function(Q){return P.delay.apply(P,[Q,1].concat(o.call(arguments,1)))
};
P.throttle=function(R,T,X){var Q,V,Y;
var W=null;
var U=0;
X||(X={});
var S=function(){U=X.leading===false?0:new Date;
W=null;
Y=R.apply(Q,V)
};
return function(){var Z=new Date;
if(!U&&X.leading===false){U=Z
}var aa=T-(Z-U);
Q=this;
V=arguments;
if(aa<=0){clearTimeout(W);
W=null;
U=Z;
Y=R.apply(Q,V)
}else{if(!W&&X.trailing!==false){W=setTimeout(S,aa)
}}return Y
}
};
P.debounce=function(U,X,R){var W,S,T,V,Q;
return function(){T=this;
S=arguments;
V=new Date();
var Z=function(){var aa=(new Date())-V;
if(aa<X){W=setTimeout(Z,X-aa)
}else{W=null;
if(!R){Q=U.apply(T,S)
}}};
var Y=R&&!W;
if(!W){W=setTimeout(Z,X)
}if(Y){Q=U.apply(T,S)
}return Q
}
};
P.once=function(S){var Q=false,R;
return function(){if(Q){return R
}Q=true;
R=S.apply(this,arguments);
S=null;
return R
}
};
P.wrap=function(Q,R){return function(){var S=[Q];
K.apply(S,arguments);
return R.apply(this,S)
}
};
P.compose=function(){var Q=arguments;
return function(){var R=arguments;
for(var S=Q.length-1;
S>=0;
S--){R=[Q[S].apply(this,R)]
}return R[0]
}
};
P.after=function(R,Q){return function(){if(--R<1){return Q.apply(this,arguments)
}}
};
P.keys=e||function(S){if(S!==Object(S)){throw new TypeError("Invalid object")
}var R=[];
for(var Q in S){if(P.has(S,Q)){R.push(Q)
}}return R
};
P.values=function(U){var T=P.keys(U);
var S=T.length;
var Q=new Array(S);
for(var R=0;
R<S;
R++){Q[R]=U[T[R]]
}return Q
};
P.pairs=function(U){var S=P.keys(U);
var R=S.length;
var T=new Array(R);
for(var Q=0;
Q<R;
Q++){T[Q]=[S[Q],U[S[Q]]]
}return T
};
P.invert=function(U){var Q={};
var T=P.keys(U);
for(var R=0,S=T.length;
R<S;
R++){Q[U[T[R]]]=T[R]
}return Q
};
P.functions=P.methods=function(S){var R=[];
for(var Q in S){if(P.isFunction(S[Q])){R.push(Q)
}}return R.sort()
};
P.extend=function(Q){L(o.call(arguments,1),function(R){if(R){for(var S in R){Q[S]=R[S]
}}});
return Q
};
P.pick=function(R){var S={};
var Q=A.apply(E,o.call(arguments,1));
L(Q,function(T){if(T in R){S[T]=R[T]
}});
return S
};
P.omit=function(S){var T={};
var R=A.apply(E,o.call(arguments,1));
for(var Q in S){if(!P.contains(R,Q)){T[Q]=S[Q]
}}return T
};
P.defaults=function(Q){L(o.call(arguments,1),function(R){if(R){for(var S in R){if(Q[S]===void 0){Q[S]=R[S]
}}}});
return Q
};
P.clone=function(Q){if(!P.isObject(Q)){return Q
}return P.isArray(Q)?Q.slice():P.extend({},Q)
};
P.tap=function(R,Q){Q(R);
return R
};
var M=function(X,W,R,S){if(X===W){return X!==0||1/X==1/W
}if(X==null||W==null){return X===W
}if(X instanceof P){X=X._wrapped
}if(W instanceof P){W=W._wrapped
}var U=d.call(X);
if(U!=d.call(W)){return false
}switch(U){case"[object String]":return X==String(W);
case"[object Number]":return X!=+X?W!=+W:(X==0?1/X==1/W:X==+W);
case"[object Date]":case"[object Boolean]":return +X==+W;
case"[object RegExp]":return X.source==W.source&&X.global==W.global&&X.multiline==W.multiline&&X.ignoreCase==W.ignoreCase
}if(typeof X!="object"||typeof W!="object"){return false
}var Q=R.length;
while(Q--){if(R[Q]==X){return S[Q]==W
}}var V=X.constructor,T=W.constructor;
if(V!==T&&!(P.isFunction(V)&&(V instanceof V)&&P.isFunction(T)&&(T instanceof T))){return false
}R.push(X);
S.push(W);
var aa=0,Z=true;
if(U=="[object Array]"){aa=X.length;
Z=aa==W.length;
if(Z){while(aa--){if(!(Z=M(X[aa],W[aa],R,S))){break
}}}}else{for(var Y in X){if(P.has(X,Y)){aa++;
if(!(Z=P.has(W,Y)&&M(X[Y],W[Y],R,S))){break
}}}if(Z){for(Y in W){if(P.has(W,Y)&&!(aa--)){break
}}Z=!aa
}}R.pop();
S.pop();
return Z
};
P.isEqual=function(R,Q){return M(R,Q,[],[])
};
P.isEmpty=function(R){if(R==null){return true
}if(P.isArray(R)||P.isString(R)){return R.length===0
}for(var Q in R){if(P.has(R,Q)){return false
}}return true
};
P.isElement=function(Q){return !!(Q&&Q.nodeType===1)
};
P.isArray=u||function(Q){return d.call(Q)=="[object Array]"
};
P.isObject=function(Q){return Q===Object(Q)
};
L(["Arguments","Function","String","Number","Date","RegExp"],function(Q){P["is"+Q]=function(R){return d.call(R)=="[object "+Q+"]"
}
});
if(!P.isArguments(arguments)){P.isArguments=function(Q){return !!(Q&&P.has(Q,"callee"))
}
}if(typeof(/./)!=="function"){P.isFunction=function(Q){return typeof Q==="function"
}
}P.isFinite=function(Q){return isFinite(Q)&&!isNaN(parseFloat(Q))
};
P.isNaN=function(Q){return P.isNumber(Q)&&Q!=+Q
};
P.isBoolean=function(Q){return Q===true||Q===false||d.call(Q)=="[object Boolean]"
};
P.isNull=function(Q){return Q===null
};
P.isUndefined=function(Q){return Q===void 0
};
P.has=function(R,Q){return j.call(R,Q)
};
P.noConflict=function(){w._=k;
return this
};
P.identity=function(Q){return Q
};
P.times=function(U,T,S){var Q=Array(Math.max(0,U));
for(var R=0;
R<U;
R++){Q[R]=T.call(S,R)
}return Q
};
P.random=function(R,Q){if(Q==null){Q=R;
R=0
}return R+Math.floor(Math.random()*(Q-R+1))
};
var m={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};
m.unescape=P.invert(m.escape);
var N={escape:new RegExp("["+P.keys(m.escape).join("")+"]","g"),unescape:new RegExp("("+P.keys(m.unescape).join("|")+")","g")};
P.each(["escape","unescape"],function(Q){P[Q]=function(R){if(R==null){return""
}return(""+R).replace(N[Q],function(S){return m[Q][S]
})
}
});
P.result=function(Q,S){if(Q==null){return void 0
}var R=Q[S];
return P.isFunction(R)?R.call(Q):R
};
P.mixin=function(Q){L(P.functions(Q),function(R){var S=P[R]=Q[R];
P.prototype[R]=function(){var T=[this._wrapped];
K.apply(T,arguments);
return s.call(this,S.apply(P,T))
}
})
};
var B=0;
P.uniqueId=function(Q){var R=++B+"";
return Q?Q+R:R
};
P.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};
var v=/(.)^/;
var h={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};
var i=/\\|'|\r|\n|\t|\u2028|\u2029/g;
P.template=function(Y,T,S){var R;
S=P.defaults({},S,P.templateSettings);
var U=new RegExp([(S.escape||v).source,(S.interpolate||v).source,(S.evaluate||v).source].join("|")+"|$","g");
var V=0;
var Q="__p+='";
Y.replace(U,function(aa,ab,Z,ad,ac){Q+=Y.slice(V,ac).replace(i,function(ae){return"\\"+h[ae]
});
if(ab){Q+="'+\n((__t=("+ab+"))==null?'':_.escape(__t))+\n'"
}if(Z){Q+="'+\n((__t=("+Z+"))==null?'':__t)+\n'"
}if(ad){Q+="';\n"+ad+"\n__p+='"
}V=ac+aa.length;
return aa
});
Q+="';\n";
if(!S.variable){Q="with(obj||{}){\n"+Q+"}\n"
}Q="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+Q+"return __p;\n";
try{R=new Function(S.variable||"obj","_",Q)
}catch(W){W.source=Q;
throw W
}if(T){return R(T,P)
}var X=function(Z){return R.call(this,Z,P)
};
X.source="function("+(S.variable||"obj")+"){\n"+Q+"}";
return X
};
P.chain=function(Q){return P(Q).chain()
};
var s=function(Q){return this._chain?P(Q).chain():Q
};
P.mixin(P);
L(["pop","push","reverse","shift","sort","splice","unshift"],function(Q){var R=E[Q];
P.prototype[Q]=function(){var S=this._wrapped;
R.apply(S,arguments);
if((Q=="shift"||Q=="splice")&&S.length===0){delete S[0]
}return s.call(this,S)
}
});
L(["concat","join","slice"],function(Q){var R=E[Q];
P.prototype[Q]=function(){return s.call(this,R.apply(this._wrapped,arguments))
}
});
P.extend(P.prototype,{chain:function(){this._chain=true;
return this
},value:function(){return this._wrapped
}})
}).call(this);
(function(){var s=this;
var q=s.Backbone;
var i=[];
var h=i.push;
var r=i.slice;
var D=i.splice;
var d;
if(typeof exports!=="undefined"){d=exports
}else{d=s.Backbone={}
}d.VERSION="0.9.10";
var G=s._;
if(!G&&(typeof require!=="undefined")){G=require("underscore")
}d.$=s.jQuery||s.Zepto||s.ender;
d.noConflict=function(){s.Backbone=q;
return this
};
d.emulateHTTP=false;
d.emulateJSON=false;
var a=/\s+/;
var I=function(Q,O,K,N){if(!K){return true
}if(typeof K==="object"){for(var M in K){Q[O].apply(Q,[M,K[M]].concat(N))
}}else{if(a.test(K)){var P=K.split(a);
for(var L=0,J=P.length;
L<J;
L++){Q[O].apply(Q,[P[L]].concat(N))
}}else{return true
}}};
var e=function(M,K){var N,L=-1,J=M.length;
switch(K.length){case 0:while(++L<J){(N=M[L]).callback.call(N.ctx)
}return;
case 1:while(++L<J){(N=M[L]).callback.call(N.ctx,K[0])
}return;
case 2:while(++L<J){(N=M[L]).callback.call(N.ctx,K[0],K[1])
}return;
case 3:while(++L<J){(N=M[L]).callback.call(N.ctx,K[0],K[1],K[2])
}return;
default:while(++L<J){(N=M[L]).callback.apply(N.ctx,K)
}}};
var p=d.Events={on:function(J,M,K){if(!(I(this,"on",J,[M,K])&&M)){return this
}this._events||(this._events={});
var L=this._events[J]||(this._events[J]=[]);
L.push({callback:M,context:K,ctx:K||this});
return this
},once:function(K,N,L){if(!(I(this,"once",K,[N,L])&&N)){return this
}var J=this;
var M=G.once(function(){J.off(K,M);
N.apply(this,arguments)
});
M._callback=N;
this.on(K,M,L);
return this
},off:function(J,S,K){var P,R,T,Q,O,L,N,M;
if(!this._events||!I(this,"off",J,[S,K])){return this
}if(!J&&!S&&!K){this._events={};
return this
}Q=J?[J]:G.keys(this._events);
for(O=0,L=Q.length;
O<L;
O++){J=Q[O];
if(P=this._events[J]){T=[];
if(S||K){for(N=0,M=P.length;
N<M;
N++){R=P[N];
if((S&&S!==R.callback&&S!==R.callback._callback)||(K&&K!==R.context)){T.push(R)
}}}this._events[J]=T
}}return this
},trigger:function(L){if(!this._events){return this
}var K=r.call(arguments,1);
if(!I(this,"trigger",L,K)){return this
}var M=this._events[L];
var J=this._events.all;
if(M){e(M,K)
}if(J){e(J,arguments)
}return this
},listenTo:function(L,J,N){var K=this._listeners||(this._listeners={});
var M=L._listenerId||(L._listenerId=G.uniqueId("l"));
K[M]=L;
L.on(J,typeof J==="object"?this:N,this);
return this
},stopListening:function(L,J,N){var K=this._listeners;
if(!K){return
}if(L){L.off(J,typeof J==="object"?this:N,this);
if(!J&&!N){delete K[L._listenerId]
}}else{if(typeof J==="object"){N=this
}for(var M in K){K[M].off(J,N,this)
}this._listeners={}
}return this
}};
p.bind=p.on;
p.unbind=p.off;
G.extend(d,p);
var n=d.Model=function(J,L){var M;
var K=J||{};
this.cid=G.uniqueId("c");
this.attributes={};
if(L&&L.collection){this.collection=L.collection
}if(L&&L.parse){K=this.parse(K,L)||{}
}if(M=G.result(this,"defaults")){K=G.defaults({},K,M)
}this.set(K,L);
this.changed={};
this.initialize.apply(this,arguments)
};
G.extend(n.prototype,p,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(J){return G.clone(this.attributes)
},sync:function(){return d.sync.apply(this,arguments)
},get:function(J){return this.attributes[J]
},escape:function(J){return G.escape(this.get(J))
},has:function(J){return this.get(J)!=null
},set:function(R,J,V){var P,S,T,Q,O,U,L,N;
if(R==null){return this
}if(typeof R==="object"){S=R;
V=J
}else{(S={})[R]=J
}V||(V={});
if(!this._validate(S,V)){return false
}T=V.unset;
O=V.silent;
Q=[];
U=this._changing;
this._changing=true;
if(!U){this._previousAttributes=G.clone(this.attributes);
this.changed={}
}N=this.attributes,L=this._previousAttributes;
if(this.idAttribute in S){this.id=S[this.idAttribute]
}for(P in S){J=S[P];
if(!G.isEqual(N[P],J)){Q.push(P)
}if(!G.isEqual(L[P],J)){this.changed[P]=J
}else{delete this.changed[P]
}T?delete N[P]:N[P]=J
}if(!O){if(Q.length){this._pending=true
}for(var M=0,K=Q.length;
M<K;
M++){this.trigger("change:"+Q[M],this,N[Q[M]],V)
}}if(U){return this
}if(!O){while(this._pending){this._pending=false;
this.trigger("change",this,V)
}}this._pending=false;
this._changing=false;
return this
},unset:function(J,K){return this.set(J,void 0,G.extend({},K,{unset:true}))
},clear:function(K){var J={};
for(var L in this.attributes){J[L]=void 0
}return this.set(J,G.extend({},K,{unset:true}))
},hasChanged:function(J){if(J==null){return !G.isEmpty(this.changed)
}return G.has(this.changed,J)
},changedAttributes:function(L){if(!L){return this.hasChanged()?G.clone(this.changed):false
}var N,M=false;
var K=this._changing?this._previousAttributes:this.attributes;
for(var J in L){if(G.isEqual(K[J],(N=L[J]))){continue
}(M||(M={}))[J]=N
}return M
},previous:function(J){if(J==null||!this._previousAttributes){return null
}return this._previousAttributes[J]
},previousAttributes:function(){return G.clone(this._previousAttributes)
},fetch:function(J){J=J?G.clone(J):{};
if(J.parse===void 0){J.parse=true
}var K=J.success;
J.success=function(M,N,L){if(!M.set(M.parse(N,L),L)){return false
}if(K){K(M,N,L)
}};
return this.sync("read",this,J)
},save:function(M,P,L){var K,O,Q,N,J=this.attributes;
if(M==null||typeof M==="object"){K=M;
L=P
}else{(K={})[M]=P
}if(K&&(!L||!L.wait)&&!this.set(K,L)){return false
}L=G.extend({validate:true},L);
if(!this._validate(K,L)){return false
}if(K&&L.wait){this.attributes=G.extend({},J,K)
}if(L.parse===void 0){L.parse=true
}O=L.success;
L.success=function(S,U,R){S.attributes=J;
var T=S.parse(U,R);
if(R.wait){T=G.extend(K||{},T)
}if(G.isObject(T)&&!S.set(T,R)){return false
}if(O){O(S,U,R)
}};
Q=this.isNew()?"create":(L.patch?"patch":"update");
if(Q==="patch"){L.attrs=K
}N=this.sync(Q,this,L);
if(K&&L.wait){this.attributes=J
}return N
},destroy:function(K){K=K?G.clone(K):{};
var J=this;
var N=K.success;
var L=function(){J.trigger("destroy",J,J.collection,K)
};
K.success=function(P,Q,O){if(O.wait||P.isNew()){L()
}if(N){N(P,Q,O)
}};
if(this.isNew()){K.success(this,null,K);
return false
}var M=this.sync("delete",this,K);
if(!K.wait){L()
}return M
},url:function(){var J=G.result(this,"urlRoot")||G.result(this.collection,"url")||v();
if(this.isNew()){return J
}return J+(J.charAt(J.length-1)==="/"?"":"/")+encodeURIComponent(this.id)
},parse:function(K,J){return K
},clone:function(){return new this.constructor(this.attributes)
},isNew:function(){return this.id==null
},isValid:function(J){return !this.validate||!this.validate(this.attributes,J)
},_validate:function(L,K){if(!K.validate||!this.validate){return true
}L=G.extend({},this.attributes,L);
var J=this.validationError=this.validate(L,K)||null;
if(!J){return true
}this.trigger("invalid",this,J,K||{});
return false
}});
var H=d.Collection=function(K,J){J||(J={});
if(J.model){this.model=J.model
}if(J.comparator!==void 0){this.comparator=J.comparator
}this.models=[];
this._reset();
this.initialize.apply(this,arguments);
if(K){this.reset(K,G.extend({silent:true},J))
}};
G.extend(H.prototype,p,{model:n,initialize:function(){},toJSON:function(J){return this.map(function(K){return K.toJSON(J)
})
},sync:function(){return d.sync.apply(this,arguments)
},add:function(J,U){J=G.isArray(J)?J.slice():[J];
U||(U={});
var P,M,Q,S,K,R,T,L,O,N;
T=[];
L=U.at;
O=this.comparator&&(L==null)&&U.sort!=false;
N=G.isString(this.comparator)?this.comparator:null;
for(P=0,M=J.length;
P<M;
P++){if(!(Q=this._prepareModel(S=J[P],U))){this.trigger("invalid",this,S,U);
continue
}if(K=this.get(Q)){if(U.merge){K.set(S===Q?Q.attributes:S,U);
if(O&&!R&&K.hasChanged(N)){R=true
}}continue
}T.push(Q);
Q.on("all",this._onModelEvent,this);
this._byId[Q.cid]=Q;
if(Q.id!=null){this._byId[Q.id]=Q
}}if(T.length){if(O){R=true
}this.length+=T.length;
if(L!=null){D.apply(this.models,[L,0].concat(T))
}else{h.apply(this.models,T)
}}if(R){this.sort({silent:true})
}if(U.silent){return this
}for(P=0,M=T.length;
P<M;
P++){(Q=T[P]).trigger("add",Q,this,U)
}if(R){this.trigger("sort",this,U)
}return this
},remove:function(O,M){O=G.isArray(O)?O.slice():[O];
M||(M={});
var N,J,L,K;
for(N=0,J=O.length;
N<J;
N++){K=this.get(O[N]);
if(!K){continue
}delete this._byId[K.id];
delete this._byId[K.cid];
L=this.indexOf(K);
this.models.splice(L,1);
this.length--;
if(!M.silent){M.index=L;
K.trigger("remove",K,this,M)
}this._removeReference(K)
}return this
},push:function(K,J){K=this._prepareModel(K,J);
this.add(K,G.extend({at:this.length},J));
return K
},pop:function(K){var J=this.at(this.length-1);
this.remove(J,K);
return J
},unshift:function(K,J){K=this._prepareModel(K,J);
this.add(K,G.extend({at:0},J));
return K
},shift:function(K){var J=this.at(0);
this.remove(J,K);
return J
},slice:function(K,J){return this.models.slice(K,J)
},get:function(J){if(J==null){return void 0
}this._idAttr||(this._idAttr=this.model.prototype.idAttribute);
return this._byId[J.id||J.cid||J[this._idAttr]||J]
},at:function(J){return this.models[J]
},where:function(J){if(G.isEmpty(J)){return[]
}return this.filter(function(K){for(var L in J){if(J[L]!==K.get(L)){return false
}}return true
})
},sort:function(J){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")
}J||(J={});
if(G.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)
}else{this.models.sort(G.bind(this.comparator,this))
}if(!J.silent){this.trigger("sort",this,J)
}return this
},pluck:function(J){return G.invoke(this.models,"get",J)
},update:function(J,R){R=G.extend({add:true,merge:true,remove:true},R);
if(R.parse){J=this.parse(J,R)
}var P,N,L,K;
var Q=[],O=[],M={};
if(!G.isArray(J)){J=J?[J]:[]
}if(R.add&&!R.remove){return this.add(J,R)
}for(N=0,L=J.length;
N<L;
N++){P=J[N];
K=this.get(P);
if(R.remove&&K){M[K.cid]=true
}if((R.add&&!K)||(R.merge&&K)){Q.push(P)
}}if(R.remove){for(N=0,L=this.models.length;
N<L;
N++){P=this.models[N];
if(!M[P.cid]){O.push(P)
}}}if(O.length){this.remove(O,R)
}if(Q.length){this.add(Q,R)
}return this
},reset:function(M,K){K||(K={});
if(K.parse){M=this.parse(M,K)
}for(var L=0,J=this.models.length;
L<J;
L++){this._removeReference(this.models[L])
}K.previousModels=this.models.slice();
this._reset();
if(M){this.add(M,G.extend({silent:true},K))
}if(!K.silent){this.trigger("reset",this,K)
}return this
},fetch:function(J){J=J?G.clone(J):{};
if(J.parse===void 0){J.parse=true
}var K=J.success;
J.success=function(N,M,L){var O=L.update?"update":"reset";
N[O](M,L);
if(K){K(N,M,L)
}};
return this.sync("read",this,J)
},create:function(K,J){J=J?G.clone(J):{};
if(!(K=this._prepareModel(K,J))){return false
}if(!J.wait){this.add(K,J)
}var M=this;
var L=J.success;
J.success=function(O,P,N){if(N.wait){M.add(O,N)
}if(L){L(O,P,N)
}};
K.save(null,J);
return K
},parse:function(K,J){return K
},clone:function(){return new this.constructor(this.models)
},_reset:function(){this.length=0;
this.models.length=0;
this._byId={}
},_prepareModel:function(L,K){if(L instanceof n){if(!L.collection){L.collection=this
}return L
}K||(K={});
K.collection=this;
var J=new this.model(L,K);
if(!J._validate(L,K)){return false
}return J
},_removeReference:function(J){if(this===J.collection){delete J.collection
}J.off("all",this._onModelEvent,this)
},_onModelEvent:function(L,K,M,J){if((L==="add"||L==="remove")&&M!==this){return
}if(L==="destroy"){this.remove(K,J)
}if(K&&L==="change:"+K.idAttribute){delete this._byId[K.previous(K.idAttribute)];
if(K.id!=null){this._byId[K.id]=K
}}this.trigger.apply(this,arguments)
},sortedIndex:function(J,M,K){M||(M=this.comparator);
var L=G.isFunction(M)?M:function(N){return N.get(M)
};
return G.sortedIndex(this.models,J,L,K)
}});
var B=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];
G.each(B,function(J){H.prototype[J]=function(){var K=r.call(arguments);
K.unshift(this.models);
return G[J].apply(G,K)
}
});
var j=["groupBy","countBy","sortBy"];
G.each(j,function(J){H.prototype[J]=function(M,K){var L=G.isFunction(M)?M:function(N){return N.get(M)
};
return G[J](this.models,L,K)
}
});
var E=d.Router=function(J){J||(J={});
if(J.routes){this.routes=J.routes
}this._bindRoutes();
this.initialize.apply(this,arguments)
};
var m=/\((.*?)\)/g;
var k=/(\(\?)?:\w+/g;
var C=/\*\w+/g;
var f=/[\-{}\[\]+?.,\\\^$|#\s]/g;
G.extend(E.prototype,p,{initialize:function(){},route:function(J,K,L){if(!G.isRegExp(J)){J=this._routeToRegExp(J)
}if(!L){L=this[K]
}d.history.route(J,G.bind(function(N){var M=this._extractParameters(J,N);
L&&L.apply(this,M);
this.trigger.apply(this,["route:"+K].concat(M));
this.trigger("route",K,M);
d.history.trigger("route",this,K,M)
},this));
return this
},navigate:function(K,J){d.history.navigate(K,J);
return this
},_bindRoutes:function(){if(!this.routes){return
}var K,J=G.keys(this.routes);
while((K=J.pop())!=null){this.route(K,this.routes[K])
}},_routeToRegExp:function(J){J=J.replace(f,"\\$&").replace(m,"(?:$1)?").replace(k,function(L,K){return K?L:"([^/]+)"
}).replace(C,"(.*?)");
return new RegExp("^"+J+"$")
},_extractParameters:function(J,K){return J.exec(K).slice(1)
}});
var b=d.History=function(){this.handlers=[];
G.bindAll(this,"checkUrl");
if(typeof window!=="undefined"){this.location=window.location;
this.history=window.history
}};
var o=/^[#\/]|\s+$/g;
var A=/^\/+|\/+$/g;
var l=/msie [\w.]+/;
var c=/\/$/;
b.started=false;
G.extend(b.prototype,p,{interval:50,getHash:function(K){var J=(K||this).location.href.match(/#(.*)$/);
return J?J[1]:""
},getFragment:function(L,K){if(L==null){if(this._hasPushState||!this._wantsHashChange||K){L=this.location.pathname;
var J=this.root.replace(c,"");
if(!L.indexOf(J)){L=L.substr(J.length)
}}else{L=this.getHash()
}}return L.replace(o,"")
},start:function(L){if(b.started){throw new Error("Backbone.history has already been started")
}b.started=true;
this.options=G.extend({},{root:"/"},this.options,L);
this.root=this.options.root;
this._wantsHashChange=this.options.hashChange!==false;
this._wantsPushState=!!this.options.pushState;
this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);
var K=this.getFragment();
var J=document.documentMode;
var N=(l.exec(navigator.userAgent.toLowerCase())&&(!J||J<=7));
this.root=("/"+this.root+"/").replace(A,"/");
if(N&&this._wantsHashChange){this.iframe=d.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;
this.navigate(K)
}if(this._hasPushState){d.$(window).on("popstate",this.checkUrl)
}else{if(this._wantsHashChange&&("onhashchange" in window)&&!N){d.$(window).on("hashchange",this.checkUrl)
}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)
}}}this.fragment=K;
var O=this.location;
var M=O.pathname.replace(/[^\/]$/,"$&/")===this.root;
if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!M){this.fragment=this.getFragment(null,true);
this.location.replace(this.root+this.location.search+"#"+this.fragment);
return true
}else{if(this._wantsPushState&&this._hasPushState&&M&&O.hash){this.fragment=this.getHash().replace(o,"");
this.history.replaceState({},document.title,this.root+this.fragment+O.search)
}}if(!this.options.silent){return this.loadUrl()
}},stop:function(){d.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);
clearInterval(this._checkUrlInterval);
b.started=false
},route:function(J,K){this.handlers.unshift({route:J,callback:K})
},checkUrl:function(K){var J=this.getFragment();
if(J===this.fragment&&this.iframe){J=this.getFragment(this.getHash(this.iframe))
}if(J===this.fragment){return false
}if(this.iframe){this.navigate(J)
}this.loadUrl()||this.loadUrl(this.getHash())
},loadUrl:function(L){var K=this.fragment=this.getFragment(L);
var J=G.any(this.handlers,function(M){if(M.route.test(K)){M.callback(K);
return true
}});
return J
},navigate:function(L,K){if(!b.started){return false
}if(!K||K===true){K={trigger:K}
}L=this.getFragment(L||"");
if(this.fragment===L){return
}this.fragment=L;
var J=this.root+L;
if(this._hasPushState){this.history[K.replace?"replaceState":"pushState"]({},document.title,J)
}else{if(this._wantsHashChange){this._updateHash(this.location,L,K.replace);
if(this.iframe&&(L!==this.getFragment(this.getHash(this.iframe)))){if(!K.replace){this.iframe.document.open().close()
}this._updateHash(this.iframe.location,L,K.replace)
}}else{return this.location.assign(J)
}}if(K.trigger){this.loadUrl(L)
}},_updateHash:function(J,L,M){if(M){var K=J.href.replace(/(javascript:|#).*$/,"");
J.replace(K+"#"+L)
}else{J.hash="#"+L
}}});
d.history=new b;
var u=d.View=function(J){this.cid=G.uniqueId("view");
this._configure(J||{});
this._ensureElement();
this.initialize.apply(this,arguments);
this.delegateEvents()
};
var g=/^(\S+)\s*(.*)$/;
var w=["model","collection","el","id","attributes","className","tagName","events"];
G.extend(u.prototype,p,{tagName:"div",$:function(J){return this.$el.find(J)
},initialize:function(){},render:function(){return this
},remove:function(){this.$el.remove();
this.stopListening();
return this
},setElement:function(J,K){if(this.$el){this.undelegateEvents()
}this.$el=J instanceof d.$?J:d.$(J);
this.el=this.$el[0];
if(K!==false){this.delegateEvents()
}return this
},delegateEvents:function(N){if(!(N||(N=G.result(this,"events")))){return
}this.undelegateEvents();
for(var M in N){var O=N[M];
if(!G.isFunction(O)){O=this[N[M]]
}if(!O){throw new Error('Method "'+N[M]+'" does not exist')
}var L=M.match(g);
var K=L[1],J=L[2];
O=G.bind(O,this);
K+=".delegateEvents"+this.cid;
if(J===""){this.$el.on(K,O)
}else{this.$el.on(K,J,O)
}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)
},_configure:function(J){if(this.options){J=G.extend({},G.result(this,"options"),J)
}G.extend(this,G.pick(J,w));
this.options=J
},_ensureElement:function(){if(!this.el){var J=G.extend({},G.result(this,"attributes"));
if(this.id){J.id=G.result(this,"id")
}if(this.className){J["class"]=G.result(this,"className")
}var K=d.$("<"+G.result(this,"tagName")+">").attr(J);
this.setElement(K,false)
}else{this.setElement(G.result(this,"el"),false)
}}});
var t={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};
d.sync=function(J,L,R){var M=t[J];
G.defaults(R||(R={}),{emulateHTTP:d.emulateHTTP,emulateJSON:d.emulateJSON});
var K={type:M,dataType:"json"};
if(!R.url){K.url=G.result(L,"url")||v()
}if(R.data==null&&L&&(J==="create"||J==="update"||J==="patch")){K.contentType="application/json";
K.data=JSON.stringify(R.attrs||L.toJSON(R))
}if(R.emulateJSON){K.contentType="application/x-www-form-urlencoded";
K.data=K.data?{model:K.data}:{}
}if(R.emulateHTTP&&(M==="PUT"||M==="DELETE"||M==="PATCH")){K.type="POST";
if(R.emulateJSON){K.data._method=M
}var O=R.beforeSend;
R.beforeSend=function(S){S.setRequestHeader("X-HTTP-Method-Override",M);
if(O){return O.apply(this,arguments)
}}
}if(K.type!=="GET"&&!R.emulateJSON){K.processData=false
}var P=R.success;
R.success=function(S){if(P){P(L,S,R)
}L.trigger("sync",L,S,R)
};
var N=R.error;
R.error=function(S){if(N){N(L,S,R)
}L.trigger("error",L,S,R)
};
var Q=R.xhr=d.ajax(G.extend(K,R));
L.trigger("request",L,Q,R);
return Q
};
d.ajax=function(){return d.$.ajax.apply(d.$,arguments)
};
var z=function(J,L){var K=this;
var N;
if(J&&G.has(J,"constructor")){N=J.constructor
}else{N=function(){return K.apply(this,arguments)
}
}G.extend(N,K,L);
var M=function(){this.constructor=N
};
M.prototype=K.prototype;
N.prototype=new M;
if(J){G.extend(N.prototype,J)
}N.__super__=K.prototype;
return N
};
n.extend=H.extend=E.extend=u.extend=b.extend=z;
var v=function(){throw new Error('A "url" property or function must be specified')
}
}).call(this);
/*! F - v0.1.0 - 2013-02-04
* http://lazd.github.com/F/
* Copyright (c) 2013 Lawrence Davis; Licensed BSD */
var Class;
(function(){var b=function(d){var c=d.bind(this);
c._methodName=d._methodName;
this[c._methodName]=c;
return c
};
var a=function(c){return new Class(_.extend({},c,{extend:this}))
};
Class=function(c){c=c||{};
if(c.hasOwnProperty("extend")&&!c.extend){console.warn("Class: %s is attempting to extend a non-truthy thing",c.toString==="function"?c.toString:c.toString,c.extend)
}var f=c.extend||Object;
var j=c.construct;
var d=c.destruct;
delete c.bind;
delete c.extend;
delete c.destruct;
delete c.construct;
if(c.hasOwnProperty("toString")&&typeof c.toString!=="function"){var h=c.toString;
c.toString=function(){return h.toString()
}
}else{if(!c.hasOwnProperty("toString")&&f.prototype.hasOwnProperty("toString")){c.toString=f.prototype.toString
}}var k=c;
var g=Object.create(f&&f.prototype);
g.superClass=f.prototype;
if(k){for(var i in k){if(k.hasOwnProperty(i)){g[i]=k[i];
if(typeof k[i]==="function"){g[i]._methodName=i;
g[i]._parentProto=g
}}}}g.inherited=function(o){var n=o.callee;
var l=n._methodName;
if(!l){console.error("Class.inherited: can't call inherited method: calling method did not have _methodName",o.callee);
return
}var q=n._parentProto;
var m=null;
while(q.superClass){q=q.superClass;
m=q[l];
if(typeof m==="function"){break
}}if(typeof m==="function"){var p=this.inherited;
this.inherited=q.inherited;
var r=m.apply(this,o);
this.inherited=p;
return r
}else{console.warn("Class.inherited: can't call inherited method for '%s': no method by that name found",l)
}};
g.bind=b;
g.destruct=function(){if(typeof d==="function"){d.apply(this)
}if(f&&f.prototype&&typeof f.prototype.destruct==="function"){f.prototype.destruct.apply(this)
}};
g.construct=function(){var l=arguments;
if(l[0]===undefined){l.length=1;
l[0]={}
}if(f&&f.prototype&&typeof f.prototype.construct==="function"){f.prototype.construct.apply(this,arguments)
}if(typeof j==="function"){j.apply(this,arguments)
}};
var e=function(){var l=Object.create(g);
g.construct.apply(l,arguments);
return l
};
e.prototype=g;
e.extend=a;
g.constructor=e;
return e
};
if(!Object.create){Object.create=function(d){if(arguments.length>1){throw new Error("Object.create implementation only accepts the first parameter.")
}function c(){}c.prototype=d;
return new c()
}
}if(!Function.prototype.bind){Function.prototype.bind=function(d){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")
}var g=Array.prototype.slice.call(arguments,1);
var f=this;
var c=function(){};
var e=function(){return f.apply(this instanceof c?this:d,g.concat(Array.prototype.slice.call(arguments)))
};
c.prototype=this.prototype;
e.prototype=new c();
return e
}
}}());
var F=F||{};
try{window["ƒ"]=F
}catch(err){console.log("ƒ: could not set ƒ variable")
}F.options={debug:false,precompiledTemplates:true};
_.extend(F,Backbone.Events);
F.EventEmitter=new Class(Backbone.Events);
(function(){var b=/^(\S+)\s*(.*)$/;
var a=function(c,d){if(!(c&&c[d])){return null
}return _.isFunction(c[d])?c[d]():c[d]
};
F.View=Backbone.View.extend({initialize:function(){if(this.options.container!==undefined&&this.options.el!==undefined){throw new Error("View: should provide either options.el or options.container, never both")
}var c=this.options.template||this.template;
if(c){if(F.options.precompiledTemplates){this.template=c
}else{this.template=Handlebars.template(c)
}}this.render=this.render.bind(this);
if(this.options.el){var e=this.$el[0].nodeName.toUpperCase();
var d=this.tagName.toUpperCase();
if(this.tagName!=="div"&&e!==d){throw new Error("View: cannot create view, incorrect tag provided. Expected "+d+", but got "+e)
}this.$el.addClass(this.className)
}this.container=this.options.container;
this.component=this.options.component;
if(this.options.events){this.delegateEvents(this.options.events)
}if(this.options.model){this.setModel(this.options.model)
}this.rendered=null
},setModel:function(c){if(this.model&&this.model.off){this.stopListening(this.model)
}this.model=c;
if(this.model&&this.model.on&&!this.options.noRerender){this.listenTo(this.model,"change",this.render)
}this.rendered=null
},age:function(){return this.rendered!==null?new Date().getTime()-this.rendered:-1
},remove:function(){this.$el.remove();
if(this.model&&this.model.off){this.stopListening()
}},show:function(){if(this.template){this.renderOnce()
}this.$el.show();
return this
},hide:function(){this.$el.hide();
return this
},renderOnce:function(){if(this.rendered===null){this.render()
}return this
},inDebugMode:function(){return F.options.debug||(this.component&&this.component.options.debug)
},render:function(){if(this.inDebugMode()){console.log("%s: Rendering view...",this.component&&this.component.toString()||"Orphaned view")
}if(this.template){var c=this.model||(this.component&&this.component.model);
this.$el.html(this.template(c&&c.toJSON&&c.toJSON()||c||{}))
}if(this.container&&!$(this.el.parentNode).is(this.container)){$(this.container).append(this.el)
}this.rendered=new Date().getTime();
this.trigger("renderComplete");
return this
},delegateEvents:function(m){if(!(m||(m=a(this,"events")))){return
}this.undelegateEvents();
for(var l in m){var c=m[l];
var d=this.component;
if(!_.isFunction(c)){if(this.component){var g=m[l].split(".");
if(g.length>1){c=this.component;
for(var h=0;
h<g.length;
h++){var e=g[h];
d=c;
c=c[e];
if(!c){break
}}}else{c=this.component[m[l]]
}}else{c=this[m[l]]
}}if(!c){throw new Error('Method "'+m[l]+'" does not exist')
}var j=l.match(b);
var k=j[1],f=j[2];
c=this.component?_.bind(c,d):_.bind(c,this);
k+=".delegateEvents"+this.cid;
if(f===""){this.$el.bind(k,c)
}else{this.$el.delegate(f,k,c)
}}return this
}})
}());
(function(){function a(b){return b.slice(0,1).toLowerCase()+b.slice(1)
}F.Component=new Class({toString:"Component",extend:F.EventEmitter,options:{singly:false,visible:false,debug:false},construct:function(b){this.mergeOptions();
this.applyOptions(b);
this.components={};
this._bubbledEvts={};
this.bind(this._handleSubComponentShown);
this.bind(this.render)
},destruct:function(){if(this.view){this.view.remove()
}for(var b in this.components){this.components[b].destruct();
delete this[b]
}this.stopListening();
delete this.components
},render:function(){if(this.view){this.view.render()
}return this
},bubble:function(c,b){if(!this[c]){console.error("%s: cannot set event '%s' for bubbling from component '%s', component does not exist",this.toString(),b,c);
return this
}if(!this._bubbledEvts[c]){this._bubbledEvts[c]={}
}var d=this._bubbledEvts[c][b]=function(){var e=Array.prototype.slice.call(arguments);
e.unshift(b);
this.trigger.apply(this,e)
}.bind(this);
this[c].on(b,d);
return this
},unbubble:function(c,b){if(!this._bubbledEvts[c]||!this._bubbledEvts[c][b]){console.warn("%s: cannot discontinue bubbling of event '%s' for component '%s', event was not set for bubbling",this.toString(),b,c);
return this
}this[c].off(b,this._bubbledEvts[c][b]);
return this
},addComponent:function(c,b){if(b){b=a(b)
}else{b=a(c.toString())
}c.setName(b);
this[b]=this.components[b]=c;
if(c.view){if(c.view.el){if(c.options.visible===true){c.show({silent:true})
}else{c.view.$el.hide()
}}else{console.warn("Component %s has a view without an element",b,c,c.view,c.view.options)
}}c.parent=this;
this.listenTo(c,"component:shown",this._handleSubComponentShown);
return c
},removeComponent:function(b){var c=this[b];
if(c!==undefined){this.stopListening(c);
delete this[b];
delete this.components[b]
}return this
},_handleSubComponentShown:function(b){var c=this.components[b.name];
if(c!==undefined){if(this.options.singly&&!c.overlay){this.hideAllSubComponents([b.name]);
this.currentSubComponent=c
}this.trigger("subComponent:shown",{name:b.name,component:b.component});
this.show()
}},show:function(b){b=b||{};
if(this.inDebugMode()){if(this.isVisible()){console.log("%s: not showing self; already visible",this.toString())
}else{console.log("%s: showing self",this.toString())
}}if(!b.silent){this.trigger("component:shown",{name:this.toString(),component:this})
}if(this.view){this.view.show()
}this.options.visible=true;
return this
},hide:function(b){b=b||{};
if(!this.isVisible()){return false
}if(this.inDebugMode()){console.log("%s: hiding self",this.toString())
}if(this.view){this.view.hide()
}if(!b.silent){this.trigger("component:hidden",{name:this.toString(),component:this})
}this.options.visible=false;
return this
},inDebugMode:function(){return this.options.debug||F.options.debug
},isVisible:function(){return this.options.visible
},showAllSubComponents:function(c){c=!_.isArray(c)?[]:c;
for(var b in this.components){if(~c.indexOf(b)){continue
}this.components[b].show()
}return this
},hideAllSubComponents:function(c){c=!_.isArray(c)?[]:c;
for(var b in this.components){if(~c.indexOf(b)){continue
}this.components[b].hide()
}return this
},setName:function(b){this.toString=function(){return b
};
return this
},setPropsFromOptions:function(b,c){_.each(c,function(d){this[d]=b[d]||this[d];
delete b[d]
}.bind(this));
return this
},mergeOptions:function(){var c=[];
var b=this.constructor.prototype;
while(b){if(b.hasOwnProperty("options")){c.unshift(b.options)
}b=b.superClass
}c.unshift({});
this.options=_.extend.apply(_,c)
},applyOptions:function(b){for(var c in b){if(this.options.hasOwnProperty(c)){this.options[c]=b[c]
}}_.extend(b,this.options);
return b
}})
}());
F.ModelComponent=new Class({toString:"ModelComponent",extend:F.Component,construct:function(a){this.Model=this.Model||a.Model
},Model:Backbone.Model,refresh:function(a){this.model.fetch({success:function(){this.model.trigger("loaded");
this.trigger("model:loaded",this.model);
if(typeof a==="function"){a.call(this,this.model)
}}.bind(this),error:function(c,b){console.warn("%s: Error loading model",this.toString());
this.trigger("model:loadFailed",{response:b})
}.bind(this)});
return this
},_setModel:function(a){this.model=a;
if(this.model&&this.model.off&&this.view){this.view.setModel(a)
}return this
},fetch:function(c,d){var b={};
if(c!==undefined){b[this.Model.prototype.idAttribute]=c
}var a=new this.Model(b);
a.fetch({success:function(){this._setModel(a);
this.trigger("model:loaded",this.model);
if(typeof d==="function"){d.call(this,a)
}}.bind(this),error:function(f,e){console.warn("%s: Error loading model",this.toString());
this.trigger("model:loadFailed",{response:e})
}.bind(this)});
return this
},load:function(a){if(a instanceof Backbone.Model){this._setModel(a)
}else{this._setModel(new this.Model(a))
}this.trigger("model:loaded",this.model);
return this
},save:function(b,c,a){if(this.model){if(this.inDebugMode()){console.log("%s: Saving...",this.toString())
}this.model.save(b||{},_.extend({success:function(e,d){if(this.inDebugMode()){console.log("%s: Save successful",this.toString())
}if(typeof c==="function"){c.call(this,null,this.model,d)
}this.trigger("model:saved",{model:this.model,response:d})
}.bind(this),error:function(e,d){console.warn("%s: Error saving model",this.toString());
if(typeof c==="function"){c.call(this,new Error("Error saving model"),this.model,d)
}this.trigger("model:saveFailed",{model:this.model,response:d})
}.bind(this)},a))
}else{console.warn("%s: Cannot save, model is not truthy",this.toString())
}return this
},show:function(a){a=a||{};
if(a.id){if(this.inDebugMode()){console.log("%s: fetching item with ID %s",this.toString(),a.id)
}this.fetch(a.id,function(b){if(this.inDebugMode()){console.log("%s: fetch complete!",this.toString())
}this.show({silent:a.silent})
})
}else{if(a.model){if(this.inDebugMode()){console.log("%s: showing with new model",this.toString(),a.model)
}this.load(a.model);
this.show({silent:a.silent})
}else{this.inherited(arguments)
}}return this
}});
F.CollectionComponent=new Class({toString:"CollectionComponent",extend:F.Component,options:{defaultParams:{}},construct:function(a){this.bind(this.addModel);
this.bind(this.removeModel);
this.bind(this.render);
this._useCollection(new this.Collection());
this.options.defaultParams=_.extend({},this.options.defaultParams,a.defaultParams);
this.params=_.extend({},this.options.defaultParams);
this.collectionLoaded=false
},destruct:function(){this._releaseCollection()
},Collection:Backbone.Collection,_useCollection:function(a){this.collection=a;
this.listenTo(this.collection,"add",this.addModel);
this.listenTo(this.collection,"remove",this.removeModel);
this.listenTo(this.collection,"loaded",this.render)
},_releaseCollection:function(){this.stopListening(this.collection);
this.collection=null
},refresh:function(a){this.fetch(this.params,a);
return this
},addModel:function(a){},removeModel:function(a){},clearParams:function(){this.params={};
return this
},fetch:function(a,b){if(a){this.params=_.extend({},this.options.defaultParams,a)
}else{this.params=_.extend({},this.options.defaultParams)
}this.collection.fetch({data:this.params,success:function(){this.collection.trigger("loaded");
this.trigger("collection:loaded",this.collection);
this.collectionLoaded=true;
if(typeof b==="function"){b.call(this,this.collection)
}}.bind(this)});
return this
},load:function(a){this._releaseCollection();
if(a instanceof Backbone.Collection){this._useCollection(a)
}else{this._useCollection(new this.Collection(a))
}return this
},show:function(a){a=a||{};
if(a.params){this.fetch(a.params,function(){this.show({silent:a.silent})
})
}else{if(!this.collectionLoaded){this.refresh(function(){this.show({silent:a.silent})
})
}else{this.inherited(arguments)
}}return this
}});
(function(){var a=F.View.extend({tagName:"form",events:{}});
F.FormComponent=new Class({toString:"FormComponent",extend:F.ModelComponent,construct:function(b){this.view=new this.View(_.extend({component:this,template:this.Template},b));
this.model=new this.Model();
this.bind(this.handleSubmit);
this.view.$el.on("submit",this.handleSubmit)
},destruct:function(){this.view.$el.off("submit",this.handleSubmit)
},View:a,Template:null,clear:function(){this._setModel(new this.Model());
this.render();
return this
},handleSubmit:function(c){this.view.$el.find('[type="submit"], button').first().focus();
if(c&&c.preventDefault){c.preventDefault()
}var b=this.view.$el.serializeArray();
var d={};
_.each(b,function(e){d[e.name]=e.value
});
this.save(d)
}})
}());
(function(){var a=F.View.extend({tagName:"ul",initialize:function(c){c=c||{};
F.View.prototype.initialize.apply(this,arguments);
this.collection=c.collection;
this.ItemView=c.ItemView||this.ItemView;
this.ItemTemplate=c.ItemTemplate||this.ItemTemplate;
this.subViews=[];
this.addSubView=this.addSubView.bind(this)
},addSubView:function(d){var c=new this.ItemView({model:d,template:this.ItemTemplate,component:this.component});
c.render();
if(this.options.ListContainer){this.$(this.options.ListContainer).append(c.el)
}else{this.$el.append(c.el)
}c.$el.data("viewIndex",this.subViews.length);
this.subViews.push(c)
},remove:function(){this.removeSubViews();
F.View.prototype.remove.call(this,arguments)
},removeSubView:function(e){var c=null;
var d=-1;
if(typeof d!=="Number"){_.some(this.subViews,function(f,g){if(f&&f.model===e){c=f;
d=g
}}.bind(this))
}else{c=this.subViews[d]
}if(c){c.remove();
this.subViews[d]=undefined
}},removeSubViews:function(){if(this.subViews.length){_.each(this.subViews,function(c){if(c){c.remove()
}});
this.subViews=[]
}},render:function(){if(this.inDebugMode()){console.log("%s: rendering list view...",this.component&&this.component.toString()||"List view")
}if(this.container&&!$(this.el.parentNode).is(this.container)){$(this.container).append(this.el)
}if(this.rendered===null){if(this.template){this.$el.html(this.template({}))
}this.rendered=new Date().getTime()
}this.removeSubViews();
this.collection.each(this.addSubView);
if(this.collection.isEmpty()){var e=this.ItemView;
var c;
if(_.isEqual(this.component.params,this.component.options.defaultParams)&&this.component.ListEmptyTemplate){c=this.component.ListEmptyTemplate;
if(this.component.ListEmptyView){e=this.component.ListEmptyView
}}else{if(this.component.NoResultsTemplate){c=this.component.NoResultsTemplate;
if(this.component.NoResultsView){e=this.component.NoResultsView
}}}if(c){var d=new e({template:c,component:this.component,model:this.component.params}).render();
if(this.options.ListContainer){this.$(this.options.ListContainer).append(d.el)
}else{this.$el.append(d.el)
}this.subViews.push(d)
}}this.rendered=new Date().getTime();
this.trigger("renderComplete");
return this
}});
var b=F.View.extend({tagName:"li",className:"listItem"});
F.ListComponent=new Class({toString:"ListComponent",extend:F.CollectionComponent,construct:function(c){this.view=new this.ListView(_.extend({component:this,collection:this.collection,template:this.ListTemplate,ItemView:this.ItemView,ItemTemplate:this.ItemTemplate,ListContainer:this.ListContainer,events:_.extend({},{"click li":"handleSelect"},this.ListView.prototype.events)},c));
this.selectedItem=null
},Collection:Backbone.Collection,NoResultsTemplate:null,NoResultsView:null,ListEmptyView:null,ListEmptyTemplate:null,ListTemplate:null,ListView:a,ItemTemplate:null,ItemView:b,addModel:function(c){this.view.addSubView(c)
},removeModel:function(c){this.view.removeSubView(c)
},getModelFromLi:function(c){return this.view.subViews[$(c).data("viewIndex")].model
},getViewFromLi:function(c){return this.view.subViews[$(c).data("viewIndex")]
},handleSelect:function(c){var d=this.getModelFromLi(c.currentTarget);
if(d){this.selectedItem=d.id;
this.trigger("list:itemSelected",{listItem:$(c.currentTarget),model:d})
}}})
}());
d3=function(){var hx={version:"3.3.13"};
if(!Date.now){Date.now=function(){return +new Date()
}
}var bR=[].slice,dX=function(e){return bR.call(e)
};
var bQ=document,ei=bQ.documentElement,fN=window;
try{dX(ei.childNodes)[0].nodeType
}catch(hn){dX=function(iq){var e=iq.length,ir=new Array(e);
while(e--){ir[e]=iq[e]
}return ir
}
}try{bQ.createElement("div").style.setProperty("opacity",0,"")
}catch(fJ){var dV=fN.Element.prototype,b4=dV.setAttribute,hf=dV.setAttributeNS,dH=fN.CSSStyleDeclaration.prototype,gY=dH.setProperty;
dV.setAttribute=function(e,iq){b4.call(this,e,iq+"")
};
dV.setAttributeNS=function(ir,e,iq){hf.call(this,ir,e,iq+"")
};
dH.setProperty=function(e,ir,iq){gY.call(this,e,ir+"",iq)
}
}hx.ascending=function(iq,e){return iq<e?-1:iq>e?1:iq>=e?0:NaN
};
hx.descending=function(iq,e){return e<iq?-1:e>iq?1:e>=iq?0:NaN
};
hx.min=function(iv,it){var ir=-1,iu=iv.length,iq,e;
if(arguments.length===1){while(++ir<iu&&!((iq=iv[ir])!=null&&iq<=iq)){iq=undefined
}while(++ir<iu){if((e=iv[ir])!=null&&iq>e){iq=e
}}}else{while(++ir<iu&&!((iq=it.call(iv,iv[ir],ir))!=null&&iq<=iq)){iq=undefined
}while(++ir<iu){if((e=it.call(iv,iv[ir],ir))!=null&&iq>e){iq=e
}}}return iq
};
hx.max=function(iv,it){var ir=-1,iu=iv.length,iq,e;
if(arguments.length===1){while(++ir<iu&&!((iq=iv[ir])!=null&&iq<=iq)){iq=undefined
}while(++ir<iu){if((e=iv[ir])!=null&&e>iq){iq=e
}}}else{while(++ir<iu&&!((iq=it.call(iv,iv[ir],ir))!=null&&iq<=iq)){iq=undefined
}while(++ir<iu){if((e=it.call(iv,iv[ir],ir))!=null&&e>iq){iq=e
}}}return iq
};
hx.extent=function(iw,it){var ir=-1,iv=iw.length,iq,e,iu;
if(arguments.length===1){while(++ir<iv&&!((iq=iu=iw[ir])!=null&&iq<=iq)){iq=iu=undefined
}while(++ir<iv){if((e=iw[ir])!=null){if(iq>e){iq=e
}if(iu<e){iu=e
}}}}else{while(++ir<iv&&!((iq=iu=it.call(iw,iw[ir],ir))!=null&&iq<=iq)){iq=undefined
}while(++ir<iv){if((e=it.call(iw,iw[ir],ir))!=null){if(iq>e){iq=e
}if(iu<e){iu=e
}}}}return[iq,iu]
};
hx.sum=function(iv,it){var ir=0,iu=iv.length,e,iq=-1;
if(arguments.length===1){while(++iq<iu){if(!isNaN(e=+iv[iq])){ir+=e
}}}else{while(++iq<iu){if(!isNaN(e=+it.call(iv,iv[iq],iq))){ir+=e
}}}return ir
};
function hC(e){return e!=null&&!isNaN(e)
}hx.mean=function(iw,iu){var iv=iw.length,iq,e=0,it=-1,ir=0;
if(arguments.length===1){while(++it<iv){if(hC(iq=iw[it])){e+=(iq-e)/++ir
}}}else{while(++it<iv){if(hC(iq=iu.call(iw,iw[it],it))){e+=(iq-e)/++ir
}}}return ir?e:undefined
};
hx.quantile=function(ir,iw){var it=(ir.length-1)*iw+1,iu=Math.floor(it),iq=+ir[iu-1],iv=it-iu;
return iv?iq+iv*(ir[iu]-iq):iq
};
hx.median=function(iq,e){if(arguments.length>1){iq=iq.map(e)
}iq=iq.filter(hC);
return iq.length?hx.quantile(iq.sort(hx.ascending),0.5):undefined
};
hx.bisector=function(e){return{left:function(ir,iq,iv,iu){if(arguments.length<3){iv=0
}if(arguments.length<4){iu=ir.length
}while(iv<iu){var it=iv+iu>>>1;
if(e.call(ir,ir[it],it)<iq){iv=it+1
}else{iu=it
}}return iv
},right:function(ir,iq,iv,iu){if(arguments.length<3){iv=0
}if(arguments.length<4){iu=ir.length
}while(iv<iu){var it=iv+iu>>>1;
if(iq<e.call(ir,ir[it],it)){iu=it
}else{iv=it+1
}}return iv
}}
};
var gB=hx.bisector(function(e){return e
});
hx.bisectLeft=gB.left;
hx.bisect=hx.bisectRight=gB.right;
hx.shuffle=function(it){var e=it.length,ir,iq;
while(e){iq=Math.random()*e--|0;
ir=it[e],it[e]=it[iq],it[iq]=ir
}return it
};
hx.permute=function(it,iq){var ir=iq.length,e=new Array(ir);
while(ir--){e[ir]=it[iq[ir]]
}return e
};
hx.pairs=function(iv){var e=0,iu=iv.length-1,it,ir=iv[0],iq=new Array(iu<0?0:iu);
while(e<iu){iq[e]=[it=ir,ir=iv[++e]]
}return iq
};
hx.zip=function(){if(!(iv=arguments.length)){return[]
}for(var it=-1,e=hx.min(arguments,fs),ir=new Array(e);
++it<e;
){for(var iq=-1,iv,iu=ir[it]=new Array(iv);
++iq<iv;
){iu[iq]=arguments[iq][it]
}}return ir
};
function fs(e){return e.length
}hx.transpose=function(e){return hx.zip.apply(hx,e)
};
hx.keys=function(ir){var iq=[];
for(var e in ir){iq.push(e)
}return iq
};
hx.values=function(ir){var e=[];
for(var iq in ir){e.push(ir[iq])
}return e
};
hx.entries=function(ir){var e=[];
for(var iq in ir){e.push({key:iq,value:ir[iq]})
}return e
};
hx.merge=function(iu){var iw=iu.length,iq,it=-1,ir=0,e,iv;
while(++it<iw){ir+=iu[it].length
}e=new Array(ir);
while(--iw>=0){iv=iu[iw];
iq=iv.length;
while(--iq>=0){e[--ir]=iv[iq]
}}return e
};
var cM=Math.abs;
hx.range=function(iw,iu,iv){if(arguments.length<3){iv=1;
if(arguments.length<2){iu=iw;
iw=0
}}if((iu-iw)/iv===Infinity){throw new Error("infinite range")
}var iq=[],e=gw(cM(iv)),it=-1,ir;
iw*=e,iu*=e,iv*=e;
if(iv<0){while((ir=iw+iv*++it)>iu){iq.push(ir/e)
}}else{while((ir=iw+iv*++it)<iu){iq.push(ir/e)
}}return iq
};
function gw(e){var iq=1;
while(e*iq%1){iq*=10
}return iq
}function ie(it,ir){try{for(var iq in ir){Object.defineProperty(it.prototype,iq,{value:ir[iq],enumerable:false})
}}catch(iu){it.prototype=ir
}}hx.map=function(e){var ir=new aM();
if(e instanceof aM){e.forEach(function(it,iu){ir.set(it,iu)
})
}else{for(var iq in e){ir.set(iq,e[iq])
}}return ir
};
function aM(){}ie(aM,{has:function(e){return ih+e in this
},get:function(e){return this[ih+e]
},set:function(e,iq){return this[ih+e]=iq
},remove:function(e){e=ih+e;
return e in this&&delete this[e]
},keys:function(){var e=[];
this.forEach(function(iq){e.push(iq)
});
return e
},values:function(){var e=[];
this.forEach(function(iq,ir){e.push(ir)
});
return e
},entries:function(){var e=[];
this.forEach(function(iq,ir){e.push({key:iq,value:ir})
});
return e
},forEach:function(iq){for(var e in this){if(e.charCodeAt(0)===dL){iq.call(this,e.substring(1),this[e])
}}}});
var ih="\x00",dL=ih.charCodeAt(0);
hx.nest=function(){var it={},ir=[],iw=[],iq,iu;
function iv(iy,iF,iD){if(iD>=ir.length){return iu?iu.call(it,iF):iq?iF.sort(iq):iF
}var iE=-1,ix=iF.length,iH=ir[iD++],iC,iB,iA,iz=new aM(),iG;
while(++iE<ix){if(iG=iz.get(iC=iH(iB=iF[iE]))){iG.push(iB)
}else{iz.set(iC,[iB])
}}if(iy){iB=iy();
iA=function(iJ,iI){iB.set(iJ,iv(iy,iI,iD))
}
}else{iB={};
iA=function(iJ,iI){iB[iJ]=iv(iy,iI,iD)
}
}iz.forEach(iA);
return iB
}function e(iy,iz){if(iz>=ir.length){return iy
}var iA=[],ix=iw[iz++];
iy.forEach(function(iB,iC){iA.push({key:iB,values:e(iC,iz)})
});
return ix?iA.sort(function(iC,iB){return ix(iC.key,iB.key)
}):iA
}it.map=function(iy,ix){return iv(ix,iy,0)
};
it.entries=function(ix){return e(iv(hx.map,ix,0),0)
};
it.key=function(ix){ir.push(ix);
return it
};
it.sortKeys=function(ix){iw[ir.length-1]=ix;
return it
};
it.sortValues=function(ix){iq=ix;
return it
};
it.rollup=function(ix){iu=ix;
return it
};
return it
};
hx.set=function(it){var ir=new dz();
if(it){for(var e=0,iq=it.length;
e<iq;
++e){ir.add(it[e])
}}return ir
};
function dz(){}ie(dz,{has:function(e){return ih+e in this
},add:function(e){this[ih+e]=true;
return e
},remove:function(e){e=ih+e;
return e in this&&delete this[e]
},values:function(){var e=[];
this.forEach(function(iq){e.push(iq)
});
return e
},forEach:function(iq){for(var e in this){if(e.charCodeAt(0)===dL){iq.call(this,e.substring(1))
}}}});
hx.behavior={};
hx.rebind=function(ir,iq){var e=1,iu=arguments.length,it;
while(++e<iu){ir[it=arguments[e]]=eI(ir,iq,iq[it])
}return ir
};
function eI(iq,e,ir){return function(){var it=ir.apply(e,arguments);
return it===e?iq:it
}
}function dq(ir,iq){if(iq in ir){return iq
}iq=iq.charAt(0).toUpperCase()+iq.substring(1);
for(var it=0,iu=P.length;
it<iu;
++it){var e=P[it]+iq;
if(e in ir){return e
}}}var P=["webkit","ms","moz","Moz","o","O"];
function aL(){}hx.dispatch=function(){var e=new e4(),iq=-1,ir=arguments.length;
while(++iq<ir){e[arguments[iq]]=fv(e)
}return e
};
function e4(){}e4.prototype.on=function(ir,it){var iq=ir.indexOf("."),e="";
if(iq>=0){e=ir.substring(iq+1);
ir=ir.substring(0,iq)
}if(ir){return arguments.length<2?this[ir].on(e):this[ir].on(e,it)
}if(arguments.length===2){if(it==null){for(ir in this){if(this.hasOwnProperty(ir)){this[ir].on(e,null)
}}}return this
}};
function fv(e){var ir=[],iq=new aM();
function it(){var iw=ir,iv=-1,ix=iw.length,iu;
while(++iv<ix){if(iu=iw[iv].on){iu.apply(this,arguments)
}}return e
}it.on=function(iv,ix){var iu=iq.get(iv),iw;
if(arguments.length<2){return iu&&iu.on
}if(iu){iu.on=null;
ir=ir.slice(0,iw=ir.indexOf(iu)).concat(ir.slice(iw+1));
iq.remove(iv)
}if(ix){ir.push(iq.set(iv,{on:ix}))
}return e
};
return it
}hx.event=null;
function w(){hx.event.preventDefault()
}function ak(){var ir=hx.event,iq;
while(iq=ir.sourceEvent){ir=iq
}return ir
}function hs(ir){var e=new e4(),iq=0,it=arguments.length;
while(++iq<it){e[arguments[iq]]=fv(e)
}e.of=function(iv,iu){return function(iw){try{var ix=iw.sourceEvent=hx.event;
iw.target=ir;
hx.event=iw;
e[iw.type].apply(iv,iu)
}finally{hx.event=ix
}}
};
return e
}hx.requote=function(e){return e.replace(dg,"\\$&")
};
var dg=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;
var ii={}.__proto__?function(iq,e){iq.__proto__=e
}:function(iq,e){for(var ir in e){iq[ir]=e[ir]
}};
function d9(e){ii(e,d8);
return e
}var dy=function(e,iq){return iq.querySelector(e)
},gk=function(e,iq){return iq.querySelectorAll(e)
},c=ei[dq(ei,"matchesSelector")],a=function(iq,e){return c.call(iq,e)
};
if(typeof Sizzle==="function"){dy=function(e,iq){return Sizzle(e,iq)[0]||null
};
gk=function(e,iq){return Sizzle.uniqueSort(Sizzle(e,iq))
};
a=Sizzle.matchesSelector
}hx.selection=function(){return g3
};
var d8=hx.selection.prototype=[];
d8.select=function(iv){var ir=[],iz,e,iy,it;
iv=B(iv);
for(var iw=-1,iu=this.length;
++iw<iu;
){ir.push(iz=[]);
iz.parentNode=(iy=this[iw]).parentNode;
for(var ix=-1,iq=iy.length;
++ix<iq;
){if(it=iy[ix]){iz.push(e=iv.call(it,it.__data__,ix,iw));
if(e&&"__data__" in it){e.__data__=it.__data__
}}else{iz.push(null)
}}}return d9(ir)
};
function B(e){return typeof e==="function"?e:function(){return dy(e,this)
}
}d8.selectAll=function(iu){var iq=[],iy,ir;
iu=c8(iu);
for(var iv=-1,it=this.length;
++iv<it;
){for(var ix=this[iv],iw=-1,e=ix.length;
++iw<e;
){if(ir=ix[iw]){iq.push(iy=dX(iu.call(ir,ir.__data__,iw,iv)));
iy.parentNode=ir
}}}return d9(iq)
};
function c8(e){return typeof e==="function"?e:function(){return gk(e,this)
}
}var ep={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};
hx.ns={prefix:ep,qualify:function(e){var iq=e.indexOf(":"),ir=e;
if(iq>=0){ir=e.substring(0,iq);
e=e.substring(iq+1)
}return ep.hasOwnProperty(ir)?{space:ep[ir],local:e}:e
}};
d8.attr=function(e,ir){if(arguments.length<2){if(typeof e==="string"){var iq=this.node();
e=hx.ns.qualify(e);
return e.local?iq.getAttributeNS(e.space,e.local):iq.getAttribute(e)
}for(ir in e){this.each(bw(ir,e[ir]))
}return this
}return this.each(bw(e,ir))
};
function bw(ir,iw){ir=hx.ns.qualify(ir);
function iq(){this.removeAttribute(ir)
}function ix(){this.removeAttributeNS(ir.space,ir.local)
}function iv(){this.setAttribute(ir,iw)
}function iu(){this.setAttributeNS(ir.space,ir.local,iw)
}function e(){var iy=iw.apply(this,arguments);
if(iy==null){this.removeAttribute(ir)
}else{this.setAttribute(ir,iy)
}}function it(){var iy=iw.apply(this,arguments);
if(iy==null){this.removeAttributeNS(ir.space,ir.local)
}else{this.setAttributeNS(ir.space,ir.local,iy)
}}return iw==null?ir.local?ix:iq:typeof iw==="function"?ir.local?it:e:ir.local?iu:iv
}function cN(e){return e.trim().replace(/\s+/g," ")
}d8.classed=function(e,it){if(arguments.length<2){if(typeof e==="string"){var ir=this.node(),iu=(e=gH(e)).length,iq=-1;
if(it=ir.classList){while(++iq<iu){if(!it.contains(e[iq])){return false
}}}else{it=ir.getAttribute("class");
while(++iq<iu){if(!gZ(e[iq]).test(it)){return false
}}}return true
}for(it in e){this.each(gQ(it,e[it]))
}return this
}return this.each(gQ(e,it))
};
function gZ(e){return new RegExp("(?:^|\\s+)"+hx.requote(e)+"(?:\\s+|$)","g")
}function gH(e){return e.trim().split(/^|\s+/)
}function gQ(iq,it){iq=gH(iq).map(id);
var iu=iq.length;
function e(){var iv=-1;
while(++iv<iu){iq[iv](this,it)
}}function ir(){var iw=-1,iv=it.apply(this,arguments);
while(++iw<iu){iq[iw](this,iv)
}}return typeof it==="function"?ir:e
}function id(e){var iq=gZ(e);
return function(ir,it){if(iu=ir.classList){return it?iu.add(e):iu.remove(e)
}var iu=ir.getAttribute("class")||"";
if(it){iq.lastIndex=0;
if(!iq.test(iu)){ir.setAttribute("class",cN(iu+" "+e))
}}else{ir.setAttribute("class",cN(iu.replace(iq," ")))
}}
}d8.style=function(e,ir,iq){var it=arguments.length;
if(it<3){if(typeof e!=="string"){if(it<2){ir=""
}for(iq in e){this.each(f0(iq,e[iq],ir))
}return this
}if(it<2){return fN.getComputedStyle(this.node(),null).getPropertyValue(e)
}iq=""
}return this.each(f0(e,ir,iq))
};
function f0(ir,iv,it){function iq(){this.style.removeProperty(ir)
}function iu(){this.style.setProperty(ir,iv,it)
}function e(){var iw=iv.apply(this,arguments);
if(iw==null){this.style.removeProperty(ir)
}else{this.style.setProperty(ir,iw,it)
}}return iv==null?iq:typeof iv==="function"?e:iu
}d8.property=function(e,iq){if(arguments.length<2){if(typeof e==="string"){return this.node()[e]
}for(iq in e){this.each(hQ(iq,e[iq]))
}return this
}return this.each(hQ(e,iq))
};
function hQ(iq,it){function e(){delete this[iq]
}function ir(){this[iq]=it
}function iu(){var iv=it.apply(this,arguments);
if(iv==null){delete this[iq]
}else{this[iq]=iv
}}return it==null?e:typeof it==="function"?iu:ir
}d8.text=function(e){return arguments.length?this.each(typeof e==="function"?function(){var iq=e.apply(this,arguments);
this.textContent=iq==null?"":iq
}:e==null?function(){this.textContent=""
}:function(){this.textContent=e
}):this.node().textContent
};
d8.html=function(e){return arguments.length?this.each(typeof e==="function"?function(){var iq=e.apply(this,arguments);
this.innerHTML=iq==null?"":iq
}:e==null?function(){this.innerHTML=""
}:function(){this.innerHTML=e
}):this.node().innerHTML
};
d8.append=function(e){e=aH(e);
return this.select(function(){return this.appendChild(e.apply(this,arguments))
})
};
function aH(e){return typeof e==="function"?e:(e=hx.ns.qualify(e)).local?function(){return this.ownerDocument.createElementNS(e.space,e.local)
}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,e)
}
}d8.insert=function(e,iq){e=aH(e);
iq=B(iq);
return this.select(function(){return this.insertBefore(e.apply(this,arguments),iq.apply(this,arguments)||null)
})
};
d8.remove=function(){return this.each(function(){var e=this.parentNode;
if(e){e.removeChild(this)
}})
};
d8.data=function(ix,iz){var iu=-1,iq=this.length,iy,ir;
if(!arguments.length){ix=new Array(iq=(iy=this[0]).length);
while(++iu<iq){if(ir=iy[iu]){ix[iu]=ir.__data__
}}return ix
}function iv(iJ,iE){var iG,iB=iJ.length,iD=iE.length,iI=Math.min(iB,iD),iN=new Array(iD),iK=new Array(iD),iH=new Array(iB),iC,iA;
if(iz){var iO=new aM(),iL=new aM(),iM=[],iF;
for(iG=-1;
++iG<iB;
){iF=iz.call(iC=iJ[iG],iC.__data__,iG);
if(iO.has(iF)){iH[iG]=iC
}else{iO.set(iF,iC)
}iM.push(iF)
}for(iG=-1;
++iG<iD;
){iF=iz.call(iE,iA=iE[iG],iG);
if(iC=iO.get(iF)){iN[iG]=iC;
iC.__data__=iA
}else{if(!iL.has(iF)){iK[iG]=Q(iA)
}}iL.set(iF,iA);
iO.remove(iF)
}for(iG=-1;
++iG<iB;
){if(iO.has(iM[iG])){iH[iG]=iJ[iG]
}}}else{for(iG=-1;
++iG<iI;
){iC=iJ[iG];
iA=iE[iG];
if(iC){iC.__data__=iA;
iN[iG]=iC
}else{iK[iG]=Q(iA)
}}for(;
iG<iD;
++iG){iK[iG]=Q(iE[iG])
}for(;
iG<iB;
++iG){iH[iG]=iJ[iG]
}}iK.update=iN;
iK.parentNode=iN.parentNode=iH.parentNode=iJ.parentNode;
iw.push(iK);
it.push(iN);
e.push(iH)
}var iw=bX([]),it=d9([]),e=d9([]);
if(typeof ix==="function"){while(++iu<iq){iv(iy=this[iu],ix.call(iy,iy.parentNode.__data__,iu))
}}else{while(++iu<iq){iv(iy=this[iu],ix)
}}it.enter=function(){return iw
};
it.exit=function(){return e
};
return it
};
function Q(e){return{__data__:e}
}d8.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")
};
d8.filter=function(e){var ir=[],iy,ix,it;
if(typeof e!=="function"){e=bc(e)
}for(var iv=0,iu=this.length;
iv<iu;
iv++){ir.push(iy=[]);
iy.parentNode=(ix=this[iv]).parentNode;
for(var iw=0,iq=ix.length;
iw<iq;
iw++){if((it=ix[iw])&&e.call(it,it.__data__,iw,iv)){iy.push(it)
}}}return d9(ir)
};
function bc(e){return function(){return a(this,e)
}
}d8.order=function(){for(var iq=-1,e=this.length;
++iq<e;
){for(var iv=this[iq],ir=iv.length-1,it=iv[ir],iu;
--ir>=0;
){if(iu=iv[ir]){if(it&&it!==iu.nextSibling){it.parentNode.insertBefore(iu,it)
}it=iu
}}}return this
};
d8.sort=function(iq){iq=gX.apply(this,arguments);
for(var ir=-1,e=this.length;
++ir<e;
){this[ir].sort(iq)
}return this.order()
};
function gX(e){if(!arguments.length){e=hx.ascending
}return function(ir,iq){return ir&&iq?e(ir.__data__,iq.__data__):!ir-!iq
}
}d8.each=function(e){return cO(this,function(it,ir,iq){e.call(it,it.__data__,ir,iq)
})
};
function cO(iq,ix){for(var ir=0,e=iq.length;
ir<e;
ir++){for(var iv=iq[ir],it=0,iw=iv.length,iu;
it<iw;
it++){if(iu=iv[it]){ix(iu,it,ir)
}}}return iq
}d8.call=function(iq){var e=dX(arguments);
iq.apply(e[0]=this,e);
return this
};
d8.empty=function(){return !this.node()
};
d8.node=function(){for(var iq=0,e=this.length;
iq<e;
iq++){for(var iu=this[iq],ir=0,iv=iu.length;
ir<iv;
ir++){var it=iu[ir];
if(it){return it
}}}return null
};
d8.size=function(){var e=0;
this.each(function(){++e
});
return e
};
function bX(e){ii(e,fi);
return e
}var fi=[];
hx.selection.enter=bX;
hx.selection.enter.prototype=fi;
fi.append=d8.append;
fi.empty=d8.empty;
fi.node=d8.node;
fi.call=d8.call;
fi.size=d8.size;
fi.select=function(iv){var ir=[],iA,e,iy,iz,iu;
for(var iw=-1,it=this.length;
++iw<it;
){iy=(iz=this[iw]).update;
ir.push(iA=[]);
iA.parentNode=iz.parentNode;
for(var ix=-1,iq=iz.length;
++ix<iq;
){if(iu=iz[ix]){iA.push(iy[ix]=e=iv.call(iz.parentNode,iu.__data__,ix,iw));
e.__data__=iu.__data__
}else{iA.push(null)
}}}return d9(ir)
};
fi.insert=function(e,iq){if(arguments.length<2){iq=gG(this)
}return d8.insert.call(this,e,iq)
};
function gG(ir){var e,iq;
return function(ix,iu,it){var iw=ir[it].update,iy=iw.length,iv;
if(it!=iq){iq=it,e=0
}if(iu>=e){e=iu+1
}while(!(iv=iw[e])&&++e<iy){}return iv
}
}d8.transition=function(){var e=ax||++hl,ir=[],iz,it,ix=ef||{time:Date.now(),ease:aB,delay:0,duration:250};
for(var iv=-1,iu=this.length;
++iv<iu;
){ir.push(iz=[]);
for(var iy=this[iv],iw=-1,iq=iy.length;
++iw<iq;
){if(it=iy[iw]){fQ(it,iw,e,ix)
}iz.push(it)
}}return g1(ir,e)
};
d8.interrupt=function(){return this.each(c1)
};
function c1(){var e=this.__transition__;
if(e){++e.active
}}hx.select=function(e){var iq=[typeof e==="string"?dy(e,bQ):e];
iq.parentNode=ei;
return d9([iq])
};
hx.selectAll=function(e){var iq=dX(typeof e==="string"?gk(e,bQ):e);
iq.parentNode=ei;
return d9([iq])
};
var g3=hx.select(ei);
d8.on=function(iq,ir,e){var it=arguments.length;
if(it<3){if(typeof iq!=="string"){if(it<2){ir=false
}for(e in iq){this.each(l(e,iq[e],ir))
}return this
}if(it<2){return(it=this.node()["__on"+iq])&&it._
}e=false
}return this.each(l(iq,ir,e))
};
function l(iy,it,iz){var e="__on"+iy,iv=iy.indexOf("."),iq=fE;
if(iv>0){iy=iy.substring(0,iv)
}var ir=bN.get(iy);
if(ir){iy=ir,iq=aw
}function iu(){var iA=this[e];
if(iA){this.removeEventListener(iy,iA,iA.$);
delete this[e]
}}function ix(){var iA=iq(it,dX(arguments));
iu.call(this);
this.addEventListener(iy,this[e]=iA,iA.$=iz);
iA._=it
}function iw(){var iD=new RegExp("^__on([^.]+)"+hx.requote(iy)+"$"),iC;
for(var iB in this){if(iC=iB.match(iD)){var iA=this[iB];
this.removeEventListener(iC[1],iA,iA.$);
delete this[iB]
}}}return iv?it?ix:iu:it?aL:iw
}var bN=hx.map({mouseenter:"mouseover",mouseleave:"mouseout"});
bN.forEach(function(e){if("on"+e in bQ){bN.remove(e)
}});
function fE(iq,e){return function(ir){var it=hx.event;
hx.event=ir;
e[0]=this.__data__;
try{iq.apply(this,e)
}finally{hx.event=it
}}
}function aw(ir,e){var iq=fE(ir,e);
return function(iv){var iu=this,it=iv.relatedTarget;
if(!it||it!==iu&&!(it.compareDocumentPosition(iu)&8)){iq.call(iu,iv)
}}
}var ce="onselectstart" in bQ?null:dq(ei.style,"userSelect"),gV=0;
function bO(){var ir=".dragsuppress-"+ ++gV,iu="click"+ir,iq=hx.select(fN).on("touchmove"+ir,w).on("dragstart"+ir,w).on("selectstart"+ir,w);
if(ce){var it=ei.style,e=it[ce];
it[ce]="none"
}return function(iv){iq.on(ir,null);
if(ce){it[ce]=e
}if(iv){function iw(){iq.on(iu,null)
}iq.on(iu,function(){w();
iw()
},true);
setTimeout(iw,0)
}}
}hx.mouse=function(e){return a2(e,ak())
};
var cK=/WebKit/.test(fN.navigator.userAgent)?-1:0;
function a2(it,iw){if(iw.changedTouches){iw=iw.changedTouches[0]
}var iu=it.ownerSVGElement||it;
if(iu.createSVGPoint){var iq=iu.createSVGPoint();
if(cK<0&&(fN.scrollX||fN.scrollY)){iu=hx.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");
var ir=iu[0][0].getScreenCTM();
cK=!(ir.f||ir.e);
iu.remove()
}if(cK){iq.x=iw.pageX,iq.y=iw.pageY
}else{iq.x=iw.clientX,iq.y=iw.clientY
}iq=iq.matrixTransform(it.getScreenCTM().inverse());
return[iq.x,iq.y]
}var iv=it.getBoundingClientRect();
return[iw.clientX-iv.left-it.clientLeft,iw.clientY-iv.top-it.clientTop]
}hx.touches=function(e,iq){if(arguments.length<2){iq=ak().touches
}return iq?dX(iq).map(function(it){var ir=a2(e,it);
ir.identifier=it.identifier;
return ir
}):[]
};
hx.behavior.drag=function(){var iu=hs(it,"drag","dragstart","dragend"),e=null,iq=ir(aL,hx.mouse,"mousemove","mouseup"),ix=ir(iw,iv,"touchmove","touchend");
function it(){this.on("mousedown.drag",iq).on("touchstart.drag",ix)
}function iw(){return hx.event.changedTouches[0].identifier
}function iv(iy,iz){return hx.touches(iy).filter(function(iA){return iA.identifier===iz
})[0]
}function ir(iB,iy,iA,iz){return function(){var iG=this,iN=iG.parentNode,iO=iu.of(iG,arguments),iM=hx.event.target,iC=iB(),iE=iC==null?"drag":"drag-"+iC,iH=iy(iN,iC),iJ=0,iD,iL=hx.select(fN).on(iA+"."+iE,iI).on(iz+"."+iE,iK),iF=bO();
if(e){iD=e.apply(iG,arguments);
iD=[iD.x-iH[0],iD.y-iH[1]]
}else{iD=[0,0]
}iO({type:"dragstart"});
function iI(){var iR=iy(iN,iC),iQ=iR[0]-iH[0],iP=iR[1]-iH[1];
iJ|=iQ|iP;
iH=iR;
iO({type:"drag",x:iR[0]+iD[0],y:iR[1]+iD[1],dx:iQ,dy:iP})
}function iK(){iL.on(iA+"."+iE,null).on(iz+"."+iE,null);
iF(iJ&&hx.event.target===iM);
iO({type:"dragend"})
}}
}it.origin=function(iy){if(!arguments.length){return e
}e=iy;
return it
};
return hx.rebind(it,iu,"on")
};
var gq=Math.PI,gl=2*gq,ez=gq/2,gA=0.000001,eN=gA*gA,O=gq/180,hN=180/gq;
function cc(e){return e>0?1:e<0?-1:0
}function aj(e){return e>1?0:e<-1?gq:Math.acos(e)
}function ch(e){return e>1?ez:e<-1?-ez:Math.asin(e)
}function d6(e){return((e=Math.exp(e))-1/e)/2
}function bG(e){return((e=Math.exp(e))+1/e)/2
}function fH(e){return((e=Math.exp(2*e))-1)/(e+1)
}function aI(e){return(e=Math.sin(e/2))*e
}var go=Math.SQRT2,ag=2,ae=4;
hx.interpolateZoom=function(iq,e){var iB=iq[0],iG=iq[1],iz=iq[2],iA=e[0],iF=e[1],ix=e[2];
var iy=iA-iB,iw=iF-iG,iH=iy*iy+iw*iw,iI=Math.sqrt(iH),iu=(ix*ix-iz*iz+ae*iH)/(2*iz*ag*iI),it=(ix*ix-iz*iz-ae*iH)/(2*ix*ag*iI),iE=Math.log(Math.sqrt(iu*iu+1)-iu),iD=Math.log(Math.sqrt(it*it+1)-it),iC=iD-iE,ir=(iC||Math.log(ix/iz))/go;
function iv(iK){var iL=iK*ir;
if(iC){var iM=bG(iE),iJ=iz/(ag*iI)*(iM*fH(go*iL+iE)-d6(iE));
return[iB+iJ*iy,iG+iJ*iw,iz*iM/bG(go*iL+iE)]
}return[iB+iK*iy,iG+iK*iw,iz*Math.exp(go*iL)]
}iv.duration=ir*1000;
return iv
};
hx.behavior.zoom=function(){var iB={x:0,y:0,k:1},iQ,iS,iF=[960,500],ir=f9,iJ="mousedown.zoom",iR="mousemove.zoom",iK="mouseup.zoom",iG,iO="touchstart.zoom",iy,iL=hs(iq,"zoomstart","zoom","zoomend"),iP,iN,iw,iu;
function iq(iU){iU.on(iJ,it).on(he+".zoom",iC).on(iR,iM).on("dblclick.zoom",iz).on(iO,iv)
}iq.event=function(iU){iU.each(function(){var iW=iL.of(this,arguments),iV=iB;
if(ax){hx.select(this).transition().each("start.zoom",function(){iB=this.__chart__||{x:0,y:0,k:1};
iH(iW)
}).tween("zoom:zoom",function(){var iZ=iF[0],iY=iF[1],iX=iZ/2,i1=iY/2,i0=hx.interpolateZoom([(iX-iB.x)/iB.k,(i1-iB.y)/iB.k,iZ/iB.k],[(iX-iV.x)/iV.k,(i1-iV.y)/iV.k,iZ/iV.k]);
return function(i4){var i2=i0(i4),i3=iZ/i2[2];
this.__chart__=iB={x:iX-i2[0]*i3,y:i1-i2[1]*i3,k:i3};
iE(iW)
}
}).each("end.zoom",function(){iD(iW)
})
}else{this.__chart__=iB;
iH(iW);
iE(iW);
iD(iW)
}})
};
iq.translate=function(iU){if(!arguments.length){return[iB.x,iB.y]
}iB={x:+iU[0],y:+iU[1],k:iB.k};
iA();
return iq
};
iq.scale=function(iU){if(!arguments.length){return iB.k
}iB={x:iB.x,y:iB.y,k:+iU};
iA();
return iq
};
iq.scaleExtent=function(iU){if(!arguments.length){return ir
}ir=iU==null?f9:[+iU[0],+iU[1]];
return iq
};
iq.center=function(iU){if(!arguments.length){return iS
}iS=iU&&[+iU[0],+iU[1]];
return iq
};
iq.size=function(iU){if(!arguments.length){return iF
}iF=iU&&[+iU[0],+iU[1]];
return iq
};
iq.x=function(iU){if(!arguments.length){return iN
}iN=iU;
iP=iU.copy();
iB={x:0,y:0,k:1};
return iq
};
iq.y=function(iU){if(!arguments.length){return iu
}iu=iU;
iw=iU.copy();
iB={x:0,y:0,k:1};
return iq
};
function e(iU){return[(iU[0]-iB.x)/iB.k,(iU[1]-iB.y)/iB.k]
}function iI(iU){return[iU[0]*iB.k+iB.x,iU[1]*iB.k+iB.y]
}function ix(iU){iB.k=Math.max(ir[0],Math.min(ir[1],iU))
}function iT(iV,iU){iU=iI(iU);
iB.x+=iV[0]-iU[0];
iB.y+=iV[1]-iU[1]
}function iA(){if(iN){iN.domain(iP.range().map(function(iU){return(iU-iB.x)/iB.k
}).map(iP.invert))
}if(iu){iu.domain(iw.range().map(function(iU){return(iU-iB.y)/iB.k
}).map(iw.invert))
}}function iH(iU){iU({type:"zoomstart"})
}function iE(iU){iA();
iU({type:"zoom",scale:iB.k,translate:[iB.x,iB.y]})
}function iD(iU){iU({type:"zoomend"})
}function it(){var iW=this,i1=iL.of(iW,arguments),i0=hx.event.target,iY=0,i2=hx.select(fN).on(iR,iX).on(iK,iZ),iU=e(hx.mouse(iW)),iV=bO();
c1.call(iW);
iH(i1);
function iX(){iY=1;
iT(hx.mouse(iW),iU);
iE(i1)
}function iZ(){i2.on(iR,fN===iW?iM:null).on(iK,null);
iV(iY&&hx.event.target===i0);
iD(i1)
}}function iv(){var i0=this,i6=iL.of(i0,arguments),iY={},i2=0,iZ,iU=hx.event.changedTouches[0].identifier,iW="touchmove.zoom-"+iU,i7="touchend.zoom-"+iU,i5=hx.select(fN).on(iW,i3).on(i7,i4),i8=hx.select(i0).on(iJ,null).on(iO,i1),iX=bO();
c1.call(i0);
i1();
iH(i6);
function iV(){var i9=hx.touches(i0);
iZ=iB.k;
i9.forEach(function(ja){if(ja.identifier in iY){iY[ja.identifier]=e(ja)
}});
return i9
}function i1(){var je=hx.event.changedTouches;
for(var jf=0,jc=je.length;
jf<jc;
++jf){iY[je[jf].identifier]=null
}var jg=iV(),jb=Date.now();
if(jg.length===1){if(jb-iy<500){var ja=jg[0],jd=iY[ja.identifier];
ix(iB.k*2);
iT(ja,jd);
w();
iE(i6)
}iy=jb
}else{if(jg.length>1){var ja=jg[0],i9=jg[1],ji=ja[0]-i9[0],jh=ja[1]-i9[1];
i2=ji*ji+jh*jh
}}}function i3(){var jd=hx.touches(i0),jh,jb,jg,ja;
for(var jc=0,i9=jd.length;
jc<i9;
++jc,ja=null){jg=jd[jc];
if(ja=iY[jg.identifier]){if(jb){break
}jh=jg,jb=ja
}}if(ja){var jf=(jf=jg[0]-jh[0])*jf+(jf=jg[1]-jh[1])*jf,je=i2&&Math.sqrt(jf/i2);
jh=[(jh[0]+jg[0])/2,(jh[1]+jg[1])/2];
jb=[(jb[0]+ja[0])/2,(jb[1]+ja[1])/2];
ix(je*iZ)
}iy=null;
iT(jh,jb);
iE(i6)
}function i4(){if(hx.event.touches.length){var jb=hx.event.changedTouches;
for(var ja=0,jc=jb.length;
ja<jc;
++ja){delete iY[jb[ja].identifier]
}for(var i9 in iY){return void iV()
}}i5.on(iW,null).on(i7,null);
i8.on(iJ,it).on(iO,iv);
iX();
iD(i6)
}}function iC(){var iV=iL.of(this,arguments);
if(iG){clearTimeout(iG)
}else{c1.call(this),iH(iV)
}iG=setTimeout(function(){iG=null;
iD(iV)
},50);
w();
var iU=iS||hx.mouse(this);
if(!iQ){iQ=e(iU)
}ix(Math.pow(2,cD()*0.002)*iB.k);
iT(iU,iQ);
iE(iV)
}function iM(){iQ=null
}function iz(){var iW=iL.of(this,arguments),iX=hx.mouse(this),iU=e(iX),iV=Math.log(iB.k)/Math.LN2;
iH(iW);
ix(Math.pow(2,hx.event.shiftKey?Math.ceil(iV)-1:Math.floor(iV)+1));
iT(iX,iU);
iE(iW);
iD(iW)
}return hx.rebind(iq,iL,"on")
};
var f9=[0,Infinity];
var cD,he="onwheel" in bQ?(cD=function(){return -hx.event.deltaY*(hx.event.deltaMode?120:1)
},"wheel"):"onmousewheel" in bQ?(cD=function(){return hx.event.wheelDelta
},"mousewheel"):(cD=function(){return -hx.event.detail
},"MozMousePixelScroll");
function L(){}L.prototype.toString=function(){return this.rgb()+""
};
hx.hsl=function(ir,iq,e){return arguments.length===1?ir instanceof fF?eR(ir.h,ir.s,ir.l):a1(""+ir,gJ,eR):eR(+ir,+iq,+e)
};
function eR(ir,iq,e){return new fF(ir,iq,e)
}function fF(ir,iq,e){this.h=ir;
this.s=iq;
this.l=e
}var eG=fF.prototype=new L();
eG.brighter=function(e){e=Math.pow(0.7,arguments.length?e:1);
return eR(this.h,this.s,this.l/e)
};
eG.darker=function(e){e=Math.pow(0.7,arguments.length?e:1);
return eR(this.h,this.s,e*this.l)
};
eG.rgb=function(){return bk(this.h,this.s,this.l)
};
function bk(iv,iu,e){var it,ir;
iv=isNaN(iv)?0:(iv%=360)<0?iv+360:iv;
iu=isNaN(iu)?0:iu<0?0:iu>1?1:iu;
e=e<0?0:e>1?1:e;
ir=e<=0.5?e*(1+iu):e+iu-e*iu;
it=2*e-ir;
function iq(ix){if(ix>360){ix-=360
}else{if(ix<0){ix+=360
}}if(ix<60){return it+(ir-it)*ix/60
}if(ix<180){return ir
}if(ix<240){return it+(ir-it)*(240-ix)/60
}return it
}function iw(ix){return Math.round(iq(ix)*255)
}return eA(iw(iv+120),iw(iv),iw(iv-120))
}hx.hcl=function(iq,ir,e){return arguments.length===1?iq instanceof cz?bE(iq.h,iq.c,iq.l):iq instanceof de?gT(iq.l,iq.a,iq.b):gT((iq=ea((iq=hx.rgb(iq)).r,iq.g,iq.b)).l,iq.a,iq.b):bE(+iq,+ir,+e)
};
function bE(iq,ir,e){return new cz(iq,ir,e)
}function cz(iq,ir,e){this.h=iq;
this.c=ir;
this.l=e
}var hq=cz.prototype=new L();
hq.brighter=function(e){return bE(this.h,this.c,Math.min(100,this.l+bu*(arguments.length?e:1)))
};
hq.darker=function(e){return bE(this.h,this.c,Math.max(0,this.l-bu*(arguments.length?e:1)))
};
hq.rgb=function(){return bF(this.h,this.c,this.l).rgb()
};
function bF(iq,ir,e){if(isNaN(iq)){iq=0
}if(isNaN(ir)){ir=0
}return cr(e,Math.cos(iq*=O)*ir,Math.sin(iq)*ir)
}hx.lab=function(ir,iq,e){return arguments.length===1?ir instanceof de?cr(ir.l,ir.a,ir.b):ir instanceof cz?bF(ir.l,ir.c,ir.h):ea((ir=hx.rgb(ir)).r,ir.g,ir.b):cr(+ir,+iq,+e)
};
function cr(ir,iq,e){return new de(ir,iq,e)
}function de(ir,iq,e){this.l=ir;
this.a=iq;
this.b=e
}var bu=18;
var bl=0.95047,bj=1,bg=1.08883;
var gL=de.prototype=new L();
gL.brighter=function(e){return cr(Math.min(100,this.l+bu*(arguments.length?e:1)),this.a,this.b)
};
gL.darker=function(e){return cr(Math.max(0,this.l-bu*(arguments.length?e:1)),this.a,this.b)
};
gL.rgb=function(){return aG(this.l,this.a,this.b)
};
function aG(it,ir,iq){var iv=(it+16)/116,e=iv+ir/500,iu=iv-iq/200;
e=hb(e)*bl;
iv=hb(iv)*bj;
iu=hb(iu)*bg;
return eA(d(3.2404542*e-1.5371385*iv-0.4985314*iu),d(-0.969266*e+1.8760108*iv+0.041556*iu),d(0.0556434*e-0.2040259*iv+1.0572252*iu))
}function gT(ir,iq,e){return ir>0?bE(Math.atan2(e,iq)*hN,Math.sqrt(iq*iq+e*e),ir):bE(NaN,NaN,ir)
}function hb(e){return e>0.206893034?e*e*e:(e-4/29)/7.787037
}function gC(e){return e>0.008856?Math.pow(e,1/3):7.787037*e+4/29
}function d(e){return Math.round(255*(e<=0.00304?12.92*e:1.055*Math.pow(e,1/2.4)-0.055))
}hx.rgb=function(ir,iq,e){return arguments.length===1?ir instanceof fl?eA(ir.r,ir.g,ir.b):a1(""+ir,eA,bk):eA(~~ir,~~iq,~~e)
};
function dm(e){return eA(e>>16,e>>8&255,e&255)
}function dD(e){return dm(e)+""
}function eA(ir,iq,e){return new fl(ir,iq,e)
}function fl(ir,iq,e){this.r=ir;
this.g=iq;
this.b=e
}var eS=fl.prototype=new L();
eS.brighter=function(iq){iq=Math.pow(0.7,arguments.length?iq:1);
var iu=this.r,it=this.g,e=this.b,ir=30;
if(!iu&&!it&&!e){return eA(ir,ir,ir)
}if(iu&&iu<ir){iu=ir
}if(it&&it<ir){it=ir
}if(e&&e<ir){e=ir
}return eA(Math.min(255,~~(iu/iq)),Math.min(255,~~(it/iq)),Math.min(255,~~(e/iq)))
};
eS.darker=function(e){e=Math.pow(0.7,arguments.length?e:1);
return eA(~~(e*this.r),~~(e*this.g),~~(e*this.b))
};
eS.hsl=function(){return gJ(this.r,this.g,this.b)
};
eS.toString=function(){return"#"+cB(this.r)+cB(this.g)+cB(this.b)
};
function cB(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)
}function a1(iv,it,iw){var e=0,ir=0,iu=0,iy,ix,iq;
iy=/([a-z]+)\((.*)\)/i.exec(iv);
if(iy){ix=iy[2].split(",");
switch(iy[1]){case"hsl":return iw(parseFloat(ix[0]),parseFloat(ix[1])/100,parseFloat(ix[2])/100);
case"rgb":return it(e7(ix[0]),e7(ix[1]),e7(ix[2]))
}}if(iq=at.get(iv)){return it(iq.r,iq.g,iq.b)
}if(iv!=null&&iv.charAt(0)==="#"){if(iv.length===4){e=iv.charAt(1);
e+=e;
ir=iv.charAt(2);
ir+=ir;
iu=iv.charAt(3);
iu+=iu
}else{if(iv.length===7){e=iv.substring(1,3);
ir=iv.substring(3,5);
iu=iv.substring(5,7)
}}e=parseInt(e,16);
ir=parseInt(ir,16);
iu=parseInt(iu,16)
}return it(e,ir,iu)
}function gJ(e,iu,iw){var ir=Math.min(e/=255,iu/=255,iw/=255),ix=Math.max(e,iu,iw),iv=ix-ir,it,iy,iq=(ix+ir)/2;
if(iv){iy=iq<0.5?iv/(ix+ir):iv/(2-ix-ir);
if(e==ix){it=(iu-iw)/iv+(iu<iw?6:0)
}else{if(iu==ix){it=(iw-e)/iv+2
}else{it=(e-iu)/iv+4
}}it*=60
}else{it=NaN;
iy=iq>0&&iq<1?0:it
}return eR(it,iy,iq)
}function ea(it,ir,iq){it=dK(it);
ir=dK(ir);
iq=dK(iq);
var e=gC((0.4124564*it+0.3575761*ir+0.1804375*iq)/bl),iv=gC((0.2126729*it+0.7151522*ir+0.072175*iq)/bj),iu=gC((0.0193339*it+0.119192*ir+0.9503041*iq)/bg);
return cr(116*iv-16,500*(e-iv),200*(iv-iu))
}function dK(e){return(e/=255)<=0.04045?e/12.92:Math.pow((e+0.055)/1.055,2.4)
}function e7(iq){var e=parseFloat(iq);
return iq.charAt(iq.length-1)==="%"?Math.round(e*2.55):e
}var at=hx.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});
at.forEach(function(e,iq){at.set(e,dm(iq))
});
function X(e){return typeof e==="function"?e:function(){return e
}
}hx.functor=X;
function gx(e){return e
}hx.xhr=ad(gx);
function ad(e){return function(iq,ir,it){if(arguments.length===2&&typeof ir==="function"){it=ir,ir=null
}return ia(iq,ir,e,it)
}
}function ia(e,ir,iu,iy){var iz={},ix=hx.dispatch("beforesend","progress","load","error"),it={},iv=new XMLHttpRequest(),iw=null;
if(fN.XDomainRequest&&!("withCredentials" in iv)&&/^(http(s)?:)?\/\//.test(e)){iv=new XDomainRequest()
}"onload" in iv?iv.onload=iv.onerror=iq:iv.onreadystatechange=function(){iv.readyState>3&&iq()
};
function iq(){var iB=iv.status,iA;
if(!iB&&iv.responseText||iB>=200&&iB<300||iB===304){try{iA=iu.call(iz,iv)
}catch(iC){ix.error.call(iz,iC);
return
}ix.load.call(iz,iA)
}else{ix.error.call(iz,iv)
}}iv.onprogress=function(iA){var iB=hx.event;
hx.event=iA;
try{ix.progress.call(iz,iv)
}finally{hx.event=iB
}};
iz.header=function(iA,iB){iA=(iA+"").toLowerCase();
if(arguments.length<2){return it[iA]
}if(iB==null){delete it[iA]
}else{it[iA]=iB+""
}return iz
};
iz.mimeType=function(iA){if(!arguments.length){return ir
}ir=iA==null?null:iA+"";
return iz
};
iz.responseType=function(iA){if(!arguments.length){return iw
}iw=iA;
return iz
};
iz.response=function(iA){iu=iA;
return iz
};
["get","post"].forEach(function(iA){iz[iA]=function(){return iz.send.apply(iz,[iA].concat(dX(arguments)))
}
});
iz.send=function(iD,iB,iC){if(arguments.length===2&&typeof iB==="function"){iC=iB,iB=null
}iv.open(iD,e,true);
if(ir!=null&&!("accept" in it)){it.accept=ir+",*/*"
}if(iv.setRequestHeader){for(var iA in it){iv.setRequestHeader(iA,it[iA])
}}if(ir!=null&&iv.overrideMimeType){iv.overrideMimeType(ir)
}if(iw!=null){iv.responseType=iw
}if(iC!=null){iz.on("error",iC).on("load",function(iE){iC(null,iE)
})
}ix.beforesend.call(iz,iv);
iv.send(iB==null?null:iB);
return iz
};
iz.abort=function(){iv.abort();
return iz
};
hx.rebind(iz,ix,"on");
return iy==null?iz:iz.get(eh(iy))
}function eh(e){return e.length===1?function(iq,ir){e(iq==null?ir:null)
}:e
}hx.dsv=function(e,iq){var it=new RegExp('["'+e+"\n]"),iv=e.charCodeAt(0);
function ix(iz,iB,iC){if(arguments.length<3){iC=iB,iB=null
}var iA=ia(iz,iq,iB==null?iu:ir(iB),iC);
iA.row=function(iD){return arguments.length?iA.response((iB=iD)==null?iu:ir(iD)):iB
};
return iA
}function iu(iz){return ix.parse(iz.responseText)
}function ir(iz){return function(iA){return ix.parse(iA.responseText,iz)
}
}ix.parse=function(iB,iz){var iA;
return ix.parseRows(iB,function(iE,iD){if(iA){return iA(iE,iD-1)
}var iC=new Function("d","return {"+iE.map(function(iF,iG){return JSON.stringify(iF)+": d["+iG+"]"
}).join(",")+"}");
iA=iz?function(iG,iF){return iz(iC(iG),iF)
}:iC
})
};
ix.parseRows=function(iI,iD){var iA={},iC={},iK=[],iE=iI.length,iH=0,iz=0,iJ,iF;
function iB(){if(iH>=iE){return iC
}if(iF){return iF=false,iA
}var iM=iH;
if(iI.charCodeAt(iM)===34){var iN=iM;
while(iN++<iE){if(iI.charCodeAt(iN)===34){if(iI.charCodeAt(iN+1)!==34){break
}++iN
}}iH=iN+2;
var iO=iI.charCodeAt(iN+1);
if(iO===13){iF=true;
if(iI.charCodeAt(iN+2)===10){++iH
}}else{if(iO===10){iF=true
}}return iI.substring(iM+1,iN).replace(/""/g,'"')
}while(iH<iE){var iO=iI.charCodeAt(iH++),iL=1;
if(iO===10){iF=true
}else{if(iO===13){iF=true;
if(iI.charCodeAt(iH)===10){++iH,++iL
}}else{if(iO!==iv){continue
}}}return iI.substring(iM,iH-iL)
}return iI.substring(iM)
}while((iJ=iB())!==iC){var iG=[];
while(iJ!==iA&&iJ!==iC){iG.push(iJ);
iJ=iB()
}if(iD&&!(iG=iD(iG,iz++))){continue
}iK.push(iG)
}return iK
};
ix.format=function(iB){if(Array.isArray(iB[0])){return ix.formatRows(iB)
}var iA=new dz(),iz=[];
iB.forEach(function(iD){for(var iC in iD){if(!iA.has(iC)){iz.push(iA.add(iC))
}}});
return[iz.map(iw).join(e)].concat(iB.map(function(iC){return iz.map(function(iD){return iw(iC[iD])
}).join(e)
})).join("\n")
};
ix.formatRows=function(iz){return iz.map(iy).join("\n")
};
function iy(iz){return iz.map(iw).join(e)
}function iw(iz){return it.test(iz)?'"'+iz.replace(/\"/g,'""')+'"':iz
}return ix
};
hx.csv=hx.dsv(",","text/csv");
hx.tsv=hx.dsv("	","text/tab-separated-values");
var eb,al,cv,fu,ds,hD=fN[dq(fN,"requestAnimationFrame")]||function(e){setTimeout(e,17)
};
hx.timer=function(iv,e,ir){var iu=arguments.length;
if(iu<2){e=0
}if(iu<3){ir=Date.now()
}var iq=ir+e,it={c:iv,t:iq,f:false,n:null};
if(al){al.n=it
}else{eb=it
}al=it;
if(!cv){fu=clearTimeout(fu);
cv=1;
hD(hE)
}};
function hE(){var iq=bH(),e=ai()-iq;
if(e>24){if(isFinite(e)){clearTimeout(fu);
fu=setTimeout(hE,e)
}cv=0
}else{cv=1;
hD(hE)
}}hx.timer.flush=function(){bH();
ai()
};
function bH(){var e=Date.now();
ds=eb;
while(ds){if(e>=ds.t){ds.f=ds.c(e-ds.t)
}ds=ds.n
}return e
}function ai(){var iq,e=eb,ir=Infinity;
while(e){if(e.f){e=iq?iq.n=e.n:eb=e.n
}else{if(e.t<ir){ir=e.t
}e=(iq=e).n
}}al=iq;
return ir
}var g8=".",ff=",",i=[3,3],bK="$";
var cA=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(dW);
hx.formatPrefix=function(ir,e){var iq=0;
if(ir){if(ir<0){ir*=-1
}if(e){ir=hx.round(ir,er(ir,e))
}iq=1+Math.floor(1e-12+Math.log(ir)/Math.LN10);
iq=Math.max(-24,Math.min(24,Math.floor((iq<=0?iq+1:iq-1)/3)*3))
}return cA[8+iq/3]
};
function dW(ir,iq){var e=Math.pow(10,cM(8-iq)*3);
return{scale:iq>8?function(it){return it/e
}:function(it){return it*e
},symbol:ir}
}hx.round=function(e,iq){return iq?Math.round(e*(iq=Math.pow(10,iq)))/iq:Math.round(e)
};
hx.format=function(iB){var iy=cF.exec(iB),iD=iy[1]||" ",iz=iy[2]||">",iq=iy[3]||"",it=iy[4]||"",iu=iy[5],e=+iy[6],iE=iy[7],ix=iy[8],iA=iy[9],ir=1,iC="",iw=false;
if(ix){ix=+ix.substring(1)
}if(iu||iD==="0"&&iz==="="){iu=iD="0";
iz="=";
if(iE){e-=Math.floor((e-1)/4)
}}switch(iA){case"n":iE=true;
iA="g";
break;
case"%":ir=100;
iC="%";
iA="f";
break;
case"p":ir=100;
iC="%";
iA="r";
break;
case"b":case"o":case"x":case"X":if(it==="#"){it="0"+iA.toLowerCase()
}case"c":case"d":iw=true;
ix=0;
break;
case"s":ir=-1;
iA="r";
break
}if(it==="#"){it=""
}else{if(it==="$"){it=bK
}}if(iA=="r"&&!ix){iA="g"
}if(ix!=null){if(iA=="g"){ix=Math.max(1,Math.min(21,ix))
}else{if(iA=="e"||iA=="f"){ix=Math.max(0,Math.min(20,ix))
}}}iA=z.get(iA)||bq;
var iv=iu&&iE;
return function(iK){if(iw&&iK%1){return""
}var iF=iK<0||iK===0&&1/iK<0?(iK=-iK,"-"):iq;
if(ir<0){var iJ=hx.formatPrefix(iK,ix);
iK=iJ.scale(iK);
iC=iJ.symbol
}else{iK*=ir
}iK=iA(iK,ix);
var iG=iK.lastIndexOf("."),iI=iG<0?iK:iK.substring(0,iG),iM=iG<0?"":g8+iK.substring(iG+1);
if(!iu&&iE){iI=dp(iI)
}var iH=it.length+iI.length+iM.length+(iv?0:iF.length),iL=iH<e?new Array(iH=e-iH+1).join(iD):"";
if(iv){iI=dp(iL+iI)
}iF+=it;
iK=iI+iM;
return(iz==="<"?iF+iK+iL:iz===">"?iL+iF+iK:iz==="^"?iL.substring(0,iH>>=1)+iF+iK+iL.substring(iH):iF+(iv?iK:iL+iK))+iC
}
};
var cF=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;
var z=hx.map({b:function(e){return e.toString(2)
},c:function(e){return String.fromCharCode(e)
},o:function(e){return e.toString(8)
},x:function(e){return e.toString(16)
},X:function(e){return e.toString(16).toUpperCase()
},g:function(e,iq){return e.toPrecision(iq)
},e:function(e,iq){return e.toExponential(iq)
},f:function(e,iq){return e.toFixed(iq)
},r:function(e,iq){return(e=hx.round(e,er(e,iq))).toFixed(Math.max(0,Math.min(20,er(e*(1+1e-15),iq))))
}});
function er(e,iq){return iq-(e?Math.ceil(Math.log(e)/Math.LN10):1)
}function bq(e){return e+""
}var dp=gx;
if(i){var cb=i.length;
dp=function(iu){var ir=iu.length,iq=[],e=0,it=i[0];
while(ir>0&&it>0){iq.push(iu.substring(ir-=it,ir+it));
it=i[e=(e+1)%cb]
}return iq.reverse().join(ff)
}
}hx.geo={};
function fr(){}fr.prototype={s:0,t:0,add:function(e){dx(e,this.t,h0);
dx(h0.s,this.s,this);
if(this.s){this.t+=h0.t
}else{this.s=h0.t
}},reset:function(){this.s=this.t=0
},valueOf:function(){return this.s
}};
var h0=new fr();
function dx(it,ir,iv){var iq=iv.s=it+ir,e=iq-it,iu=iq-e;
iv.t=it-iu+(ir-e)
}hx.geo.stream=function(e,iq){if(e&&C.hasOwnProperty(e.type)){C[e.type](e,iq)
}else{aV(e,iq)
}};
function aV(iq,e){if(iq&&e1.hasOwnProperty(iq.type)){e1[iq.type](iq,e)
}}var C={Feature:function(e,iq){aV(e.geometry,iq)
},FeatureCollection:function(e,it){var ir=e.features,iq=-1,iu=ir.length;
while(++iq<iu){aV(ir[iq].geometry,it)
}}};
var e1={Sphere:function(e,iq){iq.sphere()
},Point:function(e,iq){e=e.coordinates;
iq.point(e[0],e[1],e[2])
},MultiPoint:function(e,ir){var it=e.coordinates,iq=-1,iu=it.length;
while(++iq<iu){e=it[iq],ir.point(e[0],e[1],e[2])
}},LineString:function(e,iq){cs(e.coordinates,iq,0)
},MultiLineString:function(e,ir){var it=e.coordinates,iq=-1,iu=it.length;
while(++iq<iu){cs(it[iq],ir,0)
}},Polygon:function(e,iq){hp(e.coordinates,iq)
},MultiPolygon:function(e,ir){var it=e.coordinates,iq=-1,iu=it.length;
while(++iq<iu){hp(it[iq],ir)
}},GeometryCollection:function(e,it){var ir=e.geometries,iq=-1,iu=ir.length;
while(++iq<iu){aV(ir[iq],it)
}}};
function cs(it,ir,e){var iq=-1,iv=it.length-e,iu;
ir.lineStart();
while(++iq<iv){iu=it[iq],ir.point(iu[0],iu[1],iu[2])
}ir.lineEnd()
}function hp(ir,iq){var e=-1,it=ir.length;
iq.polygonStart();
while(++e<it){cs(ir[e],iq,1)
}iq.polygonEnd()
}hx.geo.area=function(e){bd=0;
hx.geo.stream(e,hv);
return bd
};
var bd,f4=new fr();
var hv={sphere:function(){bd+=4*gq
},point:aL,lineStart:aL,lineEnd:aL,polygonStart:function(){f4.reset();
hv.lineStart=b8
},polygonEnd:function(){var e=2*f4;
bd+=e<0?4*gq+e:e;
hv.lineStart=hv.lineEnd=hv.point=aL
}};
function b8(){var iq,e,it,ir,iu;
hv.point=function(ix,iw){hv.point=iv;
it=(iq=ix)*O,ir=Math.cos(iw=(e=iw)*O/2+gq/4),iu=Math.sin(iw)
};
function iv(ix,iw){ix*=O;
iw=iw*O/2+gq/4;
var iB=ix-it,iD=Math.cos(iw),iC=Math.sin(iw),iz=iu*iC,iA=ir*iD+iz*Math.cos(iB),iy=iz*Math.sin(iB);
f4.add(Math.atan2(iy,iA));
it=ix,ir=iD,iu=iC
}hv.lineEnd=function(){iv(iq,e)
}
}function aA(e){var ir=e[0],iq=e[1],it=Math.cos(iq);
return[it*Math.cos(ir),it*Math.sin(ir),Math.sin(iq)]
}function aD(iq,e){return iq[0]*e[0]+iq[1]*e[1]+iq[2]*e[2]
}function c5(iq,e){return[iq[1]*e[2]-iq[2]*e[1],iq[2]*e[0]-iq[0]*e[2],iq[0]*e[1]-iq[1]*e[0]]
}function cH(iq,e){iq[0]+=e[0];
iq[1]+=e[1];
iq[2]+=e[2]
}function gs(e,iq){return[e[0]*iq,e[1]*iq,e[2]*iq]
}function fy(iq){var e=Math.sqrt(iq[0]*iq[0]+iq[1]*iq[1]+iq[2]*iq[2]);
iq[0]/=e;
iq[1]/=e;
iq[2]/=e
}function il(e){return[Math.atan2(e[1],e[0]),ch(e[2])]
}function e2(iq,e){return cM(iq[0]-e[0])<gA&&cM(iq[1]-e[1])<gA
}hx.geo.bounds=function(){var it,iJ,iq,iH,iu,iB,iD,iv,iy,iw,iz;
var e={point:iE,lineStart:iA,lineEnd:iG,polygonStart:function(){e.point=iF;
e.lineStart=ix;
e.lineEnd=iC;
iy=0;
hv.polygonStart()
},polygonEnd:function(){hv.polygonEnd();
e.point=iE;
e.lineStart=iA;
e.lineEnd=iG;
if(f4<0){it=-(iq=180),iJ=-(iH=90)
}else{if(iy>gA){iH=90
}else{if(iy<-gA){iJ=-90
}}}iz[0]=it,iz[1]=iq
}};
function iE(iN,iM){iw.push(iz=[it=iN,iq=iN]);
if(iM<iJ){iJ=iM
}if(iM>iH){iH=iM
}}function ir(iQ,iW){var iM=aA([iQ*O,iW*O]);
if(iv){var iS=c5(iv,iM),iT=[iS[1],-iS[0],0],iR=c5(iT,iS);
fy(iR);
iR=il(iR);
var iU=iQ-iu,iV=iU>0?1:-1,iN=iR[0]*hN*iV,iP=cM(iU)>180;
if(iP^(iV*iu<iN&&iN<iV*iQ)){var iO=iR[1]*hN;
if(iO>iH){iH=iO
}}else{if(iN=(iN+360)%360-180,iP^(iV*iu<iN&&iN<iV*iQ)){var iO=-iR[1]*hN;
if(iO<iJ){iJ=iO
}}else{if(iW<iJ){iJ=iW
}if(iW>iH){iH=iW
}}}if(iP){if(iQ<iu){if(iI(it,iQ)>iI(it,iq)){iq=iQ
}}else{if(iI(iQ,iq)>iI(it,iq)){it=iQ
}}}else{if(iq>=it){if(iQ<it){it=iQ
}if(iQ>iq){iq=iQ
}}else{if(iQ>iu){if(iI(it,iQ)>iI(it,iq)){iq=iQ
}}else{if(iI(iQ,iq)>iI(it,iq)){it=iQ
}}}}}else{iE(iQ,iW)
}iv=iM,iu=iQ
}function iA(){e.point=ir
}function iG(){iz[0]=it,iz[1]=iq;
e.point=iE;
iv=null
}function iF(iN,iM){if(iv){var iO=iN-iu;
iy+=cM(iO)>180?iO+(iO>0?360:-360):iO
}else{iB=iN,iD=iM
}hv.point(iN,iM);
ir(iN,iM)
}function ix(){hv.lineStart()
}function iC(){iF(iB,iD);
hv.lineEnd();
if(cM(iy)>gA){it=-(iq=180)
}iz[0]=it,iz[1]=iq;
iv=null
}function iI(iN,iM){return(iM-=iN)<0?iM+360:iM
}function iL(iN,iM){return iN[0]-iM[0]
}function iK(iM,iN){return iN[0]<=iN[1]?iN[0]<=iM&&iM<=iN[1]:iM<iN[0]||iN[1]<iM
}return function(iR){iH=iq=-(it=iJ=Infinity);
iw=[];
hx.geo.stream(iR,e);
var iT=iw.length;
if(iT){iw.sort(iL);
for(var iQ=1,iO=iw[0],iN,iM=[iO];
iQ<iT;
++iQ){iN=iw[iQ];
if(iK(iN[0],iO)||iK(iN[1],iO)){if(iI(iO[0],iN[1])>iI(iO[0],iO[1])){iO[1]=iN[1]
}if(iI(iN[0],iO[1])>iI(iO[0],iO[1])){iO[0]=iN[0]
}}else{iM.push(iO=iN)
}}var iS=-Infinity,iP;
for(var iT=iM.length-1,iQ=0,iO=iM[iT],iN;
iQ<=iT;
iO=iN,++iQ){iN=iM[iQ];
if((iP=iI(iO[1],iN[0]))>iS){iS=iP,it=iN[0],iq=iO[1]
}}}iw=iz=null;
return it===Infinity||iJ===Infinity?[[NaN,NaN],[NaN,NaN]]:[[it,iJ],[iq,iH]]
}
}();
hx.geo.centroid=function(ir){en=el=dT=dw=dd=dS=du=db=dR=dt=da=0;
hx.geo.stream(ir,gu);
var iq=dR,iu=dt,it=da,e=iq*iq+iu*iu+it*it;
if(e<eN){iq=dS,iu=du,it=db;
if(el<gA){iq=dT,iu=dw,it=dd
}e=iq*iq+iu*iu+it*it;
if(e<eN){return[NaN,NaN]
}}return[Math.atan2(iu,iq)*hN,ch(it/Math.sqrt(e))*hN]
};
var en,el,dT,dw,dd,dS,du,db,dR,dt,da;
var gu={sphere:aL,point:cd,lineStart:fx,lineEnd:aJ,polygonStart:function(){gu.lineStart=bt
},polygonEnd:function(){gu.lineStart=fx
}};
function cd(iq,e){iq*=O;
var ir=Math.cos(e*=O);
gF(ir*Math.cos(iq),ir*Math.sin(iq),Math.sin(e))
}function gF(e,ir,iq){++en;
dT+=(e-dT)/en;
dw+=(ir-dw)/en;
dd+=(iq-dd)/en
}function fx(){var e,iq,it;
gu.point=function(iv,iu){iv*=O;
var iw=Math.cos(iu*=O);
e=iw*Math.cos(iv);
iq=iw*Math.sin(iv);
it=Math.sin(iu);
gu.point=ir;
gF(e,iq,it)
};
function ir(ix,iw){ix*=O;
var iy=Math.cos(iw*=O),iu=iy*Math.cos(ix),iA=iy*Math.sin(ix),iz=Math.sin(iw),iv=Math.atan2(Math.sqrt((iv=iq*iz-it*iA)*iv+(iv=it*iu-e*iz)*iv+(iv=e*iA-iq*iu)*iv),e*iu+iq*iA+it*iz);
el+=iv;
dS+=iv*(e+(e=iu));
du+=iv*(iq+(iq=iA));
db+=iv*(it+(it=iz));
gF(e,iq,it)
}}function aJ(){gu.point=cd
}function bt(){var iq,e,ir,it,iv;
gu.point=function(ix,iw){iq=ix,e=iw;
gu.point=iu;
ix*=O;
var iy=Math.cos(iw*=O);
ir=iy*Math.cos(ix);
it=iy*Math.sin(ix);
iv=Math.sin(iw);
gF(ir,it,iv)
};
gu.lineEnd=function(){iu(iq,e);
gu.lineEnd=aJ;
gu.point=cd
};
function iu(iB,iI){iB*=O;
var iz=Math.cos(iI*=O),iE=iz*Math.cos(iB),iD=iz*Math.sin(iB),iC=Math.sin(iI),iA=it*iC-iv*iD,iy=iv*iE-ir*iC,ix=ir*iD-it*iE,iw=Math.sqrt(iA*iA+iy*iy+ix*ix),iH=ir*iE+it*iD+iv*iC,iG=iw&&-aj(iH)/iw,iF=Math.atan2(iw,iH);
dR+=iG*iA;
dt+=iG*iy;
da+=iG*ix;
el+=iF;
dS+=iF*(ir+(ir=iE));
du+=iF*(it+(it=iD));
db+=iF*(iv+(iv=iC));
gF(ir,it,iv)
}}function an(){return true
}function cw(iw,iq,iA,iy,it){var iz=[],iu=[];
iw.forEach(function(iI){if((iL=iI.length-1)<=0){return
}var iL,iK=iI[0],iJ=iI[iL];
if(e2(iK,iJ)){it.lineStart();
for(var iH=0;
iH<iL;
++iH){it.point((iK=iI[iH])[0],iK[1])
}it.lineEnd();
return
}var iG=new b(iK,iI,null,true),iF=new b(iK,null,iG,false);
iG.o=iF;
iz.push(iG);
iu.push(iF);
iG=new b(iJ,iI,null,false);
iF=new b(iJ,null,iG,true);
iG.o=iF;
iz.push(iG);
iu.push(iF)
});
iu.sort(iq);
hT(iz);
hT(iu);
if(!iz.length){return
}for(var iv=0,iC=iA,ir=iu.length;
iv<ir;
++iv){iu[iv].e=iC=!iC
}var e=iz[0],iD,iB;
while(1){var ix=e,iE=true;
while(ix.v){if((ix=ix.n)===e){return
}}iD=ix.z;
it.lineStart();
do{ix.v=ix.o.v=true;
if(ix.e){if(iE){for(var iv=0,ir=iD.length;
iv<ir;
++iv){it.point((iB=iD[iv])[0],iB[1])
}}else{iy(ix.x,ix.n.x,1,it)
}ix=ix.n
}else{if(iE){iD=ix.p.z;
for(var iv=iD.length-1;
iv>=0;
--iv){it.point((iB=iD[iv])[0],iB[1])
}}else{iy(ix.x,ix.p.x,-1,it)
}ix=ix.p
}ix=ix.o;
iD=ix.z;
iE=!iE
}while(!ix.v);
it.lineEnd()
}}function hT(iu){if(!(it=iu.length)){return
}var it,ir=0,iq=iu[0],e;
while(++ir<it){iq.n=e=iu[ir];
e.p=iq;
iq=e
}iq.n=e=iu[0];
e.p=iq
}function b(iq,ir,e,it){this.x=iq;
this.z=ir;
this.o=e;
this.e=it;
this.v=false;
this.n=this.p=null
}function et(e,it,iq,ir){return function(iB,iw){var iK=it(iw),iv=iB.invert(ir[0],ir[1]);
var ix={point:iI,lineStart:iE,lineEnd:iA,polygonStart:function(){ix.point=iG;
ix.lineStart=iF;
ix.lineEnd=iJ;
iD=[];
iH=[];
iw.polygonStart()
},polygonEnd:function(){ix.point=iI;
ix.lineStart=iE;
ix.lineEnd=iA;
iD=hx.merge(iD);
var iL=f1(iv,iH);
if(iD.length){cw(iD,d5,iL,iq,iw)
}else{if(iL){iw.lineStart();
iq(null,null,1,iw);
iw.lineEnd()
}}iw.polygonEnd();
iD=iH=null
},sphere:function(){iw.polygonStart();
iw.lineStart();
iq(null,null,1,iw);
iw.lineEnd();
iw.polygonEnd()
}};
function iI(iN,iM){var iL=iB(iN,iM);
if(e(iN=iL[0],iM=iL[1])){iw.point(iN,iM)
}}function iC(iN,iM){var iL=iB(iN,iM);
iK.point(iL[0],iL[1])
}function iE(){ix.point=iC;
iK.lineStart()
}function iA(){ix.point=iI;
iK.lineEnd()
}var iD;
var iz=V(),iu=it(iz),iH,iy;
function iG(iN,iM){iy.push([iN,iM]);
var iL=iB(iN,iM);
iu.point(iL[0],iL[1])
}function iF(){iu.lineStart();
iy=[]
}function iJ(){iG(iy[0][0],iy[0][1]);
iu.lineEnd();
var iN=iu.clean(),iP=iz.buffer(),iO,iQ=iP.length;
iy.pop();
iH.push(iy);
iy=null;
if(!iQ){return
}if(iN&1){iO=iP[0];
var iQ=iO.length-1,iM=-1,iL;
iw.lineStart();
while(++iM<iQ){iw.point((iL=iO[iM])[0],iL[1])
}iw.lineEnd();
return
}if(iQ>1&&iN&2){iP.push(iP.pop().concat(iP.shift()))
}iD.push(iP.filter(eX))
}return ix
}
}function eX(e){return e.length>1
}function V(){var iq=[],e;
return{lineStart:function(){iq.push(e=[])
},point:function(it,ir){e.push([it,ir])
},lineEnd:aL,buffer:function(){var ir=iq;
iq=[];
e=null;
return ir
},rejoin:function(){if(iq.length>1){iq.push(iq.pop().concat(iq.shift()))
}}}
}function d5(iq,e){return((iq=iq.x)[0]<0?iq[1]-ez-gA:ez-iq[1])-((e=e.x)[0]<0?e[1]-ez-gA:ez-e[1])
}function f1(iH,iD){var iP=iH[0],iQ=iH[1],e=[Math.sin(iP),-Math.cos(iP),0],iC=0,iN=0;
f4.reset();
for(var iM=0,iE=iD.length;
iM<iE;
++iM){var iy=iD[iM],iG=iy.length;
if(!iG){continue
}var iv=iy[0],ir=iv[0],iO=iv[1]/2+gq/4,ix=Math.sin(iO),iq=Math.cos(iO),iL=1;
while(true){if(iL===iG){iL=0
}iH=iy[iL];
var iF=iH[0],iB=iH[1]/2+gq/4,it=Math.sin(iB),iK=Math.cos(iB),iJ=iF-ir,iu=cM(iJ)>gq,iI=ix*it;
f4.add(Math.atan2(iI*Math.sin(iJ),iq*iK+iI*Math.cos(iJ)));
iC+=iu?iJ+(iJ>=0?gl:-gl):iJ;
if(iu^ir>=iP^iF>=iP){var iz=c5(aA(iv),aA(iH));
fy(iz);
var iA=c5(e,iz);
fy(iA);
var iw=(iu^iJ>=0?-1:1)*ch(iA[2]);
if(iQ>iw||iQ===iw&&(iz[0]||iz[1])){iN+=iu^iJ>=0?1:-1
}}if(!iL++){break
}ir=iF,ix=it,iq=iK,iv=iH
}}return(iC<-gA||iC<gA&&f4<0)^iN&1
}var k=et(an,eO,dk,[-gq,-gq/2]);
function eO(iu){var iq=NaN,e=NaN,it=NaN,ir;
return{lineStart:function(){iu.lineStart();
ir=1
},point:function(iw,iv){var iy=iw>0?gq:-gq,ix=cM(iw-iq);
if(cM(ix-gq)<gA){iu.point(iq,e=(e+iv)/2>0?ez:-ez);
iu.point(it,e);
iu.lineEnd();
iu.lineStart();
iu.point(iy,e);
iu.point(iw,e);
ir=0
}else{if(it!==iy&&ix>=gq){if(cM(iq-it)<gA){iq-=it*gA
}if(cM(iw-iy)<gA){iw-=iy*gA
}e=v(iq,e,iw,iv);
iu.point(it,e);
iu.lineEnd();
iu.lineStart();
iu.point(iy,e);
ir=0
}}iu.point(iq=iw,e=iv);
it=iy
},lineEnd:function(){iu.lineEnd();
iq=e=NaN
},clean:function(){return 2-ir
}}
}function v(iv,iu,it,ir){var iq,e,iw=Math.sin(iv-it);
return cM(iw)>gA?Math.atan((Math.sin(iu)*(e=Math.cos(ir))*Math.sin(it)-Math.sin(ir)*(iq=Math.cos(iu))*Math.sin(iv))/(iq*e*iw)):(iu+ir)/2
}function dk(iv,iu,it,ir){var e;
if(iv==null){e=it*ez;
ir.point(-gq,e);
ir.point(0,e);
ir.point(gq,e);
ir.point(gq,0);
ir.point(gq,-e);
ir.point(0,-e);
ir.point(-gq,-e);
ir.point(-gq,0);
ir.point(-gq,e)
}else{if(cM(iv[0]-iu[0])>gA){var iq=iv[0]<iu[0]?gq:-gq;
e=it*iq/2;
ir.point(-iq,e);
ir.point(0,e);
ir.point(iq,e)
}else{ir.point(iu[0],iu[1])
}}}function aQ(iu){var iv=Math.cos(iu),it=iv>0,iw=cM(iv)>gA,ix=b7(iu,6*O);
return et(ir,iy,ix,it?[0,-iu]:[-gq,iu-gq]);
function ir(iA,iz){return Math.cos(iA)*Math.cos(iz)>iv
}function iy(iE){var iD,iC,iz,iB,iA;
return{lineStart:function(){iB=iz=false;
iA=1
},point:function(iG,iF){var iK=[iG,iF],iJ,iH=ir(iG,iF),iL=it?iH?0:e(iG,iF):iH?e(iG+(iG<0?gq:-gq),iF):0;
if(!iD&&(iB=iz=iH)){iE.lineStart()
}if(iH!==iz){iJ=iq(iD,iK);
if(e2(iD,iJ)||e2(iK,iJ)){iK[0]+=gA;
iK[1]+=gA;
iH=ir(iK[0],iK[1])
}}if(iH!==iz){iA=0;
if(iH){iE.lineStart();
iJ=iq(iK,iD);
iE.point(iJ[0],iJ[1])
}else{iJ=iq(iD,iK);
iE.point(iJ[0],iJ[1]);
iE.lineEnd()
}iD=iJ
}else{if(iw&&iD&&it^iH){var iI;
if(!(iL&iC)&&(iI=iq(iK,iD,true))){iA=0;
if(it){iE.lineStart();
iE.point(iI[0][0],iI[0][1]);
iE.point(iI[1][0],iI[1][1]);
iE.lineEnd()
}else{iE.point(iI[1][0],iI[1][1]);
iE.lineEnd();
iE.lineStart();
iE.point(iI[0][0],iI[0][1])
}}}}if(iH&&(!iD||!e2(iD,iK))){iE.point(iK[0],iK[1])
}iD=iK,iz=iH,iC=iL
},lineEnd:function(){if(iz){iE.lineEnd()
}iD=null
},clean:function(){return iA|(iB&&iz)<<1
}}
}function iq(i0,iZ,iD){var iB=aA(i0),iz=aA(iZ);
var iI=[1,0,0],iF=c5(iB,iz),iL=aD(iF,iF),iY=iF[0],iR=iL-iY*iY;
if(!iR){return !iD&&i0
}var iU=iv*iL/iR,iT=-iv*iY/iR,i1=c5(iI,iF),iS=gs(iI,iU),iQ=gs(iF,iT);
cH(iS,iQ);
var iN=i1,iM=aD(iS,iN),iE=aD(iN,iN),iK=iM*iM-iE*(aD(iS,iS)-1);
if(iK<0){return
}var iO=Math.sqrt(iK),iP=gs(iN,(-iM-iO)/iE);
cH(iP,iS);
iP=il(iP);
if(!iD){return iP
}var iC=i0[0],iA=iZ[0],iW=i0[1],iV=iZ[1],iH;
if(iA<iC){iH=iC,iC=iA,iA=iH
}var iG=iA-iC,i2=cM(iG-gq)<gA,iX=i2||iG<gA;
if(!i2&&iV<iW){iH=iW,iW=iV,iV=iH
}if(iX?i2?iW+iV>0^iP[1]<(cM(iP[0]-iC)<gA?iW:iV):iW<=iP[1]&&iP[1]<=iV:iG>gq^(iC<=iP[0]&&iP[0]<=iA)){var iJ=gs(iN,(-iM+iO)/iE);
cH(iJ,iS);
return[iP,il(iJ)]
}}function e(iA,iz){var iC=it?iu:gq-iu,iB=0;
if(iA<-iC){iB|=1
}else{if(iA>iC){iB|=2
}}if(iz<-iC){iB|=4
}else{if(iz>iC){iB|=8
}}return iB
}}function aq(iq,it,e,ir){return function(iF){var iB=iF.a,iA=iF.b,iv=iB.x,iE=iB.y,iz=iA.x,iy=iA.y,ix=0,iw=1,iD=iz-iv,iC=iy-iE,iu;
iu=iq-iv;
if(!iD&&iu>0){return
}iu/=iD;
if(iD<0){if(iu<ix){return
}if(iu<iw){iw=iu
}}else{if(iD>0){if(iu>iw){return
}if(iu>ix){ix=iu
}}}iu=e-iv;
if(!iD&&iu<0){return
}iu/=iD;
if(iD<0){if(iu>iw){return
}if(iu>ix){ix=iu
}}else{if(iD>0){if(iu<ix){return
}if(iu<iw){iw=iu
}}}iu=it-iE;
if(!iC&&iu>0){return
}iu/=iC;
if(iC<0){if(iu<ix){return
}if(iu<iw){iw=iu
}}else{if(iC>0){if(iu>iw){return
}if(iu>ix){ix=iu
}}}iu=ir-iE;
if(!iC&&iu<0){return
}iu/=iC;
if(iC<0){if(iu>iw){return
}if(iu>ix){ix=iu
}}else{if(iC>0){if(iu<ix){return
}if(iu<iw){iw=iu
}}}if(ix>0){iF.a={x:iv+ix*iD,y:iE+ix*iC}
}if(iw<1){iF.b={x:iv+iw*iD,y:iE+iw*iC}
}return iF
}
}var cP=1000000000;
hx.geo.clipExtent=function(){var ir,iv,iq,it,iw,iu,e={stream:function(ix){if(iw){iw.valid=false
}iw=iu(ix);
iw.valid=true;
return iw
},extent:function(ix){if(!arguments.length){return[[ir,iv],[iq,it]]
}iu=eq(ir=+ix[0][0],iv=+ix[0][1],iq=+ix[1][0],it=+ix[1][1]);
if(iw){iw.valid=false,iw=null
}return e
}};
return e.extent([[0,0],[960,500]])
};
function eq(iq,iu,e,ir){return function(iC){var iy=iC,iI=V(),iz=aq(iq,iu,e,ir),iQ,iJ,iG;
var iU={point:iP,lineStart:iM,lineEnd:iS,polygonStart:function(){iC=iI;
iQ=[];
iJ=[];
iR=true
},polygonEnd:function(){iC=iy;
iQ=hx.merge(iQ);
var iW=iL([iq,ir]),iV=iR&&iW,iX=iQ.length;
if(iV||iX){iC.polygonStart();
if(iV){iC.lineStart();
iH(null,null,1,iC);
iC.lineEnd()
}if(iX){cw(iQ,iv,iW,iH,iC)
}iC.polygonEnd()
}iQ=iJ=iG=null
}};
function iL(iV){var i3=0,iW=iJ.length,i1=iV[1];
for(var iZ=0;
iZ<iW;
++iZ){for(var iY=1,i4=iJ[iZ],iX=i4.length,i2=i4[0],i0;
iY<iX;
++iY){i0=i4[iY];
if(i2[1]<=i1){if(i0[1]>i1&&iD(i2,i0,iV)>0){++i3
}}else{if(i0[1]<=i1&&iD(i2,i0,iV)<0){--i3
}}i2=i0
}}return i3!==0
}function iD(iW,iV,iX){return(iV[0]-iW[0])*(iX[1]-iW[1])-(iX[0]-iW[0])*(iV[1]-iW[1])
}function iH(i0,iZ,iY,iX){var iW=0,iV=0;
if(i0==null||(iW=it(i0,iY))!==(iV=it(iZ,iY))||iw(i0,iZ)<0^iY>0){do{iX.point(iW===0||iW===3?iq:e,iW>1?ir:iu)
}while((iW=(iW+iY+4)%4)!==iV)
}else{iX.point(iZ[0],iZ[1])
}}function iK(iV,iW){return iq<=iV&&iV<=e&&iu<=iW&&iW<=ir
}function iP(iV,iW){if(iK(iV,iW)){iC.point(iV,iW)
}}var iO,iE,iN,iT,iB,iA,iF,iR;
function iM(){iU.point=ix;
if(iJ){iJ.push(iG=[])
}iF=true;
iA=false;
iT=iB=NaN
}function iS(){if(iQ){ix(iO,iE);
if(iN&&iA){iI.rejoin()
}iQ.push(iI.buffer())
}iU.point=iP;
if(iA){iC.lineEnd()
}}function ix(iV,iY){iV=Math.max(-cP,Math.min(cP,iV));
iY=Math.max(-cP,Math.min(cP,iY));
var iX=iK(iV,iY);
if(iJ){iG.push([iV,iY])
}if(iF){iO=iV,iE=iY,iN=iX;
iF=false;
if(iX){iC.lineStart();
iC.point(iV,iY)
}}else{if(iX&&iA){iC.point(iV,iY)
}else{var iW={a:{x:iT,y:iB},b:{x:iV,y:iY}};
if(iz(iW)){if(!iA){iC.lineStart();
iC.point(iW.a.x,iW.a.y)
}iC.point(iW.b.x,iW.b.y);
if(!iX){iC.lineEnd()
}iR=false
}else{if(iX){iC.lineStart();
iC.point(iV,iY);
iR=false
}}}}iT=iV,iB=iY,iA=iX
}return iU
};
function it(iy,ix){return cM(iy[0]-iq)<gA?ix>0?0:3:cM(iy[0]-e)<gA?ix>0?2:1:cM(iy[1]-iu)<gA?ix>0?1:0:ix>0?3:2
}function iv(iy,ix){return iw(iy.x,ix.x)
}function iw(iA,iy){var iz=it(iA,1),ix=it(iy,1);
return iz!==ix?iz-ix:iz===0?iy[1]-iA[1]:iz===1?iA[0]-iy[0]:iz===2?iA[1]-iy[1]:iy[0]-iA[0]
}}function fk(iq,e){function ir(it,iu){return it=iq(it,iu),e(it[0],it[1])
}if(iq.invert&&e.invert){ir.invert=function(it,iu){return it=e.invert(it,iu),it&&iq.invert(it[0],it[1])
}
}return ir
}function b9(it){var ir=0,iq=gq/3,e=fw(it),iu=e(ir,iq);
iu.parallels=function(iv){if(!arguments.length){return[ir/gq*180,iq/gq*180]
}return e(ir=iv[0]*gq/180,iq=iv[1]*gq/180)
};
return iu
}function S(iq,e){var iu=Math.sin(iq),iw=(iu+Math.sin(e))/2,iv=1+iu*(2*iw-iu),it=Math.sqrt(iv)/iw;
function ir(iy,ix){var iz=Math.sqrt(iv-2*iw*Math.sin(ix))/iw;
return[iz*Math.sin(iy*=iw),it-iz*Math.cos(iy)]
}ir.invert=function(ix,iz){var iy=it-iz;
return[Math.atan2(ix,iy)/iw,ch((iv-(ix*ix+iy*iy)*iw*iw)/(2*iw))]
};
return ir
}(hx.geo.conicEqualArea=function(){return b9(S)
}).raw=S;
hx.geo.albers=function(){return hx.geo.conicEqualArea().rotate([96,0]).center([-0.6,38.7]).parallels([29.5,45.5]).scale(1070)
};
hx.geo.albersUsa=function(){var iq=hx.geo.albers();
var iv=hx.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]);
var ir=hx.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]);
var ix,e={point:function(iz,iA){ix=[iz,iA]
}},iu,iw,it;
function iy(iA){var iz=iA[0],iB=iA[1];
ix=null;
(iu(iz,iB),ix)||(iw(iz,iB),ix)||it(iz,iB);
return ix
}iy.invert=function(iC){var iA=iq.scale(),iB=iq.translate(),iz=(iC[0]-iB[0])/iA,iD=(iC[1]-iB[1])/iA;
return(iD>=0.12&&iD<0.234&&iz>=-0.425&&iz<-0.214?iv:iD>=0.166&&iD<0.234&&iz>=-0.214&&iz<-0.115?ir:iq).invert(iC)
};
iy.stream=function(iB){var iA=iq.stream(iB),iC=iv.stream(iB),iz=ir.stream(iB);
return{point:function(iD,iE){iA.point(iD,iE);
iC.point(iD,iE);
iz.point(iD,iE)
},sphere:function(){iA.sphere();
iC.sphere();
iz.sphere()
},lineStart:function(){iA.lineStart();
iC.lineStart();
iz.lineStart()
},lineEnd:function(){iA.lineEnd();
iC.lineEnd();
iz.lineEnd()
},polygonStart:function(){iA.polygonStart();
iC.polygonStart();
iz.polygonStart()
},polygonEnd:function(){iA.polygonEnd();
iC.polygonEnd();
iz.polygonEnd()
}}
};
iy.precision=function(iz){if(!arguments.length){return iq.precision()
}iq.precision(iz);
iv.precision(iz);
ir.precision(iz);
return iy
};
iy.scale=function(iz){if(!arguments.length){return iq.scale()
}iq.scale(iz);
iv.scale(iz*0.35);
ir.scale(iz);
return iy.translate(iq.translate())
};
iy.translate=function(iB){if(!arguments.length){return iq.translate()
}var iA=iq.scale(),iz=+iB[0],iC=+iB[1];
iu=iq.translate(iB).clipExtent([[iz-0.455*iA,iC-0.238*iA],[iz+0.455*iA,iC+0.238*iA]]).stream(e).point;
iw=iv.translate([iz-0.307*iA,iC+0.201*iA]).clipExtent([[iz-0.425*iA+gA,iC+0.12*iA+gA],[iz-0.214*iA-gA,iC+0.234*iA-gA]]).stream(e).point;
it=ir.translate([iz-0.205*iA,iC+0.212*iA]).clipExtent([[iz-0.214*iA+gA,iC+0.166*iA+gA],[iz-0.115*iA-gA,iC+0.234*iA-gA]]).stream(e).point;
return iy
};
return iy.scale(1070)
};
var f2,D,dI={point:aL,lineStart:aL,lineEnd:aL,polygonStart:function(){D=0;
dI.lineStart=cR
},polygonEnd:function(){dI.lineStart=dI.lineEnd=dI.point=aL;
f2+=cM(D/2)
}};
function cR(){var it,e,iq,ir;
dI.point=function(iv,iw){dI.point=iu;
it=iq=iv,e=ir=iw
};
function iu(iv,iw){D+=ir*iv-iq*iw;
iq=iv,ir=iw
}dI.lineEnd=function(){iu(it,e)
}
}var eV,ey,eT,ex;
var aC={point:c0,lineStart:aL,lineEnd:aL,polygonStart:aL,polygonEnd:aL};
function c0(e,iq){if(e<eV){eV=e
}if(e>eT){eT=e
}if(iq<ey){ey=iq
}if(iq>ex){ex=iq
}}function cm(){var ir=hh(4.5),iq=[];
var ix={point:e,lineStart:function(){ix.point=iw
},lineEnd:iv,polygonStart:function(){ix.lineEnd=it
},polygonEnd:function(){ix.lineEnd=iv;
ix.point=e
},pointRadius:function(iy){ir=hh(iy);
return ix
},result:function(){if(iq.length){var iy=iq.join("");
iq=[];
return iy
}}};
function e(iy,iz){iq.push("M",iy,",",iz,ir)
}function iw(iy,iz){iq.push("M",iy,",",iz);
ix.point=iu
}function iu(iy,iz){iq.push("L",iy,",",iz)
}function iv(){ix.point=e
}function it(){iq.push("Z")
}return ix
}function hh(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"
}var hg={point:cV,lineStart:f7,lineEnd:cU,polygonStart:function(){hg.lineStart=b2
},polygonEnd:function(){hg.point=cV;
hg.lineStart=f7;
hg.lineEnd=cU
}};
function cV(e,iq){dT+=e;
dw+=iq;
++dd
}function f7(){var e,iq;
hg.point=function(it,iu){hg.point=ir;
cV(e=it,iq=iu)
};
function ir(it,ix){var iv=it-e,iu=ix-iq,iw=Math.sqrt(iv*iv+iu*iu);
dS+=iw*(e+it)/2;
du+=iw*(iq+ix)/2;
db+=iw;
cV(e=it,iq=ix)
}}function cU(){hg.point=cV
}function b2(){var it,e,iq,ir;
hg.point=function(iv,iw){hg.point=iu;
cV(it=iq=iv,e=ir=iw)
};
function iu(iv,iz){var ix=iv-iq,iw=iz-ir,iy=Math.sqrt(ix*ix+iw*iw);
dS+=iy*(iq+iv)/2;
du+=iy*(ir+iz)/2;
db+=iy;
iy=ir*iv-iq*iz;
dR+=iy*(iq+iv);
dt+=iy*(ir+iz);
da+=iy*3;
cV(iq=iv,ir=iz)
}hg.lineEnd=function(){iu(it,e)
}
}function cL(iq){var iu=4.5;
var ix={point:e,lineStart:function(){ix.point=iw
},lineEnd:iv,polygonStart:function(){ix.lineEnd=ir
},polygonEnd:function(){ix.lineEnd=iv;
ix.point=e
},pointRadius:function(iy){iu=iy;
return ix
},result:aL};
function e(iy,iz){iq.moveTo(iy,iz);
iq.arc(iy,iz,iu,0,gl)
}function iw(iy,iz){iq.moveTo(iy,iz);
ix.point=it
}function it(iy,iz){iq.lineTo(iy,iz)
}function iv(){ix.point=e
}function ir(){iq.closePath()
}return ix
}function f3(iw){var iu=0.5,iv=Math.cos(30*O),ix=16;
function ir(iy){return(ix?it:e)(iy)
}function e(iy){return eQ(iy,function(iz,iA){iz=iw(iz,iA);
iy.point(iz[0],iz[1])
})
}function it(iE){var iJ,iP,iO,iF,iS,iH,iz,iA,iR,iB,iT,iG,iK;
var iC={point:iN,lineStart:iI,lineEnd:iQ,polygonStart:function(){iE.polygonStart();
iC.lineStart=iD
},polygonEnd:function(){iE.polygonEnd();
iC.lineStart=iI
}};
function iN(iU,iV){iU=iw(iU,iV);
iE.point(iU[0],iU[1])
}function iI(){iR=NaN;
iC.point=iy;
iE.lineStart()
}function iy(iV,iU){var iX=aA([iV,iU]),iW=iw(iV,iU);
iq(iR,iB,iA,iT,iG,iK,iR=iW[0],iB=iW[1],iA=iV,iT=iX[0],iG=iX[1],iK=iX[2],ix,iE);
iE.point(iR,iB)
}function iQ(){iC.point=iN;
iE.lineEnd()
}function iD(){iI();
iC.point=iM;
iC.lineEnd=iL
}function iM(iV,iU){iy(iJ=iV,iP=iU),iO=iR,iF=iB,iS=iT,iH=iG,iz=iK;
iC.point=iy
}function iL(){iq(iR,iB,iA,iT,iG,iK,iO,iF,iJ,iS,iH,iz,ix,iE);
iC.lineEnd=iQ;
iQ()
}return iC
}function iq(iT,iE,iA,i0,iH,iP,iS,iD,iz,iY,iG,iN,iX,iF){var iL=iS-iT,iK=iD-iE,iZ=iL*iL+iK*iK;
if(iZ>4*iu&&iX--){var iW=i0+iY,iV=iH+iG,iU=iP+iN,iO=Math.sqrt(iW*iW+iV*iV+iU*iU),iR=Math.asin(iU/=iO),iy=cM(cM(iU)-1)<gA||cM(iA-iz)<gA?(iA+iz)/2:Math.atan2(iV,iW),iM=iw(iy,iR),iQ=iM[0],iC=iM[1],iB=iQ-iT,iJ=iC-iE,iI=iK*iB-iL*iJ;
if(iI*iI/iZ>iu||cM((iL*iB+iK*iJ)/iZ-0.5)>0.3||i0*iY+iH*iG+iP*iN<iv){iq(iT,iE,iA,i0,iH,iP,iQ,iC,iy,iW/=iO,iV/=iO,iU,iX,iF);
iF.point(iQ,iC);
iq(iQ,iC,iy,iW,iV,iU,iS,iD,iz,iY,iG,iN,iX,iF)
}}}ir.precision=function(iy){if(!arguments.length){return Math.sqrt(iu)
}ix=(iu=iy*iy)>0&&16;
return ir
};
return ir
}hx.geo.path=function(){var iw=4.5,iq,it,iu,e,ir;
function ix(iy){if(iy){if(typeof iw==="function"){e.pointRadius(+iw.apply(this,arguments))
}if(!ir||!ir.valid){ir=iu(e)
}hx.geo.stream(iy,ir)
}return e.result()
}ix.area=function(iy){f2=0;
hx.geo.stream(iy,iu(dI));
return f2
};
ix.centroid=function(iy){dT=dw=dd=dS=du=db=dR=dt=da=0;
hx.geo.stream(iy,iu(hg));
return da?[dR/da,dt/da]:db?[dS/db,du/db]:dd?[dT/dd,dw/dd]:[NaN,NaN]
};
ix.bounds=function(iy){eT=ex=-(eV=ey=Infinity);
hx.geo.stream(iy,iu(aC));
return[[eV,ey],[eT,ex]]
};
ix.projection=function(iy){if(!arguments.length){return iq
}iu=(iq=iy)?iy.stream||hr(iy):gx;
return iv()
};
ix.context=function(iy){if(!arguments.length){return it
}e=(it=iy)==null?new cm():new cL(iy);
if(typeof iw!=="function"){e.pointRadius(iw)
}return iv()
};
ix.pointRadius=function(iy){if(!arguments.length){return iw
}iw=typeof iy==="function"?iy:(e.pointRadius(+iy),+iy);
return ix
};
function iv(){ir=null;
return ix
}return ix.projection(hx.geo.albersUsa()).context(null)
};
function hr(iq){var e=f3(function(ir,it){return iq([ir*hN,it*hN])
});
return function(ir){return cj(e(ir))
}
}hx.geo.transform=function(e){return{stream:function(it){var ir=new em(it);
for(var iq in e){ir[iq]=e[iq]
}return ir
}}
};
function em(e){this.stream=e
}em.prototype={point:function(e,iq){this.stream.point(e,iq)
},sphere:function(){this.stream.sphere()
},lineStart:function(){this.stream.lineStart()
},lineEnd:function(){this.stream.lineEnd()
},polygonStart:function(){this.stream.polygonStart()
},polygonEnd:function(){this.stream.polygonEnd()
}};
function eQ(iq,e){return{point:e,sphere:function(){iq.sphere()
},lineStart:function(){iq.lineStart()
},lineEnd:function(){iq.lineEnd()
},polygonStart:function(){iq.polygonStart()
},polygonEnd:function(){iq.polygonEnd()
}}
}hx.geo.projection=fP;
hx.geo.projectionMutator=fw;
function fP(e){return fw(function(){return e
})()
}function fw(iE){var it,iJ,ix,iG=f3(function(iO,iP){iO=it(iO,iP);
return[iO[0]*iI+iv,ir-iO[1]*iI]
}),iI=150,iC=480,iA=250,iH=0,iB=0,iy=0,iu=0,iF=0,iv,ir,iN=k,iK=gx,e=null,iq=null,iw;
function iM(iO){iO=ix(iO[0]*O,iO[1]*O);
return[iO[0]*iI+iv,ir-iO[1]*iI]
}function iD(iO){iO=ix.invert((iO[0]-iv)/iI,(ir-iO[1])/iI);
return iO&&[iO[0]*hN,iO[1]*hN]
}iM.stream=function(iO){if(iw){iw.valid=false
}iw=cj(iN(iJ,iG(iK(iO))));
iw.valid=true;
return iw
};
iM.clipAngle=function(iO){if(!arguments.length){return e
}iN=iO==null?(e=iO,k):aQ((e=+iO)*O);
return iz()
};
iM.clipExtent=function(iO){if(!arguments.length){return iq
}iq=iO;
iK=iO?eq(iO[0][0],iO[0][1],iO[1][0],iO[1][1]):gx;
return iz()
};
iM.scale=function(iO){if(!arguments.length){return iI
}iI=+iO;
return iL()
};
iM.translate=function(iO){if(!arguments.length){return[iC,iA]
}iC=+iO[0];
iA=+iO[1];
return iL()
};
iM.center=function(iO){if(!arguments.length){return[iH*hN,iB*hN]
}iH=iO[0]%360*O;
iB=iO[1]%360*O;
return iL()
};
iM.rotate=function(iO){if(!arguments.length){return[iy*hN,iu*hN,iF*hN]
}iy=iO[0]%360*O;
iu=iO[1]%360*O;
iF=iO.length>2?iO[2]%360*O:0;
return iL()
};
hx.rebind(iM,iG,"precision");
function iL(){ix=fk(iJ=dO(iy,iu,iF),it);
var iO=it(iH,iB);
iv=iC-iO[0]*iI;
ir=iA+iO[1]*iI;
return iz()
}function iz(){if(iw){iw.valid=false,iw=null
}return iM
}return function(){it=iE.apply(this,arguments);
iM.invert=it.invert&&iD;
return iL()
}
}function cj(e){return eQ(e,function(iq,ir){e.point(iq*O,ir*O)
})
}function bA(iq,e){return[iq,e]
}(hx.geo.equirectangular=function(){return fP(bA)
}).raw=bA.invert=bA;
hx.geo.rotation=function(iq){iq=dO(iq[0]%360*O,iq[1]*O,iq.length>2?iq[2]*O:0);
function e(ir){ir=iq(ir[0]*O,ir[1]*O);
return ir[0]*=hN,ir[1]*=hN,ir
}e.invert=function(ir){ir=iq.invert(ir[0]*O,ir[1]*O);
return ir[0]*=hN,ir[1]*=hN,ir
};
return e
};
function bM(iq,e){return[iq>gq?iq-gl:iq<-gq?iq+gl:iq,e]
}bM.invert=bA;
function dO(ir,iq,e){return ir?iq||e?fk(fc(ir),bW(iq,e)):fc(ir):iq||e?bW(iq,e):bM
}function g9(e){return function(ir,iq){return ir+=e,[ir>gq?ir-gl:ir<-gq?ir+gl:ir,iq]
}
}function fc(iq){var e=g9(iq);
e.invert=g9(-iq);
return e
}function bW(iv,iq){var iu=Math.cos(iv),iw=Math.sin(iv),e=Math.cos(iq),ir=Math.sin(iq);
function it(iz,iy){var iB=Math.cos(iy),ix=Math.cos(iz)*iB,iD=Math.sin(iz)*iB,iC=Math.sin(iy),iA=iC*iu+ix*iw;
return[Math.atan2(iD*e-iA*ir,ix*iu-iC*iw),ch(iA*e+iD*ir)]
}it.invert=function(iz,iy){var iB=Math.cos(iy),ix=Math.cos(iz)*iB,iD=Math.sin(iz)*iB,iC=Math.sin(iy),iA=iC*e-iD*ir;
return[Math.atan2(iD*e+iC*ir,ix*iu+iA*iw),ch(iA*iu-ix*iw)]
};
return it
}hx.geo.circle=function(){var iq=[0,0],iu,e=6,ir;
function it(){var iv=typeof iq==="function"?iq.apply(this,arguments):iq,ix=dO(-iv[0]*O,-iv[1]*O,0).invert,iw=[];
ir(null,null,1,{point:function(iy,iz){iw.push(iy=ix(iy,iz));
iy[0]*=hN,iy[1]*=hN
}});
return{type:"Polygon",coordinates:[iw]}
}it.origin=function(iv){if(!arguments.length){return iq
}iq=iv;
return it
};
it.angle=function(iv){if(!arguments.length){return iu
}ir=b7((iu=+iv)*O,e*O);
return it
};
it.precision=function(iv){if(!arguments.length){return e
}ir=b7(iu*O,(e=+iv)*O);
return it
};
return it.angle(90)
};
function b7(e,iq){var it=Math.cos(e),ir=Math.sin(e);
return function(iA,iz,iy,ix){var iw=iy*iq;
if(iA!=null){iA=h3(it,iA);
iz=h3(it,iz);
if(iy>0?iA<iz:iA>iz){iA+=iy*gl
}}else{iA=e+iy*gl;
iz=e-0.5*iw
}for(var iu,iv=iA;
iy>0?iv>iz:iv<iz;
iv-=iw){ix.point((iu=il([it,-ir*Math.cos(iv),-ir*Math.sin(iv)]))[0],iu[1])
}}
}function h3(ir,e){var iq=aA(e);
iq[0]-=ir;
fy(iq);
var it=aj(-iq[1]);
return((-iq[2]<0?-it:it)+2*Math.PI-gA)%(2*Math.PI)
}hx.geo.distance=function(ix,iw){var iy=(iw[0]-ix[0])*O,iA=ix[1]*O,iz=iw[1]*O,iu=Math.sin(iy),iq=Math.cos(iy),iv=Math.sin(iA),ir=Math.cos(iA),it=Math.sin(iz),e=Math.cos(iz),iB;
return Math.atan2(Math.sqrt((iB=e*iu)*iB+(iB=ir*it-iv*e*iq)*iB),iv*it+ir*e*iq)
};
hx.geo.graticule=function(){var iE,iG,iH,iI,it,iu,iv,ix,iC=10,iB=iC,iy=90,iw=360,iA,iz,ir,iq,iD=2.5;
function iF(){return{type:"MultiLineString",coordinates:e()}
}function e(){return hx.range(Math.ceil(iI/iy)*iy,iH,iy).map(ir).concat(hx.range(Math.ceil(ix/iw)*iw,iv,iw).map(iq)).concat(hx.range(Math.ceil(iG/iC)*iC,iE,iC).filter(function(iJ){return cM(iJ%iy)>gA
}).map(iA)).concat(hx.range(Math.ceil(iu/iB)*iB,it,iB).filter(function(iJ){return cM(iJ%iw)>gA
}).map(iz))
}iF.lines=function(){return e().map(function(iJ){return{type:"LineString",coordinates:iJ}
})
};
iF.outline=function(){return{type:"Polygon",coordinates:[ir(iI).concat(iq(iv).slice(1),ir(iH).reverse().slice(1),iq(ix).reverse().slice(1))]}
};
iF.extent=function(iJ){if(!arguments.length){return iF.minorExtent()
}return iF.majorExtent(iJ).minorExtent(iJ)
};
iF.majorExtent=function(iJ){if(!arguments.length){return[[iI,ix],[iH,iv]]
}iI=+iJ[0][0],iH=+iJ[1][0];
ix=+iJ[0][1],iv=+iJ[1][1];
if(iI>iH){iJ=iI,iI=iH,iH=iJ
}if(ix>iv){iJ=ix,ix=iv,iv=iJ
}return iF.precision(iD)
};
iF.minorExtent=function(iJ){if(!arguments.length){return[[iG,iu],[iE,it]]
}iG=+iJ[0][0],iE=+iJ[1][0];
iu=+iJ[0][1],it=+iJ[1][1];
if(iG>iE){iJ=iG,iG=iE,iE=iJ
}if(iu>it){iJ=iu,iu=it,it=iJ
}return iF.precision(iD)
};
iF.step=function(iJ){if(!arguments.length){return iF.minorStep()
}return iF.majorStep(iJ).minorStep(iJ)
};
iF.majorStep=function(iJ){if(!arguments.length){return[iy,iw]
}iy=+iJ[0],iw=+iJ[1];
return iF
};
iF.minorStep=function(iJ){if(!arguments.length){return[iC,iB]
}iC=+iJ[0],iB=+iJ[1];
return iF
};
iF.precision=function(iJ){if(!arguments.length){return iD
}iD=+iJ;
iA=aP(iu,it,90);
iz=aN(iG,iE,iD);
ir=aP(ix,iv,90);
iq=aN(iI,iH,iD);
return iF
};
return iF.majorExtent([[-180,-90+gA],[180,90-gA]]).minorExtent([[-180,-80-gA],[180,80+gA]])
};
function aP(ir,iq,e){var it=hx.range(ir,iq-gA,e).concat(iq);
return function(iu){return it.map(function(iv){return[iu,iv]
})
}
}function aN(it,ir,iq){var e=hx.range(it,ir-gA,iq).concat(ir);
return function(iu){return e.map(function(iv){return[iv,iu]
})
}
}function hS(e){return e.source
}function h1(e){return e.target
}hx.geo.greatArc=function(){var ir=hS,iq,it=h1,iu;
function e(){return{type:"LineString",coordinates:[iq||ir.apply(this,arguments),iu||it.apply(this,arguments)]}
}e.distance=function(){return hx.geo.distance(iq||ir.apply(this,arguments),iu||it.apply(this,arguments))
};
e.source=function(iv){if(!arguments.length){return ir
}ir=iv,iq=typeof iv==="function"?null:iv;
return e
};
e.target=function(iv){if(!arguments.length){return it
}it=iv,iu=typeof iv==="function"?null:iv;
return e
};
e.precision=function(){return arguments.length?e:0
};
return e
};
hx.geo.interpolate=function(e,iq){return g(e[0]*O,e[1]*O,iq[0]*O,iq[1]*O)
};
function g(it,iE,ir,iC){var iw=Math.cos(iE),iD=Math.sin(iE),iu=Math.cos(iC),iB=Math.sin(iC),iy=iw*Math.cos(it),iq=iw*Math.sin(it),ix=iu*Math.cos(ir),e=iu*Math.sin(ir),iA=2*Math.asin(Math.sqrt(aI(iC-iE)+iw*iu*aI(ir-it))),iv=1/Math.sin(iA);
var iz=iA?function(iH){var iK=Math.sin(iH*=iA)*iv,iG=Math.sin(iA-iH)*iv,iF=iG*iy+iK*ix,iJ=iG*iq+iK*e,iI=iG*iD+iK*iB;
return[Math.atan2(iJ,iF)*hN,Math.atan2(iI,Math.sqrt(iF*iF+iJ*iJ))*hN]
}:function(){return[it*hN,iE*hN]
};
iz.distance=iA;
return iz
}hx.geo.length=function(e){d4=0;
hx.geo.stream(e,gb);
return d4
};
var d4;
var gb={sphere:aL,point:aL,lineStart:hV,lineEnd:aL,polygonStart:aL,polygonEnd:aL};
function hV(){var iq,ir,e;
gb.point=function(iv,iu){iq=iv*O,ir=Math.sin(iu*=O),e=Math.cos(iu);
gb.point=it
};
gb.lineEnd=function(){gb.point=gb.lineEnd=aL
};
function it(iv,iu){var iy=Math.sin(iu*=O),iz=Math.cos(iu),iw=cM((iv*=O)-iq),ix=Math.cos(iw);
d4+=Math.atan2(Math.sqrt((iw=iz*Math.sin(iw))*iw+(iw=e*iy-ir*iz*ix)*iw),ir*iy+e*iz*ix);
iq=iv,ir=iy,e=iz
}}function eH(ir,iq){function e(iu,it){var ix=Math.cos(iu),iw=Math.cos(it),iv=ir(ix*iw);
return[iv*iw*Math.sin(iu),iv*Math.sin(it)]
}e.invert=function(it,iy){var iw=Math.sqrt(it*it+iy*iy),ix=iq(iw),iu=Math.sin(ix),iv=Math.cos(ix);
return[Math.atan2(it*iu,iw*iv),Math.asin(iw&&iy*iu/iw)]
};
return e
}var bx=eH(function(e){return Math.sqrt(2/(1+e))
},function(e){return 2*Math.asin(e/2)
});
(hx.geo.azimuthalEqualArea=function(){return fP(bx)
}).raw=bx;
var bL=eH(function(e){var iq=Math.acos(e);
return iq&&iq/Math.sin(iq)
},gx);
(hx.geo.azimuthalEquidistant=function(){return fP(bL)
}).raw=bL;
function fY(ir,iq){var e=Math.cos(ir),iu=function(ix){return Math.tan(gq/4+ix/2)
},iw=ir===iq?Math.sin(ir):Math.log(e/Math.cos(iq))/Math.log(iu(iq)/iu(ir)),iv=e*Math.pow(iu(ir),iw)/iw;
if(!iw){return aY
}function it(iy,ix){var iz=cM(cM(ix)-ez)<gA?0:iv/Math.pow(iu(ix),iw);
return[iz*Math.sin(iw*iy),iv-iz*Math.cos(iw*iy)]
}it.invert=function(ix,iA){var iz=iv-iA,iy=cc(iw)*Math.sqrt(ix*ix+iz*iz);
return[Math.atan2(ix,iz)/iw,2*Math.atan(Math.pow(iv/iy,1/iw))-ez]
};
return it
}(hx.geo.conicConformal=function(){return b9(fY)
}).raw=fY;
function hK(ir,iq){var e=Math.cos(ir),iv=ir===iq?Math.sin(ir):(e-Math.cos(iq))/(iq-ir),iu=e/iv+ir;
if(cM(iv)<gA){return bA
}function it(ix,iw){var iy=iu-iw;
return[iy*Math.sin(iv*ix),iu-iy*Math.cos(iv*ix)]
}it.invert=function(iw,iy){var ix=iu-iy;
return[Math.atan2(iw,ix)/iv,iu-cc(iv)*Math.sqrt(iw*iw+ix*ix)]
};
return it
}(hx.geo.conicEquidistant=function(){return b9(hK)
}).raw=hK;
var eP=eH(function(e){return 1/e
},Math.atan);
(hx.geo.gnomonic=function(){return fP(eP)
}).raw=eP;
function aY(iq,e){return[iq,Math.log(Math.tan(gq/4+e/2))]
}aY.invert=function(e,iq){return[e,2*Math.atan(Math.exp(iq))-ez]
};
function dc(iv){var e=fP(iv),iu=e.scale,it=e.translate,iq=e.clipExtent,ir;
e.scale=function(){var iw=iu.apply(e,arguments);
return iw===e?ir?e.clipExtent(null):e:iw
};
e.translate=function(){var iw=it.apply(e,arguments);
return iw===e?ir?e.clipExtent(null):e:iw
};
e.clipExtent=function(iy){var ix=iq.apply(e,arguments);
if(ix===e){if(ir=iy==null){var iw=gq*iu(),iz=it();
iq([[iz[0]-iw,iz[1]-iw],[iz[0]+iw,iz[1]+iw]])
}}else{if(ir){ix=null
}}return ix
};
return e.clipExtent(null)
}(hx.geo.mercator=function(){return dc(aY)
}).raw=aY;
var gd=eH(function(){return 1
},Math.asin);
(hx.geo.orthographic=function(){return fP(gd)
}).raw=gd;
var cf=eH(function(e){return 1/(1+e)
},function(e){return 2*Math.atan(e)
});
(hx.geo.stereographic=function(){return fP(cf)
}).raw=cf;
function ap(iq,e){return[Math.log(Math.tan(gq/4+e/2)),-iq]
}ap.invert=function(e,iq){return[-iq,2*Math.atan(Math.exp(e))-ez]
};
(hx.geo.transverseMercator=function(){var iq=dc(ap),e=iq.center,ir=iq.rotate;
iq.center=function(it){return it?e([-it[1],it[0]]):(it=e(),[-it[1],it[0]])
};
iq.rotate=function(it){return it?ir([it[0],it[1],it.length>2?it[2]+90:90]):(it=ir(),[it[0],it[1],it[2]-90])
};
return iq.rotate([0,0])
}).raw=ap;
hx.geom={};
function h5(e){return e[0]
}function h4(e){return e[1]
}hx.geom.hull=function(iq){var e=h5,it=h4;
if(arguments.length){return ir(iq)
}function ir(iO){if(iO.length<3){return[]
}var ix=X(e),iw=X(it),iE=iO.length,iz,iB=iE-1,iH=[],iA=[],iM,iI,iF,iJ=0,iL,iv,iK,iu,iD,iC,iN,iG;
if(ix===h5&&it===h4){iz=iO
}else{for(iI=0,iz=[];
iI<iE;
++iI){iz.push([+ix.call(this,iM=iO[iI],iI),+iw.call(this,iM,iI)])
}}for(iI=1;
iI<iE;
++iI){if(iz[iI][1]<iz[iJ][1]||iz[iI][1]==iz[iJ][1]&&iz[iI][0]<iz[iJ][0]){iJ=iI
}}for(iI=0;
iI<iE;
++iI){if(iI===iJ){continue
}iv=iz[iI][1]-iz[iJ][1];
iL=iz[iI][0]-iz[iJ][0];
iH.push({angle:Math.atan2(iv,iL),index:iI})
}iH.sort(function(iQ,iP){return iQ.angle-iP.angle
});
iN=iH[0].angle;
iC=iH[0].index;
iD=0;
for(iI=1;
iI<iB;
++iI){iF=iH[iI].index;
if(iN==iH[iI].angle){iL=iz[iC][0]-iz[iJ][0];
iv=iz[iC][1]-iz[iJ][1];
iK=iz[iF][0]-iz[iJ][0];
iu=iz[iF][1]-iz[iJ][1];
if(iL*iL+iv*iv>=iK*iK+iu*iu){iH[iI].index=-1;
continue
}else{iH[iD].index=-1
}}iN=iH[iI].angle;
iD=iI;
iC=iF
}iA.push(iJ);
for(iI=0,iF=0;
iI<2;
++iF){if(iH[iF].index>-1){iA.push(iH[iF].index);
iI++
}}iG=iA.length;
for(;
iF<iB;
++iF){if(iH[iF].index<0){continue
}while(!dP(iA[iG-2],iA[iG-1],iH[iF].index,iz)){--iG
}iA[iG++]=iH[iF].index
}var iy=[];
for(iI=iG-1;
iI>=0;
--iI){iy.push(iO[iA[iI]])
}return iy
}ir.x=function(iu){return arguments.length?(e=iu,ir):e
};
ir.y=function(iu){return arguments.length?(it=iu,ir):it
};
return ir
};
function dP(it,ir,iq,iA){var iB,iz,iy,ix,iw,iv,iu;
iB=iA[it];
iz=iB[0];
iy=iB[1];
iB=iA[ir];
ix=iB[0];
iw=iB[1];
iB=iA[iq];
iv=iB[0];
iu=iB[1];
return(iu-iy)*(ix-iz)-(iw-iy)*(iv-iz)>0
}hx.geom.polygon=function(e){ii(e,eB);
return e
};
var eB=hx.geom.polygon.prototype=[];
eB.area=function(){var ir=-1,iu=this.length,iq,e=this[iu-1],it=0;
while(++ir<iu){iq=e;
e=this[ir];
it+=iq[1]*e[0]-iq[0]*e[1]
}return it*0.5
};
eB.centroid=function(it){var iu=-1,ix=this.length,iq=0,iw=0,ir,e=this[ix-1],iv;
if(!arguments.length){it=-1/(6*this.area())
}while(++iu<ix){ir=e;
e=this[iu];
iv=ir[0]*e[1]-e[0]*ir[1];
iq+=(ir[0]+e[0])*iv;
iw+=(ir[1]+e[1])*iv
}return[iq*it,iw*it]
};
eB.clip=function(ix){var iz,iu=g4(ix),it=-1,e=this.length-g4(this),ir,iq,iA=this[e-1],iy,iw,iv;
while(++it<e){iz=ix.slice();
ix.length=0;
iy=this[it];
iw=iz[(iq=iz.length-iu)-1];
ir=-1;
while(++ir<iq){iv=iz[ir];
if(H(iv,iA,iy)){if(!H(iw,iA,iy)){ix.push(gy(iw,iv,iA,iy))
}ix.push(iv)
}else{if(H(iw,iA,iy)){ix.push(gy(iw,iv,iA,iy))
}}iw=iv
}if(iu){ix.push(ix[0])
}iA=iy
}return ix
};
function H(ir,iq,e){return(e[0]-iq[0])*(ir[1]-iq[1])<(e[1]-iq[1])*(ir[0]-iq[0])
}function gy(iw,iu,iA,ix){var ir=iw[0],e=iA[0],it=iu[0]-ir,iB=ix[0]-e,iz=iw[1],iv=iA[1],iy=iu[1]-iz,iC=ix[1]-iv,iq=(iB*(iz-iv)-iC*(ir-e))/(iC*it-iB*iy);
return[ir+iq*it,iz+iq*iy]
}function g4(ir){var iq=ir[0],e=ir[ir.length-1];
return !(iq[0]-e[0]||iq[1]-e[1])
}var g0,eJ,cX,dl=[],ho,ed,eD=[];
function gP(){t(this);
this.edge=this.site=this.circle=null
}function e8(iq){var e=dl.pop()||new gP();
e.site=iq;
return e
}function gO(e){eW(e);
cX.remove(e);
dl.push(e);
t(e)
}function hz(iq){var e=iq.circle,iz=e.x,iw=e.cy,iu={x:iz,y:iw},iv=iq.P,it=iq.N,iy=[iq];
gO(iq);
var iB=iv;
while(iB.circle&&cM(iz-iB.circle.x)<gA&&cM(iw-iB.circle.cy)<gA){iv=iB.P;
iy.unshift(iB);
gO(iB);
iB=iv
}iy.unshift(iB);
eW(iB);
var ir=it;
while(ir.circle&&cM(iz-ir.circle.x)<gA&&cM(iw-ir.circle.cy)<gA){it=ir.N;
iy.push(ir);
gO(ir);
ir=it
}iy.push(ir);
eW(ir);
var iA=iy.length,ix;
for(ix=1;
ix<iA;
++ix){ir=iy[ix];
iB=iy[ix-1];
ct(ir.edge,iB.site,ir.site,iu)
}iB=iy[0];
ir=iy[iA-1];
ir.edge=hu(iB.site,ir.site,null,iu);
ac(iB);
ac(ir)
}function dC(iA){var iy=iA.x,iC=iA.y,iE,iB,iK,iF,iD=cX._;
while(iD){iK=df(iD,iC)-iy;
if(iK>gA){iD=iD.L
}else{iF=iy-gr(iD,iC);
if(iF>gA){if(!iD.R){iE=iD;
break
}iD=iD.R
}else{if(iK>-gA){iE=iD.P;
iB=iD
}else{if(iF>-gA){iE=iD;
iB=iD.N
}else{iE=iB=iD
}}break
}}}var it=e8(iA);
cX.insert(iE,it);
if(!iE&&!iB){return
}if(iE===iB){eW(iE);
iB=e8(iE.site);
cX.insert(it,iB);
it.edge=iB.edge=hu(iE.site,it.site);
ac(iE);
ac(iB);
return
}if(!iB){it.edge=hu(iE.site,it.site);
return
}eW(iE);
eW(iB);
var iw=iE.site,iz=iw.x,ix=iw.y,iI=iA.x-iz,iG=iA.y-ix,e=iB.site,ir=e.x-iz,iq=e.y-ix,iJ=2*(iI*iq-iG*ir),iv=iI*iI+iG*iG,iu=ir*ir+iq*iq,iH={x:(iq*iv-iG*iu)/iJ+iz,y:(iI*iu-ir*iv)/iJ+ix};
ct(iB.edge,iw,e,iH);
it.edge=hu(iw,iA,null,iH);
iB.edge=hu(iA,e,null,iH);
ac(iE);
ac(iB)
}function df(it,iu){var e=it.site,iB=e.x,iA=e.y,iz=iA-iu;
if(!iz){return iB
}var iC=it.P;
if(!iC){return -Infinity
}e=iC.site;
var iw=e.x,iv=e.y,ir=iv-iu;
if(!ir){return iw
}var iq=iw-iB,iy=1/iz-1/ir,ix=iq/ir;
if(iy){return(-ix+Math.sqrt(ix*ix-2*iy*(iq*iq/(-2*ir)-iv+ir/2+iA-iz/2)))/iy+iB
}return(iB+iw)/2
}function gr(iq,ir){var it=iq.N;
if(it){return df(it,ir)
}var e=iq.site;
return e.y===ir?e.x:Infinity
}function b0(e){this.site=e;
this.edges=[]
}b0.prototype.prepare=function(){var ir=this.edges,e=ir.length,iq;
while(e--){iq=ir[e].edge;
if(!iq.b||!iq.a){ir.splice(e,1)
}}ir.sort(u);
return ir.length
};
function bB(iG){var iw=iG[0][0],iv=iG[1][0],iC=iG[0][1],iB=iG[1][1],it,iA,e,iz,iF=eJ,ir=iF.length,iE,iD,iy,iq,iu,ix;
while(ir--){iE=iF[ir];
if(!iE||!iE.prepare()){continue
}iy=iE.edges;
iq=iy.length;
iD=0;
while(iD<iq){ix=iy[iD].end(),e=ix.x,iz=ix.y;
iu=iy[++iD%iq].start(),it=iu.x,iA=iu.y;
if(cM(e-it)>gA||cM(iz-iA)>gA){iy.splice(iD,0,new ic(hj(iE.site,ix,cM(e-iw)<gA&&iB-iz>gA?{x:iw,y:cM(it-iw)<gA?iA:iB}:cM(iz-iB)<gA&&iv-e>gA?{x:cM(iA-iB)<gA?it:iv,y:iB}:cM(e-iv)<gA&&iz-iC>gA?{x:iv,y:cM(it-iv)<gA?iA:iC}:cM(iz-iC)<gA&&e-iw>gA?{x:cM(iA-iC)<gA?it:iw,y:iC}:null),iE.site,null));
++iq
}}}}function u(iq,e){return e.angle-iq.angle
}function a0(){t(this);
this.x=this.y=this.arc=this.site=this.cy=null
}function ac(iw){var iF=iw.P,iD=iw.N;
if(!iF||!iD){return
}var iy=iF.site,iI=iw.site,e=iD.site;
if(iy===e){return
}var iH=iI.x,iG=iI.y,iB=iy.x-iH,iz=iy.y-iG,ir=e.x-iH,iq=e.y-iG;
var iJ=2*(iB*iq-iz*ir);
if(iJ>=-eN){return
}var iv=iB*iB+iz*iz,iu=ir*ir+iq*iq,iA=(iq*iv-iz*iu)/iJ,ix=(iB*iu-ir*iv)/iJ,iq=ix+iG;
var it=eD.pop()||new a0();
it.arc=iw;
it.site=iI;
it.x=iA+iH;
it.y=iq+Math.sqrt(iA*iA+ix*ix);
it.cy=iq;
iw.circle=it;
var iC=null,iE=ed._;
while(iE){if(it.y<iE.y||it.y===iE.y&&it.x<=iE.x){if(iE.L){iE=iE.L
}else{iC=iE.P;
break
}}else{if(iE.R){iE=iE.R
}else{iC=iE;
break
}}}ed.insert(iC,it);
if(!iC){ho=it
}}function eW(e){var iq=e.circle;
if(iq){if(!iq.P){ho=iq.N
}ed.remove(iq);
eD.push(iq);
t(iq);
e.circle=null
}}function hM(it){var iq=g0,iu=aq(it[0][0],it[0][1],it[1][0],it[1][1]),ir=iq.length,iv;
while(ir--){iv=iq[ir];
if(!br(iv,it)||!iu(iv)||cM(iv.a.x-iv.b.x)<gA&&cM(iv.a.y-iv.b.y)<gA){iv.a=iv.b=null;
iq.splice(ir,1)
}}}function br(iB,iE){var e=iB.b;
if(e){return true
}var iq=iB.a,iH=iE[0][0],iG=iE[1][0],iv=iE[0][1],it=iE[1][1],iD=iB.l,ir=iB.r,iy=iD.x,ix=iD.y,iA=ir.x,iz=ir.y,iw=(iy+iA)/2,iu=(ix+iz)/2,iC,iF;
if(iz===ix){if(iw<iH||iw>=iG){return
}if(iy>iA){if(!iq){iq={x:iw,y:iv}
}else{if(iq.y>=it){return
}}e={x:iw,y:it}
}else{if(!iq){iq={x:iw,y:it}
}else{if(iq.y<iv){return
}}e={x:iw,y:iv}
}}else{iC=(iy-iA)/(iz-ix);
iF=iu-iC*iw;
if(iC<-1||iC>1){if(iy>iA){if(!iq){iq={x:(iv-iF)/iC,y:iv}
}else{if(iq.y>=it){return
}}e={x:(it-iF)/iC,y:it}
}else{if(!iq){iq={x:(it-iF)/iC,y:it}
}else{if(iq.y<iv){return
}}e={x:(iv-iF)/iC,y:iv}
}}else{if(ix<iz){if(!iq){iq={x:iH,y:iC*iH+iF}
}else{if(iq.x>=iG){return
}}e={x:iG,y:iC*iG+iF}
}else{if(!iq){iq={x:iG,y:iC*iG+iF}
}else{if(iq.x<iH){return
}}e={x:iH,y:iC*iH+iF}
}}}iB.a=iq;
iB.b=e;
return true
}function K(iq,e){this.l=iq;
this.r=e;
this.a=this.b=null
}function hu(iu,e,it,iq){var ir=new K(iu,e);
g0.push(ir);
if(it){ct(ir,iu,e,it)
}if(iq){ct(ir,e,iu,iq)
}eJ[iu.i].edges.push(new ic(ir,iu,e));
eJ[e.i].edges.push(new ic(ir,e,iu));
return ir
}function hj(it,ir,e){var iq=new K(it,null);
iq.a=ir;
iq.b=e;
g0.push(iq);
return iq
}function ct(iq,it,e,ir){if(!iq.a&&!iq.b){iq.a=ir;
iq.l=it;
iq.r=e
}else{if(iq.l===e){iq.b=ir
}else{iq.a=ir
}}}function ic(it,iu,e){var ir=it.a,iq=it.b;
this.edge=it;
this.site=iu;
this.angle=e?Math.atan2(e.y-iu.y,e.x-iu.x):it.l===iu?Math.atan2(iq.x-ir.x,ir.y-iq.y):Math.atan2(ir.x-iq.x,iq.y-ir.y)
}ic.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b
},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a
}};
function be(){this._=null
}function t(e){e.U=e.C=e.L=e.R=e.P=e.N=null
}be.prototype={insert:function(iu,it){var ir,iq,e;
if(iu){it.P=iu;
it.N=iu.N;
if(iu.N){iu.N.P=it
}iu.N=it;
if(iu.R){iu=iu.R;
while(iu.L){iu=iu.L
}iu.L=it
}else{iu.R=it
}ir=iu
}else{if(this._){iu=dj(this._);
it.P=null;
it.N=iu;
iu.P=iu.L=it;
ir=iu
}else{it.P=it.N=null;
this._=it;
ir=null
}}it.L=it.R=null;
it.U=ir;
it.C=true;
iu=it;
while(ir&&ir.C){iq=ir.U;
if(ir===iq.L){e=iq.R;
if(e&&e.C){ir.C=e.C=false;
iq.C=true;
iu=iq
}else{if(iu===ir.R){ao(this,ir);
iu=ir;
ir=iu.U
}ir.C=false;
iq.C=true;
e0(this,iq)
}}else{e=iq.L;
if(e&&e.C){ir.C=e.C=false;
iq.C=true;
iu=iq
}else{if(iu===ir.L){e0(this,ir);
iu=ir;
ir=iu.U
}ir.C=false;
iq.C=true;
ao(this,iq)
}}ir=iu.U
}this._.C=false
},remove:function(iu){if(iu.N){iu.N.P=iu.P
}if(iu.P){iu.P.N=iu.N
}iu.N=iu.P=null;
var it=iu.U,ir,iw=iu.L,e=iu.R,iq,iv;
if(!iw){iq=e
}else{if(!e){iq=iw
}else{iq=dj(e)
}}if(it){if(it.L===iu){it.L=iq
}else{it.R=iq
}}else{this._=iq
}if(iw&&e){iv=iq.C;
iq.C=iu.C;
iq.L=iw;
iw.U=iq;
if(iq!==e){it=iq.U;
iq.U=iu.U;
iu=iq.R;
it.L=iu;
iq.R=e;
e.U=iq
}else{iq.U=it;
it=iq;
iu=iq.R
}}else{iv=iu.C;
iu=iq
}if(iu){iu.U=it
}if(iv){return
}if(iu&&iu.C){iu.C=false;
return
}do{if(iu===this._){break
}if(iu===it.L){ir=it.R;
if(ir.C){ir.C=false;
it.C=true;
ao(this,it);
ir=it.R
}if(ir.L&&ir.L.C||ir.R&&ir.R.C){if(!ir.R||!ir.R.C){ir.L.C=false;
ir.C=true;
e0(this,ir);
ir=it.R
}ir.C=it.C;
it.C=ir.R.C=false;
ao(this,it);
iu=this._;
break
}}else{ir=it.L;
if(ir.C){ir.C=false;
it.C=true;
e0(this,it);
ir=it.L
}if(ir.L&&ir.L.C||ir.R&&ir.R.C){if(!ir.L||!ir.L.C){ir.R.C=false;
ir.C=true;
ao(this,ir);
ir=it.L
}ir.C=it.C;
it.C=ir.L.C=false;
e0(this,it);
iu=this._;
break
}}ir.C=true;
iu=it;
it=it.U
}while(!iu.C);
if(iu){iu.C=false
}}};
function ao(e,ir){var iu=ir,it=ir.R,iq=iu.U;
if(iq){if(iq.L===iu){iq.L=it
}else{iq.R=it
}}else{e._=it
}it.U=iq;
iu.U=it;
iu.R=it.L;
if(iu.R){iu.R.U=iu
}it.L=iu
}function e0(e,ir){var iu=ir,it=ir.L,iq=iu.U;
if(iq){if(iq.L===iu){iq.L=it
}else{iq.R=it
}}else{e._=it
}it.U=iq;
iu.U=it;
iu.L=it.R;
if(iu.L){iu.L.U=iu
}it.R=iu
}function dj(e){while(e.L){e=e.L
}return e
}function hd(iv,iw){var iq=iv.sort(bo).pop(),ir,it,iu;
g0=[];
eJ=new Array(iv.length);
cX=new be();
ed=new be();
while(true){iu=ho;
if(iq&&(!iu||iq.y<iu.y||iq.y===iu.y&&iq.x<iu.x)){if(iq.x!==ir||iq.y!==it){eJ[iq.i]=new b0(iq);
dC(iq);
ir=iq.x,it=iq.y
}iq=iv.pop()
}else{if(iu){hz(iu.arc)
}else{break
}}}if(iw){hM(iw),bB(iw)
}var e={cells:eJ,edges:g0};
cX=ed=g0=eJ=null;
return e
}function bo(iq,e){return e.y-iq.y||e.x-iq.x
}hx.geom.voronoi=function(it){var e=h5,ix=h4,iu=e,ir=ix,iq=hP;
if(it){return iw(it)
}function iw(iD){var iy=new Array(iD.length),iA=iq[0][0],iC=iq[0][1],iz=iq[1][0],iB=iq[1][1];
hd(iv(iD),iq).cells.forEach(function(iE,iI){var iF=iE.edges,iG=iE.site,iH=iy[iI]=iF.length?iF.map(function(iK){var iJ=iK.start();
return[iJ.x,iJ.y]
}):iG.x>=iA&&iG.x<=iz&&iG.y>=iC&&iG.y<=iB?[[iA,iB],[iz,iB],[iz,iC],[iA,iC]]:[];
iH.point=iD[iI]
});
return iy
}function iv(iy){return iy.map(function(iA,iz){return{x:Math.round(iu(iA,iz)/gA)*gA,y:Math.round(ir(iA,iz)/gA)*gA,i:iz}
})
}iw.links=function(iy){return hd(iv(iy)).edges.filter(function(iz){return iz.l&&iz.r
}).map(function(iz){return{source:iy[iz.l.i],target:iy[iz.r.i]}
})
};
iw.triangles=function(iz){var iy=[];
hd(iv(iz)).cells.forEach(function(iI,iE){var iA=iI.site,iD=iI.edges.sort(u),iC=-1,iB=iD.length,iG,iJ,iF=iD[iB-1].edge,iH=iF.l===iA?iF.r:iF.l;
while(++iC<iB){iG=iF;
iJ=iH;
iF=iD[iC].edge;
iH=iF.l===iA?iF.r:iF.l;
if(iE<iJ.i&&iE<iH.i&&gN(iA,iJ,iH)<0){iy.push([iz[iE],iz[iJ.i],iz[iH.i]])
}}});
return iy
};
iw.x=function(iy){return arguments.length?(iu=X(e=iy),iw):e
};
iw.y=function(iy){return arguments.length?(ir=X(ix=iy),iw):ix
};
iw.clipExtent=function(iy){if(!arguments.length){return iq===hP?null:iq
}iq=iy==null?hP:iy;
return iw
};
iw.size=function(iy){if(!arguments.length){return iq===hP?null:iq&&iq[1]
}return iw.clipExtent(iy&&[[0,0],iy])
};
return iw
};
var hP=[[-1000000,-1000000],[1000000,1000000]];
function gN(iq,e,ir){return(iq.x-ir.x)*(e.y-iq.y)-(iq.x-e.x)*(ir.y-iq.y)
}hx.geom.delaunay=function(e){return hx.geom.voronoi().triangles(e)
};
hx.geom.quadtree=function(ix,iq,iv,e,iu){var iw=h5,it=h4,iy;
if(iy=arguments.length){iw=gh;
it=gg;
if(iy===3){iu=iv;
e=iq;
iv=iq=0
}return ir(ix)
}function ir(iR){var iO,iD=X(iw),iB=X(it),iF,iL,iM,iJ,iz,iI,iE,iQ;
if(iq!=null){iz=iq,iI=iv,iE=e,iQ=iu
}else{iE=iQ=-(iz=iI=Infinity);
iF=[],iL=[];
iJ=iR.length;
if(iy){for(iM=0;
iM<iJ;
++iM){iO=iR[iM];
if(iO.x<iz){iz=iO.x
}if(iO.y<iI){iI=iO.y
}if(iO.x>iE){iE=iO.x
}if(iO.y>iQ){iQ=iO.y
}iF.push(iO.x);
iL.push(iO.y)
}}else{for(iM=0;
iM<iJ;
++iM){var iN=+iD(iO=iR[iM],iM),iC=+iB(iO,iM);
if(iN<iz){iz=iN
}if(iC<iI){iI=iC
}if(iN>iE){iE=iN
}if(iC>iQ){iQ=iC
}iF.push(iN);
iL.push(iC)
}}}var iH=iE-iz,iG=iQ-iI;
if(iH>iG){iQ=iI+iH
}else{iE=iz+iG
}function iA(iU,iY,i2,iZ,iT,i1,iS,i0){if(isNaN(i2)||isNaN(iZ)){return
}if(iU.leaf){var iX=iU.x,iW=iU.y;
if(iX!=null){if(cM(iX-i2)+cM(iW-iZ)<0.01){iP(iU,iY,i2,iZ,iT,i1,iS,i0)
}else{var iV=iU.point;
iU.x=iU.y=iU.point=null;
iP(iU,iV,iX,iW,iT,i1,iS,i0);
iP(iU,iY,i2,iZ,iT,i1,iS,i0)
}}else{iU.x=i2,iU.y=iZ,iU.point=iY
}}else{iP(iU,iY,i2,iZ,iT,i1,iS,i0)
}}function iP(iV,iX,i3,iZ,iU,i2,iT,i0){var i1=(iU+iT)*0.5,iY=(i2+i0)*0.5,i4=i3>=i1,iS=iZ>=iY,iW=(iS<<1)+i4;
iV.leaf=false;
iV=iV.nodes[iW]||(iV.nodes[iW]=fW());
if(i4){iU=i1
}else{iT=i1
}if(iS){i2=iY
}else{i0=iY
}iA(iV,iX,i3,iZ,iU,i2,iT,i0)
}var iK=fW();
iK.add=function(iS){iA(iK,iS,+iD(iS,++iM),+iB(iS,iM),iz,iI,iE,iQ)
};
iK.visit=function(iS){cS(iS,iK,iz,iI,iE,iQ)
};
iM=-1;
if(iq==null){while(++iM<iJ){iA(iK,iR[iM],iF[iM],iL[iM],iz,iI,iE,iQ)
}--iM
}else{iR.forEach(iK.add)
}iF=iL=iR=iO=null;
return iK
}ir.x=function(iz){return arguments.length?(iw=iz,ir):iw
};
ir.y=function(iz){return arguments.length?(it=iz,ir):it
};
ir.extent=function(iz){if(!arguments.length){return iq==null?null:[[iq,iv],[e,iu]]
}if(iz==null){iq=iv=e=iu=null
}else{iq=+iz[0][0],iv=+iz[0][1],e=+iz[1][0],iu=+iz[1][1]
}return ir
};
ir.size=function(iz){if(!arguments.length){return iq==null?null:[e-iq,iu-iv]
}if(iz==null){iq=iv=e=iu=null
}else{iq=iv=0,e=+iz[0],iu=+iz[1]
}return ir
};
return ir
};
function gh(e){return e.x
}function gg(e){return e.y
}function fW(){return{leaf:true,nodes:[],point:null,x:null,y:null}
}function cS(iu,it,iq,iy,e,iw){if(!iu(it,iq,iy,e,iw)){var ix=(iq+e)*0.5,iv=(iy+iw)*0.5,ir=it.nodes;
if(ir[0]){cS(iu,ir[0],iq,iy,ix,iv)
}if(ir[1]){cS(iu,ir[1],ix,iy,e,iv)
}if(ir[2]){cS(iu,ir[2],iq,iv,ix,iw)
}if(ir[3]){cS(iu,ir[3],ix,iv,e,iw)
}}}hx.interpolateRgb=aT;
function aT(iq,e){iq=hx.rgb(iq);
e=hx.rgb(e);
var it=iq.r,ir=iq.g,iw=iq.b,iv=e.r-it,iu=e.g-ir,ix=e.b-iw;
return function(iy){return"#"+cB(Math.round(it+iv*iy))+cB(Math.round(ir+iu*iy))+cB(Math.round(iw+ix*iy))
}
}hx.interpolateObject=bP;
function bP(iq,e){var it={},iu={},ir;
for(ir in iq){if(ir in e){it[ir]=fR(iq[ir],e[ir])
}else{iu[ir]=iq[ir]
}}for(ir in e){if(!(ir in iq)){iu[ir]=e[ir]
}}return function(iv){for(ir in it){iu[ir]=it[ir](iv)
}return iu
}
}hx.interpolateNumber=bI;
function bI(iq,e){e-=iq=+iq;
return function(ir){return iq+e*ir
}
}hx.interpolateString=b3;
function b3(ix,iw){var it,iv,iu,iz=0,iy=0,iA=[],e=[],ir,iq;
ix=ix+"",iw=iw+"";
f6.lastIndex=0;
for(iv=0;
it=f6.exec(iw);
++iv){if(it.index){iA.push(iw.substring(iz,iy=it.index))
}e.push({i:iA.length,x:it[0]});
iA.push(null);
iz=f6.lastIndex
}if(iz<iw.length){iA.push(iw.substring(iz))
}for(iv=0,ir=e.length;
(it=f6.exec(ix))&&iv<ir;
++iv){iq=e[iv];
if(iq.x==it[0]){if(iq.i){if(iA[iq.i+1]==null){iA[iq.i-1]+=iq.x;
iA.splice(iq.i,1);
for(iu=iv+1;
iu<ir;
++iu){e[iu].i--
}}else{iA[iq.i-1]+=iq.x+iA[iq.i+1];
iA.splice(iq.i,2);
for(iu=iv+1;
iu<ir;
++iu){e[iu].i-=2
}}}else{if(iA[iq.i+1]==null){iA[iq.i]=iq.x
}else{iA[iq.i]=iq.x+iA[iq.i+1];
iA.splice(iq.i+1,1);
for(iu=iv+1;
iu<ir;
++iu){e[iu].i--
}}}e.splice(iv,1);
ir--;
iv--
}else{iq.x=bI(parseFloat(it[0]),parseFloat(iq.x))
}}while(iv<ir){iq=e.pop();
if(iA[iq.i+1]==null){iA[iq.i]=iq.x
}else{iA[iq.i]=iq.x+iA[iq.i+1];
iA.splice(iq.i+1,1)
}ir--
}if(iA.length===1){return iA[0]==null?(iq=e[0].x,function(iB){return iq(iB)+""
}):function(){return iw
}
}return function(iB){for(iv=0;
iv<ir;
++iv){iA[(iq=e[iv]).i]=iq.x(iB)
}return iA.join("")
}
}var f6=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;
hx.interpolate=fR;
function fR(iq,e){var ir=hx.interpolators.length,it;
while(--ir>=0&&!(it=hx.interpolators[ir](iq,e))){}return it
}hx.interpolators=[function(iq,e){var ir=typeof e;
return(ir==="string"?at.has(e)||/^(#|rgb\(|hsl\()/.test(e)?aT:b3:e instanceof L?aT:ir==="object"?Array.isArray(e)?eY:bP:bI)(iq,e)
}];
hx.interpolateArray=eY;
function eY(iu,ir){var iq=[],ix=[],it=iu.length,e=ir.length,iw=Math.min(iu.length,ir.length),iv;
for(iv=0;
iv<iw;
++iv){iq.push(fR(iu[iv],ir[iv]))
}for(;
iv<it;
++iv){ix[iv]=iu[iv]
}for(;
iv<e;
++iv){ix[iv]=ir[iv]
}return function(iy){for(iv=0;
iv<iw;
++iv){ix[iv]=iq[iv](iy)
}return ix
}
}var ht=function(){return gx
};
var ah=hx.map({linear:ht,poly:aX,quad:function(){return b1
},cubic:function(){return N
},sin:function(){return gp
},exp:function(){return fI
},circle:function(){return eg
},elastic:ab,back:ha,bounce:function(){return co
}});
var j=hx.map({"in":gx,out:G,"in-out":a6,"out-in":function(e){return a6(G(e))
}});
hx.ease=function(iq){var it=iq.indexOf("-"),ir=it>=0?iq.substring(0,it):iq,e=it>=0?iq.substring(it+1):"in";
ir=ah.get(ir)||ht;
e=j.get(e)||gx;
return fO(e(ir.apply(null,bR.call(arguments,1))))
};
function fO(e){return function(iq){return iq<=0?0:iq>=1?1:e(iq)
}
}function G(e){return function(iq){return 1-e(1-iq)
}
}function a6(e){return function(iq){return 0.5*(iq<0.5?e(2*iq):2-e(2-2*iq))
}
}function b1(e){return e*e
}function N(e){return e*e*e
}function aB(iq){if(iq<=0){return 0
}if(iq>=1){return 1
}var ir=iq*iq,e=ir*iq;
return 4*(iq<0.5?e:3*(iq-ir)+e-0.75)
}function aX(iq){return function(e){return Math.pow(e,iq)
}
}function gp(e){return 1-Math.cos(e*ez)
}function fI(e){return Math.pow(2,10*(e-1))
}function eg(e){return 1-Math.sqrt(1-e*e)
}function ab(e,ir){var iq;
if(arguments.length<2){ir=0.45
}if(arguments.length){iq=ir/gl*Math.asin(1/e)
}else{e=1,iq=ir/4
}return function(it){return 1+e*Math.pow(2,-10*it)*Math.sin((it-iq)*gl/ir)
}
}function ha(e){if(!e){e=1.70158
}return function(iq){return iq*iq*((e+1)*iq-e)
}
}function co(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+0.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+0.9375:7.5625*(e-=2.625/2.75)*e+0.984375
}hx.interpolateHcl=g2;
function g2(ir,e){ir=hx.hcl(ir);
e=hx.hcl(e);
var iq=ir.h,iu=ir.c,iw=ir.l,it=e.h-iq,iv=e.c-iu,ix=e.l-iw;
if(isNaN(iv)){iv=0,iu=isNaN(iu)?e.c:iu
}if(isNaN(it)){it=0,iq=isNaN(iq)?e.h:iq
}else{if(it>180){it-=360
}else{if(it<-180){it+=360
}}}return function(iy){return bF(iq+it*iy,iu+iv*iy,iw+ix*iy)+""
}
}hx.interpolateHsl=a7;
function a7(it,e){it=hx.hsl(it);
e=hx.hsl(e);
var ir=it.h,iq=it.s,iw=it.l,iv=e.h-ir,iu=e.s-iq,ix=e.l-iw;
if(isNaN(iu)){iu=0,iq=isNaN(iq)?e.s:iq
}if(isNaN(iv)){iv=0,ir=isNaN(ir)?e.h:ir
}else{if(iv>180){iv-=360
}else{if(iv<-180){iv+=360
}}}return function(iy){return bk(ir+iv*iy,iq+iu*iy,iw+ix*iy)+""
}
}hx.interpolateLab=hI;
function hI(iq,e){iq=hx.lab(iq);
e=hx.lab(e);
var iu=iq.l,it=iq.a,ir=iq.b,ix=e.l-iu,iw=e.a-it,iv=e.b-ir;
return function(iy){return aG(iu+ix*iy,it+iw*iy,ir+iv*iy)+""
}
}hx.interpolateRound=fM;
function fM(iq,e){e-=iq;
return function(ir){return Math.round(iq+e*ir)
}
}hx.transform=function(e){var iq=bQ.createElementNS(hx.ns.prefix.svg,"g");
return(hx.transform=function(ir){if(ir!=null){iq.setAttribute("transform",ir);
var it=iq.transform.baseVal.consolidate()
}return new o(it?it.matrix:gm)
})(e)
};
function o(e){var it=[e.a,e.b],iq=[e.c,e.d],iv=fD(it),ir=e9(it,iq),iu=fD(bV(iq,it,-ir))||0;
if(it[0]*iq[1]<iq[0]*it[1]){it[0]*=-1;
it[1]*=-1;
iv*=-1;
ir*=-1
}this.rotate=(iv?Math.atan2(it[1],it[0]):Math.atan2(-iq[0],iq[1]))*hN;
this.translate=[e.e,e.f];
this.scale=[iv,iu];
this.skew=iu?Math.atan2(ir,iu)*hN:0
}o.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"
};
function e9(iq,e){return iq[0]*e[0]+iq[1]*e[1]
}function fD(e){var iq=Math.sqrt(e9(e,e));
if(iq){e[0]/=iq;
e[1]/=iq
}return iq
}function bV(iq,e,ir){iq[0]+=ir*e[0];
iq[1]+=ir*e[1];
return iq
}var gm={a:1,b:0,c:0,d:1,e:0,f:0};
hx.interpolateTransform=es;
function es(iD,iC){var iE=[],iq=[],iv,iu=hx.transform(iD),it=hx.transform(iC),iz=iu.translate,iy=it.translate,ir=iu.rotate,e=it.rotate,ix=iu.skew,iw=it.skew,iB=iu.scale,iA=it.scale;
if(iz[0]!=iy[0]||iz[1]!=iy[1]){iE.push("translate(",null,",",null,")");
iq.push({i:1,x:bI(iz[0],iy[0])},{i:3,x:bI(iz[1],iy[1])})
}else{if(iy[0]||iy[1]){iE.push("translate("+iy+")")
}else{iE.push("")
}}if(ir!=e){if(ir-e>180){e+=360
}else{if(e-ir>180){ir+=360
}}iq.push({i:iE.push(iE.pop()+"rotate(",null,")")-2,x:bI(ir,e)})
}else{if(e){iE.push(iE.pop()+"rotate("+e+")")
}}if(ix!=iw){iq.push({i:iE.push(iE.pop()+"skewX(",null,")")-2,x:bI(ix,iw)})
}else{if(iw){iE.push(iE.pop()+"skewX("+iw+")")
}}if(iB[0]!=iA[0]||iB[1]!=iA[1]){iv=iE.push(iE.pop()+"scale(",null,",",null,")");
iq.push({i:iv-4,x:bI(iB[0],iA[0])},{i:iv-2,x:bI(iB[1],iA[1])})
}else{if(iA[0]!=1||iA[1]!=1){iE.push(iE.pop()+"scale("+iA+")")
}}iv=iq.length;
return function(iG){var iF=-1,iH;
while(++iF<iv){iE[(iH=iq[iF]).i]=iH.x(iG)
}return iE.join("")
}
}function hF(iq,e){e=e-(iq=+iq)?1/(e-iq):0;
return function(ir){return(ir-iq)*e
}
}function aE(iq,e){e=e-(iq=+iq)?1/(e-iq):0;
return function(ir){return Math.max(0,Math.min(1,(ir-iq)*e))
}
}hx.layout={};
hx.layout.bundle=function(){return function(e){var ir=[],iq=-1,it=e.length;
while(++iq<it){ir.push(eU(e[iq]))
}return ir
}
};
function eU(it){var iv=it.source,e=it.target,iu=fZ(iv,e),ir=[iv];
while(iv!==iu){iv=iv.parent;
ir.push(iv)
}var iq=ir.length;
while(e!==iu){ir.splice(iq,0,e);
e=e.parent
}return ir
}function fC(ir){var iq=[],e=ir.parent;
while(e!=null){iq.push(ir);
ir=e;
e=e.parent
}iq.push(ir);
return iq
}function fZ(it,iq){if(it===iq){return it
}var ir=fC(it),e=fC(iq),iu=ir.pop(),iv=e.pop(),iw=null;
while(iu===iv){iw=iu;
iu=ir.pop();
iv=e.pop()
}return iw
}hx.layout.chord=function(){var iv={},iw,it,iA,ir,iz=0,e,iq,iu;
function iy(){var iF={},iI=[],iQ=hx.range(ir),iM=[],iG,iO,iE,iJ,iH;
iw=[];
it=[];
iG=0,iJ=-1;
while(++iJ<ir){iO=0,iH=-1;
while(++iH<ir){iO+=iA[iJ][iH]
}iI.push(iO);
iM.push(hx.range(ir));
iG+=iO
}if(e){iQ.sort(function(iS,iR){return e(iI[iS],iI[iR])
})
}if(iq){iM.forEach(function(iS,iR){iS.sort(function(iU,iT){return iq(iA[iR][iU],iA[iR][iT])
})
})
}iG=(gl-iz*ir)/iG;
iO=0,iJ=-1;
while(++iJ<ir){iE=iO,iH=-1;
while(++iH<ir){var iN=iQ[iJ],iL=iM[iN][iH],iP=iA[iN][iL],iD=iO,iC=iO+=iP*iG;
iF[iN+"-"+iL]={index:iN,subindex:iL,startAngle:iD,endAngle:iC,value:iP}
}it[iN]={index:iN,startAngle:iE,endAngle:iO,value:(iO-iE)/iG};
iO+=iz
}iJ=-1;
while(++iJ<ir){iH=iJ-1;
while(++iH<ir){var iB=iF[iJ+"-"+iH],iK=iF[iH+"-"+iJ];
if(iB.value||iK.value){iw.push(iB.value<iK.value?{source:iK,target:iB}:{source:iB,target:iK})
}}}if(iu){ix()
}}function ix(){iw.sort(function(iC,iB){return iu((iC.source.value+iC.target.value)/2,(iB.source.value+iB.target.value)/2)
})
}iv.matrix=function(iB){if(!arguments.length){return iA
}ir=(iA=iB)&&iA.length;
iw=it=null;
return iv
};
iv.padding=function(iB){if(!arguments.length){return iz
}iz=iB;
iw=it=null;
return iv
};
iv.sortGroups=function(iB){if(!arguments.length){return e
}e=iB;
iw=it=null;
return iv
};
iv.sortSubgroups=function(iB){if(!arguments.length){return iq
}iq=iB;
iw=null;
return iv
};
iv.sortChords=function(iB){if(!arguments.length){return iu
}iu=iB;
if(iw){ix()
}return iv
};
iv.chords=function(){if(!iw){iy()
}return iw
};
iv.groups=function(){if(!it){iy()
}return it
};
return iv
};
hx.layout.force=function(){var iq={},iE=hx.dispatch("start","tick","end"),iA=[1,1],iG,iu,ix=0.9,iH=f5,it=cy,iD=-30,iv=0.1,iy=0.8,iC=[],ir=[],iw,e,iz;
function iF(iI){return function(iL,iQ,iP,iO){if(iL.point!==iI){var iN=iL.cx-iI.x,iK=iL.cy-iI.y,iJ=1/Math.sqrt(iN*iN+iK*iK);
if((iO-iQ)*iJ<iy){var iM=iL.charge*iJ*iJ;
iI.px-=iN*iM;
iI.py-=iK*iM;
return true
}if(iL.point&&isFinite(iJ)){var iM=iL.pointCharge*iJ*iJ;
iI.px-=iN*iM;
iI.py-=iK*iM
}}return !iL.charge
}
}iq.tick=function(){if((iu*=0.99)<0.005){iE.end({type:"end",alpha:iu=0});
return true
}var iK=iC.length,iL=ir.length,iI,iO,iJ,iS,iR,iM,iN,iQ,iP;
for(iO=0;
iO<iL;
++iO){iJ=ir[iO];
iS=iJ.source;
iR=iJ.target;
iQ=iR.x-iS.x;
iP=iR.y-iS.y;
if(iM=iQ*iQ+iP*iP){iM=iu*e[iO]*((iM=Math.sqrt(iM))-iw[iO])/iM;
iQ*=iM;
iP*=iM;
iR.x-=iQ*(iN=iS.weight/(iR.weight+iS.weight));
iR.y-=iP*iN;
iS.x+=iQ*(iN=1-iN);
iS.y+=iP*iN
}}if(iN=iu*iv){iQ=iA[0]/2;
iP=iA[1]/2;
iO=-1;
if(iN){while(++iO<iK){iJ=iC[iO];
iJ.x+=(iQ-iJ.x)*iN;
iJ.y+=(iP-iJ.y)*iN
}}}if(iD){gM(iI=hx.geom.quadtree(iC),iu,iz);
iO=-1;
while(++iO<iK){if(!(iJ=iC[iO]).fixed){iI.visit(iF(iJ))
}}}iO=-1;
while(++iO<iK){iJ=iC[iO];
if(iJ.fixed){iJ.x=iJ.px;
iJ.y=iJ.py
}else{iJ.x-=(iJ.px-(iJ.px=iJ.x))*ix;
iJ.y-=(iJ.py-(iJ.py=iJ.y))*ix
}}iE.tick({type:"tick",alpha:iu})
};
iq.nodes=function(iI){if(!arguments.length){return iC
}iC=iI;
return iq
};
iq.links=function(iI){if(!arguments.length){return ir
}ir=iI;
return iq
};
iq.size=function(iI){if(!arguments.length){return iA
}iA=iI;
return iq
};
iq.linkDistance=function(iI){if(!arguments.length){return iH
}iH=typeof iI==="function"?iI:+iI;
return iq
};
iq.distance=iq.linkDistance;
iq.linkStrength=function(iI){if(!arguments.length){return it
}it=typeof iI==="function"?iI:+iI;
return iq
};
iq.friction=function(iI){if(!arguments.length){return ix
}ix=+iI;
return iq
};
iq.charge=function(iI){if(!arguments.length){return iD
}iD=typeof iI==="function"?iI:+iI;
return iq
};
iq.gravity=function(iI){if(!arguments.length){return iv
}iv=+iI;
return iq
};
iq.theta=function(iI){if(!arguments.length){return iy
}iy=+iI;
return iq
};
iq.alpha=function(iI){if(!arguments.length){return iu
}iI=+iI;
if(iu){if(iI>0){iu=iI
}else{iu=0
}}else{if(iI>0){iE.start({type:"start",alpha:iu=iI});
hx.timer(iq.tick)
}}return iq
};
iq.start=function(){var iM,iP=iC.length,iJ=ir.length,iK=iA[0],iN=iA[1],iL,iO;
for(iM=0;
iM<iP;
++iM){(iO=iC[iM]).index=iM;
iO.weight=0
}for(iM=0;
iM<iJ;
++iM){iO=ir[iM];
if(typeof iO.source=="number"){iO.source=iC[iO.source]
}if(typeof iO.target=="number"){iO.target=iC[iO.target]
}++iO.source.weight;
++iO.target.weight
}for(iM=0;
iM<iP;
++iM){iO=iC[iM];
if(isNaN(iO.x)){iO.x=iI("x",iK)
}if(isNaN(iO.y)){iO.y=iI("y",iN)
}if(isNaN(iO.px)){iO.px=iO.x
}if(isNaN(iO.py)){iO.py=iO.y
}}iw=[];
if(typeof iH==="function"){for(iM=0;
iM<iJ;
++iM){iw[iM]=+iH.call(this,ir[iM],iM)
}}else{for(iM=0;
iM<iJ;
++iM){iw[iM]=iH
}}e=[];
if(typeof it==="function"){for(iM=0;
iM<iJ;
++iM){e[iM]=+it.call(this,ir[iM],iM)
}}else{for(iM=0;
iM<iJ;
++iM){e[iM]=it
}}iz=[];
if(typeof iD==="function"){for(iM=0;
iM<iP;
++iM){iz[iM]=+iD.call(this,iC[iM],iM)
}}else{for(iM=0;
iM<iP;
++iM){iz[iM]=iD
}}function iI(iV,iT){if(!iL){iL=new Array(iP);
for(iS=0;
iS<iP;
++iS){iL[iS]=[]
}for(iS=0;
iS<iR;
++iS){var iW=ir[iS];
iL[iW.source.index].push(iW.target);
iL[iW.target.index].push(iW.source)
}}var iU=iL[iM],iS=-1,iR=iU.length,iQ;
while(++iS<iR){if(!isNaN(iQ=iU[iS][iV])){return iQ
}}return Math.random()*iT
}return iq.resume()
};
iq.resume=function(){return iq.alpha(0.1)
};
iq.stop=function(){return iq.alpha(0)
};
iq.drag=function(){if(!iG){iG=hx.behavior.drag().origin(gx).on("dragstart.force",r).on("drag.force",iB).on("dragend.force",eo)
}if(!arguments.length){return iG
}this.on("mouseover.force",cC).on("mouseout.force",ev).call(iG)
};
function iB(iI){iI.px=hx.event.x,iI.py=hx.event.y;
iq.resume()
}return hx.rebind(iq,iE,"on")
};
function r(e){e.fixed|=2
}function eo(e){e.fixed&=~6
}function cC(e){e.fixed|=4;
e.px=e.x,e.py=e.y
}function ev(e){e.fixed&=~4
}function gM(iz,iu,iy){var iv=0,ir=0;
iz.charge=0;
if(!iz.leaf){var e=iz.nodes,iq=e.length,iw=-1,ix;
while(++iw<iq){ix=e[iw];
if(ix==null){continue
}gM(ix,iu,iy);
iz.charge+=ix.charge;
iv+=ix.charge*ix.cx;
ir+=ix.charge*ix.cy
}}if(iz.point){if(!iz.leaf){iz.point.x+=Math.random()-0.5;
iz.point.y+=Math.random()-0.5
}var it=iu*iy[iz.point.index];
iz.charge+=iz.pointCharge=it;
iv+=it*iz.point.x;
ir+=it*iz.point.y
}iz.cx=iv/iz.charge;
iz.cy=ir/iz.charge
}var f5=20,cy=1;
hx.layout.hierarchy=function(){var ir=dZ,iq=bb,iu=hU;
function it(iy,iA,iw){var iD=iq.call(e,iy,iA);
iy.depth=iA;
iw.push(iy);
if(iD&&(ix=iD.length)){var iB=-1,ix,iE=iy.children=new Array(ix),iF=0,iz=iA+1,iC;
while(++iB<ix){iC=iE[iB]=it(iD[iB],iz,iw);
iC.parent=iy;
iF+=iC.value
}if(ir){iE.sort(ir)
}if(iu){iy.value=iF
}}else{delete iy.children;
if(iu){iy.value=+iu.call(e,iy,iA)||0
}}return iy
}function iv(iA,iB){var iz=iA.children,iw=0;
if(iz&&(iC=iz.length)){var iy=-1,iC,ix=iB+1;
while(++iy<iC){iw+=iv(iz[iy],ix)
}}else{if(iu){iw=+iu.call(e,iA,iB)||0
}}if(iu){iA.value=iw
}return iw
}function e(ix){var iw=[];
it(ix,0,iw);
return iw
}e.sort=function(iw){if(!arguments.length){return ir
}ir=iw;
return e
};
e.children=function(iw){if(!arguments.length){return iq
}iq=iw;
return e
};
e.value=function(iw){if(!arguments.length){return iu
}iu=iw;
return e
};
e.revalue=function(iw){iv(iw,0);
return iw
};
return e
};
function gE(iq,e){hx.rebind(iq,e,"sort","children","value");
iq.nodes=iq;
iq.links=gI;
return iq
}function bb(e){return e.children
}function hU(e){return e.value
}function dZ(iq,e){return e.value-iq.value
}function gI(e){return hx.merge(e.map(function(iq){return(iq.children||[]).map(function(ir){return{source:iq,target:ir}
})
}))
}hx.layout.partition=function(){var ir=hx.layout.hierarchy(),it=[1,1];
function e(ix,iB,iD,iC){var iv=ix.children;
ix.x=iB;
ix.y=ix.depth*iC;
ix.dx=iD;
ix.dy=iC;
if(iv&&(iw=iv.length)){var iy=-1,iw,iA,iz;
iD=ix.value?iD/ix.value:0;
while(++iy<iw){e(iA=iv[iy],iB,iz=iA.value*iD,iC);
iB+=iz
}}}function iu(ix){var iw=ix.children,iy=0;
if(iw&&(iz=iw.length)){var iv=-1,iz;
while(++iv<iz){iy=Math.max(iy,iu(iw[iv]))
}}return 1+iy
}function iq(ix,iw){var iv=ir.call(this,ix,iw);
e(iv[0],0,it[0],it[1]/iu(iv[0]));
return iv
}iq.size=function(iv){if(!arguments.length){return it
}it=iv;
return iq
};
return gE(iq,ir)
};
hx.layout.pie=function(){var iu=Number,it=aa,ir=0,iq=gl;
function e(iA){var ix=iA.map(function(iC,iB){return +iu.call(e,iC,iB)
});
var iv=+(typeof ir==="function"?ir.apply(this,arguments):ir);
var iw=((typeof iq==="function"?iq.apply(this,arguments):iq)-iv)/hx.sum(ix);
var iy=hx.range(iA.length);
if(it!=null){iy.sort(it===aa?function(iC,iB){return ix[iB]-ix[iC]
}:function(iC,iB){return it(iA[iC],iA[iB])
})
}var iz=[];
iy.forEach(function(iB){var iC;
iz[iB]={data:iA[iB],value:iC=ix[iB],startAngle:iv,endAngle:iv+=iC*iw}
});
return iz
}e.value=function(iv){if(!arguments.length){return iu
}iu=iv;
return e
};
e.sort=function(iv){if(!arguments.length){return it
}it=iv;
return e
};
e.startAngle=function(iv){if(!arguments.length){return ir
}ir=iv;
return e
};
e.endAngle=function(iv){if(!arguments.length){return iq
}iq=iv;
return e
};
return e
};
var aa={};
hx.layout.stack=function(){var it=gx,ir=bU,iv=fT,iu=fU,iq=au,iw=ar;
function e(iE,iG){var iF=iE.map(function(iJ,iI){return it.call(e,iJ,iI)
});
var iH=iF.map(function(iI){return iI.map(function(iJ,iK){return[iq.call(e,iJ,iK),iw.call(e,iJ,iK)]
})
});
var iB=ir.call(e,iH,iG);
iF=hx.permute(iF,iB);
iH=hx.permute(iH,iB);
var iA=iv.call(e,iH,iG);
var iy=iF.length,iz=iF[0].length,iD,iC,ix;
for(iC=0;
iC<iz;
++iC){iu.call(e,iF[0][iC],ix=iA[iC],iH[0][iC][1]);
for(iD=1;
iD<iy;
++iD){iu.call(e,iF[iD][iC],ix+=iH[iD-1][iC][1],iH[iD][iC][1])
}}return iE
}e.values=function(ix){if(!arguments.length){return it
}it=ix;
return e
};
e.order=function(ix){if(!arguments.length){return ir
}ir=typeof ix==="function"?ix:a9.get(ix)||bU;
return e
};
e.offset=function(ix){if(!arguments.length){return iv
}iv=typeof ix==="function"?ix:am.get(ix)||fT;
return e
};
e.x=function(ix){if(!arguments.length){return iq
}iq=ix;
return e
};
e.y=function(ix){if(!arguments.length){return iw
}iw=ix;
return e
};
e.out=function(ix){if(!arguments.length){return iu
}iu=ix;
return e
};
return e
};
function au(e){return e.x
}function ar(e){return e.y
}function fU(iq,e,ir){iq.y0=e;
iq.y=ir
}var a9=hx.map({"inside-out":function(iu){var ir=iu.length,iv,it,iz=iu.map(bZ),iw=iu.map(dB),ix=hx.range(ir).sort(function(iC,iB){return iz[iC]-iz[iB]
}),iy=0,e=0,iA=[],iq=[];
for(iv=0;
iv<ir;
++iv){it=ix[iv];
if(iy<e){iy+=iw[it];
iA.push(it)
}else{e+=iw[it];
iq.push(it)
}}return iq.reverse().concat(iA)
},reverse:function(e){return hx.range(e.length).reverse()
},"default":bU});
var am=hx.map({silhouette:function(iu){var iq=iu.length,ir=iu[0].length,iw=[],ix=0,iv,it,e,iy=[];
for(it=0;
it<ir;
++it){for(iv=0,e=0;
iv<iq;
iv++){e+=iu[iv][it][1]
}if(e>ix){ix=e
}iw.push(e)
}for(it=0;
it<ir;
++it){iy[it]=(ix-iw[it])/2
}return iy
},wiggle:function(iw){var iq=iw.length,iz=iw[0],ir=iz.length,ix,iv,iu,iC,iB,iy,iD,e,it,iA=[];
iA[0]=e=it=0;
for(iv=1;
iv<ir;
++iv){for(ix=0,iC=0;
ix<iq;
++ix){iC+=iw[ix][iv][1]
}for(ix=0,iB=0,iD=iz[iv][0]-iz[iv-1][0];
ix<iq;
++ix){for(iu=0,iy=(iw[ix][iv][1]-iw[ix][iv-1][1])/(2*iD);
iu<ix;
++iu){iy+=(iw[iu][iv][1]-iw[iu][iv-1][1])/iD
}iB+=iy*iw[ix][iv][1]
}iA[iv]=e-=iC?iB/iC*iD:0;
if(e<it){it=e
}}for(iv=0;
iv<ir;
++iv){iA[iv]-=it
}return iA
},expand:function(iv){var ix=iv.length,e=iv[0].length,iq=1/ix,it,ir,iw,iu=[];
for(ir=0;
ir<e;
++ir){for(it=0,iw=0;
it<ix;
it++){iw+=iv[it][ir][1]
}if(iw){for(it=0;
it<ix;
it++){iv[it][ir][1]/=iw
}}else{for(it=0;
it<ix;
it++){iv[it][ir][1]=iq
}}}for(ir=0;
ir<e;
++ir){iu[ir]=0
}return iu
},zero:fT});
function bU(e){return hx.range(e.length)
}function fT(it){var iq=-1,e=it[0].length,ir=[];
while(++iq<e){ir[iq]=0
}return ir
}function bZ(iv){var it=1,ir=0,iq=iv[0][1],e,iu=iv.length;
for(;
it<iu;
++it){if((e=iv[it][1])>iq){ir=it;
iq=e
}}return ir
}function dB(e){return e.reduce(fS,0)
}function fS(e,iq){return e+iq[1]
}hx.layout.histogram=function(){var iu=true,iq=Number,e=bn,ir=hG;
function it(iy,iz){var iE=[],iC=iy.map(iq,this),iA=e.call(this,iC,iz),iD=ir.call(this,iA,iC,iz),iF,iz=-1,iv=iC.length,iw=iD.length-1,ix=iu?1:1/iv,iB;
while(++iz<iw){iF=iE[iz]=[];
iF.dx=iD[iz+1]-(iF.x=iD[iz]);
iF.y=0
}if(iw>0){iz=-1;
while(++iz<iv){iB=iC[iz];
if(iB>=iA[0]&&iB<=iA[1]){iF=iE[hx.bisect(iD,iB,1,iw)-1];
iF.y+=ix;
iF.push(iy[iz])
}}}return iE
}it.value=function(iv){if(!arguments.length){return iq
}iq=iv;
return it
};
it.range=function(iv){if(!arguments.length){return e
}e=X(iv);
return it
};
it.bins=function(iv){if(!arguments.length){return ir
}ir=typeof iv==="number"?function(iw){return h(iw,iv)
}:X(iv);
return it
};
it.frequency=function(iv){if(!arguments.length){return iu
}iu=!!iv;
return it
};
return it
};
function hG(iq,e){return h(iq,Math.ceil(Math.log(e.length)/Math.LN2+1))
}function h(it,iv){var ir=-1,iq=+it[0],e=(it[1]-iq)/iv,iu=[];
while(++ir<=iv){iu[ir]=e*ir+iq
}return iu
}function bn(e){return[hx.min(e),hx.max(e)]
}hx.layout.tree=function(){var ir=hx.layout.hierarchy().sort(null).value(null),iu=dG,it=[1,1],iq=false;
function e(iC,iA){var iw=ir.call(this,iC,iA),iE=iw[0];
function iB(iM,iI){var iK=iM.children,iP=iM._tree;
if(iK&&(iL=iK.length)){var iL,iR=iK[0],iQ,iO=iR,iJ,iN=-1;
while(++iN<iL){iJ=iK[iN];
iB(iJ,iQ);
iO=iv(iJ,iQ,iO);
iQ=iJ
}dJ(iM);
var iS=0.5*(iR._tree.prelim+iJ._tree.prelim);
if(iI){iP.prelim=iI._tree.prelim+iu(iM,iI);
iP.mod=iP.prelim-iS
}else{iP.prelim=iS
}}else{if(iI){iP.prelim=iI._tree.prelim+iu(iM,iI)
}}}function iD(iL,iI){iL.x=iL._tree.prelim+iI;
var iK=iL.children;
if(iK&&(iM=iK.length)){var iJ=-1,iM;
iI+=iL._tree.mod;
while(++iJ<iM){iD(iK[iJ],iI)
}}}function iv(iM,iI,iP){if(iI){var iL=iM,iK=iM,iO=iI,iN=iM.parent.children[0],iR=iL._tree.mod,iQ=iK._tree.mod,iT=iO._tree.mod,iS=iN._tree.mod,iJ;
while(iO=aF(iO),iL=h9(iL),iO&&iL){iN=h9(iN);
iK=aF(iK);
iK._tree.ancestor=iM;
iJ=iO._tree.prelim+iT-iL._tree.prelim-iR+iu(iO,iL);
if(iJ>0){ib(gc(iO,iM,iP),iM,iJ);
iR+=iJ;
iQ+=iJ
}iT+=iO._tree.mod;
iR+=iL._tree.mod;
iS+=iN._tree.mod;
iQ+=iK._tree.mod
}if(iO&&!aF(iK)){iK._tree.thread=iO;
iK._tree.mod+=iT-iQ
}if(iL&&!h9(iN)){iN._tree.thread=iL;
iN._tree.mod+=iR-iS;
iP=iM
}}return iP
}hO(iE,function(iJ,iI){iJ._tree={ancestor:iJ,prelim:0,mod:0,change:0,shift:0,number:iI?iI._tree.number+1:0}
});
iB(iE);
iD(iE,-iE._tree.prelim);
var iz=ec(iE,bJ),iH=ec(iE,c7),iG=ec(iE,I),iy=iz.x-iu(iz,iH)/2,ix=iH.x+iu(iH,iz)/2,iF=iG.depth||1;
hO(iE,iq?function(iI){iI.x*=it[0];
iI.y=iI.depth*it[1];
delete iI._tree
}:function(iI){iI.x=(iI.x-iy)/(ix-iy)*it[0];
iI.y=iI.depth/iF*it[1];
delete iI._tree
});
return iw
}e.separation=function(iv){if(!arguments.length){return iu
}iu=iv;
return e
};
e.size=function(iv){if(!arguments.length){return iq?null:it
}iq=(it=iv)==null;
return e
};
e.nodeSize=function(iv){if(!arguments.length){return iq?it:null
}iq=(it=iv)!=null;
return e
};
return gE(e,ir)
};
function dG(iq,e){return iq.parent==e.parent?1:2
}function h9(iq){var e=iq.children;
return e&&e.length?e[0]:iq._tree.thread
}function aF(iq){var e=iq.children,ir;
return e&&(ir=e.length)?e[ir-1]:iq._tree.thread
}function ec(ir,it){var iq=ir.children;
if(iq&&(iu=iq.length)){var iv,iu,e=-1;
while(++e<iu){if(it(iv=ec(iq[e],it),ir)>0){ir=iv
}}}return ir
}function c7(iq,e){return iq.x-e.x
}function bJ(iq,e){return e.x-iq.x
}function I(iq,e){return iq.depth-e.depth
}function hO(iq,ir){function e(ix,iw){var iv=ix.children;
if(iv&&(iy=iv.length)){var iz,iu=null,it=-1,iy;
while(++it<iy){iz=iv[it];
e(iz,iu);
iu=iz
}}ir(ix,iw)
}e(iq,null)
}function dJ(it){var e=0,iv=0,ir=it.children,iq=ir.length,iu;
while(--iq>=0){iu=ir[iq]._tree;
iu.prelim+=e;
iu.mod+=e;
e+=iu.shift+(iv+=iu.change)
}}function ib(iq,ir,e){iq=iq._tree;
ir=ir._tree;
var it=e/(ir.number-iq.number);
iq.change+=it;
ir.change-=it;
ir.shift+=e;
ir.prelim+=e;
ir.mod+=e
}function gc(e,ir,iq){return e._tree.ancestor.parent==ir.parent?e._tree.ancestor:iq
}hx.layout.pack=function(){var iq=hx.layout.hierarchy().sort(eK),iu=0,it=[1,1],e;
function ir(iC,iy){var ix=iq.call(this,iC,iy),iw=ix[0],iv=it[0],iz=it[1],iA=e==null?Math.sqrt:typeof e==="function"?e:function(){return e
};
iw.x=iw.y=0;
hO(iw,function(iD){iD.r=+iA(iD.value)
});
hO(iw,Z);
if(iu){var iB=iu*(e?1:Math.max(2*iw.r/iv,2*iw.r/iz))/2;
hO(iw,function(iD){iD.r+=iB
});
hO(iw,Z);
hO(iw,function(iD){iD.r-=iB
})
}fB(iw,iv/2,iz/2,e?1:1/Math.max(2*iw.r/iv,2*iw.r/iz));
return ix
}ir.size=function(iv){if(!arguments.length){return it
}it=iv;
return ir
};
ir.radius=function(iv){if(!arguments.length){return e
}e=iv==null||typeof iv==="function"?iv:+iv;
return ir
};
ir.padding=function(iv){if(!arguments.length){return iu
}iu=+iv;
return ir
};
return gE(ir,iq)
};
function eK(iq,e){return iq.value-e.value
}function bT(iq,e){var ir=iq._pack_next;
iq._pack_next=e;
e._pack_prev=iq;
e._pack_next=ir;
ir._pack_prev=e
}function bi(iq,e){iq._pack_next=e;
e._pack_prev=iq
}function ew(ir,e){var it=e.x-ir.x,iq=e.y-ir.y,iu=ir.r+e.r;
return 0.999*iu*iu>it*it+iq*iq
}function Z(iB){if(!(iA=iB.children)||!(iz=iA.length)){return
}var iA,iF=Infinity,iJ=-Infinity,e=Infinity,iu=-Infinity,iI,iH,iG,iE,iD,iC,iz;
function ir(iK){iF=Math.min(iK.x-iK.r,iF);
iJ=Math.max(iK.x+iK.r,iJ);
e=Math.min(iK.y-iK.r,e);
iu=Math.max(iK.y+iK.r,iu)
}iA.forEach(aW);
iI=iA[0];
iI.x=-iI.r;
iI.y=0;
ir(iI);
if(iz>1){iH=iA[1];
iH.x=iH.r;
iH.y=0;
ir(iH);
if(iz>2){iG=iA[2];
bh(iI,iH,iG);
ir(iG);
bT(iI,iG);
iI._pack_prev=iG;
bT(iG,iH);
iH=iI._pack_next;
for(iE=3;
iE<iz;
iE++){bh(iI,iH,iG=iA[iE]);
var iq=0,iv=1,it=1;
for(iD=iH._pack_next;
iD!==iH;
iD=iD._pack_next,iv++){if(ew(iD,iG)){iq=1;
break
}}if(iq==1){for(iC=iI._pack_prev;
iC!==iD._pack_prev;
iC=iC._pack_prev,it++){if(ew(iC,iG)){break
}}}if(iq){if(iv<it||iv==it&&iH.r<iI.r){bi(iI,iH=iD)
}else{bi(iI=iC,iH)
}iE--
}else{bT(iI,iG);
iH=iG;
ir(iG)
}}}}var ix=(iF+iJ)/2,iw=(e+iu)/2,iy=0;
for(iE=0;
iE<iz;
iE++){iG=iA[iE];
iG.x-=ix;
iG.y-=iw;
iy=Math.max(iy,iG.r+Math.sqrt(iG.x*iG.x+iG.y*iG.y))
}iB.r=iy;
iA.forEach(eZ)
}function aW(e){e._pack_next=e._pack_prev=e
}function eZ(e){delete e._pack_next;
delete e._pack_prev
}function fB(iu,e,iw,iq){var it=iu.children;
iu.x=e+=iq*iu.x;
iu.y=iw+=iq*iu.y;
iu.r*=iq;
if(it){var ir=-1,iv=it.length;
while(++ir<iv){fB(it[ir],e,iw,iq)
}}}function bh(iu,ir,e){var iw=iu.r+e.r,iz=ir.x-iu.x,ix=ir.y-iu.y;
if(iw&&(iz||ix)){var iy=ir.r+e.r,iv=iz*iz+ix*ix;
iy*=iy;
iw*=iw;
var it=0.5+(iw-iy)/(2*iv),iq=Math.sqrt(Math.max(0,2*iy*(iw+iv)-(iw-=iv)*iw-iy*iy))/(2*iv);
e.x=iu.x+it*iz+iq*ix;
e.y=iu.y+it*ix-iq*iz
}else{e.x=iu.x+iw;
e.y=iu.y
}}hx.layout.cluster=function(){var ir=hx.layout.hierarchy().sort(null).value(null),iu=dG,it=[1,1],iq=false;
function e(iA,iz){var iv=ir.call(this,iA,iz),iB=iv[0],iC,iD=0;
hO(iB,function(iG){var iF=iG.children;
if(iF&&iF.length){iG.x=bz(iF);
iG.y=by(iF)
}else{iG.x=iC?iD+=iu(iG,iC):0;
iG.y=0;
iC=iG
}});
var iy=eM(iB),iE=dN(iB),ix=iy.x-iu(iy,iE)/2,iw=iE.x+iu(iE,iy)/2;
hO(iB,iq?function(iF){iF.x=(iF.x-iB.x)*it[0];
iF.y=(iB.y-iF.y)*it[1]
}:function(iF){iF.x=(iF.x-ix)/(iw-ix)*it[0];
iF.y=(1-(iB.y?iF.y/iB.y:1))*it[1]
});
return iv
}e.separation=function(iv){if(!arguments.length){return iu
}iu=iv;
return e
};
e.size=function(iv){if(!arguments.length){return iq?null:it
}iq=(it=iv)==null;
return e
};
e.nodeSize=function(iv){if(!arguments.length){return iq?it:null
}iq=(it=iv)!=null;
return e
};
return gE(e,ir)
};
function by(e){return 1+hx.max(e,function(iq){return iq.y
})
}function bz(e){return e.reduce(function(iq,ir){return iq+ir.x
},0)/e.length
}function eM(iq){var e=iq.children;
return e&&e.length?eM(e[0]):iq
}function dN(iq){var e=iq.children,ir;
return e&&(ir=e.length)?dN(e[ir-1]):iq
}hx.layout.treemap=function(){var iy=hx.layout.hierarchy(),iC=Math.round,iE=[1,1],iz=null,e=fn,iA=false,iw,iv="squarify",ix=0.5*(1+Math.sqrt(5));
function iq(iH,iF){var iG=-1,iK=iH.length,iJ,iI;
while(++iG<iK){iI=(iJ=iH[iG]).value*(iF<0?0:iF);
iJ.area=isNaN(iI)||iI<=0?0:iI
}}function it(iJ){var iG=iJ.children;
if(iG&&iG.length){var iM=e(iJ),iO=[],iL=iG.slice(),iF,iK=Infinity,iI,iN=iv==="slice"?iM.dx:iv==="dice"?iM.dy:iv==="slice-dice"?iJ.depth&1?iM.dy:iM.dx:Math.min(iM.dx,iM.dy),iH;
iq(iL,iM.dx*iM.dy/iJ.value);
iO.area=0;
while((iH=iL.length)>0){iO.push(iF=iL[iH-1]);
iO.area+=iF.area;
if(iv!=="squarify"||(iI=ir(iO,iN))<=iK){iL.pop();
iK=iI
}else{iO.area-=iO.pop().area;
iu(iO,iN,iM,false);
iN=Math.min(iM.dx,iM.dy);
iO.length=iO.area=0;
iK=Infinity
}}if(iO.length){iu(iO,iN,iM,true);
iO.length=iO.area=0
}iG.forEach(it)
}}function iD(iI){var iF=iI.children;
if(iF&&iF.length){var iH=e(iI),iG=iF.slice(),iK,iJ=[];
iq(iG,iH.dx*iH.dy/iI.value);
iJ.area=0;
while(iK=iG.pop()){iJ.push(iK);
iJ.area+=iK.area;
if(iK.z!=null){iu(iJ,iK.z?iH.dx:iH.dy,iH,!iG.length);
iJ.length=iJ.area=0
}}iF.forEach(iD)
}}function ir(iK,iG){var iI=iK.area,iJ,iM=0,iF=Infinity,iH=-1,iL=iK.length;
while(++iH<iL){if(!(iJ=iK[iH].area)){continue
}if(iJ<iF){iF=iJ
}if(iJ>iM){iM=iJ
}}iI*=iI;
iG*=iG;
return iI?Math.max(iG*iM*ix/iI,iI/(iG*iF*ix)):Infinity
}function iu(iO,iN,iJ,iM){var iH=-1,iG=iO.length,iK=iJ.x,iI=iJ.y,iL=iN?iC(iO.area/iN):0,iF;
if(iN==iJ.dx){if(iM||iL>iJ.dy){iL=iJ.dy
}while(++iH<iG){iF=iO[iH];
iF.x=iK;
iF.y=iI;
iF.dy=iL;
iK+=iF.dx=Math.min(iJ.x+iJ.dx-iK,iL?iC(iF.area/iL):0)
}iF.z=true;
iF.dx+=iJ.x+iJ.dx-iK;
iJ.y+=iL;
iJ.dy-=iL
}else{if(iM||iL>iJ.dx){iL=iJ.dx
}while(++iH<iG){iF=iO[iH];
iF.x=iK;
iF.y=iI;
iF.dx=iL;
iI+=iF.dy=Math.min(iJ.y+iJ.dy-iI,iL?iC(iF.area/iL):0)
}iF.z=false;
iF.dy+=iJ.y+iJ.dy-iI;
iJ.x+=iL;
iJ.dx-=iL
}}function iB(iH){var iG=iw||iy(iH),iF=iG[0];
iF.x=0;
iF.y=0;
iF.dx=iE[0];
iF.dy=iE[1];
if(iw){iy.revalue(iF)
}iq([iF],iF.dx*iF.dy/iF.value);
(iw?iD:it)(iF);
if(iA){iw=iG
}return iG
}iB.size=function(iF){if(!arguments.length){return iE
}iE=iF;
return iB
};
iB.padding=function(iF){if(!arguments.length){return iz
}function iI(iJ){var iK=iF.call(iB,iJ,iJ.depth);
return iK==null?fn(iJ):a4(iJ,typeof iK==="number"?[iK,iK,iK,iK]:iK)
}function iH(iJ){return a4(iJ,iF)
}var iG;
e=(iz=iF)==null?fn:(iG=typeof iF)==="function"?iI:iG==="number"?(iF=[iF,iF,iF,iF],iH):iH;
return iB
};
iB.round=function(iF){if(!arguments.length){return iC!=Number
}iC=iF?Math.round:Number;
return iB
};
iB.sticky=function(iF){if(!arguments.length){return iA
}iA=iF;
iw=null;
return iB
};
iB.ratio=function(iF){if(!arguments.length){return ix
}ix=iF;
return iB
};
iB.mode=function(iF){if(!arguments.length){return iv
}iv=iF+"";
return iB
};
return gE(iB,iy)
};
function fn(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}
}function a4(it,iu){var e=it.x+iu[3],iv=it.y+iu[0],ir=it.dx-iu[1]-iu[3],iq=it.dy-iu[0]-iu[2];
if(ir<0){e+=ir/2;
ir=0
}if(iq<0){iv+=iq/2;
iq=0
}return{x:e,y:iv,dx:ir,dy:iq}
}hx.random={normal:function(iq,e){var ir=arguments.length;
if(ir<2){e=1
}if(ir<1){iq=0
}return function(){var it,iv,iu;
do{it=Math.random()*2-1;
iv=Math.random()*2-1;
iu=it*it+iv*iv
}while(!iu||iu>1);
return iq+e*it*Math.sqrt(-2*Math.log(iu)/iu)
}
},logNormal:function(){var e=hx.random.normal.apply(hx,arguments);
return function(){return Math.exp(e())
}
},bates:function(e){var iq=hx.random.irwinHall(e);
return function(){return iq()/e
}
},irwinHall:function(e){return function(){for(var ir=0,iq=0;
iq<e;
iq++){ir+=Math.random()
}return ir
}
}};
hx.scale={};
function eC(iq){var ir=iq[0],e=iq[iq.length-1];
return ir<e?[ir,e]:[e,ir]
}function a3(e){return e.rangeExtent?e.rangeExtent():eC(e.range())
}function aK(iu,e,iv,ir){var iq=iv(iu[0],iu[1]),it=ir(e[0],e[1]);
return function(iw){return it(iq(iw))
}
}function gv(iw,iu){var iv=0,it=iw.length-1,ir=iw[iv],iq=iw[it],e;
if(iq<ir){e=iv,iv=it,it=e;
e=ir,ir=iq,iq=e
}iw[iv]=iu.floor(ir);
iw[it]=iu.ceil(iq);
return iw
}function ba(e){return e?{floor:function(iq){return Math.floor(iq/e)*e
},ceil:function(iq){return Math.ceil(iq/e)*e
}}:eL
}var eL={floor:gx,ceil:gx};
function R(iw,iq,ix,iu){var it=[],iv=[],ir=0,e=Math.min(iw.length,iq.length)-1;
if(iw[e]<iw[0]){iw=iw.slice().reverse();
iq=iq.slice().reverse()
}while(++ir<=e){it.push(ix(iw[ir-1],iw[ir]));
iv.push(iu(iq[ir-1],iq[ir]))
}return function(iy){var iz=hx.bisect(iw,iy,1,e)-1;
return iv[iz](it[iz](iy))
}
}hx.scale.linear=function(){return eu([0,1],[0,1],fR,false)
};
function eu(iv,it,iu,ix){var ir,iq;
function e(){var iy=Math.min(iv.length,it.length)>2?R:aK,iz=ix?aE:hF;
ir=iy(iv,it,iz,iu);
iq=iy(it,iv,iz,fR);
return iw
}function iw(iy){return ir(iy)
}iw.invert=function(iy){return iq(iy)
};
iw.domain=function(iy){if(!arguments.length){return iv
}iv=iy.map(Number);
return e()
};
iw.range=function(iy){if(!arguments.length){return it
}it=iy;
return e()
};
iw.rangeRound=function(iy){return iw.range(iy).interpolate(fM)
};
iw.clamp=function(iy){if(!arguments.length){return ix
}ix=iy;
return e()
};
iw.interpolate=function(iy){if(!arguments.length){return iu
}iu=iy;
return e()
};
iw.ticks=function(iy){return fd(iv,iy)
};
iw.tickFormat=function(iy,iz){return fp(iv,iy,iz)
};
iw.nice=function(iy){aS(iv,iy);
return e()
};
iw.copy=function(){return eu(iv,it,iu,ix)
};
return e()
}function gn(iq,e){return hx.rebind(iq,e,"range","rangeRound","interpolate","clamp")
}function aS(iq,e){return gv(iq,ba(q(iq,e)[2]))
}function q(iv,e){if(e==null){e=10
}var ir=eC(iv),iq=ir[1]-ir[0],iu=Math.pow(10,Math.floor(Math.log(iq/e)/Math.LN10)),it=e/iq*iu;
if(it<=0.15){iu*=10
}else{if(it<=0.35){iu*=5
}else{if(it<=0.75){iu*=2
}}}ir[0]=Math.ceil(ir[0]/iu)*iu;
ir[1]=Math.floor(ir[1]/iu)*iu+iu*0.5;
ir[2]=iu;
return ir
}function fd(iq,e){return hx.range.apply(hx,q(iq,e))
}function fp(ir,e,it){var iq=q(ir,e);
return hx.format(it?it.replace(cF,function(iD,iC,iB,iA,iz,iy,ix,iw,iv,iu){return[iC,iB,iA,iz,iy,ix,iw,iv||"."+A(iu,iq),iu].join("")
}):",."+g6(iq[2])+"f")
}var h8={s:1,g:1,p:1,r:1,e:1};
function g6(e){return -Math.floor(Math.log(e)/Math.LN10+0.01)
}function A(iq,e){var ir=g6(e[2]);
return iq in h8?Math.abs(ir-g6(Math.max(Math.abs(e[0]),Math.abs(e[1]))))+ +(iq!=="e"):ir-(iq==="%")*2
}hx.scale.log=function(){return gS(hx.scale.linear().domain([0,1]),10,true,[1,10])
};
function gS(iq,iv,e,iu){function ir(ix){return(e?Math.log(ix<0?0:ix):-Math.log(ix>0?0:-ix))/Math.log(iv)
}function it(ix){return e?Math.pow(iv,ix):-Math.pow(iv,-ix)
}function iw(ix){return iq(ir(ix))
}iw.invert=function(ix){return it(iq.invert(ix))
};
iw.domain=function(ix){if(!arguments.length){return iu
}e=ix[0]>=0;
iq.domain((iu=ix.map(Number)).map(ir));
return iw
};
iw.base=function(ix){if(!arguments.length){return iv
}iv=+ix;
iq.domain(iu.map(ir));
return iw
};
iw.nice=function(){var ix=gv(iu.map(ir),e?Math:gW);
iq.domain(ix);
iu=ix.map(it);
return iw
};
iw.ticks=function(){var iC=eC(iu),iD=[],iA=iC[0],iy=iC[1],iB=Math.floor(ir(iA)),iz=Math.ceil(ir(iy)),iE=iv%1?2:iv;
if(isFinite(iz-iB)){if(e){for(;
iB<iz;
iB++){for(var ix=1;
ix<iE;
ix++){iD.push(it(iB)*ix)
}}iD.push(it(iB))
}else{iD.push(it(iB));
for(;
iB++<iz;
){for(var ix=iE-1;
ix>0;
ix--){iD.push(it(iB)*ix)
}}}for(iB=0;
iD[iB]<iA;
iB++){}for(iz=iD.length;
iD[iz-1]>iy;
iz--){}iD=iD.slice(iB,iz)
}return iD
};
iw.tickFormat=function(iB,iA){if(!arguments.length){return dA
}if(arguments.length<2){iA=dA
}else{if(typeof iA!=="function"){iA=hx.format(iA)
}}var ix=Math.max(0.1,iB/iw.ticks().length),iy=e?(iz=1e-12,Math.ceil):(iz=-1e-12,Math.floor),iz;
return function(iC){return iC/it(iy(ir(iC)+iz))<=ix?iA(iC):""
}
};
iw.copy=function(){return gS(iq.copy(),iv,e,iu)
};
return gn(iw,iq)
}var dA=hx.format(".0e"),gW={floor:function(e){return -Math.ceil(-e)
},ceil:function(e){return -Math.floor(-e)
}};
hx.scale.pow=function(){return gD(hx.scale.linear(),1,[0,1])
};
function gD(e,it,ir){var iq=f8(it),iu=f8(1/it);
function iv(iw){return e(iq(iw))
}iv.invert=function(iw){return iu(e.invert(iw))
};
iv.domain=function(iw){if(!arguments.length){return ir
}e.domain((ir=iw.map(Number)).map(iq));
return iv
};
iv.ticks=function(iw){return fd(ir,iw)
};
iv.tickFormat=function(iw,ix){return fp(ir,iw,ix)
};
iv.nice=function(iw){return iv.domain(aS(ir,iw))
};
iv.exponent=function(iw){if(!arguments.length){return it
}iq=f8(it=iw);
iu=f8(1/it);
e.domain(ir.map(iq));
return iv
};
iv.copy=function(){return gD(e.copy(),it,ir)
};
return gn(iv,e)
}function f8(iq){return function(e){return e<0?-Math.pow(-e,iq):Math.pow(e,iq)
}
}hx.scale.sqrt=function(){return hx.scale.pow().exponent(0.5)
};
hx.scale.ordinal=function(){return cx([],{t:"range",a:[[]]})
};
function cx(iv,ir){var iu,iq,it;
function iw(ix){return iq[((iu.get(ix)||ir.t==="range"&&iu.set(ix,iv.push(ix)))-1)%iq.length]
}function e(iy,ix){return hx.range(iv.length).map(function(iz){return iy+ix*iz
})
}iw.domain=function(ix){if(!arguments.length){return iv
}iv=[];
iu=new aM();
var iz=-1,iA=ix.length,iy;
while(++iz<iA){if(!iu.has(iy=ix[iz])){iu.set(iy,iv.push(iy))
}}return iw[ir.t].apply(iw,ir.a)
};
iw.range=function(ix){if(!arguments.length){return iq
}iq=ix;
it=0;
ir={t:"range",a:arguments};
return iw
};
iw.rangePoints=function(ix,iA){if(arguments.length<2){iA=0
}var iB=ix[0],iy=ix[1],iz=(iy-iB)/(Math.max(1,iv.length-1)+iA);
iq=e(iv.length<2?(iB+iy)/2:iB+iz*iA/2,iz);
it=0;
ir={t:"rangePoints",a:arguments};
return iw
};
iw.rangeBands=function(iy,iC,ix){if(arguments.length<2){iC=0
}if(arguments.length<3){ix=iC
}var iz=iy[1]<iy[0],iD=iy[iz-0],iA=iy[1-iz],iB=(iA-iD)/(iv.length-iC+2*ix);
iq=e(iD+iB*ix,iB);
if(iz){iq.reverse()
}it=iB*(1-iC);
ir={t:"rangeBands",a:arguments};
return iw
};
iw.rangeRoundBands=function(iy,iD,ix){if(arguments.length<2){iD=0
}if(arguments.length<3){ix=iD
}var iA=iy[1]<iy[0],iE=iy[iA-0],iB=iy[1-iA],iC=Math.floor((iB-iE)/(iv.length-iD+2*ix)),iz=iB-iE-(iv.length-iD)*iC;
iq=e(iE+Math.round(iz/2),iC);
if(iA){iq.reverse()
}it=Math.round(iC*(1-iD));
ir={t:"rangeRoundBands",a:arguments};
return iw
};
iw.rangeBand=function(){return it
};
iw.rangeExtent=function(){return eC(ir.a[0])
};
iw.copy=function(){return cx(iv,ir)
};
return iw.domain(iv)
}hx.scale.category10=function(){return hx.scale.ordinal().range(cG)
};
hx.scale.category20=function(){return hx.scale.ordinal().range(cl)
};
hx.scale.category20b=function(){return hx.scale.ordinal().range(hm)
};
hx.scale.category20c=function(){return hx.scale.ordinal().range(hk)
};
var cG=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(dD);
var cl=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(dD);
var hm=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(dD);
var hk=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(dD);
hx.scale.quantile=function(){return E([],[])
};
function E(ir,iq){var it;
function e(){var iv=0,iw=iq.length;
it=[];
while(++iv<iw){it[iv-1]=hx.quantile(ir,iv/iw)
}return iu
}function iu(iv){if(!isNaN(iv=+iv)){return iq[hx.bisect(it,iv)]
}}iu.domain=function(iv){if(!arguments.length){return ir
}ir=iv.filter(function(iw){return !isNaN(iw)
}).sort(hx.ascending);
return e()
};
iu.range=function(iv){if(!arguments.length){return iq
}iq=iv;
return e()
};
iu.quantiles=function(){return it
};
iu.invertExtent=function(iv){iv=iq.indexOf(iv);
return iv<0?[NaN,NaN]:[iv>0?it[iv-1]:ir[0],iv<it.length?it[iv]:ir[ir.length-1]]
};
iu.copy=function(){return E(ir,iq)
};
return e()
}hx.scale.quantize=function(){return dM(0,1,[0,1])
};
function dM(iu,ir,iq){var iv,it;
function iw(ix){return iq[Math.max(0,Math.min(it,Math.floor(iv*(ix-iu))))]
}function e(){iv=iq.length/(ir-iu);
it=iq.length-1;
return iw
}iw.domain=function(ix){if(!arguments.length){return[iu,ir]
}iu=+ix[0];
ir=+ix[ix.length-1];
return e()
};
iw.range=function(ix){if(!arguments.length){return iq
}iq=ix;
return e()
};
iw.invertExtent=function(ix){ix=iq.indexOf(ix);
ix=ix<0?NaN:ix/iv+iu;
return[ix,ix+1/iv]
};
iw.copy=function(){return dM(iu,ir,iq)
};
return e()
}hx.scale.threshold=function(){return gi([0.5],[0,1])
};
function gi(iq,e){function ir(it){if(it<=it){return e[hx.bisect(iq,it)]
}}ir.domain=function(it){if(!arguments.length){return iq
}iq=it;
return ir
};
ir.range=function(it){if(!arguments.length){return e
}e=it;
return ir
};
ir.invertExtent=function(it){it=e.indexOf(it);
return[iq[it-1],iq[it]]
};
ir.copy=function(){return gi(iq,e)
};
return ir
}hx.scale.identity=function(){return e3([0,1])
};
function e3(iq){function e(ir){return +ir
}e.invert=e;
e.domain=e.range=function(ir){if(!arguments.length){return iq
}iq=ir.map(e);
return e
};
e.ticks=function(ir){return fd(iq,ir)
};
e.tickFormat=function(ir,it){return fp(iq,ir,it)
};
e.copy=function(){return e3(iq)
};
return e
}hx.svg={};
hx.svg.arc=function(){var iu=bD,it=cY,ir=gt,e=av;
function iq(){var iy=iu.apply(this,arguments),ix=it.apply(this,arguments),iw=ir.apply(this,arguments)+hR,iv=e.apply(this,arguments)+hR,iE=(iv<iw&&(iE=iw,iw=iv,iv=iE),iv-iw),iB=iE<gq?"0":"1",iA=Math.cos(iw),iD=Math.sin(iw),iz=Math.cos(iv),iC=Math.sin(iv);
return iE>=hW?iy?"M0,"+ix+"A"+ix+","+ix+" 0 1,1 0,"+-ix+"A"+ix+","+ix+" 0 1,1 0,"+ix+"M0,"+iy+"A"+iy+","+iy+" 0 1,0 0,"+-iy+"A"+iy+","+iy+" 0 1,0 0,"+iy+"Z":"M0,"+ix+"A"+ix+","+ix+" 0 1,1 0,"+-ix+"A"+ix+","+ix+" 0 1,1 0,"+ix+"Z":iy?"M"+ix*iA+","+ix*iD+"A"+ix+","+ix+" 0 "+iB+",1 "+ix*iz+","+ix*iC+"L"+iy*iz+","+iy*iC+"A"+iy+","+iy+" 0 "+iB+",0 "+iy*iA+","+iy*iD+"Z":"M"+ix*iA+","+ix*iD+"A"+ix+","+ix+" 0 "+iB+",1 "+ix*iz+","+ix*iC+"L0,0Z"
}iq.innerRadius=function(iv){if(!arguments.length){return iu
}iu=X(iv);
return iq
};
iq.outerRadius=function(iv){if(!arguments.length){return it
}it=X(iv);
return iq
};
iq.startAngle=function(iv){if(!arguments.length){return ir
}ir=X(iv);
return iq
};
iq.endAngle=function(iv){if(!arguments.length){return e
}e=X(iv);
return iq
};
iq.centroid=function(){var iw=(iu.apply(this,arguments)+it.apply(this,arguments))/2,iv=(ir.apply(this,arguments)+e.apply(this,arguments))/2+hR;
return[Math.cos(iv)*iw,Math.sin(iv)*iw]
};
return iq
};
var hR=-ez,hW=gl-gA;
function bD(e){return e.innerRadius
}function cY(e){return e.outerRadius
}function gt(e){return e.startAngle
}function av(e){return e.endAngle
}function fo(iq){var e=h5,ix=h4,iw=an,it=h2,iv=it.key,iu=0.7;
function ir(iB){var iD=[],iG=[],iC=-1,iy=iB.length,iF,iA=X(e),iz=X(ix);
function iE(){iD.push("M",it(iq(iG),iu))
}while(++iC<iy){if(iw.call(this,iF=iB[iC],iC)){iG.push([+iA.call(this,iF,iC),+iz.call(this,iF,iC)])
}else{if(iG.length){iE();
iG=[]
}}}if(iG.length){iE()
}return iD.length?iD.join(""):null
}ir.x=function(iy){if(!arguments.length){return e
}e=iy;
return ir
};
ir.y=function(iy){if(!arguments.length){return ix
}ix=iy;
return ir
};
ir.defined=function(iy){if(!arguments.length){return iw
}iw=iy;
return ir
};
ir.interpolate=function(iy){if(!arguments.length){return iv
}if(typeof iy==="function"){iv=it=iy
}else{iv=(it=cg.get(iy)||h2).key
}return ir
};
ir.tension=function(iy){if(!arguments.length){return iu
}iu=iy;
return ir
};
return ir
}hx.svg.line=function(){return fo(gx)
};
var cg=hx.map({linear:h2,"linear-closed":af,step:dh,"step-before":bp,"step-after":hH,basis:ft,"basis-open":bm,"basis-closed":cT,bundle:cW,cardinal:d2,"cardinal-open":b6,"cardinal-closed":s,monotone:dr});
cg.forEach(function(e,iq){iq.key=e;
iq.closed=/-closed$/.test(e)
});
function h2(e){return e.join("L")
}function af(e){return h2(e)+"Z"
}function dh(iq){var e=0,iu=iq.length,it=iq[0],ir=[it[0],",",it[1]];
while(++e<iu){ir.push("H",(it[0]+(it=iq[e])[0])/2,"V",it[1])
}if(iu>1){ir.push("H",it[0])
}return ir.join("")
}function bp(iq){var e=0,iu=iq.length,it=iq[0],ir=[it[0],",",it[1]];
while(++e<iu){ir.push("V",(it=iq[e])[1],"H",it[0])
}return ir.join("")
}function hH(iq){var e=0,iu=iq.length,it=iq[0],ir=[it[0],",",it[1]];
while(++e<iu){ir.push("H",(it=iq[e])[0],"V",it[1])
}return ir.join("")
}function b6(iq,e){return iq.length<4?h2(iq):iq[1]+c4(iq.slice(1,iq.length-1),bY(iq,e))
}function s(iq,e){return iq.length<3?h2(iq):iq[0]+c4((iq.push(iq[0]),iq),bY([iq[iq.length-2]].concat(iq,[iq[1]]),e))
}function d2(iq,e){return iq.length<3?h2(iq):iq[0]+c4(iq,bY(iq,e))
}function c4(iw,iv){if(iv.length<1||iw.length!=iv.length&&iw.length!=iv.length+2){return h2(iw)
}var ix=iw.length!=iv.length,iA="",iy=iw[0],e=iw[1],iu=iv[0],iz=iu,ir=1;
if(ix){iA+="Q"+(e[0]-iu[0]*2/3)+","+(e[1]-iu[1]*2/3)+","+e[0]+","+e[1];
iy=iw[1];
ir=2
}if(iv.length>1){iz=iv[1];
e=iw[ir];
ir++;
iA+="C"+(iy[0]+iu[0])+","+(iy[1]+iu[1])+","+(e[0]-iz[0])+","+(e[1]-iz[1])+","+e[0]+","+e[1];
for(var iq=2;
iq<iv.length;
iq++,ir++){e=iw[ir];
iz=iv[iq];
iA+="S"+(e[0]-iz[0])+","+(e[1]-iz[1])+","+e[0]+","+e[1]
}}if(ix){var it=iw[ir];
iA+="Q"+(e[0]+iz[0]*2/3)+","+(e[1]+iz[1]*2/3)+","+it[0]+","+it[1]
}return iA
}function bY(iw,iu){var ir=[],it=(1-iu)/2,iy,ix=iw[0],iv=iw[1],iq=1,e=iw.length;
while(++iq<e){iy=ix;
ix=iv;
iv=iw[iq];
ir.push([it*(iv[0]-iy[0]),it*(iv[1]-iy[1])])
}return ir
}function ft(ix){if(ix.length<3){return h2(ix)
}var ir=1,iq=ix.length,it=ix[0],e=it[0],iv=it[1],iw=[e,e,e,(it=ix[1])[0]],iu=[iv,iv,iv,it[1]],iy=[e,",",iv,"L",gz(hw,iw),",",gz(hw,iu)];
ix.push(ix[iq-1]);
while(++ir<=iq){it=ix[ir];
iw.shift();
iw.push(it[0]);
iu.shift();
iu.push(it[1]);
bS(iy,iw,iu)
}ix.pop();
iy.push("L",it);
return iy.join("")
}function bm(it){if(it.length<4){return h2(it)
}var iv=[],ir=-1,iw=it.length,iu,iq=[0],e=[0];
while(++ir<3){iu=it[ir];
iq.push(iu[0]);
e.push(iu[1])
}iv.push(gz(hw,iq)+","+gz(hw,e));
--ir;
while(++ir<iw){iu=it[ir];
iq.shift();
iq.push(iu[0]);
e.shift();
e.push(iu[1]);
bS(iv,iq,e)
}return iv.join("")
}function cT(iu){var iw,it=-1,ix=iu.length,e=ix+4,iv,ir=[],iq=[];
while(++it<4){iv=iu[it%ix];
ir.push(iv[0]);
iq.push(iv[1])
}iw=[gz(hw,ir),",",gz(hw,iq)];
--it;
while(++it<e){iv=iu[it%ix];
ir.shift();
ir.push(iv[0]);
iq.shift();
iq.push(iv[1]);
bS(iw,ir,iq)
}return iw.join("")
}function cW(iw,iv){var ir=iw.length-1;
if(ir){var iq=iw[0][0],iu=iw[0][1],iz=iw[ir][0]-iq,iy=iw[ir][1]-iu,it=-1,e,ix;
while(++it<=ir){e=iw[it];
ix=it/ir;
e[0]=iv*e[0]+(1-iv)*(iq+ix*iz);
e[1]=iv*e[1]+(1-iv)*(iu+ix*iy)
}}return ft(iw)
}function gz(iq,e){return iq[0]*e[0]+iq[1]*e[1]+iq[2]*e[2]+iq[3]*e[3]
}var hA=[0,2/3,1/3,0],hy=[0,1/3,2/3,0],hw=[0,1/6,2/3,1/6];
function bS(iq,e,ir){iq.push("C",gz(hA,e),",",gz(hA,ir),",",gz(hy,e),",",gz(hy,ir),",",gz(hw,e),",",gz(hw,ir))
}function ig(iq,e){return(e[1]-iq[1])/(e[0]-iq[0])
}function ej(it){var ir=0,iq=it.length-1,e=[],iw=it[0],iv=it[1],iu=e[0]=ig(iw,iv);
while(++ir<iq){e[ir]=(iu+(iu=ig(iw=iv,iv=it[ir+1])))/2
}e[ir]=iu;
return e
}function az(ix){var iu=[],it,iw,iv,iy,e=ej(ix),ir=-1,iq=ix.length-1;
while(++ir<iq){it=ig(ix[ir],ix[ir+1]);
if(cM(it)<gA){e[ir]=e[ir+1]=0
}else{iw=e[ir]/it;
iv=e[ir+1]/it;
iy=iw*iw+iv*iv;
if(iy>9){iy=it*3/Math.sqrt(iy);
e[ir]=iy*iw;
e[ir+1]=iy*iv
}}}ir=-1;
while(++ir<=iq){iy=(ix[Math.min(iq,ir+1)][0]-ix[Math.max(0,ir-1)][0])/(6*(1+e[ir]*e[ir]));
iu.push([iy||0,e[ir]*iy||0])
}return iu
}function dr(e){return e.length<3?h2(e):e[0]+c4(e,az(e))
}hx.svg.line.radial=function(){var e=fo(U);
e.radius=e.x,delete e.x;
e.angle=e.y,delete e.y;
return e
};
function U(it){var e,ir=-1,iv=it.length,iu,iq;
while(++ir<iv){e=it[ir];
iu=e[0];
iq=e[1]+hR;
e[0]=iu*Math.cos(iq);
e[1]=iu*Math.sin(iq)
}return it
}function ij(iu){var ir=h5,iq=h5,iA=0,iy=h4,it=an,iv=h2,iB=iv.key,ix=iv,iw="L",iz=0.7;
function e(iG){var iI=[],iC=[],iP=[],iH=-1,iD=iG.length,iK,iF=X(ir),iO=X(iA),iE=ir===iq?function(){return iM
}:X(iq),iN=iA===iy?function(){return iL
}:X(iy),iM,iL;
function iJ(){iI.push("M",iv(iu(iP),iz),iw,ix(iu(iC.reverse()),iz),"Z")
}while(++iH<iD){if(it.call(this,iK=iG[iH],iH)){iC.push([iM=+iF.call(this,iK,iH),iL=+iO.call(this,iK,iH)]);
iP.push([+iE.call(this,iK,iH),+iN.call(this,iK,iH)])
}else{if(iC.length){iJ();
iC=[];
iP=[]
}}}if(iC.length){iJ()
}return iI.length?iI.join(""):null
}e.x=function(iC){if(!arguments.length){return iq
}ir=iq=iC;
return e
};
e.x0=function(iC){if(!arguments.length){return ir
}ir=iC;
return e
};
e.x1=function(iC){if(!arguments.length){return iq
}iq=iC;
return e
};
e.y=function(iC){if(!arguments.length){return iy
}iA=iy=iC;
return e
};
e.y0=function(iC){if(!arguments.length){return iA
}iA=iC;
return e
};
e.y1=function(iC){if(!arguments.length){return iy
}iy=iC;
return e
};
e.defined=function(iC){if(!arguments.length){return it
}it=iC;
return e
};
e.interpolate=function(iC){if(!arguments.length){return iB
}if(typeof iC==="function"){iB=iv=iC
}else{iB=(iv=cg.get(iC)||h2).key
}ix=iv.reverse||iv;
iw=iv.closed?"M":"L";
return e
};
e.tension=function(iC){if(!arguments.length){return iz
}iz=iC;
return e
};
return e
}bp.reverse=hH;
hH.reverse=bp;
hx.svg.area=function(){return ij(gx)
};
hx.svg.area.radial=function(){var e=ij(U);
e.radius=e.x,delete e.x;
e.innerRadius=e.x0,delete e.x0;
e.outerRadius=e.x1,delete e.x1;
e.angle=e.y,delete e.y;
e.startAngle=e.y0,delete e.y0;
e.endAngle=e.y1,delete e.y1;
return e
};
hx.svg.chord=function(){var e=hS,ix=h1,iw=M,iy=gt,iu=av;
function iv(iD,iB){var iC=iz(this,e,iD,iB),iA=iz(this,ix,iD,iB);
return"M"+iC.p0+iq(iC.r,iC.p1,iC.a1-iC.a0)+(ir(iC,iA)?it(iC.r,iC.p1,iC.r,iC.p0):it(iC.r,iC.p1,iA.r,iA.p0)+iq(iA.r,iA.p1,iA.a1-iA.a0)+it(iA.r,iA.p1,iC.r,iC.p0))+"Z"
}function iz(iD,iG,iH,iE){var iC=iG.call(iD,iH,iE),iF=iw.call(iD,iC,iE),iB=iy.call(iD,iC,iE)+hR,iA=iu.call(iD,iC,iE)+hR;
return{r:iF,a0:iB,a1:iA,p0:[iF*Math.cos(iB),iF*Math.sin(iB)],p1:[iF*Math.cos(iA),iF*Math.sin(iA)]}
}function ir(iB,iA){return iB.a0==iA.a0&&iB.a1==iA.a1
}function iq(iB,iC,iA){return"A"+iB+","+iB+" 0 "+ +(iA>gq)+",1 "+iC
}function it(iB,iD,iA,iC){return"Q 0,0 "+iC
}iv.radius=function(iA){if(!arguments.length){return iw
}iw=X(iA);
return iv
};
iv.source=function(iA){if(!arguments.length){return e
}e=X(iA);
return iv
};
iv.target=function(iA){if(!arguments.length){return ix
}ix=X(iA);
return iv
};
iv.startAngle=function(iA){if(!arguments.length){return iy
}iy=X(iA);
return iv
};
iv.endAngle=function(iA){if(!arguments.length){return iu
}iu=X(iA);
return iv
};
return iv
};
function M(e){return e.radius
}hx.svg.diagonal=function(){var ir=hS,it=h1,e=m;
function iq(iy,iv){var iz=ir.call(this,iy,iv),iw=it.call(this,iy,iv),iu=(iz.y+iw.y)/2,ix=[iz,{x:iz.x,y:iu},{x:iw.x,y:iu},iw];
ix=ix.map(e);
return"M"+ix[0]+"C"+ix[1]+" "+ix[2]+" "+ix[3]
}iq.source=function(iu){if(!arguments.length){return ir
}ir=X(iu);
return iq
};
iq.target=function(iu){if(!arguments.length){return it
}it=X(iu);
return iq
};
iq.projection=function(iu){if(!arguments.length){return e
}e=iu;
return iq
};
return iq
};
function m(e){return[e.x,e.y]
}hx.svg.diagonal.radial=function(){var ir=hx.svg.diagonal(),e=m,iq=ir.projection;
ir.projection=function(it){return arguments.length?iq(n(e=it)):e
};
return ir
};
function n(e){return function(){var it=e.apply(this,arguments),ir=it[0],iq=it[1]+hR;
return[ir*Math.cos(iq),ir*Math.sin(iq)]
}
}hx.svg.symbol=function(){var iq=aZ,e=fj;
function ir(iu,it){return(hY.get(iq.call(this,iu,it))||ci)(e.call(this,iu,it))
}ir.type=function(it){if(!arguments.length){return iq
}iq=X(it);
return ir
};
ir.size=function(it){if(!arguments.length){return e
}e=X(it);
return ir
};
return ir
};
function fj(){return 64
}function aZ(){return"circle"
}function ci(e){var iq=Math.sqrt(e/gq);
return"M0,"+iq+"A"+iq+","+iq+" 0 1,1 0,"+-iq+"A"+iq+","+iq+" 0 1,1 0,"+iq+"Z"
}var hY=hx.map({circle:ci,cross:function(e){var iq=Math.sqrt(e/5)/2;
return"M"+-3*iq+","+-iq+"H"+-iq+"V"+-3*iq+"H"+iq+"V"+-iq+"H"+3*iq+"V"+iq+"H"+iq+"V"+3*iq+"H"+-iq+"V"+iq+"H"+-3*iq+"Z"
},diamond:function(e){var iq=Math.sqrt(e/(2*cq)),ir=iq*cq;
return"M0,"+-iq+"L"+ir+",0 0,"+iq+" "+-ir+",0Z"
},square:function(e){var iq=Math.sqrt(e)/2;
return"M"+-iq+","+-iq+"L"+iq+","+-iq+" "+iq+","+iq+" "+-iq+","+iq+"Z"
},"triangle-down":function(e){var ir=Math.sqrt(e/ca),iq=ir*ca/2;
return"M0,"+iq+"L"+ir+","+-iq+" "+-ir+","+-iq+"Z"
},"triangle-up":function(e){var ir=Math.sqrt(e/ca),iq=ir*ca/2;
return"M0,"+-iq+"L"+ir+","+iq+" "+-ir+","+iq+"Z"
}});
hx.svg.symbolTypes=hY.keys();
var ca=Math.sqrt(3),cq=Math.tan(30*O);
function g1(e,iq){ii(e,eE);
e.id=iq;
return e
}var eE=[],hl=0,ax,ef;
eE.call=d8.call;
eE.empty=d8.empty;
eE.node=d8.node;
eE.size=d8.size;
hx.transition=function(e){return arguments.length?ax?e.transition():e:g3.transition()
};
hx.transition.prototype=eE;
eE.select=function(iw){var e=this.id,it=[],iA,iq,iu;
iw=B(iw);
for(var ix=-1,iv=this.length;
++ix<iv;
){it.push(iA=[]);
for(var iz=this[ix],iy=-1,ir=iz.length;
++iy<ir;
){if((iu=iz[iy])&&(iq=iw.call(iu,iu.__data__,iy,ix))){if("__data__" in iu){iq.__data__=iu.__data__
}fQ(iq,iy,e,iu.__transition__[e]);
iA.push(iq)
}else{iA.push(null)
}}}return g1(it,e)
};
eE.selectAll=function(iy){var iq=this.id,iv=[],iE,e,ix,ir,iC;
iy=c8(iy);
for(var iA=-1,iw=this.length;
++iA<iw;
){for(var iD=this[iA],iB=-1,iu=iD.length;
++iB<iu;
){if(ix=iD[iB]){iC=ix.__transition__[iq];
e=iy.call(ix,ix.__data__,iB,iA);
iv.push(iE=[]);
for(var iz=-1,it=e.length;
++iz<it;
){if(ir=e[iz]){fQ(ir,iz,iq,iC)
}iE.push(ir)
}}}}return g1(iv,iq)
};
eE.filter=function(e){var ir=[],iy,ix,it;
if(typeof e!=="function"){e=bc(e)
}for(var iv=0,iu=this.length;
iv<iu;
iv++){ir.push(iy=[]);
for(var ix=this[iv],iw=0,iq=ix.length;
iw<iq;
iw++){if((it=ix[iw])&&e.call(it,it.__data__,iw,iv)){iy.push(it)
}}}return g1(ir,this.id)
};
eE.tween=function(e,iq){var ir=this.id;
if(arguments.length<2){return this.node().__transition__[ir].tween.get(e)
}return cO(this,iq==null?function(it){it.__transition__[ir].tween.remove(e)
}:function(it){it.__transition__[ir].tween.set(e,iq)
})
};
function hX(e,iq,it,ir){var iu=e.id;
return cO(e,typeof it==="function"?function(ix,iw,iv){ix.__transition__[iu].tween.set(iq,ir(it.call(ix,ix.__data__,iw,iv)))
}:(it=ir(it),function(iv){iv.__transition__[iu].tween.set(iq,it)
}))
}eE.attr=function(e,iv){if(arguments.length<2){for(iv in e){this.attr(iv,e[iv])
}return this
}var it=e=="transform"?es:fR,ir=hx.ns.qualify(e);
function iq(){this.removeAttribute(ir)
}function ix(){this.removeAttributeNS(ir.space,ir.local)
}function iu(iy){return iy==null?iq:(iy+="",function(){var iz=this.getAttribute(ir),iA;
return iz!==iy&&(iA=it(iz,iy),function(iB){this.setAttribute(ir,iA(iB))
})
})
}function iw(iy){return iy==null?ix:(iy+="",function(){var iz=this.getAttributeNS(ir.space,ir.local),iA;
return iz!==iy&&(iA=it(iz,iy),function(iB){this.setAttributeNS(ir.space,ir.local,iA(iB))
})
})
}return hX(this,"attr."+e,iv,ir.local?iw:iu)
};
eE.attrTween=function(e,ir){var iq=hx.ns.qualify(e);
function it(ix,iv){var iw=ir.call(this,ix,iv,this.getAttribute(iq));
return iw&&function(iy){this.setAttribute(iq,iw(iy))
}
}function iu(ix,iv){var iw=ir.call(this,ix,iv,this.getAttributeNS(iq.space,iq.local));
return iw&&function(iy){this.setAttributeNS(iq.space,iq.local,iw(iy))
}
}return this.tween("attr."+e,iq.local?iu:it)
};
eE.style=function(ir,iu,it){var iv=arguments.length;
if(iv<3){if(typeof ir!=="string"){if(iv<2){iu=""
}for(it in ir){this.style(it,ir[it],iu)
}return this
}it=""
}function iq(){this.style.removeProperty(ir)
}function e(iw){return iw==null?iq:(iw+="",function(){var ix=fN.getComputedStyle(this,null).getPropertyValue(ir),iy;
return ix!==iw&&(iy=fR(ix,iw),function(iz){this.style.setProperty(ir,iy(iz),it)
})
})
}return hX(this,"style."+ir,iu,e)
};
eE.styleTween=function(e,ir,iq){if(arguments.length<3){iq=""
}function it(iw,iu){var iv=ir.call(this,iw,iu,fN.getComputedStyle(this,null).getPropertyValue(e));
return iv&&function(ix){this.style.setProperty(e,iv(ix),iq)
}
}return this.tween("style."+e,it)
};
eE.text=function(e){return hX(this,"text",e,ip)
};
function ip(e){if(e==null){e=""
}return function(){this.textContent=e
}
}eE.remove=function(){return this.each("end.transition",function(){var e;
if(this.__transition__.count<2&&(e=this.parentNode)){e.removeChild(this)
}})
};
eE.ease=function(e){var iq=this.id;
if(arguments.length<1){return this.node().__transition__[iq].ease
}if(typeof e!=="function"){e=hx.ease.apply(hx,arguments)
}return cO(this,function(ir){ir.__transition__[iq].ease=e
})
};
eE.delay=function(e){var iq=this.id;
return cO(this,typeof e==="function"?function(iu,it,ir){iu.__transition__[iq].delay=+e.call(iu,iu.__data__,it,ir)
}:(e=+e,function(ir){ir.__transition__[iq].delay=e
}))
};
eE.duration=function(e){var iq=this.id;
return cO(this,typeof e==="function"?function(iu,it,ir){iu.__transition__[iq].duration=Math.max(1,e.call(iu,iu.__data__,it,ir))
}:(e=Math.max(1,e),function(ir){ir.__transition__[iq].duration=e
}))
};
eE.each=function(iq,ir){var iu=this.id;
if(arguments.length<2){var e=ef,it=ax;
ax=iu;
cO(this,function(ix,iw,iv){ef=ix.__transition__[iu];
iq.call(ix,ix.__data__,iw,iv)
});
ef=e;
ax=it
}else{cO(this,function(iv){var iw=iv.__transition__[iu];
(iw.event||(iw.event=hx.dispatch("start","end"))).on(iq,ir)
})
}return this
};
eE.transition=function(){var iA=this.id,iz=++hl,iq=[],iy,ix,it,iw;
for(var iu=0,ir=this.length;
iu<ir;
iu++){iq.push(iy=[]);
for(var ix=this[iu],iv=0,e=ix.length;
iv<e;
iv++){if(it=ix[iv]){iw=Object.create(it.__transition__[iA]);
iw.delay+=iw.duration;
fQ(it,iv,iz,iw)
}iy.push(it)
}}return g1(iq,iz)
};
function fQ(it,ir,iw,e){var iq=it.__transition__||(it.__transition__={active:0,count:0}),iv=iq[iw];
if(!iv){var iu=e.time;
iv=iq[iw]={tween:new aM(),time:iu,ease:e.ease,delay:e.delay,duration:e.duration};
++iq.count;
hx.timer(function(iG){var iD=it.__data__,iz=iv.ease,iB=iv.delay,iA=iv.duration,ix=ds,iF=[];
ix.t=iB+iu;
if(iB<=iG){return iy(iG-iB)
}ix.c=iy;
function iy(iH){if(iq.active>iw){return iE()
}iq.active=iw;
iv.event&&iv.event.start.call(it,iD,ir);
iv.tween.forEach(function(iI,iJ){if(iJ=iJ.call(it,iD,ir)){iF.push(iJ)
}});
hx.timer(function(){ix.c=iC(iH||1)?an:iC;
return 1
},0,iu)
}function iC(iH){if(iq.active!==iw){return iE()
}var iI=iH/iA,iJ=iz(iI),iK=iF.length;
while(iK>0){iF[--iK].call(it,iJ)
}if(iI>=1){iv.event&&iv.event.end.call(it,iD,ir);
return iE()
}}function iE(){if(--iq.count){delete iq[iw]
}else{delete it.__transition__
}return 1
}},0,iu)
}}hx.svg.axis=function(){var ir=hx.scale.linear(),iu=h7,e=6,iv=6,iy=3,ix=[10],it=null,iw;
function iq(iz){iz.each(function(){var iQ=hx.select(this);
var iN=this.__chart__||ir,iM=this.__chart__=ir.copy();
var iS=it==null?iM.ticks?iM.ticks.apply(iM,ix):iM.domain():it,iL=iw==null?iM.tickFormat?iM.tickFormat.apply(iM,ix):gx:iw,iO=iQ.selectAll(".tick").data(iS,iM),iI=iO.enter().insert("g",".domain").attr("class","tick").style("opacity",gA),iK=hx.transition(iO.exit()).style("opacity",gA).remove(),iC=hx.transition(iO).style("opacity",1),iA;
var iH=a3(iM),iJ=iQ.selectAll(".domain").data([0]),iT=(iJ.enter().append("path").attr("class","domain"),hx.transition(iJ));
iI.append("line");
iI.append("text");
var iB=iI.select("line"),iR=iC.select("line"),iG=iO.select("text").text(iL),iD=iI.select("text"),iP=iC.select("text");
switch(iu){case"bottom":iA=fA;
iB.attr("y2",e);
iD.attr("y",Math.max(e,0)+iy);
iR.attr("x2",0).attr("y2",e);
iP.attr("x",0).attr("y",Math.max(e,0)+iy);
iG.attr("dy",".71em").style("text-anchor","middle");
iT.attr("d","M"+iH[0]+","+iv+"V0H"+iH[1]+"V"+iv);
break;
case"top":iA=fA;
iB.attr("y2",-e);
iD.attr("y",-(Math.max(e,0)+iy));
iR.attr("x2",0).attr("y2",-e);
iP.attr("x",0).attr("y",-(Math.max(e,0)+iy));
iG.attr("dy","0em").style("text-anchor","middle");
iT.attr("d","M"+iH[0]+","+-iv+"V0H"+iH[1]+"V"+-iv);
break;
case"left":iA=fz;
iB.attr("x2",-e);
iD.attr("x",-(Math.max(e,0)+iy));
iR.attr("x2",-e).attr("y2",0);
iP.attr("x",-(Math.max(e,0)+iy)).attr("y",0);
iG.attr("dy",".32em").style("text-anchor","end");
iT.attr("d","M"+-iv+","+iH[0]+"H0V"+iH[1]+"H"+-iv);
break;
case"right":iA=fz;
iB.attr("x2",e);
iD.attr("x",Math.max(e,0)+iy);
iR.attr("x2",e).attr("y2",0);
iP.attr("x",Math.max(e,0)+iy).attr("y",0);
iG.attr("dy",".32em").style("text-anchor","start");
iT.attr("d","M"+iv+","+iH[0]+"H0V"+iH[1]+"H"+iv);
break
}if(iM.rangeBand){var iE=iM,iF=iE.rangeBand()/2;
iN=iM=function(iU){return iE(iU)+iF
}
}else{if(iN.rangeBand){iN=iM
}else{iK.call(iA,iM)
}}iI.call(iA,iN);
iC.call(iA,iM)
})
}iq.scale=function(iz){if(!arguments.length){return ir
}ir=iz;
return iq
};
iq.orient=function(iz){if(!arguments.length){return iu
}iu=iz in fe?iz+"":h7;
return iq
};
iq.ticks=function(){if(!arguments.length){return ix
}ix=arguments;
return iq
};
iq.tickValues=function(iz){if(!arguments.length){return it
}it=iz;
return iq
};
iq.tickFormat=function(iz){if(!arguments.length){return iw
}iw=iz;
return iq
};
iq.tickSize=function(iz){var iA=arguments.length;
if(!iA){return e
}e=+iz;
iv=+arguments[iA-1];
return iq
};
iq.innerTickSize=function(iz){if(!arguments.length){return e
}e=+iz;
return iq
};
iq.outerTickSize=function(iz){if(!arguments.length){return iv
}iv=+iz;
return iq
};
iq.tickPadding=function(iz){if(!arguments.length){return iy
}iy=+iz;
return iq
};
iq.tickSubdivide=function(){return arguments.length&&iq
};
return iq
};
var h7="bottom",fe={top:1,right:1,bottom:1,left:1};
function fA(iq,e){iq.attr("transform",function(ir){return"translate("+e(ir)+",0)"
})
}function fz(e,iq){e.attr("transform",function(ir){return"translate(0,"+iq(ir)+")"
})
}hx.svg.brush=function(){var iq=hs(iy,"brushstart","brush","brushend"),iB=null,iz=null,ir=[0,0],ix=[0,0],iA,iu,e=true,iw=true,iC=ay[0];
function iy(iF){iF.each(function(){var iL=hx.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",iD).on("touchstart.brush",iD);
var iK=iL.selectAll(".background").data([0]);
iK.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");
iL.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");
var iJ=iL.selectAll(".resize").data(iC,gx);
iJ.exit().remove();
iJ.enter().append("g").attr("class",function(iM){return"resize "+iM
}).style("cursor",function(iM){return e6[iM]
}).append("rect").attr("x",function(iM){return/[ew]$/.test(iM)?-3:null
}).attr("y",function(iM){return/^[ns]/.test(iM)?-3:null
}).attr("width",6).attr("height",6).style("visibility","hidden");
iJ.style("display",iy.empty()?"none":null);
var iI=hx.transition(iL),iG=hx.transition(iK),iH;
if(iB){iH=a3(iB);
iG.attr("x",iH[0]).attr("width",iH[1]-iH[0]);
iv(iI)
}if(iz){iH=a3(iz);
iG.attr("y",iH[0]).attr("height",iH[1]-iH[0]);
it(iI)
}iE(iI)
})
}iy.event=function(iF){iF.each(function(){var iG=iq.of(this,arguments),iH={x:ir,y:ix,i:iA,j:iu},iI=this.__chart__||iH;
this.__chart__=iH;
if(ax){hx.select(this).transition().each("start.brush",function(){iA=iI.i;
iu=iI.j;
ir=iI.x;
ix=iI.y;
iG({type:"brushstart"})
}).tween("brush:brush",function(){var iJ=eY(ir,iH.x),iK=eY(ix,iH.y);
iA=iu=null;
return function(iL){ir=iH.x=iJ(iL);
ix=iH.y=iK(iL);
iG({type:"brush",mode:"resize"})
}
}).each("end.brush",function(){iA=iH.i;
iu=iH.j;
iG({type:"brush",mode:"resize"});
iG({type:"brushend"})
})
}else{iG({type:"brushstart"});
iG({type:"brush",mode:"resize"});
iG({type:"brushend"})
}})
};
function iE(iF){iF.selectAll(".resize").attr("transform",function(iG){return"translate("+ir[+/e$/.test(iG)]+","+ix[+/^s/.test(iG)]+")"
})
}function iv(iF){iF.select(".extent").attr("x",ir[0]);
iF.selectAll(".extent,.n>rect,.s>rect").attr("width",ir[1]-ir[0])
}function it(iF){iF.select(".extent").attr("y",ix[0]);
iF.selectAll(".extent,.e>rect,.w>rect").attr("height",ix[1]-ix[0])
}function iD(){var iY=this,iG=hx.select(hx.event.target),iN=iq.of(iY,arguments),iT=hx.select(iY),iV=iG.datum(),iR=!/^(n|s)$/.test(iV)&&iB,iP=!/^(e|w)$/.test(iV)&&iz,iQ=iG.classed("extent"),iI=bO(),iW,iX=hx.mouse(iY),iH;
var iL=hx.select(fN).on("keydown.brush",iO).on("keyup.brush",iK);
if(hx.event.changedTouches){iL.on("touchmove.brush",iM).on("touchend.brush",iF)
}else{iL.on("mousemove.brush",iM).on("mouseup.brush",iF)
}iT.interrupt().selectAll("*").interrupt();
if(iQ){iX[0]=ir[0]-iX[0];
iX[1]=ix[0]-iX[1]
}else{if(iV){var iU=+/w$/.test(iV),iS=+/^n/.test(iV);
iH=[ir[1-iU]-iX[0],ix[1-iS]-iX[1]];
iX[0]=ir[iU];
iX[1]=ix[iS]
}else{if(hx.event.altKey){iW=iX.slice()
}}}iT.style("pointer-events","none").selectAll(".resize").style("display",null);
hx.select("body").style("cursor",iG.style("cursor"));
iN({type:"brushstart"});
iM();
function iO(){if(hx.event.keyCode==32){if(!iQ){iW=null;
iX[0]-=ir[1];
iX[1]-=ix[1];
iQ=2
}w()
}}function iK(){if(hx.event.keyCode==32&&iQ==2){iX[0]+=ir[1];
iX[1]+=ix[1];
iQ=0;
w()
}}function iM(){var iZ=hx.mouse(iY),i0=false;
if(iH){iZ[0]+=iH[0];
iZ[1]+=iH[1]
}if(!iQ){if(hx.event.altKey){if(!iW){iW=[(ir[0]+ir[1])/2,(ix[0]+ix[1])/2]
}iX[0]=ir[+(iZ[0]<iW[0])];
iX[1]=ix[+(iZ[1]<iW[1])]
}else{iW=null
}}if(iR&&iJ(iZ,iB,0)){iv(iT);
i0=true
}if(iP&&iJ(iZ,iz,1)){it(iT);
i0=true
}if(i0){iE(iT);
iN({type:"brush",mode:iQ?"move":"resize"})
}}function iJ(i7,i1,i3){var i4=a3(i1),i0=i4[0],iZ=i4[1],i5=iX[i3],i8=i3?ix:ir,i9=i8[1]-i8[0],i2,i6;
if(iQ){i0-=i5;
iZ-=i9+i5
}i2=(i3?iw:e)?Math.max(i0,Math.min(iZ,i7[i3])):i7[i3];
if(iQ){i6=(i2+=i5)+i9
}else{if(iW){i5=Math.max(i0,Math.min(iZ,2*iW[i3]-i2))
}if(i5<i2){i6=i2;
i2=i5
}else{i6=i5
}}if(i8[0]!=i2||i8[1]!=i6){if(i3){iu=null
}else{iA=null
}i8[0]=i2;
i8[1]=i6;
return true
}}function iF(){iM();
iT.style("pointer-events","all").selectAll(".resize").style("display",iy.empty()?"none":null);
hx.select("body").style("cursor",null);
iL.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);
iI();
iN({type:"brushend"})
}}iy.x=function(iF){if(!arguments.length){return iB
}iB=iF;
iC=ay[!iB<<1|!iz];
return iy
};
iy.y=function(iF){if(!arguments.length){return iz
}iz=iF;
iC=ay[!iB<<1|!iz];
return iy
};
iy.clamp=function(iF){if(!arguments.length){return iB&&iz?[e,iw]:iB?e:iz?iw:null
}if(iB&&iz){e=!!iF[0],iw=!!iF[1]
}else{if(iB){e=!!iF
}else{if(iz){iw=!!iF
}}}return iy
};
iy.extent=function(iK){var iH,iF,iJ,iI,iG;
if(!arguments.length){if(iB){if(iA){iH=iA[0],iF=iA[1]
}else{iH=ir[0],iF=ir[1];
if(iB.invert){iH=iB.invert(iH),iF=iB.invert(iF)
}if(iF<iH){iG=iH,iH=iF,iF=iG
}}}if(iz){if(iu){iJ=iu[0],iI=iu[1]
}else{iJ=ix[0],iI=ix[1];
if(iz.invert){iJ=iz.invert(iJ),iI=iz.invert(iI)
}if(iI<iJ){iG=iJ,iJ=iI,iI=iG
}}}return iB&&iz?[[iH,iJ],[iF,iI]]:iB?[iH,iF]:iz&&[iJ,iI]
}if(iB){iH=iK[0],iF=iK[1];
if(iz){iH=iH[0],iF=iF[0]
}iA=[iH,iF];
if(iB.invert){iH=iB(iH),iF=iB(iF)
}if(iF<iH){iG=iH,iH=iF,iF=iG
}if(iH!=ir[0]||iF!=ir[1]){ir=[iH,iF]
}}if(iz){iJ=iK[0],iI=iK[1];
if(iB){iJ=iJ[1],iI=iI[1]
}iu=[iJ,iI];
if(iz.invert){iJ=iz(iJ),iI=iz(iI)
}if(iI<iJ){iG=iJ,iJ=iI,iI=iG
}if(iJ!=ix[0]||iI!=ix[1]){ix=[iJ,iI]
}}return iy
};
iy.clear=function(){if(!iy.empty()){ir=[0,0],ix=[0,0];
iA=iu=null
}return iy
};
iy.empty=function(){return !!iB&&ir[0]==ir[1]||!!iz&&ix[0]==ix[1]
};
return hx.rebind(iy,iq,"on")
};
var e6={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};
var ay=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];
var fV=hx.time={},hB=Date,p=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
function cn(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])
}cn.prototype={getDate:function(){return this._.getUTCDate()
},getDay:function(){return this._.getUTCDay()
},getFullYear:function(){return this._.getUTCFullYear()
},getHours:function(){return this._.getUTCHours()
},getMilliseconds:function(){return this._.getUTCMilliseconds()
},getMinutes:function(){return this._.getUTCMinutes()
},getMonth:function(){return this._.getUTCMonth()
},getSeconds:function(){return this._.getUTCSeconds()
},getTime:function(){return this._.getTime()
},getTimezoneOffset:function(){return 0
},valueOf:function(){return this._.valueOf()
},setDate:function(){gf.setUTCDate.apply(this._,arguments)
},setDay:function(){gf.setUTCDay.apply(this._,arguments)
},setFullYear:function(){gf.setUTCFullYear.apply(this._,arguments)
},setHours:function(){gf.setUTCHours.apply(this._,arguments)
},setMilliseconds:function(){gf.setUTCMilliseconds.apply(this._,arguments)
},setMinutes:function(){gf.setUTCMinutes.apply(this._,arguments)
},setMonth:function(){gf.setUTCMonth.apply(this._,arguments)
},setSeconds:function(){gf.setUTCSeconds.apply(this._,arguments)
},setTime:function(){gf.setTime.apply(this._,arguments)
}};
var gf=Date.prototype;
var W="%a %b %e %X %Y",e5="%m/%d/%Y",di="%H:%M:%S";
var cp=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],cZ=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],cu=["January","February","March","April","May","June","July","August","September","October","November","December"],aO=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
function c6(iv,e,iq){function iy(iz){var iB=iv(iz),iA=it(iB,1);
return iz-iB<iA-iz?iB:iA
}function ix(iz){e(iz=iv(new hB(iz-1)),1);
return iz
}function it(iA,iz){e(iA=new hB(+iA),iz);
return iA
}function iu(iB,iA,iz){var iC=ix(iB),iD=[];
if(iz>1){while(iC<iA){if(!(iq(iC)%iz)){iD.push(new Date(+iC))
}e(iC,1)
}}else{while(iC<iA){iD.push(new Date(+iC)),e(iC,1)
}}return iD
}function ir(iC,iB,iA){try{hB=cn;
var iz=new cn();
iz._=iC;
return iu(iz,iB,iA)
}finally{hB=Date
}}iv.floor=iv;
iv.round=iy;
iv.ceil=ix;
iv.offset=it;
iv.range=iu;
var iw=iv.utc=d1(iv);
iw.floor=iw;
iw.round=d1(iy);
iw.ceil=d1(ix);
iw.offset=d1(it);
iw.range=ir;
return iv
}function d1(e){return function(ir,iq){try{hB=cn;
var it=new cn();
it._=ir;
return e(it,iq)._
}finally{hB=Date
}}
}fV.year=c6(function(e){e=fV.day(e);
e.setMonth(0,1);
return e
},function(e,iq){e.setFullYear(e.getFullYear()+iq)
},function(e){return e.getFullYear()
});
fV.years=fV.year.range;
fV.years.utc=fV.year.utc.range;
fV.day=c6(function(iq){var e=new hB(2000,0);
e.setFullYear(iq.getFullYear(),iq.getMonth(),iq.getDate());
return e
},function(e,iq){e.setDate(e.getDate()+iq)
},function(e){return e.getDate()-1
});
fV.days=fV.day.range;
fV.days.utc=fV.day.utc.range;
fV.dayOfYear=function(e){var iq=fV.year(e);
return Math.floor((e-iq-(e.getTimezoneOffset()-iq.getTimezoneOffset())*60000)/86400000)
};
p.forEach(function(iq,ir){iq=iq.toLowerCase();
ir=7-ir;
var e=fV[iq]=c6(function(it){(it=fV.day(it)).setDate(it.getDate()-(it.getDay()+ir)%7);
return it
},function(it,iu){it.setDate(it.getDate()+Math.floor(iu)*7)
},function(iu){var it=fV.year(iu).getDay();
return Math.floor((fV.dayOfYear(iu)+(it+ir)%7)/7)-(it!==ir)
});
fV[iq+"s"]=e.range;
fV[iq+"s"].utc=e.utc.range;
fV[iq+"OfYear"]=function(iu){var it=fV.year(iu).getDay();
return Math.floor((fV.dayOfYear(iu)+(it+ir)%7)/7)
}
});
fV.week=fV.sunday;
fV.weeks=fV.sunday.range;
fV.weeks.utc=fV.sunday.utc.range;
fV.weekOfYear=fV.sundayOfYear;
fV.format=io;
function io(e){var ir=e.length;
function iq(iv){var iu=[],iw=-1,it=0,iz,iy,ix;
while(++iw<ir){if(e.charCodeAt(iw)===37){iu.push(e.substring(it,iw));
if((iy=aR[iz=e.charAt(++iw)])!=null){iz=e.charAt(++iw)
}if(ix=gK[iz]){iz=ix(iv,iy==null?iz==="e"?" ":"0":iy)
}iu.push(iz);
it=iw+1
}}iu.push(e.substring(it,iw));
return iu.join("")
}iq.parse=function(iv){var ix={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},iw=ee(ix,e,iv,0);
if(iw!=iv.length){return null
}if("p" in ix){ix.H=ix.H%12+ix.p*12
}var it=ix.Z!=null&&hB!==cn,iu=new (it?cn:hB)();
if("j" in ix){iu.setFullYear(ix.y,0,ix.j)
}else{if("w" in ix&&("W" in ix||"U" in ix)){iu.setFullYear(ix.y,0,1);
iu.setFullYear(ix.y,0,"W" in ix?(ix.w+6)%7+ix.W*7-(iu.getDay()+5)%7:ix.w+ix.U*7-(iu.getDay()+6)%7)
}else{iu.setFullYear(ix.y,ix.m,ix.d)
}}iu.setHours(ix.H+Math.floor(ix.Z/100),ix.M+ix.Z%100,ix.S,ix.L);
return it?iu._:iu
};
iq.toString=function(){return e
};
return iq
}function ee(it,iy,iw,iu){var ix,e,iz,iv=0,iq=iy.length,ir=iw.length;
while(iv<iq){if(iu>=ir){return -1
}ix=iy.charCodeAt(iv++);
if(ix===37){iz=iy.charAt(iv++);
e=hZ[iz in aR?iy.charAt(iv++):iz];
if(!e||(iu=e(it,iw,iu))<0){return -1
}}else{if(ix!=iw.charCodeAt(iu++)){return -1
}}}return iu
}function cQ(e){return new RegExp("^(?:"+e.map(hx.requote).join("|")+")","i")
}function g5(ir){var iq=new aM(),e=-1,it=ir.length;
while(++e<it){iq.set(ir[e].toLowerCase(),e)
}return iq
}function dF(iu,iv,ir){var e=iu<0?"-":"",iq=(e?-iu:iu)+"",it=iq.length;
return e+(it<ir?new Array(ir-it+1).join(iv)+iq:iq)
}var hL=cQ(cp),bf=g5(cp),fX=cQ(cZ),ek=g5(cZ),hi=cQ(cu),fK=g5(cu),fa=cQ(aO),fh=g5(aO),fm=/^%/;
var aR={"-":"",_:" ","0":"0"};
var gK={a:function(e){return cZ[e.getDay()]
},A:function(e){return cp[e.getDay()]
},b:function(e){return aO[e.getMonth()]
},B:function(e){return cu[e.getMonth()]
},c:io(W),d:function(iq,e){return dF(iq.getDate(),e,2)
},e:function(iq,e){return dF(iq.getDate(),e,2)
},H:function(iq,e){return dF(iq.getHours(),e,2)
},I:function(iq,e){return dF(iq.getHours()%12||12,e,2)
},j:function(iq,e){return dF(1+fV.dayOfYear(iq),e,3)
},L:function(iq,e){return dF(iq.getMilliseconds(),e,3)
},m:function(iq,e){return dF(iq.getMonth()+1,e,2)
},M:function(iq,e){return dF(iq.getMinutes(),e,2)
},p:function(e){return e.getHours()>=12?"PM":"AM"
},S:function(iq,e){return dF(iq.getSeconds(),e,2)
},U:function(iq,e){return dF(fV.sundayOfYear(iq),e,2)
},w:function(e){return e.getDay()
},W:function(iq,e){return dF(fV.mondayOfYear(iq),e,2)
},x:io(e5),X:io(di),y:function(iq,e){return dF(iq.getFullYear()%100,e,2)
},Y:function(iq,e){return dF(iq.getFullYear()%10000,e,4)
},Z:ga,"%":function(){return"%"
}};
var hZ={a:hc,A:cJ,b:a5,B:fb,c:eF,d:b5,e:b5,H:aU,I:aU,j:J,L:g7,m:gU,M:c3,p:hJ,S:d7,U:bv,w:d0,W:dQ,x:ik,X:gR,y:T,Y:bC,Z:a8,"%":fG};
function hc(iq,e,ir){fX.lastIndex=0;
var it=fX.exec(e.substring(ir));
return it?(iq.w=ek.get(it[0].toLowerCase()),ir+it[0].length):-1
}function cJ(iq,e,ir){hL.lastIndex=0;
var it=hL.exec(e.substring(ir));
return it?(iq.w=bf.get(it[0].toLowerCase()),ir+it[0].length):-1
}function d0(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir,ir+1));
return it?(iq.w=+it[0],ir+it[0].length):-1
}function bv(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir));
return it?(iq.U=+it[0],ir+it[0].length):-1
}function dQ(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir));
return it?(iq.W=+it[0],ir+it[0].length):-1
}function a5(iq,e,ir){fa.lastIndex=0;
var it=fa.exec(e.substring(ir));
return it?(iq.m=fh.get(it[0].toLowerCase()),ir+it[0].length):-1
}function fb(iq,e,ir){hi.lastIndex=0;
var it=hi.exec(e.substring(ir));
return it?(iq.m=fK.get(it[0].toLowerCase()),ir+it[0].length):-1
}function eF(iq,e,ir){return ee(iq,gK.c.toString(),e,ir)
}function ik(iq,e,ir){return ee(iq,gK.x.toString(),e,ir)
}function gR(iq,e,ir){return ee(iq,gK.X.toString(),e,ir)
}function bC(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir,ir+4));
return it?(iq.y=+it[0],ir+it[0].length):-1
}function T(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir,ir+2));
return it?(iq.y=c9(+it[0]),ir+it[0].length):-1
}function a8(iq,e,ir){return/^[+-]\d{4}$/.test(e=e.substring(ir,ir+5))?(iq.Z=+e,ir+5):-1
}function c9(e){return e+(e>68?1900:2000)
}function gU(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir,ir+2));
return it?(iq.m=it[0]-1,ir+it[0].length):-1
}function b5(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir,ir+2));
return it?(iq.d=+it[0],ir+it[0].length):-1
}function J(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir,ir+3));
return it?(iq.j=+it[0],ir+it[0].length):-1
}function aU(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir,ir+2));
return it?(iq.H=+it[0],ir+it[0].length):-1
}function c3(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir,ir+2));
return it?(iq.M=+it[0],ir+it[0].length):-1
}function d7(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir,ir+2));
return it?(iq.S=+it[0],ir+it[0].length):-1
}function g7(iq,e,ir){gj.lastIndex=0;
var it=gj.exec(e.substring(ir,ir+3));
return it?(iq.L=+it[0],ir+it[0].length):-1
}var gj=/^\s*\d+/;
function hJ(iq,e,ir){var it=f.get(e.substring(ir,ir+=2).toLowerCase());
return it==null?-1:(iq.p=it,ir)
}var f=hx.map({am:0,pm:1});
function ga(iu){var it=iu.getTimezoneOffset(),ir=it>0?"-":"+",iq=~~(cM(it)/60),e=cM(it)%60;
return ir+dF(iq,"0",2)+dF(e,"0",2)
}function fG(iq,e,ir){fm.lastIndex=0;
var it=fm.exec(e.substring(ir,ir+1));
return it?ir+it[0].length:-1
}io.utc=dn;
function dn(iq){var e=io(iq);
function ir(it){try{hB=cn;
var iu=new hB();
iu._=it;
return e(iu)
}finally{hB=Date
}}ir.parse=function(iu){try{hB=cn;
var it=e.parse(iu);
return it&&it._
}finally{hB=Date
}};
ir.toString=e.toString;
return ir
}var dY=dn("%Y-%m-%dT%H:%M:%S.%LZ");
io.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?dE:dY;
function dE(e){return e.toISOString()
}dE.parse=function(iq){var e=new Date(iq);
return isNaN(e)?null:e
};
dE.toString=dY.toString;
fV.second=c6(function(e){return new hB(Math.floor(e/1000)*1000)
},function(e,iq){e.setTime(e.getTime()+Math.floor(iq)*1000)
},function(e){return e.getSeconds()
});
fV.seconds=fV.second.range;
fV.seconds.utc=fV.second.utc.range;
fV.minute=c6(function(e){return new hB(Math.floor(e/60000)*60000)
},function(e,iq){e.setTime(e.getTime()+Math.floor(iq)*60000)
},function(e){return e.getMinutes()
});
fV.minutes=fV.minute.range;
fV.minutes.utc=fV.minute.utc.range;
fV.hour=c6(function(e){var iq=e.getTimezoneOffset()/60;
return new hB((Math.floor(e/3600000-iq)+iq)*3600000)
},function(e,iq){e.setTime(e.getTime()+Math.floor(iq)*3600000)
},function(e){return e.getHours()
});
fV.hours=fV.hour.range;
fV.hours.utc=fV.hour.utc.range;
fV.month=c6(function(e){e=fV.day(e);
e.setDate(1);
return e
},function(e,iq){e.setMonth(e.getMonth()+iq)
},function(e){return e.getMonth()
});
fV.months=fV.month.range;
fV.months.utc=fV.month.utc.range;
function bs(e,iq,ir){function it(iv){return e(iv)
}it.invert=function(iv){return ge(e.invert(iv))
};
it.domain=function(iv){if(!arguments.length){return e.domain().map(ge)
}e.domain(iv);
return it
};
function iu(ix,iy){var iw=ix[1]-ix[0],iz=iw/iy,iv=hx.bisect(fq,iz);
return iv==fq.length?[iq.year,q(ix.map(function(iA){return iA/31536000000
}),iy)[2]]:!iv?[cE,q(ix,iy)[2]]:iq[iz/fq[iv-1]<fq[iv]/iz?iv-1:iv]
}it.nice=function(iw,iy){var iz=it.domain(),ix=eC(iz),iA=iw==null?iu(ix,10):typeof iw==="number"&&iu(ix,iw);
if(iA){iw=iA[0],iy=iA[1]
}function iv(iB){return !isNaN(iB)&&!iw.range(iB,ge(+iB+1),iy).length
}return it.domain(gv(iz,iy>1?{floor:function(iB){while(iv(iB=iw.floor(iB))){iB=ge(iB-1)
}return iB
},ceil:function(iB){while(iv(iB=iw.ceil(iB))){iB=ge(+iB+1)
}return iB
}}:iw))
};
it.ticks=function(iv,ix){var iw=eC(it.domain()),iy=iv==null?iu(iw,10):typeof iv==="number"?iu(iw,iv):!iv.range&&[{range:iv},ix];
if(iy){iv=iy[0],ix=iy[1]
}return iv.range(iw[0],ge(+iw[1]+1),ix<1?1:ix)
};
it.tickFormat=function(){return ir
};
it.copy=function(){return bs(e.copy(),iq,ir)
};
return gn(it,e)
}function ge(e){return new Date(e)
}function c2(e){return function(iq){var ir=e.length-1,it=e[ir];
while(!it[1](iq)){it=e[--ir]
}return it[0](iq)
}
}var fq=[1000,5000,15000,30000,60000,300000,900000,1800000,3600000,10800000,21600000,43200000,86400000,172800000,604800000,2592000000,7776000000,31536000000];
var cI=[[fV.second,1],[fV.second,5],[fV.second,15],[fV.second,30],[fV.minute,1],[fV.minute,5],[fV.minute,15],[fV.minute,30],[fV.hour,1],[fV.hour,3],[fV.hour,6],[fV.hour,12],[fV.day,1],[fV.day,2],[fV.week,1],[fV.month,1],[fV.month,3],[fV.year,1]];
var fL=[[io("%Y"),an],[io("%B"),function(e){return e.getMonth()
}],[io("%b %d"),function(e){return e.getDate()!=1
}],[io("%a %d"),function(e){return e.getDay()&&e.getDate()!=1
}],[io("%I %p"),function(e){return e.getHours()
}],[io("%I:%M"),function(e){return e.getMinutes()
}],[io(":%S"),function(e){return e.getSeconds()
}],[io(".%L"),function(e){return e.getMilliseconds()
}]];
var Y=c2(fL);
cI.year=fV.year;
fV.scale=function(){return bs(hx.scale.linear(),cI,Y)
};
var cE={range:function(ir,e,iq){return hx.range(+ir,+e,iq).map(ge)
},floor:gx,ceil:gx};
var h6=cI.map(function(e){return[e[0].utc,e[1]]
});
var ck=[[dn("%Y"),an],[dn("%B"),function(e){return e.getUTCMonth()
}],[dn("%b %d"),function(e){return e.getUTCDate()!=1
}],[dn("%a %d"),function(e){return e.getUTCDay()&&e.getUTCDate()!=1
}],[dn("%I %p"),function(e){return e.getUTCHours()
}],[dn("%I:%M"),function(e){return e.getUTCMinutes()
}],[dn(":%S"),function(e){return e.getUTCSeconds()
}],[dn(".%L"),function(e){return e.getUTCMilliseconds()
}]];
var fg=c2(ck);
h6.year=fV.year.utc;
fV.scale.utc=function(){return bs(hx.scale.linear(),h6,fg)
};
hx.text=ad(function(e){return e.responseText
});
hx.json=function(e,iq){return ia(e,"application/json",dU,iq)
};
function dU(e){return JSON.parse(e.responseText)
}hx.html=function(e,iq){return ia(e,"text/html",im,iq)
};
function im(iq){var e=bQ.createRange();
e.selectNode(bQ.body);
return e.createContextualFragment(iq.responseText)
}hx.xml=ad(function(e){return e.responseXML
});
return hx
}();
(function(){var V=d3.selection.prototype,c=V.on;
var j={tap:[["touchstart","touchend","touchmove"],P]};
var l=null,q=false,Y=0,X=0,I=0,H=0;
V.on=function(ag,ai,ad){var ah=ag.split("."),af=ah.shift(),aj=j[af];
if(aj){var ae=aj[0],ac=this;
ai=aj[1].call(null,ai);
ae.forEach(function(am,al){var ak=[am,ah].join(".");
c.call(ac,ak,ai,ad)
});
return c
}else{return c.apply(this,arguments)
}};
function P(ac){return function(){if(d3.event.type==="touchstart"){l=e(d3.event);
I=Y=l.pageX;
H=X=l.pageY;
q=true;
var ad=d3.event;
setTimeout(function(){if((I===Y)&&!q&&(H===X)){d3.event=ad;
ac.apply(this,arguments)
}},200)
}if(d3.event.type==="touchend"&&q){q=false
}if(d3.event.type==="touchmove"&&q){l=e(d3.event);
Y=l.pageX;
X=l.pageY
}}
}function e(ac){return ac.touches?ac.touches[0]:ac
}dv=function(){};
dv.version="3.1.0";
dv.ANIMATION=true;
var h=false,B=/xyz/.test(function(){xyz
})?/\b_super\b/:/.*/;
dv.extend=function(af){var ae=this.prototype;
h=true;
var ad=new this();
af=af();
af.init=af;
h=false;
for(var ag in af){ad[ag]=typeof af[ag]=="function"&&typeof ae[ag]=="function"&&B.test(af[ag])?(function(ai,ah){return function(){var ak=this._super;
this._super=ae[ai];
var aj=ah.apply(this,arguments);
this._super=ak;
return aj
}
})(ag,af[ag]):af[ag]
}function ac(){if(!h){h=true;
var ah=new arguments.callee();
h=false;
ah.init.apply(ah,arguments);
return ah
}}ac.prototype=ad;
ac.mixin=function(ah,ai){if(dv.util.isObject(ah)){dv.util.each(ah,function(aj,ak){ad[ak]=ai
})
}else{ad[ah]=ai
}};
ac.extend=arguments.callee;
return ac
};
dv.DEFAULT_COLORS=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];
dv.DEFAULT_CATEGORICAL_AES=["color","fill","stroke","shape","size","linetype"];
dv.absoluteCoordinates=function(ae,ah,ad){if(ae.coord() instanceof dv.coord.polar){var ag=ae.coord().flip()?ad.yOuterScale():ad.xOuterScale(),af=ae.coord().flip()?ad.xOuterScale():ad.yOuterScale(),ac=dv.util.scaleRangeNoReverse(ag),ai=dv.util.scaleRangeNoReverse(af);
ah[0]+=(ac[0]+ac[1])/2;
ah[1]+=(ai[0]+ai[1])/2
}return ah
};
dv.showTooltip=function(ad,aj,ak,af,ao,ap){var ah=ap.selectAll(".dv-tooltip").data([ad]);
ad.cx=ad.cx||ad.x+ad.width/2;
ad.cy=ad.cy||ad.y+ad.height/2;
ad.dx=ad.dx||ad.x+ad.width;
ad.dy=ad.dy||ad.y+ad.height;
aj.dx=aj.dy||aj.x+aj.width;
aj.dy=aj.dy||aj.y+aj.height;
var al=ah.enter().append("div").classed("dv-tooltip",true).style("top",0).style("left",0);
al.append("div").classed("content",true);
al.append("b").classed("notch",true);
ah.select(".content").html(ak);
var an=ah.select(".notch");
var ac=ah.node(),ae=ac.offsetWidth,aq=ac.offsetHeight,am=0,ag=0,ai=function(au,at,ar){return Math.min(Math.max(at,au),ar)
};
switch(af){case"left":ag=ad.x-ae-ao;
am=ad.cy-aq/2;
if(ag<aj.x){ag=ad.dx+ao;
af="right"
}if(am<aj.y){am=aj.y
}if(am+aq>aj.dy){am=aj.dy-aq
}an.style("top",ai(ad.cy-am-5,3,aq-13)+"px");
break;
case"right":ag=ad.x+ad.width+ao;
am=ad.cy-aq/2;
if(ag+ae>aj.dx){ag=ad.x-ae-ao;
af="left"
}if(am<aj.y){am=aj.y
}if(am+aq>aj.dy){am=aj.dy-aq
}an.style("top",ai(ad.cy-am-5,3,aq-13)+"px");
break;
case"top":ag=ad.cx-ae/2;
am=ad.y-aq-ao;
if(am<aj.y){am=ad.dy+ao;
af="bottom"
}if(ag<aj.x){ag=aj.x
}if(ag+ae>aj.dx){ag=aj.dx-ae
}an.style("left",ai(ad.cx-ag-5,3,ae-13)+"px");
break;
case"bottom":ag=ad.cx-ae/2;
am=ad.dy+ao;
if(am+aq>aj.dy){am=ad.y-aq-ao;
af="top"
}if(ag<aj.x){ag=aj.x
}if(ag+ae>aj.dx){ag=aj.dx-ae
}an.style("left",ai(ad.cx-ag-5,3,ae-13)+"px");
break;
default:af=null;
break
}am=Math.round(am);
ag=Math.round(ag);
ah.classed("top right left bottom hide",false).classed(af,true);
al.style("top",am+"px").style("left",ag+"px");
ah.style("top",am+"px").style("left",ag+"px")
};
dv.removeTooltip=function(ac){ac.selectAll(".dv-tooltip").classed("hide",true)
};
dv.cancelEvent=function(ac){ac.stopPropagation();
ac.preventDefault()
};
dv.windowDimensions=function(){var ac={width:640,height:480};
if(document.body&&document.body.offsetWidth){ac.width=document.body.offsetWidth;
ac.height=document.body.offsetHeight
}if(document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){ac.width=document.documentElement.offsetWidth;
ac.height=document.documentElement.offsetHeight
}if(window.innerWidth&&window.innerHeight){ac.width=window.innerWidth;
ac.height=window.innerHeight
}return ac
};
dv.addWindowResizeHandler=function(ac){window.addEventListener("resize",ac)
};
dv.removeWindowResizeHandler=function(ac){window.removeEventListener("resize",ac)
};
dv.scale=dv.extend(function(){function ac(ad){this._d3Scale=ad;
this._reverse=false;
this._parse=dv.util.identity;
this._includeInDomain=function(){return true
}
}ac._mapToD3Scale=function(ad){return this._d3Scale(ad)
};
ac.trainingProperties=function(ad){if(!arguments.length){if(this._trainingProperties){return this._trainingProperties
}if(this._property){return[this._property]
}return undefined
}if(!dv.util.isValidValue(ad,["isUndefined","isArray"])){dv.log.error({msg:"The supplied properties is not an array",data:{range:ad}})
}this._trainingProperties=ad;
return this
};
ac.trainDomain=function(af,ad){var ae=this.calculateDomain(af,ad);
this.domain(ae);
return ae
};
ac.parse=function(ad){if(!arguments.length){return this._parse
}this._parse=ad;
return this
};
ac.applyRangePadding=function(){};
ac.validateDomain=function(){};
ac.mapToProp=function(ae){var af=ae[this.property()],ad=this;
if(dv.util.isArray(af)){return dv.util.map(af,function(ag){return ad._mapToD3Scale.call(ad,ag)
})
}return this._mapToD3Scale.call(this,af)
};
ac.mapPropToPercent=function(ad){return this.mapValueToPercent(this.mapToProp(ad))
};
ac.mapValueToPercent=function(af){var ae=dv.util.scaleRange(this),ad=ae[1]-ae[0];
if(dv.util.isArray(af)){return dv.util.map(af,function(ag){return ad?(ag-ae[0])/ad:0
})
}return ad?(af-ae[0])/ad:0
};
ac.mapValue=function(ae){if(dv.util.isArray(ae)){var ad=this;
return dv.util.map(ae,function(af){return ad._mapToD3Scale.call(ad,af)
})
}return this._mapToD3Scale.call(this,ae)
};
ac.invertValue=function(ad){return this._d3Scale.invert(ad)
};
ac.rangeBand=function(ad){return 0
};
ac.reverse=function(ad){if(!arguments.length){return this._reverse
}this._reverse=ad;
return this
};
ac.property=function(ad){if(!arguments.length){return this._property
}this._property=ad;
return this
};
ac.mapping=function(ad){if(!arguments.length){return this._mapping
}this._mapping=ad;
return this
};
ac.domain=function(ad){if(!arguments.length){return this._d3Scale.domain()
}if(!this._d3Scale){return this
}this._d3Scale.domain(ad);
return this
};
ac.hasSameDomain=function(ag){var af=true,ae=this.domain();
if(ae.length!=ag.length){af=false
}else{for(var ad=0;
ad<ag.length;
ad++){if(ag[ad]!=ae[ad]){af=false;
break
}}}return af
};
ac.range=function(ad){if(!arguments.length){return this._d3Scale.range()
}if(!this._d3Scale){return this
}if(!dv.util.isValidValue(ad,["isArray"])){dv.log.error({msg:"The supplied range is not an array",data:{range:ad}})
}this._d3Scale.range(ad);
return this
};
ac.expand=function(ad){if(!arguments.length){return this._expand
}this._expand=ad;
return this
};
ac.limits=function(ad){if(!arguments.length){return this._limits
}this._limits=ad;
return this
};
ac.breaks=function(ad){if(!arguments.length){return this._breaks
}this._breaks=ad;
return this
};
ac.orientation=function(ad){if(!arguments.length){return this._orientation
}this._orientation=ad;
return this
};
ac.includeInDomain=function(ad){if(!arguments.length){return this._includeInDomain
}this._includeInDomain=ad;
return this
};
ac.scaleIndex=function(ad){if(!arguments.length){return this._scaleIndex
}this._scaleIndex=ad;
return this
};
ac._copy=function(){dv.log.error({msg:"A copy function was not specified for the scale subclass."})
};
ac.copy=ac._copy;
ac.isDefault=function(ad){if(!arguments.length){return this._isDefault
}this._isDefault=ad;
return this
};
return ac
});
dv.scale.constant=dv.scale.extend(function(){function ac(){this._super(null)
}ac.trainDomain=function(ad){return
};
ac.map=function(ad){return this._value
};
ac.mapToProp=function(ad){return this._value
};
ac.value=function(ad){if(!arguments.length){return this._value
}this._value=ad;
return this
};
ac._copy=function(ae){var ad=this.trainingProperties();
if(!dv.util.isUndefined(ad)){ad=ad.slice(0)
}return dv.scale.constant().isDefault(this.isDefault()).value(this.value()).property(this.property()).trainingProperties(ad).scaleIndex(this._scaleIndex)
};
ac.copy=ac._copy;
return ac
});
dv.scale.continuous=dv.scale.extend(function(){function ac(ad){this._super(ad?ad:d3.scale.linear());
this.to=this.range;
this._parse=function(ae){if(ae==null){return undefined
}return parseFloat(ae)
}
}ac.calculateDomain=function(am,au){var aj=[],ar=this,ao,at;
if(!this.trainingProperties()){this.trainingProperties([this.property()])
}var an=this.trainingProperties();
if(!au){au={}
}if(!am){am=[]
}for(var af=0;
af<an.length;
af++){var ae=an[af];
for(var ai=0;
ai<am.length;
ai++){if(!au.filter||!au.filter.call(this,am[ai].key)){var al=am[ai].values;
for(var ak=0;
ak<al.length;
ak++){var ad=al[ak];
if(!this._includeInDomain(ad,ak)){continue
}if(this.scaleIndex()!==0){ad[this.property()+"-index"]=this.scaleIndex()
}var ag=(au.stack)?ad.y0:ad[ae];
if(!dv.util.isArray(ag)){ag=this._parse.call(this,ag)
}var ap=dv.util.isArray(ag)?d3.min(ag):ag;
ao=(dv.util.isUndefined(ao)||ap<ao)?ap:ao;
if(au.stack){var ah=ad[ae];
ag+=dv.util.isArray(ah)?d3.max(ah):ar._parse.call(this,ah)
}var aq=dv.util.isArray(ag)?d3.max(ag):ag;
at=(dv.util.isUndefined(at)||aq>at)?aq:at
}}}}if(isNaN(ao)&&isNaN(at)){aj=[];
this._naturalDomain=[]
}else{aj=[ao,at];
this._naturalDomain=[ao,at]
}if(au.fill){aj=[0,100]
}if(!dv.util.isUndefined(this._upperLimit)&&!dv.util.isFunction(this._upperLimit)&&!dv.util.isUndefined(this._lowerLimit)&&!dv.util.isFunction(this._lowerLimit)){aj=this.limits()
}else{this._reconcileLimits(aj)
}return aj
};
ac.unionDomain=function(ai,ah){if(!ai||!(ai instanceof dv.scale.continuous)){dv.log.error({msg:"The supplied scale is not continuous.",data:{scale:ai,isReversed:ah}})
}var ag=ai.domain(),ae=ai.naturalDomain(),af=this.domain()?d3.extent(this.domain().concat(ag)):d3.extent(ag),ad=this._naturalDomain?d3.extent(this._naturalDomain.concat(ae)):d3.extent(ae);
if(isNaN(af[0])&&isNaN(af[1])){af=[]
}if(isNaN(ad[0]&&isNaN(ad[1]))){ad=[]
}this.reverse(ah||this._reverse);
this.domain(af);
this._naturalDomain=ad;
return this
};
ac.validateDomain=function(){var ad=this.domain();
if(!ad||!ad.length){this.domain([0,1])
}};
ac.unionRange=function(ad){if(!dv.util.isValidValue(ad,["isArray"])){dv.log.error({msg:"The supplied range is not an array",data:{range:ad}})
}this.range(this.range()?d3.extent(this.range().concat(ad)):ad);
return this
};
ac.applyRangePadding=function(){var ah=this.domain(),af=this.range();
if(this._lowerRangePadding){var ad=af[0]-af[1],ae=Math.min(Math.abs(ad)-1,this._lowerRangePadding);
ah[0]=this.invertValue(ad/(Math.abs(ad)-ae)*ae+af[0])
}if(this._upperRangePadding){var ag=af[1]-af[0],ai=Math.min(Math.abs(ag)-1,this._upperRangePadding);
ah[1]=this.invertValue(ag/(Math.abs(ag)-ai)*ai+af[1])
}this.domain(ah);
return this
};
ac.upperLimit=function(ad){if(!arguments.length){return this._upperLimit
}if(dv.util.isValidValue(ad,["isUndefined","isFinite","isDate","isFunction"])){this._upperLimit=ad
}else{dv.log.error({msg:"Invalid value, cannot set upperLimit with: "+ad})
}return this
};
ac.lowerLimit=function(ad){if(!arguments.length){return this._lowerLimit
}if(dv.util.isValidValue(ad,["isUndefined","isFinite","isDate","isFunction"])){this._lowerLimit=ad
}else{dv.log.error({msg:"Invalid value, cannot set lowerLimit with: "+ad})
}return this
};
ac.limits=function(ad){if(!arguments.length){return[this._lowerLimit,this._upperLimit]
}if(!ad||ad.length!=2){dv.log.error({msg:"Incorrect number of arguments, the limits function must supply an array containing both a lower and upper limit"})
}this.lowerLimit(ad[0]);
this.upperLimit(ad[1]);
return this
};
ac.naturalDomain=function(){return this._naturalDomain
};
ac.upperRangePadding=function(ad){if(!arguments.length){return this._upperRangePadding
}if(dv.util.isValidValue(ad,["isUndefined","isFinite","isDate","isFunction"])){this._upperRangePadding=ad
}else{dv.log.error({msg:"Invalid value, cannot set upperRangePadding with: "+ad})
}return this
};
ac.lowerRangePadding=function(ad){if(!arguments.length){return this._lowerRangePadding
}if(dv.util.isValidValue(ad,["isUndefined","isFinite","isDate","isFunction"])){this._lowerRangePadding=ad
}else{dv.log.error({msg:"Invalid value, cannot set lowerRangePadding with: "+ad})
}return this
};
ac.rangePadding=function(ad){if(!arguments.length){return[this._lowerRangePadding,this._upperRangePadding]
}if(!ad||ad.length!=2){dv.log.error({msg:"Incorrect number of arguments, the limits function must supply an array containing both a lower and upper limit"})
}this.lowerRangePadding(ad[0]);
this.upperRangePadding(ad[1]);
return this
};
ac.softLowerLimit=function(ad){if(!arguments.length){return this._softLowerLimit
}this._softLowerLimit=ad;
return this
};
ac._reconcileLimits=function(ad){if(!ad.length){return
}if(!dv.util.isUndefined(this._softLowerLimit)){ad[0]=Math.min(ad[0],this._softLowerLimit);
ad[1]=Math.max(ad[1],this._softLowerLimit)
}if(!dv.util.isUndefined(this._lowerLimit)){ad[0]=dv.util.isFunction(this._lowerLimit)?this._lowerLimit(ad[0],ad[1]):this._lowerLimit
}if(!dv.util.isUndefined(this._upperLimit)){ad[1]=dv.util.isFunction(this._upperLimit)?this._upperLimit(ad[0],ad[1]):this._upperLimit
}};
ac.labels=function(ad){if(!arguments.length){return this._labels
}this._labels=ad;
return this
};
ac._copy=function(){var ae=this.domain().slice(0),ad=this.trainingProperties();
if(!dv.util.isUndefined(ad)){ad=ad.slice(0)
}var af=dv.scale.continuous().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).reverse(this.reverse()).domain(ae).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).trainingProperties(ad).scaleIndex(this._scaleIndex);
af._naturalDomain=this._naturalDomain;
return af
};
ac.invert=function(ad){return this._d3Scale.invert(ad[this.mapping()])
};
ac.invertFromProp=function(ad){return this._d3Scale.invert(ad[this.property()])
};
ac.copy=ac._copy;
return ac
});
dv.scale.linear=dv.scale.continuous.extend(function(){function ac(){this._super(d3.scale.linear())
}ac._copy=function(){var ae=this.domain().slice(0),ad=this.trainingProperties();
if(!dv.util.isUndefined(ad)){ad=ad.slice(0)
}var af=dv.scale.linear().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(ae).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(ad).scaleIndex(this._scaleIndex);
af._naturalDomain=this._naturalDomain;
return af
};
ac.copy=ac._copy;
return ac
});
dv.scale.gradient=dv.scale.continuous.extend(function(){function ac(){this._super(d3.scale.linear());
this._innerScale=d3.scale.linear().range([0,1]);
this.colors=this.range;
this._controlPoints=["0%","50%","100%"];
this.colors(["#FA5A50","#E1E1E1","#5FAF69"])
}ac._adjustOuterDomain=function(){var ad=this;
this._d3Scale.domain(dv.util.map(this._controlPoints,function(af,ae){return dv.util.isPercentString(af)?ad._innerScale.invert(parseInt(af,10)/100):af
}))
};
ac.controlPoints=function(ad){if(!arguments.length){return this._controlPoints
}this._controlPoints=ad;
this._adjustOuterDomain();
return this
};
ac.domain=function(ad){if(!arguments.length){return this._innerScale.domain()
}if(!this._innerScale){return this
}this._innerScale.domain(ad);
this._adjustOuterDomain();
return this
};
ac._copy=function(){var ae=this.domain().slice(0),ad=this.trainingProperties();
if(!dv.util.isUndefined(ad)){ad=ad.slice(0)
}var af=dv.scale.gradient().property(this.property()).mapping(this.mapping()).domain(ae).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).includeInDomain(this.includeInDomain()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).controlPoints(this.controlPoints()).reverse(this.reverse()).trainingProperties(ad).scaleIndex(this._scaleIndex);
af._naturalDomain=this._naturalDomain;
return af
};
ac.copy=ac._copy;
return ac
});
dv.scale.time=dv.scale.continuous.extend(function(){function ac(){this._super(d3.time.scale());
this._parse=function(ad){return(ad instanceof Date)?ad:new Date(Date.parse(ad))
}
}ac._copy=function(){var ae=this.domain().slice(0),ad=this.trainingProperties();
if(!dv.util.isUndefined(ad)){ad=ad.slice(0)
}var af=dv.scale.time().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(ae).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(ad).scaleIndex(this._scaleIndex);
af._naturalDomain=this._naturalDomain;
return af
};
ac.copy=ac._copy;
ac._reconcileLimits=function(af,ae,ad){if(!dv.util.isUndefined(this._softLowerLimit)){af[0]=Math.min(af[0],this._softLowerLimit);
af[1]=Math.max(af[1],this._softLowerLimit)
}if(!dv.util.isUndefined(this._lowerLimit)){af[0]=dv.util.isFunction(this._lowerLimit)?this._parse(this._lowerLimit(new Date(ae),new Date(ad))):this._lowerLimit
}if(!dv.util.isUndefined(this._upperLimit)){af[1]=dv.util.isFunction(this._upperLimit)?this._parse(this._upperLimit(new Date(ae),new Date(ad))):this._upperLimit
}};
return ac
});
dv.scale.time.utc=dv.scale.continuous.extend(function(){function ac(){this._super(d3.time.scale.utc());
this._parse=function(ad){return(ad instanceof Date)?ad:new Date(Date.parse(ad))
}
}ac._copy=function(){var ae=this.domain().slice(0),ad=this.trainingProperties();
if(!dv.util.isUndefined(ad)){ad=ad.slice(0)
}var af=dv.scale.time.utc().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(ae).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(ad).scaleIndex(this._scaleIndex);
af._naturalDomain=this._naturalDomain;
return af
};
ac.copy=ac._copy;
ac._reconcileLimits=function(af,ae,ad){if(!dv.util.isUndefined(this._softLowerLimit)){af[0]=Math.min(af[0],this._softLowerLimit);
af[1]=Math.max(af[1],this._softLowerLimit)
}if(!dv.util.isUndefined(this._lowerLimit)){af[0]=dv.util.isFunction(this._lowerLimit)?this._parse(this._lowerLimit(new Date(ae),new Date(ad))):this._lowerLimit
}if(!dv.util.isUndefined(this._upperLimit)){af[1]=dv.util.isFunction(this._upperLimit)?this._parse(this._upperLimit(new Date(ae),new Date(ad))):this._upperLimit
}};
return ac
});
dv.scale.ordinal=dv.scale.extend(function(){function ac(){this._super(d3.scale.ordinal());
this._defaultPadding=0.1;
this._defaultOuterPadding=0;
this._rangeExtent=[];
this._rangeBandsSet=false
}ac._mapToD3Scale=function(ah){var af=this.domain(),ae=-1,ai=af.length,ad=-1;
while(++ae<ai){var ag=af[ae];
if(ag===ah||dv.util.isDate(ag)&&ag.getTime()===ah.getTime()){ad=ae;
break
}}return(ad<0)?undefined:this._d3Scale(ah)
};
ac.calculateDomain=function(ak,ao){var af={};
var am=[],al=this.trainingProperties();
ao=ao||{};
for(var ag=0;
ag<al.length;
ag++){var ae=al[ag];
for(var ai=0;
ai<ak.length;
ai++){var an=ak[ai].values;
if(!ao.filter||!ao.filter.call(this,ak[ai].key)){for(var aj=0;
aj<an.length;
aj++){var ad=an[aj];
if(!this._includeInDomain(ad,aj)){continue
}if(this.scaleIndex()!==0){ad[this.property()+"-index"]=this.scaleIndex()
}var ah=this._parse.call(this,ad[ae]);
if(!dv.util.isUndefined(ah)&&!af.hasOwnProperty(ah)){af[ah]=ah;
am.push(ah)
}}}}}return am.length?am:[]
};
ac.unionDomain=function(af,ae){if(!af||!(af instanceof dv.scale.ordinal)){dv.log.error({msg:"The supplied scale is not ordinal.",data:{scale:af,isReversed:ae}})
}var ad=af.domain();
if(ad&&!dv.util.isArray(ad)){throw new Error("The supplied domain is not an array")
}if(ad){this.reverse(ae||this._reverse);
this.domain(this.domain()?dv.util.union(this.domain(),ad):ad)
}return this
};
ac.unionRange=function(ad){if(ad&&!dv.util.isArray(ad)){throw new Error("The supplied range is not an array")
}if(ad){this.range(this.range()?dv.util.union(this.range(),ad):ad)
}return this
};
ac.invertValue=function(af){var ad=this.range().indexOf(af),ae=this.domain();
if(ad<0){throw new Error("The supplied value does not exist in the specified range.")
}return ae[ad%ae.length]
};
ac.padding=function(ad){if(!arguments.length){return dv.util.isUndefined(this._padding)?this._defaultPadding:this._padding
}this._padding=ad;
if(this._rangeBandsSet){this._d3Scale.rangeBands(this.rangeExtent(),this._padding,this.outerPadding())
}return this
};
ac.outerPadding=function(ad){if(!arguments.length){return dv.util.isUndefined(this._outerPadding)?(dv.util.isUndefined(this._padding)?this._defaultOuterPadding:this.padding()):this._outerPadding
}this._outerPadding=ad;
if(this._rangeBandsSet){this._d3Scale.rangeBands(this.rangeExtent(),this.padding(),this._outerPadding)
}return this
};
ac.rangeBands=function(ad){if(!arguments.length){return this._d3Scale.range()
}this._rangeBandsSet=true;
this._d3Scale.rangeBands(ad,this.padding(),this.outerPadding());
this.rangeExtent(ad);
return this
};
ac.rangeBand=function(){return this._d3Scale.rangeBand()
};
ac.range=function(ad){if(!arguments.length){return this._d3Scale.range()
}if(!this._d3Scale){return this
}if(!dv.util.isValidValue(ad,["isArray"])){dv.log.error({msg:"The supplied range is not an array",data:{range:ad}})
}this._d3Scale.range(ad);
this.rangeExtent([ad[0],ad[ad.length-1]]);
return this
};
ac.rangeExtent=function(ad){if(!arguments.length){return this._rangeExtent
}if(!dv.util.isValidValue(ad,["isArray"])){dv.log.error({msg:"The supplied range extent is not an array",data:{range:ad}})
}this._rangeExtent=ad;
return this
};
ac.values=function(ad){if(!arguments.length){return this._d3Scale.range()
}if(!dv.util.isValidValue(ad,["isArray"])){dv.log.error({msg:"The supplied values is not an array",data:{range:ad}})
}return this.range(ad)
};
ac.drop=function(ad){if(!arguments.length){return this._drop
}this._drop=ad;
return this
};
ac._copy=function(){var ae=this.domain().slice(0),ad=this.trainingProperties();
if(!dv.util.isUndefined(ad)){ad=ad.slice(0)
}var af=dv.scale.ordinal().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(ae).includeInDomain(this.includeInDomain()).range(this.range().slice(0)).rangeExtent(this.rangeExtent().slice(0)).reverse(this.reverse()).padding(this._padding).outerPadding(this._outerPadding).trainingProperties(ad).scaleIndex(this._scaleIndex);
if(this._rangeBandsSet){af.rangeBands(this.rangeExtent().slice(0))
}return af
};
ac.copy=ac._copy;
return ac
});
dv.scale.color=dv.scale.ordinal.extend(function(){var ad=["#8CC350","#5A6EAA","#D755A5","#1EBED7","#F0A01E","#9B8CE6","#3CB5A0","#3287D2","#F0557D","#C3D250","#EB782D","#78B4F5","#5FAF69","#AA5FA5","#FA5A50","#F5C841"];
function ac(){this._super();
this.range(ad)
}ac._copy=function(){var af=this.domain().slice(0),ae=this.trainingProperties();
if(!dv.util.isUndefined(ae)){ae=ae.slice(0)
}var ag=dv.scale.ordinal().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(af).range(this.range()).rangeExtent(this.rangeExtent()).includeInDomain(this.includeInDomain()).reverse(this.reverse()).padding(this._padding).outerPadding(this._outerPadding).trainingProperties(ae).scaleIndex(this._scaleIndex);
if(this._rangeBandsSet){ag.rangeBands(this.rangeExtent().slice(0)).padding(this._padding).outerPadding(this._outerPadding)
}return ag
};
ac.copy=ac._copy;
return ac
});
dv.scale.shape=dv.scale.ordinal.extend(function(){var ad=["circle","cross","diamond","square","triangle-down","triangle-up"];
function ac(){this._super();
this.range(ad)
}ac._copy=function(){var af=this.domain().slice(0),ae=this.trainingProperties();
if(!dv.util.isUndefined(ae)){ae=ae.slice(0)
}var ag=dv.scale.ordinal().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(af).includeInDomain(this.includeInDomain()).range(this.range().slice(0)).rangeExtent(this.rangeExtent().slice(0)).reverse(this.reverse()).padding(this._padding).outerPadding(this._outerPadding).trainingProperties(ae).scaleIndex(this._scaleIndex);
if(this._rangeBandsSet){ag.rangeBands(this.rangeExtent().slice(0)).padding(this._padding).outerPadding(this._outerPadding)
}return ag
};
ac.copy=ac._copy;
return ac
});
dv.scale.linetype=dv.scale.ordinal.extend(function(){var ad=["solid","dashed","dotted","dotdash","longdash","twodash"];
function ac(){this._super();
this.range(ad)
}ac._copy=function(){var af=this.domain().slice(0),ae=this.trainingProperties();
if(!dv.util.isUndefined(ae)){ae=ae.slice(0)
}var ag=dv.scale.ordinal().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(af).includeInDomain(this.includeInDomain()).range(this.range().slice(0)).rangeExtent(this.rangeExtent().slice(0)).reverse(this.reverse()).padding(this._padding).outerPadding(this._outerPadding).trainingProperties(ae).scaleIndex(this._scaleIndex);
if(this._rangeBandsSet){ag.rangeBands(this.rangeExtent().slice(0)).padding(this._padding).outerPadding(this._outerPadding)
}return ag
};
ac.copy=ac._copy;
return ac
});
dv.scale.size=dv.scale.continuous.extend(function(){function ac(){this._super();
this.to([2,10])
}ac._copy=function(){var ae=this.domain().slice(0),ad=this.trainingProperties();
if(!dv.util.isUndefined(ad)){ad=ad.slice(0)
}var af=dv.scale.size().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(ae).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(ad).scaleIndex(this._scaleIndex);
af._naturalDomain=this._naturalDomain;
return af
};
ac.copy=ac._copy;
return ac
});
dv.scale.identity=dv.scale.ordinal.extend(function(){function ac(ad){this._super(d3.scale.ordinal())
}ac.mapToProp=function(ad){return ad[this.property()]
};
ac.domain=function(ad){if(!arguments.length){return this._d3Scale.domain()
}if(!this._d3Scale){return this
}this._d3Scale.domain(ad);
this._d3Scale.range(ad);
return this
};
ac.range=function(){if(!arguments.length){return this._d3Scale.range()
}return this
};
ac.labels=function(ad){if(!arguments.length){return this._labels
}this._labels=ad;
return this
};
ac._copy=function(){var ae=this.domain().slice(0),ad=this.trainingProperties();
if(!dv.util.isUndefined(ad)){ad=ad.slice(0)
}return dv.scale.identity().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(ae).includeInDomain(this.includeInDomain()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(ad).scaleIndex(this._scaleIndex)
};
ac.copy=ac._copy;
return ac
});
dv.svg=dv.svg||{};
dv.svg.text=function(){var ac=K,ah=J,ad=w,ag=s,ae=C;
function af(ai){return ai.select(function(ak,aj){return ag.call(this,ak,aj)?this:null
}).attr("x",function(ak,aj){return ac.call(this,ak,aj)
}).attr("y",function(ak,aj){return ah.call(this,ak,aj)
}).text(function(ak,aj){return ad.call(this,ak,aj)
})
}af.x=function(ai){if(!arguments.length){return ac
}ac=ai;
return af
};
af.y=function(ai){if(!arguments.length){return ah
}ah=ai;
return af
};
af.label=function(ai){if(!arguments.length){return ad
}ad=ai;
return af
};
af.defined=function(ai){if(!arguments.length){return ag
}ag=ai;
return af
};
af.duration=function(ai){if(!arguments.length){return ae
}ae=ai;
return af
};
return af
};
dv.svg.text.radial=function(){var ah=K,ac=J,ad=w,ag=s,ae=C;
function af(aj){var ai=function(am,al){return ah.call(this,am,al)+g
},ak=function(am,al){return ac.call(this,am,al)
};
return aj.select(function(am,al){return ag.call(this,am,al)?this:null
}).attr("x",function(am,al){return ak(am,al)*Math.cos(ai(am,al))
}).attr("y",function(am,al){return ak(am,al)*Math.sin(ai(am,al))
}).text(function(am,al){return ad.call(this,am,al)
})
}af.angle=function(ai){if(!arguments.length){return ah
}ah=ai;
return af
};
af.radius=function(ai){if(!arguments.length){return ac
}ac=ai;
return af
};
af.label=function(ai){if(!arguments.length){return ad
}ad=ai;
return af
};
af.defined=function(ai){if(!arguments.length){return ag
}ag=ai;
return af
};
af.duration=function(ai){if(!arguments.length){return ae
}ae=ai;
return af
};
return af
};
function K(ac){return ac[0]
}function J(ac){return ac[1]
}function w(ac){return ac[2]
}function s(){return true
}function C(){return 0
}dv.svg.rect=function(){var ad=R,ac=Q,ag=o,ae=n,ah=G;
function af(aj,ai){if(ah.call(this,aj,ai)){return L(ad.call(this,aj,ai),ac.call(this,aj,ai),ag.call(this,aj,ai),ae.call(this,aj,ai))
}return null
}af.x0=function(ai){if(!arguments.length){return ad
}ad=ai;
return af
};
af.x1=function(ai){if(!arguments.length){return ac
}ac=ai;
return af
};
af.y0=function(ai){if(!arguments.length){return ag
}ag=ai;
return af
};
af.y1=function(ai){if(!arguments.length){return ae
}ae=ai;
return af
};
af.defined=function(ai){if(!arguments.length){return ah
}ah=ai;
return af
};
return af
};
function R(ac){return ac[0]
}function Q(ac){return ac[1]
}function o(ac){return ac[2]
}function n(ac){return ac[3]
}function G(){return true
}function L(ad,ac,af,ae){return"M"+ad+","+af+"L"+ac+","+af+"L"+ac+","+ae+"L"+ad+","+ae+"Z"
}dv.svg.symbol=function(){var ae=N,ad=U,ac=aa,ah=Z,ag=f;
function af(aj,ai){if(ag.call(this,aj,ai)){return(M[ae.call(this,aj,ai)]||M.circle)(ad.call(this,aj,ai),ac.call(this,aj,ai),ah.call(this,aj,ai))
}return null
}af.x=function(ai){if(!arguments.length){return ac
}ac=ai;
return af
};
af.y=function(ai){if(!arguments.length){return ah
}ah=ai;
return af
};
af.type=function(ai){if(!arguments.length){return ae
}ae=d3.functor(ai);
return af
};
af.size=function(ai){if(!arguments.length){return ad
}ad=d3.functor(ai);
return af
};
af.defined=function(ai){if(!arguments.length){return ag
}ag=ai;
return af
};
return af
};
dv.svg.symbol.radial=function(){var ae=N,ad=U,ah=aa,ac=Z,ag=f;
function af(am,ak){if(ag.call(this,am,ak)){var aj=ah.call(this,am,ak)+g,al=ac.call(this,am,ak),ai=al*Math.cos(aj),an=al*Math.sin(aj);
return(M[ae.call(this,am,ak)]||M.circle)(ad.call(this,am,ak),ai,an)
}return null
}af.angle=function(ai){if(!arguments.length){return ah
}ah=ai;
return af
};
af.radius=function(ai){if(!arguments.length){return ac
}ac=ai;
return af
};
af.type=function(ai){if(!arguments.length){return ae
}ae=d3.functor(ai);
return af
};
af.size=function(ai){if(!arguments.length){return ad
}ad=d3.functor(ai);
return af
};
af.defined=function(ai){if(!arguments.length){return ag
}ag=ai;
return af
};
return af
};
d3.svg.symbolTypes=d3.keys(M);
var M={circle:function(ad,ac,af){var ae=Math.sqrt(ad/Math.PI);
return"M"+ac+","+(af+ae)+"A"+ae+","+ae+" 0 1,1 "+ac+","+(af-ae)+"A"+ae+","+ae+" 0 1,1 "+ac+","+(af+ae)+"Z"
},cross:function(ad,ac,af){var ae=Math.sqrt(ad/5)/2;
return"M"+(ac+-3*ae)+","+(af-ae)+"H"+(ac-ae)+"V"+(af+-3*ae)+"H"+(ac+ae)+"V"+(af-ae)+"H"+(ac+3*ae)+"V"+(af+ae)+"H"+(ac+ae)+"V"+(af+3*ae)+"H"+(ac-ae)+"V"+(af+ae)+"H"+(ac-3*ae)+"Z"
},diamond:function(ad,ac,ag){var ae=Math.sqrt(ad/(2*t)),af=ae*t;
return"M"+ac+","+(ag-ae)+"L"+(ac+af)+","+ag+" "+ac+","+(ag+ae)+" "+(ac-af)+","+ag+"Z"
},square:function(ad,ac,af){var ae=Math.sqrt(ad)/2;
return"M"+(ac-ae)+","+(af-ae)+"L"+(ac+ae)+","+(af-ae)+" "+(ac+ae)+","+(af+ae)+" "+(ac-ae)+","+(af+ae)+"Z"
},"triangle-down":function(ad,ac,ag){var af=Math.sqrt(ad/D),ae=af*D/2;
return"M"+ac+","+(ag+ae)+"L"+(ac+af)+","+(ag-ae)+" "+(ac-af)+","+(ag-ae)+"Z"
},"triangle-up":function(ad,ac,ag){var af=Math.sqrt(ad/D),ae=af*D/2;
return"M"+ac+","+(ag-ae)+"L"+(ac+af)+","+(ag+ae)+" "+(ac-af)+","+(ag+ae)+"Z"
}};
function U(){return 64
}function N(){return"circle"
}function aa(ac){return ac[0]
}function Z(ac){return ac[1]
}function f(ac){return true
}dv.svg.errorBar=function(){var ae=T,ad=S,ag=r,af=p,ah=z,ai=v;
function ac(ak,aj){if(ai.call(this,ak,aj)){return d(ae.call(this,ak,aj),ad.call(this,ak,aj),ag.call(this,ak,aj),af.call(this,ak,aj),ah.call(this,ak,aj))
}return null
}ac.x0=function(aj){if(!arguments.length){return ae
}ae=aj;
return ac
};
ac.x1=function(aj){if(!arguments.length){return ad
}ad=aj;
return ac
};
ac.y0=function(aj){if(!arguments.length){return ag
}ag=aj;
return ac
};
ac.y1=function(aj){if(!arguments.length){return af
}af=aj;
return ac
};
ac.flip=function(aj){if(!arguments.length){return ah
}ah=aj;
return ac
};
ac.defined=function(aj){if(!arguments.length){return ai
}ai=aj;
return ac
};
return ac
};
function T(ac){return ac[0]
}function S(ac){return ac[1]
}function r(ac){return ac[2]
}function p(ac){return ac[3]
}function z(){return false
}function v(){return true
}function d(ae,ad,ag,af,ah){var ac;
if(ah){ac=ag+((af-ag)/2);
return"M"+ae+","+ag+"L"+ae+","+af+"M"+ae+","+ac+"L"+ad+","+ac+"M"+ad+","+ag+"L"+ad+","+af
}else{ac=ae+((ad-ae)/2);
return"M"+ae+","+ag+"L"+ad+","+ag+"M"+ac+","+ag+"L"+ac+","+af+"M"+ae+","+af+"L"+ad+","+af
}}var D=Math.sqrt(3),t=Math.tan(30*Math.PI/180);
var g=-Math.PI/2;
dv.svg.poly=function(){var af=b,ac=E,ad=k;
function ae(ah,ag){if(af.call(this,ah,ag)){return O(ac.call(this,ah,ag),ad.call(this,ah,ag))
}return null
}ae.xs=function(ag){if(!arguments.length){return ac
}ac=ag;
return ae
};
ae.ys=function(ag){if(!arguments.length){return ad
}ad=ag;
return ae
};
ae.defined=function(ag){if(!arguments.length){return af
}af=ag;
return af
};
return ae
};
dv.svg.poly.radial=function(){var af=b,ae=E,ad=k;
function ac(al,ai){if(af.call(this,al,ai)){var ap=ae.call(this,al,ai);
var ak=ad.call(this,al,ai);
var am=d3.max([ap.length,ak.length]);
var aj="M";
for(var ah=0;
ah<am;
ah++){if(ah>0){aj+="L"
}var aq=ap[ah]+g,ag=ak[ah],ao=ag*Math.cos(aq),an=ag*Math.sin(aq);
aj+=(ah<ap.length?ao:"0");
aj+=",";
aj+=(ah<ak.length?an:"0")
}aj+="Z";
return aj
}return null
}ac.angles=function(ag){if(!arguments.length){return ae
}ae=ag;
return ac
};
ac.radii=function(ag){if(!arguments.length){return ad
}ad=ag;
return ac
};
ac.defined=function(ag){if(!arguments.length){return af
}af=ag;
return af
};
return ac
};
function b(ac){return true
}function E(ac){return ac[0]
}function k(ac){return ac[1]
}function O(ad,af){var ac=d3.max([ad.length,af.length]);
var ag="M";
for(var ae=0;
ae<ac;
ae++){if(ae>0){ag+="L"
}ag+=(ae<ad.length?ad[ae]:"0");
ag+=",";
ag+=(ae<af.length?af[ae]:"0")
}ag+="Z";
return ag
}dv.util={};
dv.util.filterAndZip=function(ad,ak,aj){var al=[],an=[];
if(!ak){for(var ac in ad){al=ad[ac];
break
}}else{al=ad[ak]
}var ae=-1,ag=al.length;
while(++ae<ag){var am=al[ae];
if(!aj||am==aj){var ai={};
for(var ah in ad){if(ah==="data"){ai[ah]={};
for(var af in ad[ah]){ai[ah][af]=ad[ah][af][ae]
}}else{ai[ah]=ad[ah][ae]
}}an.push(ai)
}}return an
};
dv.util.binaryCompare=function(ad,ac,ah,ag,af){var ai=ag;
if(arguments.length<4){ai=0
}if(arguments.length<5){af=ad.length
}while(ai<af){var ae=(ai+af)>>1;
if(ac<ah(ad[ae])){af=ae
}else{ai=ae+1
}}if(ai==ag||Math.abs(ah(ad[ai])-ac)<Math.abs(ah(ad[ai-1])-ac)){return ai
}else{return ai-1
}};
dv.util.uniqueValues=function(ae,ac){var ad=[];
dv.util.each(ae,function(aj,ag){var ah=-1,ak=ad.length,ai=false;
while(++ah<ak){var af=ad[ah];
if(ac(aj,af)){ai=true;
break
}}if(!ai){ad.push(ae[ah])
}});
return ad
};
dv.util.scaleRange=function(ad,ac){if(arguments.length===1){return ad.rangeExtent?ad.rangeExtent():ad.range()
}if(ad.rangeExtent){ad.rangeBands(ac)
}else{ad.range(ac)
}return ad
};
dv.util.minRangeDistance=function(ag,ad){var af=Number.MAX_VALUE,ae,ac;
dv.util.each(ad,function(ah){dv.util.each(ah.values,function(ai){ae=ai.panel.xScale(ai).mapValue(ai[ag]);
if(!dv.util.isUndefined(ac)){af=Math.min(af,Math.abs(ae-ac))
}ac=ae
})
});
return af
};
dv.util.scaleRangeNoReverse=function(ac){return ac.rangeExtent?ac.rangeExtent():dv.util.scaleExtent(ac.range())
};
dv.util.scaleExtent=function(ad){var ae=ad[0],ac=ad[ad.length-1];
return ae<ac?[ae,ac]:[ac,ae]
};
dv.util.merge=function(ae,ad){var ac={};
var af;
for(af in ae){ac[af]=ae[af]
}for(af in ad){ac[af]=ad[af]
}return ac
};
dv.util.getPercentValue=function(ad,ac){return(dv.util.isPercentString(ad))?(ac*parseInt(ad,10)/100):ad
};
dv.util.isPercentString=function(ac){return(typeof ac==="string"&&/^(-?[0-9]+)%$/.test(ac))
};
dv.util.isValidValue=function(ae,ad){for(var ac=0;
ac<ad.length;
ac++){if(dv.util[ad[ac]](ae)){return true
}}return false
};
dv.util.identity=function(ac){return ac
};
dv.util.clamp=function(ae,ad,ac){return Math.min(Math.max(ae,ad),ac)
};
dv.util.clone=function(ac){if(!dv.util.isObject(ac)){return ac
}return dv.util.isArray(ac)?ac.slice():dv.util.extend({},ac)
};
dv.util.isArray=function(ac){if(Array.isArray){return Array.isArray(ac)
}return Object.prototype.toString.call(ac)=="[object Array]"
};
dv.util.isObject=function(ac){return ac===Object(ac)
};
dv.util.isFunction=function(ac){return Object.prototype.toString.call(ac)=="[object Function]"
};
dv.util.isUndefined=function(ac){return ac===void 0
};
dv.util.isFinite=function(ac){return isFinite(ac)&&!isNaN(parseFloat(ac))
};
dv.util.isDate=function(ac){return ac instanceof Date
};
dv.util.isEmpty=function(ac){return Object.keys(ac).length===0
};
dv.util.extend=function(ac){dv.util.each(Array.prototype.slice.call(arguments,1),function(ad){for(var ae in ad){ac[ae]=ad[ae]
}});
return ac
};
dv.util.each=function(ah,ag,af){if(ah==null){return
}if(Array.prototype.forEach&&ah.forEach===Array.prototype.forEach){ah.forEach(ag,af)
}else{if(ah.length===+ah.length){for(var ae=0,ac=ah.length;
ae<ac;
ae++){if(ag.call(af,ah[ae],ae,ah)==={}){return
}}}else{for(var ad in ah){if(dv.util.has(ah,ad)){if(ag.call(af,ah[ad],ad,ah)==={}){return
}}}}}};
dv.util.has=function(ad,ac){return Object.prototype.hasOwnProperty.call(ad,ac)
};
dv.util.uniq=function(ai,ah,ag,af){if(dv.util.isFunction(ah)){af=ag;
ag=ah;
ah=false
}var ad=ag?dv.util.map(ai,ag,af):ai;
var ae=[];
var ac=[];
dv.util.each(ad,function(ak,aj){if(ah?(!aj||ac[ac.length-1]!==ak):!dv.util.contains(ac,ak)){ac.push(ak);
ae.push(ai[aj])
}});
return ae
};
dv.util.union=function(){return dv.util.uniq(Array.prototype.concat.apply(Array.prototype,arguments))
};
dv.util.contains=function(ad,ac){if(ad==null){return false
}if(Array.prototype.indexOf&&ad.indexOf===Array.prototype.indexOf){return ad.indexOf(ac)!=-1
}return dv.util.any(ad,function(ae){return ae===ac
})
};
dv.util.any=function(af,ae,ad){if(!ae){ae=dv.util.identity
}var ac=false;
if(af==null){return ac
}if(Array.prototype.some&&af.some===Array.prototype.some){return af.some(ae,ad)
}dv.util.each(af,function(ai,ag,ah){if(ac||(ac=ae.call(ad,ai,ag,ah))){return{}
}})
};
dv.util.sortBy=function(ag,af,ac){var ae=function(ah){return dv.util.isFunction(ah)?ah:function(ai){return ai[ah]
}
};
var ad=ae(af);
return dv.util.pluck(dv.util.map(ag,function(aj,ah,ai){return{value:aj,index:ah,criteria:ad.call(ac,aj,ah,ai)}
}).sort(function(ak,aj){var ai=ak.criteria;
var ah=aj.criteria;
if(ai!==ah){if(ai>ah||ai===void 0){return 1
}if(ai<ah||ah===void 0){return -1
}}return ak.index<aj.index?-1:1
}),"value")
};
dv.util.pluck=function(ad,ac){return dv.util.map(ad,function(ae){return ae[ac]
})
};
dv.util.map=function(af,ae,ad){var ac=[];
if(af===null){return ac
}if(Array.prototype.map&&af.map===Array.prototype.map){return af.map(ae,ad)
}dv.util.each(af,function(ai,ag,ah){ac[ac.length]=ae.call(ad,ai,ag,ah)
});
return ac
};
dv.util.reduce=function(ag,af,ac,ae){var ad=arguments.length>2;
if(ag===null){ag=[]
}if(Array.prototype.reduce&&ag.reduce===Array.prototype.reduce){if(ae){af=dv.util.bind(af,ae)
}return ad?ag.reduce(af,ac):ag.reduce(af)
}dv.util.each(ag,function(aj,ah,ai){if(!ad){ac=aj;
ad=true
}else{ac=af.call(ae,ac,aj,ah,ai)
}});
if(!ad){throw new TypeError("Reduce of empty array with no initial value")
}return ac
};
dv.util.bind=function(ae,ad){if(ae.bind===Function.prototype.bind&&Function.prototype.bind){return Function.prototype.bind.apply(ae,Array.prototype.slice.call(arguments,1))
}var ac=Array.prototype.slice.call(arguments,2);
return function(){return ae.apply(ad,ac.concat(Array.prototype.slice.call(arguments)))
}
};
dv.util.noop=function(){};
dv.util.each(["Arguments","String","Number","RegExp"],function(ac){dv.util["is"+ac]=function(ad){return toString.call(ad)=="[object "+ac+"]"
}
});
dv.util.validateParam=function(af,ae,ad,ah){if(ae==="isString"){if(dv.util.isString(af)){if(dv.util.isArray(ad)&&(ad.indexOf(af.toLowerCase())!==-1)){return af.toLowerCase()
}}return ah
}else{if(ae==="isNumber"){if(dv.util.isNumber(af)){if(dv.util.isArray(ad)&&(af<=ad[1]&&af>=ad[0])){return af
}}return ah
}else{if(ae==="isFunction"){if(dv.util.isFunction(af)){return af
}return ah
}else{if(ae==="isDimension"){if(af==="x"||af==="X"){return"x"
}if(af==="y"||af==="Y"){return"y"
}if(af===["x","y"]||af===["X","y"]||af===["x","Y"]||af===["X","Y"]){return["x","y"]
}return ah
}else{if(ae==="isRange"){var ac=ad[0],ag=ad[1];
if(dv.util.isArray(af)&&af.length===2){if(dv.util.isNumber(af[0])&&dv.util.isNumber(af[1])){ac=Math.max(Math.min(af[0],af[1]),ad[0]);
ag=Math.min(Math.max(af[0],af[1]),ad[1])
}return[ac,ag]
}return ah
}}}}}};
dv.util=dv.util||{};
dv.util.svg={};
dv.util.svg.getDasharray=function(ac){if(ac.indexOf(",")!=-1||ac.indexOf(" ")!=-1){return ac
}if(m.hasOwnProperty(ac)){return m[ac]
}throw new Error("The dashed line format is invalid")
};
var m={solid:"",dashed:"7,4",dotted:"2,3",dotdash:"2,3,7,4",longdash:"11,4",twodash:"5,2,11,2"};
dv.container=dv.extend(function(){var ad={x:dv.scale.linear,y:dv.scale.linear,yMin:dv.scale.linear,yMax:dv.scale.linear,xMin:dv.scale.linear,xMax:dv.scale.linear,color:dv.scale.color,fill:dv.scale.color,stroke:dv.scale.color,alpha:dv.scale.linear,shape:dv.scale.shape,size:dv.scale.size,radius:dv.scale.linear,group:dv.scale.ordinal,linetype:dv.scale.linetype,label:dv.scale.identity};
function ac(){this._aes={}
}ac.render=function(){throw new Error("render() must be implemented in a subclass")
};
ac._calculateStats=function(){throw new Error("_calculateStats() must be implemented in a subclass")
};
ac._handlePositions=function(){throw new Error("_handlePositions() must be implemented in a subclass")
};
ac.getTrainedScale=function(ae){throw new Error("getTrainedScale() must be implemented in a subclass")
};
ac.getExplicitScalesMap=function(){return this._aes
};
ac._normalizeData=function(af){if(af.hasOwnProperty("data")&&!dv.util.isArray(af.data)){return af
}var ai={},ag=this.getExplicitScalesMap(),ah,ae=this;
dv.util.each(ag,function(an,al){for(var am in an){ah=an[am];
if(!(ah instanceof dv.scale.constant)){var aj=af[ah.mapping()];
if(dv.util.isArray(aj)){var ak=aj.map(function(ao){if(dv.util.isArray(ao)){return ao.map(function(ap){return ah._parse(ap)
})
}else{return ah._parse(ao)
}});
ai[ah.property()]=ak
}}}});
ai.data=af;
return ai
};
ac.map=function(ag,ae,ah,af){if(!ah){ah=ad[ag]().copy().isDefault(true)
}if(!ah){throw new Error("There is no default scale associated with this property. Either the property isn't valid or the scale default doesn't exist.")
}if(arguments.length<4){af=0
}if(!this._aes[ag]){this._aes[ag]={}
}this._aes[ag][af]=ah.property(ag).mapping(ae).scaleIndex(af);
return this
};
ac.set=function(ae,ag){if(!this._aes[ae]){this._aes[ae]={}
}var af=this._aes[ae][0]=dv.scale.constant();
if(dv.util.isFunction(ag)){af.map=af.mapToProp=ag
}else{af.value(ag)
}return this
};
ac.on=function(ag,ah,af){if(arguments.length<3){af=false
}var ae=ah&&dv.util.isFunction(ah);
if(ae){this.eventMap=this.eventMap||{};
this.eventMap[ag]={callback:ah,capture:af}
}else{if(this.eventMap){delete this.eventMap[ag]
}this.unregisterEventMap=this.unregisterEventMap||{};
this.unregisterEventMap[ag]=af
}this._removeRegisteredEvents();
this._addRegisteredEvents();
return this
};
ac.position=function(ae){if(!arguments.length){return(this._chart&&!this._position)?this._chart.position():this._position
}this._position=ae;
return this
};
ac.delay=function(ae){if(!arguments.length){return(this._chart&&dv.util.isUndefined(this._delay))?this._chart.delay():this._delay
}this._delay=d3.functor(ae);
return this
};
ac.duration=function(ae){if(!arguments.length){return(this._chart&&dv.util.isUndefined(this._duration))?this._chart.duration():this._duration
}this._duration=d3.functor(ae);
return this
};
ac.ease=function(ae){if(!arguments.length){return(this._chart&&dv.util.isUndefined(this._ease))?this._chart.ease():this._ease
}this._ease=ae;
return this
};
return ac
});
dv.coord=dv.extend(function(){function ac(){this._flip=false
}ac.flip=function(ad){if(!arguments.length){return this._flip
}this._flip=ad;
return this
};
ac.startX=function(ad){if(!arguments.length){return this._startX
}if(!dv.util.isValidValue(ad,["isFinite","isPercentString"])){dv.log.error({msg:"Invalid value type, startX/startAngle must be a number or percent string",data:{val:ad}})
}this._startX=ad;
return this
};
ac.endX=function(ad){if(!arguments.length){return this._endX
}if(!dv.util.isValidValue(ad,["isFinite","isPercentString"])){dv.log.error({msg:"Invalid value type, endX/endAngle must be a number or percent string",data:{val:ad}})
}this._endX=ad;
return this
};
ac.startY=function(ad){if(!arguments.length){return this._startY
}if(!dv.util.isValidValue(ad,["isFinite","isPercentString"])){dv.log.error({msg:"Invalid value type, startY/innerRadius must be a number or percent string",data:{val:ad}})
}this._startY=ad;
return this
};
ac.endY=function(ad){if(!arguments.length){return this._endY
}if(!dv.util.isValidValue(ad,["isFinite","isPercentString"])){dv.log.error({msg:"Invalid value type, endY/outerRadius must be a number or percent string",data:{val:ad}})
}this._endY=ad;
return this
};
return ac
});
dv.coord.cartesian=dv.coord.extend(function(){function ac(){this._super();
this.startX(0);
this.endX(0);
this.startY(0);
this.endY(0);
this._type="cartesian"
}ac._translatePercentToX=function(ah,af){var ad=dv.util.scaleRange(ah),ag=this._translatePercent(af,ad,this.startX(),this.endX()),ae=Math.abs(ad[1]-ad[0])*3;
return dv.util.clamp(ag,ad[0]-ae,ad[1]+ae)
};
ac._translatePercentToY=function(ah,af){var ad=dv.util.scaleRange(ah),ag=this._translatePercent(af,ad,this.startY(),this.endY()),ae=Math.abs(ad[1]-ad[0])*3;
return dv.util.clamp(ag,ad[1]-ae,ad[0]+ae)
};
ac._translatePercent=function(af,ae,ag,ad){return(((ae[1]-ae[0])-ad-ag)*af+ag+ae[0])
};
ac._translatePercentArrToY=function(af,ae){var ad=this;
return dv.util.map(ae,function(ag){return ad._translatePercentToY(af,ag)
})
};
ac._translatePercentArrToX=function(af,ae){var ad=this;
return dv.util.map(ae,function(ag){return ad._translatePercentToX(af,ag)
})
};
ac._text=function(){var ad=this;
function ae(){var af=dv.svg.text();
if(ad._flip){return af.x(function(ah,ag){return ad._translatePercentToY(ah.panel.yOuterScale(),ae.y()(ah,ag))
}).y(function(ah,ag){return ad._translatePercentToX(ah.panel.xOuterScale(),ae.x()(ah,ag))
})
}else{return af.x(function(ah,ag){return ad._translatePercentToX(ah.panel.xOuterScale(),ae.x()(ah,ag))
}).y(function(ah,ag){return ad._translatePercentToY(ah.panel.yOuterScale(),ae.y()(ah,ag))
})
}}ae.x=function(af){if(!arguments.length){return this._x
}this._x=af;
return this
};
ae.y=function(af){if(!arguments.length){return this._y
}this._y=af;
return this
};
return ae
};
ac._point=function(){var ae=this,ad={};
ad.renderer=dv.svg.symbol().x(function(ag,af){return ag.bounds.x
}).y(function(ag,af){return ag.bounds.y
});
ad.getBounds=function(ag,af){if(!ag.hasOwnProperty("y")){ag.y=0
}if(!ag.hasOwnProperty("x")){ag.x=0
}if(!ad._defined(ag,af)){return null
}if(ae._flip){ag.bounds={x:ae._translatePercentToY(ag.panel.yOuterScale(),ad.y()(ag,af)),y:ae._translatePercentToX(ag.panel.xOuterScale(),ad.x()(ag,af))}
}else{ag.bounds={x:ae._translatePercentToX(ag.panel.xOuterScale(),ad.x()(ag,af)),y:ae._translatePercentToY(ag.panel.yOuterScale(),ad.y()(ag,af))}
}return ag
};
ad.getPath=function(af){return(af===null||af.bounds===undefined)?null:ad.renderer(af)
};
ad.x=function(af){if(!arguments.length){return this._x
}this._x=af;
return ad
};
ad.y=function(af){if(!arguments.length){return this._y
}this._y=af;
return ad
};
ad.defined=function(af){if(!arguments.length){return this._defined
}this._defined=af;
return this
};
return ad
};
ac._line=function(){var ae=this,ad={};
ad.renderer=d3.svg.line().x(function(ag,af){return ag.bounds.x
}).y(function(ag,af){return ag.bounds.y
});
ad.getBounds=function(ah,af){var ag=[];
dv.util.each(ah,function(aj,ai){if(!aj.hasOwnProperty("y")){aj.y=0
}if(!aj.hasOwnProperty("x")){aj.x=0
}if(ad._defined(aj,ai)){if(ae._flip){aj.bounds={x:ae._translatePercentToY(aj.panel.yOuterScale(),ad.y()(aj,ai)),y:ae._translatePercentToX(aj.panel.xOuterScale(),ad.x()(aj,ai))}
}else{aj.bounds={x:ae._translatePercentToX(aj.panel.xOuterScale(),ad.x()(aj,ai)),y:ae._translatePercentToY(aj.panel.yOuterScale(),ad.y()(aj,ai))}
}ag.push(ah[ai])
}});
return ag
};
ad.getPath=function(af){return(af===null)?null:ad.renderer(af)
};
ad.x=function(af){if(!arguments.length){return this._x
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, line.x must be a function",data:{val:af}})
}this._x=af;
return this
};
ad.y=function(af){if(!arguments.length){return this._y
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, line.y must be a function",data:{val:af}})
}this._y=af;
return this
};
ad.defined=function(af){if(!arguments.length){return this._defined
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, line.defined must be a function",data:{val:af}})
}this._defined=af;
return this
};
return ad
};
ac._area=function(){var ad=this,ae={};
ae.renderer=d3.svg.area();
ae.getBounds=function(ah,af){var ag=[];
ae.setupRenderer();
dv.util.each(ah,function(ak,ai){if(!ak.hasOwnProperty("y")){ak.y=0
}if(!ak.hasOwnProperty("x")){ak.x=0
}if(ae._defined(ak,ai)){var aj=dv.util.clone(ak);
aj.bounds={x:ad._translatePercentToX(ak.panel.xOuterScale(),ae.x()(ak,ai)),y0:ad._translatePercentToY(ak.panel.yOuterScale(),ae.y0()(ak,ai)),y1:ad._translatePercentToY(ak.panel.yOuterScale(),ae.y1()(ak,ai))};
ag.push(aj)
}});
return ag
};
ae.getPath=function(af){ae.setupRenderer();
return(af===null)?null:ae.renderer(af)
};
ae.setupRenderer=function(){if(ad._flip){ae.renderer.x(null).y0(null).y1(null).y(function(ag,af){return ag.bounds.x
}).x0(function(ag,af){return ag.bounds.y0
}).x1(function(ag,af){return ag.bounds.y1
})
}else{ae.renderer.y(null).x0(null).x1(null).x(function(ag,af){return ag.bounds.x
}).y0(function(ag,af){return ag.bounds.y0
}).y1(function(ag,af){return ag.bounds.y1
})
}};
ae.x=function(af){if(!arguments.length){return this._x
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, area.x must be a function",data:{val:af}})
}this._x=af;
return this
};
ae.y0=function(af){if(!arguments.length){return this._y0
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, area.y0 must be a function",data:{val:af}})
}this._y0=af;
return this
};
ae.y1=function(af){if(!arguments.length){return this._y1
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, area.y1 must be a function",data:{val:af}})
}this._y1=af;
return this
};
ae.defined=function(af){if(!arguments.length){return this._defined
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, area.defined must be a function",data:{val:af}})
}this._defined=af;
return this
};
return ae
};
ac._rect=function(){var ad=this,ae={};
ae.renderer=dv.svg.rect().x0(function(ag,af){return ag.bounds.x0
}).x1(function(ag,af){return ag.bounds.x1
}).y0(function(ag,af){return ag.bounds.y0
}).y1(function(ag,af){return ag.bounds.y1
});
ae.getBounds=function(aj,af){var ah=dv.util.clone(aj);
var ai=ah[aj.panel.xScale(aj).property()];
if(dv.util.isArray(ai)){ah.x0=ai[0];
ah.x1=ai[1]
}var ag=ah[aj.panel.yScale(aj).property()];
if(dv.util.isArray(ag)){ah.y0=ag[0];
ah.y1=ag[1]
}if(!ae._defined(ah,af)){return null
}if(ad._flip){ah.bounds={x0:ad._translatePercentToY(aj.panel.yOuterScale(),ae.y0()(ah,af)),x1:ad._translatePercentToY(aj.panel.yOuterScale(),ae.y1()(ah,af)),y0:ad._translatePercentToX(aj.panel.xOuterScale(),ae.x0()(ah,af)),y1:ad._translatePercentToX(aj.panel.xOuterScale(),ae.x1()(ah,af))}
}else{ah.bounds={x0:ad._translatePercentToX(aj.panel.xOuterScale(),ae.x0()(ah,af)),x1:ad._translatePercentToX(aj.panel.xOuterScale(),ae.x1()(ah,af)),y0:ad._translatePercentToY(aj.panel.yOuterScale(),ae.y0()(ah,af)),y1:ad._translatePercentToY(aj.panel.yOuterScale(),ae.y1()(ah,af))}
}return ah
};
ae.getPath=function(af){return(af===null)?null:ae.renderer(af)
};
ae.x0=function(af){if(!arguments.length){return this._x0
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, line.x0 must be a function",data:{val:af}})
}this._x0=af;
return this
};
ae.x1=function(af){if(!arguments.length){return this._x1
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, line.x1 must be a function",data:{val:af}})
}this._x1=af;
return this
};
ae.y0=function(af){if(!arguments.length){return this._y0
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, line.y0 must be a function",data:{val:af}})
}this._y0=af;
return this
};
ae.y1=function(af){if(!arguments.length){return this._y1
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, line.y1 must be a function",data:{val:af}})
}this._y1=af;
return this
};
ae.defined=function(af){if(!arguments.length){return this._defined
}if(!dv.util.isValidValue(af,["isFunction"])){dv.log.error({msg:"Invalid value, line.defined must be a function",data:{val:af}})
}this._defined=af;
return this
};
return ae
};
ac._errorBar=function(){var ad=this,ae={};
ae.renderer=dv.svg.errorBar().x0(function(ag,af){return ag.bounds.x0
}).x1(function(ag,af){return ag.bounds.x1
}).y0(function(ag,af){return ag.bounds.y0
}).y1(function(ag,af){return ag.bounds.y1
}).flip(function(){return ad._flip
});
ae.getBounds=function(ah,af){var ag=dv.util.clone(ah);
if(!ae._defined(ag,af)){return null
}if(ad._flip){ag.bounds={x0:ad._translatePercentToY(ah.panel.yOuterScale(),ae.y0()(ag,af)),x1:ad._translatePercentToY(ah.panel.yOuterScale(),ae.y1()(ag,af)),y0:ad._translatePercentToX(ah.panel.xOuterScale(),ae.x0()(ag,af)),y1:ad._translatePercentToX(ah.panel.xOuterScale(),ae.x1()(ag,af))}
}else{ag.bounds={x0:ad._translatePercentToX(ah.panel.xOuterScale(),ae.x0()(ag,af)),x1:ad._translatePercentToX(ah.panel.xOuterScale(),ae.x1()(ag,af)),y0:ad._translatePercentToY(ah.panel.yOuterScale(),ae.y0()(ag,af)),y1:ad._translatePercentToY(ah.panel.yOuterScale(),ae.y1()(ag,af))}
}return ag
};
ae.getPath=function(af){return(af===null)?null:ae.renderer(af)
};
ae.x0=function(af){if(!arguments.length){return this._x0
}this._x0=af;
return this
};
ae.x1=function(af){if(!arguments.length){return this._x1
}this._x1=af;
return this
};
ae.y0=function(af){if(!arguments.length){return this._y0
}this._y0=af;
return this
};
ae.y1=function(af){if(!arguments.length){return this._y1
}this._y1=af;
return this
};
ae.defined=function(af){if(!arguments.length){return this._defined
}this._defined=af;
return this
};
return ae
};
ac._poly=function(){var ad=this,ae={};
ae.renderer=dv.svg.poly().xs(function(ag,af){return ag.bounds.x
}).ys(function(ag,af){return ag.bounds.y
});
ae.getBounds=function(ah,af){var ag=dv.util.clone(ah);
if(ae._defined(ah,af)){if(ad._flip){ag.bounds={x:ad._translatePercentArrToY(ah.panel.yOuterScale(),ae.ys()(ah,af)),y:ad._translatePercentArrToX(ah.panel.xOuterScale(),ae.xs()(ah,af))}
}else{ag.bounds={x:ad._translatePercentArrToX(ah.panel.xOuterScale(),ae.xs()(ah,af)),y:ad._translatePercentArrToY(ah.panel.yOuterScale(),ae.ys()(ah,af))}
}}return ag
};
ae.getPath=function(af){return(af===null)?null:ae.renderer(af)
};
ae.xs=function(af){if(!arguments.length){return this._xs
}this._xs=af;
return this
};
ae.ys=function(af){if(!arguments.length){return this._ys
}this._ys=af;
return this
};
ae.defined=function(af){if(!arguments.length){return this._defined
}this._defined=af;
return this
};
return ae
};
return ac
});
dv.coord.polar=dv.coord.extend(function(){function ac(){this._super();
this.innerRadius=this.startY;
this.outerRadius=this.endY;
this.startAngle=this.startX;
this.endAngle=this.endX;
this.innerRadius(0);
this.outerRadius(0);
this.startAngle(0);
this.endAngle(360);
this._type="polar"
}ac._transformAngleRadiusToXY=function(ae,ad){ae+=-1.570796327;
return[ad*Math.cos(ae),ad*Math.sin(ae)]
};
ac._translatePercentToRadius=function(ae,af){var ad=Math.abs(ae[1]-ae[0])/2,ah=dv.util.getPercentValue(this.innerRadius(),ad),ag=dv.util.getPercentValue(this.outerRadius(),ad);
return(ad-ag-ah)*af+ah
};
ac._translatePercentToTheta=function(ah,af){var ai=360,ad=dv.util.getPercentValue(this.startAngle(),ai),ae=dv.util.getPercentValue(this.endAngle(),ai),ag=(ae-ad)*af+ad;
return ag*0.017453293
};
ac._translatePercentArrToRadius=function(ae,af){var ad=this;
return dv.util.map(af,function(ag){return ad._translatePercentToRadius(ae,ag)
})
};
ac._translatePercentArrToTheta=function(af,ae){var ad=this;
return dv.util.map(ae,function(ag){return ad._translatePercentToTheta(af,ag)
})
};
ac._getRadiusRange=function(ag,af){var ae=dv.util.scaleRange(ag),ad=dv.util.scaleRange(af);
return[0,Math.min(Math.abs(ae[1]-ae[0]),Math.abs(ad[1]-ad[0]))]
};
ac._text=function(){var ad=this;
function ae(){var af=dv.svg.text.radial();
if(ad._flip){return af.angle(function(ah,ag){return ad._translatePercentToTheta(ah.panel.yOuterScale(),ae.y()(ah,ag))
}).radius(function(ah,ag){return ad._translatePercentToRadius(ad._getRadiusRange(ah.panel.xOuterScale(),ah.panel.yOuterScale()),ae.x()(ah,ag))
})
}else{return af.angle(function(ah,ag){return ad._translatePercentToTheta(ah.panel.xOuterScale(),ae.x()(ah,ag))
}).radius(function(ah,ag){return ad._translatePercentToRadius(ad._getRadiusRange(ah.panel.xOuterScale(),ah.panel.yOuterScale()),ae.y()(ah,ag))
})
}}ae.x=function(af){if(!arguments.length){return this._x
}this._x=af;
return this
};
ae.y=function(af){if(!arguments.length){return this._y
}this._y=af;
return this
};
return ae
};
ac._point=function(){var ae=this,ad={};
ad.renderer=dv.svg.symbol.radial().angle(function(ag,af){return ag.bounds.x
}).radius(function(ag,af){return ag.bounds.y
});
ad.getBounds=function(ah,ag){if(!ah.hasOwnProperty("y")){ah.y=0
}if(!ah.hasOwnProperty("x")){ah.x=0
}if(ad._defined(ah,ag)){var af=ae._getRadiusRange(ah.panel.xOuterScale(),ah.panel.yOuterScale());
if(ae._flip){ah.bounds={x:ae._translatePercentToTheta(ah.panel.xOuterScale(),ad.y()(ah,ag)),y:ae._translatePercentToRadius(af,ad.x()(ah,ag))}
}else{ah.bounds={x:ae._translatePercentToTheta(ah.panel.xOuterScale(),ad.x()(ah,ag)),y:ae._translatePercentToRadius(af,ad.y()(ah,ag))}
}}return ah
};
ad.getPath=function(af){return(af===null||dv.util.isUndefined(af.bounds))?null:ad.renderer(af)
};
ad.x=function(af){if(!arguments.length){return this._x
}this._x=af;
return this
};
ad.y=function(af){if(!arguments.length){return this._y
}this._y=af;
return this
};
ad.defined=function(af){if(!arguments.length){return this._defined
}this._defined=af;
return this
};
return ad
};
ac._line=function(){var ae=this,ad={};
ad.renderer=d3.svg.line.radial().angle(function(ag,af){return ag.bounds.x
}).radius(function(ag,af){return ag.bounds.y
});
ad.getBounds=function(ah,af){var ag=[];
dv.util.each(ah,function(ak,aj){var ai=ae._getRadiusRange(ak.panel.xOuterScale(),ak.panel.yOuterScale());
if(!ak.hasOwnProperty("y")){ak.y=0
}if(!ak.hasOwnProperty("x")){ak.x=0
}if(ad._defined(ak,aj)){if(ae._flip){ak.bounds={x:ae._translatePercentToTheta(ak.panel.xOuterScale(),ad.y()(ak,aj)),y:ae._translatePercentToRadius(ai,ad.x()(ak,aj))}
}else{ak.bounds={x:ae._translatePercentToTheta(ak.panel.xOuterScale(),ad.x()(ak,aj)),y:ae._translatePercentToRadius(ai,ad.y()(ak,aj))}
}ag.push(ah[aj])
}});
return ag
};
ad.getPath=function(af){return(af===null)?null:ad.renderer(af)
};
ad.x=function(af){if(!arguments.length){return this._x
}this._x=af;
return this
};
ad.y=function(af){if(!arguments.length){return this._y
}this._y=af;
return this
};
ad.defined=function(af){if(!arguments.length){return this._defined
}this._defined=af;
return this
};
return ad
};
ac._area=function(){var ad=this,ae={};
ae.renderer=d3.svg.area.radial();
ae.getBounds=function(ah,af){var ag=[];
ae.setupRenderer();
dv.util.each(ah,function(al,aj){var ai=ad._getRadiusRange(al.panel.xOuterScale(),al.panel.yOuterScale());
if(!al.hasOwnProperty("y")){al.y=0
}if(!al.hasOwnProperty("x")){al.x=0
}if(ae._defined(al,aj)){var ak=dv.util.clone(al);
if(ad._flip){ak.bounds={x:ad._translatePercentToRadius(ai,ae.x()(al,aj)),y0:ad._translatePercentToTheta(al.panel.xOuterScale(),ae.y0()(al,aj)),y1:ad._translatePercentToTheta(al.panel.xOuterScale(),ae.y1()(al,aj))}
}else{ak.bounds={x:ad._translatePercentToTheta(al.panel.xOuterScale(),ae.x()(al,aj)),y0:ad._translatePercentToRadius(ai,ae.y0()(al,aj)),y1:ad._translatePercentToRadius(ai,ae.y1()(al,aj))}
}ag.push(ak)
}});
return ag
};
ae.getPath=function(af){ae.setupRenderer();
return(af===null)?null:ae.renderer(af)
};
ae.setupRenderer=function(){if(ad._flip){ae.renderer.angle(null).innerRadius(null).outerRadius(null).radius(function(ag,af){return ag.bounds.x
}).startAngle(function(ag,af){return ag.bounds.y0
}).endAngle(function(ag,af){return ag.bounds.y1
})
}else{ae.renderer.radius(null).startAngle(null).endAngle(null).angle(function(ag,af){return ag.bounds.x
}).innerRadius(function(ag,af){return ag.bounds.y0
}).outerRadius(function(ag,af){return ag.bounds.y1
})
}};
ae.x=function(af){if(!arguments.length){return this._x
}this._x=af;
return this
};
ae.y0=function(af){if(!arguments.length){return this._y0
}this._y0=af;
return this
};
ae.y1=function(af){if(!arguments.length){return this._y1
}this._y1=af;
return this
};
ae.defined=function(af){if(!arguments.length){return this._defined
}this._defined=af;
return this
};
return ae
};
ac._rect=function(){var ad=this,ae={};
ae.renderer=d3.svg.arc().startAngle(function(ag,af){return ag.bounds.x0
}).endAngle(function(ag,af){return ag.bounds.x1
}).innerRadius(function(ag,af){return ag.bounds.y0
}).outerRadius(function(ag,af){return ag.bounds.y1
});
ae.getBounds=function(ai,ag){var ah=dv.util.clone(ai);
if(!ae._defined(ah,ag)){return null
}var af=ad._getRadiusRange(ai.panel.xOuterScale(),ai.panel.yOuterScale());
if(ad._flip){ah.bounds={x0:ad._translatePercentToTheta(ai.panel.yOuterScale(),ae.y0()(ah,ag)),x1:ad._translatePercentToTheta(ai.panel.yOuterScale(),ae.y1()(ah,ag)),y0:ad._translatePercentToRadius(af,ae.x0()(ah,ag)),y1:ad._translatePercentToRadius(af,ae.x1()(ah,ag))}
}else{ah.bounds={x0:ad._translatePercentToTheta(ai.panel.xOuterScale(),ae.x0()(ah,ag)),x1:ad._translatePercentToTheta(ai.panel.xOuterScale(),ae.x1()(ah,ag)),y0:ad._translatePercentToRadius(af,ae.y0()(ah,ag)),y1:ad._translatePercentToRadius(af,ae.y1()(ah,ag))}
}return ah
};
ae.getPath=function(af){return(af===null)?null:ae.renderer(af)
};
ae.x0=function(af){if(!arguments.length){return this._x0
}this._x0=af;
return this
};
ae.x1=function(af){if(!arguments.length){return this._x1
}this._x1=af;
return this
};
ae.y0=function(af){if(!arguments.length){return this._y0
}this._y0=af;
return this
};
ae.y1=function(af){if(!arguments.length){return this._y1
}this._y1=af;
return this
};
ae.defined=function(af){if(!arguments.length){return this._defined
}this._defined=af;
return this
};
return ae
};
ac._poly=function(){var ad=this,ae={};
ae.renderer=dv.svg.poly.radial().angles(function(ag,af){return ag.bounds.x
}).radii(function(ag,af){return ag.bounds.y
});
ae.getBounds=function(ai,ag){var ah=dv.util.clone(ai);
if(ae._defined(ai,ag)){var af=ad._getRadiusRange(ai.panel.xOuterScale(),ai.panel.yOuterScale());
if(ad._flip){ah.bounds={x:ad._translatePercentArrToTheta(ai.panel.xOuterScale(),ae.ys()(ai,ag)),y:ad._translatePercentArrToRadius(af,ae.xs()(ai,ag))}
}else{ah.bounds={x:ad._translatePercentArrToTheta(ai.panel.xOuterScale(),ae.xs()(ai,ag)),y:ad._translatePercentArrToRadius(af,ae.ys()(ai,ag))}
}}return ah
};
ae.getPath=function(af){return(af===null)?null:ae.renderer(af)
};
ae.xs=function(af){if(!arguments.length){return this._xs
}this._xs=af;
return this
};
ae.ys=function(af){if(!arguments.length){return this._ys
}this._ys=af;
return this
};
ae.defined=function(af){if(!arguments.length){return this._defined
}this._defined=af;
return this
};
return ae
};
return ac
});
dv.guide=dv.extend(function(){function ac(){this._renderer=null
}ac._render=function(){dv.log.warn({msg:"dv.guide._render should not be called directly, try using dv.guide.legend.render or dv.guide.axis.render"})
};
ac._scale=function(ad){if(!arguments.length){return this.__scale
}this.__scale=ad;
return this
};
ac.orientation=function(ad){if(!arguments.length){return this._orientation
}this._orientation=ad;
return this
};
ac._parent=function(ad){if(!arguments.length){return this.__parent
}this.__parent=ad;
return this
};
ac.scaleIndex=function(ad){if(!arguments.length){return this._scaleIndex
}this._scaleIndex=ad;
return this
};
ac.title=function(ad){if(!arguments.length){return this._title
}this._title=ad;
return this
};
return ac
});
dv.guide.axes=dv.extend(function(){function ac(){this._axes={};
this._emptyTickFormat=function(){return""
}
}ac._initializeAxisRenderers=function(){this._eachAxis(function(af,ae,ad){if(!ad.hasOwnProperty("_orientation")&&af==="x"){ad._orientation="bottom"
}if(!ad.hasOwnProperty("_orientation")&&af==="y"){ad._orientation="left"
}if(this._chart._coord.flip()){switch(ad._orientation){case"top":ad._orientation="right";
break;
case"right":ad._orientation="top";
break;
case"bottom":ad._orientation="left";
break;
case"left":ad._orientation="bottom";
break
}}})
};
ac._measure=function(ae){var af=this._chart._g.select(".panels"),ad=this._chart._axisLabelContainer;
this._eachAxis(function(aj,ai,ah){var ag=this._changeScaleRangeToLocal(ae.getOuterScale(aj));
if(!(this._chart._coord instanceof dv.coord.polar)&&ah!=="none"){ah._chart(this._chart)._scale(ag[ai])._parent(af)._labelParent(ad);
ae.margins(ah._measure(ae.margins(),ae.bounds(),ae))
}});
return this
};
ac._getAllOrientations=function(){var ad={};
this._eachAxis(function(ag,af,ae){ad[ae._orientation]=ag
});
return ad
};
ac._render=function(af,ae,ad){this._eachAxis(function(aj,ai,ah){var ag=this._changeScaleRangeToLocal(ad.getOuterScale(aj));
if(this._chart._coord instanceof dv.coord.polar||ah==="none"){af.selectAll(".axis-"+aj+".axis-index-"+ai).transition().duration(this._chart._duration).style("opacity",0).remove();
this._chart._chartContainer.select(".axes-labels .axis-"+aj+".axis-index-"+ai).transition().duration(this._chart._duration).style("opacity",0).remove()
}else{ah._chart(this._chart)._parent(af)._scale(ag[ai])._labelParent(ae)._render(af,ad,ad.bounds())
}});
return this
};
ac._measureTitles=function(ae){var ad=this._chart._axisLabelContainer;
this._eachAxis(function(ai,ah,ag){if(ag!=="none"){var af=ag._chart(this._chart)._measureAxisTitle(ad,ai,ah,ae);
ae.left+=af.left;
ae.top+=af.top;
ae.right-=af.right;
ae.bottom-=af.bottom
}});
return ae
};
ac._renderTitles=function(af,ad){var ae=this._chart._axisLabelContainer;
this._eachAxis(function(ai,ah,ag){if(ag==="none"||!ag.title()){ae.selectAll(".axis-title-"+ai+".axis-title-index-"+ah).transition().duration(this._chart._duration).style("opacity",0).remove()
}else{ag._chart(this._chart)._renderAxisTitle(ae,ad,ai,ah,af)
}})
};
ac._changeScaleRangeToLocal=function(ae){var af=ae.range();
var ad=ae.innerScaleGroup();
for(var ag in ad){dv.util.scaleRange(ad[ag],[af[0],af[1]])
}return ad
};
ac._eachAxis=function(ae){for(var ag in this._axes){var af=this._axes[ag];
for(var ad in af){ae.call(this,ag,+ad,af[ad])
}}};
ac._add=function(ad,ae,af){af=af===undefined?0:af;
var ag=this._axes[ad];
if(!ag){this._axes[ad]=ag={}
}ag[af]=ae;
return this
};
ac._axes=function(ad){if(!arguments.length){return this._axes
}this._axes=ad;
return this
};
ac._get=function(ad){return this._axes[ad]
};
ac._empty=function(){for(var ad in this._axes){delete this._axes[ad]
}this._axes={};
return this
};
ac._chart=function(ad){if(!arguments.length){return this._chart
}this._chart=ad;
return this
};
return ac
});
dv.guide.axis=dv.guide.extend(function(){function ad(){this._ticks=d3.functor(5);
this._tickInterval=undefined;
this._labelGroup=null;
this._htmlLabels=false
}function ac(af,ae){return af+"%"
}ad._measure=function(ag,ae,af){var am=this._getAxisOffset(ae),ai=dv.util.scaleRange(this._scale()),an=this._ticks.call(this,Math.abs(ai[1]-ai[0])),aj,aq=this;
var ak=this._parent().append("g").classed("temp-axis",true);
if(this._shouldDrawAxisLabels(af)){aj=this._constructLabelGroup(this.__labelParent,am,true)
}var ao=this._constructD3Axis(aj,ae,an,af);
var ah=this._measureAxis(ak,am,ao);
var al={left:ah.x+am[0],top:ah.y+am[1],right:ah.x+ah.width+am[0],bottom:ah.y+ah.height+am[1]};
if(aj){aj.selectAll("span").each(function(){var aw=this,ar=d3.select(this),av=aq._htmlLabels?ar.html():ar.text();
if(av){var au=aq._orientation==="right"?aw.offsetWidth/2:0,at=aq._orientation==="bottom"?aw.offsetHeight/2:0,ax=[aw.parentNode.parentNode.offsetLeft+aw.parentNode.offsetLeft+au,aw.parentNode.parentNode.offsetTop+aw.parentNode.offsetTop+at];
al.left=Math.min(ax[0],al.left);
al.top=Math.min(ax[1],al.top);
al.right=Math.max(ax[0]+au,al.right);
al.bottom=Math.max(ax[1]+at,al.bottom)
}})
}ak.remove();
if(aj){aj.remove()
}var ap={};
ap.left=Math.abs(Math.min(al.left-ae.left,0));
ap.top=Math.abs(Math.min(al.top-ae.top,0));
ap.right=Math.max(al.right-ae.right,0);
ap.bottom=Math.max(al.bottom-ae.bottom,0);
return this._unionAxisPadding(ap,ag)
};
ad._render=function(aj,af,al){if(!this._scale()){throw new Error("The axis does not have a scale associated with it.")
}var ai=dv.util.scaleRange(this._scale()),ak=this._ticks.call(this,Math.abs(ai[1]-ai[0])),ah;
var ag=this._getAxisOffset(al);
if(this._shouldDrawAxisLabels(af)){ah=this._constructLabelGroup(this.__labelParent,ag)
}else{this.__labelParent.selectAll(".axis-"+this._scale().property()+".axis-index-"+this._scale().scaleIndex()).remove()
}var ae=this._constructD3Axis(ah,al,ak,af);
this._renderAxis(this._parent(),af.bounds(),ag,ae,ah);
return this
};
ad._shouldDrawAxisLabels=function(ae){var ah=ae.facet(),ag=this._scale().property(),af=this.orientation();
return(ah._isFree(ag)&&ah._showAllPanelLabelsIfFree())||ae.visibleAxisLabelOrientations()[af]
};
ad._unionAxisPadding=function(ae,af){af.left=Math.max(af.left,ae.left);
af.top=Math.max(af.top,ae.top);
af.right=Math.max(af.right,ae.right);
af.bottom=Math.max(af.bottom,ae.bottom);
return af
};
ad._constructLabelGroup=function(ag,af,ah){var ai=".axis-"+this._scale().property()+".axis-index-"+this._scale().scaleIndex()+(ah?" .temp-axis":"");
var ae=ag.selectAll(ai).data([0]);
ae.enter().append("div").classed("axis-"+this._scale().property()+" axis-index-"+this._scale().scaleIndex(),true).classed("temp-axis",ah).style("left",af[0]+"px").style("top",af[1]+"px");
if(dv.ANIMATION){ae.transition().delay(this._chart().delay()).duration(this._chart().duration()).ease(this._chart().ease()).style("left",af[0]+"px").style("top",af[1]+"px")
}else{ae.style("left",af[0]+"px").style("top",af[1]+"px")
}return ae
};
ad._getAxisOffset=function(ae){switch(this._orientation){case"bottom":return[0,ae.bottom];
case"left":return[ae.left,0];
case"top":return[0,ae.top];
case"right":return[ae.right,0]
}};
ad._constructD3Axis=function(ai,al,ak,ae){var aj=dv.util.isUndefined(this._tickSize)?this._getDefaultTickSize(al):this._tickSize,ah=dv.util.isUndefined(this._minorTickSize)?this._getDefaultTickSize(al):this._minorTickSize,ag;
if(this._orientation==="left"){ag="right"
}if(this._orientation==="right"){ag="left"
}if(this._orientation==="top"){ag="bottom"
}if(this._orientation==="bottom"){ag="top"
}if(this._scale().property()==="x"){var af=dv.util.scaleRange(this._scale());
af[0]+=this._chart().coord().startX();
af[1]-=this._chart().coord().endX();
if(this._scale() instanceof dv.scale.ordinal){this._scale().rangeBands(af)
}else{this._scale().range(af)
}}return dv.svg.axis()._orient(ag)._labelParent(ai)._panel(ae)._ticks(dv.util.isUndefined(ak)?5:ak,this._tickInterval)._tickSize(aj,ah,aj)._tickDx(dv.util.isUndefined(this._tickDx)?this._getDefaultTickDx():this._tickDx)._tickDy(dv.util.isUndefined(this._tickDy)?this._getDefaultTickDy():this._tickDy)._tickAnchor(dv.util.isUndefined(this._tickAnchor)?this._getDefaultTickAnchor():this._tickAnchor)._tickFormat(dv.util.isUndefined(this._tickFormat)&&this._chart().position()==="fill"&&this._scale().property()==="y"?ac:this._tickFormat)._tickValues(this._tickValues)._htmlLabels(this._htmlLabels)._tickSubdivide(this._tickSubdivide)._scale(this._scale()._d3Scale)
};
ad._renderAxis=function(aj,ai,ag,ae,af){var ah=aj.selectAll(".axis-"+this._scale().property()+".axis-index-"+this._scale().scaleIndex()).data([0]);
ae._labelParent(af);
ah.enter().append("g").classed("axis axis-"+this._scale().property()+" axis-index-"+this._scale().scaleIndex(),true).attr("transform","translate("+ag[0]+","+ag[1]+")");
if(dv.ANIMATION){ah=ah.transition().delay(this._chart().delay()).duration(this._chart().duration()).ease(this._chart().ease())
}ah.attr("transform","translate("+ag[0]+","+ag[1]+")").call(ae)
};
ad._measureAxis=function(ag,af,ae){ag.attr("transform","translate("+af[0]+","+af[1]+")").call(ae);
return ag.node().getBBox()
};
ad._measureAxisTitle=function(am,af,ai,ae){var aj={left:0,top:0,right:0,bottom:0};
if(this._title){var al=am.append("div").classed("temp-axis-title",true),ag=this._titleOrientation||this._orientation,ak=ag==="top"||ag==="bottom"?ae.right-ae.left:ae.bottom-ae.top,ah=this._createAndSizeAxisTitle(al,ag,af,ai,ak),an=ah.node().getBoundingClientRect();
if(ag==="top"||ag==="bottom"){aj[ag]+=an.height
}else{aj[ag]+=an.width
}al.remove()
}return aj
};
ad._renderAxisTitle=function(ar,an,ag,ao,af){var aq=6,am=0,ai=this._titleOrientation||this._orientation,al;
if(!this._title){return
}var ak=ar.selectAll(".axis-title-"+ag+".axis-title-index-"+ao).empty(),ap=ai==="left"||ai==="right",ae=ap?an[ai][1]-af.top:an[ai][0]-af.left,ah=ae*2,aj=this._createAndSizeAxisTitle(ar,ai,ag,ao,ah);
if(dv.ANIMATION){al=aj.transition().duration(this._chart().duration()).delay(this._chart().delay()).ease(this._chart().ease())
}this._positionAxisTitle((ak||!dv.ANIMATION)?aj:al,an[ai],ai);
if(al){al.style("opacity",1)
}else{aj.style("opacity",1)
}};
ad._createAndSizeAxisTitle=function(ag,ae,aj,ah,af){var ai=ag.selectAll(".axis-title-"+aj+".axis-title-index-"+ah).data([ad]);
ai.enter().append("div").classed("axis-title axis-title-"+aj+" axis-title-index-"+ah,true).style("opacity",dv.ANIMATION?0:1);
return ai.text(this._title).style("width",(af-10)+"px").classed({top:ae==="top",bottom:ae==="bottom",left:ae==="left",right:ae==="right"})
};
ad._positionAxisTitle=function(ag,af,ae){ag.style("left",function(){var ah=0;
return af[0]+ah+"px"
}).style("top",function(){var ah=0;
if(ae==="top"){ah=-this.offsetHeight
}return af[1]+ah+"px"
})
};
ad._getDefaultTickSize=function(ae){if(this._orientation==="bottom"){return d3.functor(ae.bottom-ae.top)
}else{if(this._orientation==="left"){return d3.functor(ae.right-ae.left)
}else{if(this._orientation==="top"){return d3.functor(ae.bottom-ae.top)
}else{return d3.functor(ae.right-ae.left)
}}}};
ad._getDefaultTickDx=function(){return(this._orientation==="bottom"||this._orientation==="top")?d3.functor(0):d3.functor(-12)
};
ad._getDefaultTickDy=function(){return(this._orientation==="bottom"||this._orientation==="top")?d3.functor(-12):d3.functor(0)
};
ad._getDefaultTickAnchor=function(){if(this._orientation==="left"){return d3.functor("end")
}if(this._orientation==="right"){return d3.functor("start")
}return d3.functor("middle")
};
ad._labelParent=function(ae){if(!arguments.length){return this.__labelParent
}this.__labelParent=ae;
return this
};
ad.ticks=function(af,ae){if(!arguments.length){return dv.util.isFinite(this._tickInterval)?[this._ticks,this._tickInterval]:this._ticks
}if(arguments.length>1){this._ticks=function(){return af
};
this._tickInterval=ae
}else{this._ticks=d3.functor(af);
this._tickInterval=undefined
}return this
};
ad.tickSubdivide=function(ae){if(!arguments.length){return this._tickSubdivide
}this._tickSubdivide=ae;
return this
};
ad.tickSize=function(ae){if(!arguments.length){return this._tickSize
}this._tickSize=d3.functor(ae);
return this
};
ad.minorTickSize=function(ae){if(!arguments.length){return this._minorTickSize
}this._minorTickSize=d3.functor(ae);
return this
};
ad.tickDx=function(ae){if(!arguments.length){return this._tickDx
}this._tickDx=d3.functor(ae);
return this
};
ad.htmlLabels=function(ae){if(!arguments.length){return this._htmlLabels
}this._htmlLabels=ae;
return this
};
ad.tickDy=function(ae){if(!arguments.length){return this._tickDy
}this._tickDy=d3.functor(ae);
return this
};
ad.tickAnchor=function(ae){if(!arguments.length){return this._tickAnchor
}this._tickAnchor=d3.functor(ae);
return this
};
ad.tickFormat=function(af){if(!arguments.length){var ae=this._scale()._d3Scale;
if(this._tickFormat){return this._tickFormat
}if(ae.tickFormat){return ae.tickFormat(ae)
}return function(ag){return ag
}
}this._tickFormat=af;
return this
};
ad.tickValues=function(ae){if(!arguments.length){return this._tickValues
}this._tickValues=ae;
return this
};
ad.titleOrientation=function(ae){if(!arguments.length){return this._titleOrientation
}this._titleOrientation=ae;
return this
};
ad._chart=function(ae){if(!arguments.length){return this.__chart
}this.__chart=ae;
return this
};
return ad
});
dv.svg.axis=function(){var av=d3.scale.linear(),al="bottom",ar=d3.functor(6),aq=d3.functor(6),ak=d3.functor(6),an=d3.functor(0),am=d3.functor(0),ai=d3.functor("start"),ae=[10],ac=null,ad=false,aw,ao=0,at;
function ah(ay,ax){ay.attr("transform",function(az){return"translate("+ax(az)+",0)"
})
}function ag(ax,ay){ax.attr("transform",function(az){return"translate(0,"+ay(az)+")"
})
}function au(aA,ay,ax){var az=d3.select(aA).select("span").node().offsetWidth;
var aB=ax==="end"?-az:ax==="middle"?-az/2:0;
return ay+aB
}function ap(aB,az,ay){var ax=d3.select(aB).select("span").node().offsetHeight;
var aA=ay==="top"?0:ay==="middle"?-ax/2:-ax;
return az+aA
}function aj(az,aD,ay){var aE=[];
if(ay&&aD.length>1){var aG=dv.util.scaleExtent(az.domain()),aB=-1,ax=aD.length,aC=(aD[1]-aD[0])/++ay,aA,aF;
while(++aB<ax){for(aA=ay;
--aA>0;
){if((aF=+aD[aB]-aA*aC)>=aG[0]){aE.push(aF)
}}}for(--aB,aA=0;
++aA<ay&&(aF=+aD[aB]+aA*aC)<aG[1];
){aE.push(aF)
}}return aE
}function af(az){var ax=function(aD,aG,aE,aF,aC){var aH={};
switch(aC){case"top":aH.top=ap(aD,-am.call(aD,aG,aE),"top");
aH.left=aF(aG)+au(aD,an.call(aD,aG,aE),ai.call(aD,aG,aE));
break;
case"bottom":aH.top=ap(aD,am.call(aD,aG,aE),"bottom");
aH.left=aF(aG)+au(aD,an.call(aD,aG,aE),ai.call(aD,aG,aE));
break;
case"right":aH.top=aF(aG)+ap(aD,am.call(aD,aG,aE),"middle");
aH.left=au(aD,an.call(aD,aG,aE),ai.call(aD,aG,aE));
break;
case"left":aH.top=aF(aG)+ap(aD,am.call(aD,aG,aE),"middle");
aH.left=au(aD,-an.call(aD,aG,aE),ai.call(aD,aG,aE));
break
}aH.top=(isNaN(aH.top)?0:aH.top)+"px";
aH.left=(isNaN(aH.left)?0:aH.left)+"px";
var aB=ai.call(aD,aG,aE);
d3.select(aD).classed({start:aB==="start",middle:aB==="middle",end:aB==="end"});
return aH
};
var ay=function(aC,aB){["top","left"].forEach(function(aD){aC.style(aD,function(aF,aE){return aB[aE][aD]
})
})
};
var aA=function(aN,aI,aK){if(!at){return
}var aH=aw==null?(av.tickFormat?av.tickFormat.apply(av,ae):String):aw,aM,aF,aJ,aE;
at.style("position","absolute");
aM=at.selectAll(".axis-label").data(aN,String);
aF=aM.enter().append("div").classed("axis-label",true).style("opacity",0.000001).style("position","absolute");
aJ=d3.transition(aM.exit()).style("opacity",0.000001).remove();
aE=d3.transition(aM).style("opacity",1);
aF.append("span");
var aD=aM.selectAll("span"),aQ=function(aT,aS,aR){return aH.call(this,aT,aR)
};
if(ad){aD.html(aQ)
}else{aD.text(aQ)
}var aP=[],aG=[],aB=[],aO=[];
var aL;
if(!av.ticks){var aC=av.rangeBand()/2;
aL=function(aR){return aK(aR)+aC
}
}aF.each(function(aS,aR){aP[aR]=ax(this,aS,aR,aL||aI,al)
});
aE.each(function(aS,aR){aG[aR]=ax(this,aS,aR,aL||aI,al);
aB[aR]=ax(this,aS,aR,aL||aK,al)
});
if(av.ticks){aJ.each(function(aS,aR){aO[aR]=ax(this,aS,aR,aK,al)
})
}ay(aF,aP);
ay(aM,aG);
ay(aE,aB);
if(av.ticks){ay(aJ,aO)
}};
az.each(function(){var aR=d3.select(this);
var aT=ac==null?(av.ticks?av.ticks.apply(av,ae):av.domain()):ac;
var aF=aj(av,aT,ao),aD=aR.selectAll(".minor").data(aF,String),aN=aD.enter().insert("line","g").attr("class","tick minor").style("opacity",0.000001),aM=d3.transition(aD.exit()).style("opacity",0.000001).remove(),aC=d3.transition(aD).style("opacity",1);
var aQ=aR.selectAll(".axis-tick").data(aT,String),aK=aQ.enter().insert("g","path").classed("axis-tick",true).style("opacity",0.000001),aL=d3.transition(aQ.exit()).style("opacity",0.000001).remove(),aG=d3.transition(aQ).style("opacity",1),aB;
var aJ=dv.util.scaleRangeNoReverse(av);
path=aR.selectAll(".domain").data([0]);
pathEnter=path.enter().append("path").attr("class","domain");
pathUpdate=d3.transition(path);
var aO=av.copy(),aP=this.__chart__||aO;
this.__chart__=aO;
aK.append("line").attr("class","tick");
var aE=aK.select("line"),aS=aG.select("line");
switch(al){case"bottom":aB=ah;
aN.attr("y2",function(aV,aU){return aq.call(this,aV,aU,panel)
});
aC.attr("x2",0).attr("y2",function(aV,aU){return aq.call(this,aV,aU,panel)
});
aE.attr("y2",function(aV,aU){return ar.call(this,aV,aU,panel)
});
aS.attr("x2",0).attr("y2",function(aV,aU){return ar.call(this,aV,aU,panel)
});
pathUpdate.attr("d",function(aV,aU){return"M"+aJ[0]+","+ak.call(this,aV,aU,panel)+"V0H"+aJ[1]+"V"+ak.call(this,aV,aU,panel)
});
break;
case"top":aB=ah;
aN.attr("y2",function(aV,aU){return -aq.call(this,aV,aU,panel)
});
aC.attr("x2",0).attr("y2",function(aV,aU){return -aq.call(this,aV,aU,panel)
});
aE.attr("y2",function(aV,aU){return -ar.call(this,aV,aU,panel)
});
aS.attr("x2",0).attr("y2",function(aV,aU){return -ar.call(this,aV,aU,panel)
});
pathUpdate.attr("d",function(aV,aU){return"M"+aJ[0]+","+-ak.call(this,aV,aU,panel)+"V0H"+aJ[1]+"V"+-ak.call(this,aV,aU,panel)
});
break;
case"left":aB=ag;
aN.attr("x2",function(aV,aU){return -aq.call(this,aV,aU,panel)
});
aC.attr("x2",function(aV,aU){return -aq.call(this,aV,aU,panel)
}).attr("y2",0);
aE.attr("x2",function(aV,aU){return -ar.call(this,aV,aU,panel)
});
aS.attr("x2",function(aV,aU){return -ar.call(this,aV,aU,panel)
}).attr("y2",0);
pathUpdate.attr("d",function(aV,aU){return"M"+-ak.call(this,aV,aU,panel)+","+aJ[0]+"H0V"+aJ[1]+"H"+-ak.call(this,aV,aU,panel)
});
break;
case"right":aB=ag;
aN.attr("x2",function(aV,aU){return aq.call(this,aV,aU,panel)
});
aC.attr("x2",function(aV,aU){return aq.call(this,aV,aU,panel)
}).attr("y2",0);
aE.attr("x2",function(aV,aU){return ar.call(this,aV,aU,panel)
});
aS.attr("x2",function(aV,aU){return ar.call(this,aV,aU,panel)
}).attr("y2",0);
pathUpdate.attr("d",function(aV,aU){return"M"+ak.call(this,aV,aU,panel)+","+aJ[0]+"H0V"+aJ[1]+"H"+ak.call(this,aV,aU,panel)
});
break
}if(av.ticks){aK.call(aB,aP);
aG.call(aB,aO);
aL.call(aB,aO);
aN.call(aB,aP);
aC.call(aB,aO);
aM.call(aB,aO)
}else{var aI=aO.rangeBand()/2,aH=function(aU){return aO(aU)+aI
};
aK.call(aB,aH);
aG.call(aB,aH)
}aA(aT,aP,aO)
})
}af._scale=function(ax){if(!arguments.length){return av
}av=ax;
return af
};
af._orient=function(ax){if(!arguments.length){return al
}al=ax;
return af
};
af._ticks=function(){if(!arguments.length){return ae
}ae=arguments;
return af
};
af._tickValues=function(ax){if(!arguments.length){return ac
}ac=ax;
return af
};
af._tickFormat=function(ax){if(!arguments.length){return aw
}aw=ax;
return af
};
af._htmlLabels=function(ax){if(!arguments.length){return ad
}ad=ax;
return af
};
af._tickSize=function(ax,aA,ay){if(!arguments.length){return ar
}var az=arguments.length-1;
ar=d3.functor(ax);
aq=az>1?d3.functor(aA):ar;
ak=az>0?d3.functor(arguments[az]):ar;
return af
};
af._tickDx=function(ax){if(!arguments.length){return an
}an=ax;
return af
};
af._tickDy=function(ax){if(!arguments.length){return am
}am=ax;
return af
};
af._tickAnchor=function(ax){if(!arguments.length){return ai
}ai=ax;
return af
};
af._tickSubdivide=function(ax){if(!arguments.length){return ao
}ao=+ax;
return af
};
af._panel=function(ax){if(!arguments.length){return panel
}panel=ax;
return af
};
af._labelParent=function(ax){if(!arguments.length){return at
}at=ax;
return af
};
return af
};
dv.guide.legends=dv.extend(function(){function ac(){this._legArr=[];
this.__hide=false;
this._ad={left:0,right:0,width:0,height:0}
}ac._render=function(af){this._w=0;
this._h=0;
if(!this.__hide){var ag=af.el.select(".legends"),ae=this;
var ad=ag.selectAll(".legend").data(this._legArr);
ad.exit().transition().duration(af.duration).style("opacity",0).remove();
var ah=ad.enter().append("g").classed("legend",true);
if(dv.ANIMATION){ah.style("opacity",0)
}ad.each(function(ao,an){var ap={},ai=ao.props[0],ak=ae._getScale(af,ao.props[0]),al=ak.domain();
for(var am=0;
am<ao.props.length;
am++){var aj=ao.props[am],aq=ae._getScale(af,ao.props[am]);
if(aq.hasSameDomain(al)){ap[aj]=af.scales[aj]
}else{throw new Error("Can't render single legend from multiple domains")
}}ao.guide._render(d3.select(this),ap,{dims:ae._ad,renderOpts:af});
ae._w+=ao.guide._getUsedWidth();
ae._h+=ao.guide._getUsedHeight();
ae._ad=ao.guide._getAdjustedDimensions(ae._ad)
})
}return this
};
ac._getScale=function(ae,ag){var ad=ae.scales[ag],af;
if(ag===undefined||ad===undefined||ad[0]===undefined){throw new Error("A '"+ag+"'' legend has been called for, but '"+ag+" hasn't been mapped to data.")
}return ad[0]
};
ac._add=function(ad){this._legArr.push(ad);
return this
};
ac._remove=function(ag){for(var ai in ag){var aj=ag[ai];
for(var af=0;
af<this._legArr.length;
af++){var ah=this._legArr[af].props,ad=true;
for(var ae=0;
ae<ah.length;
ae++){if(ah[ae]===aj){ah.splice(ae,1);
ae--
}if(ah.length===0){ad=false
}}if(!ad){this._legArr.splice(af,1);
af--
}}}};
ac._legends=function(ad){if(!arguments.length){return this._legArr
}this._legArr=ad;
return this
};
ac._allowedDimensions=function(ad){if(!arguments.length){return this._ad
}this._ad=ad;
return this
};
ac._getWidth=function(){return this._w
};
ac._getHeight=function(){return this._h
};
ac._hide=function(ad){if(!arguments.length){return this.__hide
}this.__hide=ad;
return this
};
ac._empty=function(){for(var ad=0;
ad<this._legArr.length;
ad++){delete this._legArr[ad]
}this._legArr=[];
return this
};
return ac
});
dv.guide.legend=dv.guide.extend(function(){function ag(){this._overlay=false;
this._orientation="top";
this._vGap=5;
this._hGap=15;
this._defaultPadding=this._padding={top:10,left:10,right:10,bottom:10};
this._swatchWidth=15;
this._swatchHeight=10;
this._innerPadding=5;
this._spanPercent=0.75;
this._lineHeight=0;
this._entriesWidth=[]
}ag._render=function(aj,ar,av){var ak=aj,ao=av.dims,au=this;
this._renderingOptions=av.renderOpts;
this._scales=ar;
this._transformData=[];
this._width=ao.width-this._padding.left-this._padding.right;
this._height=ao.height-this._padding.top-this._padding.bottom;
var ap=this._drawEntries(aj);
this._legendWidths=ad.call(this,ap);
var aq=ae.call(this,Math.min(this._legendWidths.length,Math.floor(this._width/this._swatchWidth)));
var al=af.call(this,aq);
var an=al.offsets;
aq=al.cols;
this._width=this._width-aq.padding+(this._hGap*(aq.data.length-1));
this._height=this._lineHeight+an[an.length-1].y;
ap.each(function(ay,aw){var ax=d3.select(this);
if(dv.ANIMATION){ax=ax.transition().duration(au._renderingOptions.duration).delay(au._renderingOptions.delay).ease(au._renderingOptions.ease)
}ax.attr("transform","translate("+an[aw].x+", "+an[aw].y+")")
});
if(!this._renderingOptions.firstRender){ak=aj.transition().duration(this._renderingOptions.duration).style("opacity",1)
}var am=(this._orientation==="right")?ao.left+ao.width-this._width-this._padding.right:ao.left+this._padding.left;
var at=(this._orientation==="bottom")?ao.top+ao.height-this._height-this._padding.bottom:ao.top+this._padding.top;
ak.attr("transform","translate("+(am)+","+(at)+")");
if(this._renderingOptions.firstRender){ak.transition().duration(this._renderingOptions.duration).style("opacity",1)
}};
ag._drawEntries=function(an){var ak=this,am=[];
this._entryWidths=[];
for(var ao in this._scales){am=this._scales[ao][0].domain();
break
}var aj=an.selectAll(".legend-entry").data(am);
aj.exit().transition().duration(this._renderingOptions.duration).style("opacity",0).remove();
var al=aj.enter().append("g").classed("legend-entry",true);
al.append("path");
al.append("text").classed("legend-entry-label",true);
al.append("text").classed("legend-entry-value",true);
aj.select("path").attr("d",function(aq,ap){return ah.call(ak,aq,ap)
}).call(function(ap){ap.attr("style","");
if(ak._scales.hasOwnProperty("fill")){ap.style("fill",function(ar,aq){return ak._scales.fill[0].mapValue(ar)
})
}if(ak._scales.hasOwnProperty("stroke")){ap.style("stroke",function(ar,aq){return ak._scales.stroke[0].mapValue(ar)
}).style("stroke-width",2)
}if(ak._scales.hasOwnProperty("linetype")){ap.style("stroke-dasharray",function(ar,aq){return dv.util.svg.getDasharray(ak._scales.linetype[0].mapValue(ar))
});
if(!ak._scales.hasOwnProperty("stroke")){ap.style("stroke","#000")
}ap.style("stroke-width",2)
}if(ak._scales.hasOwnProperty("size")){ap.style("stroke-width",function(ar,aq){return ak._scales.size[0].mapValue(ar)
})
}}).each(function(aq,ap){ak._entryWidths[ap]=this.getBBox().width
});
aj.select("text.legend-entry-label").attr("x",this._swatchWidth+this._innerPadding).attr("y",10).text(function(aq,ap){if(dv.util.isUndefined(ak._labels)){return aq
}else{return ak._labels[ap%ak._labels.length]
}}).each(function(aq,ap){ak._entryWidths[ap]+=ak._innerPadding+this.getBBox().width
});
aj.select("text.legend-entry-value").attr("y",10).attr("x",function(aq,ap){return ak._entryWidths[ap]+ak._innerPadding
}).text(function(aq,ap){if(dv.util.isUndefined(ak._values)){return""
}else{return ak._values[ap]
}}).style("fill",function(aq,ap){if(!dv.util.isUndefined(ak._scales.stroke)){return ak._scales.stroke[0].mapValue(aq)
}else{if(!dv.util.isUndefined(ak._scales.fill)){return ak._scales.fill[0].mapValue(aq)
}}return
}).each(function(ar,ap){var aq=this.getBBox().width;
ak._entryWidths[ap]+=aq+((aq>0)?ak._innerPadding:0)
});
return aj
};
function ad(aj){var ak=this;
aj.each(function(am,al){ak._entryWidths[al]=Math.min(ak._entryWidths[al],ak._width);
ak._lineHeight=Math.max(ak._lineHeight,this.getBBox().height)
});
return ak._entryWidths
}function af(aq){var at=0,ar=0,ap,ak=0,al=false,ao=0,aj=0,am=[];
for(var an=0;
an<this._legendWidths.length;
an++){at+=((ar===0)?0:this._hGap)+this._legendWidths[an];
if(ar<aq.data.length&&at<=this._width){if(this._legendWidths[an]<=aq.data[ar]+ak){aj+=((ar===0)?0:this._hGap);
am.push({x:aj,y:ao});
aj+=aq.data[ar]+ak;
ak=0
}else{if((ap=this._legendWidths[an]-aq.data[ar])<=aq.padding){aq.padding-=ap;
aq.data[ar]=this._legendWidths[an];
return af.call(this,aq)
}else{if((ar+1<aq.data.length)&&this._legendWidths[an]>=aq.data[ar]+(aq.data[ar+1]*this._spanPercent)+ak){if(ar+1<=aq.data.length){ak+=((ar===0)?0:this._hGap)+aq.data[ar];
at-=((ar===0)?0:this._hGap)+this._legendWidths[an];
an--
}else{at=at-this._legendWidths[an]+ak+aq.data[ar];
ak=0;
aj+=((ar===0)?0:this._hGap);
am.push({x:aj,y:ao});
aj+=aq.data[ar]+ak;
ar++
}}else{aq=ae.call(this,aq.data.length-1);
return af.call(this,aq)
}}}ar++
}else{if(ar+1===aq.data.length&&aq.data.length>1){aq=ae.call(this,aq.data.length-1);
return af.call(this,aq)
}else{if(ar===aq.data.length){al=true
}ao+=this._lineHeight+this._vGap;
at=aj=0;
ar=0;
ak=0;
an--
}}}if(ar===aq.data.length){al=true
}if(!al){aq=ae.call(this,aq.data.length-1);
return af.call(this,aq)
}return{offsets:am,cols:aq}
}function ae(al){var am={data:[],padding:this._width},ak=0,aj=0;
if(this._isVAligned()){al=Math.ceil(this._legendWidths.length/Math.floor(this._height/(this._lineHeight+this._vGap)))
}for(aj=0;
aj<al;
aj++){ak+=this._legendWidths[aj]+this._hGap
}ak-=this._hGap;
if(ak>this._width&&al>1){return ae.call(this,al-1)
}am.data=this._legendWidths.slice(0,al);
am.padding-=ak;
if(am.padding<0){am.padding=0
}return am
}function ai(aj,am,ak,al){return"M"+aj+","+am+"L"+(aj+ak)+","+am+"L"+(aj+ak)+","+(am+al)+"L"+aj+","+(am+al)+"Z"
}function ac(ak,am,aj,al){var an=((am+al)>>1);
return"M"+ak+","+an+"L"+aj+","+an
}function ah(ak,aj){if(this._scales.hasOwnProperty("fill")){return ai.call(this,0,0,this._swatchWidth,this._swatchHeight)
}else{return ac.call(this,0,0,this._swatchWidth,this._swatchHeight)
}}ag._getAdjustedDimensions=function(al){if(this._overlay){return al
}var aj=this._padding.left+this._width+this._padding.right,ak=this._padding.top+this._height+this._padding.bottom;
if(this._orientation==="left"){al.left+=aj;
al.width-=aj
}else{if(this._orientation==="top"){al.top+=ak;
al.height-=ak
}else{if(this._orientation==="right"){al.width-=aj
}else{if(this._orientation==="bottom"){al.height-=ak
}}}}return al
};
ag._getUsedWidth=function(){if(this._overlay){return 0
}else{return(this._isVAligned()?this._width+this._padding.left+this._padding.right:0)
}};
ag._getUsedHeight=function(){if(this._overlay){return 0
}else{return(this._isVAligned()?0:this._height+this._padding.top+this._padding.bottom)
}};
ag._isVAligned=function(){return(this._orientation==="left"||this._orientation==="right")
};
ag.vGap=function(aj){if(!arguments.length){return this._vGap
}this._vGap=aj;
return this
};
ag.hGap=function(aj){if(!arguments.length){return this._hGap
}this._hGap=aj;
return this
};
ag.padding=function(aj){if(!arguments.length){return this._padding
}this._padding=dv.util.merge(this._defaultPadding,aj);
return this
};
ag.align=function(aj){if(!arguments.length){return this._align
}this._align=aj;
return this
};
ag.labels=function(aj){if(!arguments.length){return this._labels
}this._labels=aj;
return this
};
ag.values=function(aj){if(!arguments.length){return this._values
}this._values=aj;
return this
};
ag.overlay=function(aj){if(!arguments.length){return this._overlay
}this._overlay=aj;
return this
};
return ag
});
dv.guide.custom=dv.guide.extend(function(){function ac(ad){this._render=function(){dv.log.warn({msg:"empty render function on custom guide"});
return this
};
this._getAdjustedDimensions=function(ae){return ae
};
this._getUsedWidth=function(){return 0
};
this._getUsedHeight=function(){return 0
}
}ac.setFunc=function(ae,ad){this[ae]=ad;
return this
};
return ac
});
dv.geom=dv.container.extend(function(){function ac(){this._super();
this._defaultAes={};
this._behaviorsLayer=null;
this._dodgePadding=0;
this._initializeDefaultAes()
}ac._initializeDefaultAes=function(){this._defaultAes.x=1;
this._defaultAes.y=1;
this._defaultAes.shape="circle";
this._defaultAes.linetype="solid"
};
ac._prerender=function(ad){this._trainedScales={};
this._chart=ad;
this.normalizedData(this._normalizeData(this.data()));
this._calculateStats();
this._inheritChartAesthetics(ad)
};
ac._inheritChartAesthetics=function(ad){for(var ag in ad._aes){var af=ad._aes[ag];
if(!this._aes[ag]){this._aes[ag]={}
}for(var ae in af){if(!this._aes[ag][ae]){this._aes[ag][ae]=af[ae]
}}}};
ac._trainScales=function(){};
ac._createDefaultScales=function(){for(var ad in this._defaultAes){if(!this._aes.hasOwnProperty(ad)){this._aes[ad]={};
this._aes[ad][0]=dv.scale.constant().value(this._defaultAes[ad]).property(ad)
}delete this._defaultAes[ad]
}};
ac._render=function(ae){var ad=this;
this._geomGroup=d3.select(ae);
var af=this._geomGroup.selectAll(".series").data(this._nestData);
af.exit().call(ad.exitSeriesGroup,ad);
af.enter().append("g").classed("series",true);
af.call(ad.updateGroups,ad.enterPen,ad.pen,ad.enterPen,ad).call(ad.updateDataPoints,ad.enterPen,ad.pen,ad.enterPen,ad);
ad._renderBehaviors(ad._geomGroup);
ad.unregisterEventMap=null
};
ac._renderBehaviors=function(ae){var ad=this;
if(this._behaviors&&this._behaviors.length){this._behaviorsLayer=ae.select(".behavior-layer");
if(this._behaviorsLayer.empty()){this._behaviorsLayer=ae.append("g").classed("behavior-layer",true)
}else{this._behaviorsLayer.node().parentNode.appendChild(this._behaviorsLayer.node())
}dv.util.each(this._behaviors,function(af){af._geom(ad)._render(ad._behaviorsLayer)
})
}};
ac.updateGroups=function(ag,ah,af,ad,ae){ag.each(function(am,al){var ap=0,ao=0,aq=d3.select(this),aj=aq.attr("transform");
if(ae._chart._coord instanceof dv.coord.polar){var ar=am.values[0],ai=dv.util.scaleRange(ar.panel.xOuterScale()),ak=dv.util.scaleRange(ar.panel.yOuterScale()),au=(ai[0]+ai[1])/2,an=(ak[0]+ak[1])/2,at=ae._chart._coord.flip();
ap=at?an:au;
ao=at?au:an
}if(aj&&dv.ANIMATION){aq=aq.transition().duration(function(aw,av){return ae.duration().call(this,aw,av)
})
}aq.attr("transform","translate("+ap+","+ao+")")
})
};
ac.updateDataPoints=function(ag,ae,ah,al,am){var af=ae.call(am),ai=ah.call(am),aj=al.call(am);
var ad=ag.selectAll("."+am._dataPointStyleClass).data(function(an){return am.getValues(an)
});
ad.exit().transition().delay(function(ap,ao,an){return am.delay().call(this,ap,ao,an)
}).duration(function(ap,ao,an){return am.duration().call(this,ap,ao,an)
}).ease(am.ease()).each(function(){this.__exiting__=true
}).attrTween("d",aj.pathTween).remove();
ad.enter().append("path").each(function(ap,ao,an){am.setPreviousState.call(this,af,aj,ap,ao,an)
}).attr("class",function(ap,ao,an){return"datum-"+ao+" series-"+an
}).call(am.attributes,am).attr("d",af.path);
var ak=ad.call(am.attributes,am).call(am._removeRegisteredEvents,am).call(am._addRegisteredEvents,am).each(function(){this.__exiting__=false
});
if(dv.ANIMATION){ak=ak.transition().delay(function(ap,ao,an){return am.delay().call(this,ap,ao,an)
}).duration(function(ap,ao,an){return am.duration().call(this,ap,ao,an)
}).ease(am.ease()).attrTween("d",ai.pathTween)
}else{ak.each(function(aq,ao,an){var ap=ai.bounds(aq,ao,an);
if(ap){aq.bounds=ap.bounds
}}).attr("d",ai.path)
}ak.call(am.addEachFunction,am)
};
ac.addEachFunction=function(ae,ad){if(ad._each){if(!dv.util.isUndefined(ad._each.start)){if(dv.ANIMATION){ae.each("start",function(ah,ag,af){ad._each.start.call(this,ah,ag,af)
})
}else{ae.each(function(ah,ag,af){ad._each.start.call(this,ah,ag,af)
})
}}if(!dv.util.isUndefined(ad._each.end)){if(dv.ANIMATION){ae.each("end",function(ah,ag,af){ad._each.end.call(this,ah,ag,af)
})
}else{ae.each(function(ah,ag,af){ad._each.end.call(this,ah,ag,af)
})
}}}};
ac.exitSeriesGroup=function(ae,ad){ad.exitSeries(ae,ad.enterPen,ad)
};
ac.setPreviousState=function(ag,ad,ah,ae){var af=ag.bounds(ah,ae);
this.__previousBounds__=af;
this.__exitTransition__=ad
};
ac.pathTween=function(ae,ag,aj,af,ad){var ai,ah=d3.select(ag);
if(ag.__exiting__){ai=ag.__exitTransition__.path(aj,af);
ag.__exiting__=false
}else{ai=ae.getPath(ae.getBounds(aj,af))
}if(ai===null){ah.remove();
return null
}return d3.interpolate(ah.attr("d"),ai)
};
ac._calculateStats=function(){};
ac._handlePositions=function(){if(this.position()!=="stack"&&this.position()!=="fill"&&this.position()!=="dodge"){return
}var ad=this.position(),ah=this._addGroupLayerToNestedData(),ae=this._chart.coord().flip(),ag=function(ak){var aj=af.getExplicitScales(ak)[ak],ai=false;
return function(an,al){for(var am in aj){ai=aj[am]._includeInDomain(an,al);
if(ai){break
}}return ai?an[ak]:0
}
},af=this;
dv.util.each(ah,function(al){var ak=ag("x"),aj=ag("y");
if(ad==="stack"){d3.layout.stack().x(ak).y(aj).values(function(am){return am.values
})(al.values)
}else{if(ad==="fill"){d3.layout.stack().x(ak).y(aj).offset(function(ar){var au=ar.length,am=ar[0].length,an=1/au,ap,ao,at,aq=[];
for(ao=0;
ao<am;
++ao){for(ap=0,at=0;
ap<au;
ap++){at+=ar[ap][ao][1]
}if(at){for(ap=0;
ap<au;
ap++){ar[ap][ao][1]/=at
}}else{for(ap=0;
ap<au;
ap++){ar[ap][ao][1]=0
}}}for(ao=0;
ao<am;
++ao){aq[ao]=0
}return aq
}).values(function(am){return am.values
})(al.values)
}else{if(ad==="dodge"){var ai=al.values.length;
dv.util.each(al.values,function(an,am){dv.util.each(an.values,function(ao){ao.dodge={groupIndex:am,numGroups:ai}
})
})
}}}})
};
ac._addGroupLayerToNestedData=function(){var ae=[],af={},ad={};
dv.util.each(this._nestData,function(aj,ah){var al=/(.*) ~ .*/g.exec(aj.key)[1],ag=/.* ~ (.*)/g.exec(aj.key)[1],ak,ai;
if(!af.hasOwnProperty(al)){ae.push({key:al,values:[]});
af[al]=ae.length-1
}ak=ae[af[al]];
if(!ad.hasOwnProperty(aj.key)){ak.values.push({key:ag,values:[]});
ad[aj.key]=ak.values.length-1
}ai=ak.values[ad[aj.key]];
ai.values=ai.values.concat(aj.values)
});
return ae
};
ac.exit=function(ad){d3.select(ad).selectAll(".series").call(this.exitSeriesGroup,this)
};
ac.exitSeries=function(af,ad,ae){af.selectAll("."+ae._dataPointStyleClass).transition().delay(function(ai,ah,ag){return ae.delay().call(this,ai,ah,ag)
}).duration(function(ai,ah,ag){return ae.duration().call(this,ai,ah,ag)
}).ease(ae.ease()).each(function(){this.__exiting__=true
}).attrTween("d",ad.call(ae).pathTween).remove().each("end",function(aj,ai){var ah=this.parentNode;
if(ah&&ah.childNodes&&!ah.childNodes.length){var ag=ah.parentNode;
if(ag&&ag.childNodes&&ag.childNodes.length<=1){d3.select(ag).remove()
}else{d3.select(ah).remove()
}}})
};
ac.coord=function(){return this.chart().coord()
};
ac._addRegisteredEvents=function(ae,ad){if(!ad){ad=this
}if(!ad._geomGroup){return
}ae=(!ae?ad._geomGroup.selectAll(".series").selectAll("."+this._dataPointStyleClass):ae);
ad=ad||this;
dv.util.each(ad.eventMap,function(ag,af){ae.on(af,function(aj,ai,ah){ad.eventMap[af].callback.call(this,aj,ai,ah,d3.event)
},ag.capture)
});
dv.util.each(ad._chart.eventMap,function(ag,af){ae.on(af+".dvchart",function(ak,ai){var aj=d3.event,ah=ad._chart._interactionGroup.select(".interaction-canvas").node();
if(ad._shouldDispatchChartEvent(aj,ah)){ad._chart.eventMap[af].callback.call(ah,aj)
}},ag.capture)
});
dv.util.each(ad._behaviors,function(af){if(af._addRegisteredEvents){af._addRegisteredEvents()
}})
};
ac._removeRegisteredEvents=function(ae,ad){if(!ad){ad=this
}if(!ad._geomGroup){return
}ae=ae||ad._geomGroup.selectAll("."+this._dataPointStyleClass);
ad=ad||this;
dv.util.each(ad.unregisterEventMap,function(af,ag){ae.on(ag,null,af)
});
dv.util.each(ad._chart.unregisterEventMap,function(af,ag){ae.on(ag+".dvchart",null,af)
});
dv.util.each(ad._behaviors,function(af){if(af._removeRegisteredEvents){af._removeRegisteredEvents()
}})
};
ac._shouldDispatchChartEvent=function(ai,af){var ad=true;
if(ai.type==="mouseout"||ai.type==="mouseover"){var ae=ai.relatedTarget;
if(!ae){ae=(ai.type==="mouseout")?ai.toElement:ai.fromElement
}var ah=d3.select(ae);
if(ah&&!ah.empty()){var ag=ah.attr("class");
ad=!((ah.node()===af)||(ag&&ag.indexOf("-geom")>=0))
}}return ad
};
ac.getExplicitScalesMap=function(){var af=dv.util.clone(this._chart.getExplicitScalesMap());
for(var ah in this._aes){var ad=this._aes[ah],ag=af[ah]||{},ae=dv.util.extend({},ag,ad);
af[ah]=ae
}return af
};
ac.getExplicitScale=function(af,ae){if(af==="group"){return this._getGroup()
}var ad=this._aes[af];
var ag=this.chart()._aes[af];
if(ae!==undefined&&ad&&ad[ae]){return ad[ae]
}if(ae!==undefined&&ag&&ag[ae]){return ag[ae]
}if(ad&&ad[0]!==undefined){return ad[0]
}if(ag&&ag[0]!==undefined){return ag[0]
}return null
};
ac.getExplicitScales=function(ag){if(!dv.util.isArray(ag)){ag=[ag]
}var ad={},af=-1,aj=ag.length;
while(++af<aj){var ai=ag[af],ae=this._aes[ai],ah=this.chart()._aes[ai]||{};
ad[ai]=dv.util.extend({},ah,ae)
}return ad
};
ac.getTrainedScale=function(ae,ad){return this.chart().getTrainedScale(ae,ad)
};
ac.getScale=function(ae,ad){return this.getExplicitScale(ae,ad)
};
ac.getScales=function(ad){return this.getExplicitScales(ad)
};
ac.hasScale=function(ae,ad){if(this.getExplicitScale(ae,ad)){return true
}return false
};
ac._dodgeAdjust=function(ai){var ad=ai.dodge.groupIndex,ag=ai.dodge.numGroups,ae=ai.panel.xScale(ai).rangeBand(),af=(ag>1)?ae/(ag-1)*this._dodgePadding:0,ah=(ae-(af*(ag-1)))/ag;
return(ah+af)*ad+(ah/2)
};
ac.applyAttributeValue=function(af,ae,ad,ah){var ag=ae.getScale(ah,0);
af.style(ad,function(ak,aj,ai){return ag?ag.mapToProp(dv.util.isArray(ak)?ak[0]:ak,aj,ai):null
})
};
ac._getGroup=function(){if(this._aes.hasOwnProperty("group")){return this._aes.group[0]
}var ag=this.chart()._getGroup();
if(ag&&ag.property()==="group"){return ag
}var ae=-1,ad=dv.DEFAULT_CATEGORICAL_AES.length-1;
while(ae++<ad){var af=this._aes[dv.DEFAULT_CATEGORICAL_AES[ae]];
if(af&&af[0]&&af[0] instanceof dv.scale.ordinal&&!dv.util.isUndefined(af[0].mapping())){return af[0]
}}return ag
};
ac.each=function(ae,ad){var af,ag;
if(!arguments.length){return this._each
}this._each=this._each||{};
if(arguments.length<2){ag=ae;
af="end"
}else{ag=ad;
af=ae
}this._each[af]=ag;
return this
};
ac.dodgePadding=function(ad){if(!arguments){return this._dodgePadding
}this._dodgePadding=ad;
return this
};
ac.behaviors=function(ad){if(!arguments.length){return this._behaviors
}this._behaviors=ad;
return this
};
ac.stat=function(ad){if(!arguments.length){return this._stat
}this._stat=ad;
return this
};
ac.chart=function(ad){if(!arguments.length){return this._chart
}this._chart=ad;
return this
};
ac.normalizedData=function(ad){if(!arguments.length){return this._normalizedData
}this._normalizedData=ad;
return this
};
ac.data=function(ad){if(!arguments.length){return this._data?this._data:this.chart().data()
}this._data=ad;
return this
};
return ac
});
dv.geom.point=dv.geom.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.point
}ac._dataPointStyleClass="point-geom";
ac._initializeDefaultAes=function(){this._super();
this._defaultAes.shape="circle";
this._defaultAes.size=7
};
ac.getValues=function(ad){return ad.values
};
ac.exitSeriesGroup=function(ae,ad){ad.exitSeries(ae,ad.enterPen,ad)
};
ac.attributes=function(ae,ad){ae.attr("style","").classed(ad._dataPointStyleClass,true).call(ad.applyAttributeValue,ad,"opacity","alpha").call(ad.applyAttributeValue,ad,"stroke","stroke").call(ad.applyAttributeValue,ad,"fill","fill")
};
ac.getHighlightColor=function(ag,ae){var af=this.getScale("fill"),ad=this.getScale("stroke");
if(ad&&!(ad instanceof dv.scale.constant)){return ad.mapToProp(ag,ae)
}if(af&&!(af instanceof dv.scale.constant)){return af.mapToProp(ag,ae)
}return ad?ad.mapToProp(ag,ae):"#8CC350"
};
ac.enterPen=function(){var ae=this,ad,af=function(ah,ag){return ah.panel.yScale(ah).reverse()?1:0
};
if(this.position()==="dodge"){ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ae._dodgeAdjust(ai),ah)
}
}else{ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ag.rangeBand()/2,ah)
}
}return this._decoratePen(ad,af)
};
ac.pen=function(){var ae=this,ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ag.rangeBand()/2,ah)
},af;
switch(this.position()){case"identity":af=function(ah,ag){var ai=ah.panel.yScale(ah);
return ai.mapValueToPercent(ai.mapToProp(ah,ag)+ai.rangeBand()/2,ag)
};
break;
case"stack":af=function(ah,ag){var ai=ah.panel.yScale(ah);
return ai.mapValueToPercent(ai.mapValue(ah.y0+ah.y),ag)
};
break;
case"dodge":ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ae._dodgeAdjust(ai),ah)
};
af=function(ah,ag){var ai=ah.panel.yScale(ah);
return ai.mapValueToPercent(ai.mapToProp(ah,ag)+ai.rangeBand()/2,ag)
};
break;
case"fill":af=function(ah,ag){return(ah.y+ah.y0)
};
break
}return this._decoratePen(ad,af)
};
ac._defined=function(ae,ad){return dv.util.isFinite(ae.panel.xScale(ae).mapToProp(ae,ad))&&dv.util.isFinite(ae.panel.yScale(ae).mapToProp(ae,ad))
};
ac._decoratePen=function(ae,ai){var ah=this.getScale("shape"),ad=this.getScale("size"),af=this;
var ag=this.coord()._point().x(ae).y(ai).defined(this._defined);
ag.renderer.type(function(ak,aj){return ah.mapToProp(ak,aj)
}).size(function(ak,aj){return Math.pow(ad.mapToProp(ak,aj),2)
});
return{bounds:function(ak,aj){return ag.getBounds(ak,aj)
},pathTween:function(ak,aj){return af.pathTween(ag,this,ak,aj)
},path:function(ak,aj){return ag.getPath(ag.getBounds(ak,aj))
}}
};
return ac
});
dv.geom.text=dv.geom.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.text;
this._dx=d3.functor(0);
this._dy=d3.functor(0);
this._textFormat=function(ad){return ad
};
this._textAnchor="start"
}ac._dataPointStyleClass="text-geom";
ac.dx=function(ad){if(!arguments.length){return this._dx
}this._dx=d3.functor(ad);
return this
};
ac.dy=function(ad){if(!arguments.length){return this._dy
}this._dy=d3.functor(ad);
return this
};
ac.textAnchor=function(ad){if(!arguments.length){return this._textAnchor
}this._textAnchor=ad;
return this
};
ac.textFormat=function(ad){if(!arguments.length){return this._textFormat
}this._textFormat=d3.functor(ad);
return this
};
ac.getValues=function(ad){return ad.values
};
ac.updateDataPoints=function(ag,ae,ah,al,an){var am=an.getScale("alpha"),af=ae.call(an),ai=ah.call(an),aj=al.call(an);
var ad=ag.selectAll("."+an._dataPointStyleClass).data(function(ao){return an.getValues(ao)
});
ad.exit().transition().delay(function(aq,ap,ao){return an.delay().call(this,aq,ap,ao)
}).duration(function(aq,ap,ao){return an.duration().call(this,aq,ap,ao)
}).ease(an.ease()).call(aj).each("end.transition",function(aq,ap){var ao=this.parentNode;
if(ao){ao.removeChild(this)
}});
ad.enter().append("text").attr("class",function(aq,ap,ao){return"datum-"+ap+" series-"+ao
}).call(an.attributes,an).call(af);
var ak=ad.call(an.attributes,an).call(an._removeRegisteredEvents,an).call(an._addRegisteredEvents,an);
if(dv.ANIMATION){ak=ak.transition().delay(function(aq,ap,ao){return an.delay().call(this,aq,ap,ao)
}).duration(function(aq,ap,ao){return an.duration().call(this,aq,ap,ao)
}).ease(an.ease())
}ak.call(ai).call(an.addEachFunction,an)
};
ac.exitSeriesGroup=function(ae,ad){ad.exitSeries(ae,ad.enterPen,ad)
};
ac.exitSeries=function(af,ad,ae){af.selectAll("."+ae._dataPointStyleClass).transition().delay(function(ai,ah,ag){return ae.delay().call(this,ai,ah,ag)
}).duration(function(ai,ah,ag){return ae.duration().call(this,ai,ah,ag)
}).ease(ae.ease()).call(ad.call(ae)).remove().each("end.transition",function(ai,ah){var ag=this.parentNode;
if(ag.parentNode){ag.removeChild(this)
}if(ag&&ag.childNodes&&!ag.childNodes.length){d3.select(ag).remove()
}})
};
ac.attributes=function(ae,ad){ae.attr("style","").classed(ad._dataPointStyleClass,true).call(ad.applyAttributeValue,ad,"stroke","stroke").call(ad.applyAttributeValue,ad,"fill","fill").call(ad.applyAttributeValue,ad,"opacity","alpha").call(ad.applyAttributeValue,ad,"font-size","size").attr("text-anchor",ad._textAnchor)
};
ac.enterPen=function(){var af=this,ae=this._dx,ag=function(ai,ah){return ai.panel.yScale(ai).reverse()?1:0
},ad;
if(this.position()==="dodge"){ad=function(ak,aj,ai){var ah=ak.panel.xScale(ak);
return ah.mapValueToPercent(ah.mapToProp(ak,aj)+af._dodgeAdjust(ak)+ae(ak,aj,ai),aj)
}
}else{ad=function(ak,aj,ai){var ah=ak.panel.xScale(ak);
return ah.mapValueToPercent(ah.mapToProp(ak,aj)+ah.rangeBand()/2+ae(ak,aj,ai),aj)
}
}return this._decoratePen(ad,ag)
};
ac.pen=function(){var ag=this,af=this._dx,ae=this._dy,ad=function(al,ak,aj){var ai=al.panel.xScale(al);
return ai.mapValueToPercent(ai.mapToProp(al,ak)+ai.rangeBand()/2+af(al,ak,aj),ak)
},ah;
switch(this.position()){case"identity":ah=function(ak,aj,ai){var al=ak.panel.yScale(ak);
return al.mapValueToPercent(al.mapToProp(ak,aj)+ae(ak,aj,ai)+al.rangeBand()/2,aj)
};
break;
case"stack":ah=function(ak,aj,ai){var al=ak.panel.yScale(ak);
return al.mapValueToPercent(al.mapValue(ak.y0+ak.y,aj)+ae(ak,aj,ai),aj)
};
break;
case"dodge":ad=function(al,ak,aj){var ai=al.panel.xScale(al);
return ai.mapValueToPercent(ai.mapToProp(al,ak)+ag._dodgeAdjust(al)+af(al,ak,aj),ak)
};
ah=function(ak,aj,ai){var al=ak.panel.yScale(ak);
return al.mapValueToPercent(al.mapToProp(ak,aj)+ae(ak,aj,ai)+al.rangeBand()/2,aj)
};
break;
case"fill":ah=function(ak,aj,ai){var al=ak.panel.yScale(ak);
return(ak.y+ak.y0)+al.mapValueToPercent(ae(ak,aj,ai)+dv.util.scaleRange(al)[0],aj)
};
break
}return this._decoratePen(ad,ah)
};
ac._defined=function(ae,ad){return dv.util.isFinite(ae.panel.xScale(ae).mapToProp(ae,ad))&&dv.util.isFinite(ae.panel.yScale(ae).mapToProp(ae,ad))
};
ac._decoratePen=function(ad,ah){var af=this.getScale("label"),ae=this;
var ag=this.coord()._text().x(ad).y(ah);
return ag().label(function(ak,aj,ai){return ae._textFormat.call(this,af.mapToProp(ak,aj),aj,ai)
}).defined(this._defined)
};
return ac
});
dv.geom.line=dv.geom.extend(function(){function ac(){this._super();
this._tension=0.7;
this._interpolate="linear";
this._rendererClass=dv.geom.line
}ac._dataPointStyleClass="line-geom";
ac.tension=function(ad){if(!arguments.length){return this._tension
}this._tension=ad;
return this
};
ac.interpolate=function(ad){if(!arguments.length){return this._interpolate
}this._interpolate=ad;
return this
};
ac._render=function(ae){this._super(ae);
var ad=this.getScale("size");
if(ad&&ad.to&&!ad.to()){ad.to([2,8])
}};
ac.getValues=function(ad){return[ad.values]
};
ac.exitSeriesGroup=function(ae,ad){ad.exitSeries(ae,ad.enterPen,ad)
};
ac.attributes=function(ae,ad){var af=ad.getScale("linetype",0);
ae.attr("style","").classed(ad._dataPointStyleClass,true).call(ad.applyAttributeValue,ad,"stroke","stroke").call(ad.applyAttributeValue,ad,"opacity","alpha").call(ad.applyAttributeValue,ad,"stroke-width","size").style("stroke-dasharray",function(ai,ah,ag){return af?dv.util.svg.getDasharray(af.mapToProp(ai[0],ah,ag)):null
}).style("fill","none")
};
ac.getHighlightColor=function(af,ae){var ad=this.getScale("stroke",0);
return ad?ad.mapToProp(af,ae):"#8CC350"
};
ac.enterPen=function(){var ae=this,ad,af=function(ah,ag){return ah.panel.yScale(ah).reverse()?1:0
};
if(this.position()==="dodge"){ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ae._dodgeAdjust(ai),ah)
}
}else{ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ag.rangeBand()/2,ah)
}
}return this._decoratePen(ad,af)
};
ac.pen=function(){var ae=this,ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ag.rangeBand()/2,ah)
},af;
switch(this.position()){case"identity":af=function(ah,ag){var ai=ah.panel.yScale(ah);
return ai.mapValueToPercent(ai.mapToProp(ah,ag)+ai.rangeBand()/2,ag)
};
break;
case"stack":af=function(ah,ag){var ai=ah.panel.yScale(ah);
return ai.mapValueToPercent(ai.mapValue(ah.y0+ah.y),ag)
};
break;
case"dodge":ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ae._dodgeAdjust(ai),ah)
};
af=function(ah,ag){var ai=ah.panel.yScale(ah);
return ai.mapValueToPercent(ai.mapToProp(ah,ag)+ai.rangeBand()/2,ag)
};
break;
case"fill":af=function(ah,ag){return(ah.y+ah.y0)
};
break
}return this._decoratePen(ad,af)
};
ac._defined=function(ae,ad){return dv.util.isFinite(ae.panel.xScale(ae).mapToProp(ae,ad))&&dv.util.isFinite(ae.panel.yScale(ae).mapToProp(ae,ad))
};
ac._decoratePen=function(ad,ag){var ae=this;
var af=this.coord()._line().x(ad).y(ag).defined(this._defined);
af.renderer.tension(this.tension()).interpolate(this.interpolate());
return{bounds:function(ai,ah){return af.getBounds(ai,ah)
},pathTween:function(ai,ah){return ae.pathTween(af,this,ai,ah)
},path:function(ai,ah){return af.getPath(af.getBounds(ai,ah))
}}
};
return ac
});
dv.geom.area=dv.geom.extend(function(){function ac(){this._super();
this._tension=0.7;
this._interpolate="linear";
this._rendererClass=dv.geom.area;
this._baseline=0
}ac._dataPointStyleClass="area-geom";
ac._initializeDefaultAes=function(){this._super()
};
ac._trainScales=function(){if(this._baseline!==undefined){var ad=this.getExplicitScales("y")["y"];
for(var af in ad){var ae=ad[af];
if(ae instanceof dv.scale.continuous){ae.softLowerLimit(this._baseline)
}}}this._super()
};
ac.tension=function(ad){if(!arguments.length){return this._tension
}this._tension=ad;
return this
};
ac.interpolate=function(ad){if(!arguments.length){return this._interpolate
}this._interpolate=ad;
return this
};
ac.getValues=function(ad){return[ad.values]
};
ac.pathTween=function(ar,ap,am,ah,af){var ag=am,ae,aq=ap.__previousBounds__,ao=[],aj,ad=this.enterPen.call(this,af),al,ai,ak=this.getScale("x").domain(),an=-1;
ae=ar.getBounds(am,ah);
ae.coord=this.coord();
if(aq&&aq.coord&&(ae.coord._type!==aq.coord._type)||ae.coord.flip()!=aq.coord.flip()){aq=this.enterPen.call(this,af).bounds(am,ah)
}aj=Math.max(ae.length,aq.length);
while(++an<aj){al=(an<ae.length)?ae[an]:null;
ai=(an<aq.length)?aq[an]:null;
if(!ai){al.x=ak[ak.length-1];
ai=ad.bounds([al],ah)[0]
}else{if(!al){al=ad.bounds([ai],ah)[0]
}}ao.push(d3.interpolateObject(ai.bounds,al.bounds))
}ap.__previousBounds__=ae;
return function(at){if(at===1){ao=ao.splice(0,ae.length)
}var au=[];
dv.util.each(ao,function(av,ax){var aw={};
aw.bounds=av(at);
au.push(aw)
});
return ar.getPath(au)
}
};
ac.exitSeriesGroup=function(ae,ad){ad.exitSeries(ae,ad.enterPen,ad)
};
ac.attributes=function(ae,ad){ae.attr("style","").classed(ad._dataPointStyleClass,true).call(ad.applyAttributeValue,ad,"opacity","alpha").call(ad.applyAttributeValue,ad,"fill","fill")
};
ac.getHighlightColor=function(af,ad){var ae=this.getScale("fill");
return ae?ae.mapToProp(af,ad):"#8CC350"
};
ac.getBaseline=function(ae){var ad=d3.min(ae.domain());
if(self._baseline!==undefined){return self._baseline
}return ad<0?0:ad
};
ac.enterPen=function(){var ae=this,ad,af=function(ah,ag){var ai=ah.panel.yScale(ah);
return ai.mapValueToPercent(ai.mapValue(ae.getBaseline(ai)),ag)
};
if(this.position()==="dodge"){ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ae._dodgeAdjust(ai),ah)
}
}else{ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ag.rangeBand()/2,ah)
}
}return this._decoratePen(ad,af,af)
};
ac.pen=function(){var ad=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapToProp(aj,ai)+ah.rangeBand()/2,ai)
},ag,af,ae=this;
switch(this.position()){case"identity":ag=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapValueToPercent(aj.mapValue(ae.getBaseline(aj)),ah)
};
af=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapPropToPercent(ai,ah)
};
break;
case"stack":ag=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapValueToPercent(aj.mapValue(ai.y0),ah)
};
af=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapValueToPercent(aj.mapValue(ai.y0+ai.y),ah)
};
break;
case"dodge":ad=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapToProp(aj,ai)+ae._dodgeAdjust(aj),ai)
};
ag=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapValueToPercent(aj.mapValue(ae.getBaseline(aj)),ah)
};
af=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapPropToPercent(ai,ah)
};
break;
case"fill":ag=function(ai,ah){return ai.y0
};
af=function(ai,ah){return(ai.y+ai.y0)
};
break
}return this._decoratePen(ad,ag,af)
};
ac._defined=function(ae,ad){return dv.util.isFinite(ae.panel.xScale(ae).mapToProp(ae,ad))&&dv.util.isFinite(ae.panel.yScale(ae).mapToProp(ae))
};
ac._decoratePen=function(ad,ah,ag){var ae=this;
var af=this.coord()._area().x(ad).y0(ah).y1(ag).defined(this._defined);
af.renderer.tension(this.tension()).interpolate(this.interpolate());
return{bounds:function(ak,ai){var aj=af.getBounds(ak,ai);
if(aj){aj.coord=ae.coord()
}return aj
},pathTween:function(aj,ai){return ae.pathTween(af,this,aj,ai)
},path:function(aj,ai){return af.getPath(af.getBounds(aj,ai))
}}
};
ac.baseline=function(ad){if(!arguments.length){return this._baseline
}this._baseline=ad;
return this
};
return ac
});
dv.geom.rect=dv.geom.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.rect
}ac._dataPointStyleClass="bar-geom";
ac._initializeDefaultAes=function(){this._super();
this._defaultAes.yMin=1;
this._defaultAes.yMax=1;
this._defaultAes.xMin=1;
this._defaultAes.xMax=1;
delete this._defaultAes.x;
delete this._defaultAes.y
};
ac._trainScales=function(){var ae=this.getExplicitScales(["yMin","xMin"]),ag=ae.yMin,ai=ae.xMin,ah;
for(ah in ag){var af=this._aes.y;
if(!af){this._aes.y=af={}
}if(!af[ah]){af[ah]=ag[ah].copy().property("y").mapping("y")
}af[ah].trainingProperties(["yMin","yMax"])
}for(ah in ai){var ad=this._aes.x;
if(!ad){this._aes.x=ad={}
}if(!ad[ah]){ad[ah]=ai[ah].copy().property("x").mapping("x")
}ad[ah].trainingProperties(["xMin","xMax"])
}};
ac.getValues=function(ad){return ad.values
};
ac._render=function(ai){var aj=this.getExplicitScales(["yMin","yMax","y","xMin","xMax","x"]),ag;
for(ag in aj.yMin){var af=aj.yMin[ag],ad=aj.yMax[ag],ae=aj.y[ag];
if(ae){ad.range(ae.range()).domain(ae.domain());
af.range(ae.range()).domain(ae.domain())
}}for(ag in aj.xMin){var al=aj.xMin[ag],ah=aj.xMax[ag],ak=aj.x[ag];
if(ak){ah.range(ak.range()).domain(ak.domain());
al.range(ak.range()).domain(ak.domain())
}}this._super(ai)
};
ac.pathTween=function(am,ak,aj,ag,ae){var af=aj,ad,al=ak.__previousBounds__,ai=this.coord()._type;
if(ak.__exiting__){ad=ak.__exitTransition__.bounds(aj,ag)
}else{ad=am.getBounds(aj,ag)
}if((al&&al.coord&&ai!==al.coord)){al=ak.__exitTransition__.bounds(aj,ag)
}if(!ad||!al){return null
}ad.coord=ai;
var ah=d3.interpolateObject(al.bounds,ad.bounds);
ak.__previousBounds__=ad;
return function(an){af.bounds=ah(an);
return am.getPath(af)
}
};
ac.attributes=function(ae,ad){ae.attr("style","").classed(ad._dataPointStyleClass,true).call(ad.applyAttributeValue,ad,"fill","fill").call(ad.applyAttributeValue,ad,"stroke","stroke").call(ad.applyAttributeValue,ad,"opacity","alpha")
};
ac.enterPen=function(){var af=function(ah,ag){return ah.panel.yScale(ah).reverse()?1:0
},ae=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapValue(dv.util.isArray(ai.x)?ai.x[0]:ai.xMin,ah))
},ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapValue(dv.util.isArray(ai.x)?ai.x[1]:ai.xMax,ah))
};
return this._decoratePen(ae,ad,af,af)
};
ac.pen=function(){var ae=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapValue(dv.util.isArray(aj.x)?aj.x[0]:aj.xMin,ai))
},ad=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapValue(dv.util.isArray(aj.x)?aj.x[1]:aj.xMax,ai))
},ag=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapValueToPercent(aj.mapValue(dv.util.isArray(ai.y)?ai.y[0]:ai.yMin,ah))
},af=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapValueToPercent(aj.mapValue(dv.util.isArray(ai.y)?ai.y[1]:ai.yMax,ah))
};
return this._decoratePen(ae,ad,ag,af)
};
ac._defined=function(af,ae){var ad=af.panel.xScale(af),ag=af.panel.yScale(af);
return dv.util.isFinite(ad.mapValue(dv.util.isArray(af.x)?af.x[0]:af.xMin,ae))&&dv.util.isFinite(ad.mapValue(dv.util.isArray(af.x)?af.x[1]:af.xMax,ae))&&dv.util.isFinite(ag.mapValue(dv.util.isArray(af.y)?af.y[0]:af.yMin,ae))&&dv.util.isFinite(ag.mapValue(dv.util.isArray(af.y)?af.y[1]:af.yMax,ae))
};
ac._decoratePen=function(ag,af,ai,ah){var ad=this;
var ae=this.coord()._rect().x0(ag).x1(af).y0(ai).y1(ah).defined(this._defined);
return{bounds:function(al,aj){var ak=ae.getBounds(al,aj);
if(ak){ak.bounds.coord=ad.coord()._type
}return ak
},pathTween:function(al,ak,aj){return ad.pathTween(ae,this,al,ak,aj)
},path:function(ak,aj){return ae.getPath(ae.getBounds(ak,aj))
}}
};
return ac
});
dv.geom.tile=dv.geom.rect.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.tile
}ac._dataPointStyleClass="tile-geom";
ac._initializeDefaultAes=function(){this._super();
this._defaultAes.y=1;
this._defaultAes.x=1
};
ac.getValues=function(ad){return ad.values
};
ac.enterPen=function(){var af=function(ah,ag){return ah.panel.yScale(ah).reverse()?1:0
},ae=function(ah,ag){return ah.panel.xScale(ah).mapPropToPercent(ah,ag)
},ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ag.rangeBand(),ah)
};
return this._decoratePen(ae,ad,af,af)
};
ac.pen=function(){var ae=function(ai,ah){return ai.panel.xScale(ai).mapPropToPercent(ai,ah)
},ad=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapToProp(aj,ai)+ah.rangeBand(),ai)
},ag=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapPropToPercent(ai,ah)
},af=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapValueToPercent(aj.mapToProp(ai,ah)+aj.rangeBand(),ah)
};
return this._decoratePen(ae,ad,ag,af)
};
ac._defined=function(ae,ad){return dv.util.isFinite(ae.panel.xScale(ae).mapToProp(ae,ad))&&dv.util.isFinite(ae.panel.yScale(ae).mapToProp(ae,ad))
};
ac._decoratePen=function(ag,af,ai,ah){var ad=this;
var ae=this.coord()._rect().x0(ag).x1(af).y0(ai).y1(ah).defined(this._defined);
return{bounds:function(al,aj){var ak=ae.getBounds(al,aj);
if(ak){ak.bounds.coord=ad.coord()._type
}return ak
},pathTween:function(al,ak,aj){return ad.pathTween(ae,this,al,ak,aj)
},path:function(ak,aj){return ae.getPath(ae.getBounds(ak,aj))
}}
};
return ac
});
dv.geom.bar=dv.geom.rect.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.bar;
this._baseline=0
}ac._dataPointStyleClass="bar-geom";
ac._initializeDefaultAes=function(){this._super();
this._defaultAes.y=1;
this._defaultAes.x=1
};
ac._trainScales=function(){if(this._baseline!==undefined){var ad=this.getExplicitScales("y")["y"];
for(var af in ad){var ae=ad[af];
if(ae instanceof dv.scale.continuous){ae.softLowerLimit(this._baseline)
}}}};
ac.getValues=function(ad){return ad.values
};
ac.getBaseline=function(ae){var ad=d3.min(ae.domain());
if(self._baseline!==undefined){return self._baseline
}return ad<0?0:ad
};
ac._enforceMinSize=function(ah,al,aj){var ak=this.getBaseline(ah),ag=al[ah.property()]-ak,af=ah.mapValueToPercent(ah.mapValue(ak)),ai=ah.mapPropToPercent(al,aj)-af,ad=dv.util.scaleExtent(ah.range()),ae=1/(ad[1]-ad[0]);
if(ah.reverse()){return af+(ag<0?Math.max(ae,ai):Math.min(-ae,ai))
}else{return af+(ag<0?Math.min(-ae,ai):Math.max(ae,ai))
}};
ac.enterPen=function(){var ad=this,ag=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapValueToPercent(aj.mapValue(ad.getBaseline(aj)),ah)
},af,ae;
if(this.position()==="dodge"){af=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapToProp(aj,ai)+ad._dodgeAdjust(aj),ai)
};
ae=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapToProp(aj,ai)+ad._dodgeAdjust(aj,true),ai)
}
}else{af=function(ai,ah){return ai.panel.xScale(ai).mapPropToPercent(ai,ah)
};
ae=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapToProp(aj,ai)+ah.rangeBand(),ai)
}
}return this._decoratePen(af,ae,ag,ag)
};
ac.pen=function(){var af,ae,ah,ag,ad=this;
switch(this.position()){case"identity":af=function(aj,ai){return aj.panel.xScale(aj).mapPropToPercent(aj,ai)
};
ae=function(ak,aj){var ai=ak.panel.xScale(ak);
return ai.mapValueToPercent(ai.mapToProp(ak,aj)+ai.rangeBand(),aj)
};
ah=function(aj,ai){var ak=aj.panel.yScale(aj);
return ak.mapValueToPercent(ak.mapValue(ad.getBaseline(ak)),ai)
};
ag=function(aj,ai){return ad._enforceMinSize(aj.panel.yScale(aj),aj,ai)
};
break;
case"stack":af=function(aj,ai){return aj.panel.xScale(aj).mapPropToPercent(aj,ai)
};
ae=function(ak,aj){var ai=ak.panel.xScale(ak);
return ai.mapValueToPercent(ai.mapToProp(ak,aj)+ai.rangeBand(),aj)
};
ah=function(aj,ai){var ak=aj.panel.yScale(aj);
return ak.mapValueToPercent(ak.mapValue(aj.y0),ai)
};
ag=function(aj,ai){var ak=aj.panel.yScale(aj);
return ak.mapValueToPercent(ak.mapValue(aj.y0+aj.y),ai)
};
break;
case"dodge":af=function(ak,aj){var ai=ak.panel.xScale(ak);
return ai.mapValueToPercent(ai.mapToProp(ak,aj)+ad._dodgeAdjust(ak),aj)
};
ae=function(ak,aj){var ai=ak.panel.xScale(ak);
return ai.mapValueToPercent(ai.mapToProp(ak,aj)+ad._dodgeAdjust(ak,true),aj)
};
ah=function(aj,ai){var ak=aj.panel.yScale(aj);
return ak.mapValueToPercent(ak.mapValue(ad.getBaseline(ak)),ai)
};
ag=function(aj,ai){return ad._enforceMinSize(aj.panel.yScale(aj),aj,ai)
};
break;
case"fill":af=function(aj,ai){return aj.panel.xScale(aj).mapPropToPercent(aj,ai)
};
ae=function(ak,aj){var ai=ak.panel.xScale(ak);
return ai.mapValueToPercent(ai.mapToProp(ak,aj)+ai.rangeBand(),aj)
};
ah=function(aj,ai){return aj.y0
};
ag=function(aj,ai){return(aj.y+aj.y0)
};
break
}return this._decoratePen(af,ae,ah,ag)
};
ac._defined=function(ae,ad){return dv.util.isFinite(ae.panel.xScale(ae).mapToProp(ae,ad))&&dv.util.isFinite(ae.panel.yScale(ae).mapToProp(ae,ad))
};
ac._decoratePen=function(ag,af,ai,ah){var ad=this;
var ae=this.coord()._rect().x0(ag).x1(af).y0(ai).y1(ah).defined(this._defined);
return{bounds:function(al,aj){var ak=ae.getBounds(al,aj);
if(ak){ak.bounds.coord=ad.coord()._type
}return ak
},pathTween:function(al,ak,aj){return ad.pathTween(ae,this,al,ak,aj)
},path:function(ak,aj){return ae.getPath(ae.getBounds(ak,aj))
}}
};
ac._dodgeAdjust=function(aj,ai){var ad=aj.dodge.groupIndex,ag=aj.dodge.numGroups,ae=aj.panel.xScale(aj).rangeBand(),af=(ag>1)?ae/(ag-1)*this._dodgePadding:0,ah=(ae-(af*(ag-1)))/ag;
return(ah+af)*ad+(ai?ah:0)
};
ac.baseline=function(ad){if(!arguments.length){return this._baseline
}this._baseline=ad;
return this
};
return ac
});
dv.geom.barrange=dv.geom.bar.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.barrange
}ac._initializeDefaultAes=function(){this._super();
this._defaultAes.yMin=1;
this._defaultAes.yMax=1;
delete this._defaultAes.y
};
ac._trainScales=function(){var ad=this.getExplicitScales("yMin")["yMin"],ag,af;
for(var ae in ad){if(!this._aes.y){this._aes.y={}
}ag=this._aes.y;
af=ag[ae];
if(!af){ag[ae]=af=ad[ae].copy().property("y").mapping("y")
}af.trainingProperties(["yMin","yMax"])
}};
ac._render=function(ae){var ad=this.getExplicitScales(["yMin","yMax","y"]),ah=ad.yMin;
for(var aj in ah){var af=ah[aj],ag=ad.yMax[aj],ai=ad.y[aj];
ag.range(ai.range()).domain(ai.domain());
af.range(ai.range()).domain(ai.domain())
}this._super(ae)
};
ac.enterPen=function(){var af=function(ah,ag){return ah.panel.yScale(ah).reverse()?1:0
},ae=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapPropToPercent(ai,ah)
},ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ag.rangeBand(),ah)
};
return this._decoratePen(ae,ad,af,af)
};
ac.pen=function(){var ae=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapPropToPercent(aj,ai)
},ad=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapToProp(aj,ai)+ah.rangeBand(),ai)
},ag=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapValueToPercent(aj.mapValue(ai.yMin,ah),ah)
},af=function(ai,ah){var aj=ai.panel.yScale(ai);
return aj.mapValueToPercent(aj.mapValue(ai.yMax,ah),ah)
};
return this._decoratePen(ae,ad,ag,af)
};
ac._defined=function(af,ae){var ad=af.panel.xScale(af),ag=af.panel.yScale(af);
return dv.util.isFinite(ad.mapToProp(af,ae))&&dv.util.isFinite(ag.mapValue(af.yMin,ae))&&dv.util.isFinite(ag.mapValue(af.yMax,ae))
};
ac._decoratePen=function(ag,af,ai,ah){var ad=this;
var ae=this.coord()._rect().x0(ag).x1(af).y0(ai).y1(ah).defined(this._defined);
return{bounds:function(al,aj){var ak=ae.getBounds(al,aj);
if(ak){ak.bounds.coord=ad.coord()._type
}return ak
},pathTween:function(al,ak,aj){return ad.pathTween(ae,this,al,ak,aj)
},path:function(ak,aj){return ae.getPath(ae.getBounds(ak,aj))
}}
};
return ac
});
dv.geom.segment=dv.geom.line.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.segment
}ac.getValues=function(ad){return ad.values
};
ac.enterPen=function(){var ad=function(ah,ag){var af=ah.panel.xScale(ah);
return af.mapValueToPercent(af.mapToProp(ah,ag)+af.rangeBand()/2,ag)
},ae=function(ag,af){return ag.panel.yScale(ag).reverse()?1:0
};
return this._decoratePen(ad,ae)
};
ac.pen=function(){var ad=function(ah,ag){var af=ah.panel.xScale(ah);
return af.mapValueToPercent(af.mapToProp(ah,ag)+af.rangeBand()/2,ag)
},ae=function(ag,af){return ag.panel.yScale(ag).mapPropToPercent(ag,af)
};
return this._decoratePen(ad,ae)
};
return ac
});
dv.geom.vline=dv.geom.segment.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.vline
}ac._dataPointStyleClass="vline-geom";
ac._render=function(ae){var ad=this;
dv.util.each(this._nestData,function(ah,ag){var af=[];
dv.util.each(ah.values,function(ao,ak){var an=ao.panel.xScale(ao),am=ao.panel.yScale(ao),al=am.domain(),ai=ao[an.property()];
if(dv.util.isArray(ao)){ao[0].x=ai;
ao[1].x=ai
}else{var aj=[];
ao.x=ai;
aj.push(ao);
aj.push(dv.util.clone(ao));
af.push(aj)
}});
ad._nestData[ag].values=af
});
this._super(ae)
};
ac.enterPen=function(){var ad=function(ah,ag){var af=ah.panel.xScale(ah);
return af.mapValueToPercent(af.mapToProp(ah,ag)+af.rangeBand()/2,ag)
},ae=function(ag,af){return 0
};
return this._decoratePen(ad,ae)
};
ac.pen=function(){var ad=function(ah,ag){var af=ah.panel.xScale(ah);
return af.mapValueToPercent(af.mapToProp(ah,ag)+af.rangeBand()/2,ag)
},ae=function(ag,af){return af===0?0:1
};
return this._decoratePen(ad,ae)
};
ac._defined=function(ae,ad){return dv.util.isFinite(ae.panel.xScale(ae).mapToProp(ae,ad))
};
return ac
});
dv.geom.hline=dv.geom.segment.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.hline
}ac._dataPointStyleClass="hline-geom";
ac._render=function(ae){var ad=this;
dv.util.each(this._nestData,function(ah,ag){var af=[];
dv.util.each(ah.values,function(an,ak){var am=an.panel.xScale(an),al=an.panel.yScale(an),aj=am.domain(),ao=an[al.property()];
if(dv.util.isArray(an)){an[0].y=ao;
an[1].y=ao
}else{var ai=[];
an.y=ao;
ai.push(an);
ai.push(dv.util.clone(an));
af.push(ai)
}});
ad._nestData[ag].values=af
});
this._super(ae)
};
ac.enterPen=function(){var ad=function(ag,af){return af===0?0:1
},ae=function(ag,af){return ag.panel.yScale(ag).reverse()?1:0
};
return this._decoratePen(ad,ae)
};
ac.pen=function(){var ad=function(ag,af){return af===0?0:1
},ae=function(ag,af){return ag.panel.yScale(ag).mapPropToPercent(ag,af)
};
return this._decoratePen(ad,ae)
};
ac._defined=function(ae,ad){return dv.util.isFinite(ae.panel.yScale(ae).mapToProp(ae,ad))
};
return ac
});
dv.geom.ribbon=dv.geom.area.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.ribbon
}ac._initializeDefaultAes=function(){this._super();
this._defaultAes.yMin=1;
this._defaultAes.yMax=1;
delete this._defaultAes.y
};
ac._trainScales=function(){var ad=this.getExplicitScales("yMin")["yMin"],ag,af;
for(var ae in ad){if(!this._aes.y){this._aes.y={}
}ag=this._aes.y;
af=ag[ae];
if(!af){ag[ae]=af=ad[ae].copy().property("y").mapping("y")
}af.trainingProperties(["yMin","yMax"])
}};
ac._render=function(ae){var ad=this.getExplicitScales(["yMin","yMax","y"]),ah=ad.yMin;
for(var aj in ah){var af=ah[aj],ag=ad.yMax[aj],ai=ad.y[aj];
ag.range(ai.range()).domain(ai.domain());
af.range(ai.range()).domain(ai.domain())
}this._super(ae)
};
ac.enterPen=function(){var ae=this,ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ag.rangeBand()/2,ah)
},af=function(ah,ag){return ah.panel.yScale(ah).reverse()?1:0
};
return this._decoratePen(ad,af,af)
};
ac.pen=function(){var ad=function(ai,ah){var ag=ai.panel.xScale(ai);
return ag.mapValueToPercent(ag.mapToProp(ai,ah)+ag.rangeBand()/2,ah)
},af=function(ah,ag){var ai=ah.panel.yScale(ah);
return ai.mapValueToPercent(ai.mapValue(ah.yMin,ag))
},ae=function(ah,ag){var ai=ah.panel.yScale(ah);
return ai.mapValueToPercent(ai.mapValue(ah.yMax,ag))
};
return this._decoratePen(ad,af,ae)
};
ac._defined=function(af,ae){var ad=af.panel.xScale(af),ag=af.panel.yScale(af);
return dv.util.isFinite(ad.mapToProp(af,ae))&&dv.util.isFinite(ag.mapValue(af.yMin,ae))&&dv.util.isFinite(ag.mapValue(af.yMax,ae))
};
ac._decoratePen=function(ad,ah,ag){var ae=this;
var af=this.coord()._area().x(ad).y0(ah).y1(ag).defined(this._defined);
af.renderer.tension(this.tension()).interpolate(this.interpolate());
return{bounds:function(ak,ai){var aj=af.getBounds(ak,ai);
if(aj){aj.coord=ae.coord()
}return aj
},pathTween:function(aj,ai){return ae.pathTween(af,this,aj,ai)
},path:function(aj,ai){return af.getPath(af.getBounds(aj,ai))
}}
};
return ac
});
dv.geom.errorbar=dv.geom.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.errorbar;
this._width=1
}ac._dataPointStyleClass="errorbar-geom";
ac._initializeDefaultAes=function(){this._super();
this._defaultAes.yMin=1;
this._defaultAes.yMax=1;
delete this._defaultAes.y
};
ac._trainScales=function(){var ad=this.getExplicitScales("yMin")["yMin"],af;
for(var ae in ad){if(!this._aes.y){this._aes.y={}
}yScales=this._aes.y;
af=yScales[ae];
if(!af){yScales[ae]=af=ad[ae].copy().property("y").mapping("y")
}af.trainingProperties(["yMin","yMax"])
}};
ac.getValues=function(ad){return ad.values
};
ac.width=function(ad){if(!arguments.length){return this._width
}this._width=ad;
return this
};
ac.attributes=function(ae,ad){var af=ad.getScale("linetype");
ae.attr("style","").classed(ad._dataPointStyleClass,true).call(ad.applyAttributeValue,ad,"stroke","stroke").call(ad.applyAttributeValue,ad,"opacity","alpha").call(ad.applyAttributeValue,ad,"stroke-width","size").style("stroke-dasharray",function(ai,ah,ag){return af?dv.util.svg.getDasharray(af.mapToProp(ai[0],ah,ag)):null
}).style("fill","none")
};
ac._render=function(aj){var am=this.getScale("x");
if(!(am instanceof dv.scale.ordinal)){var ae=Number.MAX_VALUE,al,ag;
dv.util.each(this._nestData,function(an){dv.util.each(an.values,function(ao){al=ao.panel.xScale(ao).mapValue(ao.x);
if(!dv.util.isUndefined(ag)){ae=Math.min(ae,Math.abs(al-ag))
}ag=al
})
});
this._maxWidthPixels=ae
}var ak=this.getExplicitScales(["yMin","yMax","y"]),ai=ak.yMin;
for(var ah in ai){var af=ai[ah],ad=ak.yMax[ah];
yScale=ak.y[ah];
ad.range(yScale.range()).domain(yScale.domain());
af.range(yScale.range()).domain(yScale.domain())
}this._super(aj)
};
ac.enterPen=function(){var ad=this,af=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapToProp(aj,ai)+ad._offsetX(aj),ai)
},ae=function(aj,ai){var ah=aj.panel.xScale(aj);
return ah.mapValueToPercent(ah.mapToProp(aj,ai)+ad._offsetX(aj,true),ai)
},ag=function(ai,ah){return ai.panel.yScale(ai).reverse()?1:0
};
return this._decoratePen(af,ae,ag,ag)
};
ac.pen=function(){var ad=this,af=function(ak,aj){var ai=ak.panel.xScale(ak);
return ai.mapValueToPercent(ai.mapToProp(ak,aj)+ad._offsetX(ak),aj)
},ae=function(ak,aj){var ai=ak.panel.xScale(ak);
return ai.mapValueToPercent(ai.mapToProp(ak,aj)+ad._offsetX(ak,true),aj)
},ah=function(aj,ai){var ak=aj.panel.yScale(aj);
return ak.mapValueToPercent(ak.mapValue(aj.yMin,ai))
},ag=function(aj,ai){var ak=aj.panel.yScale(aj);
return ak.mapValueToPercent(ak.mapValue(aj.yMax,ai))
};
return this._decoratePen(af,ae,ah,ag)
};
ac._isOrdinal=function(ad){return ad.panel.xScale(ad) instanceof dv.scale.ordinal
};
ac._offsetX=function(ag,af){var ae=ag.panel.xScale(ag),ad;
if(ae instanceof dv.scale.ordinal){ad=ae.rangeBand()/2+ae.rangeBand()/2*(af?this._width:-this._width)
}else{ad=this._maxWidthPixels*(af?this._width/2:-this._width/2)
}return ad
};
ac._defined=function(af,ae){var ad=af.panel.xScale(af),ag=af.panel.yScale(af);
return dv.util.isFinite(ad.mapToProp(af,ae))&&dv.util.isFinite(ag.mapValue(af.yMin,ae))&&dv.util.isFinite(ag.mapValue(af.yMax,ae))
};
ac._decoratePen=function(ag,af,ai,ah){var ad=this;
var ae=this.coord()._errorBar().x0(ag).x1(af).y0(ai).y1(ah).defined(this._defined);
return{bounds:function(ak,aj){return ae.getBounds(ak,aj)
},pathTween:function(ak,aj){return ad.pathTween(ae,this,ak,aj)
},path:function(ak,aj){return ae.getPath(ae.getBounds(ak,aj))
}}
};
return ac
});
dv.geom.poly=dv.geom.extend(function(){function ac(){this._super();
this._rendererClass=dv.geom.poly
}ac._dataPointStyleClass="poly-geom";
ac._initializeDefaultAes=function(){this._super();
this._defaultAes.size=1;
delete this._defaultAes.shape;
delete this._defaultAes.x;
delete this._defaultAes.y
};
ac._trainScales=function(){var ae=this.getExplicitScales(["yMin","xMin"]),ag;
for(ag in ae.yMin){var af=this._aes.y;
if(!af){this._aes.y=af={}
}if(!af[ag]){af[ag]=yMinScale.copy().property("y").mapping("y")
}af[ag].trainingProperties(["yMin","yMax"])
}for(ag in ae.xMin){var ad=this._aes.x;
if(!ad){this._aes.x=ad={}
}if(!ad[ag]){ad[ag]=xMinScale.copy().property("x").mapping("x")
}ad[ag].trainingProperties(["xMin","xMax"])
}};
ac.getValues=function(ad){return ad.values
};
ac.attributes=function(ag,ae){var ah=ae.getScale("fill"),af=ae.getScale("stroke"),ad=ae.getScale("alpha");
ag.attr("style","").classed(ae._dataPointStyleClass,true).call(ae.applyAttributeValue,ae,"stroke","stroke").call(ae.applyAttributeValue,ae,"fill","fill").call(ae.applyAttributeValue,ae,"opacity","alpha")
};
ac.exitSeriesGroup=function(ae,ad){ad.exitSeries(ae,ad.enterPen,ad)
};
ac.getHighlightColor=function(ag,ae){var af=this.getScale("fill"),ad=this.getScale("stroke");
if(!(ad instanceof dv.scale.constant)){return ad.mapToProp(ag,ae)
}if(!(af instanceof dv.scale.constant)){return af.mapToProp(ag,ae)
}return ad.mapToProp(ag,ae)
};
ac.enterPen=function(){var ad=function(ag,af){return ag.panel.xScale(ag).mapPropToPercent(ag,af)
},ae=function(ag,af){var ah=ag.panel.yScale(ag);
return dv.util.map(ag[ah.property()],function(){return ah.reverse()?1:0
})
};
return this._decoratePen(ad,ae)
};
ac.pen=function(){var ad=function(ag,af){return ag.panel.xScale(ag).mapPropToPercent(ag,af)
},ae=function(ag,af){return ag.panel.yScale(ag).mapPropToPercent(ag,af)
};
return this._decoratePen(ad,ae)
};
ac._defined=function(aj,ag){var af=aj.panel.xScale(aj).mapToProp(aj,ag),ah=aj.panel.yScale(aj).mapToProp(aj,ag),ad=d3.max([af.length,ah.length]),ai=true;
for(var ae=0;
ae<ad&&ai;
ae++){ai=dv.util.isFinite(af[ae])&&dv.util.isFinite(ah[ae])
}return ai
};
ac._decoratePen=function(ad,ag){var ae=this;
var af=this.coord()._poly().xs(ad).ys(ag).defined(this._defined);
return{bounds:function(ai,ah){return af.getBounds(ai,ah)
},pathTween:function(aj,ai,ah){return ae.pathTween(af,this,aj,ai,ah)
},path:function(ai,ah){return af.getPath(af.getBounds(ai,ah))
}}
};
return ac
});
dv.behavior=dv.extend(function(){function ad(){}var ac;
ad._testAndroidChromeBug141840=function(){if(ac===undefined){var ae=navigator.userAgent;
ac=/Android .* Chrome\/18+/.exec(ae)!==null||/Silk\/2./.exec(ae)!==null
}return ac
};
return ad
});
dv.behavior.inspector=dv.behavior.extend(function(){function ai(){this._size=undefined;
this._lastX=NaN;
this._visible=false;
this._inspector=null;
this._thickness=3;
this._orientation="bottom";
this._currentValue=null;
this._gutterPadding=-7;
this._calloutPadding={left:8,top:7,right:8,bottom:7};
this._label=this._defaultLabel();
this._underGeoms=false;
this._dragInspect=true;
this._pressTimer=null
}ai._render=function(ak){this._domain=af.call(this);
var am=0,al=this._chart.facet().getPanel(0)._bounds;
if(this._size===undefined){this._size=al.bottom-al.top
}this._xGuide=dv.util.clone(this._chart._axes._get("x")[0]);
this._selection=ak;
this._inspector=ak.selectAll(".inspector").data([0]);
this._inspector.call(this._createInspector,this._orientation,al,this._calloutPadding,this._thickness)
};
ai._createInspector=function(at,am,al,ao,aq){var au=at,ak=at.enter();
ak=ak.append("g").classed("inspector",true);
au.style("pointer-events","none").attr("opacity",0.000001).attr("transform","translate(0,"+al.top+")");
var ap=ak.append("g").classed("inspector-marker",true);
var an=ap.append("g").classed("inspector-line-container",true);
an.append("path").classed("inspector-callout",true);
au.select(".inspector-callout").attr("d",function(){var aw=-3,av=aw+5;
if(am==="bottom"){aw=al.bottom-al.top+2;
av=aw-5
}return"M-5,"+aw+"L5,"+aw+"L0,"+av+"Z"
});
an.append("line").classed("inspector-line",true);
au.select(".inspector-line").attr("y1",am==="bottom"?0:4).attr("y2",am==="bottom"?al.bottom-al.top-6:al.bottom-al.top).style("stroke-width",aq);
var ar=ap.append("g").classed("inspector-tip",true);
au.select(".inspector-tip").attr("transform","translate(0,"+(am==="bottom"?al.bottom-al.top+2:-30)+")");
ar.append("rect").classed("inspector-tip-background",true);
ar.append("text").classed("inspector-tip-label",true);
au.select(".inspector-tip-label").attr("x",ao.left).attr("y","1em").attr("dy",ao.top)
};
ai.moveToIndex=function(al){var an=this._chart.getTrainedScale("x"),am=this._domain[al],ak=this._label.call(this,am,al),ao=an.mapValue(am);
ad.call(this,am,ak,ao)
};
ai.hide=function(){this._inspector.attr("opacity",0.000001);
this._visible=false;
return this
};
ai.show=function(){this._inspector.attr("opacity",1);
this._visible=true;
return this
};
ai._removeEvents=function(){this._chart.on("mousemove.inspector",null);
this._chart.on("mouseout.inspector",null);
this._chart.on("touchstart.inspector",null);
this._chart.on("touchmove.inspector",null);
this._chart.on("touchend.inspector",null)
};
ai.inspectorMove=function(ak){if(!arguments.length){return this._inspectorMove
}this._inspectorMove=ak;
return this
};
ai.inspectorOut=function(ak){if(!arguments.length){return this._inspectorOut
}this._inspectorOut=ak;
return this
};
ai.label=function(ak){if(!arguments.length){return this._label
}this._label=d3.functor(ak);
return this
};
ai.thickness=function(ak){if(!arguments.length){return this._thickness
}this._thickness=ak;
return this
};
ai.size=function(ak){if(!arguments.length){return this._size
}this._size=ak;
return this
};
ai.chart=function(ak){if(!arguments.length){return this._chart
}if(this._chart){this._removeEvents()
}this._chart=ak;
if(this._chart){ae.call(this)
}return this
};
ai.orientation=function(ak){if(!arguments.length){return this._orientation
}this._orientation=ak;
return this
};
function af(){var ak=[],ao=this._chart.getTrainedScale("x"),au,at=false,an=function(ay,ax){ay=ao._parse(ay);
ax=ao._parse(ax);
return at&&ay&&ax?ay.getTime()===ax.getTime():ay===ax
},aw=function(ax){return ao.mapValue(ax)
},ap=this._chart.data(),aq=-1,am=this._chart._layers.length;
if(ap.length){ak.concat(ap[ao.property()])
}while(++aq<am){var av=this._chart._layers[aq],al=av.getTrainedScale("x"),ar=av.data()[al.property()];
if(ar&&ar!==ap){ak=ak.concat(ar)
}at=at||(al instanceof dv.scale.time||al instanceof dv.scale.time.utc)
}return ak.length?dv.util.sortBy(dv.util.uniqueValues(ak,an),aw):ak
}function ae(){this._chart.on("mousemove.inspector",dv.util.bind(ag,this));
this._chart.on("mouseout.inspector",dv.util.bind(ah,this));
this._chart.on("touchstart.inspector",dv.util.bind(aj,this));
this._chart.on("touchmove.inspector",dv.util.bind(ag,this));
this._chart.on("touchend.inspector",dv.util.bind(ac,this))
}ai._defaultLabel=function(){var ak=this;
return function(am){var al=(ak._xGuide.tickFormat)?ak._xGuide.tickFormat():function(an){return an
};
return al(am)
}
};
ai.label=function(ak){if(!arguments.length){return this._label
}this._label=d3.functor(ak);
return this
};
ai.underGeoms=function(ak){if(!arguments.length){return this._underGeoms
}this._underGeoms=ak;
return this
};
ai.gutterPadding=function(ak){if(!arguments.length){return this._gutterPadding
}this._gutterPadding=ak;
return this
};
function ad(ao,am,aq){var ap=0,al=0;
if(this._lastX===aq){return
}this._inspector.attr("opacity",1);
this._inspector.select(".inspector-tip-label").text(am).each(function(){var at=this.getBBox();
ap=Math.max(at.width,ap);
al=Math.max(at.height,al)
});
var ar=this._chart.facet().getPanel(0).bounds(),an;
ap+=this._calloutPadding.left+this._calloutPadding.right;
al+=this._calloutPadding.top+this._calloutPadding.bottom;
an=aq-ap/2;
if(an<ar.left+this._gutterPadding){an=ar.left+this._gutterPadding
}if(an+ap>ar.right-this._gutterPadding){an=ar.right-this._gutterPadding-ap
}this._inspector.select(".inspector-marker").attr("transform","translate("+an+",0)");
this._inspector.select(".inspector-tip-background").attr("width",ap).attr("height",al);
var ak=aq-an;
this._inspector.select(".inspector-line-container").attr("transform","translate("+ak+",0)")
}function aj(al){if(!al){return
}var ak=this;
this._dragInspect=false;
clearTimeout(this._pressTimer);
this._pressTimer=setTimeout(function(){ak._dragInspect=true;
ag.call(ak,al)
},500);
return false
}function ac(ak){clearTimeout(this._pressTimer);
if(this._dragInspect){this._dragInspect=false
}ah.call(this,ak)
}function ag(ap){if(!ap){return
}if(!this._dragInspect){clearTimeout(this._pressTimer);
return
}var ao=ap.touches?ap.touches[0]:ap;
var au=this._chart.getTrainedScale("x"),al=this._testAndroidChromeBug141840()?ao.screenX:ao.clientX,ak=al-ao.target.getBoundingClientRect().left+ao.target.getBBox().x,an=dv.util.binaryCompare(this._domain,ak,function(av){return au.mapValue(av)
}),ar=Math.min(Math.max(an||0,0),this._domain.length-1),at=this._domain[ar],aq=this._label.call(this,at,ar),am=au.mapValue(at);
if(this._currentValue!=at){if(this._inspectorMove){this._inspectorMove.call(this,aq,ar,am,at)
}ad.call(this,at,aq,am)
}this._currentValue=at;
dv.cancelEvent(ap)
}function ah(ak){this._inspector.attr("opacity",0.000001);
if(this._inspectorOut){this._inspectorOut.call(this)
}this._currentValue=null;
dv.cancelEvent(ak)
}return ai
});
dv.behavior.brush=dv.behavior.extend(function(){function ac(ad){if(arguments.length&&!dv.util.isArray(ad)){this._dimensions=[this._dimensions]
}this._fluidDimensions=ad||["x","y"];
this._snap=false;
this._resizing=false
}ac.initializeBrush=function(ae){var ad=this;
this._brush=dv.brush(ae).on("brushstart.brush",function(){ad._onBrushStart.call(ad);
if(ad._brushStart){ad._brushStart.call(this,"start",ad._brush.extent(),ad)
}}).on("brush.brush",function(af){ad._onBrushMove.call(ad);
if(ad._brushMove){ad._brushMove.call(this,"move",ad._brush.extent(),ad)
}}).on("brushend.brush",function(){ad._onBrushEnd.call(ad);
if(ad._brushEnd){ad._brushEnd.call(this,"end",ad._brush.extent(),ad)
}})
};
ac._removeEvents=function(){this._brush.on("brushstart.brush",null).on("brush.brush",null).on("brushend.brush",null)
};
ac._onBrushStart=function(){if(!this.snap()||this._fluidDimensions.length>1){return
}this._startPos=d3.mouse(this._brushContainer.node());
this._moving=d3.select(d3.event.sourceEvent.target).classed("extent")
};
ac._onBrushMove=function(){if(!this.snap()||this._fluidDimensions.length>1){return
}var ad=d3.mouse(this._brushContainer.node());
if(this._startPos[0]!==ad[0]||this._startPos[1]!==ad[1]){this._snapToDataPoints()
}};
ac._onBrushEnd=function(){if(!this.snap()||this._fluidDimensions.length>1){return
}var ad=d3.mouse(this._brushContainer.node());
if(!this._moving&&this._startPos[0]===ad[0]&&this._startPos[1]===ad[1]){this.clear()
}else{this._brushContainer.selectAll(".resize").style("display",null)
}};
ac._snapToDataPoints=function(){var ah=this._brush.extent(),ad=[],af=this._chart.getTrainedScale(this._fluidDimensions[0]),ae=[this._snapToNearestPoint(af,ah[0],0),this._snapToNearestPoint(af,ah[1],1)];
this._brush.extent([ae[0].value,ae[1].value]);
var ag=this._chart.plotBounds();
if(this._fluidDimensions==="x"){ad[0]=[ae[0].rangeValue,0];
ad[1]=[ae[1].rangeValue,ag.bottom-ag.top]
}else{ad[0]=[0,ae[0].rangeValue];
ad[1]=[ag.right-ag.left,ae[1].rangeValue]
}this._adjustBounds(this._brushContainer,ad)
};
ac._snapToNearestPoint=function(ae,ao,ak){var af={},al;
if(ae instanceof dv.scale.ordinal||ae instanceof dv.scale.identity){var ag=dv.util.scaleRangeNoReverse(ae);
var am=ag[1]-ag[0];
domain=ae.domain();
al=Math.round(ae.invertValue(ao)/am-1)
}else{domain=dv.util.uniq(this._chart.data()[ae.mapping()]);
index=dv.util.binaryCompare(domain,ao,function(ap){return ap
});
al=Math.min(Math.max(index||0,0),domain.length-1)
}var an=domain[al];
af.value=an;
if(ak===0){if(al===0){af.rangeValue=ae.mapValue(an)
}else{var ad=domain[al-1],ai=ae.mapValue(ad);
valueRange=ae.mapValue(an);
af.rangeValue=valueRange-(valueRange-ai)/2
}}else{if(al===domain.length-1){af.rangeValue=ae.mapValue(an)
}else{var aj=domain[al+1],ah=ae.mapValue(aj);
valueRange=ae.mapValue(an);
af.rangeValue=valueRange+(ah-valueRange)/2
}}return af
};
ac._adjustBounds=function(ae,ad){if(this._fluidDimensions==="x"){this._adjustBoundsX(ae,ad)
}if(this._fluidDimensions==="y"){this._adjustBoundsY(ae,ad)
}ae.selectAll(".resize").attr("transform",function(af){return"translate("+ad[+(/e$/).test(af)][0]+","+ad[+(/^s/).test(af)][1]+")"
})
};
ac._adjustBoundsX=function(ae,ad){ae.select(".extent").attr("x",ad[0][0]);
ae.selectAll(".extent,.n>rect,.s>rect").attr("width",ad[1][0]-ad[0][0])
};
ac._adjustBoundsY=function(ae,ad){ae.select(".extent").attr("y",ad[0][1]);
ae.selectAll(".extent,.e>rect,.w>rect").attr("height",ad[1][1]-ad[0][1])
};
ac._setScales=function(){if(this._fluidDimensions.indexOf("x")>=0){var ad=this._chart.getTrainedScale("x");
this._brush.x(ad._d3Scale)
}if(this._fluidDimensions.indexOf("y")>=0){var ae=this._chart.getTrainedScale("y");
this._brush.y(ae._d3Scale)
}};
ac._render=function(){this._brushContainer=this._chart._parent.select(".interaction-group");
if(this._brush.empty()){this._brushContainer.classed("brush",true).call(this._brush)
}var af=this._chart.plotBounds();
if(!this._brush.y()){var ad=af.bottom-af.top;
this._brushContainer.selectAll(".extent").attr("height",ad).attr("y",0);
this._brushContainer.selectAll(".resize rect").attr("height",ad).attr("y",0)
}if(!this._brush.x()){var ae=af.right-af.left;
this._brushContainer.selectAll(".extent").attr("width",ae).attr("x",0);
this._brushContainer.selectAll(".resize rect").attr("width",ae).attr("x",0)
}};
ac.empty=function(){return this._brush.empty()
};
ac.clear=function(){this._brushContainer.call(this._brush.clear())
};
ac.extent=function(ad){if(!arguments.length){return(this._brush)?this._brush.extent():null
}this._brushContainer.call(this._brush.extent(ad));
return this
};
ac.snap=function(ad){if(!arguments.length){return this._snap
}this._snap=(this._fluidDimensions.length>1)?false:ad;
return this
};
ac.brushStart=function(ad){if(!arguments.length){return this._brushStart
}this._brushStart=ad;
return this
};
ac.brushMove=function(ad){if(!arguments.length){return this._brushMove
}this._brushMove=ad;
return this
};
ac.brushEnd=function(ad){if(!arguments.length){return this._brushEnd
}this._brushEnd=ad;
return this
};
ac.chart=function(ad){if(!arguments.length){return this._chart
}this._chart=ad;
this.initializeBrush(this._chart);
if(this._chart){this._setScales()
}return this
};
return ac
});
dv.brush=function(ag){var ac=A(ah,"brushstart","brush","brushend"),aj=null,ai=null,ak=ab[0],an=[[0,0],[0,0]],ad;
function ah(ao){ao.each(function(){var ar=d3.select(this),aq=ar.selectAll(".background").data([0]),ap=ar.selectAll(".extent").data([0]),au=ar.selectAll(".resize").data(ak,String),at;
ag.on("mousedown.brush",al).on("touchstart.brush",al)._g.style("cursor","crosshair");
ar.style("pointer-events","all");
ap.enter().append("rect").attr("class","extent").style("cursor","move");
au.enter().append("g").attr("class",function(av){return"resize "+av
}).style("cursor",function(av){return i[av]
}).append("rect").attr("x",function(av){return(/[e]$/).test(av)?-10:(/[w]$/).test(av)?2:null
}).attr("y",function(av){return(/^[ns]/).test(av)?-3:null
}).attr("width",10).attr("height",6).style("visibility","hidden");
au.style("display",ah.empty()?"none":null);
au.exit().remove();
if(aj){at=dv.util.scaleRangeNoReverse(aj);
aq.attr("x",at[0]).attr("width",at[1]-at[0]);
af(ar)
}if(ai){at=dv.util.scaleRangeNoReverse(ai);
aq.attr("y",at[0]).attr("height",at[1]-at[0]);
ae(ar)
}am(ar)
})
}function am(ao){ao.selectAll(".resize").attr("transform",function(ap){return"translate("+an[+/e$/.test(ap)][0]+","+an[+/^s/.test(ap)][1]+")"
})
}function af(ao){ao.select(".extent").attr("x",an[0][0]);
ao.selectAll(".extent,.n>rect,.s>rect").attr("width",an[1][0]-an[0][0])
}function ae(ao){ao.select(".extent").attr("y",an[0][1]);
ao.selectAll(".extent,.e>rect,.w>rect").attr("height",an[1][1]-an[0][1])
}function al(){var aI=this,ap=d3.select(d3.event.target),aw=ac.of(aI,arguments),aD=d3.select(aI),aF=ap.datum(),aB=!/^(n|s)$/.test(aF)&&aj,az=!/^(e|w)$/.test(aF)&&ai,aA=ap.classed("extent"),aG,aH=ax(),aq;
var au=d3.select(window).on("mousemove.brush",av).on("mouseup.brush",ao).on("touchmove.brush",av).on("touchend.brush",ao).on("keydown.brush",ay).on("keyup.brush",at);
if(aA){aH[0]=an[0][0]-aH[0];
aH[1]=an[0][1]-aH[1]
}else{if(aF&&(aF==="e"||aF==="w"||aF==="s"||aF==="n"||aF==="nw"||aF==="ne"||aF==="sw"||aF==="se")){var aE=+/w$/.test(aF),aC=+/^n/.test(aF);
aq=[an[1-aE][0]-aH[0],an[1-aC][1]-aH[1]];
aH[0]=an[aE][0];
aH[1]=an[aC][1]
}else{if(d3.event.altKey){aG=aH.slice()
}}}aD.style("pointer-events","none").selectAll(".resize").style("display",null);
d3.select("body").style("cursor",ap.style("cursor"));
aw({type:"brushstart"});
av();
a();
function ax(){var aJ=d3.event.changedTouches;
return aJ?d3.touches(aI,aJ)[0]:d3.mouse(aI)
}function ay(){if(d3.event.keyCode==32){if(!aA){aG=null;
aH[0]-=an[1][0];
aH[1]-=an[1][1];
aA=2
}a()
}}function at(){if(d3.event.keyCode==32&&aA==2){aH[0]+=an[1][0];
aH[1]+=an[1][1];
aA=0;
a()
}}function av(){var aJ=ax(),aK=false;
if(aq){aJ[0]+=aq[0];
aJ[1]+=aq[1]
}if(!aA){if(d3.event.altKey){if(!aG){aG=[(an[0][0]+an[1][0])/2,(an[0][1]+an[1][1])/2]
}aH[0]=an[+(aJ[0]<aG[0])][0];
aH[1]=an[+(aJ[1]<aG[1])][1]
}else{aG=null
}}if(aB&&ar(aJ,aj,0)){af(aD);
aK=true
}if(az&&ar(aJ,ai,1)){ae(aD);
aK=true
}if(aK){am(aD);
aw({type:"brush",mode:aA?"move":"resize"})
}}function ar(aR,aL,aN){var aO=dv.util.scaleRangeNoReverse(aL),aK=aO[0],aJ=aO[1],aP=aH[aN],aS=an[1][aN]-an[0][aN],aM,aQ;
if(aA){aK-=aP;
aJ-=aS+aP
}aM=Math.max(aK,Math.min(aJ,aR[aN]));
if(aA){aQ=(aM+=aP)+aS
}else{if(aG){aP=Math.max(aK,Math.min(aJ,2*aG[aN]-aM))
}if(aP<aM){aQ=aM;
aM=aP
}else{aQ=aP
}}if(an[0][aN]!==aM||an[1][aN]!==aQ){ad=null;
an[0][aN]=aM;
an[1][aN]=aQ;
return true
}}function ao(){av();
aD.style("pointer-events","all").selectAll(".resize").style("display",ah.empty()?"none":null);
d3.select("body").style("cursor",null);
au.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);
aw({type:"brushend"});
a()
}}ah.x=function(ao){if(!arguments.length){return aj
}aj=ao;
ak=ab[!aj<<1|!ai];
return ah
};
ah.y=function(ao){if(!arguments.length){return ai
}ai=ao;
ak=ab[!aj<<1|!ai];
return ah
};
ah.extent=function(au){var aq,ao,at,ar,ap;
if(!arguments.length){au=ad||an;
if(aj){aq=au[0][0],ao=au[1][0];
if(!ad){aq=an[0][0],ao=an[1][0];
if(aj.invert){aq=aj.invert(aq),ao=aj.invert(ao)
}if(ao<aq){ap=aq,aq=ao,ao=ap
}}}if(ai){at=au[0][1],ar=au[1][1];
if(!ad){at=an[0][1],ar=an[1][1];
if(ai.invert){at=ai.invert(at),ar=ai.invert(ar)
}if(ar<at){ap=at,at=ar,ar=ap
}}}return aj&&ai?[[aq,at],[ao,ar]]:aj?[aq,ao]:ai&&[at,ar]
}ad=[[0,0],[0,0]];
if(aj){aq=au[0],ao=au[1];
if(ai){aq=aq[0],ao=ao[0]
}ad[0][0]=aq,ad[1][0]=ao;
if(aj.invert){aq=aj(aq),ao=aj(ao)
}if(ao<aq){ap=aq,aq=ao,ao=ap
}an[0][0]=aq|0,an[1][0]=ao|0
}if(ai){at=au[0],ar=au[1];
if(aj){at=at[1],ar=ar[1]
}ad[0][1]=at,ad[1][1]=ar;
if(ai.invert){at=ai(at),ar=ai(ar)
}if(ar<at){ap=at,at=ar,ar=ap
}an[0][1]=at|0,an[1][1]=ar|0
}return ah
};
ah.clear=function(){ad=null;
an[0][0]=an[0][1]=an[1][0]=an[1][1]=0;
return ah
};
ah.empty=function(){return(aj&&an[0][0]===an[1][0])||(ai&&an[0][1]===an[1][1])
};
return d3.rebind(ah,ac,"on")
};
var i={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};
var ab=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];
function u(){}function W(ac){function af(){var ai=ae,ah=-1,aj=ai.length,ag;
while(++ah<aj){if(ag=ai[ah].on){ag.apply(this,arguments)
}}return ac
}var ae=[],ad=new d3.map();
af.on=function(ah,aj){var ag=ad.get(ah),ai;
if(arguments.length<2){return ag&&ag.on
}if(ag){ag.on=null;
ae=ae.slice(0,ai=ae.indexOf(ag)).concat(ae.slice(ai+1));
ad.remove(ah)
}if(aj){ae.push(ad.set(ah,{on:aj}))
}return ac
};
return af
}u.prototype.on=function(ae,af){var ad=ae.indexOf("."),ac="";
if(ad>0){ac=ae.substring(ad+1);
ae=ae.substring(0,ad)
}return arguments.length<2?this[ae].on(ac):this[ae].on(ac,af)
};
function A(ae){var ac=new u(),ad=0,af=arguments.length;
while(++ad<af){ac[arguments[ad]]=W(ac)
}ac.of=function(ah,ag){return function(ai){var aj;
try{aj=ai.sourceEvent=d3.event;
ai.target=ae;
d3.event=ai;
ac[ai.type].apply(ah,ag)
}finally{d3.event=aj
}}
};
return ac
}function a(){d3.event.stopPropagation();
d3.event.preventDefault()
}dv.behavior.zoom=dv.behavior.extend(function(){function ac(ad){if(arguments.length&&!dv.util.isArray(ad)){this._dimensions=[this._dimensions]
}this._fluidDimensions=ad||["x","y"];
this._zoom=d3.behavior.zoom();
this.scaleExtent([0,Infinity]);
this._underGeoms=false
}ac.initializeZoom=function(ae){var ad=this;
this._cacheAxes();
this._zoom.on("zoomstart.zoom",function(){if(ad._zoomStart){ad._zoomStart.call(this,"start",d3.event.scale,d3.event.translate,ad)
}}).on("zoom.zoom",function(){if(ad._zoomMove){ad._zoomMove.call(this,"move",d3.event.scale,d3.event.translate,ad)
}ad._refresh(d3.event.scale,d3.event.translate)
}).on("zoomend.zoom",function(){if(ad._zoomEnd){ad._zoomEnd.call(this,"end",d3.event.scale,d3.event.translate,ad)
}})
};
ac.underGeoms=function(ad){if(!arguments.length){return this._underGeoms
}this._underGeoms=ad;
return this
};
ac._cacheAxes=function(){this._axisCache={};
for(var ad in this._chart._axes._axes){this._axisCache[ad]=this._chart._axes._axes[ad]
}};
ac._removeEvents=function(){this._zoom.on("zoomstart.zoom",null).on("zoom.zoom",null).on("zoomend.zoom",null)
};
ac._refresh=function(ah,ag){var ae=this,ad=[0,this._bounds.width-this._bounds.width*ah],af=[0,this._bounds.height-this._bounds.height*ah];
if(ah>=1){ag[0]=Math.min(ad[0],Math.max(ag[0],ad[1]));
ag[1]=Math.min(af[0],Math.max(ag[1],af[1]))
}else{ag[0]=(ag[0]<ad[0])?ad[0]:(ag[0]>ad[1])?ad[1]:ag[0];
ag[1]=(ag[1]<af[0])?af[0]:(ag[1]>af[1])?af[1]:ag[1]
}this._zoom.translate(ag);
setTimeout(function(){ae._chart._axes._axes=ae._axisCache;
ae._chart.duration(0);
ae._chart._finalizePlotBounds();
ae._chart._facet._render()
},0)
};
ac._setScales=function(){if(this._fluidDimensions.indexOf("x")>=0){var ad=this._chart.getTrainedScale("x");
this._zoom.x(ad._d3Scale)
}if(this._fluidDimensions.indexOf("y")>=0){var ae=this._chart.getTrainedScale("y");
this._zoom.y(ae._d3Scale)
}};
ac._render=function(ae){this._zoomContainer=ae.selectAll(".zoom-container").data([0]);
this._zoomContainer.enter().append("g").classed("zoom-container");
var af=this._zoomContainer.selectAll(".zoom-pane").data([0]);
af.enter().append("rect").classed("zoom-pane",true);
var ad=this._chart.facet().getPanel(0),ag=ad.bounds();
af.attr("x",ag.left).attr("y",ag.top).attr("width",ag.width).attr("height",ag.height).call(this._zoom);
this._bounds=ag
};
ac.scale=function(ad){if(!arguments.length){return this._zoom.scale()
}this._zoom.scale(ad);
this._refresh(ad,this._zoom.translate());
return this
};
ac.scaleExtent=function(ad){if(!arguments.length){return this._zoom.scaleExtent()
}this._zoom.scaleExtent(ad);
return this
};
ac.translate=function(ad){if(!arguments.length){return this._zoom.translate()
}this._zoom.translate(ad);
this._refresh(this._zoom.scale(),ad);
return this
};
ac.zoomStart=function(ad){if(!arguments.length){return this._zoomStart
}this._zoomStart=ad;
return this
};
ac.zoomMove=function(ad){if(!arguments.length){return this._zoomMove
}this._zoomMove=ad;
return this
};
ac.zoomEnd=function(ad){if(!arguments.length){return this._zoomEnd
}this._zoomEnd=ad;
return this
};
ac.chart=function(ad){if(!arguments.length){return this._chart
}this._chart=ad;
this.initializeZoom(this._chart);
if(this._chart){this._setScales();
this._chart.clipPlot(true)
}return this
};
return ac
});
dv.behavior.rollover=dv.behavior.extend(function(){function ac(){this._selection=null;
this._showTooltip=this._defaultShowTooltip;
this._hideTooltip=this._defaultHideTooltip;
this._orientation="right";
this._tooltipPadding=10;
this._content=this._defaultContent;
this._lastSelectedTarget=null;
this._timer=null;
this._pressTimer=null;
this._dragInspect=true
}ac._render=function(ad){this._xGuides=this.__geom._chart._axes._get("x");
this._yGuides=this.__geom._chart._axes._get("y");
this._isPolar=(this.__geom.coord() instanceof dv.coord.polar);
this._selection=ad;
this._addEvents()
};
ac._addEvents=function(){var ad=this;
this.__geom.on("mouseover.rollover",function(ag,af,ae){return ad._onMouseOver.call(this,ag,af,ae,ad)
}).on("mouseout.rollover",function(ag,af,ae){return ad._onMouseOut.call(this,ag,af,ae,ad)
});
this.__geom._chart.on("tap.rollover",function(){return ad._onTap.call(ad,d3.event)
}).on("touchstart.rollover",function(){return ad._onTouchStart.call(ad,d3.event)
}).on("touchmove.rollover",function(){return ad._onTouchMove.call(ad,d3.event)
}).on("touchend.rollover",function(){return ad._onTouchEnd.call(ad,d3.event)
})
};
ac._removeEvents=function(){this.__geom.on("mouseover.rollover",null).on("mouseout.rollover",null);
this.__geom._chart.on("tap.rollover",null).on("touchstart.rollover",null).on("touchmove.rollover",null).on("touchend.rollover",null)
};
ac._getElementMetadata=function(ae,af){var ad={d:af.datum(),i:0,j:0};
ae._geomGroup.selectAll(".series ."+ae._dataPointStyleClass).each(function(ai,ah,ag){if(ad.d===ai){ad.i=ah;
ad.j=ag
}});
return ad
};
ac._defaultShowTooltip=function(ah,af,ae,ag,ad){ad._darkenGeom.call(this,ah,ad);
ad._showTip.call(this,ah,af,ae,ad)
};
ac._defaultHideTooltip=function(ah,af,ae,ag,ad){ad._brightenGeom.call(this,ah,ad);
ad._removeTip.call(this,ah,af,ae,ad)
};
ac._darkenGeom=function(ai,ad){var af=d3.select(this),ah,ag,ae=function(aj,am,al){if(am[aj]){var ak=ad.__geom.getScale(aj).mapValue(am[aj]);
al.style(aj,d3.rgb(ak).darker(1).toString())
}};
ae("fill",ai,af);
ae("stroke",ai,af)
};
ac._brightenGeom=function(ai,ad){var af=d3.select(this),ah,ag,ae=function(aj,am,al){if(am[aj]){var ak=ad.__geom.getScale(aj).mapValue(am[aj]);
al.style(aj,ak)
}};
ae("fill",ai,af);
ae("stroke",ai,af)
};
ac._showTip=function(aj,ag,af,ad){var ah=ad.__geom.chart()._chartContainer,ai=this.getBBox(),ak=dv.absoluteCoordinates(ad.__geom.chart(),[ai.x,ai.y],aj.panel),ae={height:ai.height,width:ai.width,x:ak[0],y:ak[1]};
dv.showTooltip(ae,ah.select(".plot").node().getBBox(),ad.content().call(ad,aj,ag,af),ad._orientation,ad._tooltipPadding,ah)
};
ac._removeTip=function(ag,af,ae,ad){dv.removeTooltip(ad.__geom.chart()._chartContainer)
};
ac._defaultContent=function(aj,ag,ae){var ak=this.__geom.getExplicitScale("group"),af=aj[0]?aj[0]:aj,an=af.panel.xScale(af),al=af.panel.yScale(af),am=this._xGuides[an.scaleIndex()],ad=this._yGuides[al.scaleIndex()],ao=(am.__scale&&am.tickFormat()?am.tickFormat():String),ah=(ad.__scale&&ad.tickFormat()?ad.tickFormat():String),ai='<span class="metric-value">'+ah(af.data[al.mapping()])+'</span><span class="metric-name">'+al.mapping()+'</span><span class="metric-value">'+ao(af.data[an.mapping()])+'</span><span class="metric-name">'+an.mapping()+"</span>";
if(ak&&ak.mapping()){ai='<span class="series-name">'+af.data[ak.mapping()]+"</span>"+ai
}return ai
};
ac._onMouseOver=function(ag,af,ae,ad){ad._showTooltip.call(this,ag,af,ae,d3.event,ad);
if(this._mouseOver){this._mouseOver.call(this,ag,af,ae,d3.event)
}};
ac._onMouseOut=function(ag,af,ae,ad){ad._hideTooltip.call(this,ag,af,ae,d3.event,ad);
if(ad._mouseOut){ad._mouseOut.call(this,ag,af,ae,d3.event)
}};
ac._onTap=function(ad){this._dragInspect=true;
this._onTouchMove.call(this,ad);
this._onTouchEnd.call(this,ad)
};
ac._onTouchStart=function(ae){var ad=this;
if(this._lastSelectedTarget){clearTimeout(ad._timer);
this._onTouchEnd.call(this,ae,0)
}this._dragInspect=false;
clearTimeout(this._pressTimer);
this._pressTimer=setTimeout(function(){ad._dragInspect=true;
ad._onTouchMove.call(ad,ae)
},500);
return false
};
ac._onTouchMove=function(ag){if(!this._dragInspect){clearTimeout(this._pressTimer);
return
}var af=ag.touches?ag.touches[0]:ag,ai=d3.select(this._elementFromPoint(af)),ad=this._lastSelectedTarget&&this._lastSelectedTarget.node()===ai.node();
if(!ai.empty()&&ai.classed(this.__geom._dataPointStyleClass)){if(this._lastSelectedTarget&&!ad){var ah=this._lastSelectedTarget.datum();
this._brightenGeom.call(this._lastSelectedTarget.node(),ah,this)
}if(!ad){var ae=this._getElementMetadata(this.__geom,ai);
this._showTooltip.call(ai.node(),ae.d,ae.i,ae.j,ag,this);
if(this._mouseOver){this._mouseOver.call(ai.node(),ae.d,ae.i,ae.j,ag)
}this._lastSelectedTarget=ai
}}dv.cancelEvent(ag)
};
ac._onTouchEnd=function(ah,ae){var ad=this;
clearTimeout(this._pressTimer);
this._dragInspect=false;
var ag=ah.touches?ah.touches[0]:ah;
if(arguments.length<2){ae=500
}if(this._lastSelectedTarget){var af=function(){if(!ad._lastSelectedTarget){return
}var ai=ad._getElementMetadata(ad.__geom,ad._lastSelectedTarget);
ad._hideTooltip.call(ad._lastSelectedTarget.node(),ai.d,ai.i,ai.j,ah,ad);
if(ad._mouseOut){ad._mouseOut.call(ad._lastSelectedTarget.node(),ai.d,ai.i,ai.j,ah)
}ad._lastSelectedTarget=null
};
if(ae){timer=setTimeout(af,ae)
}else{af.call(this)
}}dv.cancelEvent(ah)
};
ac._elementFromPoint=function(ae){var ad=[ae.clientX,ae.clientY];
if(this._testAndroidChromeBug141840()){ad=[ae.screenX,ae.screenY]
}return document.elementFromPoint(ad[0],ad[1])
};
ac.content=function(ad){if(!arguments.length){return this._content
}this._content=d3.functor(ad);
return this
};
ac.tooltipPadding=function(ad){if(!arguments.length){return this._tooltipPadding
}this._tooltipPadding=ad;
return this
};
ac.orientation=function(ad){if(!arguments.length){return this._orientation
}this._orientation=ad;
return this
};
ac.mouseOver=function(ad){if(!arguments.length){return this._mouseOver
}this._mouseOver=ad;
return this
};
ac.mouseOut=function(ad){if(!arguments.length){return this._mouseOut
}this._mouseOut=ad;
return this
};
ac.showTooltip=function(ad){if(!arguments.length){return this._showTooltip
}this._showTooltip=ad;
return this
};
ac.hideTooltip=function(ad){if(!arguments.length){return this._hideTooltip
}this._hideTooltip=ad;
return this
};
ac._geom=function(ad){if(!arguments.length){return this.__geom
}if(this.__geom&&this.__geom!==ad){this._removeEvents()
}this.__geom=ad;
return this
};
return ac
});
dv.behavior.voronoiRollover=dv.behavior.rollover.extend(function(){function ac(){this._super();
this._voronoiContainer=null;
this._points=null;
this._pointDetectionRadius=20;
this._numHitAreaVertices=12;
this._isPolar=false
}ac._render=function(ad){this._xGuides=this.__geom._chart._axes._get("x");
this._yGuides=this.__geom._chart._axes._get("y");
this._isPolar=(this.__geom.coord() instanceof dv.coord.polar);
this._selection=ad;
this._createTooltipContainer();
this._renderPolygons(this._getPolygonData(),ad);
this._addEvents()
};
ac._addEvents=function(){var ad=this;
this.__geom._chart.on("tap.rollover",function(){return ad._onTap.call(ad,d3.event)
}).on("touchstart.rollover",function(){return ad._onTouchStart.call(ad,d3.event)
}).on("touchmove.rollover",function(){return ad._onTouchMove.call(ad,d3.event)
}).on("touchend.rollover",function(){return ad._onTouchEnd.call(ad,d3.event)
})
};
ac._removeEvents=function(){this.__geom._chart.on("tap.rollover",null).on("touchstart.rollover",null).on("touchmove.rollover",null).on("touchend.rollover",null)
};
ac._createTooltipContainer=function(){this._voronoiContainer=this._selection.selectAll(".voronoiSelection-container").data([this]);
this._voronoiContainer.enter().append("g").classed("voronoiSelection-container",true)
};
ac._getPolygonData=function(){var af=[],ag=this.__geom._nestData,ad=this;
this._points=[];
var ae=ad.__geom.coord()._point().x(function(ai,ah){return ai.x
}).y(function(ai,ah){return ai.y
}).defined(function(ai,ah){return true
});
dv.util.each(this.__geom._nestData,function(ai,ah){dv.util.each(ai.values,function(ap,ak){var ao={},an=ap[0]?ap[0]:ap,aj=an.panel.xScale(an),aq=an.panel.yScale(an);
ao.x=aj.mapValueToPercent(aj.mapToProp(an,ak)+aj.rangeBand()/2,ak)||0;
ao.y=aq.mapValueToPercent(aq.mapValue(an.hasOwnProperty("y0")?(an.y+an.y0):an.y),ak)||0;
ao.panel=an.panel;
var am=ae.getBounds(ao,ak);
if(ad._isPolar){var al=ad.__geom.coord()._transformAngleRadiusToXY(am.bounds.x,am.bounds.y);
range.bounds.x=al[0];
range.bounds.y=al[1]
}ad._points.push({data:am,rawData:an,seriesIndex:ah,index:ak});
af.push([am.bounds.x,am.bounds.y])
})
});
return d3.geom.voronoi(af)
};
ac._renderPolygons=function(ai,an){var ao=this,af=this.__geom._nestData.length,ah=this.__geom._nestData[0].values.length,ae=d3.select(an.node().parentNode),am=0,al=0,ak;
if(this._isPolar){var aj=this.__geom._nestData[0].values[0].panel,ad=dv.util.scaleRangeNoReverse(aj.xOuterScale()),ag=dv.util.scaleRangeNoReverse(aj.yOuterScale());
am=(ad[0]+ad[1])/2;
al=(ag[0]+ag[1])/2
}this._voronoiContainer.attr("transform","translate("+am+","+al+")");
var ap=this._voronoiContainer.selectAll("path").data(ai);
ap.exit().remove();
ap.enter().append("path").attr("id",function(ar,aq){return"path-"+aq
}).classed("voronoi-overlay",true);
ap.attr("d",function(ar,aq){return ao._getPolygonPath(ar,aq,ao)
}).on("mouseover.rollover",function(at,ar,aq){return ao._onMouseOver.call(this,at.data,ar,aq,ao)
}).on("mouseout.rollover",function(at,ar,aq){return ao._onMouseOut.call(this,at.data,ar,aq,ao)
}).call(this._removeRegisteredEvents,this).call(this._addRegisteredEvents,this);
ap.exit().on("mouseover.rollover",null).on("mouseout.rollover",null).remove()
};
ac._addRegisteredEvents=function(ae,ad){if(!ad){ad=this
}if(!ad.__geom){return
}ae=ae||ad._voronoiContainer.selectAll(".voronoi-overlay");
dv.util.each(ad.__geom.eventMap,function(ag,af){ae.on(af,function(ai,ah){ad.__geom.eventMap[af].callback.call(this,ai,ah,d3.event)
},ag.capture)
});
dv.util.each(ad.__geom._chart.eventMap,function(ag,af){ae.on(af+".dvchart",function(ak,ai){var aj=d3.event,ah=ad.__geom._chart._interactionGroup.node();
if(ad._shouldDispatchChartEvent(aj,ah)){ad.__geom._chart.eventMap[af].callback.call(ah,aj)
}},ag.capture)
})
};
ac._removeRegisteredEvents=function(ae,ad){if(!ad){ad=this
}if(!ad.__geom){return
}ae=ae||ad._voronoiContainer.selectAll(".voronoi-overlay");
dv.util.each(ad.unregisterEventMap,function(af,ag){ae.on(ag,null,af)
});
dv.util.each(ad.__geom._chart.unregisterEventMap,function(af,ag){ae.on(ag+".dvchart",null,af)
})
};
ac._shouldDispatchChartEvent=function(ai,af){var ad=true;
if(ai.type==="mouseout"||ai.type==="mouseover"){var ae=ai.relatedTarget;
if(!ae){ae=(ai.type==="mouseout")?ai.toElement:ai.fromElement
}var ah=d3.select(ae);
if(ah&&!ah.empty()){var ag=ah.attr("class");
ad=!((ah.node()===af)||ah.classed("voronoi-overlay"))
}}return ad
};
ac._getPolygonPath=function(aj,ai,af){if(!aj){return null
}aj.data=af._points[ai];
var ae=dv.util.clone(aj),ad=af._points[ai],ah=d3.geom.polygon(af._getPolygonPoints(ad.data.bounds.x,ad.data.bounds.y)),ag=ah.clip(aj);
return(ag.length)?("M"+ag.join("L")+"Z"):null
};
ac._getPolygonPoints=function(ai,ag){var af=[];
for(var ae=360;
ae>0;
ae-=360/this._numHitAreaVertices){var ah=ae*Math.PI/180,ad=Math.cos(ah)*this._pointDetectionRadius+ai,aj=Math.sin(ah)*this._pointDetectionRadius+ag;
af.push([ad,aj])
}return af
};
ac._defaultShowTooltip=function(ah,af,ae,ag,ad){ad._showPoint.call(this,ah,af,ae,ad);
ad._showTip.call(this,ah,af,ae,ad)
};
ac._defaultHideTooltip=function(ah,af,ae,ag,ad){ad._removePoint.call(this,ah,af,ae,ad);
ad._removeTip.call(this,ah,af,ae,ad)
};
ac._showPoint=function(aj,ah,ag,al){var ai=10,ak=aj.rawData,af=al.getGeomFromVoronoiIndex.call(al,ak,ah,ag);
if(!af.empty()){var ad=af.node().getBoundingClientRect(),ae={height:ad.height,width:ad.width,x:ad.x,y:ad.y};
ai=Math.max(ae.height,ae.width)/2+2.5
}al._voronoiContainer.append("circle").classed("hover-point",true).attr("id","point-"+ag+"-"+ah).attr("cx",aj.data.bounds.x).attr("cy",aj.data.bounds.y).attr("r",0).style("stroke",function(){return al.__geom.getHighlightColor(aj.rawData,ah)
}).style("pointer-events","none").transition().duration(350).attr("r",ai)
};
ac._removePoint=function(ag,af,ae,ad){ad._voronoiContainer.selectAll("#point-"+ae+"-"+af).transition().duration(350).attr("r",0).remove()
};
ac._showTip=function(al,ai,ah,ap){var am=ap.__geom.chart()._chartContainer,af,ak=al.data,an=al.rawData;
var ag=ap.getGeomFromVoronoiIndex.call(ap,an,ai,ah);
if(ag.empty()){var aj=dv.absoluteCoordinates(ap.__geom.chart(),[ak.bounds.x,ak.bounds.y],an.panel),ao=10,ae=10;
af={height:ao,width:ae,y:aj[1]-ao/2,x:aj[0]-ae/2}
}else{var ad=ag.node().getBBox();
af={height:ad.height,width:ad.width,x:ad.x,y:ad.y}
}dv.showTooltip(af,am.select(".panels").node().getBBox(),ap.content().call(ap,an,ai,ah),ap._orientation,ap._tooltipPadding,am)
};
ac.getGeomFromVoronoiIndex=function(af,ae,ad){return this.__geom.chart()._g.selectAll(".datum-"+ae+".series-"+ad).filter(function(ag){return af===ag
})
};
ac._onMouseOver=function(ag,af,ae,ad){ad._showTooltip.call(this,ag,ag.index,ag.seriesIndex,d3.event,ad);
if(ad._mouseOver){ad._mouseOver.call(this,ag.rawData,ag.index,ag.seriesIndex,d3.event)
}};
ac._onMouseOut=function(ag,af,ae,ad){ad._hideTooltip.call(this,ag,ag.index,ag.seriesIndex,d3.event,ad);
if(ad._mouseOut){ad._mouseOut.call(this,ag.rawData,ag.index,ag.seriesIndex,d3.event)
}};
ac._onTouchMove=function(af){if(!this._dragInspect){clearTimeout(this._pressTimer);
return
}var ae=af.touches?af.touches[0]:af,ah=d3.select(this._elementFromPoint(ae)),ad=this._lastSelectedTarget&&this._lastSelectedTarget.node()===ah.node();
if(!ah.empty()&&ah.classed("voronoi-overlay")){if(this._lastSelectedTarget&&!ad){var ag=this._lastSelectedTarget.datum().data;
this._removePoint.call(ah.node(),ag.rawData,ag.index,ag.seriesIndex,this)
}if(!ad){var ai=ah.datum().data;
this._showTooltip.call(ah.node(),ai,ai.index,ai.seriesIndex,af,this);
if(this._mouseOver){this._mouseOver.call(ah.node(),ai.rawData,ai.index,ai.seriesIndex,af)
}this._lastSelectedTarget=ah
}}dv.cancelEvent(af)
};
ac._onTouchEnd=function(ag,ae){var ad=this;
clearTimeout(this._pressTimer);
if(this._dragInspect){this._dragInspect=false
}if(arguments.length<2){ae=500
}if(this._lastSelectedTarget){var af=function(){if(!ad._lastSelectedTarget){return
}var ah=ad._lastSelectedTarget.datum().data;
ad._hideTooltip.call(ad._lastSelectedTarget.node(),ah,ah.index,ah.seriesIndex,ag,ad);
if(ad._mouseOut){ad._mouseOut.call(ad._lastSelectedTarget.node(),ah.rawData,ah.index,ah.seriesIndex,ag)
}ad._lastSelectedTarget=null
};
if(ae){timer=setTimeout(af,ae)
}else{af.call(this)
}}dv.cancelEvent(ag)
};
ac.pointDetectionRadius=function(ad){if(!arguments.length){return this._pointDetectionRadius
}this._pointDetectionRadius=ad;
return this
};
ac.numHitAreaVertices=function(ad){if(!arguments.length){return this._numHitAreaVertices
}this._numHitAreaVertices=ad;
return this
};
return ac
});
dv.log=dv.log||{};
dv.log.NOCONSOLE=false;
dv.log.LVL_ERROR=0;
dv.log.ERROR="error";
dv.log.LVL_WARN=1;
dv.log.WARN="warn";
dv.log.LVL_DEBUG=2;
dv.log.DEBUG="debug";
dv.log.LOGLEVEL=dv.log.LVL_DEBUG;
dv.log.error=function(ac){return dv.log._message(dv.log.ERROR,ac)
};
dv.log.warn=function(ac){return dv.log._message(dv.log.WARN,ac)
};
dv.log.debug=function(ac){return dv.log._message(dv.log.DEBUG,ac)
};
dv.log.noConsole=function(ac){dv.log.NOCONSOLE=ac||false;
dv.log.console=window.console||dv.util.noop;
if(!dv.log.console.log||dv.log.NOCONSOLE){dv.log.console.log=dv.util.noop
}if(!dv.log.console.error||dv.log.NOCONSOLE){dv.log.console.error=dv.log.console.log
}if(!dv.log.console.warn||dv.log.NOCONSOLE){dv.log.console.warn=dv.log.console.log
}if(!dv.log.console.debug||dv.log.NOCONSOLE){dv.log.console.debug=dv.log.console.log
}};
dv.log._message=function(ad,ac){if(dv.log._isValidType(ad)){if(dv.log.LOGLEVEL>=dv.log["LVL_"+ad.toUpperCase()]){dv.log.console[ad](ac.msg,ac.data)
}if(ad===dv.log.ERROR){throw ac.msg+" Context Data: "+JSON.stringify(ac.data)
}}else{dv.log.console.log("Logging message with invalid type: "+ad)
}};
dv.log._isValidType=function(ac){return ac===dv.log.ERROR||ac===dv.log.WARN||ac===dv.log.DEBUG
};
dv.log.noConsole(false);
dv.panel=dv.extend(function(){function ac(){this._margins={left:0,top:0,right:0,bottom:0};
this._trainedScales={}
}ac.getTrainedScale=function(ad){if(ad==="x"){return this.xScale()
}if(ad==="y"){return this.yScale()
}return this._trainedScales[ad]
};
ac.getOuterScale=function(ad){if(ad==="x"){return this._xScale
}if(ad==="y"){return this._yScale
}return null
};
ac._updateRanges=function(ae){var ad=[ae.left,ae.right],af=[ae.bottom,ae.top];
if(this._facet._chart.coord().flip()){this._xScale.range(af);
this._yScale.range(ad)
}else{this._xScale.range(ad);
this._yScale.range(af)
}};
ac.bounds=function(ad){if(!arguments.length){return this._bounds
}this._bounds=ad;
this._updateRanges(this._bounds);
return this
};
ac.margins=function(ad){if(!arguments.length){return this._margins
}this._margins=ad;
return this
};
ac.visibleAxisLabelOrientations=function(ad){if(!arguments.length){return this._visibleAxisLabelOrientations
}this._visibleAxisLabelOrientations=ad;
return this
};
ac.columnIndex=function(ad){if(!arguments.length){return this._columnIndex
}this._columnIndex=ad;
return this
};
ac.rowIndex=function(ad){if(!arguments.length){return this._rowIndex
}this._rowIndex=ad;
return this
};
ac.facetIndex=function(ad){if(!arguments.length){return this._facetIndex
}this._facetIndex=ad;
return this
};
ac.facetKey=function(ad){if(!arguments.length){return this._facetKey
}this._facetKey=ad;
return this
};
ac.xFacetTitle=function(ad){if(!arguments.length){return this._xFacetTitle
}this._xFacetTitle=ad;
return this
};
ac.yFacetTitle=function(ad){if(!arguments.length){return this._yFacetTitle
}this._yFacetTitle=ad;
return this
};
ac.xOuterScale=function(ad){if(!arguments.length){return this._xScale
}this._xScale=ad;
return this
};
ac.yOuterScale=function(ad){if(!arguments.length){return this._yScale
}this._yScale=ad;
return this
};
ac.xScale=function(ae){var ad=0;
if(ae&&ae.hasOwnProperty("x-index")){ad=ae["x-index"]
}return this._xScale.innerScaleGroup()[ad]
};
ac.yScale=function(ae){var ad=0;
if(ae&&ae.hasOwnProperty("y-index")){ad=ae["y-index"]
}return this._yScale.innerScaleGroup()[ad]
};
ac.facet=function(ad){if(!arguments.length){return this._facet
}this._facet=ad;
this._trainedScales={};
return this
};
return ac
});
dv.facet=dv.extend(function(){function ac(){this._numColumns=0;
this._numRows=0;
this._hGap=10;
this._vGap=10
}ac._prerender=function(){var ad=this;
this._trainedScales={};
this._panels=[];
this._rows=[];
this._columns=[];
this._panelsWithAxisLabels=[];
dv.util.each(ad._chart._layers,function(ae){ae._prerender(ad._chart);
ad._trainFacetGroups(ae)
});
this._configureFacets();
dv.util.each(ad._chart._layers,function(ae){ae._nestData=ad._nestFacet(ae);
ae._handlePositions();
ae._trainScales();
ae._createDefaultScales()
});
this._trainScales()
};
ac._trainScales=function(){var ae=this,ad,aj,ah,ag,ai=function(ak){return function(al){return ae._getFacetFromFacetKey(al)!==ak.facetKey()
}
},af=function(ak){return function(an,al,am){if(arguments.length<2){al=0
}if(arguments.length<3){return(this._globalScales[an]===undefined)?null:this._globalScales[an][al]
}if(!this._globalScales[an]){this._globalScales[an]={}
}this._globalScales[an][al]=am;
return am
}
};
this._globalScales={};
this._positionScales={};
dv.util.each(this._panels,function(ak,al){dv.util.each(ae._chart._layers,function(an){for(var ap in an._aes){var aq=an._aes[ap];
for(var ao in aq){var am=an.getScale(ap,ao);
if(!(am instanceof dv.scale.constant)){if(ae._isFree.call(ae,ap)){ad=ae._trainFreeScale(an,ak,ap,ao,ai(ak))
}else{ad=ae._trainScale(an,af(an),ap,ao)
}if(!ak._trainedScales[ap]){ak._trainedScales[ap]={}
}ak._trainedScales[ap][ao]=ad;
aq[ao].domain(ad.domain());
aq[ao].range(ad.range())
}}}})
});
dv.util.each(this._globalScales,function(ak,al){dv.util.each(ak,function(an,am){an.validateDomain();
if(an.reverse()){an.domain(an.domain().reverse())
}})
})
};
ac._isFree=function(af){var ad=af==="x"||af==="xMin"||af==="xMax",ae=af==="y"||af==="yMin"||af==="yMax";
return((ad&&(this._scales==="free"||this._scales==="free_x"))||(ae&&(this._scales==="free"||this._scales==="free_y")))
};
ac._trainScale=function(ag,af,aj,ai,ah){var ad=af.call(this,aj,ai),ae={stack:ag.position()==="stack"&&aj==="y",fill:ag.position()==="fill"&&aj==="y",filter:ah},ak;
if(ad){ak=ag._aes[aj][ai];
ak.domain(ak.calculateDomain(ag._nestData,ae));
ad.unionDomain(ak,ad.reverse());
ad.unionRange(ak.range())
}else{ag._aes[aj][ai].trainDomain(ag._nestData,ae);
ad=ag._aes[aj][ai].copy();
af.call(this,aj,ai,ad)
}return ad
};
ac._render=function(){this._axes=this._chart._axes;
var ae=this._ensureColumnsAndRows();
this._adjustPlotBounds(ae[0],ae[1]);
this._configurePanels(ae[0],ae[1]);
this._axes._initializeAxisRenderers();
this._axes._measureTitles(this._chart._plotBounds);
var ad=this._measureMargins(ae[0],ae[1]);
this._layoutPanels(ae[0],ae[1],ad);
this._renderAxisTitles();
this._renderPanels()
};
ac._setVisibleAxisLabelOrientations=function(ae,ad,ai,ah){var aj=ae.rowIndex(),ag=ae.columnIndex(),af={left:ag===0,top:aj===0,right:(ag===ai)||(ae.facetIndex()===(ah-1)),bottom:(aj===ad)||(ag>ai&&aj===ad-1)};
ae.visibleAxisLabelOrientations(af)
};
ac._changeScaleRangeToLocal=function(ad){var ae=ad.range(),af=ad.innerScaleGroup();
for(var ag in af){dv.util.scaleRange(af[ag],[ae[0],ae[1]]).applyRangePadding()
}return af
};
ac._measureMargins=function(am,ak){var aj=this._panels.length,ae=~~((aj-1)/am),ag=(aj-1)%am,at=this._axes._getAllOrientations(),aw={rows:[],cols:[]},af=this._isFree("x"),ar=this._isFree("y"),ap=this,ah=this._panels[0];
if(ah){this._changeScaleRangeToLocal(ah.getOuterScale("x"));
this._changeScaleRangeToLocal(ah.getOuterScale("y"))
}var av=-1;
while(++av<aj){var an=this._panels[av],aq=an.columnIndex(),al=an.rowIndex();
this._setVisibleAxisLabelOrientations(an,ae,ag,aj);
an.margins({left:0,top:0,right:0,bottom:0});
if(al>=aw.rows.length){aw.rows[al]={left:0,top:0,right:0,bottom:0}
}if(aq>=aw.cols.length){aw.cols[aq]={left:0,top:0,right:0,bottom:0}
}this._panelsWithAxisLabels.push(an);
this._axes._measure(an);
var ao=an.margins();
if(at.right!==undefined&&!ar&&(av===(aj-1)&&aq<am-1)){ao.right=0
}if(at.bottom!==undefined&&!af&&(aq>=ag&&al===ae-1)){ao.bottom=0
}for(var au in aw){var ai=au==="rows"?al:aq;
var ad=aw[au][ai];
ad.left=Math.max(ao.left,ad.left);
ad.top=Math.max(ao.top,ad.top);
ad.right=Math.max(ao.right,ad.right);
ad.bottom=Math.max(ao.bottom,ad.bottom)
}}return aw
};
ac._layoutPanels=function(ak,ar,ag){var al=this._chart._plotBounds,ap=(al.right-al.left)-(ak-1)*this._hGap,ad=(al.bottom-al.top)-(ar-1)*this._vGap,af,an,ao={x:0,y:0},aq=this,ah,ae;
ah=-1;
ae=ag.cols.length;
while(++ah<ae){ap-=ag.cols[ah].left+ag.cols[ah].right
}ah=-1;
ae=ag.rows.length;
while(++ah<ae){ad-=ag.rows[ah].bottom+ag.rows[ah].top
}af=Math.max(ap/ak,0);
an=Math.max(ad/ar,0);
var am=this._chart._chartContainer.select(".axes-labels");
var aj=am.selectAll(".panel-labels").data(this._panelsWithAxisLabels);
aj.enter().append("div");
aj.exit().remove();
aj.attr("class",function(au,at){return"panel-labels panel-"+au.facetIndex()
});
var ai=this._chart._panelContainer.selectAll(".panel").data(this._panels);
ai.enter().append("g").classed("panel",true);
ai.exit().remove();
ai.each(function(au,at){aq._drawPanel.call(this,aq,au,at,al,ag,af,an,ak,ar,ao);
aq._axes._render.call(aq._axes,d3.select(this),am.select(".panel-labels.panel-"+au.facetIndex()),au)
})
};
ac._renderAxisTitles=function(){var ad=this.getColumn(0)[0].bounds(),aj=this.getRow(0)[0].bounds(),ai=this.getColumn(this._columns.length-1)[0].bounds(),ag=this.getRow(this._rows.length-1)[0].bounds(),ae=(ag.bottom-aj.top)/2+aj.top,af=(ai.right-ad.left)/2+ad.left,ah=this._chart.plotBounds();
this._axes._renderTitles(ah,{left:[ah.left,ae],right:[ah.right,ae],top:[af,ah.top],bottom:[af,ah.bottom]})
};
ac._renderPanels=function(){var af=this._chart,ag=af._plotBounds,ai=af._g.select(".plot"),aj=af._plotBounds;
var ad=function(ak){ak.attr("transform","translate(0,0)").each(function(al){if(this.__previousData__&&(this.__previousData__._dataPointStyleClass!=al._dataPointStyleClass)){this.__previousData__.exit(this)
}al._render(this);
this.__previousData__=al
})
};
var ae=function(ak){ak.each(function(al){al.exit(this,function(){ak.remove()
})
})
};
var ah=ai.selectAll(".geom").data(af._layers);
ah.exit().call(ae);
ah.enter().append("g").classed("geom",true);
ah.call(ad)
};
ac._updatePanelTitle=function(au,ap,af,ah,an,ae,ar){var am={left:0,top:0,width:0,height:0},ag=d3.select(this);
if(dv.util.isUndefined(ap)){au._removePanelTitle.call(this,af);
return am
}var ao=ag.selectAll(".panel-title."+af).data([0]);
var aq=ao.enter().append("g").classed("panel-title "+af,true).attr("transform","translate("+ah+","+an+")");
var ai=aq.append("rect").classed("panel-title-bg",true);
var al=aq.append("text").classed("panel-title-label",true).attr("text-anchor","middle");
if(dv.ANIMATION){ao.transition().duration(au._chart._duration).attr("transform","translate("+ah+","+an+")")
}else{ao.attr("transform","translate("+ah+","+an+")")
}var ak=ao.selectAll(".panel-title-label").text(ap);
var aj=ao.selectAll(".panel-title-bg");
var ad=ak.node().getBBox(),at=0;
if(dv.ANIMATION){ak=ak.transition().duration(au._chart._duration);
aj=aj.transition().duration(au._chart._duration)
}switch(af){case"top":x=ae/2;
y=ad.height;
am.left=0;
am.top=0;
am.width=ae;
am.height=ad.height+6;
break;
case"right":x=ar/2;
y=-ae+ad.height;
am.left=ae-(ad.height+6);
am.top=0;
am.width=ad.height+6;
am.height=ar;
at=90;
break;
case"bottom":x=ae/2;
y=ar-6;
am.left=0;
am.top=ar-(ad.height+6);
am.width=ae;
am.height=ad.height+6;
break;
case"left":x=-ar/2;
y=0+(ad.height);
am.left=0;
am.top=0;
am.width=ad.height+6;
am.height=ar;
at=270;
break
}ai.attr("x",am.left).attr("y",am.top).attr("width",am.width).attr("height",am.height);
al.attr("transform","rotate("+at+" 0,0)").attr("x",x).attr("y",y);
ak.attr("transform","rotate("+at+" 0,0)").attr("x",x).attr("y",y);
aj.attr("x",am.left).attr("y",am.top).attr("width",am.width).attr("height",am.height);
return am
};
ac._removePanelTitle=function(ad){d3.select(this).selectAll(".panel-title."+ad).remove()
};
ac._updatePanelBackground=function(ai,ah,ag,af,ad){var ae=d3.select(this).selectAll(".plot-bg").data([0]);
ae.enter().append("rect").classed("plot-bg",true).style("opacity",0.000001).attr("x",ah).attr("y",ag).attr("width",af).attr("height",ad);
if(dv.ANIMATION){ae=ae.transition().duration(ai._chart._duration)
}ae.attr("x",ah).attr("width",af).attr("height",ad).style("opacity",1)
};
ac._addToCollection=function(ad,af,ae){if(!ad[af]){ad[af]=[]
}ad[af].push(ae)
};
ac.getPanel=function(ad){return this._panels&&ad<this._panels.length?this._panels[ad]:null
};
ac.getRow=function(ad){return this._rows[ad]
};
ac.getColumn=function(ad){return this._columns[ad]
};
ac.getTrainedScale=function(ad){if(this._panels.length>0){return this.getPanel(0).getTrainedScale(ad)
}return this._trainedScales[ad]
};
ac.scales=function(ad){if(!arguments.length){return this._scales
}this._scales=ad;
return this
};
ac.space=function(ad){if(!arguments.length){return this._space
}this._space=ad;
return this
};
ac.titleFormat=function(ad){if(!arguments.length){return this._titleFormat
}this._titleFormat=d3.functor(ad);
return this
};
ac.hGap=function(ad){if(!arguments.length){return this._hGap
}this._hGap=ad;
return this
};
ac.vGap=function(ad){if(!arguments.length){return this._vGap
}this._vGap=ad;
return this
};
ac.chart=function(ad){if(!arguments.length){return this._chart
}this._chart=ad;
return this
};
return ac
});
dv.facet.scale=dv.extend(function(){function ac(){}ac.domain=function(){return this._innerScale.domain()
};
ac.range=function(ad){if(!arguments.length){return this._range
}this._range=ad;
return this
};
ac._applyPercentage=function(ad,ae){return this._range[0]+(this._range[1]-this._range[0])*ad.apply(this._innerScale,ae)
};
ac.mapPropToPercent=function(ae,ad){return this._innerScale.mapPropToPercent(ae)
};
ac.mapValueToPercent=function(ae,ad){return this._innerScale.mapValueToPercent(ae)
};
ac.mapToProp=function(ae,ad){return this._applyPercentage(this._innerScale.mapPropToPercent,[ae,ad])
};
ac.mapValue=function(ae,ad){return this._applyPercentage(this._innerScale.mapValueToPercent,[ae,ad])
};
ac.rangeBand=function(){return this._applyPercentage(this._innerScale.rangeBand)
};
ac.innerScaleGroup=function(ad){if(!arguments.length){return this._innerScaleGroup
}this._innerScaleGroup=ad;
return this
};
return ac
});
dv.facet.wrap=dv.facet.extend(function(){function ac(){this._super();
this._facetScale=null;
this._preferredAspectRatio=1;
this._titleOrientation="top"
}ac._prerender=function(){this._facetScale=dv.scale.ordinal().mapping(this._group).domain([]);
this._super()
};
ac._trainFacetGroups=function(ad){var ae=ad.data()[this._facetScale.mapping()];
if(ae){this._facetScale.domain(this._facetScale.domain().concat(ae))
}};
ac._trainFreeScale=function(af,ad,ai,ag,ah){var ae=function(al,aj,ak){if(arguments.length<2){aj=0
}if(arguments.length<3){if(!ad._trainedScales[al]){return undefined
}return ad._trainedScales[al][aj]
}if(!ad._trainedScales[al]){ad._trainedScales[al]={}
}ad._trainedScales[al][aj]=ak;
return ak
};
return this._trainScale(af,ae,ai,ag,ah)
};
ac._showAllPanelLabelsIfFree=function(){return true
};
ac._configureFacets=function(){this._facetKeys=this._facetScale.domain();
this._facetMap={}
};
ac._nestFacet=function(am){var aq=this,al=am.normalizedData(),ag=dv.util.filterAndZip(al),ap=am.getScale("group"),ae=this._group,ak=this._facetScale.domain(),aj,ao;
if(ap){aj=ap.property();
ao=aj?al[aj]:null
}var ai=-1,af=ag.length;
while(++ai<af){var an=0,ar,ah=ag[ai];
if(ah.data.hasOwnProperty(ae)){an=ak.indexOf(ah.data[ae]);
if(an>=0){ar=ak[an]+""
}}var ad=this._facetMap[an];
if(!ad){ad=dv.panel().facetIndex(an).facetKey(ar).xFacetTitle(ar).facet(this);
this._facetMap[an]=ad;
this._panels.push(ad)
}ah.panel=ad
}return d3.nest().key(function(at){var au="";
au+=(at.data.hasOwnProperty(ae)?at.data[ae]:".")+" ~ ";
au+=(at.hasOwnProperty(aj)?at[aj]:".");
return au
}).sortKeys(function(av,at){var ay=aq._getGroupFromFacetKey(av),ax=aq._getGroupFromFacetKey(at),aw=-1,au=-1;
if(ay!=="."){aw=ao.indexOf(ay);
if(aw<0){aw=ao.indexOf(Number(ay))
}}if(ax!=="."){au=ao.indexOf(ax);
if(au<0){au=ao.indexOf(Number(ax))
}}return au<aw?1:-1
}).entries(ag)
};
ac._getGroupFromFacetKey=function(ad){return(/.* ~ (.*)/g).exec(ad)[1]
};
ac._getFacetFromFacetKey=function(ad){return(/(.*) ~ .*/g).exec(ad)[1]
};
ac._ensureColumnsAndRows=function(){var ah=this._panels.length,ai=Math.min(this._numColumns,ah),ag=Math.min(this._numRows,ah);
if(ai<1&&ag<1){var aj=this._chart._plotBounds,af=aj.right-aj.left,ae=aj.bottom-aj.top,ad=Math.min(ah,Math.ceil(Math.sqrt((ah*1*af)/(ae*this._preferredAspectRatio))));
ad=isNaN(ad)?1:ad;
return[ad,Math.ceil(ah/ad)]
}if(ai<1&&ag>=1){ai=Math.ceil(ah/ag)
}if(ai>=1&&ag<1){ag=Math.ceil(ah/ai)
}return[ai,ag]
};
ac._adjustPlotBounds=function(ae,ad){return
};
ac._configurePanels=function(am,ar){var ap=this._chart._plotBounds,aj=ap.right-ap.left,ak=ap.bottom-ap.top,ag=(aj-((am-1)*this._hGap))/am,aq=(ak-((ar-1)*this._vGap))/ar;
var ah=-1,af=this._panels.length;
while(++ah<af){var ad=this._panels[ah],ae=dv.facet.scale().innerScaleGroup(ad._trainedScales.x),ao=dv.facet.scale().innerScaleGroup(ad._trainedScales.y),ai=ah%am,al=~~(ah/am),an={left:0,top:0,right:ag,bottom:aq,width:ag,height:aq};
this._panels[ah].xOuterScale(ae).yOuterScale(ao).columnIndex(ai).rowIndex(al).bounds(an);
this._addToCollection(this._rows,al,ad);
this._addToCollection(this._columns,ai,ad)
}};
ac._drawPanel=function(ap,au,ar,al,at,av,ah,ak,ai,ag){var aq=au.columnIndex(),aj=au.rowIndex(),an=at.rows[aj],am=at.cols[aq],ae=ap._titleOrientation;
if(aq===0){ag.x+=al.left;
if(aj===0){ag.y+=al.top
}}var ao=ag.y+an.top,af=ag.x+am.left,aw=(ap._titleFormat?ap._titleFormat.call(this,au.xFacetTitle(),ar):au.xFacetTitle());
var ad=ap._updatePanelTitle.call(this,ap,aw,ae,af,ao,av,ah);
au.bounds({width:av,height:ah,top:ao+(ae==="top"?ad.height:0),left:af+(ae==="left"?ad.width:0),right:af+av+(ae==="right"?-ad.width:0),bottom:ao+ah+(ae==="bottom"?-ad.height:0)});
ap._updatePanelBackground.call(this,ap,af,ao,av,ah);
if(aq===ak-1){ag.x=0;
ag.y+=an.top+ah+an.bottom+ap._vGap
}else{ag.x+=am.left+av+am.right+ap._hGap
}};
ac.group=function(ad){if(!arguments.length){return this._group
}this._group=ad;
return this
};
ac.numColumns=function(ad){if(!arguments.length){return this._numColumns
}this._numColumns=ad;
return this
};
ac.numRows=function(ad){if(!arguments.length){return this._numRows
}this._numRows=ad;
return this
};
ac.preferredAspectRatio=function(ad){if(!arguments.length){return this._preferredAspectRatio
}this._preferredAspectRatio=ad;
return this
};
return ac
});
dv.facet.grid=dv.facet.extend(function(){function ac(){this._super();
this._xFacetScale=null;
this._yFacetScale=null
}ac._prerender=function(){this._xFacetScale=dv.scale.ordinal().mapping(this._xGroup).domain([]);
this._yFacetScale=dv.scale.ordinal().mapping(this._yGroup).domain([]);
this._super()
};
ac._trainFacetGroups=function(ad){var af=ad.data()[this._xFacetScale.mapping()];
if(af){this._xFacetScale.domain(this._xFacetScale.domain().concat(af))
}var ae=ad.data()[this._yFacetScale.mapping()];
if(ae){this._yFacetScale.domain(this._yFacetScale.domain().concat(ae))
}};
ac._trainFreeScale=function(ag,ad,aj,ah,ai){var ae=this;
var af=function(ap,an,ao){if(arguments.length<2){an=0
}if(!ae._positionScales[ap]){ae._positionScales[ap]={}
}var ak=ae._positionScales[ap];
if(!ak[an]){ak[an]=[]
}var am=ak[an],al=(ap.indexOf("x")>=0)?ad.columnIndex():ad.rowIndex();
if(arguments.length<3){return am[al][an]
}am[al][an]=ao;
return ao
};
return this._trainScale(ag,af,aj,ai)
};
ac._showAllPanelLabelsIfFree=function(){return false
};
ac._configureFacets=function(){var aj,ag,af=this._xFacetScale.domain(),ak=this._yFacetScale.domain(),al;
this._numColumns=Math.max(this._xFacetScale.domain().length,1);
this._numRows=Math.max(this._yFacetScale.domain().length,1);
var ai=-1,ae=this._numRows,an=0;
while(++ai<ae){yFacetIndex=ai;
if(ak&&ak.length>ai){ag=ak[ai]
}var ah=-1,am=this._numColumns;
while(++ah<am){xFacetIndex=ah;
if(af&&af.length>ah){aj=af[ah]
}al=(ak.length?ag:".")+" ~ "+(af.length?aj:".");
var ad=dv.panel().facetIndex(an++).facetKey(al).columnIndex(xFacetIndex).rowIndex(yFacetIndex).xFacetTitle(aj).yFacetTitle(ag).facet(this);
this._panels.push(ad);
this._addToCollection(this._rows,yFacetIndex,ad);
this._addToCollection(this._columns,xFacetIndex,ad)
}}};
ac._nestFacet=function(ao){var ar=this,an=ao.normalizedData(),ai=dv.util.filterAndZip(an),aq=ao.getScale("group"),af=this._xFacetScale.domain(),am=this._yFacetScale.domain(),al,ap;
if(aq){al=aq.property();
ap=al?an[al]:null
}var ak=-1,ag=ai.length;
while(++ak<ag){var aj=ai[ak],ae=0,ah=0;
if(aj.data.hasOwnProperty(this._xGroup)){ah=af.indexOf(aj.data[this._xGroup]);
if(ah<0){ah=0
}}if(aj.data.hasOwnProperty(this._yGroup)){ae=am.indexOf(aj.data[this._yGroup]);
if(ae<0){ae=0
}}panelIndex=(ae*this._numColumns)+ah;
var ad=this._panels[panelIndex];
aj.panel=ad
}return d3.nest().key(function(at){var au="";
au+=(at.data.hasOwnProperty(ar._yGroup)?at.data[ar._yGroup]:".")+" ~ ";
au+=(at.data.hasOwnProperty(ar._xGroup)?at.data[ar._xGroup]:".")+" ~ ";
au+=(at.hasOwnProperty(al)?at[al]:".");
return au
}).sortKeys(function(av,at){var ay=ar._getGroupFromFacetKey(av),ax=ar._getGroupFromFacetKey(at),aw=-1,au=-1;
if(ay!=="."){aw=ap.indexOf(ay);
if(aw<0){aw=ap.indexOf(Number(ay))
}}if(ax!=="."){au=ap.indexOf(ax);
if(au<0){au=ap.indexOf(Number(ax))
}}return au<aw?1:-1
}).entries(ai)
};
ac._getGroupFromFacetKey=function(ad){return(/.* ~ .* ~ (.*)/g).exec(ad)[1]
};
ac._getFacetFromFacetKey=function(ad){return(/(.* ~ .*) ~ .*/g).exec(ad)[1]
};
ac._ensureColumnsAndRows=function(){return[this._numColumns,this._numRows]
};
ac._adjustPlotBounds=function(ag,af){var ad=this._measureTitles(this._xFacetScale.domain(),"temp-column-titles",this._chart._g)+3,ae=this._measureTitles(this._yFacetScale.domain(),"temp-row-titles",this._chart._g)+3,ah=this._chart._plotBounds;
this._xTitleHeight=ad;
this._yTitleWidth=ae;
this._chart._plotBounds.top+=ad;
this._chart._plotBounds.right-=ae
};
ac._measureTitles=function(ae,ad,ag){var ai=this._createTitlesContainer(ad,this._chart._g);
var af=ai.selectAll(".panel-title").data(ae);
af.enter().append("text").text(function(ak,aj){return ak
});
var ah=ai.node().getBBox();
ai.remove();
return ah.height
};
ac._createTitlesContainer=function(ae,ad){var af=ad.selectAll("."+ae).data([0]);
af.enter().append("g").classed(ae,true);
af.exit().remove();
return af
};
ac._configurePanels=function(an,at){var aq=this._chart._plotBounds,al=aq.right-aq.left,am=aq.bottom-aq.top,ah=(al-((an-1)*this._hGap))/an,ar=(am-((at-1)*this._vGap))/at,af=0,ak=0,aj=0;
var ai=-1,ag=this._panels.length;
while(++ai<ag){var ad=this._panels[ai],ae=dv.facet.scale().innerScaleGroup(ad._trainedScales.x),ap=dv.facet.scale().innerScaleGroup(ad._trainedScales.y),ao={left:0,top:0,right:0+ah,bottom:0+ar,width:ah,height:ar};
this._panels[ai].xOuterScale(ae).yOuterScale(ap).bounds(ao);
af+=ah+this._hGap;
aj++;
if(aj>=an){af=0;
ak+=ar+this._vGap;
aj=0
}}};
ac._drawPanel=function(ar,aj,ah,am,ag,af,ap,al,at,aq){var ao=aj.columnIndex(),ak=aj.rowIndex(),an=ag.rows[ak],ad=ag.cols[ao];
aq.x+=ad.left;
if(ao===0){aq.x+=am.left
}if(ak===0){var ae=(ar._titleFormat?ar._titleFormat.call(this,aj.xFacetTitle(),ah):aj.xFacetTitle());
aq.y=an.top+am.top;
ar._updatePanelTitle.call(this,ar,ae,"top",aq.x,aq.y-ar._xTitleHeight,af,ap)
}else{ar._removePanelTitle.call(this,"top")
}if(ao===ar._numColumns-1){var ai=(ar._titleFormat?ar._titleFormat.call(this,aj.yFacetTitle(),ah):aj.yFacetTitle());
ar._updatePanelTitle.call(this,ar,ai,"right",aq.x+ar._yTitleWidth,aq.y,af,ap)
}else{ar._removePanelTitle.call(this,"right")
}aj.bounds({width:af,height:ap,top:aq.y,left:aq.x,right:aq.x+af,bottom:aq.y+ap});
ar._updatePanelBackground.call(this,ar,aq.x,aq.y,af,ap);
aq.x+=af+ad.right+ar._hGap;
if(ao===ar._numColumns-1){aq.x=0;
aq.y+=an.top+ap+an.bottom+ar._vGap
}};
ac.xGroup=function(ad){if(!arguments.length){return this._xGroup
}this._xGroup=ad;
return this
};
ac.yGroup=function(ad){if(!arguments.length){return this._yGroup
}this._yGroup=ad;
return this
};
ac.aggregate=function(ad){if(!arguments.length){return this._aggregate
}this._aggregate=ad;
return this
};
return ac
});
dv.chart=dv.container.extend(function(){function ac(){this._super();
this._firstRender=false;
this._data={};
this._coord=dv.coord.cartesian();
this._facet=dv.facet.wrap().chart(this);
this._layers=[];
this._behaviors=[];
this._legends=dv.guide.legends();
this._axes=dv.guide.axes()._chart(this);
this._delay=d3.functor(0);
this._duration=d3.functor(1000);
this._ease="cubic-in-out";
this._parent=null;
this._chartContainer=null;
this._svgContainer=null;
this._g=null;
this._axisLabelContainer=null;
this._panelContainer=null;
this._interactionGroup=null;
this._prerenderFunc=null;
this._postrenderFunc=null;
this._clipPlot=false;
this._width=NaN;
this._height=NaN;
this._plotWidth=NaN;
this._plotHeight=NaN;
this._calcWidth=NaN;
this._calcHeight=NaN;
this._calcPlotWidth=NaN;
this._calcPlotHeight=NaN;
this._defaultPadding=this._padding=this._plotBounds=this._guidesBounds={top:0,left:0,right:0,bottom:0};
this._position="identity"
}ac.render=function(){if(dv.util.isUndefined(this._data)||dv.util.isEmpty(this._data)){for(var ad=0;
ad<this._layers.length;
ad++){if(dv.util.isUndefined(this._layers[ad]._data)||dv.util.isEmpty(this._layers[ad]._data)){dv.log.error({msg:"Cannot render a chart with no data provided.",data:{chartData:this._data,geom:this._layers[ad]}})
}}}this._resolvePercentDimensions();
this._createChartContainer();
this._prerender();
this._renderLegends();
if(this._prerenderFunc){this._prerenderFunc.call(this)
}this._facet._render();
if(this._postrenderFunc){this._postrenderFunc.call(this)
}this._renderBehaviors();
this._clipGeoms();
this._cleanupGuides();
this.unregisterEventMap=null;
return this
};
ac._resolvePercentDimensions=function(){this._calcWidth=dv.util.getPercentValue(this._width,this._parent.node().offsetWidth);
this._calcHeight=dv.util.getPercentValue(this._height,this._parent.node().offsetHeight);
if(!dv.util.isFinite(this._calcWidth)){this._calcPlotWidth=dv.util.getPercentValue(this._plotWidth,this._parent.node().offsetWidth);
if(!dv.util.isFinite(this._calcPlotWidth)){this._calcWidth=this._parent.node().offsetWidth
}}else{this._calcPlotWidth=dv.util.getPercentValue(this._plotWidth,this._calcWidth)
}if(!dv.util.isFinite(this._calcHeight)){this._calcPlotHeight=dv.util.getPercentValue(this._plotHeight,this._parent.node().offsetHeight);
if(!dv.util.isFinite(this._calcPlotHeight)){this._calcHeight=this._parent.node().offsetHeight
}}else{this._calcPlotHeight=dv.util.getPercentValue(this._plotHeight,this._calcHeight)
}};
ac._finalizePlotBounds=function(){var ag=this._legends._allowedDimensions(),ae=this._legends._getWidth(),af=this._legends._getHeight(),ad={left:Math.max(ag.left,this._padding.left),top:Math.max(ag.top,this._padding.top)};
if(!dv.util.isFinite(this._calcWidth)){this._calcWidth=this._calcPlotWidth+ae+this._padding.left+this._padding.right
}else{if(!dv.util.isFinite(this._calcPlotWidth)){this._calcPlotWidth=this._calcWidth-this._padding.left-this._padding.right-ae
}}if(!dv.util.isFinite(this._calcHeight)){this._calcHeight=this._calcPlotHeight+af+this._padding.top+this._padding.bottom
}else{if(!dv.util.isFinite(this._calcPlotHeight)){this._calcPlotHeight=this._calcHeight-this._padding.top-this._padding.bottom-af
}}this._calcPlotWidth=Math.min(this._calcPlotWidth,this._calcWidth-this._padding.left-this._padding.right-ae);
this._calcPlotHeight=Math.min(this._calcPlotHeight,this._calcHeight-this._padding.top-this._padding.bottom-af);
ad.right=ad.left+this._calcPlotWidth;
ad.bottom=ad.top+this._calcPlotHeight;
this.plotBounds(ad);
if(this._coord instanceof dv.coord.cartesian){this._plotBounds.right-=this._coord.endX();
this._plotBounds.left+=this._coord.startX()
}this._chartContainer.style("width",this._calcWidth+"px").style("height",this._calcHeight+"px")
};
ac._prerender=function(){this._trainedScales={};
this._calculateStats();
this._facet._prerender();
var ad=this._normalizeData(this.data());
this.data(ad);
if(!this._axes._get("x")){this._axes._add("x",dv.guide.axis())
}if(!this._axes._get("y")){this._axes._add("y",dv.guide.axis())
}};
ac._createChartContainer=function(){this._chartContainer=this._parent.selectAll(".dv-chart-container").data([0]);
this._chartContainer.enter().append("div").classed("dv-chart-container",true);
this._svgContainer=this._chartContainer.selectAll("svg").data([0]);
this._svgContainer.enter().append("svg").style("height","100%").style("width","100%");
this._g=this._svgContainer.select(".group");
if(this._g.empty()){this._firstRender=true;
this._g=this._svgContainer.append("g").classed("group",true);
this._panelContainer=this._g.append("g").classed("panels",true);
this._interactionGroup=this._g.append("g").classed("interaction-group",true);
this._g.append("g").classed("behavior-under-geom",true);
this._g.append("g").classed("plot",true);
this._g.append("g").classed("behavior",true);
this._g.append("g").classed("legends",true);
this._interactionGroup.append("rect").classed("interaction-canvas",true).classed("background",true)
}if(!this._panelContainer){this._panelContainer=this._g.select(".panels")
}if(!this._interactionGroup){this._interactionGroup=this._g.select(".interaction-group")
}this._axisLabelContainer=this._chartContainer.selectAll(".axes-labels").data([0]);
this._axisLabelContainer.enter().append("div").classed("axes-labels",true)
};
ac._addRegisteredEvents=function(){var ad=this;
dv.util.each(ad.eventMap,function(af,ae){ad._interactionGroup.on(ae,function(){var ah=d3.event,ag=ad._interactionGroup.node();
if(ad._shouldDispatchChartEvent(ah,ag)){ad.eventMap[ae].callback.call(ad._interactionGroup.node(),d3.event)
}},af.capture)
});
dv.util.each(ad._layers,function(ae){ae._addRegisteredEvents()
})
};
ac._removeRegisteredEvents=function(){var ad=this;
dv.util.each(ad.unregisterEventMap,function(ae,af){if(ad._interactionGroup){ad._interactionGroup.on(af,null,ae)
}});
dv.util.each(ad._layers,function(ae){ae._removeRegisteredEvents()
})
};
ac._shouldDispatchChartEvent=function(ah,ae){var ad=true;
if(ah.type==="mouseout"||ah.type==="mouseover"){var ag=d3.select(ah.relatedTarget);
if(ag&&!ag.empty()){var af=ag.attr("class");
ad=!(af&&af.indexOf("-geom")>=0)
}}return ad
};
ac._calculateStats=function(){};
ac._renderLegends=function(){var af=(dv.util.isFinite(this._calcWidth)?this._calcWidth-this._padding.left-this._padding.right:this._calcPlotWidth),ad=(dv.util.isFinite(this._calcHeight)?this._calcHeight-this._padding.top-this._padding.bottom:this._calcPlotHeight),ae={left:this._padding.left,top:this._padding.top,width:af,height:ad},ag={el:this._g,scales:this._facet._globalScales,firstRender:this._firstRender,duration:this._duration,delay:this._delay,ease:this._ease};
this._legends._allowedDimensions(ae)._render(ag);
this._finalizePlotBounds()
};
ac._cleanupGuides=function(){this._legends._empty();
this._axes._empty()
};
ac._setRanges=function(){var af=this.plotBounds(),ae=this.getTrainedScale("y"),ag=this.getTrainedScale("x");
var ad=this.coord().flip()?[af.bottom-af.top,0]:[0,af.right-af.left],ah=this.coord().flip()?[0,af.right-af.left]:[af.bottom-af.top,0];
dv.util.scaleRange(ag,ad);
dv.util.scaleRange(ae,ah)
};
ac.plotBounds=function(ad){if(!arguments.length){return this._plotBounds
}this._plotBounds=ad;
return this
};
ac._renderBehaviors=function(){var ad=this._facet.getPanel(0),ag=ad._bounds,af=this._g.select(".behavior").attr("transform","translate(0,0)"),ah=this._g.select(".behavior-under-geom").attr("transform","translate(0, 0)");
this._interactionGroup.attr("transform","translate(0,0)").select(".interaction-canvas").attr("visibility","hidden").attr("width",ag.right-ag.left).attr("height",ag.bottom-ag.top).attr("x",ag.left).attr("y",ag.top);
var ae=this;
dv.util.each(this._behaviors,function(ai){if(ai.underGeoms&&ai.underGeoms()){ai.chart(ae)._render(ah)
}else{ai.chart(ae)._render(af)
}})
};
ac.guide=function(ak,ad,aj){if(!ak||ak===""){throw new Error("Property argument cannot be null or empty")
}if(ak==="all"){if(ad!=="none"){throw new Error("'all' can only be used to set all guides to 'none' (e.g. turn off all guides)")
}this._legends._hide(true);
this._axes._add("x","none",0);
this._axes._add("y","none",0)
}ak=dv.util.isArray(ak)?ak:[ak];
aj=dv.util.isUndefined(aj)?0:aj;
var ai=dv.guide.legend(),af="";
for(var ae=0;
ae<ak.length;
ae++){var ah=ad,ag=this._isPositionProperty(ak[ae]);
if(!af){af=ag?"axis":"legend"
}else{if(ag&&af!="axis"){throw new Error("Cannot mix positional and non-positional guide types")
}}if(!ah){ah=ag?dv.guide.axis():ai
}else{if(!this._isValidGuideType(ak[ae],ah)&&dv.util.isObject(ah)){ah=this._buildCustomGuide(ah)
}}if(this._isValidGuideType(ak[ae],ah)){if(ah!=="none"){ah.scaleIndex(aj)
}if(ag){this._axes._add(ak[ae],ah,aj)
}else{if(ah!=="none"){this._legends._add({props:ak,guide:ah});
break
}else{this._legends._remove(ak)
}}}}return this
};
ac._isPositionProperty=function(ad){return(ad==="x"||ad==="y")
};
ac._isValidGuideType=function(af,ad){var ae=this._isPositionProperty(af);
return ad&&(ad==="none"||ad instanceof dv.guide.custom)||(ae&&ad instanceof dv.guide.axis)||(!ae&&ad instanceof dv.guide.legend)
};
ac._buildCustomGuide=function(ad){var ae=dv.guide.custom();
for(var af in ad){ae.setFunc(af,ad[af])
}return ae
};
ac.getScale=function(ae,ad){if(arguments.length<2){ad=0
}if(ae==="group"){return this._getGroup()
}if(this._aes.hasOwnProperty(ae)){return this._aes[ae][ad]
}};
ac._getGroup=function(){if(this._aes.hasOwnProperty("group")){return this._aes.group[0]
}var ae=-1,ad=dv.DEFAULT_CATEGORICAL_AES.length-1;
while(ae++<ad){var af=this._aes[dv.DEFAULT_CATEGORICAL_AES[ae]];
if(af&&af[0]&&af[0] instanceof dv.scale.ordinal&&!dv.util.isUndefined(af[0].mapping())){return af[0]
}}return null
};
ac._clipGeoms=function(){var ae=this;
var ag=this._parent.selectAll(".panel").selectAll("defs").data(function(ai){return ae._clipPlot?[ai]:[]
});
ag.enter().append("defs");
ag.exit().remove();
var ad=ag.selectAll("clipPath").data(function(ai){return[ai]
});
ad.enter().append("clipPath").classed("dv-clip",true);
ad.exit().remove();
ad.attr("id",function(ai){return"dv-clip"+ai._facetIndex
});
var ah=ad.selectAll("rect").data(function(ai){return[ai]
});
ah.enter().append("rect");
ah.exit().remove();
ah.attr("x",function(ai){return ai._bounds.left
}).attr("y",function(ai){return ai._bounds.top
}).attr("width",function(ai){return ai._bounds.width
}).attr("height",function(ai){return ai._bounds.height
});
if(ae._clipPlot){var af=this._parent.selectAll(".series");
af.attr("clip-path",function(ak){var aj=ak.values[0],ai=dv.util.isArray(aj)?aj[0].panel:aj.panel;
return"url(#dv-clip"+ai._facetIndex+")"
})
}};
ac.getTrainedScale=function(ad){return this._facet.getTrainedScale(ad)
};
ac.getExplicitScale=function(ae,ad){if(ad===undefined){ad=0
}return this._aes[ae][ad]
};
ac.parent=function(ad){if(!arguments.length){return this._parent?this._parent.node():null
}this._parent=d3.select(ad);
if(this._parent.empty()){throw new Error("The DV parent element was not found.")
}return this
};
ac.layers=function(ad){if(!arguments.length){return this._layers
}this._layers=ad;
return this
};
ac.behaviors=function(ad){if(!arguments.length){return this._behaviors
}this._behaviors=ad;
return this
};
ac.data=function(ad){if(!arguments.length){return this._data
}this._data=ad;
return this
};
ac.coord=function(ad){if(!arguments.length){return this._coord
}this._coord=ad;
return this
};
ac.facet=function(ad){if(!arguments.length){return this._facet
}this._facet=ad;
this._facet.chart(this);
return this
};
ac.getPlotBounds=function(ad){return this._plotBounds
};
ac.plotWidth=function(ad){if(!arguments.length){return this._plotWidth
}this._plotWidth=ad;
return this
};
ac.plotHeight=function(ad){if(!arguments.length){return this._plotHeight
}this._plotHeight=ad;
return this
};
ac.width=function(ad){if(!arguments.length){return this._width
}this._width=ad;
return this
};
ac.height=function(ad){if(!arguments.length){return this._height
}this._height=ad;
return this
};
ac.padding=function(ad){if(!arguments.length){return this._padding
}this._padding=dv.util.merge(this._defaultPadding,ad);
return this
};
ac.prerender=function(ad){if(!arguments.length){return this._prerenderFunc
}this._prerenderFunc=ad;
return this
};
ac.postrender=function(ad){if(!arguments.length){return this._postrenderFunc
}this._postrenderFunc=ad;
return this
};
ac.clipPlot=function(ad){if(!arguments.length){return this._clipPlot
}this._clipPlot=ad;
return this
};
return ac
})
})();
(function(d){var e={},b=d.dv||{},c=d.d3||{};
var a={};
a._options=null;
a._eventMap={};
a._changedOptions=null;
a.init=function(f){this._initDefaultOptions();
this.setOptions(f);
return this
};
a._initDefaultOptions=function(f){var h={dataAdapter:"standard",data:null,height:null,parent:null,width:null,autoResize:false,locale:"en-US",l10n:{}};
if(f){this._mergeOptions(h,f)
}this._options=h;
this._changedOptions={};
for(var g in h){this._changedOptions[g]=h[g]
}return this._options
};
a._mergeOption=function(g,f,h){switch(f){case"mappings":case"formats":g[f]=g[f]||{};
this._mergeOptions(g[f],h);
break;
default:g[f]=h;
break
}return g
};
a._mergeOptions=function(f,h){for(var g in h){this._mergeOption(f,g,h[g])
}return f
};
a._truncateLabel=function(g,h){var f=h||this.X_AXIS_LABEL_MAXLENGTH;
return(g.length>f)?g.substring(0,f)+"...":g
};
a._formatNumber=function(g,o,h){var f="",n,i,p=this._dataAdapter.l10n.numberFormat,m,j,k;
if(g=="currency"||g=="percent"){f=p[g].symbol;
if(o>=0){m=p[g].positivePattern
}else{m=p[g].negativePattern
}}else{if(o>=0){m="{number}"
}else{m=p.negativePattern
}}if(g=="percent"){o*=100
}o=Math.abs(o);
if(o>=100){k=3
}else{if(o>=10){k=(o%1)?3:2
}else{if(o>=1){k=(o%1)?3:1
}else{k=(o%1)?2:1
}}}if(h!=null){var l=c.formatPrefix(o);
j=l.scale(o).toFixed(h)+l.symbol
}else{if(o>=1000&&o<10000){j=c.format(",.0f")(o)
}else{j=c.format("."+k+"s")(o)
}}if(h&&o<Math.pow(10,-h)&&o>0){i=true;
j=Math.pow(10,-h)+""
}else{if(h==null&&o<0.01&&o>0){i=true;
j="0.01"
}}n=m.replace(/\{number\}/i,j).replace(/\{symbol\}/i,f).replace(/,/g,p.groupSeparator).replace(/\./,p.decimalSeparator);
if(i){n="<"+n
}return n
};
a._getPropMapping=function(f){return this._dataAdapter.mappings()[f]
};
a.setOption=function(f,g){if(!(f in this._options)){return false
}if("dataAdapter"===f&&"rs2dv"===g){g="rs"
}if("clickHandler"===f){this.on("click",g)
}this._mergeOption(this._options,f,g);
if(!this._changedOptions){this._changedOptions={}
}this._changedOptions[f]=g;
return true
};
a.getOption=function(g){var f=this._options;
if(g in f){return f[g]
}return null
};
a.setOptions=function(g){for(var f in g){this.setOption(f,g[f])
}};
a._preRender=function(){this._clearErrorMessage();
if("autoResize" in this._changedOptions){this._updateWindowResize()
}if("dataAdapter" in this._changedOptions){var h=this._changedOptions.dataAdapter;
if(!this._dataAdapter||(this._options.dataAdapter!==h)){var g=e.dataAdapter[h];
if(!g){throw new Error("No data adapters were found for data adapter type "+h)
}var f=g[this._type]||g.base||e.dataAdapter.standard.base;
this._dataAdapter=f()
}}this._dataAdapter.process(this._options,this._changedOptions)
};
a._render=function(){};
a._postRender=function(){this._changedOptions={}
};
a.render=function(){this.reset();
this._preRender();
this._render();
this._postRender();
return this
};
a.reset=function(){};
a._updateWindowResize=function(){if(this._options.autoResize){this._autoResizeHandler=this._autoResizeHandler||b.util.bind(this._onAutoResize,this);
e.windowResize.addHandler(this._autoResizeHandler)
}else{e.windowResize.removeHandler(this._autoResizeHandler)
}};
a._onAutoResize=function(){};
a.RESPONSIVE_WIDTH_THRESHOLD=400;
a._isSmallChart=function(f){return f<a.RESPONSIVE_WIDTH_THRESHOLD
};
a.handleError=function(g){var h=this._dataAdapter.l10n;
var f=h.labels.core.erroronrender;
if("invaliddata"===g.code){f=h.labels.core.nodata
}this._setErrorMessage(f);
return this
};
a._setErrorMessage=function(f){if(f&&f.length){c.select(this._options.parent).html('<div class="cv-error">'+f+"</div>")
}else{this._clearErrorMessage()
}};
a._clearErrorMessage=function(){c.select(this._options.parent).select(".cv-error").remove()
};
a.destroy=function(){this.reset();
e.windowResize.removeHandler(this._autoResizeHandler)
};
a.on=function(g,h){var f=h&&b.util.isFunction(h);
if(f){this._eventMap=this._eventMap||{};
this._eventMap[g]=h
}else{if(this._eventMap){delete this._eventMap[g]
}}return this
};
d.cloudViz=e;
e.d3=c;
e.dv=b;
e.rs2dv=d.rs2dv||{};
e.core=a;
e.localeDefinition=function(f,j,i){var k,g,h,l;
f=f.toLowerCase();
e._localeDefinitions=k=e._localeDefinitions||{};
if(arguments.length>1){g=f.split("-");
if(g.length<=1){throw new Error("A registered CloudViz locale must be a hyphenated language culture code (e.g. en-US).")
}h=[f,g[0],g.join("_")];
h.forEach(function(m){if(i==null){k[m]=j
}else{k[m]=k[f]||{};
k[m][i]=j
}})
}else{l=k[f];
if(!l){throw new Error("Locale definition for "+f+" not found.")
}return l
}};
if("function"===typeof define&&define.amd){define(function(){return e
})
}else{if("undefined"===typeof exports){d.cloudViz=e
}else{if("object"!==typeof module||!module.exports){exports.cloudViz=e
}else{module.exports=e
}}}}(this));
(function(a){a.cloudViz.seriesState=function(){var d={},b=[],c={};
d.isSeriesEnabled=function(j,e){if(!b){return true
}var f,g=b.length,h;
for(f=0;
f<g;
f++){h=b[f];
if(h.id===j&&h.type===e){return h.enabled
}}return false
};
d.doesSeriesStateExist=function(j,e){if(!b){return false
}var f,g=b.length,h;
for(f=0;
f<g;
f++){h=b[f];
if(h.id===j&&h.type===e){return true
}}return false
};
d._createStateObject=function(g,i,h,f){var e;
if(arguments.length<3){throw new Error("A state object requires a label and stateType.")
}if(arguments.length<4){f=true
}e={name:g,id:i,type:h,enabled:f};
this.dispatch("create",e);
return e
};
d.insertState=function(f,h,g,e){b.unshift(this._createStateObject.apply(this,arguments))
};
d.appendState=function(f,h,g,e){b.push(this._createStateObject.apply(this,arguments))
};
d.enableStateByIndex=function(f,e){if(f<b.length){var g=b[f];
if(g.enabled!==e){g.enabled=e;
this.dispatch("enableChange",g)
}}};
d.enableStateByTypeAndId=function(j,k,e){var f,g=b.length,h;
for(f=0;
f<g;
f++){h=b[f];
if(h.id===k&&h.type===j){this.enableStateByIndex(f,e)
}}};
d.removeStatesByType=function(f){var e=this;
if(b&&b.length){b=b.filter(function(g){if(g.type===f){e.dispatch("remove",g);
return false
}return true
})
}};
d.on=function(g,j){if(arguments.length<1){throw new Error("series state listeners require an eventType to be specified.")
}var f=g.indexOf("."),e="",h;
if(f>0){e=g.substring(f+1);
g=g.substring(0,f)
}h=c[g]||{};
if(!j){delete h[e]
}else{h[e]=j;
c[g]=h
}};
d.dispatch=function(e,h){var f=c[e];
if(f){for(var g in f){f[g].call(this,e,h)
}}};
d.getStateObjects=function(){return b
};
d.areSomeSeriesDisabled=function(){if(!b){return false
}return(Math.min.apply(null,b.map(function(e){return +e.enabled
}))===0)
};
d.areAllSeriesDisabled=function(){if(!b){return false
}return(Math.max.apply(null,b.map(function(e){return +e.enabled
}))===0)
};
return d
}
})(this);
(function(b){var c=b.cloudViz||{};
var a=c.util=c.util||{};
a.deepExtend=function(e){var d=Array.prototype.slice.call(arguments,1);
var f=-1,j=d.length;
while(++f<j){var g=d[f];
if(g){for(var h in g){if(g[h]&&g[h].constructor&&g[h].constructor===Object){e[h]=e[h]||{};
a.deepExtend(e[h],g[h])
}else{e[h]=g[h]
}}}}return e
};
a.createConstructor=function(d){function e(){var f=Object.create(d);
if("function"==typeof f.init){f.init.apply(f,arguments)
}return f
}e.prototype=d;
return e
};
a.namespace=function(g,f){var e=g.split(".");
var d=f||b;
e.forEach(function(h){var i=d[h];
if(!i){i=d[h]={}
}d=i
});
return d
}
}(this));
(function(e){var f=e.cloudViz||{},a=f.core||{},b=e.dv||{},c=e.d3||{},d=Object.create(a);
d.X_AXIS_LABEL_MAXLENGTH=25;
d.LEGEND_ORIENTATIONS=["top","right","left"];
d._chart=null;
d.clipIdCounter={count:0};
d._legend=null;
d._seriesState=null;
d.init=function(g){Object.getPrototypeOf(d).init.apply(this,arguments);
this._seriesState=f.seriesState();
return this
};
d._initDefaultOptions=function(g){var h={aspectRatio:null,colors:["#8cc350","#5a6eaa","#d755a5","#1ebed7","#f0a01e","#9b8ce6","#3cb5a0","#3287d2","#f0557d","#c3d250","#eb782d","#78b4f5","#5faf69","#aa5fa5","#fa5a50","#f5c841"],dateGranularity:undefined,flip:false,interactive:false,legendOrientation:null,legendVerticalWidth:110,legendVisible:true,targetValues:null,targetLabel:undefined,mappings:{x:"x",y:"y",series:"series",seriesLabel:"series"},plotHeight:null,plotWidth:null,preRender:null,xAxisTitle:"",yAxisTitle:"",precision:null};
if(g){this._mergeOptions(h,g)
}return Object.getPrototypeOf(d)._initDefaultOptions.call(this,h)
};
d.getChart=function(){return this._chart
};
d.enableSeriesByIndex=function(h,g){this._seriesState.enableStateByIndex(h,g)
};
d._highlight=function(h,g){h.classed("cv-highlight",g)
};
d._getYTitleFromLabels=function(h){var g=b.util.uniq(h);
if(g&&g.length===1){return g[0]
}return null
};
d._preRender=function(){Object.getPrototypeOf(d)._preRender.call(this);
try{this._createSeriesStates()
}catch(h){var g=new Error("The chart data is invalid");
g.code="invaliddata";
this.handleError(g)
}};
d._postRender=function(){Object.getPrototypeOf(d)._postRender.call(this);
var h=this._options,g=c.select(h.parent);
this._updateYAxisHitBox(g);
this._colorDualYAxes(h,g)
};
d._removeYAxisHitBox=function(g){g.selectAll(".axis-y .cv-axis-hitbox").remove()
};
d._colorDualYAxes=function(h,g){if(h.dualYAxis&&(!this._isNormalized||!this._isNormalized())&&(this._options.position==="identity"||this._options.position==="dodge")){g.selectAll(".axis-y.axis-index-0 span").style("color",h.colors[0]);
g.selectAll(".axis-y.axis-index-1 span").style("color",h.colors[1]);
g.selectAll(".axis-title-y.axis-title-index-0").style("color",h.colors[0]);
g.selectAll(".axis-title-y.axis-title-index-1").style("color",h.colors[1])
}};
d._createSeriesStates=function(){var k=this._options;
if("data" in this._changedOptions&&this._changedOptions.data){this._seriesState.removeStatesByType("standard");
var h=this._dataAdapter.data()[this._getPropMapping("series")],m=this._dataAdapter.data()[this._getPropMapping("seriesLabel")];
if(h){var j=h.reduce(function(o,q,p){if(o.ids.indexOf(q)<0){o.ids.push(q);
o.names.push(m?m[p]:q)
}return o
},{names:[],ids:[]}),l=j.ids.length;
while(l--){var g=j.names[l],n=j.ids[l];
this._seriesState.insertState(g||n,n,"standard")
}}}if("targetValues" in this._changedOptions){if(k.targetValues){this._seriesState.removeStatesByType("target");
this._seriesState.appendState(k.targetLabel||this._dataAdapter.l10n.labels.dvcore.target,"target","target")
}}};
d._createTargetHLines=function(){var q=this._options,n=this._chart,p=this;
if(q.targetValues&&q.targetValues.length){var h=n.layers(),o=b.geom.hline(),l=p._seriesState.isSeriesEnabled("target","target"),j={y:[],name:[]},k,g=q.targetValues.length,m=[0,this._isSmallChart()?24:6];
for(k=0;
k<g;
k++){j.y.push(q.targetValues[k])
}o.data(j).position("identity").map("y","y",b.scale.linear().includeInDomain(function(){if(!p._valuesAreFilterable()){return true
}return l
}).rangePadding(m)).each("start",function(s,r){c.select(this).attr("legend-type","target")
});
if(this._type==="line"){h.unshift(o)
}else{h.push(o)
}n.layers(h)
}};
d._updateYAxisHitBox=function(o){var q=this,s=this._options,h=this._chart.facet().getPanel(0);
if(h){var l=this._isSmallChart(),p=this._isNormalized&&this._isNormalized(),j=this._chart.getTrainedScale("y"),i=j&&j.naturalDomain()[0]<=0,k=h.bounds().left,n=j.range()[1],g=j.range()[0],m=o.selectAll(".axes-labels .axis-y.axis-index-0"),r=m.selectAll(".cv-axis-hitbox").data([0]);
if(s.interactive&&!l&&!p&&!i&&s.position==="identity"){r.enter().append("div").classed("cv-axis-hitbox",true);
r.on("click",function(){if(s.interactive&&!l){q._dataAdapter._forceZero=!q._dataAdapter._forceZero;
q._render(true);
q._postRender()
}});
if(this._legend!=="none"&&this._legend.isVertical()){k-=this._legend._getUsedWidth()
}r.style("width",k+"px").style("height",(g-n)+"px").style("top",n+"px").style("left",(-k)+"px");
r.exit().on("click",null)
}else{this._removeYAxisHitBox(o)
}}else{this._removeYAxisHitBox(o)
}};
d._render=function(g){Object.getPrototypeOf(d)._render.apply(this,arguments);
var i=this._options,h;
try{if(!this._dataAdapter.isDataValid()){h=new Error("The chart data is invalid");
h.code="invaliddata";
throw h
}if(!i.parent){throw new Error("The chart options did not contain a parent")
}return this._draw(g)
}catch(j){this.handleError(j)
}};
d.reset=function(){Object.getPrototypeOf(d).reset.apply(this,arguments)
};
d.destroy=function(){Object.getPrototypeOf(d).destroy.apply(this,arguments);
if(this._options&&this._options.parent){c.select(this._options.parent).select(".cv-wrapper").remove()
}return this
};
d._isMappedAndExistsInData=function(h){var g=this._getPropMapping(h);
return g&&this._options.data[g]
};
d._setChartCoreOptions=function(){var o=this._options,i=this._chart,n=this,l=o.aspectRatio,h=o.width,m=o.height,k=c.select(o.parent);
i.data(this._dataAdapter.data()).width((l!==null&&m!==null)?m*l:h).height((l!==null&&h!==null)?h/l:m);
if(!this._isSmallChart()){var j={left:10};
if(o.dualYAxis){j.right=10
}i.padding(j)
}var g=k.selectAll(".cv-wrapper").data([0]);
g.enter().insert("div",":first-child").classed("cv-wrapper",true);
g.classed({interactive:o.interactive,"right-overflow":(this._adjustClipWidth),"cv-small-chart":(this._isSmallChart())});
i.parent(g.node());
this._legend=this._buildLegend();
this._seriesState.on("enableChange.paths",function(p,q){n._preRender();
n._render(true);
n._postRender();
setTimeout(function(){n._updatePathStates()
},10)
})
};
d._draw=function(g){var j=this._chart,i=this._options,h=(g===undefined)?false:g;
if(!j){throw new Error("DV Chart was not created")
}this._setChartCoreOptions();
this._setChartTypeOptions();
this._createTargetHLines();
if(this._isSmallChart()){this._drawSmall()
}else{this._drawLarge()
}if(!h){j.duration(0)
}else{j.duration(1000)
}this._renderChart();
return this
};
d._drawBackground=function(){var j=this._options;
if(j.interactive){var o=c.select(j.parent).select(".cv-wrapper"),i=o.selectAll(".cv-bg").data([0]);
i.enter().insert("div",":first-child").classed("cv-bg",true);
var q=this._chart,h=c.select(j.parent).select(".cv-legend"),t=((this._legend!=="none"&&this._legend.isVertical())||!h[0][0])?0:1,z=1,p=q.padding(),k=q.facet().getPanel(q.facet()._panels.length-1).bounds(),n=q.plotBounds(),m=this._chart._legends&&this._chart._legends.hasOwnProperty("_w")?this._chart._legends._w:0,l=n.top-t-p.top,v=q._calcWidth-m,s=(k.top+k.height)-n.top+t+p.top;
i.style("top",l+"px").style("left",m+"px").style("height",(s+z)+"px").style("width",v+"px");
if(this._legend!=="none"&&this._legend.isVertical()){var w=1,u=c.select(j.parent).selectAll(".cv-legend"),r=h[0][0]&&u.node().offsetHeight||0,g=(r>=s-w);
u.style("height",g?(s-w)+"px":null).classed("clipped",g)
}}};
d._drawClipping=function(){var m=this._chart,t=this._options,l=c.select(m._svgContainer[0][0]),k=l.selectAll("defs").data([0]);
k.enter().insert("defs",":first-child");
var h="cv-clip"+(this.clipIdCounter.count++),j=k.selectAll(".cv-clip").data([0]);
j.enter().append("clipPath").classed("cv-clip",true).append("rect");
j.attr("id",h);
var o=j.selectAll("rect"),q=m.padding(),i=m.facet().getPanel(m.facet()._panels.length-1).bounds(),r=m.plotBounds(),p=r.left-q.left,n=r.top,g=r.right-p+q.right,s=(i.top+i.height)-r.top;
if(t.interactive){g-=1;
s-=1
}if(this._adjustClipHeight){s+=this._adjustClipHeight
}if(this._adjustClipWidth){g+=this._adjustClipWidth
}o.attr("x",p).attr("y",n).attr("width",Math.max(g,0)).attr("height",Math.max(s,0));
l.selectAll(".geom").attr("clip-path",null);
l.selectAll(".geom:not(.no-clip)").attr("clip-path","url(#"+h+")")
};
d._renderChart=function(){var g=this,h=this._options;
if("function"==typeof h.preRender){h.preRender(this.getChart())
}this._chart.render();
this._drawBackground();
this._drawClipping();
setTimeout(function(){g._updatePathStates()
},10)
};
d._onAutoResize=function(){this._draw(false)
};
d._setChartTypeOptions=function(){};
d._drawSmall=function(g){};
d._drawLarge=function(g){};
d._isSmallChart=function(){return Object.getPrototypeOf(d)._isSmallChart.apply(this,[this._getChartWidth()])
};
d._getChartWidth=function(){var g=this._options;
if(g.plotWidth!==null&&!b.util.isPercentString(g.plotWidth)){return g.plotWidth
}else{if(g.width!==null&&!b.util.isPercentString(g.width)){return g.width
}}var i=c.select(g.parent).node().offsetWidth;
var h=c.select(g.parent).node().offsetHeight;
if(g.plotWidth!==null){return parseInt(g.plotWidth,10)/100*i
}else{if(g.width!==null){return parseInt(g.width,10)/100*i
}else{return(g.aspectRatio!==null&&h!==null)?h*g.aspectRatio:i
}}};
d._getChartHeight=function(){var g=this._options;
if(g.plotHeight!==null&&!b.util.isPercentString(g.plotHeight)){return g.plotWidth
}else{if(g.height!==null&&!b.util.isPercentString(g.height)){return g.height
}}var i=c.select(g.parent).node().offsetWidth;
var h=c.select(g.parent).node().offsetHeight;
if(g.plotHeight!==null){return parseInt(g.plotHeight,10)/100*h
}else{if(g.height!==null){return parseInt(g.height,10)/100*h
}else{return(g.aspectRatio!==null&&i!==null)?i/g.aspectRatio:h
}}};
d._constructScale=function(h,j){var i=j||b.scale.linear(),g=this._options;
if(g.interactive){i=this._adjustLimits(i)
}if(h==="y"&&this._dataAdapter._forceZero){this._applyForceZero(i)
}return i
};
d._applyForceZero=function(g){g.lowerLimit(function(i,h){return i<0?i:0
});
g.upperLimit(function(i,h){return h>0?h:0
});
return g
};
d._adjustLimits=function(i){var g=this,h=this._options;
i.includeInDomain(function(k,j){if(!g._valuesAreFilterable()){return true
}return g._seriesState.isSeriesEnabled(k.data[g._legend.mapping()],"standard")
});
return i
};
d._valuesAreFilterable=function(){return(this._options.interactive&&this._seriesState.areSomeSeriesDisabled()&&!this._seriesState.areAllSeriesDisabled())
};
d._getEnabledValues=function(k){var h=this,j=this._options,g=this._dataAdapter.data()[this._getPropMapping(k)];
if(!this._valuesAreFilterable()){return g
}var i=this._dataAdapter.data()[this._legend.mapping()];
g=g.filter(function(l,m){return(i[m]&&h._seriesState.isSeriesEnabled(i[m],"standard"))
});
return g
};
d._updatePathStates=function(){var g=this,h=this._options,i=c.select(h.parent);
i.selectAll(".series [legend-group]").classed("path-inactive",function(){if(!h.interactive){return false
}var j=c.select(this),k=j.attr("legend-group");
if(g._seriesState.doesSeriesStateExist(k,"standard")){return !g._seriesState.isSeriesEnabled(k,"standard")
}return j.classed("path-inactive")
});
if(h.targetValues){i.selectAll(".series [legend-type]").classed("path-inactive",function(){if(!h.interactive){return false
}var k=c.select(this),j=k.attr("legend-type");
if(g._seriesState.doesSeriesStateExist("target",j)){return !g._seriesState.isSeriesEnabled("target",j)
}return k.classed("path-inactive")
})
}};
d._buildLegend=function(o,j){var m=null,p=this._options,g=c.select(p.parent).select(".cv-wrapper"),h=this._getPropMapping(o||"series"),i=this._getPropMapping(j||"seriesLabel");
if(h&&i&&h!==i){var l=this._dataAdapter.data(),k=l[h],n=l[i]||k;
m=[];
k.forEach(function(r,s,q){if(q.indexOf(r)===s){m.push(n[s])
}})
}if(!p.legendVisible){g.selectAll(".cv-legend").remove();
g.selectAll(".cv-bg").remove();
return"none"
}if(p.interactive){return this._buildInteractiveLegend(m)
}else{return this._buildStandardLegend(m)
}};
d._buildStandardLegend=function(l){var i=this._options,g=c.select(i.parent).select(".cv-wrapper");
this._legend=null;
g.selectAll(".cv-legend").remove();
g.selectAll(".cv-bg").remove();
var k,h=this.LEGEND_ORIENTATIONS.indexOf(i.legendOrientation)>-1?i.legendOrientation:"top";
switch(this._calculatedLegendOrientation){case"top":case"bottom":k={top:5,bottom:5,left:0,right:0};
break;
case"left":case"right":k={top:0,bottom:0,left:5,right:5};
break
}var j=b.guide.legend().orientation(h).padding(k);
if(l){j.labels(l)
}if(this._isSmallChart()){j.hGap(10).vGap(2)
}return j
};
d._buildInteractiveLegend=function(l){var j=this._options,i=this,h=c.select(j.parent).select(".cv-wrapper");
if(!this._legend){this._legend=f.interactiveLegend()
}var g=this._dataAdapter.data()[this._getPropMapping("series")],k=g.some(function(m,n,o){return m!==o[n-1]
});
if(!k){this._legend.remove();
h.selectAll(".path-inactive").classed("path-inactive",false);
return"none"
}this._legend.parent(h.node()).orientation(j.legendOrientation).chartWidth(this._getChartWidth()).chartHeight(this._getChartHeight()).chartPadding(this._chart.padding()).validOrientations(this.LEGEND_ORIENTATIONS).legendVerticalWidth(j.legendVerticalWidth).type(this._type).seriesState(this._seriesState);
if(l){if(this._getCategoryTotal){this._legend.totals(l.map(function(m){return this._getCategoryTotal(m)
}))
}}return this._legend
};
d._numXTicks=function(){return function(g){return Math.max(g/120,2)
}
};
d._yTitleFormat=function(j,h){var g=this._dataAdapter,n=g.yAxisTitle(),i=g.l10n,m=this._getYFormatType(j),l,k;
if("time"===m){if(!h){h=this._getEnabledValues("y")
}l=this._yTimeGranularity(h,b.guide.axis().ticks()());
l=i.time.plural[l.gran];
k=(n)?i.labels.dvcore.yAxisTimeWithTitle:i.labels.dvcore.yAxisTimeNoTitle;
n=k.replace(/\{time\}/i,l).replace(/\{title\}/i,n)
}return n
};
d._formatYValue=function(i,h,j,g){if(j&&j.divisor>0){i=i/j.divisor
}return this._formatNumber(h,i,g)
};
d._getYFormatType=function(g){var h=this._dataAdapter.formats().y;
if(!h){return"decimal"
}if(b.util.isArray(h)){if(!h[g]){return"decimal"
}return h[g]
}return h
};
d._yLabelFormat=function(k){var i=this._getYFormatType(k),g=this._dataAdapter,j=this._options,h=this;
return function(p,m){var o,n,l=g.l10n.time;
if("time"===i){n=g.getTimeGranularity(p,true);
l=(1!==+p)?l.plural:l.singular
}o=h._formatYValue(p,i,n,j.precision);
if(n&&n.gran){o+=" "+l[n.gran]
}return o
}
};
d._yTickFormat=function(k,h){var g=this,i=this._getYFormatType(k),j=this._options,l;
if("time"===i){if(!h){h=this._getEnabledValues("y")
}l=g._yTimeGranularity(h,b.guide.axis().ticks()())
}return function(n,m){if(!n){return""
}return g._formatYValue(n,i,l,j.precision)
}
};
d._yTimeGranularity=function(i,l){i=i&&i.filter(function(n){return isFinite(n)
})||[];
l=l||1;
if(!i.length){return null
}var h=Math.max.apply(null,i),j=Math.min.apply(null,i),g=c.scale.linear().domain([j,h]).ticks(l),m=g.length?(g.length>1)?g[1]-g[0]:h-g[0]:h,k=g.length?(m/g.length):m;
return this._dataAdapter.getTimeGranularity(k)
};
d._xTickAnchor=function(g){return function(o,j,p){var m=g.getTrainedScale("x"),h=b.util.scaleRange(m),l=20;
var k=m.mapValue(o)+m.rangeBand()/2;
if(k-h[0]<l){return"start"
}if(h[1]-k<l){return"end"
}return"middle"
}
};
d._checkNormalized=function(){var h=this._chart,g=this._dataAdapter.l10n;
if(this._isNormalized&&this._isNormalized()){h.guide("y","none",1);
h.guide("y",b.guide.axis().ticks(0).tickFormat(function(k,j){return""
}).title(g.labels.core.normalized));
h.padding({})
}};
d._formatTime=function(h,t,o){var u=this._dataAdapter.l10n.calendar;
var l={a:function(i){return u.weekdayAbbreviations[i.getDay()]
},A:function(i){return u.weekdays[i.getDay()]
},b:function(i){return u.monthAbbreviations[i.getMonth()]
},B:function(i){return u.months[i.getMonth()]
},p:function(i){return u.ampm[Math.floor(i.getHours()/12)]
}};
var s="",r=-1,m=0,g=t.length;
var q=function(){var i=t.substring(m,r);
if(i.length){s+=c.time.format(i)(h)
}};
while(++r<g){if(t.charCodeAt(r)==37){var k=t.charAt(r+1);
var p=l[k];
if(p){q();
s+=p(h);
r++;
m=r+1
}}}q();
if("hour"===o&&0===s.indexOf("0")){s=s.slice(1)
}return s
};
d._timeGranTemplate=function(g,i){var h;
switch(g){case"hour":h=i.hour;
break;
case"day":h=i.day;
break;
case"week":h=i.week;
break;
case"month":h=i.month;
break;
case"quarter":h=i.quarter;
break;
case"year":h=i.year;
break;
default:h=i.fallback;
break
}return h
};
d._timeSmallXFormat=function(){var h=this,g=h._dataAdapter,i=g.l10n.dateFormat.fullFormat;
return function(k,j){return h._formatTime(k,i.condensed)
}
};
d._timeXTickFormat=function(o){var q=this,r=q._options,m=this._chart,p=q._dataAdapter,j=new Date(0),n="",g="",h=p.l10n.dateFormat,l=h.mediumFormat,k=p?p.dateGranularity():"*",i=this._timeGranTemplate(k,h.shortFormat);
return function(z,u){var v,w,s,t;
if(0===u){j=new Date(0);
n=null;
g=null
}if(o&&!o.call(this,z,u)){return""
}if("hour"===k&&j.getDate()!==z.getDate()){v=l.day
}if(("day"===k||"week"===k)&&j.getMonth()!==z.getMonth()){v=l.month
}if(("month"===k||"quarter"===k)&&j.getYear()!==z.getYear()){v=l.year
}j=z;
w=q._formatTime(z,i,k);
if(v){s="<br/>"+q._formatTime(z,v)
}else{s="<br/>&nbsp;"
}if(w===n&&(s===g||!v)){t=""
}else{t=(s)?w+s:w
}n=w;
g=s;
return t
}
};
e.cloudViz.dvcore=d
}(this));
(function(f){var e,c=[];
var b=function(h,i){var j=-1;
return function(){if(j>-1){window.clearTimeout(j)
}j=window.setTimeout(h,i)
}
};
var d=b(function(){c.forEach(function(h){h()
})
},30);
var g=function(h){if(c.indexOf(h)==-1){c.push(h)
}if(!e){window.addEventListener("resize",d);
e=true
}};
var a=function(i){var h=c.indexOf(i);
if(h>-1){c.splice(h,1)
}if(c.length===0&&e){window.removeEventListener("resize",d);
e=false
}};
f.cloudViz.windowResize={addHandler:g,removeHandler:a}
}(this));
(function(e){var f=e.cloudViz||{},d=f.dvcore||{},b=e.dv||{},c=e.d3||{},a=Object.create(d),g=-1;
a.init=function(h){Object.getPrototypeOf(a).init.apply(this,arguments);
this._type="line";
this._chart=b.chart();
this._displayPoints=null;
this._adjustClipHeight=6;
this._adjustClipWidth=6;
this._minTrendTickSpace=135;
this._showRibbons=false;
this._uniqueGroups=null;
return this
};
a._initDefaultOptions=function(){var h={normalized:false,filled:false,position:"identity",forceZero:null,dualYAxis:false,showAnomalies:false,mappings:{upperRangeBand:"upper",lowerRangeBand:"lower",forecast:"forecast"},formats:{x:"decimal",y:"decimal"}};
return Object.getPrototypeOf(a)._initDefaultOptions.call(this,h)
};
a.reset=function(){Object.getPrototypeOf(a).reset.apply(this,arguments);
var i=this._options;
var h=c.select(i.parent);
h.selectAll(".behavior").text("");
h.selectAll(".behavior-under-geom").text("");
this._chart.on("mousemove.inspector",null);
this._chart.on("mouseout.inspector",null);
h.selectAll(".axis-y.axis-index-1").remove()
};
a._setChartTypeOptions=function(){var k=this._chart,j=this._options,h=this,m=[b.geom.line().each("start",function(o,n){c.select(this).attr("legend-group",o[0]["stroke"])
}).map("stroke",this._getPropMapping("series"),b.scale.color().values(j.colors))];
this._uniqueGroups=b.util.uniq(k.data()[this._getPropMapping("series")]);
this._showRibbons=(this._uniqueGroups.length==1&&this._isMappedAndExistsInData("upperRangeBand")&&this._isMappedAndExistsInData("lowerRangeBand"));
if(this._showRibbons){m.unshift(b.geom.ribbon().map("yMin",this._getPropMapping("lowerRangeBand")).map("yMax",this._getPropMapping("upperRangeBand")).set("alpha",0.15).interpolate("cardinal"));
j.filled=false
}if(this._showRibbons&&this._isMappedAndExistsInData("forecast")){m.push(b.geom.line().map("y",this._getPropMapping("forecast")).set("alpha",0.5).set("linetype","dotted").interpolate("cardinal"))
}if(j.filled){m.push(b.geom.area().baseline(undefined).each("start",function(o,n){c.select(this).attr("legend-group",o[0]["fill"])
}).map("fill",this._getPropMapping("series"),b.scale.color().values(j.colors)).set("alpha",0.2))
}var l=b.geom.point().map("stroke",this._getPropMapping("series"),b.scale.color().values(j.colors)).set("fill","#fff").set("size",7);
m.push(l);
var i=this._getPropMapping("group")||this._getPropMapping("series");
k.layers(m).guide("stroke",this._legend).map("group",i).set("linetype",function(p,o,n){return(/::incomplete::$/).test(p.data[i])?"0,4,7,0":"solid"
}).position(j.position);
l.each("start",function(o,n){c.select(this).classed("point-hidden",!h._shouldDisplayPoint.call(h,o)).attr("legend-group",o.stroke).classed("line-point",true)
});
this._addBehaviors(k,j);
this._mapPositionScales(k,j)
};
a._shouldDisplayPoint=function(h){return(this._showRibbons)?this._isAnomalousDataPoint(h):this._shouldDisplayPoints()
};
a._shouldDisplayPoints=function(){if(this._displayPoints!==null){return this._displayPoints
}var j=this._options,k=this._chart,l=k.layers()[1]._nestData,h=Math.max.apply(null,l.map(function(m){return m.values.length
})),i=k.getTrainedScale("x").range();
return this._displayPoints=(j.showAnomalies&&this._showRibbons)||(((i[1]-i[0])/h)>=60)
};
a._isAnomalousDataPoint=function(h){return(h.data[this._getPropMapping("y")]>h.data[this._getPropMapping("upperRangeBand")]||h.data[this._getPropMapping("y")]<h.data[this._getPropMapping("lowerRangeBand")])
};
a._addBehaviors=function(m,k){var j=this,h=c.select(k.parent),i=this._dataAdapter,l=i.formats().x;
if(k.interactive){m.behaviors([b.behavior.inspector().gutterPadding(0).orientation("bottom").thickness(2).label(function(p){if(i.isOvertime()){var n=i.dateGranularity(),o=i.l10n.dateFormat.fullFormat;
return j._formatTime(p,j._timeGranTemplate(n,o),n)
}return j._formatNumber(l,p,k.precision)
}).inspectorMove(function(p,n,r,q){var o=m.getTrainedScale("stroke")[0];
j._highlightHoveredPoints.call(j,h,q,o);
h.selectAll(".axis-x .axis-label").style("opacity",0);
h.selectAll(".axis-x-title").style("opacity",0);
h.selectAll(".text-geom").style("opacity",0);
if(j._eventMap.mouseover){j._eventMap.mouseover.call(this,p,n,r,q,c.event)
}}).inspectorOut(function(){var n=m.getTrainedScale("stroke")[0];
j._highlightHoveredPoints.call(j,h,null,n);
h.selectAll(".axis-x .axis-label").style("opacity",1);
h.selectAll(".axis-x-title").style("opacity",1);
h.selectAll(".text-geom").style("opacity",1);
if(j._eventMap.mouseout){j._eventMap.mouseout.call(this,c.event)
}}).underGeoms(true)])
}};
a._highlightHoveredPoints=function(k,n,j){var i={},h=this,m=j.domain(),l=this._options;
k.selectAll(".line-point").each(function(s){var q=c.select(this),p=j.mapValue(s.stroke),r=h._dataValuesEqual.call(h,s.x,n),o=q.datum();
q.classed("point-hidden",r?false:!h._shouldDisplayPoint.call(h,s));
q.style("fill",r?p:"#FFF").style("opacity",r?1:"");
if(r){i[q.attr("legend-group")]={yVal:o.y,scaleIndex:m.indexOf(s.stroke)}
}});
k.selectAll(".cv-legend-entry").each(function(t){var w=t.id,q=i[w],p=c.select(this).select(".cv-legend-num");
if(!q){return p.text("")
}var u=h._getYFormatType(q.scaleIndex),v=q.yVal,z;
if("time"===u){var A=h._dataAdapter.l10n,s=h._yTimeGranularity(h._dataAdapter.getUniqueStrokeExtentByStroke(w),b.guide.axis().ticks()()),o=A.time.plural[s.gran],r=A.labels.dvcore.legendTime;
if(s&&s.divisor>0){v=v/s.divisor
}z=r.replace(/\{time\}/i,o).replace(/\{value\}/i,h._formatNumber(u,v,l.precision))
}else{z=h._formatNumber(u,v,l.precision)
}p.text(z)
})
};
a._dataValuesEqual=function(i,h){if(!i||!h){return false
}if(this._dataAdapter.isOvertime()&&i.getTime()===h.getTime()){return true
}return i===h
};
a._mapPositionScales=function(m,r){var l=[0,this._isSmallChart()?24:6],j=this._constructScale("y").rangePadding(l),i=this._getPropMapping("series"),p=this._getPropMapping("y"),h=this._getPropMapping("x"),q=this;
if(q._dataAdapter._forceZero===null&&r.filled){q._dataAdapter._forceZero=true;
this._applyForceZero(j)
}if(r.normalized||(r.dualYAxis&&(r.position==="identity"||r.position==="dodge"))){var n=q._dataAdapter.uniqueStrokeValues();
n.forEach(function(u,t){var s=(0===t)?j:j.copy();
s.includeInDomain(function(w,v){return w.data[i]===q._dataAdapter.uniqueStrokeValues()[t]
});
if(t>0){m.map("y",p,s,t)
}})
}else{var k=m.getExplicitScalesMap().y;
if(k){delete k[1]
}}var o=this._dataAdapter.isOvertime()?b.scale.time():b.scale.linear();
o.rangePadding([10,10]);
m.map("y",p,j,0);
m.map("x",h,this._constructScale("x",o))
};
a._xTickFormat=function(){var i=this,h=this._dataAdapter,j=this._options,k=h.formats().x;
return function(m,l){return i._formatNumber(k,m,j.precision)
}
};
a._drawSmall=function(){var t=this._options,o=this._chart,r=this,n=this._computeExtents(),k=c.extent(this._getEnabledValues("x")),m=this._getYFormatType(0),q=function(v,u){return v?r._formatNumber(m,v,t.precision):"0"
},j=b.guide.axis().tickSize(0).title(this._dataAdapter.xAxisTitle()).tickDy(n.y.length>1?-26:-14).tickAnchor(function(v,u){return u>0?"end":"start"
}),h=b.guide.axis().ticks(2).title(this._dataAdapter.yAxisTitle()),s=t.dualYAxis||(t.position==="stack"&&this._uniqueGroups.length>1);
if(!s){var l=[b.geom.point().data(n).set("stroke","none").map("y","y",b.scale.linear()).map("x","x",this._dataAdapter.isOvertime()?b.scale.time():b.scale.linear()).each("start",function(z,u){var w=z.panel.getTrainedScale("fill")[0],v=c.select(this);
v.style("fill",w.mapValue(z.data.fill)).attr("legend-group",z.data.fill)
}).map("group","fill").set("size",6),b.geom.text().data(n).set("stroke","none").map("y","y",b.scale.linear()).map("x","x",this._dataAdapter.isOvertime()?b.scale.time():b.scale.linear()).each("start",function(z,u){var w=z.panel.getTrainedScale("fill")[0],v=c.select(this);
v.style("fill",w.mapValue(z.data.fill)).attr("legend-group",z.data.fill);
if(this.parentNode){c.select(this.parentNode.parentNode).classed("no-clip",true).attr("clip-path",null)
}}).map("group","fill").set("size","11px").set("label",function(C,z,w){var v=C.panel.getTrainedScale("fill")[0].domain(),u=v.indexOf(C.data.fill),A=r._yTickFormat(u)(C.y);
if("time"===m){var B=r._yTimeGranularity(r._getEnabledValues("y"),b.guide.axis().ticks()());
A+=" "+r._dataAdapter.l10n.time.plural[B.gran]
}return A
}).textAnchor(function(v,u){return v.data&&v.data.anchor||"middle"
}).dy(function(v,u){return(n.y.length===1||v.y===n.y[1])?-8:15
}).dx(function(v,u){return(v.data&&v.data.anchor=="end")?3:0
})];
o.layers(o.layers().concat(l))
}o.map("fill",this._getPropMapping("series"),b.scale.color().values(t.colors));
if(this._dataAdapter.isOvertime()){j.tickValues(k).tickFormat(r._timeSmallXFormat());
if(s){h.tickFormat(this._yTickFormat(0))
}else{h.tickFormat(function(){return""
})
}}else{if(t.dualYAxis){var p=b.guide.axis().tickFormat(this._yTickFormat(1)).orientation("right").tickSize(15).tickDy(-8).tickAnchor("end").tickDx(4).ticks(3);
h.tickSize(15).tickDy(-8).tickAnchor("start").tickDx(4).ticks(3);
o.guide("y",p,1)
}else{var i=c.extent(this._dataAdapter.data()[this._getPropMapping("x")]);
j.tickValues(i).tickFormat(this._xTickFormat());
h.tickFormat(this._yTickFormat(0));
o.guide("y","none",1)
}}o.guide("x",j).guide("y",h);
this._checkNormalized()
};
a._numXTicks=function(){var h=this;
if(this._dataAdapter.isOvertime()){var i=this._chart._data[this._getPropMapping("x")].length;
return function(j){var l=0;
var k=Math.max(j/i,h._minTrendTickSpace);
return Math.max(Math.min(Math.floor(j/k),i),2)
}
}return Object.getPrototypeOf(a)._numXTicks.call(this)
};
a._drawLarge=function(){var q=this._options,m=this._chart,o=c.select(q.parent),n=false,k=this._dataAdapter.getUniqueStrokeExtent(0),j=this._dataAdapter.getUniqueStrokeExtent(1),l,i=b.guide.axis().ticks(this._numXTicks()).title(this._dataAdapter.xAxisTitle()).tickDy(-8).tickAnchor(this._xTickAnchor(m)),h=b.guide.axis().htmlLabels(true);
if(this._dataAdapter.isOvertime()){i.tickFormat(this._timeXTickFormat()).htmlLabels(true)
}else{i.tickFormat(this._xTickFormat())
}if(q.dualYAxis&&(q.position==="identity"||q.position==="dodge")){l=this._yTickFormat(0,k);
h.title(this._yTitleFormat(0,k));
var p=b.guide.axis().tickFormat(this._yTickFormat(1,j)).title(this._yTitleFormat(1,j)).orientation("right").tickSize(15);
h.tickSize(15);
m.guide("y",p,1)
}else{l=this._yTickFormat(0);
h.title(this._yTitleFormat(0));
m.guide("y","none",1)
}h.tickFormat(function(u,s){var r=c.select(this),t=h._scale();
if(t instanceof b.scale.linear&&u>0&&(s===0||(s===1&&n))){if(t.mapValue(u)<t.range()[0]-10||!q.interactive){r.classed("arrow-container",true)
}else{n=true;
r.classed("arrow-container",false);
return""
}}else{r.classed("arrow-container",false)
}return l.call(this,u,s)
});
m.guide("x",i).guide("y",h);
this._checkNormalized()
};
a._preRender=function(){Object.getPrototypeOf(a)._preRender.call(this);
this._displayPoints=null
};
a._computeExtents=function(){var m=-1,u=this._options,p=this._getEnabledValues("y"),k=this._getEnabledValues("x"),l=this._getEnabledValues("series"),h=p.length,t={x:[undefined,undefined],y:[undefined,undefined],fill:[undefined,undefined],anchor:[undefined,undefined]},o=null,r=null;
k.forEach(function(n,w){o=(o===null||o>n)?n:o;
r=(r===null||r<n)?n:r
});
while(++m<h){var q=p[m],s=k[m],j=l?l[m]:u.colors[0];
if(t.y[0]===undefined||q<t.y[0]){t.y[0]=q;
t.x[0]=s;
t.fill[0]=j;
t.anchor[0]=(+s==+o)?"start":(+s==+r)?"end":"middle"
}if(t.y[1]===undefined||q>t.y[1]){t.y[1]=q;
t.x[1]=s;
t.fill[1]=j;
t.anchor[1]=(+s==+o)?"start":(+s==+r)?"end":"middle"
}}if(t.y[0]===0){t.y.splice(0,1);
t.x.splice(0,1);
t.fill.splice(0,1);
t.anchor.splice(0,1)
}return t
};
a._isNormalized=function(){var i=this._options,h=this._isSmallChart()?1:2;
return i.normalized||(i.dualYAxis&&this._dataAdapter.uniqueStrokeValues().length>h&&(i.position==="identity"||i.position==="dodge"))
};
e.cloudViz.line=f.util.createConstructor(a)
}(this));
(function(e){var f=e.cloudViz||{},d=f.dvcore||{},b=e.dv||{},c=e.d3||{},a=Object.create(d);
a.init=function(g){Object.getPrototypeOf(a).init.apply(this,arguments);
this._type="point";
this._chart=b.chart();
return this
};
a.getSelected=function(){var h=[],g=c.select(this._options.parent).selectAll(".point-geom.cv-highlight");
g.each(function(i){h.push(i)
});
return h
};
a.setSelected=function(j){var g=this,i=[],h=c.select(this._options.parent).selectAll(".point-geom").filter(j);
h.each(function(k){i.push(k)
});
g._selectPoints(i);
return g
};
a._selectPoints=function(h,i){var g=this;
if(!i||!i.accumulate){if(!i||h.length!==0){c.select(g._options.parent).selectAll(".point-geom").each(function(j){if(h.indexOf(j)>=0){g._highlight(c.select(this),true)
}else{g._highlight(c.select(this),false)
}})
}else{if(i.noneSelected==="selectAll"){g._highlight(c.select(g._options.parent).selectAll(".point-geom"),true)
}}}else{if(i.action==="add"){c.select(g._options.parent).selectAll(".point-geom").each(function(j){if(h.indexOf(j)>=0){g._highlight(c.select(this),true)
}})
}else{if(i.action==="remove"){c.select(g._options.parent).selectAll(".point-geom").each(function(j){if(h.indexOf(j)>=0){g._highlight(c.select(this),false)
}})
}}}return g
};
a._initDefaultOptions=function(){var g={mappings:{size:"size"},sizeTitle:"",formats:{x:"decimal",y:"decimal",size:"decimal"},selectionEnabled:false,selectPolicyCB:function(){return{start:null,end:null,move:null}
},tooltipContent:null};
return Object.getPrototypeOf(a)._initDefaultOptions.call(this,g)
};
a._setChartTypeOptions=function(){var i=this._chart,h=this._options,j=[],g=this;
j[0]=b.geom.point().each("start",function(l,k){c.select(this).attr("legend-group",l.fill)
});
i.layers(j).map("x",this._getPropMapping("x"),this._constructScale("x").rangePadding([this._isSmallChart()?10:20,this._isSmallChart()?10:20])).map("y",this._getPropMapping("y"),this._constructScale("y").rangePadding([this._isSmallChart()?10:20,this._isSmallChart()?10:20])).map("fill",this._getPropMapping("series"),b.scale.color().values(h.colors)).guide("fill",this._legend).padding({left:10});
if(this._dataAdapter.isBubble()){j[0].map("size",this._getPropMapping("size"),b.scale.linear().to([9,60]))
}else{j[0].set("size",10).set("alpha",0.6)
}this._addBehaviors(i,j[0],h)
};
a._addBehaviors=function(j,l,o){var m=c.select(o.parent),h,n=this,i=this._getYFormatType(),k=function(s,r,p,q){if(!s.data.hasOwnProperty(r.mapping())){return""
}return'<span class="metric-value">'+p(s.data[r.mapping()])+'</span><span class="metric-name">'+q+"</span>"
},g=function(s,r,p){var t=[];
c.select(o.parent).selectAll(".point-geom").each(function(v,u){if(r[0][0]<=v.x&&r[1][0]>=v.x&&r[0][1]<=v.y&&r[1][1]>=v.y){if(n._seriesState.isSeriesEnabled(v.data.group,"standard")||n._seriesState.isSeriesEnabled(v.data[n._getPropMapping("series")],"standard")){t.push(v)
}}});
var q=n._options.selectPolicyCB.call();
n._selectPoints(t,q[s]);
if(n._eventMap.selectionStart&&s==="start"){n._eventMap.selectionStart.call(n,t)
}if(n._eventMap.selectionEnd&&s==="end"){n._eventMap.selectionEnd.call(n,t)
}};
if(o.selectionEnabled){j.behaviors([b.behavior.brush().brushStart(g).brushMove(g).brushEnd(g)])
}else{j.behaviors([])
}if(!this._isSmallChart()&&o.interactive){l.behaviors([b.behavior.voronoiRollover().pointDetectionRadius(25).content(function(u,r,q){if(o.tooltipContent){return o.tooltipContent.call(this,u,r,q)
}var v=this.__geom.getExplicitScale("group"),A=u.panel.xScale(u),w=u.panel.yScale(u),z=this._xGuides[A.scaleIndex()],p=this._yGuides[w.scaleIndex()],D=n._dataAdapter.l10n,B=(z.__scale&&z.tickFormat()?z.tickFormat():String),s=function(E){return n._formatNumber(i,E,o.precision)
},t=k(u,w,s,n._dataAdapter.yAxisTitle()||D.labels.point.yScale)+k(u,A,B,n._dataAdapter.xAxisTitle()||D.labels.point.xScale);
if(n._dataAdapter.isBubble()){var C=u.panel.getTrainedScale("size")[0];
t+=k(u,C,String,n._dataAdapter.sizeMetricName()||D.labels.point.sizeScale)
}if(v&&v.mapping()){t='<span class="series-name">'+u.data[v.mapping()]+"</span>"+t
}return t
}).mouseOver(function(s,q,p,r){clearTimeout(h);
m.selectAll(".point-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(t){return s!==t
});
m.selectAll(".cv-legend-marker").classed("unselected",function(t){return t!==s.fill
}).classed("cv-medium-duration",false);
if(n._eventMap.mouseover){n._eventMap.mouseover.call(this,s,q,p,r)
}}).mouseOut(function(s,q,p,r){h=setTimeout(function(){m.selectAll(".point-geom").classed("cv-unselected",false).classed("cv-medium-duration",true);
m.selectAll(".cv-legend-marker").classed("unselected",false).classed("cv-medium-duration",true);
if(n._eventMap.mouseout){n._eventMap.mouseout.call(this,s,q,p,r)
}},400)
})])
}};
a._drawSmall=function(){var k=this._chart,h=c.extent(this._getEnabledValues("x")),i=this,g=this._dataAdapter,m=this._options,j=g.formats().x,l=this._getYFormatType();
k.guide("x",b.guide.axis().tickSize(0).tickValues(h).title(this._dataAdapter.xAxisTitle()).tickFormat(function(n){return i._formatNumber(j,n,m.precision)
}).tickAnchor(function(o,n){return n>0?"end":"start"
})).guide("y",b.guide.axis().ticks(2).title(this._dataAdapter.yAxisTitle()).tickDy(-8).tickFormat(function(n){return !n?"":i._formatNumber(l,n,m.precision)
}))
};
a._drawLarge=function(){var k=this._chart,i=function(n){return Math.max(2,Math.min(5,n/70))
},h=this,g=this._dataAdapter,m=this._options,j=g.formats().x,l=this._getYFormatType();
k.guide("x",b.guide.axis().ticks(this._numXTicks()).title(this._dataAdapter.xAxisTitle()).tickFormat(function(n){return h._formatNumber(j,n,m.precision)
})).guide("y",b.guide.axis().ticks(i).title(this._dataAdapter.yAxisTitle()).tickDy(-8).tickFormat(function(n){return !n?"":h._formatNumber(l,n,m.precision)
}))
};
a._postRender=function(){Object.getPrototypeOf(a)._postRender.call(this);
var j=this._options,k=this._chart,h=5,g=c.select(j.parent).select(".cv-wrapper"),i=g.selectAll(".cv-bubble-size-metric").data([0]);
if(this._dataAdapter.sizeMetricName()){i.enter().append("div").classed("cv-bubble-size-metric",true).html("<span>"+this._dataAdapter.sizeMetricName()+"</span>  <i></i> &ndash; <i></i>");
setTimeout(function(){var q=k.padding(),p=k.facet().getPanel(k.facet()._panels.length-1).bounds(),s=k.plotBounds(),o=i.selectAll("span"),n=s.right+q.right,m=p.top+p.height,l=n-i.node().offsetWidth-h,r=m-i.node().offsetHeight;
i.style("top",r+"px").style("left",l+"px")
},300)
}else{i.remove()
}};
e.cloudViz.point=f.util.createConstructor(a)
}(this));
(function(e){var f=e.cloudViz||{},d=f.dvcore||{},a=e.dv||{},b=e.d3||{},c=Object.create(d);
c.init=function(g){Object.getPrototypeOf(c).init.apply(this,arguments);
this._type="bar";
this._chart=a.chart();
this._minTickSpace=60;
return this
};
c._initDefaultOptions=function(){var g={normalized:false,position:"dodge",dualYAxis:false,clickHandler:null,formats:{x:"decimal",y:"decimal"},tooltipContent:null};
return Object.getPrototypeOf(c)._initDefaultOptions.call(this,g)
};
c.reset=function(){Object.getPrototypeOf(c).reset.apply(this,arguments);
var h=this._options,g=b.select(h.parent);
g.selectAll(".axis-y.axis-index-1").remove()
};
c._setChartTypeOptions=function(){var h=this._chart,g=this._options;
h.layers([a.geom.bar().each("start",function(k,j){b.select(this).attr("legend-group",k.fill)
})]).map("fill",this._getPropMapping("series"),a.scale.color().values(g.colors)).guide("fill",this._legend).position(g.position).coord(a.coord.cartesian().flip(g.flip));
h._layers[0].on("click",this._eventMap.click?this._eventMap.click:null);
this._addBehaviors(h.layers()[0],g);
this._mapPositionScales(h,g)
};
c._mapPositionScales=function(m,s){var i=this._isSmallChart(),l=[0,i?10:15],h=this._applyForceZero(this._constructScale("y")).rangePadding(l),j=this._getPropMapping("series"),r=this._getPropMapping("y"),g=this._getPropMapping("x"),o=i?0.8:Math.min(0.6,Math.max(0.05,this._getChartWidth()/4000)),n=i?0:0.5,q=this;
if(s.normalized||(s.dualYAxis&&(this._options.position==="identity"||this._options.position==="dodge"))){var p=q._dataAdapter.uniqueFillValues();
p.forEach(function(v,t){var u=(0===t)?h:h.copy();
u.includeInDomain(function(z,w){return z.data[j]===q._dataAdapter.uniqueFillValues()[t]
});
if(t>0){m.map("y",r,u,t)
}})
}else{var k=m.getExplicitScalesMap().y;
if(k){delete k[1]
}}m.map("y",r,h,0);
m.map("x",this._getPropMapping("x"),a.scale.ordinal().padding(o).outerPadding(n).reverse(s.flip))
};
c._addBehaviors=function(k,j){var g=b.select(j.parent),l,h=this._dataAdapter,i=this;
if(!this._isSmallChart()&&j.interactive){k.behaviors([a.behavior.rollover().orientation(j.flip?"top":"right").content(function(s,p,n){if(j.tooltipContent){return j.tooltipContent.call(this,s,p,n)
}var t=this.__geom.getExplicitScale("group"),u=s.panel.yScale(s),q=i._yLabelFormat(u.scaleIndex()),r='<span class="metric-value">'+q(s.y)+'</span><span class="metric-name">'+s.data[i._getPropMapping("seriesLabel")]+"</span>",o=h.dateGranularity(),v=h.l10n.dateFormat.fullFormat,m=a.util.isDate(s.x)?i._formatTime(s.x,i._timeGranTemplate(o,v),o):s.x;
if(t&&t.mapping()){r='<span class="series-name">'+m+"</span>"+r
}return r
}).showTooltip(function(r,n,m,q,p){var o=b.select(this);
if(!o.classed("path-inactive")){p._showTip.call(this,r,n,m,p);
clearTimeout(l);
g.selectAll(".bar-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(s){return r!==s
});
g.selectAll(".cv-legend-marker").classed("unselected",function(s){return s!==r.fill
}).classed("cv-medium-duration",false);
if(i._eventMap.mouseover){i._eventMap.mouseover.call(this,r,n,m,q)
}}}).hideTooltip(function(r,n,m,q,p){var o=b.select(this);
if(!o.classed("path-inactive")){p._removeTip.call(this,r,n,m,p);
l=setTimeout(function(){g.selectAll(".bar-geom").classed("cv-unselected",false).classed("cv-medium-duration",true);
g.selectAll(".cv-legend-marker").classed("unselected",false).classed("cv-medium-duration",true);
if(i._eventMap.mouseout){i._eventMap.mouseout.call(this,r,n,m,q)
}},400)
}})])
}};
c._drawSmall=function(){var j=this._chart,i=this._options,k,g=(i.flip)?undefined:10,h=this;
if(i.flip){k=a.guide.axis().tickDx(function(m,l){return b.select(this).select("span").node().offsetWidth
}).tickDy(function(m,l){return -b.select(this).select("span").node().offsetHeight
}).tickSize(0)
}else{k=a.guide.axis().tickSize(0).tickDy(function(m,l){return(l%2===0)?-8:-26
})
}if(this._dataAdapter.isOvertime()){k.tickValues(b.extent(this._dataAdapter.data()[this._getPropMapping("x")])).tickFormat(h._timeSmallXFormat()).tickAnchor(function(m,l){return l>0?"end":"start"
}).tickDy(-8)
}else{k.tickFormat(function(m,l){return h._truncateLabel(m,g)
})
}j.guide("x",k.title(this._dataAdapter.xAxisTitle())).guide("y",a.guide.axis().ticks(0).tickSize(0).tickFormat(function(m,l){return""
}).title(this._dataAdapter.yAxisTitle()));
this._checkNormalized()
};
c._drawLarge=function(){var m=this._chart,q=this._options,p=this,l=function(r){return Math.max(2,Math.min(5,r/75))
},i=a.guide.axis().tickSize(0),h=a.guide.axis().ticks(l),n;
if(q.dualYAxis&&(this._options.position==="identity"||this._options.position==="dodge")){var k=p._dataAdapter.getUniqueFillExtent(0),j=p._dataAdapter.getUniqueFillExtent(1);
h.tickSize(15).tickFormat(this._yTickFormat(0,k)).title(this._yTitleFormat(0,k));
n=a.guide.axis().ticks(l).tickFormat(this._yTickFormat(1,j)).title(this._yTitleFormat(1,j)).orientation("right").tickSize(15);
m.guide("y",n,1)
}else{h.tickFormat(this._yTickFormat(0)).title(this._yTitleFormat(0));
m.guide("y","none",1)
}if(q.flip){i.tickDx(-10)
}else{i.tickDy(function(s,r){return(r%2===0)?-8:-26
});
h.tickDx(-10);
if(n){n.tickDx(-10)
}}if(this._dataAdapter.isOvertime()){var g={},o=0;
m._data[this._getPropMapping("x")].forEach(function(s,r){if(!g[+s]){o++;
g[+s]=1
}});
i.tickDy(-8).tickFormat(this._timeXTickFormat(o)).htmlLabels(true)
}else{i.tickFormat(function(s,r){return p._truncateLabel(s)
})
}m.guide("x",i.title(this._dataAdapter.xAxisTitle())).guide("y",h);
this._checkNormalized()
};
c._timeXTickValidator=function(h){var g=this;
return function(o,k){var m=g._chart.getTrainedScale("x"),j=a.util.scaleRange(m),l=j[1]-j[0],n=Math.ceil(g._minTickSpace/(l/h));
return k%n===0
}
};
c._timeXTickFormat=function(g){return Object.getPrototypeOf(c)._timeXTickFormat.call(this,this._timeXTickValidator(g))
};
c._isNormalized=function(){var h=this._options,g=this._isSmallChart()?1:2;
return h.normalized||(h.dualYAxis&&this._dataAdapter.uniqueFillValues().length>g&&(h.position==="identity"||h.position==="dodge"))
};
e.cloudViz.bar=f.util.createConstructor(c)
}(this));
(function(d){var e=d.cloudViz||{},c=e.dvcore||{},a=d.dv||{},b=d.d3||{},f=Object.create(c);
f.init=function(g){Object.getPrototypeOf(f).init.apply(this,arguments);
this._type="donut";
this._chart=a.chart();
return this
};
f._initDefaultOptions=function(){var g={maxSlices:6,innerRadius:"45%",outerRadius:"35%",clickHandler:null,formats:{x:"decimal",y:"decimal"},tooltipContent:null};
return Object.getPrototypeOf(f)._initDefaultOptions.call(this,g)
};
f._buildLegend=function(){var g=this,h=this._options,j=Object.getPrototypeOf(f)._buildLegend.call(this,"x","x");
this._dataAdapter.processLabelData(j);
if(j!=="none"){if(this._dataAdapter.numberOfFacets()==1){var i=this._dataAdapter.labelData().cvtextvallabel.map(function(l,k){return g._yLabelFormat(0)(l)
});
j.values(i)
}if(!h.interactive&&(!h.legendOrientation||h.legendOrientation==="top")){j.padding({bottom:20})
}}return j
};
f._getSeriesTotal=function(k){var g=this._dataAdapter,n=g.data(),h=n[this._getPropMapping("y")],o=n[this._getPropMapping("series")],j,l=o.length,m=0;
for(j=0;
j<l;
++j){if(o[j]+""===k+""){m+=h[j]
}}return m
};
f._createSeriesStates=function(){var h=this._options;
if("data" in this._changedOptions&&this._changedOptions.data){this._seriesState.removeStatesByType("standard");
var k=a.util.uniq(this._dataAdapter.data()[this._getPropMapping("x")]);
var j=k.length;
while(j--){var g=k[j];
this._seriesState.insertState(g,g,"standard")
}}if("targetValues" in this._changedOptions){if(h.targetValues){this._seriesState.removeStatesByType("target");
this._seriesState.appendState(h.targetLabel||this._dataAdapter.l10n.labels.dvcore.target,"target","target")
}}};
f._getCategoryTotal=function(g){if(this._dataAdapter.numberOfFacets()!==1){return""
}var n=this._dataAdapter.data(),h=n[this._getPropMapping("y")],j=n[this._getPropMapping("x")],k,l=j.length,m=0;
for(k=0;
k<l;
++k){if(j[k]+""===g+""){m+=h[k]
}}return m
};
f._shouldHideLabels=function(g){var h=g.panel.bounds();
return g.y<=0.05||(Math.min(h.width,h.height)/2<80)
};
f._setChartTypeOptions=function(){var m=this._chart,i=this._dataAdapter,k=this._options,g=b.select(k.parent),j=this,h=k.colors.slice(0);
if(k.interactive){m.padding({top:10})
}if(i.showOtherCategory()){h.splice(k.maxSlices-1,0,"#ccc")
}var n=[a.geom.bar().position("fill").set("stroke","#fff").each("start",function(p,o){b.select(this).attr("legend-group",p.fill)
})];
n[0].on("click",this._eventMap.click?this._eventMap.click:null);
var l=j._dataAdapter.labelData();
n.push(a.geom.text().data(l).map("label","cvtextperclabel").set("stroke","none").position("fill").textAnchor(function(q,o){var p=(q.y0+q.y/2)*100;
if(p<50){return"start"
}if(p>50){return"end"
}return"middle"
}).each("start",function(p,o){b.select(this).classed("slice-label",true).classed("hidden",j._shouldHideLabels.call(j,p)).attr("dy",".35em").attr("legend-group",p.fill)
}).set("alpha",function(q,p,o){return j._shouldHideLabels.call(j,q)?0:1
}).dx(function(v,q){var r=v.panel.xOuterScale().range(),p=r[1]-r[0],o=p?p/2:0,s=a.util.getPercentValue(k.outerRadius,o),t=30,u=(v.y0+v.y/2)*100;
return o+s-t
}).dy(function(r,p){var o=-r.panel._bounds.width/2*r.y,q=(r.y0+r.y/2)*100;
if(q<10){o-=(10-q)/2
}if(q>90){o+=(10-(100-q))/2
}if(q<=50&&q>40){o+=(10-(50-q))/2
}if(q>50&&q<60){o-=(10-(q-50))/2
}return o
}));
m.layers(n).map("group","cvdonutorder").map("x",this._getPropMapping("series"),a.scale.ordinal()).map("y",this._getPropMapping("y"),this._constructScale("y")).map("fill",this._getPropMapping("x"),a.scale.color().values(h)).guide("fill",this._legend).guide(["x","y"],"none").coord(a.coord.polar().flip(true).innerRadius(k.innerRadius).outerRadius(k.outerRadius)).postrender(function(){var p=b.select(k.parent).select(".cv-wrapper"),q=p.selectAll(".cv-donut-facet-labels").data([0]),o=j._dataAdapter;
q.enter().append("div").classed("cv-donut-facet-labels",true);
q.exit().remove();
var r=q.selectAll(".cv-donut-facet-label").data(this.facet()._panels),s=r.enter().append("div").classed("cv-donut-facet-label",true);
r.each(function(C,w){var t=C.bounds(),H=b.select(this),B=Math.min(t.width,t.height)/2,A=t.height/2-B,D=a.util.getPercentValue(k.innerRadius,B),J=D<25?"small":D>50?"large":"medium",u=J==="large"?D*2:t.width,v=J==="large"?t.left+(t.width/2)-(u/2):t.left,E=(J==="large")?t.top+(t.height/2)-27:t.top+A-10;
H.style("top",E+"px").style("width",u+"px").style("left",v+"px").classed("cv-donut-small-facet cv-donut-medium-facet cv-donut-large-facet",false).classed("cv-donut-"+J+"-facet",true);
var z=H.selectAll(".cv-donut-label-number").data([0]);
z.enter().append("div").classed("cv-donut-label-number",true);
var I=j._getSeriesTotal(C.xFacetTitle());
z.text(j._yLabelFormat(C._facetIndex)(I));
var G=H.selectAll(".cv-donut-label-title").data([0]);
G.enter().append("div").classed("cv-donut-label-title",true);
G.text(o.yAxisTitle(C._facetIndex));
if(J==="medium"){z.style("top",t.height/2-A+"px")
}});
r.exit().remove()
});
this._addBehaviors(n[0],k)
};
f._addBehaviors=function(k,j){var g=b.select(j.parent),m,h=this._dataAdapter,i=this,l=function(p,o,n){if(!p.data.hasOwnProperty(o.mapping())){return""
}return'<span class="metric-value">'+n(p.data[o.mapping()])+'</span><span class="metric-name">'+o.mapping()+"</span>"
};
if(!this._isSmallChart()&&j.interactive){k.behaviors([a.behavior.rollover().content(function(t,q,o){if(j.tooltipContent){return j.tooltipContent.call(this,t,q,o)
}var u=this.__geom.getExplicitScale("group"),v=t.panel.yScale(t),r=i._yLabelFormat(v.scaleIndex()),s='<span class="metric-value">'+r(t.data[i._getPropMapping("y")])+'</span><span class="metric-name">'+t.data[i._getPropMapping("seriesLabel")]+"</span>",p=i._dataAdapter.dateGranularity(),w=h.l10n.dateFormat.fullFormat,n=a.util.isDate(t.fill)?i._formatTime(t.fill,i._timeGranTemplate(p,w),p):t.fill;
if(u&&u.mapping()){s='<span class="series-name">'+n+"</span>"+s
}return s
}).showTooltip(function(s,o,n,r,q){var p=b.select(this);
if(!p.classed("path-inactive")){q._showTip.call(this,s,o,n,q);
clearTimeout(m);
g.selectAll(".bar-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(t){return s!==t
});
g.selectAll(".text-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(t){return s.group!==t.group
}).classed("cv-selected",function(t){return s.group===t.group
});
g.selectAll(".cv-legend-marker").classed("unselected",function(t){return t!==s.fill
}).classed("cv-medium-duration",false);
if(i._eventMap.mouseover){i._eventMap.mouseover.call(this,s,o,n,r)
}}}).hideTooltip(function(s,o,n,r,q){var p=b.select(this);
if(!p.classed("path-inactive")){q._removeTip.call(this,s,o,n,q);
m=setTimeout(function(){g.selectAll(".bar-geom").classed("cv-unselected",false).classed("cv-medium-duration",true);
g.selectAll(".text-geom").classed("cv-unselected cv-selected",false).classed("cv-medium-duration",true);
g.selectAll(".cv-legend-marker").classed("unselected",false).classed("cv-medium-duration",true);
if(i._eventMap.mouseout){i._eventMap.mouseout.call(this,s,o,n,r)
}},400)
}})])
}};
f._drawSmall=function(){var h=this._chart,g=this._options;
h.facet(a.facet.wrap().group(this._getPropMapping("series")).scales("free").numColumns(1).titleFormat(undefined))
};
f._drawLarge=function(){var g=this._chart;
g.facet(a.facet.wrap().group(this._getPropMapping("series")).scales("free").numColumns(3).titleFormat(undefined))
};
d.cloudViz.donut=e.util.createConstructor(f)
}(this));
(function(a){a.cloudViz.interactiveLegend=function(){var v=10,z=110,w=250,q=110,n,e,f=["top","right","left"],s,i,d,l,c,h,k,p,u=true,g,o,b,t=null,j=null,m,r={};
r._render=function(A,C,B){this._initSVG(C);
this._sizeAndPositionLegendEntries();
this._positionLegend()
};
r._initSVG=function(B){b=d3.select(n).selectAll(".cv-legend").data([0]);
b.enter().append("div").classed("cv-legend",true);
o=this._createLegendEntries(b,B);
g=Math.min(Math.floor(this._getLegendContainingWidth()/o[0].length),w);
if(f.indexOf(e)>-1){this._calculatedLegendOrientation=e
}else{this._calculatedLegendOrientation="top"
}var A=a.cloudViz.core._isSmallChart(s);
if(g<z&&!A&&(this._calculatedLegendOrientation=="top"||this._calculatedLegendOrientation=="bottom")){this._calculatedLegendOrientation="left"
}switch(this._calculatedLegendOrientation){case"top":case"bottom":g=Math.max(g,z);
b.style("height",null);
l=false;
break;
case"left":case"right":g=q;
l=true;
break
}f.forEach(dv.util.bind(function(C){b.classed(C,this._calculatedLegendOrientation===C)
},this))
};
r._getAdjustedDimensions=function(B){var A=b.node();
switch(this._calculatedLegendOrientation){case"top":B.top+=this._getUsedHeight();
break;
case"right":B.width-=this._getUsedWidth();
break;
case"left":B.left+=this._getUsedWidth();
break;
case"bottom":B.height-=this._getUsedHeight();
break
}return B
};
r._createLegendEntries=function(G,E){var I=this,J=p.getStateObjects(),C,D,B,A;
for(B in E){A=E[B][0];
m=A._mapping
}C=G.selectAll(".cv-legend-entry").data(J);
D=C.enter().append("div").attr("class",function(K){return"cv-legend-entry cv-legend-"+K.type+"-entry"
});
D.append("div").classed("cv-legend-title",true);
var H=D.append("div").classed("cv-legend-details",true);
H.append("div").classed("cv-legend-marker",true);
H.append("div").classed("cv-legend-num",true);
C.exit().on("click",null).remove();
C.each(function(M,K){var L=d3.select(this);
L.select(".cv-legend-title").text(M.name);
L.select(".cv-legend-num").text((c&&c.length>K)?c[K]:"");
L.select(".cv-legend-marker").attr("class","cv-legend-marker "+h).style("background-color",function(O){var N=A.mapValue(O.id);
return N?N:null
})
});
C.classed("inactive",function(L,K){return u&&!L.enabled
});
C.on("click",function(L,K){if(u){p.enableStateByIndex(K,!L.enabled)
}});
return C
};
r._onSeriesEnableChange=function(A,B){if(u){o.filter(function(C){return C.id===B.id&&C.type===B.type
}).classed("inactive",!B.enabled)
}};
r._positionLegend=function(){var A={top:0,left:0};
switch(this._calculatedLegendOrientation){case"bottom":A.top=i-b.node().offsetHeight;
break;
case"right":A.left=s-q;
break
}b.style("top",A.top+"px").style("left",A.left+"px")
};
r._sizeAndPositionLegendEntries=function(){if(l){o.each(function(L,J,K){d3.select(this).style("width",g+"px").select(".cv-legend-title").style("height",null)
})
}else{var D,A,I=0,B=false;
var H=o[0].length;
var G=H*g;
var C=this._getLegendContainingWidth();
var E=0;
if(G<C&&G+H>C){E=C-G
}b.style("width",(G>C&&!l)?C+"px":"");
o.each(function(M,K,L){D=d3.select(this);
var J=g;
if(E>0){J+=1;
E-=1
}D.style("width",J+"px");
A=D.select(".cv-legend-title").style("height",null).node().offsetHeight;
if(A!==I){B=true;
I=Math.max(A,I)
}});
if(B){o.selectAll(".cv-legend-title").style("height",I+"px")
}}};
r._getLegendContainingWidth=function(){return s-d.right
};
r._getUsedWidth=function(){return l?q+v:0
};
r._getUsedHeight=function(){if(l){return 0
}else{return b.node().offsetHeight||0
}};
r.destroy=function(){b.remove()
};
r.parent=function(A){if(!arguments.length){return n
}n=A;
return r
};
r.minLegendEntryWidth=function(A){if(!arguments.length){return z
}z=A;
return r
};
r.maxLegendEntryWidth=function(A){if(!arguments.length){return w
}w=A;
return r
};
r.legendVerticalWidth=function(A){if(!arguments.length){return q
}q=+A;
return r
};
r.values=function(A){if(!arguments.length){return c
}c=A;
return r
};
r.type=function(A){if(!arguments.length){return h
}h=A;
return r
};
r.chartWidth=function(A){if(!arguments.length){return s
}s=A;
return r
};
r.chartHeight=function(A){if(!arguments.length){return i
}i=A;
return r
};
r.chartPadding=function(A){if(!arguments.length){return d
}d=A;
return r
};
r.seriesState=function(A){if(!arguments.length){return p
}p=A;
p.on("enableChange.legend",this._onSeriesEnableChange);
return r
};
r.validOrientations=function(A){if(!arguments.length){return f
}f=A;
return r
};
r.orientation=function(A){if(!arguments.length){return e
}e=A;
return r
};
r.interactive=function(A){if(!arguments.length){return u
}u=A;
return r
};
r.mapping=function(){return m
};
r.isVertical=function(){return l
};
return r
}
}(this));
(function(a){d3.anomaly=function(){var S={},an,K={x:"date",y:"deviation"},ag,s=[50,25],m=true,aq=6,d=false,ab=null,ae,ar,J=7,aj,ac,i,Z=d3.dispatch("select","mouseover","mouseout"),ap,Y=d3.time.scale(),X=d3.scale.linear(),C,e,c,k,D,W,aa,f,ad,ak,g,l,v;
var ao=8,I=1,r=86400000;
d3.rebind(S,Z,"on");
S.data=function(p){if(!arguments.length){return an
}an=p;
v=null;
return S
};
S.mappings=function(p){if(!arguments.length){return K
}K=w(K,p);
return S
};
S.xUpperLimit=function(p){if(!arguments.length){return ac
}ac=p;
return S
};
S.xLowerLimit=function(p){if(!arguments.length){return i
}i=p;
return S
};
S.normalizePositive=function(p){if(!arguments.length){return d
}d=p;
return S
};
S.xTicks=function(at,p){if(!arguments.length){return p!==undefined?[J,aj]:this.xTicks
}var au=!!(at&&at.constructor&&at.call&&at.apply);
J=(au)?d3.functor(at):at;
aj=au?p:undefined;
return this
};
S.bins=function(p){if(!arguments.length){return aq
}aq=p;
return S
};
S.size=function(p){if(!arguments.length){return s
}s=p;
return S
};
S.interactive=function(p){if(!arguments.length){return m
}m=p;
return S
};
S.parent=function(p){if(!arguments.length){return ab
}ab=p;
return S
};
S.anomalyWidth=function(){return ae
};
S.anomalyHeight=function(){return ar
};
S.layout=function(){if(!S.data()||!S.data().length){throw new A()
}if(!S.parent()){throw new L()
}ad=al("x");
ak=al("y");
R();
N();
l=h();
k=M();
X.domain([W[0],W[W.length-1]]);
U();
l.attr("transform","translate("+ag.left+","+ag.top+")");
u(l,c,e);
T();
ai();
return S
};
S.nodes=function(p){if(!g){throw new Error("layout must be called before nodes may be requested.")
}g.selectAll(".anom-anomaly").each(p)
};
function w(p,at){for(var au in at){p[au]=at[au]
}return p
}function U(){var p=l.append("g").classed("temp-axis",true);
u(p,s[0],s[1]);
ag=V(p);
c=s[0]-ag.left-ag.right;
e=s[1]-ag.top-ag.bottom;
p.remove()
}function V(au){var av=au.node().getBBox(),at=Math.abs(av.x),p=Math.abs(av.y);
return{left:at,top:p,right:av.width-s[0]-at,bottom:av.height-s[1]-p}
}function R(){var p=j(an,function(ax){return Date.parse(ax[ad])
},[i,ac]);
var at=j(an,function(ax){return ax[ak]
});
Y.domain(p);
var aw=Y.ticks(J,aj);
var av=(+aw[1])-(+aw[0]);
p[1]=av+(+aw[aw.length-1]);
p[0]=(+aw[0]>p[0])?(+aw[0]-av):p[0];
Y.domain(p);
f=Y.ticks(J,aj);
var au=Math.max(Math.abs(at[0]),Math.abs(at[1]));
if(d){X.domain([0,au]);
C=d3.scale.linear().domain([-au,au])
}else{X.domain([-au,au]);
C=d3.scale.linear().domain(X.domain())
}C.domain([0,1/10,1/5,3/10,2/5,0.5,3/5,7/10,4/5,9/10,1].map(C.invert));
C.range(["#3C476F","#485485","#53659C","#6C7CAF","#99A2BC","#C5C5C5","#ACC997","#90C867","#7CBC4B","#6FA744","#64913E"])
}function j(av,p,au){var at=[];
if(arguments.length<3||(au[0]===undefined&&au[1]===undefined)){at=d3.extent(av,p)
}else{at[0]=(au[0]===undefined)?d3.min(av,p):au[0];
at[1]=(au[1]===undefined)?d3.max(av,p):au[1]
}return at
}function N(){aa=d3.svg.brush().x(Y).y(X).on("brushstart",O).on("brush",o).on("brushend",am)
}function O(at){E()
}function o(at){l.selectAll(".extent").style("opacity",1);
E()
}function am(at){l.selectAll(".extent").style("opacity",0);
E()
}function E(){var at=aa.extent(),p={left:Math.min(Y(at[0][0]),Y(at[1][0])),right:Math.max(Y(at[0][0]),Y(at[1][0])),top:Math.min(X(at[0][1]),X(at[1][1])),bottom:Math.max(X(at[0][1]),X(at[1][1]))};
var au=l.selectAll(".anom-anomaly").filter(function(aw,av){return P({left:aw.bounds.x,right:aw.bounds.x+aw.bounds.width,top:aw.bounds.y,bottom:aw.bounds.y+aw.bounds.height},p)
});
if(v&&b(au[0],v[0])){return
}v=au;
Z.select(au)
}function b(av,au){if(av.length!=au.length){return false
}for(var p=0,at=av.length;
p<at;
p++){if(au.indexOf(av[p])===-1){return false
}}return true
}function P(at,p){return !(p.left>at.right||p.right<at.left||p.top>at.bottom||p.bottom<at.top)
}function h(){g=d3.select(ab);
var at=g.selectAll("svg").data([an]);
at.enter().append("svg");
at.exit().remove();
at.attr("width",s[0]).attr("height",s[1]);
var p=at.selectAll(".anom-container").data([0]);
p.enter().append("g").classed("anom-container",true);
return p
}function M(){W=X.ticks(aq);
var p=W[1]-W[0];
W.push(p+W[W.length-1]);
if(!d){W.unshift(W[0]-p)
}an=H(an);
n(an);
var at=B(an);
G(W,at);
return at
}function H(au,p){var at=Y.domain();
return au.filter(function(aw){var av=new Date(aw[ad]);
return av>=at[0]&&av<at[1]
})
}function n(p){p.sort(function(au,at){au=new Date(au[ad]);
at=new Date(at[ad]);
return au<at?-1:au>at?1:0
})
}function B(p){return d3.nest().key(function(aw){var at=Date.parse(aw[ad]),av=0;
var au=-1,ax=f.length;
while(++au<ax){if(+f[au]>+at){break
}av=au
}return +f[av]
}).entries(p)
}function G(p,at){at.forEach(function(au){au.values=d3.layout.histogram().bins(p).value(function(av){return d?Math.abs(av[ak]):av[ak]
})(au.values);
D=au.values[0].dx
})
}function Q(at){var az=new Date(0),aw=f.length,ay=Math.max(Math.ceil((f.length-1)/(at/70)),1),ax=d3.time.format("%b %e, %Y"),av=d3.time.format("%b %e"),p=d3.time.format("%a %e"),au=d3.time.format("%I:%M %p");
return function(aC,aA){var aB="";
if(aA===aw-1||(aA%ay!==0)){return""
}else{if(aA===0||az.getYear()!==aC.getYear()){aB=ax(aC)
}else{if(az.getMonth()!==aC.getMonth()){aB=av(aC)
}else{if(az.getDate()!==aC.getDate()){aB=p(aC)
}else{if(az.getHours()!==aC.getHours()){aB=au(aC)
}}}}}az=aC;
return aB
}
}function u(at,aA,ay){var ax=f.length,aB=(f.length>1&&(+f[1]-+f[0]<=r)),av;
Y.rangeRound([0,aA]);
X.rangeRound([ay,0]);
var az=at.selectAll(".anom-axes").data([0]);
az.enter().append("g").classed("anom-axes",true);
var aw=az.selectAll(".anom-axis").data(["x","y"]);
aw.enter().append("g").attr("class",function(aC){return"anom-"+aC+" anom-axis"
});
var au=az.selectAll(".anom-x").attr("transform","translate(0,"+ay+")").call(d3.svg.axis().scale(Y).ticks(J,aj).orient("bottom").tickSize(-ay).tickPadding(20).tickFormat(Q(aA)));
au.selectAll("text").style("text-anchor","start");
au.selectAll("line").style("opacity",function(aD,aC){if(aC===ax-1){return 0
}if(aB&&(aD.getDay()===6||aD.getDay()===1)&&aD.getHours()===0&&aC<ax-1){return 0.3
}return null
});
var p=az.selectAll(".anom-y").call(d3.svg.axis().scale(X).tickValues(W).orient("left").tickSize(-aA).tickPadding(10).tickFormat(function(aD,aC){if(aC===0||aC===Math.floor(W.length/2)||aC===(W.length-1)){return(Math.round(aD*100000)/100000)+"%"
}return""
}));
if(!d){p.selectAll("line").filter(function(aD,aC){return aD===0
}).style("stroke-dasharray","4 4").style("opacity",0.7)
}}function ai(){var aw=Math.round((W.length>1)?X(W[0])-X(W[1]):e)-1,aA=Math.round(af(aw))-1;
var ay=l.selectAll(".anom-plot").data([k]);
ay.enter().append("g").classed("anom-plot",true);
ay.exit().remove();
var ax=ay.selectAll(".anom-column").data(function(aC){return aC
});
ax.enter().append("g").classed("anom-column",true);
ax.exit().remove();
ax.attr("transform",function(aC){return"translate("+Y(+aC.key)+",0)"
});
var aB=ax.selectAll(".anom-row").data(function(aC){return aC.values
});
aB.enter().append("g").classed("anom-row",true);
aB.exit().remove();
aB.attr("transform",function(aD,aC){return"translate(0,"+(X(W[aC])-aw)+")"
});
var at=aB.selectAll(".anom-anomaly").data(function(aC){return aC
});
var az=at.enter().append("g").classed("anom-anomaly",true);
at.attr("transform",function(aD,aC){var aE=t(d?Math.abs(aD[ak]):aD[ak]);
if(aD[ak]>=0){aE+=D
}aD.bounds={x:Y(Date.parse(aD[ad]))+(aC*(aA+I)+I),y:X(aE),width:aA,height:aw};
return"translate("+(aC*(aA+I)+I)+",0)"
});
at.exit().remove();
az.append("rect").classed("anom-cell",true).attr("x",aA/2).attr("y",aw/2).attr("width",0).attr("height",0);
at.selectAll(".anom-cell").attr("fill",function(aC){var aD=t(d?Math.abs(aC[ak]):aC[ak]);
if(d&&aC[ak]<0){aD*=-1
}return C(aD)
}).transition().duration(500).attr("x",0).attr("y",0).attr("width",aA).attr("height",aw);
var av=az.append("g").classed("anom-select",true);
av.append("path").classed("outer-border",true);
av.append("path").classed("inner-border",true);
var au=at.selectAll(".anom-select");
au.select(".outer-border").attr("d",q(0,0,aA+0.5,aw+0.5,1));
if(aA>3){au.select(".inner-border").attr("d",q(0,0,aA+1,aw+1,2))
}var p=az.append("rect").classed("anom-hit-area",true);
p.on("mouseover",function(aD,aC){Z.mouseover(this,aD,aC)
}).on("mouseout",function(aD,aC){Z.mouseout(this,aD,aC)
}).on("mousedown",function(aF,aC){aa.clear();
var aE=d3.mouse(l.node()),aG=Y.invert(aE[0]),aD=X.invert(aE[1]);
aa.extent([[aG,aD],[aG,aD]])
}).on("click",function(aD,aC){Z.select(d3.select(this))
}).style("cursor","crosshair").style("opacity",0).attr("x",0).attr("y",0).attr("width",aA).attr("height",aw)
}function T(){var p=l.selectAll(".anom-plot").data([0]);
p.enter().append("g").classed("anom-plot",true);
p.exit().remove();
p.call(aa)
}function q(at,aw,av,p,au){return"M"+au+","+au+"L"+(av-au*2)+","+au+"L"+(av-au*2)+","+(p-au*2)+"L"+au+","+(p-au*2)+"z"
}function t(au){var p=-1,at=W.length;
while(++p<at){if(au>=0&&W[p]+D>au){return W[p]
}if(au<0&&W[p]+D>au){return W[p]+D
}}return W[0]
}function af(at){var p=((f.length>1)?Y(f[1])-Y(f[0]):c)-ao,au=z();
ae=p/au;
return(ae>at)?at:ae
}function z(){var p=0;
k.forEach(function(at){at.values.forEach(function(au){p=Math.max(au.length,p)
})
});
return p
}function al(p){if(K[p]===undefined){throw new ah(p)
}return K[p]
}function ah(p){this.type="MappingNotDefinedException";
this.message="The mapping for property "+p+" was not defined.";
this.toString=function(){return this.type+" - "+this.message
}
}function A(){this.type="EmptyDataException";
this.message="The data is empty or null";
this.toString=function(){return this.type+" - "+this.message
}
}function L(){this.type="ParentNotSpecifiedException";
this.message="A p was not specified for this visualization";
this.toString=function(){return this.type+" - "+this.message
}
}return S
}
}(this));
(function(e){var g=e.cloudViz||{},a=g.core||{},c=e.dv||{},d=e.d3||{},b=Object.create(a),f=400;
b.init=function(h){this._type="pathing";
this._initDefaultOptions();
this.setOptions(h);
this._pathLocked=null;
this._pathedObj=null;
this._activePaths=[];
this._lineLocked=null;
this._lastSide=0;
return this
};
b._initDefaultOptions=function(){var i="Visits",h={mappings:{},colors:["#3287d2","#9b8ce6","#d755a5","#fa5a50","#f0a01e","#c3d250","#5faf69","#1ebed7","#5a6eaa","#78b4f5","#aa5fa5","#f0557d","#e8782d","#f5c841","#8cc350","#3cb5a0","#286eaf","#826ee1","#b93282","#f04641","#e18c00","#a0b400","#50965a","#00a0be","#465a87","#4196e6","#964196","#dc3c69","#dc5f00","#e6b43c","#7daf4b","#32a08c"],nodeWidth:100,minNodeHeight:1,avgNodeHeight:30,padding:{top:80,left:30,right:30,bottom:20},metricName:i,minNodeHorzPadding:80,nodeVertPadding:34,iterations:32,pivotNode:null,collapseNode:null,expandNode:null,pathSelected:null};
return Object.getPrototypeOf(b)._initDefaultOptions.call(this,h)
};
b._onAutoResize=function(){this.render()
};
b.reset=function(){Object.getPrototypeOf(b).reset.apply(this,arguments)
};
b._preRender=function(){Object.getPrototypeOf(b)._preRender.apply(this);
var u=this._options,s=d.select(u.parent),r=u.padding;
var p=s.selectAll(".pathing-cv-info-wrapper").data([0]);
p.enter().insert("div",":first-child").classed("pathing-cv-info-wrapper",true);
var h=p.selectAll(".pathing-cv-wrapper").data([0]);
h.enter().insert("div",":first-child").classed("pathing-cv-wrapper",true);
var i=h.selectAll(".pathing-cv-container").data([0]);
i.enter().insert("div",":first-child").classed("pathing-cv-container",true);
var n=i.selectAll(".pathing-svg").data([0]);
n.enter().append("svg").classed("pathing-svg",true);
var t=n.selectAll(".pathing-svg-container").data([0]);
t.enter().append("g").classed("pathing-svg-container",true);
t.attr("transform","translate("+r.left+","+r.top+")");
var j=p.selectAll(".pathing-cv-info-pane").data([0]);
j.enter().append("div").classed("pathing-cv-info-pane",true);
j.exit().remove();
var m=j.selectAll(".info-pane-content").data([0]);
m.enter().append("div").classed("info-pane-content",true);
m.exit().remove();
var k=m.selectAll(".pathing-cv-info-title").data([0]);
k.enter().append("div").classed("pathing-cv-info-title",true);
k.exit().remove();
var l=m.selectAll(".pathing-cv-info-value").data([0]);
l.enter().append("div").classed("pathing-cv-info-value",true);
l.exit().remove();
var o=m.selectAll(".pathing-cv-info-paths").data([0]);
o.enter().append("div").classed("pathing-cv-info-paths",true);
o.exit().remove();
this._sizeChart();
this._createGradients(n);
var q=this._pathedObj;
if(this._changedOptions&&this._changedOptions.data&&q){if(this._isDataObjNode(q.data)){this._unlockNode(q.data,q.elem)()
}else{this._unlockLink(q.data,q.elem)()
}}else{i.on("mousemove.node",null).on("click.node",null).on("click.link",null);
this._removePathOverlays(i);
this._removeNodeOptions(true);
this._defaultInformation()
}},b._render=function(){Object.getPrototypeOf(b)._render.apply(this);
if(!this._dataAdapter.isValidPathingData()){return
}this._createDiagram();
var h=this._pathedObj;
if(this._activePaths.length&&h){if(this._isDataObjNode(h.data)){this._renderNodePaths(h.data,h.elem,true);
this._showNodeOptions(h.data,h.elem)
}else{this._renderLinkPaths(h.data,h.elem,true)
}}};
b._postRender=function(){Object.getPrototypeOf(b)._postRender.apply(this)
};
b._sizeChart=function(v){clearTimeout(this._wrapperAnimation);
clearTimeout(this._scrollAnimation);
var k=this._options,I=this._dataAdapter.data(),p=d.select(k.parent),B=this,u=p.selectAll(".pathing-cv-info-wrapper"),m=u.selectAll(".pathing-cv-wrapper"),s=m.selectAll(".pathing-cv-container"),j=u.selectAll(".pathing-cv-info-pane"),r=k.parent.offsetWidth,i=k.parent.offsetHeight,D=c.util.getPercentValue(k.width,r),w=c.util.getPercentValue(k.height,i),t=D-parseInt(j.style("width"),10),z=k.padding;
var C=I&&I.nodes||[],l=this._numColumns=C.length&&(Math.max.apply(null,C.map(function(J){return J.column
}))+1)||1,H=[],E=0;
I.nodes.forEach(function(K,J){if(H[K.column]){H[K.column]++
}else{H[K.column]=1
}});
E=H.length&&Math.max.apply(null,H)||0;
var q=t-2,A=w-2,h=(l*k.nodeWidth)+((l-1)*k.minNodeHorzPadding)+z.left+z.right,n=(E*k.avgNodeHeight)+(E*k.nodeVertPadding)+z.top+z.bottom,o=h>t,G=n>w;
m.classed("is-wider",o);
if(o){q=h;
A-=20
}m.classed("is-taller",G);
if(G){A=n;
q-=20
}u.style("width",D+"px").style("height",w+"px");
m.style("width",t+"px").style("height",w+"px");
s.style("width",q+"px").style("height",A+"px")
};
b._getInnerDimensions=function(){var j=this._options,l=j.padding,i=d.select(j.parent).select(".pathing-cv-container"),k=parseInt(i.style("width"),10),h=parseInt(i.style("height"),10);
return[k-l.right-l.left,h-l.top-l.bottom]
};
b._createDiagram=function(){var s=this._options,j=this._dataAdapter.data(),i=d.select(s.parent).selectAll(".pathing-cv-container"),o=parseInt(i.style("width"),10),r=parseInt(i.style("height"),10),q=this._path=d.pathing().nodeWidth(s.nodeWidth).nodePadding(s.nodeVertPadding).size(this._getInnerDimensions()).nodes(j.nodes).links(j.links).minNodeHeight(s.minNodeHeight).layout(s.interations);
if(!j.nodes.some(function(h){return h.column!==0
})){var p=q.nodeWidth(),n=s.padding;
j.nodes.forEach(function(h){h.x+=((o-n.left-n.right)/2)-(p/2)
})
}var m=this._updateLinks(q,j.links);
this._updateNodes(q,j.nodes,m,r);
var l=d.select(s.parent).select(".pathing-svg").node();
l.style.display="none";
var k=l.offsetHeight;
l.style.display=""
};
b._updateNodes=function(w,i,p,u){var v=this,z=this._options,m=d.select(z.parent).select(".pathing-svg-container"),l=this._options.onNodeSelect,r=this._options.padding,q=(!this._changedOptions||!this._changedOptions.data),h=(q)?0:f;
function t(B){var A=u-this.getBBox().height-r.bottom;
d.select(this).attr("transform","translate("+B.x+","+(B.y=Math.max(0,Math.min(A,d.event.y)))+")");
w.relayout();
p.attr("d",w.link())
}var o=m.selectAll(".node-container").data([0]);
o.enter().append("g").classed("node-container",true);
o.exit().remove();
var j=o.selectAll(".node").data(i,this._dataAdapter.nodeKey()),s=w.nodeWidth();
j.enter().append("g").classed("hide-node",true).attr("transform",function(A){return"translate("+A.x+",0)"
});
j.on("mouseover.node",function(B,A){v._showNodePaths(B,this)
}).on("mouseout.node",function(B,A){v._hideNodePaths()
}).on("click.node",function(B,A){v._activateNode(B,this)
});
var n=j.exit();
n.classed("hide-node",true).on("mouseover.node",null).on("mouseout.node",null).on("click.node",null).transition().duration(h).style("opacity",0).attr("transform",function(A){return"translate("+A.x+",0)"
});
setTimeout(function(){n.remove()
},h);
j.transition().duration(h).attr("transform",function(A){return"translate("+A.x+","+A.y+")"
});
var k=this._numColumns;
j.each(function(G,B){var E=d.select(this),D=E.classed("hide-node");
E.attr("class","node");
E.classed("hide-node",D);
E.classed("filter",G.id==="E_0");
E.classed("exit-filter",G.id==="X_0");
if(G.classname){E.classed(G.classname,true)
}var I=E.selectAll(".node-bg").data([G]);
I.enter().append("rect").classed("node-bg",true);
I.exit().remove();
I.attr("width",s);
I.transition().duration(h).attr("height",function(L){return L.dy
});
function K(O){var M=true,N=false,L=false;
if(k>1){N=(0===O.column);
L=(k-1===O.column);
M=!(N||L)
}d.select(this).attr("x",(M)?s/2:(N)?2:s-4).attr("text-anchor",(M)?"middle":(N)?"start":"end")
}function H(N){var M=20,O=10,L="\u2026";
if(N.length<M){return N
}return N.slice(0,M-O)+L+N.slice(N.length-O)
}var J=E.selectAll(".node-title").data([G]);
J.enter().append("text").classed("node-title",true).attr("y",-5).attr("transform",null);
J.exit().remove();
J.each(K);
J.text(function(L){return H(L.label)
});
var C=E.selectAll(".node-total").data([G]);
C.enter().append("text").classed("node-total",true).attr("y",15).attr("transform",null);
C.exit().remove();
C.each(K);
C.text(function(L){return d.format(",.0f")(L.value)
});
var A=E.selectAll(".node-hit-area").data([G]);
A.enter().append("rect").classed("node-hit-area",true);
A.exit().remove();
A.attr("height",function(L){return L.dy+4
}).attr("y",-4).attr("width",w.nodeWidth()).style("opacity",0);
setTimeout(function(){E.classed("hide-node",false)
},h)
})
};
b.gradientCounter={count:0};
b._updateLinks=function(u,p){var v=this._options,t=this,n=d.select(v.parent).select(".pathing-svg-container"),j=d.select(v.parent).selectAll("svg"),l=j.selectAll("defs").data([0]),q=(!this._changedOptions||!this._changedOptions.data),i=(q)?0:f;
l.enter().append("defs");
var r=l.selectAll(".path-fills").data([0]),s=r.enter().append("g").classed("path-fills",true);
var h=n.selectAll(".link-container").data([0]);
h.enter().append("g").classed("link-container",true);
h.exit().remove();
var k=n.selectAll(".path-overlay-container").data([0]);
k.enter().append("g").classed("path-overlay-container",true);
k.exit().remove();
var o=h.selectAll("path").data(p,this._dataAdapter.linkKey());
o.enter().append("path").classed("hide-link",true);
o.on("mouseover.link",function(z,w){t._showLinkPaths(z,this)
}).on("mouseout.link",function(z,w){t._hideLinkPaths()
}).on("click.link",function(z,w){t._activateLink(z,this)
});
var m=o.exit();
m.classed("hide-link",true).on("click.link",null).on("mouseover.link",null).on("mouseout.link",null);
setTimeout(function(){m.remove()
},i);
o.each(function(D,A){var C=d.select(this),w=C.classed("hide-link");
C.attr("class",function(E){return !E.source?"entry":!E.target?"exit":"link"
});
C.classed("hide-link",w);
if(C.classed("hide-link")){C.attr("d",u.link()(D));
setTimeout(function(){C.classed("hide-link",false)
},i)
}else{C.transition().duration(i).attr("d",u.link()(D))
}if(D.source&&"E_0"===D.source.id){C.classed("entry-path",true)
}else{if(D.target&&"X_0"===D.target.id){C.classed("exit-path",true)
}}var B=D.source&&"E_0"===D.source.id,z=D.target&&"X_0"===D.target.id;
C.classed("filter",B);
C.classed("exit-filter",z)
});
return o
};
b._createGradients=function(m){var t=m.selectAll("style").data([0]);
t.enter().append("style");
t.text(function(z){var w=".pathing-svg .exit { fill: url(#exitFill); } \n";
w+=".pathing-svg .entry { fill: url(#entryFill); } \n";
w+=".pathing-svg .exit:hover { fill: url(#exitHighlightFill); } \n";
w+=".pathing-svg .entry:hover { fill: url(#entryHighlightFill); } \n";
w+=".pathing-svg .pivot-entry { mask: url(#pivotEnterMask); } \n";
w+=".pathing-svg .pivot-exit { mask: url(#pivotExitMask); } \n";
w+=".pathing-svg .link-container .entry-path { fill: url(#entryGradient); } \n";
w+=".pathing-svg .link-container .exit-path { fill: url(#exitGradient); } \n";
return w
});
var j=m.selectAll("defs").data([0]);
j.enter().append("defs");
var s=j.selectAll(".bounce-fills").data([0]),u=s.enter().append("g").classed("bounce-fills",true);
var o=u.append("linearGradient").attr("id","pivotEnterGrad");
o.append("stop").attr("offset","0%").style("stop-color","#fff").style("stop-opacity",0);
o.append("stop").attr("offset","50%").style("stop-color","#fff").style("stop-opacity",0);
o.append("stop").attr("offset","70%").style("stop-color","#fff").style("stop-opacity",0.5);
o.append("stop").attr("offset","100%").style("stop-color","#fff").style("stop-opacity",1);
var q=u.append("mask").attr("id","pivotEnterMask").attr("x","0").attr("y","0").attr("width","1").attr("height","1").attr("maskUnits","objectBoundingBox").attr("maskContentUnits","objectBoundingBox");
q.append("rect").attr("x","0").attr("y","0").attr("width","1").attr("height","1").attr("fill","url(#pivotEnterGrad)");
var k=u.append("linearGradient").attr("id","pivotExitGrad").attr("x1","100%").attr("y1","0%").attr("x2","0%").attr("y2","0%");
k.append("stop").attr("offset","0%").style("stop-color","#fff").style("stop-opacity",0);
k.append("stop").attr("offset","50%").style("stop-color","#fff").style("stop-opacity",0);
k.append("stop").attr("offset","70%").style("stop-color","#fff").style("stop-opacity",0.5);
k.append("stop").attr("offset","100%").style("stop-color","#fff").style("stop-opacity",1);
var n=u.append("mask").attr("id","pivotExitMask").attr("x","0").attr("y","0").attr("width","1").attr("height","1").attr("maskUnits","objectBoundingBox").attr("maskContentUnits","objectBoundingBox");
n.append("rect").attr("x","0").attr("y","0").attr("width","1").attr("height","1").attr("fill","url(#pivotExitGrad)");
var i=u.append("linearGradient").attr("id","entryGradient").attr("x1","0%").attr("y1","100%").attr("x2","100%").attr("y2","100%");
i.append("stop").attr("offset","0%").style("stop-color","#8cc350");
i.append("stop").attr("offset","100%").style("stop-color","#3287D2");
var p=u.append("linearGradient").attr("id","exitGradient").attr("x1","0%").attr("y1","100%").attr("x2","100%").attr("y2","100%");
p.append("stop").attr("offset","0%").style("stop-color","#3287D2");
p.append("stop").attr("offset","100%").style("stop-color","#cc2539");
var l=u.append("linearGradient").attr("id","exitFill").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");
l.append("stop").attr("offset","0%").style("stop-color","#FA5A50").style("stop-opacity",0.5);
l.append("stop").attr("offset","85%").style("stop-color","#FA5A50").style("stop-opacity",0.5);
l.append("stop").attr("offset","100%").style("stop-color","#FA5A50").style("stop-opacity",0.1);
var v=u.append("linearGradient").attr("id","exitHighlightFill").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");
v.append("stop").attr("offset","0%").style("stop-color","#FA5A50").style("stop-opacity",1);
v.append("stop").attr("offset","85%").style("stop-color","#FA5A50").style("stop-opacity",1);
v.append("stop").attr("offset","100%").style("stop-color","#FA5A50").style("stop-opacity",0.1);
var r=u.append("linearGradient").attr("id","entryFill").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");
r.append("stop").attr("offset","0%").style("stop-color","#58AF5E").style("stop-opacity",0.1);
r.append("stop").attr("offset","15%").style("stop-color","#58AF5E").style("stop-opacity",0.5);
r.append("stop").attr("offset","100%").style("stop-color","#58AF5E").style("stop-opacity",0.5);
var h=u.append("linearGradient").attr("id","entryHighlightFill").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");
h.append("stop").attr("offset","0%").style("stop-color","#58AF5E").style("stop-opacity",0.1);
h.append("stop").attr("offset","15%").style("stop-color","#58AF5E").style("stop-opacity",1);
h.append("stop").attr("offset","100%").style("stop-color","#58AF5E").style("stop-opacity",1)
};
b._setOptionContainerContent=function(h,l){var t=this._options,n="",j,r=0,p=h.classed("is-last-column"),o=this._dataAdapter,s=o.l10n.labels.pathing,m=[{id:"expand",label:s.expand,valid:(t.expandNode&&o.canExpandNode(l))},{id:"pivot",label:s.focus,valid:(t.pivotNode&&o.canPivotNode(l))},{id:"collapse",label:s.collapse,valid:(t.collapseNode&&o.canCollapseNode(l))}];
if(p){m.reverse()
}m=m.filter(function(i){return i.valid
});
if(t.expandNode||t.collapseNode||t.pivotNode){for(var k=0,q=m.length;
k<q;
++k){j=m[k];
n+='<a class="cv-node-option cv-node-option'+((p)?(q-r-1):r)+" cv-node-"+j.id+'"><i class="'+j.id+'"></i><span>'+j.label+"</span></a>";
++r
}}n='<div class="cv-node-options num-options-'+r+'">'+n+"</div>";
h.html(n)
};
b._activateNode=function(k,j){var h=this;
if(this._pathLocked&&k===this._pathLocked.data){h._unlockNode(k,j)();
var i=(d.mouse(j)[0]>=h._options.nodeWidth/2)?1:-1;
if(!k.isPivot||i===h._lastSide){return
}}this._setPathLocked({data:k,elem:j});
d.select(h._options.parent).select(".pathing-cv-container").on("click.node",null).on("click.link",null);
d.selectAll(".cv-node-active").classed("cv-node-active",false);
d.selectAll(".cv-link-active").classed("cv-link-active",false);
d.select(j).classed("cv-node-active",true);
this._renderNodePaths(k,j);
this._showNodeOptions(k,j);
this._showInformation(k,j);
this._scrollToElem(j);
setTimeout(function(){d.select(h._options.parent).select(".pathing-cv-container").on("click.node",h._unlockNode(k,j))
},10)
};
b._showNodePaths=function(i,h){if(this._pathLocked){return
}this._renderNodePaths(i,h)
};
b._renderNodePaths=function(m,k,j){var p=d.select(this._options.parent).select(".pathing-cv-container");
clearTimeout(this._hidePathOverlaysTimer);
p.on("mousemove.node",null);
if(this._pathedObj&&this._pathedObj.data===m&&!j){return
}this._setPathedObj({data:m,elem:k});
var n=0,q=this,i,r,o=this._dataAdapter.nodePaths(m);
function l(){r=q._activePaths=o.filter(function(t){var s=t.nodes.indexOf(m._pid);
return(n>0&&s+1<t.nodes.length)||(n<0&&s>0)
});
i=q._dataAdapter.nodePathData(r,m,n);
q._createPathOverlays(i)
}function h(){var s=0;
try{s=d.mouse(k)[0]
}catch(u){}var t=(s>=q._options.nodeWidth/2)?1:-1;
if(t!==n){q._lastSide=n=t;
l()
}}if(m.isPivot){if(j){n=q._lastSide;
l()
}else{h();
if(!q._pathLocked){p.on("mousemove.node",function(t,s){h()
})
}}}else{q._lastSide=0;
q._activePaths=o;
i=this._dataAdapter.nodePathData(o,m,n);
q._createPathOverlays(i)
}setTimeout(function(){p.classed("path-overlays",true)
},1)
};
b._showNodeOptions=function(n,l){var t=this,m=this._numColumns,r=d.select(this._options.parent).select(".pathing-cv-container"),p=r.node(),u=this._options,o=50,i=d.select(l).select(".node-bg").node(),s=p.getBoundingClientRect(),k=i.getBoundingClientRect(),q=k.top-s.top,j=k.left-s.left+(u.nodeWidth/2),h=r.select(".cv-path-node-options");
if(h.empty()){h=r.append("div").classed("cv-path-node-options",true).attr("node",n._pid)
}else{if(h.attr("node")==n._pid&&h.classed("is-open")){}else{this._removeNodeOptions();
o=300;
h=r.append("div").classed("cv-path-node-options",true).attr("node",n._pid)
}}h.classed("is-last-column",(m>1&&m-1===n.column)).style("top",q+"px").style("left",j+"px");
this._setOptionContainerContent(h,n);
setTimeout(function(){h.classed("is-open",true)
},o)
};
b._formatMetricValue=function(h){return this._formatNumber("decimal",h.value)+" "+this._options.metricName
};
b._formatPathInformation=function(k){var j=this._options,i=this,h=j.colors;
return function(r,m){var l=i._dataAdapter.getPathEnd(r),p=l?(l.value)?l.value:k:k,o="",q=r.values[0],n=q/p;
m=m%h.length;
o+='<span class="pathing-path-marker" style="background-color: '+h[m]+'"></span>';
o+='<span class="pathing-path-value"><span class="pathing-path-num">'+i._formatNumber("decimal",q)+'</span> <span class="pathing-path-perc">'+i._formatNumber("percent",n)+"</span></span>";
return o
}
};
b._highlightPath=function(k,l,j){var r=this._options,n=r.parent,m=d.event,o=!m||(m&&"click"===m.type),i=d.select(n).selectAll(".path-overlay-container"),h=d.select(n).selectAll(".pathing-cv-info-pane"),q=i.selectAll(".link.path"+l),p=i.selectAll(".link:not(.path"+l+")");
if(o){if(this._lineLocked===k){this._setLineLock(null);
return this._removeHightlightPath()
}this._setLineLock(k);
h.selectAll(".locked").classed("locked",false);
d.select(j).classed("locked",true)
}else{if(this._lineLocked){return
}}i.selectAll(".link.inactive").classed("inactive",false);
p.classed("inactive",true);
q.classed("active",true)
};
b._setLineLock=function(i){var h=this._options;
if(this._lineLocked===i){return
}this._lineLocked=i;
this._callPathSelected(i)
};
b._setPathedObj=function(h){this._pathedObj=h
};
b._setPathLocked=function(i){var h=this._options;
if(this._pathLocked===i){return
}this._pathLocked=i;
this._callPathSelected()
};
b._callPathSelected=function(j){var k={},h=this._options,i=this._pathLocked&&this._pathLocked.data||{};
if(j){k.path=j.nodes+""
}if("undefined"!==typeof i._pid){k.node=i._pid;
k.side=this._lastSide
}if("undefined"!==typeof i.source||"undefined"!==typeof i.target){k.source=(i.source)?i.source._pid:null;
k.target=(i.target)?i.target._pid:null
}if("function"==typeof h.pathSelected){h.pathSelected(k,this._pathLocked,j)
}};
b._removeHightlightPath=function(){if(this._lineLocked){return
}var i=this._options,j=i.parent,k=d.select(j).selectAll(".pathing-cv-info-pane"),h=d.select(j).selectAll(".path-overlay-container").selectAll(".link");
h.classed("inactive",false).classed("active",false);
k.selectAll(".locked").classed("locked",false)
};
b._showInformation=function(B,z){var n=this,h=this._options,v="",u=this._isDataObjNode(B),i=this._dataAdapter.l10n.labels.pathing,r=d.select(this._options.parent).select(".pathing-cv-info-pane"),j=r.selectAll(".pathing-cv-info-title"),C=r.selectAll(".pathing-cv-info-value"),A=r.selectAll(".pathing-cv-info-paths");
this._setLineLock(null);
this._removeHightlightPath();
var l,t=this._formatMetricValue(B),m=false;
if(u){l=B.label;
t=this._formatMetricValue(B);
m=(B.column==this._numColumns-1)
}else{var w=i.percOfNode;
if(!B.source){l=i.nodeEntries.replace(/\{label\}/i,B.target.label);
t=this._formatMetricValue(B)+'<span class="perc">'+w.replace(/\{perc\}/i,this._formatNumber("percent",B.value/B.target.value)).replace(/\{label\}/i,B.target.label)+"</span>"
}else{if(!B.target){l=i.nodeExits.replace(/\{label\}/i,B.source.label);
t=this._formatMetricValue(B)+'<span class="perc">'+w.replace(/\{perc\}/i,this._formatNumber("percent",B.value/B.source.value)).replace(/\{label\}/i,B.source.label)+"</span>"
}else{var p=this._dataAdapter,q=p.getPathDirection(p.data().paths[B.paths[0]]),s=(q<0)?B.target:B.source;
l=i.nodeToNode.replace(/\{source\}/i,B.source.label).replace(/\{target\}/i,B.target.label);
t=this._formatMetricValue(B)+'<span class="perc">'+w.replace(/\{perc\}/i,this._formatNumber("percent",B.value/s.value)).replace(/\{label\}/i,s.label)+"</span>"
}}}r.classed("is-last-column",m);
j.html(l);
C.html(t);
var k=A.selectAll(".pathing-cv-path-title").data([0]);
k.enter().append("span").classed("pathing-cv-path-title",true);
k.html(this._dataAdapter.activePathsTitle(this._activePaths));
var o=A.selectAll(".pathing-cv-path-info").data(this._activePaths);
o.enter().append("span").classed("pathing-cv-path-info",true);
o.on("click.line",function(E,D){n._highlightPath(E,D,this)
}).on("mouseover.line",function(E,D){n._highlightPath(E,D,this)
}).on("mouseout.line",function(E,D){n._removeHightlightPath()
}).html(this._formatPathInformation(B.value));
o.exit().on("click.line",null).on("mouseover.line",null).on("mouseout.line",null).remove()
};
b._defaultInformation=function(){this._setLineLock(null);
this._removeHightlightPath();
var m=d.select(this._options.parent).select(".pathing-cv-info-pane"),l=m.selectAll(".pathing-cv-info-title"),h=m.selectAll(".pathing-cv-info-value"),k=m.selectAll(".pathing-cv-info-paths"),j=this._dataAdapter.l10n.labels.pathing;
var i="<p>"+j.help1+"</p>";
i+="<p>"+j.help2+"</p>";
i+="<p>"+j.help3+"</p>";
i+='<p><span class="cv-node-option"><i class="pivot"></i></span><span class="cv-option-title">'+j.focus+"</span></p>";
i+="<p>"+j.focusHelp+"</p>";
i+='<p><span class="cv-node-option"><i class="expand"></i></span><span class="cv-option-title">'+j.expand+"</span></p>";
i+="<p>"+j.expandHelp+"</p>";
i+='<p><span class="cv-node-option"><i class="collapse"></i></span><span class="cv-option-title">'+j.collapse+"</span></p>";
i+="<p>"+j.collapseHelp+"</p>";
l.html(j.title);
h.html('<div class="help">'+i+"</div>");
k.html("")
};
b._scrollToElem=function(z){var k=this._options,n=d.select(this._options.parent).select(".pathing-cv-container"),o=n.node(),m=d.select(k.parent).select(".pathing-cv-wrapper"),s=d.select(z),A=(!s.selectAll(".node-bg").empty())?s.select(".node-bg").node():s.node(),w=o.getBoundingClientRect(),i=A.getBoundingClientRect(),q=i.top-w.top,l=i.left-w.left+(k.nodeWidth/2);
if(!m.classed("is-wider")&&!m.classed("is-taller")){return
}function h(B,C){return function(){var D=(B!==null)?d.interpolateNumber(m.node().scrollLeft,B):null,E=(C!==null)?d.interpolateNumber(m.node().scrollTop,C):null;
return function(G){if(D!==null){m.node().scrollLeft=D(G)
}if(E!==null){m.node().scrollTop=E(G)
}}
}
}var t=null,r=null;
if(m.classed("is-wider")){var v=parseInt(m.style("width"),10),u=parseInt(n.style("width"),10);
t=Math.min(u-v,Math.max(0,l-(v/2)))
}if(m.classed("is-taller")){var j=parseInt(m.style("height"),10),p=parseInt(n.style("height"),10);
r=Math.min(p-j,Math.max(0,q+40-(j/2)))
}d.transition().duration(300).tween("scroll",h(t,r))
};
b._unlockNode=function(j,i){var h=this;
return function(l,k){h._setPathLocked(null);
d.select(h._options.parent).select(".pathing-cv-container").on("click.node",null);
h._deactivateNode(d.event,j,i)
}
},b._deactivateNode=function(l,m,i){var k=d.select(l.target),h=this._options,j=m||{};
d.select(i).classed("cv-node-active",false);
this._removeNodeOptions(false);
this._defaultInformation();
this._hideNodePaths();
if("click"===l.type){if(!k.classed("cv-node-option")){k=d.select(k.node().parentNode)
}if(k.classed("cv-node-expand")&&("function"===typeof h.expandNode)){h.expandNode(j)
}if(k.classed("cv-node-collapse")&&("function"===typeof h.collapseNode)){h.collapseNode(j)
}if(k.classed("cv-node-pivot")&&("function"===typeof h.pivotNode)){h.pivotNode(j)
}}};
b._removeNodeOptions=function(i){var h=d.selectAll(".cv-path-node-options");
h.classed("is-open",false);
setTimeout(function(){h.remove()
},(i)?0:300)
};
b._hideNodePaths=function(){var h=d.select(this._options.parent).select(".pathing-cv-container");
h.on("mousemove.node",null);
if(this._pathLocked){return
}this._removePathOverlays(h)
};
b._activateLink=function(j,i){var h=this;
if(this._pathLocked&&j===this._pathLocked.data){h._unlockLink(j,i);
return
}this._setPathLocked({data:j,elem:i});
d.select(h._options.parent).select(".pathing-cv-container").on("click.node",null).on("click.link",null);
d.selectAll(".cv-node-active").classed("cv-node-active",false);
d.selectAll(".cv-link-active").classed("cv-link-active",false);
d.select(i).classed("cv-link-active",true);
this._removeNodeOptions();
this._renderLinkPaths(j,i);
this._showInformation(j,i);
this._scrollToElem(i);
setTimeout(function(){d.select(h._options.parent).select(".pathing-cv-container").on("click.link",h._unlockLink(j,i))
},10)
};
b._showLinkPaths=function(i,h){if(this._pathLocked){return
}this._renderLinkPaths(i,h)
};
b._renderLinkPaths=function(l,k,i){clearTimeout(this._hidePathOverlaysTimer);
if(this._pathedObj&&this._pathedObj.data===l&&!i){return
}this._setPathedObj({data:l,elem:k});
var h=this._dataAdapter;
this._activePaths=h.linkSortActivePaths(l);
this._createPathOverlays(h.linkPathData(this._activePaths));
var j=d.select(this._options.parent).select(".pathing-cv-container");
setTimeout(function(){j.classed("path-overlays",true)
},1)
};
b._unlockLink=function(j,i){var h=this;
return function(l,k){h._setPathLocked(null);
d.select(h._options.parent).select(".pathing-cv-container").on("click.link",null);
h._deactivateLink(d.event,j,i)
}
},b._deactivateLink=function(j,k,i){var h=d.select(this._options.parent).select(".pathing-cv-container");
d.select(i).classed("cv-link-active",false);
this._defaultInformation();
this._hideLinkPaths()
};
b._hideLinkPaths=function(){var h=d.select(this._options.parent).select(".pathing-cv-container");
if(this._pathLocked){return
}this._removePathOverlays(h)
};
b._createPathOverlays=function(i){var j=this._options,l=this._path,h=d.select(j.parent).select(".path-overlay-container"),k=h.selectAll("path").data(i);
k.enter().append("path");
k.exit().remove();
k.attr("class",function(n){var m=(n.pivotStart)?" pivot-entry":(n.pivotEnd)?" pivot-exit":"";
return"link path"+n.path+m
}).attr("d",l.link()).attr("style",function(o,m){var n=o.path%j.colors.length;
return"fill: "+j.colors[n]+";"
}).sort(function(n,m){if(!n&&!m){return 0
}if(!n){return 1
}if(!m){return -1
}return m.dy-n.dy
})
};
b._removePathOverlays=function(h){clearTimeout(this._hidePathOverlaysTimer);
this._setPathedObj(null);
this._hidePathOverlaysTimer=setTimeout(function(){h.classed("path-overlays",false)
},20)
};
b._isDataObjNode=function(h){return("undefined"!==typeof h._pid)
};
b.setActivePath=function(i){var p=this._options,n=this,j=this._dataAdapter.data();
i=i||{};
var m=("undefined"!==typeof i.node),l,h;
if(m){l=j.nodesById[i.node]
}else{l=j.links.filter(function(q){return((!q.source&&!i.source)||(q.source&&i.source&&q.source._pid+""===i.source))&&((!q.target&&!i.target)||(q.target&&i.target&&q.target._pid+""===i.target))
});
l=l.length&&l[0]||null
}h=(m)?".node":".link";
if(!l){return
}var k=false,o;
k=j.paths.some(function(q){o=q.nodes;
return q.nodes.toString()===i.path
});
d.select(p.parent).selectAll(h).each(function(r,q){if(r===l){if(m){n._activateNode(r,this)
}else{n._activateLink(r,this)
}if(!k){return
}d.select(p.parent).selectAll(".pathing-cv-path-info").filter(function(t,s){if(t.nodes.toString()===o.toString()){n._highlightPath(t,s,this)
}})
}})
};
e.cloudViz.pathing=g.util.createConstructor(b)
}(this));
(function(a){d3.pathing=function(){var c={},h=24,j=8,n=[1,1],p=[],g=[],l=NaN,k=0;
c.nodeWidth=function(t){if(!arguments.length){return h
}h=+t;
return c
};
c.nodePadding=function(t){if(!arguments.length){return j
}j=+t;
return c
};
c.nodes=function(t){if(!arguments.length){return p
}p=t;
return c
};
c.links=function(t){if(!arguments.length){return g
}g=t;
return c
};
c.size=function(t){if(!arguments.length){return n
}n=t;
return c
};
c.numColumns=function(){return l
};
c.minNodeHeight=function(t){if(!arguments.length){return k
}k=t;
return c
};
c.layout=function(t){f();
m();
d();
i(t);
e();
return c
};
c.relayout=function(){e();
return c
};
c.link=function(){var u=0.5;
function t(D){var B,A,G,z,w,N,M,K,I,H,E,J,C,v=5,L=15;
J=C=Math.min(D.dy+v,L);
if(D.source===null){B=D.target.x-J;
A=D.target.x;
K=D.target.y-v;
I=D.target.y+D.dy;
return"M"+B+","+K+"h"+J+"v"+(I-K)+"c-"+J+",0,-"+J+",-"+(C/2)+",-"+J+",-"+C+"z"
}if(D.target===null){B=D.source.x+D.source.dx;
A=D.source.x+D.source.dx+J;
K=D.source.y+D.source.dy-D.dy;
I=D.source.y+D.source.dy+v;
return"M"+A+","+I+"h-"+J+"v-"+(I-K)+"c"+J+",0,"+J+","+(C/2)+","+J+","+C+"V"+I+"z"
}B=D.source.x+D.source.dx,A=D.target.x,G=d3.interpolateNumber(B,A),z=G(u),w=G(1-u),N=w+((D.dy<15)?((D.source.y<D.target.y)?-1*D.dy:D.dy):0),M=z+((D.dy<15)?((D.source.y<D.target.y)?-1*D.dy:D.dy):0),K=D.source.y+D.sy,I=D.target.y+D.ty,H=I+D.dy,E=K+D.dy;
return"M"+B+","+K+"C"+z+","+K+" "+w+","+I+" "+A+","+I+"v"+D.dy+"C"+N+","+H+" "+M+","+E+" "+B+","+E+"Z"
}t.curvature=function(v){if(!arguments.length){return u
}u=+v;
return t
};
return t
};
function f(){p.forEach(function(t){t.sourceLinks=[];
t.targetLinks=[];
t.entryLinks=[];
t.exitLinks=[]
});
g.forEach(function(t){var u=t.source,v=t.target;
if(u!==null&&typeof u==="number"){u=t.source=p[t.source]
}if(v!==null&&typeof v==="number"){v=t.target=p[t.target]
}if(u!==null&&v!==null){u.sourceLinks.push(t);
v.targetLinks.push(t)
}else{if(u===null){v.entryLinks.push(t)
}else{u.exitLinks.push(t)
}}})
}function m(){p.forEach(function(u){if(u.hasOwnProperty("total")){u.value=u.total
}else{u.value=Math.max(d3.sum(u.sourceLinks,q)+d3.sum(u.exitLinks,q),d3.sum(u.targetLinks,q)+d3.sum(u.entryLinks,q))
}});
function t(u){return(u.sourceLinks&&u.sourceLinks.length)||(u.targetLinks&&u.targetLinks.length)||(u.exitLinks&&u.exitLinks.length)||(u.entryLinks&&u.entryLinks.length)
}p.sort(function(v,u){var w=t(v),z=t(u);
if(w&&!z){return -1
}if(z&&!w){return 1
}return u.value-v.value
})
}function d(){var u=0,v=[],t=n[0]-h;
p.forEach(function(w){w.x=w.column;
w.dx=h;
if(v.indexOf(w.column)<0){v.push(w.column);
w.columnIndex=v.length-1
}else{w.columnIndex=v.indexOf(w.column)
}});
l=v.length;
o(l>1?t/(l-1):t)
}function b(){p.forEach(function(t){if(!t.targetLinks.length){t.x=d3.min(t.sourceLinks,function(u){return u.target.x
})-1
}})
}function r(t){p.forEach(function(u){if(!u.sourceLinks.length){u.x=t-1
}})
}function o(t){p.forEach(function(u){u.x*=t
})
}function i(A){var t=d3.nest().key(function(D){return D.x
}).sortKeys(d3.ascending).entries(p).map(function(D){return D.values
});
function w(){var D=d3.min(t,function(E){var G=d3.sum(E,q)||1;
return(n[1]-(E.length-1)*j)/G
});
t.forEach(function(E){E.forEach(function(H,G){H.y=G;
H.dy=Math.max(k,H.value*D)
})
});
g.forEach(function(E){E.dy=E.value*D
})
}function v(E){t.forEach(function(G,H){G.forEach(function(I){if(I.targetLinks.length){var J=d3.sum(I.targetLinks,D)/d3.sum(I.targetLinks,q);
I.y+=(J-s(I))*E
}})
});
function D(G){return s(G.source)*G.value
}}function u(E){t.slice().reverse().forEach(function(G){G.forEach(function(H){if(H.sourceLinks.length){var I=d3.sum(H.sourceLinks,D)/d3.sum(H.sourceLinks,q);
H.y+=(I-s(H))*E
}})
});
function D(G){return s(G.target)*G.value
}}function C(){t.forEach(function(E){var I,D,H=0,J=E.length,G;
E.sort(z);
for(G=0;
G<J;
++G){I=E[G];
D=H-I.y;
if(D>0){I.y+=D
}H=I.y+I.dy+j
}D=H-j-n[1];
if(D>0){H=I.y-=D;
for(G=J-2;
G>=0;
--G){I=E[G];
D=I.y+I.dy+j-H;
if(D>0){I.y-=D
}H=I.y
}}})
}function z(E,D){return E.y-D.y
}w();
C();
for(var B=1;
A>0;
--A){u(B*=0.99);
C();
v(B);
C()
}}function e(){p.forEach(function(v){v.sourceLinks.sort(t);
v.targetLinks.sort(u)
});
p.forEach(function(w){var z=0,v=0;
w.entryLinks.forEach(function(A){A.ty=v;
v+=A.dy
});
w.sourceLinks.forEach(function(A){A.sy=z;
z+=A.dy
});
w.targetLinks.forEach(function(A){A.ty=v;
v+=A.dy
});
w.exitLinks.forEach(function(A){A.sy=z;
z+=A.dy
})
});
function u(w,v){return w.source.y-v.source.y
}function t(w,v){return w.target.y-v.target.y
}}function s(t){return t.y+t.dy/2
}function q(t){return t.value
}return c
}
}(this));
(function(f){var g=f.cloudViz||{},a=g.core||{},d=f.dv||{},e=f.d3||{},b=Object.create(a);
b.init=function(h){this._type="anomaly";
h=h||{};
this._initDefaultOptions();
this.setOptions(h);
this._initializeAnomaly();
return this
};
b._initDefaultOptions=function(h){var i={mappings:{x:"date",y:"deviation",category:"metric"},bins:12,xTicks:7,xTickInterval:undefined,xUpperLimit:undefined,xLowerLimit:undefined,normalizePositive:false,onMouseOverAnomaly:null,onMouseOutAnomaly:null,onSelectAnomalies:null};
return Object.getPrototypeOf(b)._initDefaultOptions.call(this,i)
};
b._render=function(){this._configureAnomaly();
this._anom.layout()
};
b._initializeAnomaly=function(){var i=this._options,j=i.mappings,h=this;
this._anom=e.anomaly().on("mouseover",function(l,m,k){h._anom.nodes(function(p,n){var o=e.select(this).transition().duration(750).style("opacity",p[j.category]===m[j.category]?0.8:0.2)
});
if(i.onMouseOverAnomaly){i.onMouseOverAnomaly.call(l,m,k)
}}).on("mouseout",function(l,m,k){h._anom.nodes(function(p,n){var o=e.select(this).transition().duration(750).style("opacity",1)
});
if(i.onMouseOutAnomaly){i.onMouseOutAnomaly.call(l,m,k)
}}).on("select",function(k){h._anom.nodes(function(m,l){e.select(this).classed("selected",false)
});
k.classed("selected",true);
if(i.onSelectAnomalies){i.onSelectAnomalies.call(k)
}})
};
b._configureAnomaly=function(){var i=this._options;
var j=d.util.getPercentValue(i.width,i.parent.offsetWidth);
var h=d.util.getPercentValue(i.height,i.parent.offsetHeight);
this._anom.data(c(i.data)).parent(i.parent).mappings(i.mappings).bins(i.bins).size([j,h]).xUpperLimit(i.xUpperLimit).xLowerLimit(i.xLowerLimit).normalizePositive(i.normalizePositive).xTicks(i.xTicks,i.xTickInterval)
};
b._onAutoResize=function(){this.render()
};
function c(o){var q=[],l=true;
for(var h in o){var r=o[h],p=-1,k=r.length;
while(++p<k){var m,j=r[p];
if(l){m={};
q.push(m)
}else{m=q[p]
}m[h]=j
}l=false
}return q
}b.chart=function(){return this._anom
};
f.cloudViz.anomaly=g.util.createConstructor(b)
}(this));
(function(a){d3.choropleth=function(){var j=["#fae6be","#eb782d","#dc283c","#640046"],c=["#c7b797","#b85e23","#a81e2e","#300022"],B=["#faf0c8","#d2dc73","#5faf69","#00505A"],e=["#c7bf9f","#a0a858","#437d4a","#002226"],m={},E,o=[],s,C,A,w,q,u,f,D,r,h,z,t,l=[0,1],b=(z-t)*l[0],d=(z-t)*l[1],v={},g=false,n={top:0,left:0,right:0,bottom:40};
m.layout=function(){var p=this;
if(!m.data()){throw new i()
}if(!m.parent()){throw new k()
}o=m.determineSize(f);
m.calcRange();
w=m.createSVGContainer();
if(typeof f.geoJson==="string"){d3.json(f.geoJson,function(G){p._layoutWithData.call(p,G)
})
}else{this._layoutWithData(f.geoJson)
}};
m._layoutWithData=function(p){m.drawGeos(p);
if(f.interactive){m.drawTooltip()
}m.drawLegend(f.theme,p)
};
m.determineSize=function(G){var I=G.parent,H=G.width?G.width:I.offsetWidth,p=G.height?G.height:I.offsetHeight;
H=H?H:700;
p=p?p:450;
return[H,p]
};
m.calcRange=function(){for(var p in f.data.values){if(typeof z=="undefined"){z=f.data.values[p];
t=f.data.values[p]
}if(f.data.values[p]>z){z=f.data.values[p]
}if(f.data.values[p]<t){t=f.data.values[p]
}}};
m.drawLegend=function(aa,J){var T=this,U=9,L=12,I=35,S=Math.min(o[0]-n.left,630)-25,X=(o[0]-n.left-S)/2,R=S-(I*2)-(L*2),O=[],ae=[];
if(typeof aa!="undefined"&&aa=="salmonRun"){O=j;
ae=c
}else{O=B;
ae=e
}var G=q.selectAll(".legend").data([E]);
G.enter().append("g").classed("legend",true);
G.attr("transform","translate("+X+","+(o[1]-24)+")");
var p=G.selectAll("defs").data([aa]);
p.enter().append("defs");
p.exit().remove();
var Y=p.selectAll("#defaultGradient-"+aa).data([aa]);
Y.enter().append("linearGradient").attr("id","defaultGradient-"+aa);
Y.exit().remove();
var W=p.selectAll("#darkGradient-"+aa).data([aa]);
W.enter().append("linearGradient").attr("id","darkGradient-"+aa);
W.exit().remove();
var N=["0%","33%","67%","100%"];
var P=function(ai,ag,af){var ah=ai.selectAll("stop").data(ag);
ah.enter().append("stop").attr("class",function(ak,aj){return"stop"+aj
});
ah.attr("offset",function(aj){return aj
}).attr("stop-color",function(ak,aj){return af[aj]
})
};
P(Y,N,O);
P(W,N,ae);
var ad=G.selectAll(".grad-bg").data([E]);
ad.enter().append("rect").classed("grad-bg",true);
ad.attr("x",I+L).attr("y",0).attr("rx",U/2).attr("ry",U/2).attr("width",R).attr("height",U);
var ac=G.selectAll(".grad-rect").data([E]);
ac.enter().append("rect").classed("grad-rect",true);
ac.classed("grad-rect",true).attr("x",I+L).attr("y",0).style("stroke","url(#darkGradient-"+aa+")").style("fill","url(#defaultGradient-"+aa+")").attr("width",R).attr("height",U);
var K=A.selectAll(".legend-label").data([t,z]);
K.enter().append("div").attr("class",function(ag,af){return"legend-label "+(af?"max":"min")
});
K.style("left",function(ag,af){return(af?null:X+"px")
}).style("right",function(ag,af){return(af?X+"px":null)
}).text(function(ag,af){return f.formatFunction(af?z:t)
});
if(f.interactive){var H=d3.svg.brush().x(d3.scale.linear().range([0,R])).extent(l).on("brushstart",function(){g=true
}).on("brushend",function(){g=false
}).on("brush",function(){l=H.extent();
q.selectAll(".grad-rect").attr("width",(l[1]-l[0])*R).attr("x",(R*l[0])+I+L);
m.drawGeos(J)
});
var M=9;
var V=26;
var Q=G.selectAll(".brush").data([E]);
Q.enter().append("g").classed("brush",true);
Q.attr("transform","translate("+(I+L)+",0)").call(H);
var ab=Q.selectAll(".resize");
var Z=ab.selectAll(".handle").data(function(af){return af
});
Z.enter().append("rect").classed("handle",true);
Z.attr("transform","translate("+-(M/2)+","+-M+")").attr("rx",M/3).attr("ry",M/3).attr("width",M).attr("height",V)
}};
m.drawTooltip=function(K){var H=this,I=K==null||K.value==null;
h=A.selectAll(".tooltip").data(I?[]:[K]);
h.enter().append("div").classed("tooltip",true);
h.exit().classed("visible",false);
setTimeout(function(){h.classed("visible",true)
},10);
var G=h.selectAll(".tooltip-back").data([K]);
G.enter().append("div").classed("tooltip-back",true);
var L=G.selectAll(".tt-name").data(function(M){return[M.name]
});
L.enter().append("p").classed("tt-name",true);
L.text(function(M){return M
});
var J=G.selectAll(".tt-value").data(function(M){return[M.value]
});
J.enter().append("p").classed("tt-value",true);
J.text(function(M){return f.formatFunction(M)
});
var p=G.selectAll(".tt-metric").data(typeof f.metric!=="undefined"?[f.metric]:[]);
p.enter().append("p").classed("tt-metric",true);
p.text(function(M){return M
});
p.exit().remove()
};
m.hideTooltip=function(){m.drawTooltip({})
};
m.showTooltip=function(p){if("value" in p&&p.value){m.drawTooltip(p)
}else{m.hideTooltip()
}};
m.drawGeos=function(J){var V=null,I,K,N,W=1,R=Math.min(o[0],o[1]),U=o[0]-n.left-n.right,S=o[1]-n.top-n.bottom,Z=1,L=[0,0];
if(f.projection){D=d3.geo[f.projection]()
}else{D=d3.geo.equirectangular()
}D.scale(Z).translate(L);
var T=d3.geo.path().projection(D);
var M=T.bounds(J);
Z=0.95/Math.max((M[1][0]-M[0][0])/U,(M[1][1]-M[0][1])/S);
L=[(U-Z*(M[1][0]+M[0][0]))/2,(S-Z*(M[1][1]+M[0][1]))/2];
var Y=(Z*((M[1][1]-M[0][1])/S))*S,G=(Z*((M[1][0]-M[0][0])/U))*U;
D.scale(Z).translate(L);
T=T.projection(D);
if(f.interactive){var p=d3.behavior.zoom(),Q=4;
u.call(p.scaleExtent([1,Q]).translate([U/2,S/2]).scale(1).on("zoom",function(){if(d3.event){var ai=d3.event.translate,al=d3.event.scale,af=U/2*al,ad=S/2*al,ab=ai[0]-af,aj=ai[1]-ad,ae=G/6,ak=Y/6,ah=-af-ae,ac=U-af+ae,ag=-ad-ak,aa=S-ad+ak;
ab=Math.min(ab,ac);
ab=Math.max(ab,ah);
aj=Math.min(aj,aa);
aj=Math.max(aj,ag);
ai[0]=ab+af;
ai[1]=aj+ad;
p.translate(ai);
w.attr("transform","translate("+ab+","+aj+") scale("+al+")")
}}))
}b=((z-t)*l[0])+t;
d=((z-t)*l[1])+t;
I=[b,((d-b)/3)+b,(((d-b)/3)*2)+b,d];
C.selectAll(".legend-label.min").text(function(ab,aa){return f.formatFunction(b)
});
C.selectAll(".legend-label.max").text(function(ab,aa){return f.formatFunction(d)
});
if(f.theme=="salmonRun"){V=d3.scale.linear().domain(I).range(j)
}else{V=d3.scale.linear().domain(I).range(B)
}var H=function(aa){if(typeof(E.values[aa.properties.GEO_ID])=="undefined"||E.values[aa.properties.GEO_ID]<b||E.values[aa.properties.GEO_ID]>d){return"#ddd"
}else{return V(E.values[aa.properties.GEO_ID])
}};
var O=function(ad,ab){if(g){return
}var ae=ad.properties.GEO_ID,aa=q.selectAll("#"+ae),ac=aa.node();
ac.parentNode.appendChild(ac);
aa.classed("selected",true);
m.showTooltip({name:ad.properties.name,id:ad.properties.GEO_ID,value:E.values[ad.properties.GEO_ID]})
};
var X=function(ae,ac){if(g){return
}var af=ae.properties.GEO_ID,ab=q.selectAll("#"+af),ad=ab.node(),aa=ad.parentNode;
ab.classed("selected",false);
m.hideTooltip()
};
var P=w.selectAll(".geo").data(J.features,function(aa){return aa.properties.GEO_ID
});
P.enter().append("path").classed("geo",true).attr("id",function(ab,aa){return ab.properties.GEO_ID
}).attr("vector-effect","non-scaling-stroke").on("mouseover.choro",f.interactive?O:null).on("mouseout.choro",f.interactive?X:null);
P.exit().on("mouseover.choro",null).on("mouseout.choro",null);
P.attr("d",T).style("fill",H)
};
m.createSVGContainer=function(){C=d3.select(s);
A=C.selectAll(".cv-choropleth").data([E]);
A.enter().append("div").classed("cv-choropleth",true);
A.style("width",o[0]+"px").style("height",o[1]+"px");
q=A.selectAll("svg").data([E]);
q.enter().append("svg").attr("width","100%").attr("height","100%");
q.exit().remove();
var H=q.selectAll("#plotClip").data([0]);
H.enter().append("clipPath").attr("id","plotClip").append("rect");
H.select("rect").attr("x",n.left).attr("y",n.top).attr("width",o[0]-n.left-n.right).attr("height",o[1]-n.top-n.bottom);
var I=q.selectAll(".container-bg").data([E]);
I.enter().append("rect").classed("container-bg",true).attr("width","100%").attr("height","100%");
u=q.selectAll(".zoom-container").data([E]);
u.enter().append("g").classed("zoom-container",true).attr("clip-path","url(#plotClip)");
var G=u.selectAll(".zoom-container-plot-bg").data([E]);
G.enter().append("rect").classed("zoom-container-plot-bg",true);
G.attr("x",n.left).attr("y",n.top).attr("width",o[0]-n.left-n.right).attr("height",o[1]-n.top-n.bottom);
var p=u.selectAll(".choro-container").data([E]);
p.enter().append("g").classed("choro-container",true);
return p
};
m.data=function(p){if(!arguments.length){return E
}E=p;
return m
};
m.parent=function(p){if(!arguments.length){return s
}s=p;
return m
};
m.options=function(p){if(!arguments.length){return f
}f=p;
return m
};
function i(){this.type="EmptyDataException";
this.message="The data is empty or null";
this.toString=function(){return this.type+" - "+this.message
}
}function k(){this.type="ParentNotSpecifiedException";
this.message="A parent was not specified for this visualization";
this.toString=function(){return this.type+" - "+this.message
}
}return m
};
d3.choropleth.gradIdCounter=0
}(this));
(function(e){var f=e.cloudViz||{},b=f.core||{},c=e.dv||{},d=e.d3||{},a=Object.create(b);
a.init=function(g){this._type="choropleth";
g=g||{};
this._initDefaultOptions();
this.setOptions(g);
this._initChoropleth();
return this
};
a._initDefaultOptions=function(g){var h={geoJson:null,theme:"sunnyDay",metric:"",projection:"equirectangular",format:"decimal",interactive:true};
return Object.getPrototypeOf(a)._initDefaultOptions.call(this,h)
};
a._render=function(){this._configure();
this._choro.layout()
};
a._initChoropleth=function(){this._choro=d.choropleth()
};
a._configure=function(){var h=this,i=this._options,g=this._dataAdapter;
i.formatFunction=function(j){return h._formatNumber(i.format,j)
};
i.metric=g.metric();
i.format=g.format();
i.data=g.data();
this._choro.data(this._options.data).parent(this._options.parent).options(this._options)
};
e.cloudViz.choropleth=f.util.createConstructor(a)
}(this));
(function(a){a.venn=function(h,c,m){m=m||{};
m.distance=m.distance||0;
m.maxIterations=m.maxIterations||500;
var l=m.lossFunction||a.lossFunction;
var e=m.layoutFunction||a.greedyLayout;
h=e(h,c,m.distance);
var j=new Array(2*h.length);
for(var g=0;
g<h.length;
++g){j[2*g]=h[g].x;
j[2*g+1]=h[g].y
}var d=0;
var k=a.fmin(function(n){d+=1;
var p=new Array(h.length);
for(var o=0;
o<h.length;
++o){p[o]={x:n[2*o],y:n[2*o+1],radius:h[o].radius,size:h[o].size}
}return l(p,c)
},j,m);
var f=k.solution;
for(g=0;
g<h.length;
++g){h[g].x=f[2*g];
h[g].y=f[2*g+1]
}return h
};
a.distanceFromIntersectArea=function(e,d,c){if(Math.min(e,d)*Math.min(e,d)*Math.PI<c){return Math.abs(e-d)
}return a.bisect(function(f){return window.circleIntersection.circleOverlap(e,d,f)-c
},0,e+d)
};
a.getDistanceMatrix=function(m,e,n){var o=[],k;
for(k=0;
k<m.length;
++k){o.push([]);
for(var h=0;
h<m.length;
++h){o[k].push(0)
}}for(k=0;
k<e.length;
++k){var l=e[k];
if(l.sets.length!==2){continue
}var g=l.sets[0],p=l.sets[1],f=Math.sqrt(m[g].size/Math.PI),d=Math.sqrt(m[p].size/Math.PI),c=a.distanceFromIntersectArea(f,d,l.size)+n;
o[g][p]=o[p][g]=c
}return o
};
a.greedyLayout=function(d,K,o){var h={},u,I,G;
for(I=0;
I<d.length;
++I){h[I]=[];
d[I].radius=Math.sqrt(d[I].size/Math.PI);
d[I].x=d[I].y=0
}for(I=0;
I<K.length;
++I){var w=K[I];
if(w.sets.length!==2){continue
}var p=w.sets[0],J=w.sets[1];
if(!h[p]||!h[J]){continue
}h[p].push({set:J,size:w.size});
h[J].push({set:p,size:w.size})
}var s=[];
for(u in h){if(h.hasOwnProperty(u)){var v=0;
for(I=0;
I<h[u].length;
++I){v+=h[u][I].size
}s.push({set:u,size:v})
}}if(!s.length){return d
}function z(j,i){return i.size-j.size
}s.sort(z);
var e={};
function t(i){return i.set in e
}function D(i,j){d[j].x=i.x;
d[j].y=i.y;
e[j]=true
}D({x:0,y:0},s[0].set);
var q=a.getDistanceMatrix(d,K,o);
for(I=1;
I<s.length;
++I){var E=s[I].set,c=h[E].filter(t);
u=d[E];
c.sort(z);
if(c.length===0){throw"Need overlap information for set "+u
}var H=[];
for(G=0;
G<c.length;
++G){var m=d[c[G].set],M=q[E][c[G].set];
H.push({x:m.x+M,y:m.y});
H.push({x:m.x-M,y:m.y});
H.push({y:m.y+M,x:m.x});
H.push({y:m.y-M,x:m.x});
for(var C=G+1;
C<c.length;
++C){var g=d[c[C].set],L=q[E][c[C].set];
var B=window.circleIntersection.circleCircleIntersection({x:m.x,y:m.y,radius:M},{x:g.x,y:g.y,radius:L});
for(var A=0;
A<B.length;
++A){H.push(B[A])
}}}var f=1e+50,r=H[0];
for(G=0;
G<H.length;
++G){d[E].x=H[G].x;
d[E].y=H[G].y;
var n=a.lossFunction(d,K);
if(n<f){f=n;
r=H[G]
}}D(r,E)
}return d
};
a.classicMDSLayout=function(f,g){var d=a.getDistanceMatrix(f,g,0);
var c=window.mds.classic(d);
for(var e=0;
e<f.length;
++e){f[e].x=c[e][0];
f[e].y=c[e][1];
f[e].radius=Math.sqrt(f[e].size/Math.PI)
}return f
};
a.lossFunction=function(k,d){var e=0;
function f(i){return i.map(function(n){return k[n]
})
}for(var h=0;
h<d.length;
++h){var c=d[h],l;
if(c.sets.length==2){var g=k[c.sets[0]],m=k[c.sets[1]];
if(g==null||m==null){l=0
}else{l=window.circleIntersection.circleOverlap(g.radius,m.radius,window.circleIntersection.distance(g,m))
}}else{l=window.circleIntersection.intersectionArea(f(c.sets))
}var j=(c.weight==null)?1:c.weight;
e+=j*(l-c.size)*(l-c.size)
}return e
};
a.scaleSolution=function(n,f,q,o){var j=function(s){var i=Math.max.apply(null,n.map(function(t){return t[s]+t.radius
})),r=Math.min.apply(null,n.map(function(t){return t[s]-t.radius
}));
return{max:i,min:r}
};
f-=2*o;
q-=2*o;
var d=j("x"),h=j("y"),g=(d.max-d.min),m=(h.max-h.min),l=g?f/g:0,c=m?q/m:0,e=Math.min(c,l);
for(var k=0;
k<n.length;
++k){var p=n[k];
p.radius=e*p.radius;
p.x=o+(p.x-d.min)*e;
p.y=o+(p.y-h.min)*e
}n.scaling=e;
return n
};
function b(d,c){var f=new Array(d[1].length||0);
for(var e=0;
e<f.length;
++e){f[e]=d[0]*d[1][e]+c[0]*c[1][e]
}return f
}a.bisect=function(e,m,l,p){p=p||{};
var j=p.maxIterations||100,k=p.tolerance||1e-10,h=e(m),g=e(l),o=l-m;
if(h*g>0){throw"initial bisect points must have opposite signs"
}if(h===0){return m
}if(g===0){return l
}for(var d=0;
d<j;
++d){o/=2;
var n=m+o,c=e(n);
if(c*h>=0){m=n
}if((Math.abs(o)<k)||(c===0)){return n
}}return m+o
};
a.fmin=function(B,C,k){k=k||{};
var t=k.maxIterations||C.length*200,l=k.nonZeroDelta||1.1,d=k.zeroDelta||0.001,H=k.minErrorDelta||0.00001,e=k.rho||1,G=k.chi||2,D=k.psi||-0.5,q=k.sigma||0.5,g=k.callback;
var n=C.length,o=new Array(n+1);
o[0]=C;
o[0].fx=B(C);
for(var A=0;
A<n;
++A){var v=C.slice();
v[A]=v[A]?v[A]*l:d;
o[A+1]=v;
o[A+1].fx=B(v)
}var r=function(i,f){return i.fx-f.fx
};
for(var c=0;
c<t;
++c){o.sort(r);
if(g){g(o)
}if(Math.abs(o[0].fx-o[n].fx)<H){break
}var p=new Array(n);
for(A=0;
A<n;
++A){p[A]=0;
for(var z=0;
z<n;
++z){p[A]+=o[z][A]
}p[A]/=n
}var u=o[n];
var E=b([1+e,p],[-e,u]);
E.fx=B(E);
var s=E;
if(E.fx<=o[0].fx){var w=b([1+G,p],[-G,u]);
w.fx=B(w);
if(w.fx<E.fx){s=w
}}else{if(E.fx>=o[n-1].fx){var h=false;
var m;
if(E.fx<=u.fx){m=b([1+D,p],[-D,u]);
m.fx=B(m);
if(m.fx<u.fx){s=m
}else{h=true
}}else{m=b([1-D*e,p],[D*e,u]);
m.fx=B(m);
if(m.fx<=E.fx){s=m
}else{h=true
}}if(h){for(A=1;
A<o.length;
++A){o[A]=b([1-q,o[0]],[q-1,o[A]]);
o[A].fx=B(o[A])
}}}}o[n]=s
}o.sort(r);
return{f:o[0].fx,solution:o[0]}
};
a.drawD3Diagram=function(i,h,e,s,r){r=r||{};
var g=d3.scale.category10(),k=r.circleFillColours||g,m=r.circleStrokeColours||k,p=r.circleStrokeWidth||function(t){return 0
},f=r.textFillColours||g,n=r.textStrokeColours||f,c=r.opacity||0.3,o=r.padding||6;
h=a.scaleSolution(h,e,s,o);
var j=i.append("svg").attr("width",e).attr("height",s);
var d=j.selectAll("circle").data(h).enter().append("g");
var l=d.append("circle").attr("r",function(t){return t.radius
}).style("fill-opacity",c).attr("cx",function(t){return t.x
}).attr("cy",function(t){return t.y
}).style("stroke",function(u,t){return m(t)
}).style("stroke-width",function(u,t){return p(t)
}).style("fill",function(u,t){return k(t)
});
var q=d.append("text").attr("x",function(t){return t.x
}).attr("y",function(t){return t.y
}).attr("text-anchor","middle").style("stroke",function(u,t){return n(t)
}).style("fill",function(u,t){return f(t)
}).text(function(t){return t.label
});
return{svg:j,nodes:d,circles:l,text:q}
};
a.updateD3Diagram=function(e,g){var d=e.select("svg"),f=parseInt(d.attr("width"),10),c=parseInt(d.attr("height"),10);
g=a.scaleSolution(g,f,c,6);
e.selectAll("circle").data(g).transition().duration(400).attr("cx",function(h){return h.x
}).attr("cy",function(h){return h.y
}).attr("r",function(h){return h.radius
});
e.selectAll("text").data(g).transition().duration(400).attr("x",function(h){return h.x
}).attr("y",function(h){return h.y
})
}
}(window.venn=window.venn||{}));
(function(a){var b=1e-10;
a.intersectionArea=function(q,C){var n=c(q);
var w=n.filter(function(i){return a.containedInCircles(i,q)
});
var z=0,o=0,v=[],u;
if(w.length>1){var A=a.getCenter(w);
for(u=0;
u<w.length;
++u){var l=w[u];
l.angle=Math.atan2(l.x-A.x,l.y-A.y)
}w.sort(function(j,i){return i.angle-j.angle
});
var e=w[w.length-1];
for(u=0;
u<w.length;
++u){var f=w[u];
o+=(e.x+f.x)*(f.y-e.y);
var h={x:(f.x+e.x)/2,y:(f.y+e.y)/2},k=null;
for(var r=0;
r<f.parentIndex.length;
++r){if(e.parentIndex.indexOf(f.parentIndex[r])>-1){var g=q[f.parentIndex[r]],E=Math.atan2(f.x-g.x,f.y-g.y),D=Math.atan2(e.x-g.x,e.y-g.y);
var t=(D-E);
if(t<0){t+=2*Math.PI
}var B=D-t/2,m=a.distance(h,{x:g.x+g.radius*Math.sin(B),y:g.y+g.radius*Math.cos(B)});
if((k===null)||(k.width>m)){k={circle:g,width:m,p1:f,p2:e}
}}}v.push(k);
z+=a.circleArea(k.circle.radius,k.width);
e=f
}}else{var d=q[0];
for(u=1;
u<q.length;
++u){if(q[u].radius<d.radius){d=q[u]
}}var s=false;
for(u=0;
u<q.length;
++u){if(a.distance(q[u],d)>Math.abs(d.radius-q[u].radius)){s=true;
break
}}if(s){z=o=0
}else{z=d.radius*d.radius*Math.PI;
v.push({circle:d,p1:{x:d.x,y:d.y+d.radius},p2:{x:d.x-b,y:d.y+d.radius},width:d.radius*2})
}}o/=2;
if(C){C.area=z+o;
C.arcArea=z;
C.polygonArea=o;
C.arcs=v;
C.innerPoints=w;
C.intersectionPoints=n
}return z+o
};
a.containedInCircles=function(d,f){for(var e=0;
e<f.length;
++e){if(a.distance(d,f[e])>f[e].radius+b){return false
}}return true
};
function c(m){var g=[];
for(var h=0;
h<m.length;
++h){for(var f=h+1;
f<m.length;
++f){var d=a.circleCircleIntersection(m[h],m[f]);
for(var e=0;
e<d.length;
++e){var l=d[e];
l.parentIndex=[h,f];
g.push(l)
}}}return g
}a.circleIntegral=function(e,d){var f=Math.sqrt(e*e-d*d);
return d*f+e*e*Math.atan2(d,f)
};
a.circleArea=function(e,d){return a.circleIntegral(e,d-e)-a.circleIntegral(e,-e)
};
a.distance=function(e,d){return Math.sqrt((e.x-d.x)*(e.x-d.x)+(e.y-d.y)*(e.y-d.y))
};
a.circleOverlap=function(h,g,i){if(i>=h+g){return 0
}if(i<=Math.abs(h-g)){return Math.PI*Math.min(h,g)*Math.min(h,g)
}var f=h-(i*i-g*g+h*h)/(2*i),e=g-(i*i-h*h+g*g)/(2*i);
return a.circleArea(h,f)+a.circleArea(g,e)
};
a.circleCircleIntersection=function(p,o){var l=a.distance(p,o),j=p.radius,i=o.radius;
if((l>=(j+i))||(l<=Math.abs(j-i))){return[]
}var m=(j*j-i*i+l*l)/(2*l),k=Math.sqrt(j*j-m*m),g=p.x+m*(o.x-p.x)/l,n=p.y+m*(o.y-p.y)/l,f=-(o.y-p.y)*(k/l),e=-(o.x-p.x)*(k/l);
return[{x:g+f,y:n-e},{x:g-f,y:n+e}]
};
a.getCenter=function(f){var d={x:0,y:0};
for(var e=0;
e<f.length;
++e){d.x+=f[e].x;
d.y+=f[e].y
}d.x/=f.length;
d.y/=f.length;
return d
}
}(window.circleIntersection=window.circleIntersection||{}));
(function(e){var f=e.cloudViz||{},b=f.core||{},c=e.dv||{},d=e.d3||{},a=Object.create(b);
a.init=function(h){var g=this;
this._type="venn";
h=h||{};
this._initDefaultOptions();
this.setOptions(h);
this._cvWrapper=null;
this._seriesState=f.seriesState();
this._seriesState.on("enableChange.venn",function(i,j){g._onEnableState(j)
});
this._dvColorScale=c.scale.ordinal();
return this
};
a._initDefaultOptions=function(g){var h={colors:["#8cc350","#d755a5","#1ebed7","#f0a01e","#9b8ce6","#3cb5a0","#3287d2","#f0557d","#c3d250","#eb782d","#78b4f5","#5faf69","#aa5fa5","#fa5a50","#f5c841","#5a6eaa"],legendVerticalWidth:110,duration:500,distance:0};
this._margins={top:0,left:0,right:0,bottom:0};
return Object.getPrototypeOf(a)._initDefaultOptions.call(this,h)
};
a._render=function(){this._id=Math.floor(Math.random()*10000);
this._determineSize();
this._initScales();
this._draw()
};
a._draw=function(){var i=this._options.data;
i.distance=this._options.distance;
this._initSVG();
this._createStates();
this._parsedSetNotation=this._parseSetNotation(i.notation);
this._overlapMap=this._createOverlapMap(i.sets,i.overlaps);
var h=this._drawLegend();
this._positionContainer(h);
var g=this._configureSets(i);
var j=this._generateOverlayCombinations(g,this._parsedSetNotation);
this._drawCircles(g,j)
};
a._onAutoResize=function(){this.render()
};
a._determineSize=function(h){var l=this._options,m=this._dataAdapter.data(),k=l.parent.offsetWidth,i=l.parent.offsetHeight,j=c.util.getPercentValue(l.width,k)||k,g=c.util.getPercentValue(l.height,i)||i;
this._size=[j,g]
};
a._initScales=function(){this._dvColorScale.range(this._options.colors)
};
a._parseSetNotation=function(h){var q=[];
if(!h){return q
}var o=h.split("|"),s=/\d+/g;
var m,g=o.length,l;
for(m=0;
m<g;
m++){l=o[m];
var p=l.match(s);
var k,r=[],t=p.length,n;
for(k=0;
k<t;
k++){r.push(+p[k])
}q.push(r)
}return q
};
a._initSVG=function(){var j=this._options,h=d.select(j.parent);
this._cvWrapper=h.selectAll(".cv-wrapper.cv-venn").data([0]);
this._cvWrapper.enter().append("div").classed("cv-wrapper cv-venn",true);
this._cvWrapper.style("width",this._size[0]+"px").style("height",this._size[1]+"px");
var g=this._cvWrapper.selectAll(".svg-wrapper").data([0]);
g.enter().append("div").classed("svg-wrapper",true);
var i=g.selectAll("svg").data([0]);
i.enter().append("svg");
this._d3Container=i.selectAll("g").data([0]);
this._d3Container.enter().append("g")
};
a._positionContainer=function(g){this._size[0]-=g.left+g.right;
this._size[1]-=g.top+g.bottom;
this._cvWrapper.select(".svg-wrapper").style({"margin-left":g.left+"px","margin-top":g.top+"px","margin-right":g.right+"px","margin-bottom":g.bottom+"px",height:this._size[1]+"px"});
this._cvWrapper.selectAll(".cv-legend").style("height",g.left||g.right?this._size[1]-1+"px":null)
};
a._configureSets=function(k){var j=this._options;
k=this._sanitizeOverlaps(k);
var m=e.venn.scaleSolution(e.venn.venn(k.sets,k.overlaps,{distance:k.distance}),this._size[0],this._size[1],7);
var g,h=m.length,l;
for(g=0;
g<h;
g++){l=m[g];
l.index=g
}return m
};
a._combine=function(m,h,g){if(arguments.length<3){g=m.length-1
}else{g--
}if(arguments.length<2){h=1
}var l=function(r,q,i,p){if(r===0){if(i.length>0){p[p.length]=i
}return
}for(var o=0;
o<q.length;
o++){l(r-1,q.slice(o+1),i.concat([q[o]]),p)
}return
};
var k=[];
for(var j=h;
j<=g+1;
j++){l(j,m,[],k)
}return k
};
a._intersect=function(h,g){var m=[];
for(var l=0;
l<h.length;
l++){for(var k=0;
k<g.length;
k++){if(h[l]==g[k]){m.push(h[l]);
break
}}}return m
};
a._union=function(h,g){var p={};
for(var o=h.length-1;
o>=0;
--o){p[h[o]]=h[o]
}for(var m=g.length-1;
m>=0;
--m){p[g[m]]=g[m]
}var n=[];
for(var l in p){if(p.hasOwnProperty(l)){n.push(p[l])
}}n.sort(function(j,i){return j-i
});
return n
};
a._generateOverlayCombinations=function(l,q){var t=this,k={},s=[],o=[];
q.sort(function(u,i){return i.length-u.length
});
q.forEach(function(v,u){var w=v.join("-");
s=s.concat(t._combine(v,1));
s.forEach(function(C,i){var z=C.join("-"),A=k[z]||{},B;
if(!A.fill){B=t._intersect(v,C);
A.fill=B.join("-")===w
}k[z]=A
})
});
for(var p in k){var n=p.split("-"),g=[],j,r=n.length;
for(j=0;
j<r;
j++){var m=l[n[j]];
if(m){g.push(l[n[j]])
}}var h={};
if(g.length>1){e.circleIntersection.intersectionArea(g,h)
}if(!g.length){h.area=0
}else{h.area=Math.PI*Math.pow(g[0].radius,2)
}o.push({key:p,fill:k[p].fill,area:h.area})
}o.sort(function(u,i){var v=i.area-u.area;
if(v){return v
}return u.key.length-i.key.length
});
return o
};
a._sanitizeOverlaps=function(n){var p=n.sets,i=n.overlaps,m=[],g,l,k,s,j,q,u,r=p.length,o=i.length,h={},t=function(w,v){return +w-+v
};
for(k=0;
k<o;
k++){q=i[k];
q.sets.sort(t);
h[q.sets.join("-")]=q
}for(g=0;
g<r;
g++){s=p[g];
for(l=g+1;
l<r;
l++){j=p[l];
u=false;
if(!h.hasOwnProperty(g+"-"+l)||h[g+"-"+l].size==="0"){m.push({sets:[g,l],size:0})
}}}n.overlaps=i.concat(m);
return n
};
a._createOverlapMap=function(o,h){var g={},l=function(j,i){return j-i
};
var m,r=o.length,q;
for(m=0;
m<r;
m++){q=o[m];
g[m]=q.size
}var k,n=h.length,p;
for(m=0;
m<n;
m++){p=h[m];
p.sets.sort(l);
g[p.sets.join("-")]=p.size
}return g
};
a._drawCircles=function(g,h){this._drawSetHitAreas(g);
this._createClipPaths(g,h);
this._drawFilledRegions(h);
this._drawPadding(g);
this._drawSetFills(g);
this._drawBorders(g);
this._makePlotFit(g)
};
a._drawSetHitAreas=function(i){var h=this,j=this._options;
var g=this._d3Container.selectAll(".set-hit-areas-container").data([i]);
g.enter().append("g").classed("set-hit-areas-container",true);
g.exit().remove();
var k=g.selectAll("circle").data(function(l){return l
});
k.enter().append("circle").attr("r",0).attr("cx",function(l){return l.x
}).attr("cy",function(l){return l.y
}).attr("tooltip",function(l){return l.tooltip
});
k.exit().remove();
k.sort(function(m,l){return l.radius-m.radius
}).on("mouseover",function(m,l){h._seriesState.enableStateByTypeAndId("standard",m.index,true)
}).on("mouseout",function(m,l){h._seriesState.enableStateByTypeAndId("standard",m.index,false)
}).transition().duration(j.duration).attr("r",function(l){return Math.max(l.radius-1,0)
}).attr("cx",function(l){return l.x
}).attr("cy",function(l){return l.y
})
};
a._createClipPaths=function(k,l){var i=this;
var g=this._cvWrapper.select("svg").selectAll("defs").data(l.length?[0]:[]);
g.enter().insert("defs",":first-child");
g.exit().remove();
var h=g.selectAll("clipPath").data(l);
h.enter().append("clipPath");
h.exit().remove();
h.attr("id",function(m){return"clip-"+i._id+"-"+m.key
});
var j=h.selectAll("circle").data(function(o){if(!o.key||!o.key.length){return[]
}var m=o.key.split("-"),n={circleIndex:m.shift()};
if(m.length){n.maskId=m.join("-")
}if(!k||!k[n.circleIndex]){return[]
}return[n]
});
j.enter().append("circle");
j.exit().remove();
j.attr("clip-path",function(m){return m.hasOwnProperty("maskId")?"url(#clip-"+i._id+"-"+m.maskId+")":null
}).attr("r",function(m){return k[m.circleIndex].radius
}).attr("cx",function(m){return k[m.circleIndex].x
}).attr("cy",function(m){return k[m.circleIndex].y
}).style("fill","#FFF")
};
a._drawFilledRegions=function(k){var g=this,i=this._options;
var h=this._d3Container.selectAll(".filled-regions").data(k?[k]:[]);
h.enter().append("g").classed("filled-regions",true);
h.exit().remove();
var j=h.selectAll(".fill-region").data(function(l){return l
});
j.enter().append("rect").classed("fill-region",true);
j.exit().remove();
j.attr("clip-path",function(l){return"url(#clip-"+g._id+"-"+l.key+")"
}).style("opacity",0.000001).attr("width",g._size[0]).attr("height",g._size[1]).classed("overlay",function(l){return l.fill
}).on("mouseover",function(m,l){g._seriesState.enableStateByTypeAndId("highlight","audience",true)
}).on("mouseout",function(m,l){g._seriesState.enableStateByTypeAndId("highlight","audience",false)
}).transition().delay(i.duration).duration(i.duration).style("opacity",1)
};
a._drawPadding=function(h){var i=this._options;
var g=this._d3Container.selectAll(".padding-container").data([h]);
g.enter().append("g").classed("padding-container",true);
g.exit().remove();
var j=g.selectAll("circle").data(function(k){return k
});
j.enter().append("circle").attr("r",0).attr("cx",function(k){return k.x
}).attr("cy",function(k){return k.y
});
j.exit().remove();
j.transition().duration(i.duration).attr("r",function(k){return k.radius
}).attr("cx",function(k){return k.x
}).attr("cy",function(k){return k.y
})
};
a._drawSetFills=function(i){var h=this,j=this._options;
var g=this._d3Container.selectAll(".set-fills-container").data([i]);
g.enter().append("g").classed("set-fills-container",true);
g.exit().remove();
var k=g.selectAll("circle").data(function(l){return l
});
k.enter().append("circle").attr("r",0).attr("cx",function(l){return l.x
}).attr("cy",function(l){return l.y
});
k.exit().remove();
k.style("fill",function(m,l){return h._dvColorScale.mapValue(l)
}).transition().duration(j.duration).attr("r",function(l){return Math.max(l.radius-3,0)
}).attr("cx",function(l){return l.x
}).attr("cy",function(l){return l.y
})
};
a._drawBorders=function(i){var h=this,j=this._options;
var g=this._d3Container.selectAll(".border-container").data([i]);
g.enter().append("g").classed("border-container",true);
g.exit().remove();
var k=g.selectAll("circle").data(function(l){return l
});
k.enter().append("circle").attr("r",0).attr("cx",function(l){return l.x
}).attr("cy",function(l){return l.y
});
k.exit().remove();
k.style("stroke",function(m,l){return h._dvColorScale.mapValue(l)
}).classed("predicted",function(l){return l.predicted
}).transition().duration(j.duration).attr("r",function(l){return l.radius
}).attr("cx",function(l){return l.x
}).attr("cy",function(l){return l.y
})
};
a._createStates=function(){var k=this._options,h=k.data.sets;
if("data" in this._changedOptions&&this._changedOptions.data){this._seriesState.removeStatesByType("standard");
this._seriesState.removeStatesByType("highlight");
this._seriesState.appendState(this._dataAdapter.l10n.labels.venn.definedAudience,"audience","highlight",false);
var g,j=h.length,l=[],m;
for(g=0;
g<j;
g++){m=h[g];
l.push(g);
this._seriesState.appendState(m.label||g,g,"standard",false)
}this._dvColorScale.domain(l)
}};
a._drawLegend=function(){var k=this._options,i=this;
if(!this._legend){this._legend=f.interactiveLegend()
}this._legend.parent(this._cvWrapper.node()).orientation("bottom").chartWidth(this._size[0]).chartHeight(this._size[1]).chartPadding({left:0,top:0,right:0,bottom:0}).validOrientations(["bottom","left"]).legendVerticalWidth(k.legendVerticalWidth).type("line").seriesState(this._seriesState).interactive(false).values(this._calculateValues(this._options.data.sets,this._overlapMap,this._parsedSetNotation))._render(null,{fill:[this._dvColorScale]});
var l=this._legend._getUsedWidth(),h=this._legend._getUsedHeight(),j=h!==0;
var g=this._cvWrapper.selectAll(".cv-legend-entry").on("mouseover",function(m){i._seriesState.enableStateByTypeAndId(m.type,m.id,true)
}).on("mouseout",function(m){i._seriesState.enableStateByTypeAndId(m.type,m.id,false)
});
if(j){g.style("width",function(n,m){return(i._size[0]/(i._options.data.sets.length+1))+"px"
})
}return{left:l,bottom:h,right:0,top:0}
};
a._onEnableState=function(g){this._cvWrapper.selectAll(".set-fills-container circle").style("display",function(j,h){return g.type==="standard"&&g.id===h&&g.enabled?"block":"none"
});
this._cvWrapper.selectAll(".border-container circle").classed("muted",function(j,h){return g.id!==h&&g.enabled
});
this._cvWrapper.selectAll(".filled-regions rect").classed("muted",function(j,h){return g.type==="standard"&&g.enabled
});
this._cvWrapper.selectAll(".padding-container circle").style("display",function(j,h){return g.type==="highlight"&&g.enabled?"none":"block"
});
this._cvWrapper.selectAll(".cv-legend-entry").classed("inactive",function(h){return g.enabled&&(h.id!==g.id||h.type!==g.type)
})
};
a._calculateValues=function(k,n,g){var h=[this._formatNumber("decimal",this._calculateHighlightedValue(k,n,g))],j,l=k.length,m;
for(j=0;
j<l;
j++){m=k[j];
h.push(m.sizeText?m.sizeText:this._formatNumber("decimal",m.size))
}return h
};
a._calculateHighlightedValue=function(h,k,g){var i=function(w,v,u,o){var s=this._combine(v,o,o);
var p,A=s.length,m,l=o%2?1:-1;
for(p=0;
p<A;
p++){m=s[p];
var n,t=m.length,q,r,z=[];
for(n=0;
n<t;
n++){q=m[n];
z=this._union(w[q],z)
}r=z.join("-");
u+=(k.hasOwnProperty(r)?k[r]:0)*l
}o++;
if(o<=w.length){u=i.call(this,w,v,u,o)
}return u
},j=function(n){var l=[],m;
for(m=0;
m<n;
m++){l.push(m)
}return l
};
return i.call(this,g,j(g.length),0,1)
};
a._makePlotFit=function(g){var h=this._options,j={x:0,y:0},l=0,k=0,i=4;
g.forEach(function(m){l=Math.max(l,m.x+m.radius);
k=Math.max(k,m.y+m.radius)
});
if(this._size[0]-l>this._size[1]-k){j.x=(this._size[0]-l)/2-i
}else{j.y=(this._size[1]-k)/2-i
}this._cvWrapper.select("g").attr("transform","translate("+j.x+","+j.y+")")
};
e.cloudViz.venn=f.util.createConstructor(a)
}(this));
(function(d){var e=d.cloudViz||{},a=e.core||{},b=d.dv||{},c=d.d3||{},f=Object.create(a);
f.init=function(g){this._type="sunburst";
this._hiddenNodes=[];
this._outRangeNodes=[];
this._invalidNodes=[];
this._initDefaultOptions();
this.setOptions(g);
return this
};
f._initDefaultOptions=function(){var h="Visits",g={otherColor:"#ccc",otherGrayColor:"#999",outRangeColor:"#5a5a5a",metricColor:"#fff",seqColors:["#faf0c8","#d2dc73","#5faf69","#00505A"],seqColorsHeat:["#5a6eaa","#3287d2","#3cb5a0","#5faf69","#8cc350","#c3d250","#f5c841","#f0a01e","#eb782d","#fa5a50"],colors:["#3287d2","#9b8ce6","#d755a5","#fa5a50","#f0a01e","#c3d250","#5faf69","#1ebed7","#5a6eaa","#78b4f5","#aa5fa5","#f0557d","#e8782d","#f5c841","#8cc350","#3cb5a0","#286eaf","#826ee1","#b93282","#f04641","#e18c00","#a0b400","#50965a","#00a0be","#465a87","#4196e6","#964196","#dc3c69","#dc5f00","#e6b43c","#7daf4b","#32a08c"],padding:{top:10,bottom:60,left:10,right:10}};
return Object.getPrototypeOf(f)._initDefaultOptions.call(this,g)
};
f._onAutoResize=function(){this.resize()
};
f.resize=function(){if(!c.select(this._options.parent).selectAll(".sunburst-cv").node()){return
}this._sizeChart();
this._render(true)
};
f.reset=function(){Object.getPrototypeOf(f).reset.apply(this,arguments)
};
f._preRender=function(){if(this._paths){var A=this._oldKeys=this._dataAdapter.getDataByPathKey(),P,T;
for(P in A){T=A[P];
A[P]={xo:T.x,dxo:T.dx,yo:T.y,dyo:T.dy}
}}Object.getPrototypeOf(f)._preRender.apply(this);
var u=this._options,l=this,I=this._dataAdapter,O=I.l10n.labels.sunburst,m=c.select(u.parent);
if(I.getSecondaryMetricIndex()){l._hideNode(I.data(),l._invalidNodes,function(k){return l._isInvalidNode(k)
})
}var M=this._hiddenNodes,K=I.getDataByPathKey();
this._hiddenNodes=[];
M.forEach(function(Y,X){var k=I.getPathKey(Y);
if(K[k]){l._hideNode(K[k],l._hiddenNodes)
}});
var w=this._zoomedPath;
this._zoomedPath=null;
if(w){w=K[I.getPathKey(w)];
this._zoomedPath=this._oldZoomed=w
}var E=this._lockedNode;
this._lockedNode=null;
if(E){if("path"===E.type){E.data=K[I.getPathKey(E.data)];
if(E.data){this._oldLockedNode=E
}}if("category"===E.type){var h=I.categories().some(function(k){if(E.data&&E.data.name===k.name){E.data=k;
return true
}return false
});
if(h){this._oldLockedNode=E
}}}var j=m.selectAll(".sunburst-cv").data([0]);
j.enter().insert("div",":first-child").classed("sunburst-cv",true);
var r=j.selectAll(".sunburst-cv-wrapper").data([0]);
r.enter().insert("div",":first-child").classed("sunburst-cv-wrapper",true);
var G=r.selectAll(".sunburst-cv-container").data([0]);
G.enter().insert("div",":first-child").classed("sunburst-cv-container",true);
var g=G.selectAll(".sunburst-svg").data([0]);
g.enter().append("svg").classed("sunburst-svg",true);
var C=g.selectAll(".sunburst-svg-container").data([0]);
C.enter().append("g").classed("sunburst-svg-container",true);
var i=r.selectAll(".sunburst-cv-label").data([0]);
i.enter().append("div").classed("sunburst-cv-label",true);
var H=i.selectAll(".sunburst-cv-label-wrap").data([0]);
H.enter().append("div").classed("sunburst-cv-label-wrap",true);
var p=H.selectAll(".sunburst-cv-label-metric").data([0]);
p.enter().append("div").classed("sunburst-cv-label-metric",true);
var q=H.selectAll(".sunburst-audiences").data([0]);
q.enter().append("div").classed("sunburst-audiences",true);
q.exit().remove();
var L=j.selectAll(".sunburst-cv-actions-pane").data([0]);
L.enter().append("div").classed("sunburst-cv-actions-pane",true);
L.exit().remove();
var J=L.selectAll(".actions-pane-zoomout").data([0]);
J.enter().append("div").classed("actions-pane-zoomout",true).classed("actions-pane-action",true);
J.html('<i class="icon zoomout"></i><span>'+O.zoomout+"</span>");
J.on("click",function(){l._zoomPath(I.data())
});
J.exit().remove();
var n=L.selectAll(".actions-pane-hidden").data([0]);
n.enter().append("div").classed("actions-pane-hidden",true).classed("actions-pane-action",true);
n.html('<i class="icon hide"></i><span>'+l._hideLabelText()+"</span>");
n.on("click",function(){l._unhidePaths()
});
n.exit().remove();
var B=r.selectAll(".sunburst-cv-sec-viz").data([0]);
var o=B.enter().append("div").classed("sunburst-cv-sec-viz",true);
o.append("span").classed("title",true);
var t=o.append("span").classed("bar",true);
t.append("span").classed("button",true).classed("color",true).append("span");
t.append("span").classed("button",true).classed("height",true).append("span");
t.append("span").classed("button",true).classed("both",true).append("span");
B.selectAll(".button.color").on("click",function(){I.setSecondaryMetricType("color");
l._secondaryMetricChanged()
}).selectAll("span").html(O.color);
B.selectAll(".button.height").on("click",function(){I.setSecondaryMetricType("height");
l._secondaryMetricChanged()
}).selectAll("span").html(O.height);
B.selectAll(".button.both").on("click",function(){I.setSecondaryMetricType("both");
l._secondaryMetricChanged()
}).selectAll("span").html(O.both);
B.exit().remove();
var D=r.selectAll(".sunburst-cv-secondary").data([0]);
D.enter().append("div").classed("sunburst-cv-secondary",true);
D.exit().remove();
var S=D.selectAll(".sunburst-cv-color").data([0]);
S.enter().append("div").classed("sunburst-cv-color",true);
S.exit().remove();
var N=j.selectAll(".sunburst-cv-info-pane").data([0]);
N.enter().append("div").classed("sunburst-cv-info-pane",true);
N.exit().remove();
var W=N.selectAll(".info-pane-content").data([0]);
W.enter().append("div").classed("info-pane-content",true);
W.exit().remove();
var Q=W.selectAll(".info-pane-categories").data([0]);
Q.enter().append("div").classed("info-pane-categories",true).append("div").classed("pane-title",true).append("span");
Q.exit().remove();
var U=W.selectAll(".sunburst-audiences").data([0]);
U.enter().append("div").classed("sunburst-audiences",true).append("div").classed("pane-title",true).append("span").text(O.audience);
U.exit().remove();
var v=W.selectAll(".info-pane-actions").data([0]);
v.enter().append("div").classed("info-pane-actions",true);
v.exit().remove();
var z=W.selectAll(".info-pane-metrics").data([0]);
var V=z.enter().append("div").classed("info-pane-metrics",true);
V.append("div").classed("pane-title",true).classed("pri-metric",true).append("span");
V.append("div").classed("info-pane-metrics-labels",true).classed("pri-metric-labels",true);
V.append("div").classed("pane-title",true).classed("sec-metric",true).append("span");
V.append("div").classed("info-pane-metrics-labels",true).classed("sec-metrics-labels",true).append("span").classed("sec-metrics-help",true);
V.append("div").classed("pane-title",true).classed("rank-chart",true).append("span");
V.append("div").classed("info-pane-metrics-chart",true);
z.exit().remove();
var s=W.selectAll(".info-pane-extra").data([0]);
s.enter().append("div").classed("info-pane-extra",true);
s.exit().remove();
var R=j.selectAll(".sunburst-cv-mobile-scroll").data([0]);
R.enter().append("div").classed("sunburst-cv-mobile-scroll",true);
R.html(O.mobilescroll);
R.exit().remove();
this._sizeChart();
j.classed("hiddenpaths",!!this._hiddenNodes.length)
};
f._render=function(B){Object.getPrototypeOf(f)._render.apply(this);
var s=this,j=this._options,v=this._dataAdapter,D=v.data(),l=c.select(j.parent).selectAll(".sunburst-cv"),q=l.selectAll(".sunburst-cv-container"),u=q.selectAll(".sunburst-svg-container"),w=parseInt(q.style("width"),10),t=parseInt(q.style("height"),10),k=this._radius=Math.min(w,t)/2;
var o=this._isMobileSize(),n=(D.categories.length+1),r=this._ringDivisor=1/n,C=o?20:140,g=this._centerRadius=Math.ceil((C/2)/(Math.cos(Math.PI/4)));
u.attr("transform","translate("+(w/2)+","+(t/2)+")");
if(!B&&this._yScale){this._oldYScale=this._yScale
}if(!B&&this._xScale){this._oldXScale=this._xScale
}var G=this._xScale=c.scale.linear().domain(this._oldXScale?this._oldXScale.domain():[0,1]).range([0,2*Math.PI]),i=this._yScale=c.scale.linear().domain([0,r,1]).range([0,g,k]),m=this._arc=c.svg.arc().startAngle(function(H){return Math.max(0,Math.min(2*Math.PI,G(H.x)))
}).endAngle(function(H){return Math.max(0,Math.min(2*Math.PI,G(H.x+H.dx)))
}).innerRadius(function(H){return Math.max(0,i(H.y))
}).outerRadius(function(H){return Math.max(0,i(H.y+H.dy))
});
this._layoutPaths(B);
var p=c.select(j.parent).select(".sunburst-cv-label"),A=Math.ceil((g*Math.cos(Math.PI/4))*2),h=A,z=j.padding.top+Math.floor(t/2-h/2),E=j.padding.left+Math.floor(w/2-A/2);
if(!o){p.style("top",z+"px").style("left",E+"px").style("width",A+"px").style("height",h+"px")
}else{p.style("top","").style("left","").style("width","").style("height","")
}this._updateDetails(this._lockedNode);
if(v.isDataEmpty()){this._setErrorMessage(v.l10n.labels.core.nodata)
}else{if(v.isSizeEmpty()){this._setErrorMessage(v.l10n.labels.sunburst.emptyFirstMetric)
}else{this._clearErrorMessage()
}}};
f._getHiddenNodes=function(){return this._hiddenNodes.concat(this._outRangeNodes,this._invalidNodes)
};
f._adjustDataSize=function(i,j,l){var v=this._options,t=this,q=this._dataAdapter,h=i.depth-1,u=this._zoomedPath,s=0.15,n=q.getStackedMetricIndex();
if(h>=0&&i.metrics&&i.metrics[n]){i.y-=j;
var r=i.metrics[n].value,p=l[h],o=p.max,m=Math.min(0,p.min),k=c.scale.linear().domain([m,o]).range([s,1]),g=k(r)*i.dy;
if(o===m||(u&&u.depth>i.depth)){g=i.dy
}j+=(i.dy-g);
i.dy=g
}if(!i.children||!i.children.length){return
}i.children.forEach(function(w){t._adjustDataSize(w,j,l)
})
};
f._getLevelUniqueNodes=function(i,g,j){var n=this._dataAdapter,k=this._getHiddenNodes(),h=[],l=[],o=this,p=this._zoomedPath;
function m(q){if(p&&p.depth===q.depth&&p!==q){return
}if(q.depth===g){if(!j&&k.indexOf(q)>=0){return
}if(l.indexOf(q.name)>=0){return
}h.push(q);
l.push(q.name);
return
}if(!q.children||!q.children.length){return
}q.children.forEach(function(r){m(r)
})
}m(i);
return h||[]
};
f._layoutPaths=function(G){var j=this._options,o=this._arc,u=this,w=this._dataAdapter,H=w.data(),D=this._getHiddenNodes(),q=c.select(j.parent).selectAll(".sunburst-svg-container"),l=c.layout.partition().value(function(k){return(D.indexOf(k)<0)?k.size:0
}).sort(function(s,k){if(w.isOther(s)){return 1
}if(w.isOther(k)){return -1
}return k.size-s.size
});
if(G&&u._paths){u._paths.each(function(k){k.xo=k.x;
k.dxo=k.dx;
k.yo=k.y;
k.dyo=k.dy
})
}var A=l.nodes(H);
var B=this._paths=q.selectAll("path").data(A,w.getPathKey);
B.enter().insert("path",":first-child");
B.attr("data-sid",function(s,k){return s._sid
}).on("click",function(s,k){u._lockNode({data:s,type:"path"})
}).on("dblclick",function(s,k){u._zoomPath(s)
}).on("mouseenter",function(s,k){if(u._lockedNode||u._isTouch()){return
}u._highlightNode({data:s,type:"path"})
});
var E=B.exit().classed("removing",true);
setTimeout(function(){E.remove()
},501);
u.setColorScale();
this._updatePathColors();
u._buildColorSlider();
var z;
if(z=w.getStackedMetric()){var m=w.getStackedMetricIndex(),t=this._zoomedPath,h=false,v;
if(h){var i=u.getMetricCategoryMinMax(m);
v=Array.apply(null,new Array(H.categories.length)).map(function(){return i
})
}else{v=H.categories.map(function(s,k){return u.getMetricCategoryMinMax(m,k)
})
}u._adjustDataSize(H,0,v)
}if(this._oldKeys){var I,C,n=this._oldYScale,p=n.domain(),r=this._yScale,g=r.domain();
u._paths.each(function(k){I=w.getPathKey(k);
if(C=u._oldKeys[I]){k.xo=C.xo;
k.dxo=C.dxo;
k.yo=r.invert(n(C.yo));
if(w.isRoot(k)){k.dyo=r.invert(n(C.dyo))
}else{k.dyo=r.invert(n(p[1]+C.dyo))-g[1]
}}});
this._oldKeys=null
}B.each(function(s){var k=w.getPathKey(s);
if("undefined"===typeof s.xo){s.xo=s.x;
s.dxo=s.dx;
s.yo=0;
s.dyo=0
}});
B.transition().duration(500).attrTween("d",this._changeTween(true));
q.on("mouseleave",function(s,k){if(u._lockedNode||u._isTouch()){return
}u._unhighlightNode()
});
if(!G){if(this._oldLockedNode){this._lockNode(this._oldLockedNode)
}else{this._unlockNode()
}this._oldLockedNode=null;
this._updateZoomPathStyles(this._oldZoomed);
this._oldZoomed=null
}};
f._isMobileSize=function(){var h=this._options,i=h.parent.offsetWidth,g=b.util.getPercentValue(h.width,i);
return g<640
};
f._isTouch=function(){return"ontouchstart" in document.documentElement
};
f._postRender=function(){Object.getPrototypeOf(f)._postRender.apply(this)
};
f._sizeChart=function(t){var j=this._options,B=this._dataAdapter.data(),m=c.select(j.parent),z=this,s=m.selectAll(".sunburst-cv"),k=s.selectAll(".sunburst-cv-wrapper"),q=k.selectAll(".sunburst-cv-container"),i=s.selectAll(".sunburst-cv-info-pane"),g=s.selectAll(".sunburst-cv-mobile-scroll"),p=j.parent.offsetWidth,h=j.parent.offsetHeight,A=b.util.getPercentValue(j.width,p),u=b.util.getPercentValue(j.height,h),o=this._isMobileSize(),r=A+(o?0:-250),l=o?Math.min(r,u):u,v=j.padding;
var n=r-2-(v.left+v.right),w=l-2-(v.top+v.bottom);
s.style("width",A+"px").style("height",u+"px").classed("is-desktop",!o).classed("not-touch",!this._isTouch());
k.style("width",r+"px").style("height",l+"px");
q.style("width",n+"px").style("height",w+"px");
q.style("padding-top",v.top+"px").style("padding-left",v.left+"px");
g.style("top",(u-30)+"px").classed("visible",!s.node().scrollTop).classed("show",u<=l+130);
s.on("scroll",function(){g.classed("visible",!s.node().scrollTop)
})
};
f._buildColorSlider=function(){var j=this._options,B=this,D=this._dataAdapter,E=c.select(j.parent).selectAll(".sunburst-cv-color");
if(!D.getColorMetric()){return E.text("")
}var N=D.data(),G=D.getColorMetric(),t=this._colorExtent,I=B._colorExtentMin,J=B._colorExtentMax,u=c.select(j.parent).selectAll(".sunburst-cv-container"),s=parseInt(u.style("width"),10),M=s/2,q=D.seqColors(),n=Math.round(100/(q.length-1)),o=[],C=12,v=10,m=9,i=40,k=(C+(v*2)+2),z=M,w=z-(i*2)-(m*2);
q.forEach(function(P,O){o.push((O*n)+"%")
});
E.style("width",z+"px");
var L=E.selectAll(".legend-title").data([0]);
L.enter().insert("div",":first-child").classed("legend-title",true);
L.text(G.name);
var h=E.selectAll(".color-slider-legend").data([0]);
h.enter().append("div").classed("color-slider-legend",true);
h.style("width",z+"px").style("height",k+"px");
var A=h.selectAll(".color-slider").data([0]);
A.enter().append("svg").classed("color-slider",true).style("height",k+"px").style("width","100%");
var p=A.selectAll("style").data([0]);
p.enter().append("style");
p.text(function(P){var O=".sunburst-cv .sunburst-cv-color .grad-rect { fill: url(#backGradient); \n";
return O
});
var g=A.selectAll("defs").data([0]);
g.enter().append("defs");
var H=g.selectAll("#backGradient").data([0]);
H.enter().append("linearGradient").attr("id","backGradient");
var r=function(R,P,O){var Q=R.selectAll("stop").data(P);
Q.enter().append("stop").attr("class",function(T,S){return"stop"+S
});
Q.attr("offset",function(S){return S
}).attr("stop-color",function(T,S){return O[S]
})
};
r(H,o,q);
var K=A.selectAll(".grad-rect").data([0]);
K.enter().append("rect").classed("grad-rect",true);
K.attr("x",i+m).attr("y",v).attr("rx",C/2).attr("ry",C/2).attr("width",w).attr("height",C);
var l=h.selectAll(".legend-label").data(["min","max"]);
l.enter().append("div").attr("class",function(O){return"legend-label "+O
});
l.style("left",function(O){return(O==="min"?0:i+(m*2)+w)+"px"
}).style("width",i+"px").text(function(P){var O=P==="min"?I:J;
O=(null===O)?(P==="min")?"-":"+":B._formatNumber(G.format,O);
return O
})
};
f._isNodeOutsideRange=function(k){var h=this._dataAdapter,i=this,j=k.children||[],g=j.some(function(l){return !i._isNodeOutsideRange(l)
});
return !g&&this.isOutsideRange(k)
};
f._isInvalidNode=function(g){return this._dataAdapter.isOther(g)
};
f._hideLabelText=function(){var h=this._hiddenNodes.length,i=this._dataAdapter.l10n.labels.sunburst,g=(h===1)?i.hidden:i["hidden2+"];
return g.replace(/\{value\}/i,h)
};
f._hideNode=function(j,i,h){var g=this;
if(i.indexOf(j)>-1){return
}if(h&&h(j)||!h){i.push(j)
}if(!j.children||!j.children.length){return
}j.children.forEach(function(k){g._hideNode(k,i,h)
})
};
f._hidePath=function(n,l,j){var i=this._options,g=this._dataAdapter,m=this._paths;
this._hideNode(n,l,j);
this._layoutPaths(true);
if(this._lockedNode&&l.indexOf(this._lockedNode.data)>-1){this._unlockNode()
}if(this._zoomedPath&&l.indexOf(this._zoomedPath)>-1){this._zoomPath(g.data())
}var h=this._hiddenNodes.length,k=c.select(i.parent);
k.selectAll(".actions-pane-hidden").selectAll("span").html(this._hideLabelText());
k.selectAll(".sunburst-cv").classed("hiddenpaths",!!h)
};
f._unhidePaths=function(){this._hiddenNodes=[];
this._layoutPaths(true);
c.select(this._options.parent).selectAll(".sunburst-cv").classed("hiddenpaths",false)
};
f._zoomPath=function(g){if(!this._canZoomIn(g)){return
}this._zoomedPath=g;
this._layoutPaths(true);
this._updateZoomPathStyles(g);
this._updateDetails(this._lockedNode)
};
f._updateZoomPathStyles=function(i){var h=this,g=c.select(this._options.parent).selectAll(".sunburst-cv");
g.classed("zoomed",i&&i.depth>0);
g.selectAll(".sunburst-cv-container").selectAll("path").each(function(j){c.select(this).classed("beyondzoom",j&&i&&j!==i&&j.depth>0&&(j.depth<=i.depth||!h._hasAncestorNode(j,i)));
c.select(this).classed("zoomed",j===i)
})
};
f._changeTween=function(i){var m=this._xScale,l=this._yScale,r=this._zoomedPath||this._dataAdapter.data(),g=this._arc,k=this._radius,h=this._ringDivisor,p=this._centerRadius,o=this._dataAdapter.categories(),n=c.interpolate(m.domain(),[r.x,r.x+r.dx]),j=c.interpolate(l.domain(),(r.y)?[0,h,r.y,1]:[0,h,1]),q=c.interpolate(l.range(),(r.y)?[0,p,p,k]:[0,p,k]);
return function(u,s){var t=c.interpolate({x:u.xo,dx:u.dxo,y:u.yo,dy:u.dyo},u);
return s?function(v){return i?g(t(v)):g(u)
}:function(v){m.domain(n(v));
l.domain(j(v)).range(q(v));
return i?g(t(v)):g(u)
}
}
};
f._updatePathColors=function(){var i=this,h=this._dataAdapter,k=this._getHiddenNodes(),g=c.select(this._options.parent).selectAll(".sunburst-cv"),j=g.classed("node-highlighted");
this._paths.style("fill",function(n){var m=c.select(this),l=j&&(!m.classed("highlighted"));
return i.getNodeColor(n,l)
}).classed("hidden",function(l){return k.indexOf(l)>=0
})
};
f._lockNode=function(j){var h=this,i=h._options,g=h._lockedNode;
if(g&&g.data===j.data&&g.type===j.type){return h._unlockNode(j)
}h._lockedNode=j;
h._highlightNode(j);
h._updateLockedState(j);
setTimeout(function(){c.select(h._options.parent).select(".sunburst-cv-wrapper").on("click.cvpath",function(){if(c.event&&c.event.target&&c.event.target.nodeName==="path"){return
}h._unlockNode()
})
},10)
};
f._unlockNode=function(i){var g=this,h=g._options;
g._lockedNode=null;
g._updateLockedState();
if(i&&!g._isTouch()){g._highlightNode(i)
}else{g._unhighlightNode()
}c.select(g._options.parent).select(".sunburst-cv-container").on("click.cvpath",null)
};
f._highlightNode=function(m){var j=this,k=m&&m.type||"path",l=m&&m.data||null,i=this._getAncestorNodes(l),h={};
h.category=function(o){return o.depth===l.index+1
};
h.item=function(o){return o&&l&&o.name===l.name
};
h.path=function(o){return i.indexOf(o)>=0||(j._lockedNode&&o.parent===l)
};
var g=c.select(this._options.parent).selectAll(".sunburst-cv");
g.classed("node-highlighted",true);
g.selectAll(".sunburst-cv-container").selectAll("path").each(function(o){c.select(this).classed("highlighted",h[k](o))
});
if(!j._lockedNode){g.selectAll(".info-pane-category").each(function(n){c.select(this).classed("disabled","category"===k&&n!==l)
})
}this._updateDetails(m);
this._updatePathColors()
};
f._unhighlightNode=function(){this._removeHighlights();
this._updateDetails()
};
f._removeHighlights=function(){var g=c.select(this._options.parent);
g.selectAll(".sunburst-cv").classed("node-highlighted",false).selectAll("path").classed("highlighted",false);
g.selectAll(".info-pane-category").classed("disabled",false);
this._updatePathColors()
};
f._secondaryMetricChanged=function(){var o=this,l=this._dataAdapter,p=l.l10n.labels.sunburst,i=l.getSecondaryMetricIndex();
o._outRangeNodes=[];
if(i){o._hidePath(l.data(),o._invalidNodes,function(m){return o._isInvalidNode(m)
})
}else{o._invalidNodes=[];
o._layoutPaths(true)
}var h=c.select(this._options.parent);
h.selectAll(".sunburst-cv").classed("secondary-metric",!!i);
var n=h.selectAll(".sunburst-cv-sec-viz");
n.selectAll(".button").classed("active",false);
var k=l.getSecondaryMetricType();
if(k){n.selectAll(".button."+k).classed("active",true)
}var j=l.getSecondaryMetric(),g=j&&j.name||null;
n.selectAll(".title").html(g?p.mapmetric.replace(/\{metric\}/i,g):"");
this._updateDetails(this._lockedNode);
this._updateMetricState()
};
f._updateDetails=function(g){if(g&&g.type==="item"){return
}this._setChartMetrics(g);
this._setDetailsMetrics(g);
this._setDetailsAudiences(g);
this._setDetailsCategories(g);
this._setDetailsActions(g)
};
f._setDetailsCategories=function(o){var s=this,q=this._dataAdapter,t=q.l10n.labels.sunburst,k=q.data(),m=q.categories(),h=c.select(this._options.parent).select(".info-pane-categories"),p=Math.max(0,s._zoomedPath?s._zoomedPath.depth-1:0),n=o&&o.type==="path"&&s._lockedNode?[]:m.slice(p),l=n.length,i=o||{},g=h.selectAll(".info-pane-category").data(n),r=g.enter().append("div").classed("info-pane-category",true).classed("inactive",true);
h.select(".pane-title").select("span").text((1===l.length)?t.category:t["category2+"]);
g.each(function(w,v){var u=c.select(this);
u.text("");
s._createRingMarker(u,l,v);
u.append("span").classed("name",true).html(w&&w.name||"");
u.append("span").classed("top",true).html("("+t.topresults.replace(/\{value\}/i,w.top)+")");
if(i.type==="path"){u.classed("disabled",!s._lockedNode&&i.data&&i.data.depth-1!==v-p)
}else{if(s._lockedNode&&s._lockedNode.type==="category"){u.classed("disabled",w!==s._lockedNode.data)
}}});
setTimeout(function(){r.classed("inactive",false)
},1);
var j=g.exit().classed("inactive",true).on("mouseenter",null).on("mouseleave",null).on("click",null);
setTimeout(function(){j.remove()
},400);
g.on("mouseenter",function(v,u){if(s._lockedNode||s._isTouch()){return
}s._highlightNode({data:v,type:"category"})
});
g.on("mouseleave",function(v,u){if(s._lockedNode||s._isTouch()){return
}s._unhighlightNode()
});
g.on("click",function(v,u){s._lockNode({data:v,type:"category"})
});
h.classed("empty",!n.length)
};
f._setDetailsAudiences=function(p){var t=this,r=this._dataAdapter,q=p&&p.type||"",j=p&&p.data||null,o=q==="category",k=r.data(),h=o?this._getLevelUniqueNodes(k,j.index+1,false):this._getAncestorNodes(j),m=o?function(v,u){return u
}:function(v,u){return v&&v.depth||0
},l=r.categories(),g=c.select(this._options.parent).selectAll(".sunburst-audiences"),n=h&&h[0]||k,i=k===n,s=(!h||i)?[]:h.slice();
g.each(function(A){var C=c.select(this),w=s.slice();
var B=c.select(C.node().parentNode).classed("sunburst-cv-label-wrap");
if(!o&&!B){if(!t._lockedNode){w=[]
}w.reverse()
}else{if(o&&B){w=[]
}}var v=C.selectAll(".sunburst-audience").data(w,m),u=v.enter().append("span").classed("sunburst-audience",true).classed("inactive",true);
u.append("span").classed("marker",true).style("background-color","#dcdcdc");
u.append("span").classed("category",true);
u.append("span").classed("name",true);
v.each(function(H,E){var D=c.select(this),G=l[H.depth-1];
D.select(".marker").style("background-color",t.getNodeColor(H));
D.select(".category").classed("hidden",o||B).text(!o&&G&&G.name||"");
D.select(".name").text(H.name);
D.classed("to-remove",false).attr("my-name",H.name).attr("my-depth",H.depth);
D.on("mouseenter",function(K,J){if(t._isTouch()){return
}t._highlightNode({data:K,type:"item"})
});
D.on("mouseleave",function(K,J){if(t._isTouch()){return
}if(t._lockedNode){t._highlightNode(t._lockedNode)
}else{t._unhighlightNode()
}});
if(B){return
}var I=c.select(D.node().cloneNode(true)).style("height","").classed("test",true).classed("inactive",false);
C.node().appendChild(I.node());
D.attr("my-height",parseInt(I.style("height"),10));
I.remove()
});
v.order();
setTimeout(function(){v.each(function(G,E){var D=c.select(this);
D.classed("inactive",false);
if(B){return
}D.style("height",D.attr("my-height")+"px")
})
},1);
var z=v.exit().classed("inactive",true).style("height","").classed("to-remove",true).on("mouseenter",null).on("mouseleave",null).on("click",null);
setTimeout(function(){z.each(function(G,E){var D=c.select(this);
if(D.classed("to-remove")){D.remove()
}})
},400);
C.classed("empty",!w.length)
})
};
f._setDetailsActions=function(w){var p=this,q=this._dataAdapter,z=q.data(),s=c.select(this._options.parent).select(".info-pane-actions");
var B=s.selectAll(".info-pane-actions-chart").data([0]);
B.enter().append("div").classed("info-pane-actions-chart",true).classed("info-pane-actions-pane",true);
var g=s.selectAll(".info-pane-actions-extra").data([0]);
g.enter().append("div").classed("info-pane-actions-extra",true).classed("info-pane-actions-pane",true);
function v(){p._zoomPath(p._lockedNode.data)
}function i(){p._zoomPath(z)
}function m(){p._hidePath(p._lockedNode.data,p._hiddenNodes)
}function n(){var C=p._lockedNode.data,D=p._hiddenNodes;
if(!C){return
}p._hidePath(z,D,function(E){return E.name===C.name||D.indexOf(E.parent)>=0
})
}var l=[],h=q.l10n.labels.sunburst;
if(w&&w.type==="path"&&p._lockedNode){var u=w.data,k=p._canZoomIn(u),o=u===z;
if(!p._lockedNode){if(!o){l.push({click:false,icon:"more",label:h.moreAction})
}if(k){l.push({click:false,icon:"zoomin",label:h.zoomAction})
}}else{if(!o){if(k){l.push({click:v,className:"zoomin",icon:"zoomin",label:h.zoomin})
}else{if(p._canZoomOut(u)){l.push({click:i,className:"zoomout",icon:"zoomout",label:h.zoomout})
}}l.push({click:m,className:"hide",icon:"hide",label:h.hide});
l.push({click:n,className:"hideallname",icon:"hide",label:h.hideall})
}}}var j=p._getExtraActions(w),r=!!l.length,A=!!j.length;
s.classed("full-width",(!r&&A)||(!A&&r));
s.classed("empty",(!r&&!A));
p._buildActionsPane(B,l);
p._buildActionsPane(g,j);
var t=s.selectAll(".hideallname");
t.on("mouseenter",function(){if(p._isTouch()){return
}p._highlightNode({data:p._lockedNode.data,type:"item"})
});
t.on("mouseleave",function(D,C){if(p._isTouch()){return
}if(p._lockedNode){p._highlightNode(p._lockedNode)
}else{p._unhighlightNode()
}})
};
f._buildActionsPane=function(h,j){var i=h.selectAll(".info-pane-action").data(j);
var k=i.enter().append("a").classed("info-pane-action",true).classed("inactive",true);
k.append("i").classed("icon",true);
k.append("span");
i.each(function(n,m){var l=c.select(this);
l.select(".icon").attr("class","icon").classed(n.icon,true);
l.select("span").text(n.label);
l.attr("class","info-pane-action"+(l.classed("inactive")?" inactive":"")+(n.click||n.href?" action":" help"));
if(n.click){l.on("click",n.click)
}else{l.on("click",null)
}if(n.href){l.attr("href",n.href)
}else{l.attr("href",null)
}if(n.className){l.classed(n.className,true)
}var o=c.select(l.node().cloneNode(true)).style("height","").classed("test",true).classed("inactive",false);
h.node().appendChild(o.node());
l.attr("my-height",parseInt(o.style("height"),10));
o.remove()
});
setTimeout(function(){i.each(function(n,m){var l=c.select(this);
l.style("height",l.attr("my-height")+"px").classed("inactive",false)
})
},1);
var g=i.exit().classed("inactive",true).style("height","").classed("to-remove",true).on("click",null);
setTimeout(function(){g.each(function(n,l){var m=c.select(this);
if(m.classed("to-remove")){m.remove()
}})
},400);
return !!j.length
};
f._setDetailsMetrics=function(p){var t=this,i=c.select(this._options.parent).select(".info-pane-metrics"),j=i.select(".pri-metric-labels"),h=i.select(".sec-metrics-labels"),q=i.select(".info-pane-metrics-chart"),r=this._dataAdapter,l=r.data(),g=l.metrics.slice(0,1),s=l.metrics.slice(1),n=r.categories(),u=r.l10n.labels.sunburst,o=p&&p.type==="path"?p.data:null,k=o||l,m=o&&o.children&&o.children.length&&this._lockedNode;
i.classed("total",!m);
i.selectAll(".pane-title").each(function(A,w){var z=c.select(this),v=z.select("span");
if(z.classed("pri-metric")){return v.text(u.primarymetric)
}if(z.classed("sec-metric")){z.classed("hidden",!s.length);
return v.text(!s.length?"":(s.length===1)?u.secondarymetric:u["secondarymetric2+"])
}if(z.classed("rank-chart")){v.text((m)?n[o.depth]&&n[o.depth].name:"")
}});
i.selectAll(".sec-metrics-help").each(function(w,v){c.select(this).text(s.length===1?u.secondarymetrichelp:u["secondarymetrichelp2+"]).classed("hidden",!s.length)
});
this._setNodeMetricLabels(j,k,g,!!o);
this._setNodeMetricLabels(h,k,s,!!o);
this._setNodeMetricChart(q,this._lockedNode?o:null)
};
f._setChartMetrics=function(k){var g=c.select(this._options.parent).select(".sunburst-cv-label-wrap"),j=this._dataAdapter.data(),h=j.metrics.slice(),i=k&&k.type==="path"?k.data:j;
if(h.length>1){h.length=1
}this._setNodeMetricLabels(g,i,h,false)
};
f._setNodeMetricLabels=function(g,i,n,k){var p=this,o=this._dataAdapter,j=o.data(),q=o.l10n.labels.sunburst,h=g.classed("pri-metric-labels")||g.classed("sunburst-cv-label-wrap"),l=g.selectAll(".sunburst-cv-label-metric").data(n),m=l.enter().append("div").classed("sunburst-cv-label-metric",true);
k=(i&&i.children&&i.children.length&&this._lockedNode)?k:false;
l.each(function(w,z){var H=c.select(this),J=p.getNodeValue(i,h?z:z+1),G=p.getNodeValue(j,h?z:z+1),s="percent"===w.format,t=(o.isOther(i)&&!h)||(0===G),D=s?J:J/p.getNodeValue(j,h?z:z+1),u=h||(z+1)===o.getSecondaryMetricIndex(),C=k&&u,I=null!==J&&!s&&!t&&i!==j;
H.classed("active",u);
var E=H.selectAll(".sunburst-cv-label-icon").data([w]);
E.enter().append("i");
E.each(function(K){c.select(this).attr("class","sunburst-cv-label-icon icon").classed(w.icon||(h?"donut":"stack"),true)
});
var v=H.selectAll(".sunburst-cv-label-number").data([w]);
v.enter().append("span").classed("sunburst-cv-label-number",true);
v.html(t?"":p._formatValue(w,J)).classed("hidden",t);
var r=H.selectAll(".sunburst-cv-label-name").data([w]);
r.enter().append("span").classed("sunburst-cv-label-name",true).append("span");
r.select("span").html(I?q.percmetric.replace(/\{percent\}/i,p._formatNumber("percent",D)).replace(/\{metric\}/i,w.name):w.name);
var B=p.getMetricMaskNum(h?z:z+1);
var A=r.selectAll(".sunburst-cv-label-marker").data([w]);
A.enter().insert("svg",":first-child").classed("sunburst-cv-label-marker",true).append("rect").attr("width",12).attr("height",12);
A.classed("hidden",!C).select("rect").attr("style",(null===B)?"":"mask: url(#diagmask"+B+");");
H.on("click",h?null:function(){o.setSecondaryMetricIndex(z+1);
p._secondaryMetricChanged()
})
});
l.exit().remove()
};
f._formatValue=function(j,l,i){if("time"!==j.format){return this._formatNumber(j.format,l)
}var h=l,g=this._dataAdapter,k=i?g.l10n.time.abbreviation:(1===h)?g.l10n.time.singular:g.l10n.time.plural,m=g.getTimeGranularity(h,true);
return this._formatNumber(j.format,h/m.divisor)+" "+k[m.gran]
};
f._setNodeMetricChart=function(s,E){var v=this,z=this._dataAdapter,Q=z.data(),M=v._getHiddenNodes(),l=E&&E.children||[],j=l.filter(function(S){return M.indexOf(S)<0
}),r=[],q=[],J=[],A=[],B=[],N=[],g={x:r,y:q,fill:J,metric:A,format:N,node:B};
function m(S,T){return 0===T||T===z.getSecondaryMetricIndex()
}var G=Q.metrics.slice(),w=G.filter(m),D=w.map(function(S){return S.name
});
j.reverse().forEach(function(T){var S;
G.forEach(function(U,V){if(!m(U,V)){return
}if(null!==(S=v.getNodeValue(T,V))){q.push(S);
r.push(T.name);
J.push(U.name);
A.push(U.name);
N.push(U.format);
B.push(T)
}})
});
var P=!!q.length;
var k=s.selectAll(".info-pane-chart-svg").data([0]);
k.enter().append("div").classed("info-pane-chart-svg",true);
k.exit().remove();
s.classed("hidden",!P);
if(P){var I=15,L=25,C=0.05,i=w.length,H=j.length,u=(i*I)+L,R=L/u,n=Math.ceil((i*H*I)/(1-R));
k.style("height",n+"px");
var t=b.chart().layers([b.geom.bar().map("group","fill").set("fill",function(T,S){return v.getNodeColor(T.data.node)
}).each("start",function(U,T){var S=v.getMetricMaskNum(D.indexOf(U.data.metric));
c.select(this).attr("mask",(null===S)?"":"url(#diagmask"+S+")")
}).on("click",function(S){v._selectChildFromRanked(S)
}).dodgePadding(C),b.geom.text().map("label","y").map("group","fill").set("fill","#4b4b4b").textFormat(function(T,S){return T?v._formatValue({format:this.__data__.data.format},T,true):""
}).textAnchor("start").set("fill","#4b4b4b").dx(4).dy(5).on("click",function(S){v._selectChildFromRanked(S)
})]).coord(b.coord.cartesian().flip(true)).data(g).position("dodge").guide("x",b.guide.axis().tickDx(function(T,S){return c.select(this).select("span").node().offsetWidth
}).tickDy(function(T,S){return((-i*I)/2)-(c.select(this).select("span").node().offsetHeight/2)
}).tickSize(0).tickAnchor("end")).guide("y",b.guide.axis().ticks(0).tickSize(0).tickFormat(function(T,S){return""
})).map("x","x",b.scale.ordinal().padding(R)).width("100%").height(n).duration(400).padding({top:2,right:65}).parent(k.node());
D.forEach(function(T,S){var U=b.scale.linear().lowerLimit(0);
U.includeInDomain(function(W,V){return W.data.metric===D[S]
});
t.map("y","y",U,S)
});
t.render();
var p=k.select("svg").selectAll("defs").data([0]);
p.enter().append("defs");
var h=[45];
var O=p.selectAll("pattern").data(h);
var o=O.enter().append("pattern").attr("id",function(T,S){return"diag"+S
}).attr("patternUnits","userSpaceOnUse").attr("width","3").attr("height","3").attr("patternTransform",function(T,S){return"rotate("+T+" 2 2)"
});
o.append("rect").attr("x","0").attr("y","0").attr("width","3").attr("height","3").attr("style","fill:#fff;");
o.append("path").attr("d","M -1,0 l 10,0").attr("style","stroke:#222; fill:none; stroke-width: 3px;");
var K=p.selectAll("mask").data(h);
K.enter().append("mask").attr("id",function(T,S){return"diagmask"+S
}).attr("x","0").attr("y","0").append("rect").attr("x","0").attr("y","0").attr("width","100%").attr("height","1").attr("style",function(T,S){return"stroke:none; fill:url(#diag"+S+")"
});
p.selectAll("mask").selectAll("rect").attr("height",n)
}else{k.style("height","0px")
}};
f._selectChildFromRanked=function(m){var g=this._lockedNode.data,h=m.data.x;
if(!g||!g.children||!g.children.length){return
}var j,l=g.children.length,n,k=null;
for(j=0;
j<l;
++j){if((n=g.children[j]).name===h){k=n;
break
}}if(k){this._lockNode({data:k,type:"path"})
}};
f._createRingMarker=function(j,n,l){var o=j.append("svg").classed("category-ring",true),p=o.append("g").attr("transform","translate(12,12)"),k=parseInt(o.style("width"),10),r=k/2,q=2,s=1,h=r-(q*n)-(s*(n-1)),u,t,m;
for(m=0;
m<n;
++m){u=h+((q+s)*m);
t=u+q;
p.append("path").classed("active",m===l).attr("d",c.svg.arc().innerRadius(u).outerRadius(t).startAngle(0).endAngle(2*Math.PI))
}};
f._canZoomIn=function(i){var h=this._dataAdapter.data(),g=this._zoomedPath;
return(i!==h&&i!==g)||(i===h&&h!==g&&!!g)
};
f._canZoomOut=function(g){return g===this._zoomedPath
};
f._getAncestorNodes=function(i){var h=[],g=i;
if(!i){return h
}while(g.parent){h.push(g);
g=g.parent
}if(!h.length){h=[i]
}return h
};
f._hasAncestorNode=function(i,g){if(!i||!g||i.depth<g.depth||i===g){return false
}var h=i;
while(h.parent){if(h.parent===g){return true
}h=h.parent
}return false
};
f._getInfoPaneHeight=function(i){var g=0,h;
c.selectAll(i.node().childNodes).each(function(k,j){h=c.select(this);
g+=parseInt(h.style("height"),10)+parseInt(h.style("padding-bottom"),10)+parseInt(h.style("padding-top"),10)
});
return g
};
f._updateLockedState=function(h){var g=this;
if(g._eventMap["sunburst.locked"]){g._eventMap["sunburst.locked"].call(this,h,g._dataAdapter.data())
}};
f._updateMetricState=function(){var h=this,g=h._dataAdapter;
if(h._eventMap["sunburst.metric"]){h._eventMap["sunburst.metric"].call(this,g.getSecondaryMetricIndex(),g.getSecondaryMetricType(),g.data())
}};
f._getExtraActions=function(h){var g=this;
if(g._eventMap["sunburst.actions"]){return g._eventMap["sunburst.actions"].call(this,h,!!this._lockedNode,g._dataAdapter.data())
}return[]
};
f.getNodeValue=function(h,g){if(!h){return 0
}if(h.metrics&&h.metrics.length&&h.metrics[g]&&"undefined"!==typeof h.metrics[g].value){return h.metrics[g].value
}if(g>0){return null
}if("undefined"!==typeof h.size){return h.size
}return h.value
};
f.getMetricCategoryMinMax=function(k,j){var g,n=this,l=this._dataAdapter,h=l.data(),i=this._getHiddenNodes(),p=this._zoomedPath;
function m(q){if(p&&p.depth===q.depth&&p!==q){return
}if("undefined"===typeof j||q.depth===j+1){if(l.isOther(q)){return
}if(i.indexOf(q)>=0){return
}var o=n.getNodeValue(q,k);
if("undefined"===typeof g){g={min:o,max:o}
}else{g.min=Math.min(g.min,o);
g.max=Math.max(g.max,o)
}if(j){return
}}if(!q.children||!q.children.length){return
}q.children.forEach(function(r){m(r)
})
}m(h);
return g||null
};
f.getNodeColor=function(k,g){var h=this._dataAdapter,j=this.getColorScale(k),i;
if(!k.depth){return h.metricColor()
}if(h.isOther(k)){i=h.otherColor()
}else{if(h.getColorMetric()){i=this.isOutsideRange(k)?h.outRangeColor():j(k.metrics[h.getColorMetricIndex()].value)
}else{i=j(k.name)
}}if(g){i=this._grayColor(i,k)
}return i
};
f._grayColor=function(m,l){var g=this._dataAdapter;
if(g.isOther(l)){return g.otherGrayColor()
}var j=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,i=m&&m.match(j);
if(!i){return m
}var h=[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)],k=Math.round((0.21*h[0])+(0.71*h[1])+(0.07*h[2]));
return"#"+((1<<24)+(k<<16)+(k<<8)+k).toString(16).slice(1)
};
f.getMetricMaskNum=function(g){return(g===0)?null:0
};
f.isOutsideRange=function(k){var h=this._dataAdapter,i=h.getColorMetric(),g=h.getColorMetricIndex();
if(!i||!k||!k.metrics||"percent"!==i.format){return false
}var j=k.metrics[g].value;
return j>this._colorExtentMax||j<this._colorExtentMin
};
f.getColorScale=function(i){var g=this._dataAdapter,h;
if(!(h=g.getColorMetric())){return this._colorScale
}if("percent"===h.format){return this._colorScale
}return this._categoryColorScales[i.depth-1]
};
f._createColorScale=function(r,n,j,m){var p=this._dataAdapter,g=p.seqColors(),l=((n-j)*r[0])+j,s=((n-j)*r[1])+j,o=s-l,h=g.length-1;
if(m){this._colorExtent=r;
this._colorExtentMin=l;
this._colorExtentMax=s
}var q=[l];
for(var k=1;
k<h;
++k){q.push(((o/h)*k)+l)
}q.push(s);
return c.scale.linear().domain(q).range(g).clamp(true)
};
f.setColorScale=function(l){l=l||[0,1];
var i=this,g=this._dataAdapter,m=g.data(),k;
if(!(k=g.getColorMetric())){this._colorScale=c.scale.ordinal().domain(g.uniques()).range(g.colors());
return
}var j=g.getColorMetricIndex(),h;
if("percent"===k.format){h=i.getMetricCategoryMinMax(j);
this._colorScale=this._createColorScale(l,h.max,h.min,true);
return
}h=m.categories.map(function(o,n){return i.getMetricCategoryMinMax(j,n)
});
this._categoryColorScales=h.map(function(p,n){return i._createColorScale(l,p.max,p.min,!n)
});
this._colorExtentMin=null;
this._colorExtentMax=null
};
d.cloudViz.sunburst=e.util.createConstructor(f)
}(this));
(function(e){var f=e.cloudViz||{},a=f.core||{},c=e.dv||{},d=e.d3||{},b=Object.create(a);
b.init=function(g){this._type="flower";
this._initDefaultOptions();
this.setOptions(g);
this.colorScale=c.scale.color()._d3Scale;
return this
};
b._initDefaultOptions=function(){var g={animationDuration:500,labelFormatter:null,clickHandler:null,onlyUseThreePetalLengths:true,isEmotionChart:true,mouseoverCallback:[null,null],horizontalPadding:70,verticalPadding:30,text_offset:5};
return Object.getPrototypeOf(b)._initDefaultOptions.call(this,g)
};
b._onAutoResize=function(){this._render()
};
b.resize=function(){this._render()
};
b.reset=function(){Object.getPrototypeOf(b).reset.apply(this,arguments)
};
b._preRender=function(){Object.getPrototypeOf(b)._preRender.apply(this)
};
b._setUpLayer=function(g,h){this["layer"+h]=g.selectAll(".flower-cv-svg-group-layer"+h).data([0]);
this["layer"+h].enter().append("g").classed("flower-cv-svg-group-layer"+h,true)
};
b.sprintf=function(g,h){return g.replace(/\{([\w]+)\}/ig,function(j,i){return h[i]
})
};
b._render=function(){Object.getPrototypeOf(b)._render.apply(this);
var m=this;
this._parent=d.select(this._options.parent);
var D=this._parent.selectAll(".cv-wrapper.cv-flower").data([0]);
D.enter().append("div").classed("cv-wrapper cv-flower",true);
var u=D.selectAll(".flower-cv-svg").data([0]);
u.enter().append("svg").classed("flower-cv-svg",true);
this._svg_group=u.selectAll(".flower-cv-svg-group").data([0]);
this._svg_group.enter().append("g").classed("flower-cv-svg-group",true);
this._setUpLayer(this._svg_group,1);
this._setUpLayer(this._svg_group,2);
this._setUpLayer(this._svg_group,3);
this._setUpLayer(this._svg_group,4);
this._setUpLayer(this._svg_group,5);
this._setUpLayer(this._svg_group,6);
var v=this._options.width||parseInt(this._parent.style("width"),10);
var t=this._options.height||parseInt(this._parent.style("height"),10);
D.style("width",v+"px").style("height",t+"px");
var j=v/2;
var s=t/2;
this._svg_group.attr("transform",this.sprintf("translate({width},{height})",{width:j,height:s}));
var E=m._dataAdapter.data();
var n=j-this._options.horizontalPadding;
var q=s-this._options.verticalPadding;
var i=this._options.labelFormatter||function(G){G.append("tspan").attr("class","flower-cv-petal-label").text(function(H){return H.label+" "
});
G.append("tspan").attr("class","flower-cv-petal-label-value").text(function(H){return m._formatNumber("percent",H.value/m._total,0)
})
};
var w=this._options.mouseoverCallback[0]||function(){d.select(this).attr("opacity",1)
};
var r=this._options.mouseoverCallback[1]||function(G){d.select(this).attr("opacity",G.petal_opacity).attr("fill",G.petal_color)
};
this._is_single_mode=this._options.onlyUseThreePetalLengths;
this._petal_size=Math.min(n,q);
this._circle_size=this._petal_size*0.676/2;
this._arc_thickness=this._petal_size*0.027;
this._arc_half_angle=360/E.length/2+0.5;
this._petal_count=E.length;
var z=d.scale.linear().domain([55,185]).range([9,12]).clamp(true);
this._font_size=z(this._petal_size);
var C=[{offset_y:1,fixed_offset_y:0,offset_x:0,location:"middle"},{offset_y:1,fixed_offset_y:0,offset_x:-1.5,location:"middle"},{offset_y:0,fixed_offset_y:-2.5,offset_x:-0.8,location:"start"},{offset_y:-1,fixed_offset_y:-9,offset_x:-1.5,location:"middle"},{offset_y:-1,fixed_offset_y:-9,offset_x:0,location:"middle"},{offset_y:-1,fixed_offset_y:-9,offset_x:1.5,location:"middle"},{offset_y:0,fixed_offset_y:-2.5,offset_x:0.8,location:"end"},{offset_y:1,fixed_offset_y:0,offset_x:1.5,location:"middle"}];
this._total=d.sum(E,function(G){return G.value
});
var A=d.scale.linear().domain([0,E.length]).range([0,360]);
this._getTextOffsetIndex=d.scale.linear().domain([0,360]).rangeRound([0,8]).clamp(true);
this._getSizeZeroToThree=d.scale.linear().domain([0,d.max(E,function(G){return G.value
})]).rangeRound([0,3]);
this._getPetalSize=d.scale.linear().domain([d.min(E,function(G){return G.value
}),d.max(E,function(G){return G.value
})]).rangeRound([this._circle_size+this._arc_thickness+10,this._petal_size]);
c.util.each(E,function(H,G){H.angle=A(G);
m._addPetalSizes(H)
});
this._getTextOffsetScale=function(H){var G=this._getTextOffsetIndex(H);
if(G==8){G=0
}return C[G]
};
var B=this.layer1.selectAll(".flower-cv-gray-petals").data(E);
B.enter().append("path").attr("class","flower-cv-gray-petals").attr("transform",function(G){return"rotate("+G.angle+")"
}).attr("d",m._makePetal(0,0,0,0)).attr("opacity",0);
B.transition().duration(m._options.animationDuration).attr("transform",function(G){return"rotate("+G.angle+")"
}).attr("d",function(G){return m._makePetal(0,0,0,G.full_petal)
}).attr("opacity",function(G){return G.petal_size_number==3?0:1
});
B.exit().transition().duration(m._options.animationDuration).attr("d",m._makePetal(0,0,0,0)).attr("opacity",0).remove();
var p=this.layer2.selectAll(".flower-cv-color-petals").data(E);
p.enter().append("path").attr("class","flower-cv-color-petals").attr("transform",function(G){return"rotate("+G.angle+")"
}).attr("opacity",function(G){return G.petal_opacity
}).attr("d",m._makePetal(0,0,0,0)).attr("fill",function(G){return G.petal_color
}).on("mouseover",w).on("mouseout",r).on("click",function(G){if(m._options.clickHandler){m._options.clickHandler(G)
}});
p.transition().duration(m._options.animationDuration).attr("d",function(G){return m._makePetal(0,0,0,G.petal_size)
}).attr("transform",function(G){return"rotate("+G.angle+")"
}).attr("fill",function(G){return G.petal_color
}).attr("opacity",function(G){return G.petal_opacity
});
p.exit().transition().duration(m._options.animationDuration).attr("d",m._makePetal(0,0,0,0)).attr("opacity",0).remove();
var l=this.layer3.selectAll(".flower-cv-white-arcs").data(E);
var k=d.svg.arc().innerRadius(0).outerRadius(this._circle_size+this._arc_thickness+1).startAngle(-m._arc_half_angle*(Math.PI/180)).endAngle(m._arc_half_angle*(Math.PI/180));
l.enter().append("path").attr("class","flower-cv-white-arcs").attr("transform",function(G){return"rotate("+G.angle+")"
}).attr("fill","white");
l.transition().duration(m._options.animationDuration).attr("d",k).attr("transform",function(G){return"rotate("+G.angle+")"
});
l.exit().remove();
k=d.svg.arc().innerRadius(0).outerRadius(this._circle_size+this._arc_thickness).startAngle(-(m._arc_half_angle-1)*(Math.PI/180)).endAngle((m._arc_half_angle-1)*(Math.PI/180));
var g=this.layer4.selectAll(".flower-cv-color-arcs").data(E);
g.enter().append("path").attr("class","flower-cv-color-arcs").attr("d",k).attr("transform",function(G){return"rotate("+G.angle+")"
}).attr("fill",function(G){return G.arc_color
});
g.transition().duration(m._options.animationDuration).attr("d",k).attr("fill",function(G){return G.arc_color
}).attr("transform",function(G){return"rotate("+G.angle+")"
});
g.exit().remove();
var o=this.layer5.selectAll(".flower-cv-petal-labels").data(E);
o.enter().append("text").attr("class","flower-cv-petal-labels").attr("x",0).attr("y",0).attr("text-anchor",function(G){return m._getTextOffsetScale(G.angle).location
}).attr("dx",function(G){return m._getTextOffsetScale(G.angle).offset_x*-m._options.text_offset
}).attr("dy",function(G){return m._getTextOffsetScale(G.angle).offset_y*-m._options.text_offset-m._getTextOffsetScale(G.angle).fixed_offset_y
}).style("font-size",m._font_size).attr("transform",function(G){return"rotate("+G.angle+") rotate("+-G.angle+", 0, "+0+")"
}).attr("opacity",0);
o.style("font-size",m._font_size+"px").attr("text-anchor",function(G){return m._getTextOffsetScale(G.angle).location
}).attr("dx",function(G){return m._getTextOffsetScale(G.angle).offset_x*-m._options.text_offset
}).attr("dy",function(G){return m._getTextOffsetScale(G.angle).offset_y*-m._options.text_offset-m._getTextOffsetScale(G.angle).fixed_offset_y
}).selectAll("*").remove();
i(o);
o.transition().duration(m._options.animationDuration).attr("y",function(G){return G.petal_size
}).attr("transform",function(G){return"rotate("+G.angle+") rotate("+-G.angle+", 0, "+G.petal_size+")"
}).attr("opacity",function(G){return G.petal_number_size===0?0:1
});
o.exit().remove();
var h=this.layer6.selectAll(".flower-cv-main-circle").data([1]);
h.enter().append("circle").attr("class","flower-cv-main-circle").attr("cx",0).attr("cy",0);
h.transition().duration(m._options.animationDuration).attr("r",m._circle_size)
};
b._makePetal=function(o,l,h,m){var j=this._circle_size+this._arc_thickness+1,n=(j*2*Math.PI)/this._petal_count/2,i=n/(j*2*Math.PI)*360,k=Math.cos(i*Math.PI/180)*j,g=Math.sin(i*Math.PI/180)*j;
l=-k;
var q=o-g,u=o+g,s=(m-l)*-1*0.6,r=(m-l)*-1,p=r*0.2,t=["M",q,l,"C",q-p,l-s,o,m,h,m,"C",h,m,u+p,l-s,u,l];
return t.join(" ")
};
b._addPetalSizes=function(l){if(!l.color){l.color=this.colorScale(l.label)
}var j=this._getSizeZeroToThree(l.value);
if(!this._is_single_mode){if(j===0){j=1
}}if(l.value===0){j=0
}var i=0.9;
var g=l.color;
var h=g;
var k=this._petal_size;
var m=k*-1;
switch(j){case 0:i=0;
h="#e6e6e6";
k=0;
g=g;
break;
case 3:i=0.9;
break;
case 2:i=0.75;
k=k*0.795;
break;
case 1:i=0.5;
k=k*0.6;
break
}if(!this._is_single_mode){k=this._getPetalSize(l.value)
}if(l.value===0){k=0
}k*=-1;
l.petal_opacity=i;
l.petal_size=k;
l.petal_color=g;
l.full_petal=m;
l.petal_number_size=j;
l.arc_color=h
};
e.cloudViz.flower=f.util.createConstructor(b)
}(this));
(function(l){var r=l.cloudViz||{},q=r.core||{},g=l.dv||{},u=l.d3||{},j=Object.create(q);
var k=0.15,w=0.05,t=0.09,o=1+w,i=0.05,v=0.025,p=2,f=14,c=0.1,z=0.75,s=null,n=null;
j.init=function(A){this._type="gauge";
A=A||{};
this._initDefaultOptions();
this.setOptions(A);
return this
};
j._initDefaultOptions=function(A){var B={duration:750,percentOpen:c,showNeedle:true,showAxis:true,ticks:5,tickSubdivisions:0,format:"decimal",fillColor:"#3284d4",minValue:0,maxValue:10,colors:[{color:"#ff3400",alpha:1,from:"0%",to:"33%"},{color:"#faca00",alpha:1,from:"33%",to:"66%"},{color:"#68b672",alpha:1,from:"66%",to:"100%"}],metric:"",value:0};
this._margins={top:0,left:0,right:0,bottom:0};
return Object.getPrototypeOf(j)._initDefaultOptions.call(this,B)
};
j.render=function(){Object.getPrototypeOf(j).render.call(this,arguments);
this._determineSize();
this._initScales();
this._draw();
return this
};
j._onAutoResize=function(){this.render()
};
j._determineSize=function(C){var G=this._options,E=G.parent,D=G.width?G.width:E.offsetWidth,A=G.height?G.height:E.offsetHeight,B=Math.max(c,Math.min(z,G.percentOpen));
if(G.showNeedle){this._margins.bottom=A*0.05
}this._maxAngle=(1-B)*180;
this._minAngle=(1-B)*-180;
D-=this._margins.left+this._margins.right;
this._size=[D,A];
this._radius=Math.min(D-this._margins.left-this._margins.right,A-this._margins.top-this._margins.bottom)/2
};
j._initScales=function(){var A=this._options;
if(A.minValue>A.maxValue){throw new Error("The minimum value is greater than the maximum value.")
}this._scale=u.scale.linear().domain([A.minValue,A.maxValue]).range([0,1])
};
j._draw=function(){this._initSVG();
this._drawTrack();
this._drawAxis();
this._drawSelectedIndicator();
this._drawLabels()
};
j._initSVG=function(){var D=this._options,B=u.select(D.parent);
s=B.selectAll(".cv-wrapper.cv-gauge").data([0]);
s.enter().append("div").classed("cv-wrapper cv-gauge",true);
s.style("width",this._size[0]+"px").style("height",this._size[1]+"px");
var A=s.selectAll(".chart-wrapper").data([0]);
A.enter().append("div").classed("chart-wrapper",true);
var C=A.selectAll("svg").data([0]);
C.enter().append("svg");
n=C.selectAll("g").data([0]);
n.enter().append("g");
n.attr("transform","translate("+(this._size[0]-this._margins.left-this._margins.right)/2+","+(this._size[1]-this._margins.top-this._margins.bottom)/2+")")
};
j._drawTrack=function(){var A=this,E=this._options;
var C=u.svg.arc().innerRadius(this._radius*(1-w-k)).outerRadius(this._radius*(1-w)).startAngle(function(J,H){var G=g.util.isPercentString(J.from)?parseInt(J.from,10)/100:A._scale(J.from),I=(A._maxAngle-A._minAngle)*G+A._minAngle;
return e(I)
}).endAngle(function(J,H){var G=g.util.isPercentString(J.to)?parseInt(J.to,10)/100:A._scale(J.to),I=(A._maxAngle-A._minAngle)*G+A._minAngle;
return e(I)
});
var B=n.selectAll(".arc").data([0]);
B.enter().append("g").classed("arc",true);
var D=B.selectAll("path").data(E.colors);
D.enter().append("path");
D.exit().remove();
D.attr("fill",function(H,G){return H.color
}).attr("opacity",function(H,G){return H.hasOwnProperty("alpha")?H.alpha:1
}).attr("d",C)
};
j._drawAxis=function(){var J=this,A=this._options,I=this._scale.ticks(A.ticks),B=function(M,L,N,K){return function(O){O.attr("x1",0).attr("y1",p).attr("x2",0).attr("y2",J._radius*K+p).attr("transform",function(Q){var P=d(M,Q,L,N);
return"rotate("+d(M,Q,L,N)+") translate(0,"+(J._radius*(k+w)-J._radius)+")"
})
}
};
var C=n.selectAll(".axis").data(A.showAxis?[0]:[]);
C.enter().append("g").classed("axis",true);
C.exit().remove();
var H=C.selectAll(".tick").data(I);
H.enter().append("line").classed("tick",true);
H.exit().remove();
H.call(B(this._scale,this._minAngle,this._maxAngle,i));
var D=b(this._scale,I,A.tickSubdivisions);
var E=C.selectAll(".minor-tick").data(D);
E.enter().append("line").classed("minor-tick",true);
E.exit().remove();
E.call(B(this._scale,J._minAngle,J._maxAngle,v));
var G=C.selectAll(".tick-label").data(I);
G.enter().append("text").classed("tick-label",true);
G.exit().remove();
G.attr("transform",function(O){var N=d(J._scale,O,J._minAngle,J._maxAngle),L=m(J._scale,O,J._minAngle,J._maxAngle),M=(J._radius-f)*(1-k-w-i),K=Math.cos(L)*M,P=Math.sin(L)*M;
if(N<-10&&N>-170){K-=3
}if(N>10&&N<170){K+=3
}return"translate("+K+","+P+")"
}).attr("text-anchor",function(L){var K=d(J._scale,L,J._minAngle,J._maxAngle);
if(K>-10&&K<10){return"middle"
}if(K<0){return null
}return"end"
}).attr("dy",".35em").style("font-size",h(J._radius*0.05,8,14)+"px").text(function(K){return J._formatNumber(A.format,K)
})
};
j._drawSelectedIndicator=function(){var A=this._options;
this._drawNeedle(A.showNeedle?[A.value]:[]);
this._drawProgressFill(A.showNeedle?[]:[A.value])
};
j._drawNeedle=function(B){var A=this,D=this._options,C=this._radius*t/2,G=this._radius*o;
var E=n.selectAll(".needle").data(B);
E.enter().append("path").classed("needle",true).attr("transform","rotate("+A._minAngle+")");
E.exit().remove();
E.attr("d","M"+(C/2)+"-"+C+"L0-"+G+"L-"+(C/2)+"-"+C+"C-"+(C*0.8257)+"-"+(C*0.8212)+"-"+(C*1.035)+"-"+(C/2*0.9448)+"-"+(C*1.035)+"-1C-"+(C*1.035)+","+(C/2*0.9078)+"-"+(C*0.5796)+","+(C*0.9314)+",0,"+(C*0.9314)+"S"+(C*1.035)+","+(C/2*0.9078)+","+(C*1.035)+"-1C"+(C*1.035)+"-"+(C/2*0.9448)+","+(C*0.8257)+"-"+(C*0.8212)+","+(C/2)+"-"+C+"z").transition().duration(D.duration).ease("cubic-in-out").attrTween("transform",function(M){var J=this,L=Math.min(D.maxValue,Math.max(D.minValue,M)),K=d(A._scale,L,A._minAngle,A._maxAngle),I=this.__previousD__===undefined?A._minAngle:this.__previousD__,H=u.interpolate(I,K);
return function(N){J.__previousD__=H(N);
return"rotate("+J.__previousD__+")"
}
})
};
j._drawProgressFill=function(B){var A=this,E=this._options,D=u.svg.arc().innerRadius(this._radius*(1-w-k)).outerRadius(this._radius*(1-w)).startAngle(e(A._minAngle)).endAngle(function(G){return e(d(A._scale,G,A._minAngle,A._maxAngle))
});
var C=n.selectAll(".progress").data(B);
C.enter().append("path").classed("progress",true);
C.exit().remove();
C.attr("fill",E.fillColor).transition().duration(E.duration).attrTween("d",function(K){var I=this,J=Math.min(E.maxValue,Math.max(E.minValue,K)),G=this.__previousD__===undefined?E.minValue:this.__previousD__,H=u.interpolate(G,J);
return function(L){I.__previousD__=H(L);
return D(I.__previousD__)
}
})
};
j._drawLabels=function(){var R=this,A=this._options,B=A.value===undefined?[]:[A.value],O=A.metric===undefined?[]:[A.metric],M=m(this._scale,A.minValue,this._minAngle,this._maxAngle),H=m(this._scale,A.maxValue,this._minAngle,this._maxAngle),C=(this._radius)*(1-k-w),I=(this._radius-f)*(1-k-w-i),P=Math.cos(M)*I+this._radius,L=Math.cos(H)*I+this._radius,K=Math.sin(M)*C+this._radius;
var N=s.selectAll(".label-container").data([0]);
N.enter().append("div").classed("label-container",true);
N.style("left",this._size[0]/2-this._radius+"px");
var J=N.selectAll(".label-title").data(O);
J.enter().append("span").classed("label-title",true);
J.exit().remove();
J.style("font-size",h(this._radius*0.1,11,18)+"px").classed("multiline-ellipsis",!A.showNeedle).text(String);
var Q=N.selectAll(".label-number").data(B),D=Math.max(K,this._radius*1.1);
Q.enter().append("span").classed("label-number",true).style("line-height",this._radius*k+"px");
Q.exit().remove();
Q.style("left",P+"px").style("width",L-P+"px").style("font-size",this._radius*k+"px").text(function(S){return R._formatNumber(A.format,S)
});
if(A.showNeedle){J.style("top",D+this._radius*0.2+"px").style("left",0).style("width",this._radius*2+"px");
Q.style("top",D+"px")
}else{var G=h(this._radius*0.1,11,20)*2.3,E=this._radius*(1-w);
J.style("top",E+"px").style("left",this._radius*(k+w+i+0.3)+"px").style("width",this._radius*(1-k-w-i-0.3)*2+"px").style("height",G+"px");
Q.style("top",Math.max(E+G,D)+"px")
}};
function m(C,B,A,D){return e(d(C,B,A,D))-e(A)-e(D)-Math.PI/2
}function d(C,B,A,D){return A+(C(B)*(D-A))
}function e(A){return A*Math.PI/180
}function h(C,B,A){return Math.max(B,Math.min(A,C))
}function b(C,H,B){var I=[];
if(B&&H.length>1){var K=a(C.domain()),E=-1,A=H.length,G=(H[1]-H[0])/++B,D,J;
while(++E<A){for(D=B;
--D>0;
){if((J=+H[E]-D*G)>=K[0]){I.push(J)
}}}for(--E,D=0;
++D<B&&(J=+H[E]+D*G)<K[1];
){I.push(J)
}}return I
}function a(B){var C=B[0],A=B[B.length-1];
return C<A?[C,A]:[A,C]
}l.cloudViz.gauge=r.util.createConstructor(j)
}(this));
(function(l){var w=l.cloudViz||{},u=w.core||{},f=l.dv||{},z=l.d3||{},s=Object.create(u);
var k=0,h=0,g=0,r=25,p=0,t=0,c=0,o=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?|\.[0-9]+)\s*\)/,a=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,e=z.scale.linear(),d=z.scale.linear(),n=z.scale.ordinal(),m,q,j=true,v;
s.init=function(B){this._type="treemap";
B=B||{};
this._initDefaultOptions();
this.setOptions(B);
return this
};
s._initDefaultOptions=function(B){var C={colors:["#8cc350","#5a6eaa","#d755a5","#1ebed7","#f0a01e","#9b8ce6","#3cb5a0","#3287d2","#f0557d","#c3d250","#eb782d","#78b4f5","#5faf69","#aa5fa5","#fa5a50","#f5c841"],layout:"squarify",duration:750,tooltipContent:b};
return Object.getPrototypeOf(s)._initDefaultOptions.call(this,C)
};
s.reset=function(){};
s._preRender=function(){this._determineSize(this._options.data);
this._configureScales(this._options.data);
this._configureLayout()
};
s._render=function(){this._initContainer();
this._draw(this._options.data);
j=false;
return this
};
s._postRender=function(){};
s._determineSize=function(D){var C=this._options,B=C.parent;
k=f.util.getPercentValue(C.width,B.offsetWidth);
h=f.util.getPercentValue(C.height,B.offsetHeight)
};
s._configureScales=function(E){var D=this._options;
n.domain(E.map(function(G){return G.name
})).range(D.colors);
var B=E.hasOwnProperty("dx")?[E.x,E.x+E.dx]:[0,k],C=E.hasOwnProperty("dy")?[E.y,E.y+E.dy]:[0,h];
e.domain(B).range([1,k-2]);
d.domain(C).range([1,h-2])
};
s._configureLayout=function(){v=z.layout.treemap().sticky(true).value(function(B){return B.value||0
}).sort(function(C,B){return C.value-B.value
}).mode(this._options.layout).round(false)
};
s._initContainer=function(){var C=this._options;
var B=z.select(C.parent).selectAll(".cv-wrapper.cv-treemap").data([0]);
B.enter().append("div").classed("cv-wrapper cv-treemap",true);
m=B.selectAll(".chart-wrapper").data([0]);
m.enter().append("div").classed("chart-wrapper",true).style("position","relative");
m.style("width",k+"px").style("height",h+"px");
q=m.selectAll(".node-container").data([0]);
q.enter().append("div").classed("node-container",true).style("overflow","hidden");
q.style("width",k+"px").style("height",(h)+"px")
};
s._draw=function(I){var L=this,B=this._options,J={children:this._options.data},C=v.size([k,h+r]).padding([r,p,c,t]).nodes(J),D=C.filter(function(M){return !M.children
}),K=C.filter(function(M){return M.parent&&M.children
}),H;
var E=q.selectAll(".cv-node").data(C);
var G=E.enter().append("div").classed("cv-node",true).on("click",function(R,O){if(R.depth>0){var N=z.select(this),T=[];
if(R.children){T=q.selectAll(".second-level").filter(function(V){return(R.children.indexOf(V)>=0)
});
T[0].push(this);
var P=q.selectAll(".cv-node.selected");
var M=[];
if(P[0].indexOf(this)>=0){M=P[0].filter(function(V){var W=(T[0].indexOf(V)>=0);
return !W
})
}else{M=T[0].concat(P[0])
}T[0]=M;
L._selectNodes(T)
}else{T=q.selectAll(".cv-node.selected");
var Q=T[0].indexOf(this),U;
if(Q>=0){T[0].splice(Q,1);
U=L._getParentNode(this);
var S=T[0].indexOf(U);
if(S>=0){H=0;
U.__data__.children.forEach(function(V){T.each(function(W){if(W==V){H++
}})
});
if(U.__data__.children.length-1===H){T[0].splice(S,1)
}}}else{T[0].push(this);
U=L._getParentNode(this);
H=0;
U.__data__.children.forEach(function(V){T.each(function(W){if(W==V){H++
}})
});
if(U.__data__.children.length===H){T[0].push(U)
}}L._selectNodes(T)
}if(L._eventMap.click){L._eventMap.click.call(this,R,O,z.event)
}}}).on("mouseover",function(R,N){if(!R.children){var O=z.select(this),Q={x:R.x+R.dx/4,y:R.y+R.dy/2-r,width:R.dx/2,height:R.dy/2},M={x:0,y:0,width:m.node().getBoundingClientRect().width,height:m.node().getBoundingClientRect().height},P=null;
O.classed("hovered",true);
P=B.tooltipContent.call(this,R,N);
f.showTooltip(Q,M,P,"top",5,m);
if(L._eventMap.mouseover){L._eventMap.mouseover.call(this,R,N,z.event)
}}}).on("mouseout",function(O,M){if(!O.children){var N=z.select(this);
N.classed("hovered",false);
f.removeTooltip(m);
if(L._eventMap.mouseout){L._eventMap.mouseout.call(this,O,M,z.event)
}}});
G.append("div");
G.call(A).call(i);
E.exit().remove();
E.classed("root-level",function(M){return M.depth===J.depth
}).classed("first-level",function(M){return M.depth===J.depth+1
}).classed("second-level",function(M){return M.depth===J.depth+2
}).call(i).call(A);
E.select("div").text(function(O){var N=O.hasOwnProperty("name")&&O.parent===J?O.name:null;
var M=O.hasOwnProperty("label")&&O.parent===J?O.label:null;
return M||N
}).style("opacity",function(M){return(M.dx<50||M.dy<25)?0:1
})
};
s._selectNodes=function(B){var C=q.selectAll(".cv-node.selected");
C.classed("selected",false);
B.classed("selected",true)
};
s._getParentNode=function(C){var B;
var D=z.select(this._options.parent).selectAll(".first-level");
D[0].forEach(function(E){if(E.__data__.children.indexOf(C.__data__)>=0){B=E
}});
return B
};
s.setSelected=function(D){var B=this;
var C=z.select(this._options.parent).selectAll(".second-level").filter(D);
C[0].forEach(function(H){var G=B._getParentNode(H),E=0;
if(G){G.__data__.children.forEach(function(I){C.each(function(J){if(J==I){E++
}})
});
if(G.__data__.children.length===E){C[0].push(G)
}}});
B._selectNodes(C);
return B
};
s.getSelected=function(){var C=[];
var B=q.selectAll(".second-level.cv-node.selected");
if(B){B[0].forEach(function(D){C.push(D.__data__)
})
}return C
};
function b(B){return"<span class='series-name'>"+B.parent.name+"</span><span class='metric-value'>"+B.value+"</span><span class='metric-name'>"+B.name+"</span>"
}function A(B){var C=function(D){if(D.depth===1){return 3
}if(D.depth===2){return 1
}return 0
};
B.style("left",function(D){return(e(D.x)+1)+"px"
}).style("top",function(D){if(D.children&&!D.parent){return 0
}return(d(D.y)+1)-r+"px"
}).style("width",function(D){return(e(D.x+D.dx)-e(D.x)-2)+"px"
}).style("height",function(D){if(D.children){return null
}return(d(D.y+D.dy)-d(D.y)-2)+"px"
})
}function i(B){B.style("background-color",function(C){if(C.children||!C.parent){return null
}return n(C.parent.name)
})
}l.cloudViz.treemap=w.util.createConstructor(s)
}(this));
(function(d){var e=d.cloudViz,b=d.dv,c=e.util.namespace("cloudViz.dataAdapter.standard");
var a={};
a._isDataValid=null;
a.process=function(g,f){this._options=g;
this.l10n=e.util.deepExtend({},e.localeDefinition(g.locale),g.l10n||{});
if(!("data" in f)&&!("mappings" in f)){return
}if(!this._validateData(g.data,g.mappings)){return
}this._processOptions(g,f)
};
a._processOptions=function(g,f){};
a._determineOvertime=function(f){var h=this.mappings(),g=f[h.x];
if(!g||!g.length){return false
}return b.util.isDate(g[0])
};
a._calculateDateGranularity=function(j){var l=this.mappings(),k=j[l.x];
if(!k||!k.length){return"*"
}var h=Math.min.apply(Math,k),f=Math.max.apply(Math,k),g=(f-h)/1000,i=g/k.length;
return this.getTimeGranularity(i).gran
};
a.getTimeGranularity=function(h,g){var f="second",i=1;
if(!h){return{gran:f,divisor:i}
}if(g){if(h>=(i=60*60*24*365)){f="year"
}else{if(h>=(i=60*60*24*31)){f="month"
}else{if(h>=(i=60*60*24*7)){f="week"
}else{if(h>=(i=60*60*24)){f="day"
}else{if(h>=(i=60*60)){f="hour"
}else{if(h>=(i=60)){f="minute"
}else{f="second";
i=1
}}}}}}}else{if(h<=(i=1)){f="second"
}else{if(h<=(i=60)){f="minute"
}else{if(h<=(i=60*60)){f="hour"
}else{if(h<=(i=60*60*24)){f="day"
}else{if(h<=(i=60*60*24*7)){f="week"
}else{if(h<=(i=60*60*24*31)){f="month"
}else{f="year";
i=60*60*24*365
}}}}}}}return{gran:f,divisor:i}
};
a._getYTitleFromLabels=function(g){var f=b.util.uniq(g);
if(f&&f.length===1){return f[0]
}return null
};
a.data=function(){return this._options.data
};
a.mappings=function(){return this._options.mappings
};
a.formats=function(){return this._options.formats
};
a.xAxisTitle=function(){return this._options.xAxisTitle||null
};
a.yAxisTitle=function(){return this._options.yAxisTitle||null
};
a.dateGranularity=function(){return this._processedOptions.dateGranularity
};
a.isDataValid=function(){return this._validateData(this._options.data,this._options.mappings)
};
a._validateData=function(g,h){if(!g){return false
}for(var f in g){if(g[f].length){return true
}}return false
};
c.baseObj=a;
c.base=e.util.createConstructor(a)
}(this));
(function(c){var d=c.cloudViz,b=d.util.namespace("cloudViz.dataAdapter.standard"),a=Object.create(b.baseObj);
a._processOptions=function(g,f){var e=this._processedOptions=Object.create(g);
var h=this.data(),i=this.mappings();
this._uniqueFillValues=this._processUniqueFillValues(h,i);
this._uniqueFillExtents=this._processUniqueFillExtents(h,i,this._uniqueFillValues);
if(e.isOvertime==null){e.isOvertime=this._determineOvertime(h);
if(e.isOvertime){e.dateGranularity=e.dateGranularity||this._calculateDateGranularity(h)
}}Object.getPrototypeOf(a)._processOptions.call(this,e,f)
};
a.isOvertime=function(){return this._processedOptions.isOvertime
};
a.uniqueFillValues=function(){return this._uniqueFillValues||[]
};
a.uniqueFillExtents=function(){return this._uniqueFillExtents
};
a.getUniqueFillExtent=function(e){var f=this._uniqueFillValues[e];
if(f){return this._uniqueFillExtents[f]
}return null
};
a.getUniqueFillExtentByFill=function(e){return this._uniqueFillExtents[e]
};
a._processUniqueFillValues=function(f,g){var e=f[g.series];
return e?dv.util.uniq(e):[]
};
a._processUniqueFillExtents=function(g,j,e){var i=g[j.series],h=g[j.y],f={};
h.map(function(m,l){var k=i[l];
if(!isFinite(m)||m===null){return
}if(!f[k]){f[k]=[m,m]
}f[k][0]=Math.min(m,f[k][0]);
f[k][1]=Math.max(m,f[k][1])
});
return f
};
b.barObj=a;
b.bar=d.util.createConstructor(a)
}(this));
(function(d){var e=d.cloudViz,c=e.util.namespace("cloudViz.dataAdapter.standard"),a=Object.create(c.baseObj),b=d.d3||{};
a._processOptions=function(g,f){Object.getPrototypeOf(a)._processOptions.apply(this,arguments)
};
a._validateData=function(f,g){if(!f){return false
}return true
};
a.data=function(){return this._options.data
};
a.metric=function(){return this._options.metric
};
a.format=function(){return this._options.format
};
c.choroplethObj=a;
c.choropleth=e.util.createConstructor(a)
}(this));
(function(d){var e=d.cloudViz,c=e.util.namespace("cloudViz.dataAdapter.standard"),a=Object.create(c.barObj),b=3;
a._processOptions=function(g,f){this._processCategories(g);
Object.getPrototypeOf(a)._processOptions.call(this,this._processedOptions,f)
};
a._processCategories=function(l){var n=Object.create(l),C=Object.create(l.data),h=l.mappings,w=h.y,p=h.x,j=h.series,m=h.seriesLabel||j,r=[],A,o=C[w].length,v,B=[],u=[],f={},t;
for(A=0;
A<o;
++A){r[A]={};
for(v in C){t=C[v][A];
if(v===j){if(B.length){if(t!==B[B.length-1]){if(B.length===this.maxFacets){o--;
A--;
r.pop();
break
}B[B.length]=t;
u[u.length]=C[m][A];
f[t]=B.length
}}else{B=[t];
u=[C[m][A]];
f[t]=B.length
}}r[A][v]=t
}}this.numFacets=B.length;
r.sort(function(k,i){if(k[j]===i[j]){return i[w]-k[w]
}return f[k[j]]-f[i[j]]
});
for(v in C){C[v]=[]
}C.cvdonutorder=[];
var s=0,q,g,z=this._options.maxSlices;
this.otherIncluded=false;
for(A=0,o=r.length;
A<o;
++A){g=r[A][j];
if(g!==q){s=0;
q=g
}if(s==z-1&&A+1<o&&r[A+1][j]===g){for(v in C){if(!C[v]){C[v]=[]
}C[v][A]=r[A][v]
}this.otherIncluded=true;
C[p][A]=this.l10n.labels.core.other;
++s;
C.cvdonutorder[A]=A;
continue
}if(s>=z){C[w][A-1]+=r[A][w];
r.splice(A,1);
o=r.length;
--A;
++s;
continue
}++s;
for(v in C){C[v][A]=r[A][v]
}C.cvdonutorder[A]=A
}n.yAxisTitle=l.yAxisTitle||u;
n.data=C;
this._processedOptions=n
};
a.processLabelData=function(h){var u=this.data(),k=this.mappings(),w=this._labelData=Object.create(u),n={},r={},p=this,v=w[k.series],i=w[k.y],j=w[k.x];
v.forEach(function(z,A){if(n[z]===undefined){n[z]=0
}if(r[z]===undefined){r[z]=0
}n[z]+=i[A];
if(!h.isSeriesEnabled||h.isSeriesEnabled(j[A])){r[z]+=i[A]
}});
var m=(w.cvtextvalue=[]),o=(w.cvtextperclabel=[]),q=(w.cvtextvallabel=[]),t={},g,f,s,l;
i.forEach(function(z,A){g=v[A];
f=(parseFloat(z)/n[g])*100;
q[A]=z;
o[A]=((f%1!==0)?f.toFixed(1):f)+"%";
l=!h.isSeriesEnabled||h.isSeriesEnabled(j[A]);
s=(parseFloat(z)/r[g])*100;
if(t[g]===undefined){t[g]=0
}m[A]=(l)?t[g]+(s/2):0;
t[g]+=(l)?s:0
})
};
a.data=function(){return this._processedOptions.data
};
a.labelData=function(){return this._labelData
};
a.yAxisTitle=function(f){var g=this._processedOptions.yAxisTitle;
if(g instanceof Array&&g.length>f){g=g[f]
}return g
};
a.showOtherCategory=function(){return this.otherIncluded
};
a.numberOfFacets=function(){return this.numFacets
};
c.donutObj=a;
c.donut=e.util.createConstructor(a)
}(this));
(function(c){var d=c.cloudViz,b=d.util.namespace("cloudViz.dataAdapter.standard"),a=Object.create(b.baseObj);
a._processOptions=function(g,f){var e=this._processedOptions=Object.create(g);
var h=this.data(),i=this.mappings();
this._forceZero=g._forceZero;
this._uniqueStrokeValues=this._processUniqueStrokeValues(h,i);
this._uniqueStrokeExtents=this._processUniqueStrokeExtents(h,i);
if(e.isOvertime==null){e.isOvertime=this._determineOvertime(h);
if(e.isOvertime){e.dateGranularity=e.dateGranularity||this._calculateDateGranularity(h)
}}Object.getPrototypeOf(a)._processOptions.call(this,e,f)
};
a.isOvertime=function(){return this._processedOptions.isOvertime
};
a.uniqueStrokeValues=function(){return this._uniqueStrokeValues||[]
};
a.uniqueStrokeExtents=function(){return this._uniqueStrokeExtents
};
a.getUniqueStrokeExtent=function(f){var e=this._uniqueStrokeValues[f];
if(e){return this._uniqueStrokeExtents[e]
}return null
};
a.getUniqueStrokeExtentByStroke=function(e){return this._uniqueStrokeExtents[e]
};
a._processUniqueStrokeValues=function(f,g){var e=f[g.series];
return e?dv.util.uniq(e):[]
};
a._processUniqueStrokeExtents=function(g,i){var e=g[i.series],h=g[i.y],f={};
h.map(function(l,k){var j=e[k];
if(!isFinite(l)||l===null){return
}if(!f[j]){f[j]=[l,l]
}f[j][0]=Math.min(l,f[j][0]);
f[j][1]=Math.max(l,f[j][1])
});
return f
};
b.lineObj=a;
b.line=d.util.createConstructor(a)
}(this));
(function(c){var d=c.cloudViz,b=d.util.namespace("cloudViz.dataAdapter.standard"),a=Object.create(b.baseObj);
a.sizeMetricName=function(){return this._options&&this._options.sizeTitle||null
};
a.isBubble=function(){var e=this.mappings()["size"];
return e&&e.length
};
b.pointObj=a;
b.point=d.util.createConstructor(a)
}(this));
(function(c){var d=c.cloudViz,b=d.util.namespace("cloudViz.dataAdapter.standard"),a=Object.create(b.baseObj);
a._processOptions=function(n,i){var g=this._processedOptions=Object.create(n),j=JSON.parse(JSON.stringify(n.data));
j.nodesById=[];
j.nodes.map(function(p,o){p._pid=o;
j.nodesById[o]=p;
return p
});
j.links=[];
j.linksById=[];
var e,k,h,f,l,m=this;
j.paths=j.paths.filter(function(o){if(!(o.values instanceof Array)){o.values=Array.apply(null,new Array(o.nodes.length-1)).map(function(){return o.values
})
}if(o.values.some(function(p){return p<=0
})){return false
}o.nodes.map(function(p){return(p!==null)?j.nodes[p]._pid:null
});
return true
});
j.paths.forEach(function(q,o){q.nodes.forEach(function(r,p){if(!p){e=q.nodes[p];
if(e!==null){j.nodesById[e].isPathStart=true;
if(j.nodesById[e].isPathEnd){j.nodesById[e].isPivot=true
}}return
}e=q.nodes[p-1];
k=r;
if(p===q.nodes.length-1){if(k!==null){j.nodesById[k].isPathEnd=true;
if(j.nodesById[k].isPathStart){j.nodesById[k].isPivot=true
}}}h=q.values[p-1];
f=m._generateLinkId(e,k);
if(l=j.linksById[f]){l.value+=h;
l.paths.push(o)
}else{l={source:e,target:k,value:h,paths:[o]};
j.linksById[f]=l;
j.links.push(l)
}})
});
g.data=j;
Object.getPrototypeOf(a)._processOptions.apply(this,arguments)
};
a.data=function(){return this._processedOptions.data
};
a.nodeKey=function(){return function(f,e){return e
}
};
a.linkKey=function(){return function(f,e){return e
}
};
a.pathingTitle=function(){return""
};
a.getPathEnd=function(e){return null
};
a.getPathDirection=function(e){return 0
};
a.activePathsTitle=function(e){return(e&&e.length)?this.l10n.labels.pathing["path2+"]:""
};
a.isValidPathingData=function(){var e=this.data();
if(!e){return false
}if(!e.nodes||!e.paths){return false
}if(!e.nodes.length){return false
}return true
};
a._generateLinkId=function(f,e){return f+"-"+e
};
a._sortPaths=function(g,e){var h=this.data();
return function f(l,j){function i(p,o,s){var v=p+s,q=o+s;
var u=(v<l.nodes.length&&v>=0)?l.nodes[v]:-1,t=(q<j.nodes.length&&q>=0)?j.nodes[q]:-1;
if(u!==-1&&u!==null){u=h.nodes.indexOf(h.nodesById[u])
}if(t!==-1&&t!==null){t=h.nodes.indexOf(h.nodesById[t])
}if(null===u&&null===t){return 0
}if(null===u){return(s>0)?1:-1
}if(null===t){return(s>0)?-1:1
}if(-1===u&&-1===t){return 0
}if(-1===u){return 1
}if(-1===t){return -1
}var r=u-t;
if(r!==0){return r
}return i(v,q,s)
}var m=l.nodes.indexOf(g._pid),k=j.nodes.indexOf(g._pid),n=i(m,k,e);
if(0===n){n=i(m,k,-e)
}if(0!==n){return n
}return j.nodes.length-l.nodes.length
}
};
a._generatePathLinks=function(r,j,m){var h=this.data(),n=this,e,l,i,k,f,q,g,p,o=[];
if(!r||!r.nodes){return o
}r.nodes.forEach(function(u,t,s){if(!t){return
}e=r.nodes[t-1];
l=u;
i=h.nodesById[e]||null;
k=h.nodesById[l]||null;
f=r.values[t-1];
q=null;
if(t>1){q=h.linksById[n._generateLinkId(r.nodes[t-2],e)]
}g=h.linksById[n._generateLinkId(e,l)];
p=(f/g.value)*g.dy;
if(i){o.push({dy:p,sy:(q)?q.ty+q.offset-p:g.sy+g.offset,ty:(!k)?i.dy-p:g.sy+g.offset,source:{x:i.x,y:i.y,dx:0},target:{x:i.x+i.dx,y:i.y},value:f,path:j,pivotStart:i.isPivot})
}o.push({dy:p,sy:g.sy+g.offset,ty:g.ty+g.offset,source:i,target:k,value:f,path:j});
if(t+1===s.length&&k){o.push({dy:p,sy:g.ty+g.offset,ty:g.ty+g.offset,source:{x:k.x,y:k.y,dx:0},target:{x:k.x+k.dx,y:k.y},value:f,path:j,pivotEnd:k.isPivot})
}g.offset+=p
});
return o
};
a.nodePaths=function(e){var f=this.data(),g=f.paths.filter(function(h){return h.nodes.indexOf(e._pid)!==-1
});
return g
};
a.nodePathData=function(j,h){var i=this.data(),g=this,e=[],f=i.links;
f.forEach(function(k){k.offset=0
});
j.sort(g._sortPaths(h,-1));
j.forEach(function(l,k){e=e.concat(g._generatePathLinks(l,k,h))
});
return e
};
a.linkSortActivePaths=function(f){var g=this.data(),i=g.paths,h,e=(f.source)?f.source:f.target;
g.links.forEach(function(j){j.offset=0
});
h=f.paths.map(function(j){return i[j]
});
h.sort(this._sortPaths(e,-1));
return h
};
a.linkPathData=function(g){var e=[],f=this;
g.forEach(function(j,h){e=e.concat(f._generatePathLinks(j,h))
});
return e
};
a.canExpandNode=function(e){return true
};
a.canCollapseNode=function(e){return true
};
a.canPivotNode=function(e){return true
};
b.pathingObj=a;
b.pathing=d.util.createConstructor(a)
}(this));
(function(d){var e=d.cloudViz,c=e.util.namespace("cloudViz.dataAdapter.standard"),a=Object.create(c.baseObj),b=d.d3||{};
a._processOptions=function(r,i,m){var f=m||this._processedOptions||{},h=this._processedOptions=Object.create(r);
var l=JSON.parse(JSON.stringify(h.data)),q=l.metrics[0]||{name:"",format:"int"};
function g(s){if(s.metrics&&s.metrics.length&&s.metrics[0]&&"undefined"!==typeof s.metrics[0].value){return s.metrics[0].value
}if(!s.children||!s.children.length){return 0
}return s.children.reduce(function(u,t){return u+g(t)
},0)
}function o(t,s){return g(s)-g(t)
}var j=this.l10n.labels.core.other;
function p(u,w){u.size=("undefined"===typeof u.size)?g(u):u.size;
if(!u.children||!u.children.length){return
}if(w<l.categories.length){var v=l.categories[w],s=u.children.length;
v.top=("undefined"!==typeof v.top)?Math.max(v.top,s):s
}if("undefined"!==typeof u.size&&q.format!=="percent"){var t=u.children.reduce(function(A,z){return A+g(z)
},0);
if(u.size>t){u.children.push({id:"cv-sb-other",name:j,size:u.size-t})
}}u.children.sort(o);
u.children.forEach(function(z){p(z,w+1)
})
}p(l,0);
var n=[];
function k(u,A,z){var s=n[A]||(n[A]=[]),t,v=u.length,w;
for(t=0;
t<v;
++t){w=u[t];
w._sid=z+"s"+t;
if(j===w.name){continue
}if(w.name){s[s.length]=w.name
}if(w.children&&w.children.length){k(w.children,A+1,w._sid)
}}}k([l],0,"");
l.name=q.name;
n.push([q.name]);
l.categories.forEach(function(t,s){t.index=s
});
h.uniques=n.reduce(function(t,s){var u=s.reduce(function(v,w){return(v.indexOf(w)<0)?v.push(w)&&v:v
},[]);
return t.concat(u)
},[]);
h.data=l;
h.categories=l.categories;
h.colorMetricIndex=f.colorMetricIndex;
h.stackedMetricIndex=f.stackedMetricIndex;
h.secondaryMetricIndex=f.secondaryMetricIndex;
h.secondaryMetricType=f.secondaryMetricType;
h.seqColors=h.seqColors;
Object.getPrototypeOf(a)._processOptions.apply(this,arguments)
};
a.data=function(){return this._processedOptions.data
};
a.categories=function(){return this._processedOptions.categories
};
a.uniques=function(){return this._processedOptions.uniques
};
a.colors=function(){return this._processedOptions.colors
};
a.seqColors=function(){return this._processedOptions.seqColors
};
a.metricColor=function(f){return this._processedOptions.metricColor
};
a.otherColor=function(f){return this._processedOptions.otherColor
};
a.otherGrayColor=function(f){return this._processedOptions.otherGrayColor
};
a.outRangeColor=function(f){return this._processedOptions.outRangeColor
};
a.isOther=function(f){return f.name===this.l10n.labels.core.other
};
a.isRoot=function(f){return !f.parent
};
a.isDataEmpty=function(){var f=this.data();
return !(f&&f.children&&f.children.length)
};
a.isSizeEmpty=function(){return !this.data().size
};
a._validateData=function(f){if(!f||!f.children||!f.children.length){return false
}return true
};
a.getPathKey=function(g,f){return g&&g._sid||f
};
a.getDataByPathKey=function(){var j=this.data(),f=this,i={},h;
function g(k){if(!k){return
}h=f.getPathKey(k,null);
if(h){i[h]=k
}if(k.children){k.children.forEach(g)
}}g(j);
return i
};
a.getColorMetric=function(){var f=this._processedOptions.colorMetricIndex;
return(f)?this.data().metrics[f]:null
};
a.getColorMetricIndex=function(){return this._processedOptions.colorMetricIndex
};
a.setColorMetricIndex=function(f){if(this._processedOptions.colorMetricIndex===f){f=null
}this._processedOptions.secondaryMetricIndex=f;
this.setSecondaryMetricType("color")
};
a.getStackedMetric=function(){var f=this._processedOptions.stackedMetricIndex;
return(f)?this.data().metrics[f]:null
};
a.getStackedMetricIndex=function(){return this._processedOptions.stackedMetricIndex
};
a.setStackedMetricIndex=function(f){if(this._processedOptions.stackedMetricIndex===f){f=null
}this._processedOptions.secondaryMetricIndex=f;
this.setSecondaryMetricType("height")
};
a.getSecondaryMetricType=function(){return this._processedOptions.secondaryMetricType
};
a.setSecondaryMetricType=function(i){var f=this.getSecondaryMetricIndex()||1,h=this._processedOptions,g=this;
h.secondaryMetricIndex=f;
h.secondaryMetricType=i;
switch(i){case"color":h.colorMetricIndex=f;
h.stackedMetricIndex=null;
break;
case"height":h.colorMetricIndex=null;
h.stackedMetricIndex=f;
break;
case"both":h.colorMetricIndex=f;
h.stackedMetricIndex=f;
break;
default:h.colorMetricIndex=null;
h.stackedMetricIndex=null;
h.secondaryMetricIndex=null;
h.secondaryMetricType=null
}};
a.getSecondaryMetric=function(){var f=this._processedOptions.secondaryMetricIndex;
return(f)?this.data().metrics[f]:null
};
a.getSecondaryMetricIndex=function(){return this._processedOptions.secondaryMetricIndex
};
a.setSecondaryMetricIndex=function(f){if(this._processedOptions.secondaryMetricIndex===f){f=null
}this._processedOptions.secondaryMetricIndex=f;
this.setSecondaryMetricType(f?this.getSecondaryMetricType()||"height":null)
};
c.sunburstObj=a;
c.sunburst=e.util.createConstructor(a)
}(this));
(function(d){var e=d.cloudViz,c=e.util.namespace("cloudViz.dataAdapter.standard"),a=Object.create(c.baseObj),b=d.d3||{};
a._processOptions=function(h,g){var f=this._processedOptions=Object.create(h);
var i=h.data;
if(h.isEmotionChart){i=this._getEmotionData(h.data)
}f.data=i;
Object.getPrototypeOf(a)._processOptions.call(this,f,g)
};
a._getEmotionData=function(h){var g=this.l10n.labels.flower;
var f=[{index:"joy",label:g.joy,color:"#e6b43c"},{index:"admiration",label:g.admiration,color:"#7daf4b"},{index:"fear",label:g.fear,color:"#50965a"},{index:"surprise",label:g.surprise,color:"#00a0be"},{index:"sadness",label:g.sadness,color:"#286eaf"},{index:"disgust",label:g.disgust,color:"#964196"},{index:"anger",label:g.anger,color:"#f04641"},{index:"anticipation",label:g.anticipation,color:"#dc5f00"}];
var i={};
dv.util.each(h,function(j){i[j.index]=j
});
dv.util.each(f,function(j){if(!i[j.index]){j.value=0
}else{j.value=i[j.index].value||0
}});
return f
};
a._validateData=function(f,g){if(!f){return false
}return true
};
a.data=function(){return this._processedOptions.data
};
c.flowerObj=a;
c.flower=e.util.createConstructor(a)
}(this));
(function(c){var d=c.cloudViz,b=d.util.namespace("cloudViz.dataAdapter.rs"),a=Object.create(d.dataAdapter.standard.baseObj);
a._getYFormats=function(g,j,n){var l=[];
if(!g||!g.metric||!j||!j.series||!n){return l
}var k=g.metric.length;
for(var h=0;
h<k;
h++){var f=g.metric[h],m=g[j.series],e=n.indexOf(m[h]);
l[e]=f.type
}return l
};
a.mappings=function(){return this._processedOptions.mappings
};
a.formats=function(){return this._processedOptions.formats
};
b.baseObj=a;
b.base=d.util.createConstructor(a)
}(this));
(function(c){var e=c.cloudViz,b=e.util.namespace("cloudViz.dataAdapter.rs"),a=Object.create(e.dataAdapter.standard.barObj);
a._processOptions=function(h,g){var f=this._processedOptions=Object.create(h);
f.isOvertime=this._determineOvertime(f.data);
f.yAxisTitle=h.yAxisTitle||this._getYAxisTitle(f.data);
f.dateGranularity=this._getTimeGranularity(f.data);
this._processData(f);
this._updateMappings(f);
Object.getPrototypeOf(a)._processOptions.call(this,f,g);
f.formats={x:h.formats.x,y:this._getYFormats(f.data,f.mappings,this.uniqueFillValues())}
};
a.isOvertime=function(){return this._processedOptions.isOvertime
};
a.xAxisTitle=function(){return null
};
a.yAxisTitle=function(){return this._processedOptions.yAxisTitle
};
a.dateGranularity=function(){return this._processedOptions.dateGranularity
};
a.data=function(){return this._processedOptions.data
};
a.mappings=function(){return this._processedOptions.mappings
};
a.formats=function(){return this._processedOptions.formats
};
a._determineOvertime=function(g){var f=g.date,h=g.metric&&g.metric.some(function(i){return i&&i.date_ref&&i.date_ref.length>1
});
return f&&f.length&&h
};
a._getYAxisTitle=function(f){return this._getYTitleFromLabels(f.label)
};
a._processData=function(g){if(g.isOvertime){return
}var l=Object.create(g.data),h,j=l.cell.length,f=null,k=null;
l.group=[];
for(h=0;
h<j;
++h){k=f;
f=l.cell[h];
l.group[h]=l.series[h];
if(k&&"incomplete"===f.status&&"incomplete"!==k.status){l.group[h]+="::incomplete::"
}}g.data=l
};
a._updateMappings=function(f){var g=Object.create(f.mappings);
if(f.isOvertime){g.x="date";
g.y="value";
g.group="group";
g.series="series";
g.seriesLabel="series_name"
}else{g.x="category";
g.y="value";
g.series="metric_series";
g.seriesLabel="metric_series_name"
}f.mappings=g
};
a._getTimeGranularity=function(f){return f.metric[0]["date_range"].gran
};
var d=b.baseObj;
a._getYFormats=d._getYFormats;
b.bar=e.util.createConstructor(a)
}(this));
(function(d){var e=d.cloudViz,b=e.util.namespace("cloudViz.dataAdapter.rs"),a=Object.create(e.dataAdapter.standard.choroplethObj),c=d.d3||{};
a._processOptions=function(h,g){var f=this._processedOptions=Object.create(h);
this._processData(f,h);
Object.getPrototypeOf(a)._processOptions.call(this,f,g)
};
a._processData=function(k,g){var z=g.data,A=z.data,s=z.metrics,l=z.filters,i=z.dates,j,h,q,o,n={values:{}};
for(var r=0,t=s.length;
r<t;
++r){q=s[r];
j=q.filter_ref;
h=q.date_ref;
for(var u=0,p=j.length;
u<p;
++u){o=l[j[u]];
for(var v=0,w=h.length;
v<w;
++v){n.values[(o.info||{}).geo_id]=A[j[u]][h[v]][r].val
}}}k.data=n;
k.metric=q.name;
k.format=q.type
};
a.data=function(){return this._processedOptions.data
};
a.metric=function(){return this._processedOptions.metric
};
a.format=function(){return this._processedOptions.format
};
a._validateData=function(f,g){if(!f){return false
}return true
};
a.data=function(){return this._processedOptions.data
};
b.choropleth=e.util.createConstructor(a)
}(this));
(function(c){var e=c.cloudViz,b=e.util.namespace("cloudViz.dataAdapter.rs"),a=Object.create(e.dataAdapter.standard.donutObj);
a._processOptions=function(h,g){var f=this._processedOptions=Object.create(h);
this._updateMappings(f);
Object.getPrototypeOf(a)._processOptions.call(this,f,g);
f.formats={x:h.formats.x,y:this._getYFormats(f.data,f.mappings,this.uniqueFillValues())}
};
a.mappings=function(){return this._processedOptions.mappings
};
a.formats=function(){return this._processedOptions.formats
};
a._updateMappings=function(f){var g=Object.create(f.mappings);
g.x="category";
g.y="value";
g.series="metric_series";
g.seriesLabel="metric_series_name";
f.mappings=g
};
var d=b.baseObj;
a._getYFormats=d._getYFormats;
b.donut=e.util.createConstructor(a)
}(this));
(function(c){var e=c.cloudViz,b=e.util.namespace("cloudViz.dataAdapter.rs"),a=Object.create(e.dataAdapter.standard.lineObj);
a._processOptions=function(h,g){var f=this._processedOptions=Object.create(h);
f.isOvertime=this._determineOvertime(f.data);
f.yAxisTitle=h.yAxisTitle||this._getYAxisTitle(f.data);
f.dateGranularity=this._getTimeGranularity(f.data);
this._updateMappings(f);
this._processMultiMetric(f);
this._processIncompleteData(f);
Object.getPrototypeOf(a)._processOptions.call(this,f,g);
f.formats={x:h.formats.x,y:f.isOvertime?this._getYFormats(f.data,f.mappings,this.uniqueStrokeValues()):h.formats.y}
};
a.data=function(){return this._processedOptions.data
};
a.mappings=function(){return this._processedOptions.mappings
};
a.formats=function(){return this._processedOptions.formats
};
a.xAxisTitle=function(){return this._processedOptions.xAxisTitle
};
a.yAxisTitle=function(){return this._processedOptions.yAxisTitle
};
a.isOvertime=function(){return this._processedOptions.isOvertime
};
a.dateGranularity=function(){return this._processedOptions.dateGranularity
};
a._determineOvertime=function(f){return +f.date[0]!==+f.date[f.date.length-1]
};
a._getYAxisTitle=function(f){return this._getYTitleFromLabels(f.label)
};
a._getTimeGranularity=function(f){return this.isOvertime()?f.metric[0].date_range.gran:"*"
};
a._processMultiMetric=function(j){if(j.isOvertime){return
}var n=j.data,h={series:[]},s=[],t=[],o,v,l;
for(o=0,v=n.label.length;
o<v;
++o){l=n.label[o];
if(!h[l]){s.push(l);
if(n.metric&&n.metric.length){t.push(n.metric[o].type)
}else{t.push(null)
}h[l]=[]
}h[l].push(n.value[o]);
h.series[h[l].length-1]=n.category[o]
}var k={x:s[0],y:s[1]};
var q={x:t[0],y:{0:t[1]}};
if(n.groups&&n.groups.length&&n.groups[0].length){var p,r=n.groups.length,w,u=[];
for(p=0;
p<r;
++p){w=n.groups[p];
u[p]=w.join("-")
}h.facet_group=u;
k.series="facet_group"
}if(s.length>2){k.size=s[2];
q.size=t[2];
j.sizeMetricName=j.sizeTitle||s[2]
}j.data=h;
j.mappings=k;
j.formats=q;
j.xAxisTitle=j.xAxisTitle||s[0];
j.yAxisTitle=j.yAxisTitle||s[1]
};
a._updateMappings=function(f){var g=Object.create(f.mappings);
g.x="date";
g.y="value";
g.group="series";
g.series="series";
g.seriesLabel="series_name";
f.mappings=g
};
a._processIncompleteData=function(f){if(!f.isOvertime||!f.data.cell){return
}if(f.position==="stack"||f.position==="fill"){return
}var l=f.data,n=f.mappings,m,p=l.cell.length,o=null,g=null,h,j=false;
l.cv_rs_group=l.cv_rs_group||[];
for(m=0;
m<p;
++m){g=o;
o=l.cell[m];
l.cv_rs_group[m]=l.cv_rs_group[m]||l.series[m];
if(l.cv_rs_group[m].indexOf("::incomplete::")>=0){continue
}if(g&&"incomplete"===o.status&&"incomplete"!==g.status){for(h in l){l[h].splice(m,0,l[h][m-1])
}l.cv_rs_group[m]+="::incomplete::";
++p;
++m
}l.cv_rs_group[m]+="incomplete"===o.status?"::incomplete::":""
}n.group="cv_rs_group"
};
var d=b.baseObj;
a._getYFormats=d._getYFormats;
b.line=e.util.createConstructor(a)
}(this));
(function(c){var d=c.cloudViz,b=d.util.namespace("cloudViz.dataAdapter.rs"),a=Object.create(d.dataAdapter.standard.pointObj);
a._processOptions=function(z,k){var h=this._processedOptions=Object.create(z);
var n=z.data,e={series:[]},s=[],t=[],o,v,l;
for(o=0,v=n.label.length;
o<v;
++o){l=n.label[o];
if(!e[l]){s.push(l);
if(n.metric&&n.metric.length){t.push(n.metric[o].type)
}else{t.push(null)
}e[l]=[]
}e[l].push(n.value[o]);
e.series[e[l].length-1]=n.category[o]
}var j={x:s[0],y:s[1]};
var q={x:t[0],y:t[1]};
if(n.groups&&n.groups.length&&n.groups[0].length){var p,r=n.groups.length,w,u=[];
for(p=0;
p<r;
++p){w=n.groups[p];
u[p]=w.join("-")
}e.group=u;
j.series="group"
}else{j.series="series"
}if(s.length>2){j.size=s[2];
q.size=t[2];
h.sizeMetricName=z.sizeTitle||s[2]
}h.data=e;
h.mappings=j;
h.formats=q;
h.xAxisTitle=z.xAxisTitle||s[0];
h.yAxisTitle=z.yAxisTitle||s[1];
Object.getPrototypeOf(a)._processOptions.apply(this,arguments)
};
a.data=function(){return this._processedOptions.data
};
a.mappings=function(){return this._processedOptions.mappings
};
a.formats=function(){return this._processedOptions.formats
};
a.xAxisTitle=function(){return this._processedOptions.xAxisTitle
};
a.yAxisTitle=function(){return this._processedOptions.yAxisTitle
};
a.sizeMetricName=function(){return this._processedOptions.sizeMetricName
};
b.point=d.util.createConstructor(a)
}(this));
(function(c){var d=c.cloudViz,b=d.util.namespace("cloudViz.dataAdapter.rs"),a=Object.create(d.dataAdapter.standard.pathingObj),e=4;
a._processOptions=function(G,h){var E=Object.create(G),t=E.data,w={},v=(w.nodes=[]),o=(w.paths=[]),P={},W=this.l10n.labels.pathing;
function B(i){return"E"===i
}function z(i){return"X"===i
}var O,ac,L,S,A,I,g,K,Y,D,l,ae=0;
for(ac in t.filters){O=t.filters[ac];
L=this._getFilterId(O);
if(L){S=O.info&&O.info.name||"";
A=this._getFilterChild(O);
I=A&&A.op||null;
if(I&&I!=="previous"&&I!=="next"){A=I=null
}g=(A&&A.val)?[].concat(A.val):[];
D=0;
if("previous"===I){if(g.some(B)){var p="E_0";
if(!P[p]){K={label:W.entry,id:p,column:D,index:v.length,filters:[]};
v[v.length]=K;
P[p]=K
}}D=g.length
}if("next"===I){if(g.some(z)){var k="X_0";
if(!P[k]){K={label:W.exit,id:k,column:D,index:v.length,filters:[]};
v[v.length]=K;
P[k]=K
}}D=0-g.length
}Y=L+"_"+D;
if(P[Y]){P[Y].filters.push(O);
continue
}l=("0"===String(L)&&(W.exit===String(S)||W.entry===String(S)));
if(l){continue
}else{if("0"===String(L)){continue
}}K={label:S,id:Y,column:D,index:v.length,filters:[O]};
v[v.length]=K;
ae=Math.min(ae,D);
P[Y]=K
}}if(0!==ae){for(var V in v){K=v[V];
K.column-=ae
}}var R,C,H,ag,X,r,ad,N,af,u,ab,J,Q;
for(X=0,r=t.metrics.length;
X<r;
++X){R=t.metrics[X];
C=R.filter_ref;
H=R.date_ref;
for(ad=0,N=C.length;
ad<N;
++ad){ac=C[ad];
O=t.filters[ac];
for(af=0,u=H.length;
af<u;
++af){ag=H[af];
ab=t.dates[ag];
J=t.data[ac][ag][X];
if("invalid"===J.status){continue
}if(K=this._getSingleNode(O,P)){K.total=+J.val;
continue
}Q=this._createPath(O,P);
if(!Q||!Q.length){continue
}o[o.length]={nodes:Q,values:+J.val||0}
}}}o.sort(function(i,f){return f.nodes.length-i.nodes.length
});
var aa,M,Z,s,U,q;
for(aa=0,M=o.length;
aa<M;
++aa){U=o[aa];
for(Z=0,s=o.length;
Z<s;
++Z){if(aa===Z){continue
}q=o[Z];
if(q.nodes.length===U.nodes.length){continue
}if(-1!==this._getPathString(U.nodes).indexOf(this._getPathString(q.nodes))){q.values-=U.values
}}}w.paths=o=o.filter(function(f){return f.values
});
E.data=w;
var T=G.data.metrics;
E.pathingTitle=T&&T.length&&T[0].name;
Object.getPrototypeOf(a)._processOptions.call(this,E,h)
};
a.nodeKey=function(){return function(g,f){return g.id
}
};
a.linkKey=function(){return function(g,f){return((g.source)?g.source.id:"null")+"-"+((g.target)?g.target.id:"null")
}
};
a.pathingTitle=function(){return this._processedOptions.pathingTitle
};
a.getPathEnd=function(k){if(!k||!k.nodes||!k.nodes.length){return null
}if(k.nodes.length===1){return k.nodes[0]
}var g=k.nodes,j=this._processedOptions.data,h=j.nodesById,l=h[g[0]],f=h[g[g.length-1]];
function i(m){return m&&(m.isPivot||m.id==="E_0"||m.id==="X_0")
}if(i(l)){return l
}if(i(f)){return f
}return null
};
a.getPathDirection=function(g){var f=this.getPathEnd(g);
if(!f){return 0
}return f._pid===g.nodes[0]?1:-1
};
a.activePathsTitle=function(i){if(!i||!i.length){return""
}var f=this.getPathEnd(i[0]),g=this.l10n.labels.pathing;
if(!f){return g["path2+"]
}var h=this.getPathDirection(i[0])===1?g.pathFromNode:g.pathToNode;
return h.replace(/\{path\}/i,((i.length>1)?g["path2+"]:g.path)).replace(/\{label\}/i,f.label)
};
a._getSingleNode=function(g,f){var l=this._getFilterId(g),h=g.filter_def&&g.filter_def.length&&g.filter_def[0]||null,k=h&&h.op||null,j=this._getFilterChild(g),i=j&&j.op||null;
if(("select"!==k&&"equals"!==k&&"id"!==k)||"previous"===i||"next"===i){return false
}return f[l+"_0"]
};
a._getPathString=function(f){return f.map(function(g){return(null===g)?"null":g
}).toString()
};
a._createPath=function(l,p){var h=this._getFilterId(l),i=this._getFilterChild(l),k=i&&i.op||null;
if(k&&k!=="previous"&&k!=="next"){return[]
}var n=(i&&i.val)?[].concat(i.val):[];
if(!n.length){return n
}var j=("previous"===i.op),o=("0"===h),m=(j)?0:(o)?0-n.length+1:0-n.length,g=[];
if(j){n.push(h)
}else{n.unshift(h)
}return this._mapNodeIds(m,n,p)
};
a._mapNodeIds=function(l,i,h){if(!isFinite(l)||!h){return[]
}l=+l;
var g=false,j=false,k,f=i&&i.map&&i.map(function(m){if("0"===m){return null
}k=m+"_"+l;
if(!h[k]){j=true;
return null
}++l;
g=true;
return +h[k].index
});
return(g&&!j)?f:[]
};
a._getFilterId=function(f){return(f.info&&(f.info.id||f.info.id===0))?f.info.id+"":null
};
a._getFilterChild=function(f){var g=f.filter_def&&f.filter_def.length&&f.filter_def[0]||null;
return g&&g.child&&g.child.length&&g.child[0]||null
};
a.canExpandNode=function(g){var i=g.entryLinks.length+g.targetLinks.length,h=g.exitLinks.length+g.sourceLinks.length,f=Math.abs(parseInt(g.id.split("_")[1],10));
if(f>=e){return false
}if(h&&g.id==="E_0"){return false
}if(i&&g.id==="X_0"){return false
}if(!i||!h){return true
}return false
};
a.canCollapseNode=function(g){var i=g.entryLinks.length+g.targetLinks.length,h=g.exitLinks.length+g.sourceLinks.length,f=parseInt(g.id.split("_")[1],10);
if(g.id==="E_0"||g.id==="X_0"){return false
}return(0===f&&(h||i))||(f>0&&h)||(f<0&&i)
};
a.canPivotNode=function(i){var l=i.entryLinks.length+i.targetLinks.length,k=i.exitLinks.length+i.sourceLinks.length,h=Math.abs(parseInt(i.id.split("_")[1],10));
if(h!==0){return true
}var j=this.data(),g=j.nodes.map(function(m){return parseInt(m.id.split("_")[1],10)
}),f=0;
if(g.some(function(m){if(m===0){f++
}return(f>1)?true:false
})){return true
}return false
};
b.pathingObj=a;
b.pathing=d.util.createConstructor(a)
}(this));
(function(c){var d=c.cloudViz,b=d.util.namespace("cloudViz.dataAdapter.rs"),a=Object.create(d.dataAdapter.standard.sunburstObj);
a._processOptions=function(k,E){var I=this._processedOptions,r=this._processedOptions=Object.create(k);
function o(f){var N=(f&&f.op==="id")?[f.val]:[];
if(f&&f.child&&f.child[0]){return o(f.child[0]).concat(N)
}return N
}function B(f){if(f&&f.child&&f.child[0]){return B(f.child[0])+1
}return 0
}function m(f){var N=f&&f.filter_def&&f.filter_def[0]||null;
return B(N)
}function L(N,f){var P=m(N.filter),O=m(f.filter);
if(P===O){return f.cell[0].val-N.cell[0].val
}return P-O
}var K=k.data,C,i,h,u,D,z,G,J,l,p,H,g,A,s,w,M={children:[],categories:[],metrics:K.metrics.map(function(f,N){return{id:f.id,icon:f.icon,name:f.name||f.id,format:f.type,categories:[]}
})};
if(C=K.metrics[0]){p=[];
i=C.filter_ref;
h=C.date_ref;
for(D=0,z=i.length;
D<z;
++D){w=i[D];
s=K.filters[w];
for(G=0,J=h.length;
G<J;
++G){u=h[G];
H=K.dates[u];
g=K.data[w][u];
if(!g[0]||"invalid"===g[0].status){continue
}if(s.info&&s.info.id===0){continue
}p.push({filter:s,cell:g})
}}p.sort(L);
var t={},j,n,v,q,e;
p.forEach(function(f){s=f.filter;
g=f.cell;
v=s&&s.filter_def&&s.filter_def[0]||null;
q=o(v),e=q.length,j=q.join("-");
if(!j.length&&!s.info){g.forEach(function(O,N){M.metrics[N].value=+O.val
});
return
}f={id:s.info.id,pid:j?j+"-"+s.info.id:s.info.id,name:s.info.name,metrics:g.map(function(N){return{value:+N.val}
}),category:s.info.category||(v&&v["var"])||undefined,filtervar:v&&v["var"]||undefined,children:[]};
if(s.info.orig_name){f.orig_name=s.info.orig_name
}g.forEach(function(Q,O){var N=M.metrics[O];
N.min=("undefined"!==typeof N.min)?Math.min(N.min,+Q.val):+Q.val;
N.max=("undefined"!==typeof N.max)?Math.max(N.max,+Q.val):+Q.val;
var P;
if(!(P=N.categories[e])){N.categories[e]={min:+Q.val,max:+Q.val}
}else{P.min=Math.min(P.min,+Q.val);
P.max=Math.max(P.max,+Q.val)
}});
if(j&&(n=t[j])){n.children.push(f)
}else{if(!q.length){M.children.push(f)
}else{return
}}t[f.pid]=f;
M.categories[e]={name:s.info.category||(v&&v["var"])||M.categories[e]}
})
}r.data=M;
Object.getPrototypeOf(a)._processOptions.call(this,r,E,I)
};
a._validateData=function(f){if(!f){return false
}for(var e in f){if(f[e].length){return true
}}return false
};
a.getPathKey=function(f,e){if(!f||!f._sid){return 0
}if(!f.pid){return f._sid
}return f.pid
};
b.sunburst=d.util.createConstructor(a)
}(this));
(function(c){var d=c.cloudViz,b=d.util.namespace("cloudViz.dataAdapter.rs"),a=Object.create(d.dataAdapter.standard.flowerObj);
a._processOptions=function(g,f){var e=this._processedOptions=Object.create(g);
e.data=this._parseData(g.data);
Object.getPrototypeOf(a)._processOptions.call(this,e,f)
};
a._parseData=function(g){if(!g.metric.length){return[]
}var f=[],e=g.metric[0].id;
dv.util.each(g.metric,function(l,h){if(l.id!=e){return
}var j=g.filter[h].info.name;
var i=g.value[h];
f.push({index:j.toLowerCase(),label:j,value:i})
});
return f
};
a.formats=function(){return this._processedOptions.formats
};
b.flower=d.util.createConstructor(a)
}(this));
(function(a){a.cloudViz.localeDefinition("de-DE",{monthAbbreviations:["Jan","Feb","März","Apr","Mai","Juni","Juli","Aug","Sep","Okt","Nov","Dez"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],weekdayAbbreviations:["So","Mo","Di","Mi","Do","Fr","Sa"],weekdays:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],ampm:["AM","PM"]},"calendar");
a.cloudViz.localeDefinition("de-DE",{core:{nodata:"Das Diagramm enthält keine Daten.",erroronrender:"Hoppla! Ein Fehler ist aufgetreten und das Diagramm konnte nicht gerendert werden.",other:"Sonstige",normalized:"Normalisiert"},dvcore:{target:"Zielgruppe",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (in {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Größe"},pathing:{entry:"Einstieg",exit:"Ausstieg","entry2+":"Einstiege","exit2+":"Ausstiege",path:"Pfad","path2+":"Pfade",expand:"Erweitern",focus:"Fokus",collapse:"Reduzieren",title:"Pfaderstellungs-diagramm",nodeEntries:"Einstiege für {label}",nodeExits:"Ausstiege für {label}",nodeToNode:"{source} → {target}",percOfNode:"{perc} von {label}",pathToNode:"{path} zu {label}",pathFromNode:"{path} aus {label}",help1:"Dieses Diagramm stellt Pfade dar, die von einem Status in einen anderen übernommen wurden.",help2:"Jeder Knoten in Form eines Feldes repräsentiert einen Status im Pfad.",help3:"Durch Tippen oder Klicken auf einen Knoten werden zusätzliche Optionen zum Ändern des Diagramms angezeigt:",focusHelp:"Zeigt Pfade an, die am Knoten ein- oder ausgehen.",expandHelp:"Zeigt zusätzliche Pfade an, die am Knoten ein- oder ausgehen.",collapseHelp:"Entfernt Pfade, die am Knoten ein- oder ausgehen."},sunburst:{audience:"Zielgruppe","audience2+":"Zielgruppen",category:"Kategorie","category2+":"Kategorien",metric:"Metrik","metric2+":"Metriken",primarymetric:"Primäre Metrik",secondarymetric:"Sekundäre Metrik","secondarymetric2+":"Sekundäre Metriken",secondarymetrichelp:"Klicken Sie auf die Metrik, um die Höhe zu ändern.","secondarymetrichelp2+":"Klicken Sie auf die Metriken, um die Höhe zu ändern.",emptyFirstMetric:"Die erste Metrik enthält keine Werte. Wählen Sie eine andere Metrik.",total:"Gesamt",zoomAction:"Doppelklicken, um zu vergrößern.",moreAction:"Klicken Sie hier für weitere Optionen.",zoomin:"Nahansicht",zoomout:"Weitansicht",hide:"Ausblenden",hideall:"Alles ausblenden",hideother:"Sonstige ausblenden",hidden:"{value} verborgenes Element","hidden2+":"{value} verborgene Elemente",topresults:"Top {value}",color:"Farbe",height:"Höhe",both:"Beide",none:"Keine",mapmetric:"{metric} anzeigen als:",percmetric:"{percent} der {metric}",mobilescroll:"&#x25BC – scrollen Sie, um Details anzuzeigen."},flower:{joy:"Freude",admiration:"Bewunderung",fear:"Angst",surprise:"Überraschung",sadness:"Traurigkeit",disgust:"Empörung",anger:"Wut",anticipation:"Vorausschätzung"},venn:{definedAudience:"Definierte Zielgruppe"}},"labels");
a.cloudViz.localeDefinition("de-DE",{shortFormat:{hour:"%H",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{hour:"%H",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{hour:"%H Uhr %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%H Uhr %a %e"},fullFormat:{hour:"%H Uhr %a %e",day:"%A %e",week:"%A %e",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%e %b, %Y",condensed:"%d/%m/%Y"}},"dateFormat");
a.cloudViz.localeDefinition("de-DE",{decimalSeparator:",",groupSeparator:" ",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"},currency:{symbol:"€",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"}},"numberFormat");
a.cloudViz.localeDefinition("de-DE",{singular:{second:"Sekunde",minute:"Minute",hour:"Stunde",day:"Tag",week:"Woche",month:"Monat",year:"Jahr"},plural:{second:"Sekunden",minute:"Minuten",hour:"Stunden",day:"Tagen",week:"Wochen",month:"Monate",year:"Jahre"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"w",month:"mon",year:"y"}},"time")
}(this));
(function(a){a.cloudViz.localeDefinition("en-US",{monthAbbreviations:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdayAbbreviations:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ampm:["AM","PM"]},"calendar");
a.cloudViz.localeDefinition("en-US",{core:{nodata:"The chart has no data",erroronrender:"Oops! There was an error and the chart could not be rendered.",other:"Other",normalized:"Normalized"},dvcore:{target:"Target",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (in {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Size"},pathing:{entry:"Entry",exit:"Exit","entry2+":"Entries","exit2+":"Exits",path:"Path","path2+":"Paths",expand:"Expand",focus:"Focus",collapse:"Collapse",title:"Pathing Chart",nodeEntries:"{label} Entries",nodeExits:"{label} Exits",nodeToNode:"{source} \u2192 {target}",percOfNode:"{perc} of {label}",pathToNode:"{path} to {label}",pathFromNode:"{path} from {label}",help1:"This chart represents paths taken from one state to another.",help2:"Each node, shaped as a box, represents a state in the path.",help3:"Tapping or clicking a node will provide additional options to modify the chart:",focusHelp:"Shows paths coming into and going out of node",expandHelp:"Shows additional paths coming or going from the node",collapseHelp:"Removes paths coming or going from the node"},sunburst:{audience:"Audience","audience2+":"Audiences",category:"Category","category2+":"Categories",metric:"Metric","metric2+":"Metrics",primarymetric:"Primary Metric",secondarymetric:"Secondary Metric","secondarymetric2+":"Secondary Metrics",secondarymetrichelp:"Click metric to toggle height","secondarymetrichelp2+":"Click metrics to toggle height",emptyFirstMetric:"The first metric has no values. Please pick a different metric.",total:"Total",zoomAction:"Double-click to Zoom in.",moreAction:"Click for more options.",zoomin:"Zoom In",zoomout:"Zoom Out",hide:"Hide",hideall:"Hide All",hideother:"Hide Other",hidden:"{value} Hidden Item","hidden2+":"{value} Hidden Items",topresults:"top {value}",color:"Color",height:"Height",both:"Both",none:"None",mapmetric:"Show {metric} as:",percmetric:"{percent} of {metric}",mobilescroll:"&#x25BC scroll for details"},flower:{joy:"Joy",admiration:"Admiration",fear:"Fear",surprise:"Surprise",sadness:"Sadness",disgust:"Disgust",anger:"Anger",anticipation:"Anticipation"},venn:{definedAudience:"Defined Audience"}},"labels");
a.cloudViz.localeDefinition("en-US",{shortFormat:{hour:"%I %p",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{hour:"%I %p",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{hour:"%I %p %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%I %p %a %e"},fullFormat:{hour:"%I %p %a %e",day:"%A %e",week:"%A %e",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%b %e, %Y",condensed:"%m/%d/%Y"}},"dateFormat");
a.cloudViz.localeDefinition("en-US",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"$",positivePattern:"{symbol}{number}",negativePattern:"-{symbol}{number}"}},"numberFormat");
a.cloudViz.localeDefinition("en-US",{singular:{second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month",year:"year"},plural:{second:"seconds",minute:"minutes",hour:"hours",day:"days",week:"weeks",month:"months",year:"years"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"w",month:"mon",year:"y"}},"time")
}(this));
(function(a){a.cloudViz.localeDefinition("es-ES",{monthAbbreviations:["en.","febr.","mzo.","abr.","my.","jun.","jul.","ag.","sept.","oct.","nov.","dic."],months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],weekdayAbbreviations:["dom.","lun.","mart.","miérc.","juev.","vier.","sáb."],weekdays:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],ampm:["a. m.","p. m."]},"calendar");
a.cloudViz.localeDefinition("es-ES",{core:{nodata:"El gráfico no contiene datos",erroronrender:"Se ha producido un error y no se ha podido procesar el gráfico.",other:"Otro",normalized:"Normalizado"},dvcore:{target:"Destino",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (en {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Tamaño"},pathing:{entry:"Entrada",exit:"Salida","entry2+":"Entradas","exit2+":"Salidas",path:"Ruta","path2+":"Rutas",expand:"Expandir",focus:"Enfoque",collapse:"Contraer",title:"Gráfico de ruta",nodeEntries:"Entradas de {label}",nodeExits:"Salidas de {label}",nodeToNode:"{source} → {target}",percOfNode:"{perc} de {label}",pathToNode:"{path} a {label}",pathFromNode:"{path} de {label}",help1:"Este gráfico representa las rutas que se pueden tomar para ir de un estado a otro.",help2:"Los nodos, con forma de caja, representan un estado en la ruta.",help3:"Al hacer clic o tocar un nodo, se mostrarán opciones adicionales para modificar el gráfico:",focusHelp:"Muestra las rutas de ida al nodo o de vuelta",expandHelp:"Muestra rutas adicionales de ida al nodo o de vuelta",collapseHelp:"Suprime las rutas de ida al nodo o de vuelta"},sunburst:{audience:"Audiencia","audience2+":"Audiencias",category:"Categoría","category2+":"Categorías",metric:"Métrica","metric2+":"Métrica",primarymetric:"Métrica principal",secondarymetric:"Métrica secundaria","secondarymetric2+":"Métricas secundarias",secondarymetrichelp:"Haga clic en la métrica para alternar la altura","secondarymetrichelp2+":"Haga clic en las métricas para alternar la altura",emptyFirstMetric:"La primera métrica no contiene ningún valor. Elija otra métrica.",total:"Total",zoomAction:"Doble clic para aumentar.",moreAction:"Haga clic para ver más opciones.",zoomin:"Acercar",zoomout:"Alejar",hide:"Ocultar",hideall:"Ocultar todo",hideother:"Ocultar otro",hidden:"{value} elemento oculto","hidden2+":"{value} elementos ocultos",topresults:"{value} principales",color:"Color",height:"Altura",both:"Ambos",none:"Ninguno",mapmetric:"Mostrar {metric} como:",percmetric:"{percent} de {metric}",mobilescroll:"&#x25BC desplácese para más detalles"},flower:{joy:"Alegría",admiration:"Admiración",fear:"Miedo",surprise:"Sorpresa",sadness:"Tristeza",disgust:"Desagrado",anger:"Enfado",anticipation:"Expectación"},venn:{definedAudience:"Audiencia definida"}},"labels");
a.cloudViz.localeDefinition("es-ES",{shortFormat:{hour:"%H",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{hour:"%H",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{hour:"%Hh %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%Hh %a %e"},fullFormat:{hour:"%Hh %I %p",day:"%A %e",week:"%A %e",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%e %b, %Y",condensed:"%d/%m/%Y"}},"dateFormat");
a.cloudViz.localeDefinition("es-ES",{decimalSeparator:",",groupSeparator:" ",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"},currency:{symbol:"€",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"}},"numberFormat");
a.cloudViz.localeDefinition("es-ES",{singular:{second:"segundo",minute:"minuto",hour:"hora",day:"día",week:"semana",month:"mes",year:"año"},plural:{second:"segundos",minute:"minutos",hour:"horas",day:"días",week:"semanas",month:"meses",year:"años"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"w",month:"mon",year:"y"}},"time")
}(this));
(function(a){a.cloudViz.localeDefinition("fr-FR",{monthAbbreviations:["Janv.","Févr.","Mars","Avr.","Mai","Juin","Juill.","Août","Sept.","Oct.","Nov.","Déc."],months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],weekdayAbbreviations:["Dim.","Lun.","Mar.","Mer.","Jeu.","Ven.","Sam."],weekdays:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],ampm:["AM","PM"]},"calendar");
a.cloudViz.localeDefinition("fr-FR",{core:{nodata:"Le graphique ne contient aucune donnée",erroronrender:"Une erreur s’est produite, impossible de restituer le graphique.",other:"Autre",normalized:"Normalisé"},dvcore:{target:"Cible",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (en {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Taille"},pathing:{entry:"Entrée",exit:"Sortie","entry2+":"Entrées de","exit2+":"Sorties de",path:"Chemin d’accès","path2+":"Chemins d’accès",expand:"Développer",focus:"Mise au point",collapse:"Réduire",title:"Graphique du cheminement",nodeEntries:"Entrées {label}",nodeExits:"Sorties {label}",nodeToNode:"{source} → {target}",percOfNode:"{perc} de {label}",pathToNode:"{path} à {label}",pathFromNode:"{path} de {label}",help1:"Ce graphique représente les chemins d’accès récupérés d’un état à un autre.",help2:"Chaque nœud, en forme de cadre, représente un état dans le chemin d’accès.",help3:"Le fait d’appuyer ou de cliquer sur un nœud fournit d’autres options pour modifier le graphique :",focusHelp:"Présente les chemins d’accès issus du nœud ou y parvenant",expandHelp:"Présente des chemins d’accès supplémentaires issus du nœud ou y parvenant.",collapseHelp:"Supprime les chemins d’accès supplémentaires issus du nœud ou y parvenant."},sunburst:{audience:"Audience","audience2+":"Audiences",category:"Catégorie","category2+":"Catégories",metric:"Mesure","metric2+":"Mesures",primarymetric:"Mesure principale",secondarymetric:"Mesure secondaire","secondarymetric2+":"Mesures secondaires",secondarymetrichelp:"Cliquer sur une mesure pour activer/désactiver la hauteur","secondarymetrichelp2+":"Cliquer sur des mesures pour activer/désactiver la hauteur",emptyFirstMetric:"La première mesure n’a aucune valeur. Sélectionnez une autre mesure.",total:"Total",zoomAction:"Double-cliquez pour effectuer un zoom avant.",moreAction:"Cliquez pour plus d’options.",zoomin:"Zoom avant",zoomout:"Zoom arrière",hide:"Masquer",hideall:"Tout masquer",hideother:"Masquer autres",hidden:"{value} élément masqué","hidden2+":"{value} éléments masqués",topresults:"{value} premiers",color:"Couleur",height:"Hauteur",both:"Les deux",none:"Néant",mapmetric:"Afficher {metric} comme :",percmetric:"{percent} des {metric}",mobilescroll:"Défilement &#x25BC pour plus de détails"},flower:{joy:"Joie",admiration:"Admiration",fear:"Peur",surprise:"Surprise",sadness:"Tristesse",disgust:"Dégoût",anger:"Colère",anticipation:"Anticipation"},venn:{definedAudience:"Audience définie"}},"labels");
a.cloudViz.localeDefinition("fr-FR",{shortFormat:{hour:"%H",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{hour:"%H",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{hour:"%H h %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%H h %a %e"},fullFormat:{hour:"%H h %a %e",day:"%A %e",week:"%A %e",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%e %b %Y",condensed:"%d/%m/%Y"}},"dateFormat");
a.cloudViz.localeDefinition("fr-FR",{decimalSeparator:",",groupSeparator:" ",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"},currency:{symbol:"€",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"}},"numberFormat");
a.cloudViz.localeDefinition("fr-FR",{singular:{second:"seconde",minute:"minute",hour:"heure",day:"jour",week:"semaine",month:"mois",year:"année"},plural:{second:"secondes",minute:"minutes",hour:"heures",day:"jours",week:"semaines",month:"mois",year:"années"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"w",month:"mon",year:"y"}},"time")
}(this));
(function(a){a.cloudViz.localeDefinition("ja-JP",{monthAbbreviations:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],weekdayAbbreviations:["日","月","火","水","木","金","土"],weekdays:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"],ampm:["午前","午後"]},"calendar");
a.cloudViz.localeDefinition("ja-JP",{core:{nodata:"データがありません",erroronrender:"エラーのためチャートを作成できません",other:"その他",normalized:"正規化済み"},dvcore:{target:"Target",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} ({time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Size"},pathing:{entry:"入口",exit:"出口","entry2+":"入口","exit2+":"出口",path:"パス内訳","path2+":"パス内訳",expand:"展開する",focus:"再スタート",collapse:"減らす",title:"遷移チャート",nodeEntries:"{label} 入口",nodeExits:"{label} 出口",nodeToNode:"{source} → {target}",percOfNode:"{label}の{perc}",pathToNode:"{label}への{path}",pathFromNode:"{label}からの{path}",help1:"流れ（パス）を現すチャートです。",help2:"四角形のノードがデータ項目です。",help3:"ノードをクリック（タップ）すると、以下のようなチャート設定用アイコンが表示されます：",focusHelp:"画面をクリアし、該当ノードの前後のパスのみを表示",expandHelp:"該当ノードの前後のパスをさらに表示",collapseHelp:"展開したパスを元に戻す"},sunburst:{audience:"オーディエンス","audience2+":"オーディエンス",category:"カテゴリ","category2+":"カテゴリ",metric:"指標","metric2+":"指標",primarymetric:"一次指標",secondarymetric:"二次指標","secondarymetric2+":"二次指標",secondarymetrichelp:"指標をクリックすると高さが変わる","secondarymetrichelp2+":"指標をクリックすると高さが変わる",emptyFirstMetric:"最も内側の円となる最初の指標のデータが存在しないため、チャートを描画できません。",total:"合計",zoomAction:"ダブルクリックでズームイン",moreAction:"クリックで選択肢を表示",zoomin:"ズームイン",zoomout:"ズームアウト",hide:"選択項目のみ除外",hideall:"全体から同じ項目を除外",hideother:"この項目以外を除外",hidden:"{value} 個の項目を除外中","hidden2+":"{value} 個の項目を除外中",topresults:"上位{value}件",color:"色",height:"高さ",both:"両方",none:"なし",mapmetric:"{metric}の表示方法:",percmetric:"{metric}の{percent}",mobilescroll:"&#x25BC スクロールして詳細を表示"},flower:{joy:"喜び",admiration:"賞賛",fear:"恐怖",surprise:"驚き",sadness:"悲しみ",disgust:"不快",anger:"怒り",anticipation:"予測"},venn:{definedAudience:"定義されたオーディエンス"}},"labels");
a.cloudViz.localeDefinition("ja-JP",{shortFormat:{hour:"%p %I 時",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{hour:"%p %I 時",day:"%e 日 (%a)",week:"%e 日 (%a)",month:"%b",quarter:"%b",year:"%Y",fallback:"%e 日 (%a)"},longFormat:{hour:"%e 日 (%a) %p %I 時",day:"%e 日 (%a)",week:"%e 日 (%a)",month:"%B",quarter:"%B",year:"%Y",fallback:"%e 日 (%a) %p %I 時"},fullFormat:{hour:"%e 日 (%a) %p %I 時",day:"%e 日 (%a)",week:"%e 日 (%a)",month:"%Y 年 %B",quarter:"%Y 年 %B",year:"%Y",fallback:"%Y 年 %b %e 日",condensed:"%Y/%m/%d"}},"dateFormat");
a.cloudViz.localeDefinition("ja-JP",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"¥",positivePattern:"{symbol}{number}",negativePattern:"-{symbol}{number}"}},"numberFormat");
a.cloudViz.localeDefinition("ja-JP",{singular:{second:"秒",minute:"分",hour:"時間",day:"日",week:"週間",month:"か月",year:"年"},plural:{second:"秒",minute:"分",hour:"時間",day:"日",week:"週間",month:"か月",year:"年"},abbreviation:{second:"秒",minute:"分",hour:"時間",day:"日",week:"週間",month:"か月",year:"年"}},"time")
}(this));
(function(a){a.cloudViz.localeDefinition("ko-KR",{monthAbbreviations:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],weekdayAbbreviations:["일","월","화","수","목","금","토"],weekdays:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],ampm:["오전","오후"]},"calendar");
a.cloudViz.localeDefinition("ko-KR",{core:{nodata:"차트에 데이터가 없습니다.",erroronrender:"오류가 발생하여 차트를 렌더링할 수 없습니다.",other:"기타",normalized:"정규화됨"},dvcore:{target:"목표",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title}({time})",legendTime:"{value}{time}"},point:{xScale:"X",yScale:"Y",sizeScale:"크기"},pathing:{entry:"시작",exit:"종료","entry2+":"시작","exit2+":"종료",path:"경로","path2+":"경로",expand:"확장",focus:"포커스",collapse:"축소",title:"경로 지정 차트",nodeEntries:"{label} 시작",nodeExits:"{label} 종료",nodeToNode:"{source} → {target}",percOfNode:"{label}의 {perc}",pathToNode:"{label} 나가는 {path}",pathFromNode:"{label} 들어오는 {path}",help1:"이 차트는 하나의 주에서 다른 주로 가져온 경로를 나타냅니다.",help2:"상자 모양의 노드는 각각 경로 내의 주를 나타냅니다.",help3:"노드를 누르거나 클릭하면 차트를 수정할 추가 옵션을 설정할 수 있습니다.",focusHelp:"노드에 들어오거나 나가는 경로 표시",expandHelp:"노드에 들어오거나 나가는 추가 경로 표시",collapseHelp:"노드에 들어오거나 나가는 경로 제거"},sunburst:{audience:"대상","audience2+":"대상",category:"카테고리","category2+":"카테고리",metric:"지표","metric2+":"지표",primarymetric:"기본 지표",secondarymetric:"보조 지표","secondarymetric2+":"보조 지표",secondarymetrichelp:"지표를 클릭하여 높이 전환","secondarymetrichelp2+":"지표를 클릭하여 높이 전환",emptyFirstMetric:"첫 번째 지표에 값이 없습니다. 다른 지표를 선택하십시오.",total:"합계",zoomAction:"확대하려면 두 번 클릭하십시오.",moreAction:"추가 옵션을 보려면 클릭하십시오.",zoomin:"확대",zoomout:"축소",hide:"숨김",hideall:"모두 숨기기",hideother:"나머지 숨기기",hidden:"{value}개의 숨긴 항목","hidden2+":"{value}개의 숨긴 항목",topresults:"상위 {value}개",color:"색상",height:"높이",both:"둘 다",none:"없음",mapmetric:"{metric} 다음으로 표시:",percmetric:"{metric} 수의 {percent} ",mobilescroll:"&#x25BC 자세한 내용을 보려면 스크롤하십시오."},flower:{joy:"기쁨",admiration:"감탄",fear:"두려움",surprise:"놀람",sadness:"슬픔",disgust:"혐오",anger:"분노",anticipation:"기대"},venn:{definedAudience:"정의된 대상"}},"labels");
a.cloudViz.localeDefinition("ko-KR",{shortFormat:{hour:"%p %I",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{hour:"%p %I",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{hour:"%e일 %a %p %I",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%e일 %a %p %I"},fullFormat:{hour:"%e일 %a %p %I",day:"%A %e",week:"%A %e",month:"%Y 년 %B",quarter:"%Y %B",year:"%Y",fallback:"%Y %b %e일",condensed:"%Y/%m/%d"}},"dateFormat");
a.cloudViz.localeDefinition("ko-KR",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"₩",positivePattern:"{symbol}{number}",negativePattern:"-{symbol}{number}"}},"numberFormat");
a.cloudViz.localeDefinition("ko-KR",{singular:{second:"초",minute:"분",hour:"시간",day:"일",week:"주",month:"월",year:"년"},plural:{second:"초",minute:"분",hour:"시간",day:"일",week:"주",month:"월",year:"년"},abbreviation:{second:"초",minute:"분",hour:"시간",day:"일",week:"주",month:"월",year:"년"}},"time")
}(this));
(function(a){a.cloudViz.localeDefinition("pt-BR",{monthAbbreviations:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],weekdayAbbreviations:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],weekdays:["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"],ampm:["AM","PM"]},"calendar");
a.cloudViz.localeDefinition("pt-BR",{core:{nodata:"O gráfico não possui dados",erroronrender:"Ops! Houve um erro e o gráfico não pôde ser processado.",other:"Outro",normalized:"Normalizado"},dvcore:{target:"Meta",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (em {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Tamanho"},pathing:{entry:"Entrada",exit:"Sair","entry2+":"Entradas","exit2+":"Saídas",path:"Caminho","path2+":"Caminhos",expand:"Expandir",focus:"Foco",collapse:"Recolher",title:"Gráfico de criação de caminho",nodeEntries:"{label} Entradas",nodeExits:"{label} Saídas",nodeToNode:"{source} → {target}",percOfNode:"{perc} de {label}",pathToNode:"{path} para {label}",pathFromNode:"{path} de {label}",help1:"Esse gráfico representa os caminhos tomados de um estado para outro.",help2:"Cada nó, formado como uma caixa representa um estado no caminho.",help3:"Tocar ou clicar em um nó fornecerá opções adicionais para modificar o gráfico:",focusHelp:"Mostra os caminhos entrando ou saindo do nó",expandHelp:"Mostra caminhos adicionais entrando ou saindo do nó",collapseHelp:"Remove os caminhos saindo ou entrando no nó"},sunburst:{audience:"Público-alvo","audience2+":"Públicos-alvos",category:"Categoria","category2+":"Categorias",metric:"Métrica","metric2+":"Métricas",primarymetric:"Métrica principal",secondarymetric:"Métrica secundária","secondarymetric2+":"Métricas secundárias",secondarymetrichelp:"Clique na métrica para alternar a altura","secondarymetrichelp2+":"Clique nas métricas para alternar a altura",emptyFirstMetric:"A primeira métrica não tem valores. Esolha uma métrica diferente.",total:"Total",zoomAction:"Clique duas vezes para aumentar o zoom.",moreAction:"Clique para ver mais opções.",zoomin:"Ampliar",zoomout:"Reduzir",hide:"Ocultar",hideall:"Ocultar tudo",hideother:"Ocultar outro",hidden:"{value} Item oculto","hidden2+":"{value} itens ocultos",topresults:"principais {value}",color:"Cor",height:"Altura",both:"Ambos",none:"Nenhum",mapmetric:"Mostrar {metric} como:",percmetric:"{percent} de {metric}",mobilescroll:"&#x25BC role para ver os detalhes"},flower:{joy:"Alegria",admiration:"Admiração",fear:"Medo",surprise:"Problemas",sadness:"Tristeza",disgust:"Repulsa",anger:"Raiva",anticipation:"Antecipação"},venn:{definedAudience:"Público-alvo definido"}},"labels");
a.cloudViz.localeDefinition("pt-BR",{shortFormat:{hour:"%H",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{hour:"%H",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{hour:"%Hh %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%Hh %a %e"},fullFormat:{hour:"%Hh %a %e",day:"%A %e",week:"%A %e",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%e %b, %Y",condensed:"%Y/%m/%d"}},"dateFormat");
a.cloudViz.localeDefinition("pt-BR",{decimalSeparator:",",groupSeparator:" ",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"},currency:{symbol:"R$",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"}},"numberFormat");
a.cloudViz.localeDefinition("pt-BR",{singular:{second:"segundo",minute:"minuto",hour:"hora",day:"día",week:"semana",month:"mês",year:"ano"},plural:{second:"segundos",minute:"minutos",hour:"horas",day:"dias",week:"semanas",month:"meses",year:"anos"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"w",month:"mon",year:"y"}},"time")
}(this));
(function(a){a.cloudViz.localeDefinition("zh-CN",{monthAbbreviations:["1 月","2 月","3 月","4 月","5 月","6 月","7 月","8 月","9 月","10 月","11 月","12 月"],months:["1 月","2 月","3 月","4 月","5 月","6 月","7 月","8 月","9 月","10 月","11 月","12 月"],weekdayAbbreviations:["周日","周一","周二","周三","周四","周五","周六"],weekdays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],ampm:["上午","下午"]},"calendar");
a.cloudViz.localeDefinition("zh-CN",{core:{nodata:"图表无数据",erroronrender:"抱歉！出现错误，无法呈现图表。",other:"其他",normalized:"已标准化"},dvcore:{target:"目标",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title}（{time}）",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"大小"},pathing:{entry:"登入",exit:"退出","entry2+":"登入","exit2+":"退出",path:"路径","path2+":"路径",expand:"展开",focus:"聚焦",collapse:"折叠",title:"路径图表",nodeEntries:"{label} 登入",nodeExits:"{label} 退出",nodeToNode:"{source} → {target}",percOfNode:"{perc} 的 {label}",pathToNode:"前往 {label} 的 {path}",pathFromNode:"来自 {label} 的 {path}",help1:"此图表代表从一种状态转变为另一种状态的路径。",help2:"每个长方形节点代表路径中的一种状态。",help3:"轻按或单击节点可以提供修改图表的其他选项：",focusHelp:"显示来往于节点的路径",expandHelp:"显示来往于节点的其他路径",collapseHelp:"删除来往于节点的路径"},sunburst:{audience:"受众","audience2+":"受众",category:"类别","category2+":"类别",metric:"量度","metric2+":"量度",primarymetric:"主要量度",secondarymetric:"次要量度","secondarymetric2+":"次要量度",secondarymetrichelp:"单击量度可切换高度","secondarymetrichelp2+":"单击量度可切换高度",emptyFirstMetric:"第一个量度没有值。请选择其他量度。",total:"合计",zoomAction:"双击可放大。",moreAction:"单击可获取更多选项。",zoomin:"放大",zoomout:"缩小",hide:"隐藏",hideall:"全部隐藏",hideother:"隐藏其他",hidden:"{value} 个隐藏的条目","hidden2+":"{value} 个隐藏的条目",topresults:"排名前 {value}",color:"彩色",height:"高度",both:"两者",none:"无",mapmetric:"{metric} 显示方式:",percmetric:"{percent} 的 {metric}",mobilescroll:"&#x25BC 展开详细信息"},flower:{joy:"欢快",admiration:"羡慕",fear:"害怕",surprise:"惊讶",sadness:"伤心",disgust:"厌恶",anger:"生气",anticipation:"期待"},venn:{definedAudience:"定义的受众"}},"labels");
a.cloudViz.localeDefinition("zh-CN",{shortFormat:{hour:"%p %I",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{hour:"%p %I",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{hour:"%e 日 %a %p %I",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%e 日 %a %p %I"},fullFormat:{hour:"%e 日 %a %p %I",day:"%A %e",week:"%A %e",month:"%Y 年%B",quarter:"%Y %B",year:"%Y",fallback:"%Y %b %e 日",condensed:"%Y/%m/%d"}},"dateFormat");
a.cloudViz.localeDefinition("zh-CN",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"¥",positivePattern:"{symbol}{number}",negativePattern:"-{symbol}{number}"}},"numberFormat");
a.cloudViz.localeDefinition("zh-CN",{singular:{second:"秒",minute:"分钟",hour:"小时",day:"天",week:"周",month:"月",year:"年"},plural:{second:"秒",minute:"分钟",hour:"小时",day:"天",week:"周",month:"月",year:"年"},abbreviation:{second:"秒",minute:"分钟",hour:"小时",day:"天",week:"周",month:"月",year:"年"}},"time")
}(this));
(function(a){a.cloudViz.localeDefinition("zh-TW",{monthAbbreviations:["1 月","2 月","3 月","4 月","5 月","6 月","7 月","8 月","9 月","10 月","11 月","12 月"],months:["1 月","2 月","3 月","4 月","5 月","6 月","7 月","8 月","9 月","10 月","11 月","12 月"],weekdayAbbreviations:["週日","週一","週二","週三","週四","週五","週六"],weekdays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],ampm:["上午","下午"]},"calendar");
a.cloudViz.localeDefinition("zh-TW",{core:{nodata:"此圖表沒有任何資料",erroronrender:"糟糕！發生錯誤，無法產生圖表。",other:"其他",normalized:"已標準化"},dvcore:{target:"目標",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (以{time}數計)",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"大小"},pathing:{entry:"登入點",exit:"退出點","entry2+":"登入點","exit2+":"退出點",path:"路徑","path2+":"路徑",expand:"展開",focus:"焦點",collapse:"摺疊",title:"路徑圖表",nodeEntries:"{label} 登入點",nodeExits:"{label} 退出點",nodeToNode:"{source} → {target}",percOfNode:"{perc} 的 {label}",pathToNode:"連至 {label} 的 {path}",pathFromNode:"來自 {label} 的 {path}",help1:"此圖表代表從一狀態變為另一狀態的路徑。",help2:"每個設計成方塊的節點都代表路徑中的一種狀態。",help3:"點選或按一下節點即可取得用於修改圖表的其他選項:",focusHelp:"顯示進出節點的路徑",expandHelp:"顯示前往或遠離節點的其他路徑",collapseHelp:"移除前往或遠離節點的路徑"},sunburst:{audience:"讀者","audience2+":"讀者",category:"類別","category2+":"類別",metric:"量度","metric2+":"量度",primarymetric:"主要量度",secondarymetric:"次要量度","secondarymetric2+":"次要量度",secondarymetrichelp:"按一下量度以切換高度","secondarymetrichelp2+":"按一下量度以切換高度",emptyFirstMetric:"第一個量度沒有值。請選擇其他量度。",total:"總計",zoomAction:"連按兩下來放大顯示。",moreAction:"按一下存取更多選項。",zoomin:"放大",zoomout:"縮小",hide:"隱藏",hideall:"全部隱藏",hideother:"隱藏其他",hidden:"{value} 個隱藏項目","hidden2+":"{value} 個隱藏項目",topresults:"前 {value} 個項目",color:"色彩",height:"高度",both:"兩者",none:"無",mapmetric:"將 {metric} 顯示為:",percmetric:"{percent} 的 {metric}",mobilescroll:"&#x25BC 捲動以瞭解詳細資料"},flower:{joy:"歡樂",admiration:"欽佩",fear:"恐懼",surprise:"驚喜",sadness:"傷心",disgust:"噁心",anger:"憤怒",anticipation:"期望"},venn:{definedAudience:"特定讀者"}},"labels");
a.cloudViz.localeDefinition("zh-TW",{shortFormat:{hour:"%p %I",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{hour:"%p %I",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{hour:"%e 日 %a %p %I",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%e 日 %a %p %I"},fullFormat:{hour:"%e 日 %a %p %I",day:"%A %e",week:"%A %e",month:"%Y 年 %B",quarter:"%Y %B",year:"%Y",fallback:"%Y %b %e 日",condensed:"%Y/%m/%d"}},"dateFormat");
a.cloudViz.localeDefinition("zh-TW",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"NT$",positivePattern:"{symbol}{number}",negativePattern:"-{symbol}{number}"}},"numberFormat");
a.cloudViz.localeDefinition("zh-TW",{singular:{second:"秒",minute:"分鐘",hour:"小時",day:"天",week:"週",month:"月",year:"年"},plural:{second:"秒",minute:"分鐘",hour:"小時",day:"天",week:"週",month:"月",year:"年"},abbreviation:{second:"秒",minute:"分鐘",hour:"小時",day:"天",week:"週",month:"月",year:"年"}},"time")
}(this));
(function(a){a.cloudViz.localeDefinition("zz-ZZ",{monthAbbreviations:["[g] 승_Jan_文","[q] 승_Feb_文","[r] 승_Mar_文","[n] 승_Apr_文","[p] 승_May_文","[k] 승_Jun_文","[l] 승_Jul_文","[i] 승_Aug_文","[j] 승_Sep_文","[h] 승_Oct_文","[o] 승_Nov_文","[m] 승_Dec_文"],months:["[1] 승_January_文","[2] 승_February_文","[3] 승_March_文","[x] 승_April_文","[y] 승_May_文","[z] 승_June_文","[0] 승_July_文","[s] 승_August_文","[t] 승_September_文","[u] 승_October_文","[v] 승_November_文","[w] 승_December_文"],weekdayAbbreviations:["[+] 승_Sun_文","[4] 승_Mon_文","[5] 승_Tue_文","[6] 승_Wed_文","[7] 승_Thu_文","[8] 승_Fri_文","[9] 승_Sat_文"],weekdays:["[BB] 승_Sunday_文","[BA] 승_Monday_文","[/] 승_Tuesday_文","[BC] 승_Wednesday_文","[BD] 승_Thursday_文","[BE] 승_Friday_文","[BF] 승_Saturday_文"],ampm:["[e] 승_AM_文","[f] 승_PM_文"]},"calendar");
a.cloudViz.localeDefinition("zz-ZZ",{core:{nodata:"[BH] 승_The chart has no data_文",erroronrender:"[BG] 승_Oops! There was an error and the chart could not be rendered._文",other:"[BJ] 승_Other_文",normalized:"[BI] 승_Normalized_文"},dvcore:{target:"[BL] 승_Target_文",yAxisTimeNoTitle:"[BK] 승_{time}_文",yAxisTimeWithTitle:"[BN] 승_{title} (in {time})_文",legendTime:"[BM] 승_{value} {time}_文"},point:{xScale:"[Bp] 승_X_文",yScale:"[Br] 승_Y_文",sizeScale:"[Bq] 승_Size_文"},pathing:{entry:"[Be] 승_Entry_文",exit:"[Bg] 승_Exit_文","entry2+":"[Bn] 승_Entries_文","exit2+":"[Bb] 승_Exits_文",path:"[BZ] 승_Path_文","path2+":"[Bf] 승_Paths_文",expand:"[BX] 승_Expand_文",focus:"[BW] 승_Focus_文",collapse:"[Bj] 승_Collapse_文",title:"[Bc] 승_Pathing Chart_文",nodeEntries:"[Cz] 승_{label} Entries_文",nodeExits:"[C0] 승_{label} Exits_文",nodeToNode:"[Cy] 승_{source} → {target}_文",percOfNode:"[Ba] 승_{perc} of {label}_文",pathToNode:"[Bo] 승_{path} to {label}_文",pathFromNode:"[Bd] 승_{path} from {label}_文",help1:"[BY] 승_This chart represents paths taken from one state to another._文",help2:"[Bh] 승_Each node, shaped as a box, represents a state in the path._文",help3:"[Bk] 승_Tapping or clicking a node will provide additional options to modify the chart:_文",focusHelp:"[Bm] 승_Shows paths coming into and going out of node_文",expandHelp:"[Bi] 승_Shows additional paths coming or going from the node_文",collapseHelp:"[Bl] 승_Removes paths coming or going from the node_文"},sunburst:{audience:"[Ci] 승_Audience_文","audience2+":"[Ce] 승_Audiences_文",category:"[Ch] 승_Category_文","category2+":"[Cf] 승_Categories_文",metric:"[Cd] 승_Metric_文","metric2+":"[Cg] 승_Metrics_文",primarymetric:"[Cj] 승_Primary Metric_文",secondarymetric:"[Cl] 승_Secondary Metric_文","secondarymetric2+":"[Ck] 승_Secondary Metrics_文",secondarymetrichelp:"[Cm] 승_Click metric to toggle height_文","secondarymetrichelp2+":"[Cn] 승_Click metrics to toggle height_文",emptyFirstMetric:"[B2] 승_The first metric has no values. Please pick a different metric._文",total:"[B7] 승_Total_文",zoomAction:"[By] 승_Double-click to Zoom in._文",moreAction:"[B5] 승_Click for more options._文",zoomin:"[Bz] 승_Zoom In_文",zoomout:"[Bs] 승_Zoom Out_文",hide:"[Bt] 승_Hide_文",hideall:"[Bw] 승_Hide All_文",hideother:"[Bu] 승_Hide Other_文",hidden:"[B4] 승_{value} Hidden Item_文","hidden2+":"[B0] 승_{value} Hidden Items_文",topresults:"[B8] 승_top {value}_文",color:"[Bx] 승_Color_文",height:"[Bv] 승_Height_文",both:"[B6] 승_Both_文",none:"[B3] 승_None_文",mapmetric:"[B9] 승_Show {metric} as:_文",percmetric:"[B1] 승_{percent} of {metric}_文",mobilescroll:"[Co] 승_&#x25BC scroll for details_文"},flower:{joy:"[BU] 승_Joy_文",admiration:"[BT] 승_Admiration_文",fear:"[BQ] 승_Fear_文",surprise:"[BR] 승_Surprise_文",sadness:"[BO] 승_Sadness_文",disgust:"[BP] 승_Disgust_文",anger:"[BV] 승_Anger_文",anticipation:"[BS] 승_Anticipation_文"},venn:{definedAudience:"[B+] 승_Defined Audience_文"}},"labels");
a.cloudViz.localeDefinition("zz-ZZ",{shortFormat:{hour:"[Z] 승_%I %p_文",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"[d] 승_%Y_文",fallback:"%e"},mediumFormat:{hour:"[S] 승_%I %p_文",day:"[Q] 승_%a %e_文",week:"[T] 승_%a %e_文",month:"%b",quarter:"%b",year:"[U] 승_%Y_文",fallback:"[V] 승_%a %e_文"},longFormat:{hour:"[P] 승_%I %p %a %e_文",day:"[M] 승_%A %e_文",week:"[O] 승_%A %e_文",month:"[L] 승_%B_文",quarter:"[K] 승_%B_文",year:"[J] 승_%Y_文",fallback:"[N] 승_%I %p %a %e_文"},fullFormat:{hour:"[D] 승_%I %p %a %e_文",day:"[C] 승_%A %e_文",week:"[B] 승_%A %e_文",month:"[G] 승_%B %Y_文",quarter:"[E] 승_%B %Y_文",year:"[I] 승_%Y_文",fallback:"[F] 승_%b %e, %Y_文",condensed:"[H] 승_%m/%d/%Y_文"}},"dateFormat");
a.cloudViz.localeDefinition("zz-ZZ",{decimalSeparator:"[CC] 승_._文",groupSeparator:"[CD] 승_,_文",negativePattern:"[CE] 승_-{number}_文",percent:{symbol:"[CF] 승_%_文",positivePattern:"[CG] 승_{number}{symbol}_文",negativePattern:"[CH] 승_-{number}{symbol}_文"},currency:{symbol:"[B/] 승_$_文",positivePattern:"[CA] 승_{symbol}{number}_文",negativePattern:"[CB] 승_-{symbol}{number}_文"}},"numberFormat");
a.cloudViz.localeDefinition("zz-ZZ",{singular:{second:"[CX] 승_second_文",minute:"[CY] 승_minute_文",hour:"[CZ] 승_hour_文",day:"[CV] 승_day_文",week:"[Ca] 승_week_文",month:"[Cb] 승_month_文",year:"[CW] 승_year_文"},plural:{second:"[CS] 승_seconds_文",minute:"[CP] 승_minutes_文",hour:"[Cc] 승_hours_文",day:"[CR] 승_days_文",week:"[CQ] 승_weeks_文",month:"[CT] 승_months_文",year:"[CU] 승_years_文"},abbreviation:{second:"[CJ] 승_s_文",minute:"[CO] 승_min_文",hour:"[CK] 승_h_文",day:"[CI] 승_d_文",week:"[CL] 승_w_文",month:"[CM] 승_mon_文",year:"[CN] 승_y_文"}},"time")
}(this));
(function(c){function a(s,D){if(this instanceof a){return this
}var B=D||{},V=0,j=B.displayCount||-1,l=B.showNone,T={},v=(T.value=[]),Z=(T.origValue=[]),R=(T.lowerBound=[]),G=(T.upperBound=[]),w=(T.series=[]),P=(T.series_name=[]),p=(T.metric_series=[]),N=(T.metric_series_name=[]),C=(T.date=[]),Q=(T.category=[]),z=(T.label=[]),A=(T.groups=[]),o=(T.facets=[]),n=(T.cell=[]),W=(T.filter=[]),h=B.showMetrics||false,ae=(T.metric=[]);
var u,g,I,O,M,ab,E,X,K,S,r,Y,J,ac,t,U,ad,L,q,af,e,aa=s.metrics.length>1,H=false,k=false;
if(s.filters.length>1){s.filters.some(function(f,d,m){if(d>0&&!k){k=(f.data_store!==m[d-1].data_store)
}if(d>0&&!H){H=((f.info&&f.info.name||"")!==(m[d-1].info&&m[d-1].info.name||""))
}return H&&k
})
}for(S=0,r=s.metrics.length;
S<r;
++S){O=s.metrics[S];
E=(O.name||O.id||"")+"";
u=O.filter_ref;
g=O.date_ref;
J=(j>=0)?Math.min(j,u.length):u.length;
for(Y=0;
Y<J;
++Y){M=s.filters[u[Y]];
if(!M.facet_ref){M.facet_ref=[]
}af=[];
e=[];
for(ad=0,L=M.facet_ref.length;
ad<L;
++ad){q=s.facets[M.facet_ref[ad]];
af.push(q);
e.push(q.info&&q.info.name||"")
}if((M.info&&M.info.id===0)&&!l){if(J<u.length){++J
}continue
}ab=(M.info&&M.info.name||"")+"";
K=M.data_store_name||(M.data_store&&M.data_store.replace("dms/","")||"");
for(ac=0,t=g.length;
ac<t;
++ac){X=s.dates[g[ac]];
I=s.data[u[Y]][g[ac]][S];
v[V]=("invalid"===I.status||"transform_error"===I.status||"calc_error"===I.status)?undefined:(+I.val||0);
Z[V]="invalid"===I.status?undefined:(+I.orig_val||0);
R[V]=("invalid"===I.status||"transform_error"===I.status)?undefined:(+I.lower_bound||0);
G[V]=("invalid"===I.status||"transform_error"===I.status)?undefined:(+I.upper_bound||0);
C[V]=new Date(X.val);
Q[V]=ab;
z[V]=E;
N[V]=((k)?K+"   ":"")+E;
p[V]=N[V]+":m"+O.ref_id;
U=[];
if(k){U.push(K)
}if(Q[V].length){U.push(Q[V])
}P[V]=U.join("   ");
if(P[V].length===0){P[V]=E
}else{if((h||aa||!H)&&E.length){P[V]+=" ("+E+")"
}}w[V]=P[V]+":m"+O.ref_id+"f"+M.ref_id;
A[V]=e;
W[V]=M;
ae[V]=O;
n[V]=I;
o[V]=af;
++V
}}}return T
}var b=c.rs2dv;
a.noConflict=function(){c.rs2dv=b;
return this
};
a.prototype.convert=function(){return a.apply(null,arguments)
};
c.rs2dv=a;
if("function"===typeof define&&define.amd){define(function(){return a
})
}else{if("undefined"===typeof exports){c.rs2dv=a
}else{if("object"!==typeof module||!module.exports){exports.rs2dv=a
}else{module.exports=a
}}}}(this));
/*! URI.js v1.14.1 http://medialize.github.io/URI.js/ */
(function(b,a){"object"===typeof exports?module.exports=a(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"===typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],a):b.URI=a(b.punycode,b.IPv6,b.SecondLevelDomains,b)
})(this,function(R,o,K,S){function U(e,d){if(!(this instanceof U)){return new U(e,d)
}void 0===e&&(e="undefined"!==typeof location?location.href+"":"");
this.href(e);
return void 0!==d?this.absoluteTo(d):this
}function N(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")
}function g(d){return void 0===d?"Undefined":String(Object.prototype.toString.call(d)).slice(8,-1)
}function T(d){return"Array"===g(d)
}function i(l,d){var q,p;
if(T(d)){q=0;
for(p=d.length;
q<p;
q++){if(!i(l,d[q])){return !1
}}return !0
}var m=g(d);
q=0;
for(p=l.length;
q<p;
q++){if("RegExp"===m){if("string"===typeof l[q]&&l[q].match(d)){return !0
}}else{if(l[q]===d){return !0
}}}return !1
}function Q(l,d){if(!T(l)||!T(d)||l.length!==d.length){return !1
}l.sort();
d.sort();
for(var p=0,m=l.length;
p<m;
p++){if(l[p]!==d[p]){return !1
}}return !0
}function s(d){return escape(d)
}function c(d){return encodeURIComponent(d).replace(/[!'()*]/g,s).replace(/\*/g,"%2A")
}function k(d){return function(e,l){if(void 0===e){return this._parts[d]||""
}this._parts[d]=e||null;
this.build(!l);
return this
}
}function O(e,d){return function(m,l){if(void 0===m){return this._parts[e]||""
}null!==m&&(m+="",m.charAt(0)===d&&(m=m.substring(1)));
this._parts[e]=m;
this.build(!l);
return this
}
}var n=S&&S.URI;
U.version="1.14.1";
var V=U.prototype,P=Object.prototype.hasOwnProperty;
U._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:U.duplicateQueryParameters,escapeQuerySpace:U.escapeQuerySpace}
};
U.duplicateQueryParameters=!1;
U.escapeQuerySpace=!0;
U.protocol_expression=/^[a-z][a-z0-9.+-]*$/i;
U.idn_expression=/[^a-z0-9\.-]/i;
U.punycode_expression=/(xn--)/i;
U.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;
U.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;
U.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/ig;
U.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/};
U.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};
U.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;
U.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"};
U.getDomAttribute=function(e){if(e&&e.nodeName){var d=e.nodeName.toLowerCase();
return"input"===d&&"image"!==e.type?void 0:U.domAttributes[d]
}};
U.encode=c;
U.decode=decodeURIComponent;
U.iso8859=function(){U.encode=escape;
U.decode=unescape
};
U.unicode=function(){U.encode=c;
U.decode=decodeURIComponent
};
U.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}};
U.encodeQuery=function(e,d){var l=U.encode(e+"");
void 0===d&&(d=U.escapeQuerySpace);
return d?l.replace(/%20/g,"+"):l
};
U.decodeQuery=function(e,d){e+="";
void 0===d&&(d=U.escapeQuerySpace);
try{return U.decode(d?e.replace(/\+/g,"%20"):e)
}catch(l){return e
}};
U.recodePath=function(e){e=(e+"").split("/");
for(var d=0,l=e.length;
d<l;
d++){e[d]=U.encodePathSegment(U.decode(e[d]))
}return e.join("/")
};
U.decodePath=function(e){e=(e+"").split("/");
for(var d=0,l=e.length;
d<l;
d++){e[d]=U.decodePathSegment(e[d])
}return e.join("/")
};
var M={encode:"encode",decode:"decode"},a,L=function(e,d){return function(m){try{return U[d](m+"").replace(U.characters[e][d].expression,function(p){return U.characters[e][d].map[p]
})
}catch(l){return m
}}
};
for(a in M){U[a+"PathSegment"]=L("pathname",M[a])
}U.encodeReserved=L("reserved","encode");
U.parse=function(e,d){var l;
d||(d={});
l=e.indexOf("#");
-1<l&&(d.fragment=e.substring(l+1)||null,e=e.substring(0,l));
l=e.indexOf("?");
-1<l&&(d.query=e.substring(l+1)||null,e=e.substring(0,l));
"//"===e.substring(0,2)?(d.protocol=null,e=e.substring(2),e=U.parseAuthority(e,d)):(l=e.indexOf(":"),-1<l&&(d.protocol=e.substring(0,l)||null,d.protocol&&!d.protocol.match(U.protocol_expression)?d.protocol=void 0:"//"===e.substring(l+1,l+3)?(e=e.substring(l+3),e=U.parseAuthority(e,d)):(e=e.substring(l+1),d.urn=!0)));
d.path=e;
return d
};
U.parseHost=function(l,d){var p=l.indexOf("/"),m;
-1===p&&(p=l.length);
"["===l.charAt(0)?(m=l.indexOf("]"),d.hostname=l.substring(1,m)||null,d.port=l.substring(m+2,p)||null,"/"===d.port&&(d.port=null)):l.indexOf(":")!==l.lastIndexOf(":")?(d.hostname=l.substring(0,p)||null,d.port=null):(m=l.substring(0,p).split(":"),d.hostname=m[0]||null,d.port=m[1]||null);
d.hostname&&"/"!==l.substring(p).charAt(0)&&(p++,l="/"+l);
return l.substring(p)||"/"
};
U.parseAuthority=function(e,d){e=U.parseUserinfo(e,d);
return U.parseHost(e,d)
};
U.parseUserinfo=function(e,d){var m=e.indexOf("/"),l=e.lastIndexOf("@",-1<m?m:e.length-1);
-1<l&&(-1===m||l<m)?(m=e.substring(0,l).split(":"),d.username=m[0]?U.decode(m[0]):null,m.shift(),d.password=m[0]?U.decode(m.join(":")):null,e=e.substring(l+1)):(d.username=null,d.password=null);
return e
};
U.parseQuery=function(l,e){if(!l){return{}
}l=l.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");
if(!l){return{}
}for(var u={},q=l.split("&"),p=q.length,r,m,t=0;
t<p;
t++){r=q[t].split("="),m=U.decodeQuery(r.shift(),e),r=r.length?U.decodeQuery(r.join("="),e):null,P.call(u,m)?("string"===typeof u[m]&&(u[m]=[u[m]]),u[m].push(r)):u[m]=r
}return u
};
U.build=function(e){var d="";
e.protocol&&(d+=e.protocol+":");
e.urn||!d&&!e.hostname||(d+="//");
d+=U.buildAuthority(e)||"";
"string"===typeof e.path&&("/"!==e.path.charAt(0)&&"string"===typeof e.hostname&&(d+="/"),d+=e.path);
"string"===typeof e.query&&e.query&&(d+="?"+e.query);
"string"===typeof e.fragment&&e.fragment&&(d+="#"+e.fragment);
return d
};
U.buildHost=function(e){var d="";
if(e.hostname){d=U.ip6_expression.test(e.hostname)?d+("["+e.hostname+"]"):d+e.hostname
}else{return""
}e.port&&(d+=":"+e.port);
return d
};
U.buildAuthority=function(d){return U.buildUserinfo(d)+U.buildHost(d)
};
U.buildUserinfo=function(e){var d="";
e.username&&(d+=U.encode(e.username),e.password&&(d+=":"+U.encode(e.password)),d+="@");
return d
};
U.buildQuery=function(l,e,u){var q="",p,r,m,t;
for(r in l){if(P.call(l,r)&&r){if(T(l[r])){for(p={},m=0,t=l[r].length;
m<t;
m++){void 0!==l[r][m]&&void 0===p[l[r][m]+""]&&(q+="&"+U.buildQueryParameter(r,l[r][m],u),!0!==e&&(p[l[r][m]+""]=!0))
}}else{void 0!==l[r]&&(q+="&"+U.buildQueryParameter(r,l[r],u))
}}}return q.substring(1)
};
U.buildQueryParameter=function(e,d,l){return U.encodeQuery(e,l)+(null!==d?"="+U.encodeQuery(d,l):"")
};
U.addQuery=function(e,d,m){if("object"===typeof d){for(var l in d){P.call(d,l)&&U.addQuery(e,l,d[l])
}}else{if("string"===typeof d){void 0===e[d]?e[d]=m:("string"===typeof e[d]&&(e[d]=[e[d]]),T(m)||(m=[m]),e[d]=(e[d]||[]).concat(m))
}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")
}}};
U.removeQuery=function(l,e,t){var q;
if(T(e)){for(t=0,q=e.length;
t<q;
t++){l[e[t]]=void 0
}}else{if("object"===typeof e){for(q in e){P.call(e,q)&&U.removeQuery(l,q,e[q])
}}else{if("string"===typeof e){if(void 0!==t){if(l[e]===t){l[e]=void 0
}else{if(T(l[e])){q=l[e];
var r={},p,m;
if(T(t)){for(p=0,m=t.length;
p<m;
p++){r[t[p]]=!0
}}else{r[t]=!0
}p=0;
for(m=q.length;
p<m;
p++){void 0!==r[q[p]]&&(q.splice(p,1),m--,p--)
}l[e]=q
}}}else{l[e]=void 0
}}else{throw new TypeError("URI.removeQuery() accepts an object, string as the first parameter")
}}}};
U.hasQuery=function(l,e,q,m){if("object"===typeof e){for(var p in e){if(P.call(e,p)&&!U.hasQuery(l,p,e[p])){return !1
}}return !0
}if("string"!==typeof e){throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter")
}switch(g(q)){case"Undefined":return e in l;
case"Boolean":return l=Boolean(T(l[e])?l[e].length:l[e]),q===l;
case"Function":return !!q(l[e],e,l);
case"Array":return T(l[e])?(m?i:Q)(l[e],q):!1;
case"RegExp":return T(l[e])?m?i(l[e],q):!1:Boolean(l[e]&&l[e].match(q));
case"Number":q=String(q);
case"String":return T(l[e])?m?i(l[e],q):!1:l[e]===q;
default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")
}};
U.commonPath=function(l,d){var p=Math.min(l.length,d.length),m;
for(m=0;
m<p;
m++){if(l.charAt(m)!==d.charAt(m)){m--;
break
}}if(1>m){return l.charAt(0)===d.charAt(0)&&"/"===l.charAt(0)?"/":""
}if("/"!==l.charAt(m)||"/"!==d.charAt(m)){m=l.substring(0,m).lastIndexOf("/")
}return l.substring(0,m+1)
};
U.withinString=function(A,z,w){w||(w={});
var u=w.start||U.findUri.start,v=w.end||U.findUri.end,t=w.trim||U.findUri.trim,r=/[a-z0-9-]=["']?$/i;
for(u.lastIndex=0;
;
){var e=u.exec(A);
if(!e){break
}e=e.index;
if(w.ignoreHtml){var q=A.slice(Math.max(e-3,0),e);
if(q&&r.test(q)){continue
}}var q=e+A.slice(e).search(v),p=A.slice(e,q).replace(t,"");
w.ignore&&w.ignore.test(p)||(q=e+p.length,p=z(p,e,q,A),A=A.slice(0,e)+p+A.slice(q),u.lastIndex=e+p.length)
}u.lastIndex=0;
return A
};
U.ensureValidHostname=function(d){if(d.match(U.invalid_hostname_characters)){if(!R){throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available')
}if(R.toASCII(d).match(U.invalid_hostname_characters)){throw new TypeError('Hostname "'+d+'" contains characters other than [A-Z0-9.-]')
}}};
U.noConflict=function(d){if(d){return d={URI:this.noConflict()},S.URITemplate&&"function"===typeof S.URITemplate.noConflict&&(d.URITemplate=S.URITemplate.noConflict()),S.IPv6&&"function"===typeof S.IPv6.noConflict&&(d.IPv6=S.IPv6.noConflict()),S.SecondLevelDomains&&"function"===typeof S.SecondLevelDomains.noConflict&&(d.SecondLevelDomains=S.SecondLevelDomains.noConflict()),d
}S.URI===this&&(S.URI=n);
return this
};
V.build=function(d){if(!0===d){this._deferred_build=!0
}else{if(void 0===d||this._deferred_build){this._string=U.build(this._parts),this._deferred_build=!1
}}return this
};
V.clone=function(){return new U(this)
};
V.valueOf=V.toString=function(){return this.build(!1)._string
};
V.protocol=k("protocol");
V.username=k("username");
V.password=k("password");
V.hostname=k("hostname");
V.port=k("port");
V.query=O("query","?");
V.fragment=O("fragment","#");
V.search=function(e,d){var l=this.query(e,d);
return"string"===typeof l&&l.length?"?"+l:l
};
V.hash=function(e,d){var l=this.fragment(e,d);
return"string"===typeof l&&l.length?"#"+l:l
};
V.pathname=function(e,d){if(void 0===e||!0===e){var l=this._parts.path||(this._parts.hostname?"/":"");
return e?U.decodePath(l):l
}this._parts.path=e?U.recodePath(e):"/";
this.build(!d);
return this
};
V.path=V.pathname;
V.href=function(l,e){var q;
if(void 0===l){return this.toString()
}this._string="";
this._parts=U._parts();
var m=l instanceof U,p="object"===typeof l&&(l.hostname||l.path||l.pathname);
l.nodeName&&(p=U.getDomAttribute(l),l=l[p]||"",p=!1);
!m&&p&&void 0!==l.pathname&&(l=l.toString());
if("string"===typeof l||l instanceof String){this._parts=U.parse(String(l),this._parts)
}else{if(m||p){for(q in m=m?l._parts:l,m){P.call(this._parts,q)&&(this._parts[q]=m[q])
}}else{throw new TypeError("invalid input")
}}this.build(!e);
return this
};
V.is=function(z){var w=!1,v=!1,t=!1,u=!1,r=!1,q=!1,p=!1,e=!this._parts.urn;
this._parts.hostname&&(e=!1,v=U.ip4_expression.test(this._parts.hostname),t=U.ip6_expression.test(this._parts.hostname),w=v||t,r=(u=!w)&&K&&K.has(this._parts.hostname),q=u&&U.idn_expression.test(this._parts.hostname),p=u&&U.punycode_expression.test(this._parts.hostname));
switch(z.toLowerCase()){case"relative":return e;
case"absolute":return !e;
case"domain":case"name":return u;
case"sld":return r;
case"ip":return w;
case"ip4":case"ipv4":case"inet4":return v;
case"ip6":case"ipv6":case"inet6":return t;
case"idn":return q;
case"url":return !this._parts.urn;
case"urn":return !!this._parts.urn;
case"punycode":return p
}return null
};
var j=V.protocol,h=V.port,f=V.hostname;
V.protocol=function(e,d){if(void 0!==e&&e&&(e=e.replace(/:(\/\/)?$/,""),!e.match(U.protocol_expression))){throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]")
}return j.call(this,e,d)
};
V.scheme=V.protocol;
V.port=function(e,d){if(this._parts.urn){return void 0===e?"":this
}if(void 0!==e&&(0===e&&(e=null),e&&(e+="",":"===e.charAt(0)&&(e=e.substring(1)),e.match(/[^0-9]/)))){throw new TypeError('Port "'+e+'" contains characters other than [0-9]')
}return h.call(this,e,d)
};
V.hostname=function(e,d){if(this._parts.urn){return void 0===e?"":this
}if(void 0!==e){var l={};
U.parseHost(e,l);
e=l.hostname
}return f.call(this,e,d)
};
V.host=function(e,d){if(this._parts.urn){return void 0===e?"":this
}if(void 0===e){return this._parts.hostname?U.buildHost(this._parts):""
}U.parseHost(e,this._parts);
this.build(!d);
return this
};
V.authority=function(e,d){if(this._parts.urn){return void 0===e?"":this
}if(void 0===e){return this._parts.hostname?U.buildAuthority(this._parts):""
}U.parseAuthority(e,this._parts);
this.build(!d);
return this
};
V.userinfo=function(e,d){if(this._parts.urn){return void 0===e?"":this
}if(void 0===e){if(!this._parts.username){return""
}var l=U.buildUserinfo(this._parts);
return l.substring(0,l.length-1)
}"@"!==e[e.length-1]&&(e+="@");
U.parseUserinfo(e,this._parts);
this.build(!d);
return this
};
V.resource=function(e,d){var l;
if(void 0===e){return this.path()+this.search()+this.hash()
}l=U.parse(e);
this._parts.path=l.path;
this._parts.query=l.query;
this._parts.fragment=l.fragment;
this.build(!d);
return this
};
V.subdomain=function(e,d){if(this._parts.urn){return void 0===e?"":this
}if(void 0===e){if(!this._parts.hostname||this.is("IP")){return""
}var l=this._parts.hostname.length-this.domain().length-1;
return this._parts.hostname.substring(0,l)||""
}l=this._parts.hostname.length-this.domain().length;
l=this._parts.hostname.substring(0,l);
l=new RegExp("^"+N(l));
e&&"."!==e.charAt(e.length-1)&&(e+=".");
e&&U.ensureValidHostname(e);
this._parts.hostname=this._parts.hostname.replace(l,e);
this.build(!d);
return this
};
V.domain=function(e,d){if(this._parts.urn){return void 0===e?"":this
}"boolean"===typeof e&&(d=e,e=void 0);
if(void 0===e){if(!this._parts.hostname||this.is("IP")){return""
}var l=this._parts.hostname.match(/\./g);
if(l&&2>l.length){return this._parts.hostname
}l=this._parts.hostname.length-this.tld(d).length-1;
l=this._parts.hostname.lastIndexOf(".",l-1)+1;
return this._parts.hostname.substring(l)||""
}if(!e){throw new TypeError("cannot set domain empty")
}U.ensureValidHostname(e);
!this._parts.hostname||this.is("IP")?this._parts.hostname=e:(l=new RegExp(N(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(l,e));
this.build(!d);
return this
};
V.tld=function(e,d){if(this._parts.urn){return void 0===e?"":this
}"boolean"===typeof e&&(d=e,e=void 0);
if(void 0===e){if(!this._parts.hostname||this.is("IP")){return""
}var l=this._parts.hostname.lastIndexOf("."),l=this._parts.hostname.substring(l+1);
return !0!==d&&K&&K.list[l.toLowerCase()]?K.get(this._parts.hostname)||l:l
}if(e){if(e.match(/[^a-zA-Z0-9-]/)){if(K&&K.is(e)){l=new RegExp(N(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(l,e)
}else{throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]')
}}else{if(!this._parts.hostname||this.is("IP")){throw new ReferenceError("cannot set TLD on non-domain host")
}l=new RegExp(N(this.tld())+"$");
this._parts.hostname=this._parts.hostname.replace(l,e)
}}else{throw new TypeError("cannot set TLD empty")
}this.build(!d);
return this
};
V.directory=function(e,d){if(this._parts.urn){return void 0===e?"":this
}if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname){return""
}if("/"===this._parts.path){return"/"
}var l=this._parts.path.length-this.filename().length-1,l=this._parts.path.substring(0,l)||(this._parts.hostname?"/":"");
return e?U.decodePath(l):l
}l=this._parts.path.length-this.filename().length;
l=this._parts.path.substring(0,l);
l=new RegExp("^"+N(l));
this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e));
e&&"/"!==e.charAt(e.length-1)&&(e+="/");
e=U.recodePath(e);
this._parts.path=this._parts.path.replace(l,e);
this.build(!d);
return this
};
V.filename=function(e,d){if(this._parts.urn){return void 0===e?"":this
}if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path){return""
}var m=this._parts.path.lastIndexOf("/"),m=this._parts.path.substring(m+1);
return e?U.decodePathSegment(m):m
}m=!1;
"/"===e.charAt(0)&&(e=e.substring(1));
e.match(/\.?\//)&&(m=!0);
var l=new RegExp(N(this.filename())+"$");
e=U.recodePath(e);
this._parts.path=this._parts.path.replace(l,e);
m?this.normalizePath(d):this.build(!d);
return this
};
V.suffix=function(e,d){if(this._parts.urn){return void 0===e?"":this
}if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path){return""
}var m=this.filename(),l=m.lastIndexOf(".");
if(-1===l){return""
}m=m.substring(l+1);
m=/^[a-z0-9%]+$/i.test(m)?m:"";
return e?U.decodePathSegment(m):m
}"."===e.charAt(0)&&(e=e.substring(1));
if(m=this.suffix()){l=e?new RegExp(N(m)+"$"):new RegExp(N("."+m)+"$")
}else{if(!e){return this
}this._parts.path+="."+U.recodePath(e)
}l&&(e=U.recodePath(e),this._parts.path=this._parts.path.replace(l,e));
this.build(!d);
return this
};
V.segment=function(m,l,u){var r=this._parts.urn?":":"/",t=this.path(),q="/"===t.substring(0,1),t=t.split(r);
void 0!==m&&"number"!==typeof m&&(u=l,l=m,m=void 0);
if(void 0!==m&&"number"!==typeof m){throw Error('Bad segment "'+m+'", must be 0-based integer')
}q&&t.shift();
0>m&&(m=Math.max(t.length+m,0));
if(void 0===l){return void 0===m?t:t[m]
}if(null===m||void 0===t[m]){if(T(l)){t=[];
m=0;
for(var p=l.length;
m<p;
m++){if(l[m].length||t.length&&t[t.length-1].length){t.length&&!t[t.length-1].length&&t.pop(),t.push(l[m])
}}}else{if(l||"string"===typeof l){""===t[t.length-1]?t[t.length-1]=l:t.push(l)
}}}else{l?t[m]=l:t.splice(m,1)
}q&&t.unshift("");
return this.path(t.join(r),u)
};
V.segmentCoded=function(l,e,q){var p,m;
"number"!==typeof l&&(q=e,e=l,l=void 0);
if(void 0===e){l=this.segment(l,e,q);
if(T(l)){for(p=0,m=l.length;
p<m;
p++){l[p]=U.decode(l[p])
}}else{l=void 0!==l?U.decode(l):void 0
}return l
}if(T(e)){for(p=0,m=e.length;
p<m;
p++){e[p]=U.decode(e[p])
}}else{e="string"===typeof e||e instanceof String?U.encode(e):e
}return this.segment(l,e,q)
};
var b=V.query;
V.query=function(l,e){if(!0===l){return U.parseQuery(this._parts.query,this._parts.escapeQuerySpace)
}if("function"===typeof l){var p=U.parseQuery(this._parts.query,this._parts.escapeQuerySpace),m=l.call(this,p);
this._parts.query=U.buildQuery(m||p,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);
this.build(!e);
return this
}return void 0!==l&&"string"!==typeof l?(this._parts.query=U.buildQuery(l,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this):b.call(this,l,e)
};
V.setQuery=function(l,e,q){var p=U.parseQuery(this._parts.query,this._parts.escapeQuerySpace);
if("string"===typeof l||l instanceof String){p[l]=void 0!==e?e:null
}else{if("object"===typeof l){for(var m in l){P.call(l,m)&&(p[m]=l[m])
}}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")
}}this._parts.query=U.buildQuery(p,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);
"string"!==typeof l&&(q=e);
this.build(!q);
return this
};
V.addQuery=function(l,e,p){var m=U.parseQuery(this._parts.query,this._parts.escapeQuerySpace);
U.addQuery(m,l,void 0===e?null:e);
this._parts.query=U.buildQuery(m,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);
"string"!==typeof l&&(p=e);
this.build(!p);
return this
};
V.removeQuery=function(l,e,p){var m=U.parseQuery(this._parts.query,this._parts.escapeQuerySpace);
U.removeQuery(m,l,e);
this._parts.query=U.buildQuery(m,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);
"string"!==typeof l&&(p=e);
this.build(!p);
return this
};
V.hasQuery=function(l,e,p){var m=U.parseQuery(this._parts.query,this._parts.escapeQuerySpace);
return U.hasQuery(m,l,e,p)
};
V.setSearch=V.setQuery;
V.addSearch=V.addQuery;
V.removeSearch=V.removeQuery;
V.hasSearch=V.hasQuery;
V.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()
};
V.normalizeProtocol=function(d){"string"===typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d));
return this
};
V.normalizeHostname=function(d){this._parts.hostname&&(this.is("IDN")&&R?this._parts.hostname=R.toASCII(this._parts.hostname):this.is("IPv6")&&o&&(this._parts.hostname=o.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d));
return this
};
V.normalizePort=function(d){"string"===typeof this._parts.protocol&&this._parts.port===U.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d));
return this
};
V.normalizePath=function(l){if(this._parts.urn||!this._parts.path||"/"===this._parts.path){return this
}var e,r=this._parts.path,q="",m,p;
"/"!==r.charAt(0)&&(e=!0,r="/"+r);
r=r.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");
e&&(q=r.substring(1).match(/^(\.\.\/)+/)||"")&&(q=q[0]);
for(;
;
){m=r.indexOf("/..");
if(-1===m){break
}else{if(0===m){r=r.substring(3);
continue
}}p=r.substring(0,m).lastIndexOf("/");
-1===p&&(p=m);
r=r.substring(0,p)+r.substring(m+3)
}e&&this.is("relative")&&(r=q+r.substring(1));
r=U.recodePath(r);
this._parts.path=r;
this.build(!l);
return this
};
V.normalizePathname=V.normalizePath;
V.normalizeQuery=function(d){"string"===typeof this._parts.query&&(this._parts.query.length?this.query(U.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!d));
return this
};
V.normalizeFragment=function(d){this._parts.fragment||(this._parts.fragment=null,this.build(!d));
return this
};
V.normalizeSearch=V.normalizeQuery;
V.normalizeHash=V.normalizeFragment;
V.iso8859=function(){var e=U.encode,d=U.decode;
U.encode=escape;
U.decode=decodeURIComponent;
this.normalize();
U.encode=e;
U.decode=d;
return this
};
V.unicode=function(){var e=U.encode,d=U.decode;
U.encode=c;
U.decode=unescape;
this.normalize();
U.encode=e;
U.decode=d;
return this
};
V.readable=function(){var l=this.clone();
l.username("").password("").normalize();
var e="";
l._parts.protocol&&(e+=l._parts.protocol+"://");
l._parts.hostname&&(l.is("punycode")&&R?(e+=R.toUnicode(l._parts.hostname),l._parts.port&&(e+=":"+l._parts.port)):e+=l.host());
l._parts.hostname&&l._parts.path&&"/"!==l._parts.path.charAt(0)&&(e+="/");
e+=l.path(!0);
if(l._parts.query){for(var t="",r=0,p=l._parts.query.split("&"),q=p.length;
r<q;
r++){var m=(p[r]||"").split("="),t=t+("&"+U.decodeQuery(m[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"));
void 0!==m[1]&&(t+="="+U.decodeQuery(m[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))
}e+="?"+t.substring(1)
}return e+=U.decodeQuery(l.hash(),!0)
};
V.absoluteTo=function(l){var e=this.clone(),q=["protocol","username","password","hostname","port"],p,m;
if(this._parts.urn){throw Error("URNs do not have any generally defined hierarchical components")
}l instanceof U||(l=new U(l));
e._parts.protocol||(e._parts.protocol=l._parts.protocol);
if(this._parts.hostname){return e
}for(p=0;
m=q[p];
p++){e._parts[m]=l._parts[m]
}e._parts.path?".."===e._parts.path.substring(-2)&&(e._parts.path+="/"):(e._parts.path=l._parts.path,e._parts.query||(e._parts.query=l._parts.query));
"/"!==e.path().charAt(0)&&(l=l.directory(),e._parts.path=(l?l+"/":"")+e._parts.path,e.normalizePath());
e.build();
return e
};
V.relativeTo=function(l){var e=this.clone().normalize(),r,q,m,p;
if(e._parts.urn){throw Error("URNs do not have any generally defined hierarchical components")
}l=(new U(l)).normalize();
r=e._parts;
q=l._parts;
m=e.path();
p=l.path();
if("/"!==m.charAt(0)){throw Error("URI is already relative")
}if("/"!==p.charAt(0)){throw Error("Cannot calculate a URI relative to another relative URI")
}r.protocol===q.protocol&&(r.protocol=null);
if(r.username===q.username&&r.password===q.password&&null===r.protocol&&null===r.username&&null===r.password&&r.hostname===q.hostname&&r.port===q.port){r.hostname=null,r.port=null
}else{return e.build()
}if(m===p){return r.path="",e.build()
}l=U.commonPath(e.path(),l.path());
if(!l){return e.build()
}q=q.path.substring(l.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");
r.path=q+r.path.substring(l.length);
return e.build()
};
V.equals=function(l){var e=this.clone();
l=new U(l);
var r={},q={},m={},p;
e.normalize();
l.normalize();
if(e.toString()===l.toString()){return !0
}r=e.query();
q=l.query();
e.query("");
l.query("");
if(e.toString()!==l.toString()||r.length!==q.length){return !1
}r=U.parseQuery(r,this._parts.escapeQuerySpace);
q=U.parseQuery(q,this._parts.escapeQuerySpace);
for(p in r){if(P.call(r,p)){if(!T(r[p])){if(r[p]!==q[p]){return !1
}}else{if(!Q(r[p],q[p])){return !1
}}m[p]=!0
}}for(p in q){if(P.call(q,p)&&!m[p]){return !1
}}return !0
};
V.duplicateQueryParameters=function(d){this._parts.duplicateQueryParameters=!!d;
return this
};
V.escapeQuerySpace=function(d){this._parts.escapeQuerySpace=!!d;
return this
};
return U
});
Handlebars.registerHelper("checkOfferToShow",function(b,a){if(!b.isDefault){return a.fn(this)
}if(b.isDefault===true&&b.included===true){return a.fn(this)
}return a.inverse(this)
});
Handlebars.registerHelper("getReportMetricHelpText",function(a){return Granite.I18n.get("Values represent the mean {0} for each offer and standard deviation.",ELM.ReportMetrics[a])
});
Handlebars.registerHelper("appendck",function(a){if(!_.isString(a)){throw new Error("Handlebars#appendck expects string as image source.")
}return a+"?ch_ck="+moment().unix()
});
Handlebars.registerHelper("subtract",function(a,b){if(arguments.length<3){throw new Error("Handlebars#subtract needs 2 parameters")
}return parseFloat(a)-parseFloat(b)
});
Handlebars.registerHelper("divide",function(a,b){if(arguments.length<3){throw new Error("Handlebars#divide needs 2 parameters")
}return parseFloat(a)/parseFloat(b)
});
Handlebars.registerHelper("equals",function(a,c,b){if(arguments.length<3){throw new Error("Handlebars#equals needs 2 parameters")
}if(a!=c){return b.inverse(this)
}return b.fn(this)
});
Handlebars.registerHelper("and",function(b,a,c){if(arguments.length<3){throw new Error("Handlebars#and needs 2 parameters")
}if(b&&a){return c.fn(this)
}return c.inverse(this)
});
Handlebars.registerHelper("gt",function(a,c,b){if(arguments.length<3){throw new Error("Handlebars#gt needs 2 parameters")
}if(a>c){return b.fn(this)
}return b.inverse(this)
});
Handlebars.registerHelper("lt",function(a,c,b){if(arguments.length<3){throw new Error("Handlebars#lt needs 2 parameters")
}if(a<c){return b.fn(this)
}return b.inverse(this)
});
Handlebars.registerHelper("gte",function(a,c,b){if(arguments.length<3){throw new Error("Handlebars#gte needs 2 parameters")
}if(a>=c){return b.fn(this)
}return b.inverse(this)
});
Handlebars.registerHelper("lte",function(a,c,b){if(arguments.length<3){throw new Error("Handlebars#lte needs 2 parameters")
}if(a<=c){return b.fn(this)
}return b.inverse(this)
});
Handlebars.registerHelper("inRange",function(c,a,d,b){if(arguments.length<4){throw new Error("Handlebars#inRange needs 3 parameters")
}if(parseFloat(a)<=c&&c<=parseFloat(d)){return b.fn(this)
}return b.inverse(this)
});
Handlebars.registerHelper("notInRange",function(c,a,d,b){if(arguments.length<4){throw new Error("Handlebars#notInRange needs 3 parameters")
}if(c<parseFloat(a)||c>parseFloat(d)){return b.fn(this)
}return b.inverse(this)
});
Handlebars.registerHelper("eachString",function(c,b,a){if(arguments.length<3){throw new Error("Handlebars#eachString needs 2 parameters.")
}if(typeof c==="string"){return Handlebars.helpers.each.call(this,c.split(b),a)
}});
Handlebars.registerHelper("number",function(e,g){var a=Granite.I18n.getLocale(),d=",",f=["de","es","fr","it","pt"],b=["de","es","it","pt"],c=["fr"];
if(e.fn&&typeof e.fn==="function"){e=e.fn(this)
}if(_.isNumber(e)&&_.isNumber(g)){e=e.toFixed(g)
}if(b.indexOf(a)!=-1){d="."
}else{if(c.indexOf(a)!=-1){d=" "
}}e=e.toString();
if(f.indexOf(a)!=-1){e=e.split(".").join(",")
}while(/(\d+)(\d{3})/.test(e)){e=e.replace(/(\d+)(\d{3})/,"$1"+d+"$2")
}return e||"---"
});
Handlebars.registerHelper("formatPercent",function(b,a){var c=a.hash.fixed||2;
return(b*100).toFixed(c)+"%"
});
Handlebars.registerHelper("getDate",function(e,b){var c=b.hash.format,d=b.hash.comment,a=Granite.I18n.get("YYYY-MM-DD",null,"Date format pattern for moment.js. e.g. 2013-11-13 (http://momentjs.com/docs)");
if(c){a=Granite.I18n.getVar(c,d)
}if(!e){return moment().format(a)
}return moment(e).format(a)
});
Handlebars.registerHelper("getTime",function(e,a){var b=a.hash.format,d=a.hash.comment,c=Granite.I18n.get("HH:mm",null,"Time format pattern for moment.js. e.g. 12:48 (http://momentjs.com/docs)");
if(b){c=Granite.I18n.getVar(b,d)
}if(!e){return moment().format(c)
}return moment(e).format(c)
});
Handlebars.registerHelper("getActivityPriority",function(a){if(a===0){return Granite.I18n.get("Low")
}if(a===1){return Granite.I18n.get("Medium")
}if(a===2){return Granite.I18n.get("High")
}return a
});
Handlebars.registerHelper("toCapitalCase",function(a){if(a&&typeof a==="string"){return a.substring(0,1).toUpperCase()+a.substring(1).toLowerCase()
}return""
});
Handlebars.registerHelper("toLowerCase",function(a){if(a&&typeof a==="string"){return a.toLowerCase()
}return""
});
Handlebars.registerHelper("toUpperCase",function(a){if(a&&typeof a==="string"){return a.toUpperCase()
}return""
});
Handlebars.registerHelper("getDays",function(a){if(a&&typeof a==="number"){return Granite.I18n.get("{0} {1}",[a,"day(s)"])
}return""
});
Handlebars.registerHelper("i18n",function(){var e=Array.prototype.slice.call(arguments,0);
var a=e.pop();
var c=Array.prototype.shift.call(e);
var b=[c];
if(typeof a.fn==="function"){e=[a.fn(this)]
}b.push(e);
if(typeof a.hash.comment==="string"){b.push(a.hash.comment)
}var d=Granite.I18n.get.apply(this,b)||"";
if(a.hash.html){return new Handlebars.SafeString(d)
}return d
});
Handlebars.registerHelper("notEquals",function(a,c,b){if(arguments.length<3){throw new Error("Handlebars#notEquals needs 2 parameters")
}if(a==c){return b.inverse(this)
}return b.fn(this)
});
Handlebars.registerHelper("each_with_index",function(g,d){var a="",f=g.length;
for(var c=0,b=f;
c<b;
c++){var e=g[c];
e.index=c;
a+=(typeof(d)=="object")?d.fn(e):d(e)
}return a
});
Handlebars.registerHelper("each_reverse",function(d,b){var f,a="",e,c;
if(d instanceof Array){if(b.data){e=Handlebars.createFrame(b.data)
}f=d.length;
for(c=f-1;
c>=0;
c--){if(e){e.index=f-c-1;
e.reverseIndex=c
}a+=b.fn(d[c],{data:e})
}}if(f){return a
}return b.inverse(this)
});
Handlebars.registerHelper("getIconById",function(b){if(b&&b.lastIndexOf("/")>-1){b=b.substring(b.lastIndexOf("/")+1)
}var a={firefox:"icon-devicemobile",internet_explorer:"icon-devicemobile",chrome:"icon-devicemobile",safari:"icon-devicemobile",windows:"icon-windows8",mac:"icon-apple",linux:"icon-linux",mobile:"icon-devicemobile",tablet:"icon-devicetablet",desktop:"icon-devicedesktop",google:"icon-merge",bing:"icon-merge",yahoo:"icon-merge",returning_visitors:"icon-users",new_visitors:"icon-users",all_visitors:"icon-demographic",us_returning_male:"icon-demographic",us_female:"icon-demographic"};
if(a.hasOwnProperty(b)){return a[b]
}return"icon-users"
});
Handlebars.registerHelper("getValueFromObj",function(d,c,a){if(arguments.length<2){throw new Error("Handlebars#getValueFromObj needs 2 parameters")
}d=d||{};
var b=d[c];
if(typeof a.fn==="function"){return(_.isUndefined(b)||_.isNull(b)||_.isNaN(b))?a.inverse({}):a.fn(b)
}return b||"---"
});
Handlebars.registerHelper("hasValue",function(c,b,a){if(arguments.length<3){throw new Error("Handlebars#hasValue needs 2 parameters")
}if(c&&c.indexOf(b)!=-1){return a.fn(this)
}return a.inverse(this)
});
Handlebars.registerHelper("buildMetricsMeasurementDisplayRule",function(d,f){if(arguments.length<2){throw new Error("Handlebars#buildMetricsMeasurementDisplayRule needs 2 parameters")
}if(d==="elementClick"){return Granite.I18n.get("Clicked an element")
}if(d==="clickRecommendation"){return Granite.I18n.get("Clicked on recommendation")
}var b=Granite.I18n.get("or"),e=f.length,a="";
for(var c=0;
c<e;
c++){if(c){a+=(" "+b+" ")
}a+=f[c].term
}if(d==="pageView"){return Granite.I18n.get("Viewing of page {0}",_.escape(a))
}else{if(d==="mboxView"){return Granite.I18n.get("Viewing of mbox {0}",_.escape(a))
}}});
Handlebars.registerHelper("isActivityUpdating",function(b,d,c){if(arguments.length<2){throw new Error("Handlebars#isActivityUpdating needs 2 parameters")
}var a=[ELM.Activities.status.SYNCING,ELM.Activities.status.ACTIVATING,ELM.Activities.status.DEACTIVATING];
if(d||_.contains(a,b)){return c.fn(this)
}return c.inverse(this)
});
Handlebars.registerHelper("activitySyncFailed",function(a,b){if(arguments.length<1){throw new Error("Handlebars#activitySyncFailed needs 1 parameter")
}if(a.targetSyncFailed&&!a.targetSyncPending){return b.fn(this)
}return b.inverse(this)
});
Handlebars.registerHelper("join",function(b,a){if(arguments.length<2){throw new Error("Handlebars#join needs 1 or 2 parameters.")
}if(typeof a!=="string"){a=", "
}if(_.isArray(b)){return b.join(a).replace(/(\\r\\n|\\n|\\r)/g,"\n")
}return""
});
Handlebars.registerHelper("in",function(c){var d=arguments.length,a;
if(d<3){throw new Error("Handlebars#in needs at least 2 parameters.")
}a=arguments[d-1];
for(var b=1;
b<d-1;
b++){if(c===arguments[b]){return a.fn(this)
}}return a.inverse(this)
});
Handlebars.registerHelper("notIn",function(c){var d=arguments.length,a;
if(d<3){throw new Error("Handlebars#notIn needs at least 2 parameters.")
}a=arguments[d-1];
for(var b=1;
b<d-1;
b++){if(c===arguments[b]){return a.inverse(this)
}}return a.fn(this)
});
Handlebars.registerHelper("formatEstimatedValue",function(c,e){if(_.isNumber(c)){var d=1000000,a=1000,b=Handlebars.helpers.getCurrencySymbol.call(this);
if(c/d>1){c=c/d;
c=Handlebars.helpers.number.call(this,c,e);
c=Granite.I18n.get("{0}{1}M",[b,c],"{0} argument is currency symbol, {1} argument is number and M is symbol for millions")
}else{if(c/a>1){c=c/a;
c=Handlebars.helpers.number.call(this,c,e);
c=Granite.I18n.get("{0}{1}K",[b,c],"{0} argument is currency symbol, {1} argument is number and K is symbol for thousands")
}else{c=Granite.I18n.get("<{0}1K",b,"Estimated lift is less than one thousand. {0} argument is currency symbol")
}}}return c||"---"
});
Handlebars.registerHelper("formatRevenue",function(i){if(_.isNumber(i)){var j=1000000000000000000,c=1000000000000000,f=1000000000000,k=1000000000,h=1000000,g=10000,d=100000,b=1000;
var e="";
var a=2;
if(i>=d){a=1
}else{a=2
}if(i>=j){i=(i/j);
e="E"
}else{if(i>=c){e="P";
i=(i/c)
}else{if(i>=f){e="T";
i=(i/f)
}else{if(i>=k){e="B";
i=(i/k)
}else{if(i>=h){e="M";
i=(i/h)
}else{if(i>=g){e="K";
i=(i/b)
}}}}}}i=Handlebars.helpers.RoundNumber.call(null,i,a);
return i+e
}return i
});
Handlebars.registerHelper("RoundNumber",function(b,a){if(_.isNumber(b)){b=+(Math.round(b+"e+"+a)+"e-"+a)
}return b
});
Handlebars.registerHelper("getCurrencySymbol",function(){return ELM.CurrencySymbol[ELM.clientLocale]||"$"
});
Handlebars.registerHelper("getActivityDisplayType",function(b,a){if(arguments.length<1){throw new Error("Handlebars#getActivityDisplayType needs at least 1 parameter")
}if(a==="short"){return ELM.Activities.activityDisplayTypes[b].shortText
}return ELM.Activities.activityDisplayTypes[b].longText
});
Handlebars.registerHelper("ifEither",function(e,a,b,d,c){if(e===a||b===d){return c.fn(this)
}return c.inverse(this)
});
Handlebars.registerHelper("ifNeither",function(e,a,b,d,c){if(e!==a&&b!==d){return c.fn(this)
}return c.inverse(this)
});
Handlebars.registerHelper("ifNotAfter",function(c,a,b){if(arguments.length<2){throw new Error("Handlebars#ifNotAfter needs 2 parameters")
}if((c-a)<=1){return b.fn(this)
}return b.inverse(this)
});
Handlebars.registerHelper("ifNotBefore",function(a,b){if(arguments.length<1){throw new Error("Handlebars#ifNotBefore needs 1 parameters")
}if(a<1){return b.fn(this)
}return b.inverse(this)
});
Handlebars.registerHelper("getTemplateTestingCriteriaParameter",function(d,a,c){if(arguments.length<2){throw new Error("Handlebars#getTemplateTestingCriteriaParameter needs 2 parameters.")
}var b;
if(a==="MBOX"){return"mBox Parameter "+d
}else{if(typeof d==="string"){b=d.substring(d.lastIndexOf(".")+1);
if(typeof c==="string"&&c){b=b+" parameter "+c
}return b
}}});
Handlebars.registerHelper("getTemplateTestingCriteriaOperator",function(a){if(arguments.length<1){throw new Error("Handlebars#getTemplateTestingCriteriaOperator needs 1 parameter.")
}var b={containsIgnoreCase:Granite.I18n.get("contains"),doesNotContainIgnoreCase:Granite.I18n.get("does not contain"),equals:Granite.I18n.get("is (case sensitive)"),doesNotEqualIgnoreCase:Granite.I18n.get("is not")};
if(b.hasOwnProperty(a)){return b[a]
}return a
});
Handlebars.registerHelper("getExperiencesCount",function(c){var e=1,d,f;
if(arguments.length<1){throw new Error("Handlebars#getExperiencesCount needs 1 parameter.")
}var a=c.locations,b=c.exclusions;
if(c.activityType==="MVT"){return c.experiences.length-b
}_.each(a,function(g){d=g.offers;
f=d.length;
if(d&&f){if(d[0]["included"]){e*=f
}else{e*=f-1
}}});
return e-(b.length/a.length)
});
Handlebars.registerHelper("add",function(a,b){if(arguments.length<3){throw new Error("Handlebars#add needs 2 parameters")
}return parseFloat(a)+parseFloat(b)
});
Handlebars.registerHelper("getControlExperienceType",function(a){if(arguments.length<1){throw new Error("Handlebars#getControlExperienceType needs 1 parameter.")
}var b={random:Granite.I18n.get("Random Experiences"),default_content:Granite.I18n.get("Default Experience"),custom:Granite.I18n.get("Selected Experience")};
return b[a]
});
Handlebars.registerHelper("getOneToOneOffer",function(a,c,b){if(arguments.length<3){throw new Error("Handlebars#getOneToOneOffer needs 3 parameters.")
}return a[c].offers[b]["jcr:title"]
});
Handlebars.registerHelper("getOneToOneLocation",function(a,b){if(arguments.length<2){throw new Error("Handlebars#getOneToOneLocation needs 2 parameters.")
}return a[b]["jcr:title"]
});
Handlebars.registerHelper("getOneToOneOffer",function(a,c,b){if(arguments.length<3){throw new Error("Handlebars#getOneToOneOffer needs 3 parameters.")
}return a[c].offers[b]["jcr:title"]
});
Handlebars.registerHelper("getOneToOneAlgorithmPercentage",function(c,d,e){var b=100-c,a;
if(arguments.length<2){throw new Error("Handlebars#getOneToOneAlgorithmPercentage needs 2 parameters.")
}a=Math.floor(b/d);
if(e===d-1){a=b-(d-1)*a
}return a
});
Handlebars.registerHelper("getItemTitleFromList",function(d,b,e,a){var c;
if(arguments.length<3){throw new Error("Handlebars#getItemTitleFromList needs 3 parameters.")
}c=_.filter(d,function(f){return f[b]===e
})[0];
return c&&c["jcr:title"]||a||""
});
Handlebars.registerHelper("getValue",function(){var a,b=window;
if(arguments.length<2){throw new Error("Handlebars#getValue needs at least 1 parameter.")
}a=Array.prototype.slice.call(arguments,0,arguments.length-1);
a=a.join(".").split(".");
_.each(a,function(c){b=b&&b[c]
});
return b
});
Handlebars.registerHelper("ifAllEqual",function(){var e=Array.prototype.slice.call(arguments,0),b=e.pop(),c=e.length,d=false,a;
if(c%2!=0){throw new Error("Handlebars#ifAllEqual needs even number of arguments")
}for(a=0;
a<c;
a+=2){if(e[a]===e[a+1]){d=true
}else{d=false;
break
}}if(d){return b.fn(this)
}return b.inverse(this)
});
Handlebars.registerHelper("confidenceIcon",function(a){var b;
if(a>=0&&a<60){b="icon-confidenceone"
}else{if(a>=60&&a<75){b="icon-confidencetwo"
}else{if(a>=75&&a<90){b="icon-confidencethree"
}else{if(a>=90&&a<=100){b="icon-confidencefour"
}else{return""
}}}}return b
});
Handlebars.registerHelper("getOSValue",function(b){var a={osAndroid:"Android",osOsx:"iOS",osWindows:"Windows",osLinux:"Linux",osProprietary:"Proprietary",osSymbian:"Symbian",osRim:"Blackberry"};
return Granite.I18n.get(a[b]||"")
});
Handlebars.registerHelper("getStringWithLineBreaks",function(a){var b=Handlebars.Utils.escapeExpression(a);
return new Handlebars.SafeString(b.replace(/\r?\n/g,"<br>"))
});
Handlebars.registerHelper("isBrowser",function(c,a){var b;
switch(c){case"IE":b=ELM.BrowserDetector.isIE();
break;
case"FIREFOX":b=ELM.BrowserDetector.isFirefox();
break;
case"CHROME":b=ELM.BrowserDetector.isChrome();
break;
default:throw new Error("Handlebars#isBrowser Invalid browser string:"+c)
}if(b){return a.fn(this)
}else{return a.inverse(this)
}});
Handlebars.registerHelper("readGlobalVar",function(b,d){if(arguments.length<1){throw new Error("Handlebars#readGlobalVar needs atleast 1 parameter.")
}var f=b.split("."),a=window[f[0]],e=f.length,c=1;
while(c<e){if(a){a=a[f[c]]
}else{throw new Error("Data does not exist in global object")
}c++
}if(typeof d==="string"){return a[d]||""
}return a
});
Handlebars.registerHelper("ifGlobalVar",function(b,d,c){if(arguments.length<2){throw new Error("Handlebars#ifGlobalVar needs atleast 1 parameter.")
}var a=Handlebars.helpers.readGlobalVar.call(this,b);
if(typeof d==="object"){c=d;
d=undefined
}if((d===undefined&&a)||(d!==undefined&&a===d)){return c.fn(this)
}else{return c.inverse(this)
}});
Handlebars.registerHelper("getRecTrafficSplitPercentage",function(e,f,a,d){var g=a,c=100-e,b;
if(f>=a){g=f
}b=(c/g).toFixed(1);
return d>0?b:(c-(parseFloat(b)*(g-1))).toFixed(1)
});
Handlebars.registerHelper("notAllAlgorithmsBasedOnRecentlyViewed",function(c,b){if(arguments.length<2){throw new Error("Handlebars#notAllAlgorithmsBasedOnRecentlyViewed needs at least 1 parameters.")
}if(c.length===0){return b.fn(this)
}for(var a=0;
a<c.length;
a++){if(c[a].configuration.type!=="recentlyViewed"){return b.fn(this)
}}return b.inverse(this)
});
Handlebars.registerHelper("getAlgorithmRuleSummary",function(h){var b=h.operation,f=h.attribute,d="",a,e;
if(b!=="dynamicallyMatches"&&b!=="dynamicallyDoesNotMatch"){if(b==="dynamicallyRanges"){d=h.lowRange+"-"+h.highRange+"%"
}else{a=h.values;
e=a.length;
for(var c=0;
c<e;
c++){if(c){d+=", "
}d+=("'"+a[c]+"'")
}}}var g={dynamicallyMatches:Granite.I18n.get("Same {0}",f),dynamicallyDoesNotMatch:Granite.I18n.get("Other {0}",f),dynamicallyRanges:Granite.I18n.get("{0} within {1}",[f,d]),contains:Granite.I18n.get("{0} contains {1}",[f,d]),doesNotContain:Granite.I18n.get("{0} does not contain {1}",[f,d]),equals:Granite.I18n.get("{0} equals {1}",[f,d]),notEquals:Granite.I18n.get("{0} does not equal {1}",[f,d]),greaterOrEquals:Granite.I18n.get("{0} is greater than or equal to {1}",[f,d]),lesserOrEquals:Granite.I18n.get("{0} is less than or equal to {1}",[f,d]),startsWith:Granite.I18n.get("{0} starts with {1}",[f,d]),endsWith:Granite.I18n.get("{0} ends with {1}",[f,d])};
if(g.hasOwnProperty(b)){return g[b]
}return""
});
Handlebars.registerHelper("getPriceOptionSummary",function(d,c,a){if(arguments.length<3){throw new Error("Handlebars#getPriceOptionSummary needs 3 parameters.")
}var b=Handlebars.helpers.getCurrencySymbol.call(this);
c=c||"";
a=a||"";
var e={aboveValue:Granite.I18n.get("Higher Price"),belowValue:Granite.I18n.get("Lower Price"),withinRange:Granite.I18n.get("Price range within {0}{1} - {2}{3}",[b,c,b,a],"E.g. Price range within $20-$40"),withinPercentages:Granite.I18n.get("Price range within {0}-{1}%",[c,a],"E.g. Price range withi, 10-30%")};
if(e.hasOwnProperty(d)){return e[d]
}return""
});
Handlebars.registerHelper("getValueForDaysCount",function(c){var a=ELM.Algorithm.daysCount;
for(var b in a){if(a[b]===c){return b
}}});
Handlebars.registerHelper("getAlgorithmDaysCount",function(b,a){if(a===""){return ELM.Algorithm.daysCountText[b]
}a=a||"mboxes";
var c={oneDay:Granite.I18n.get("1 day of data from {0}",a),twoDays:Granite.I18n.get("2 days of data from {0}",a),oneWeek:Granite.I18n.get("1 week of data from {0}",a),twoWeeks:Granite.I18n.get("2 weeks of data from {0}",a),oneMonth:Granite.I18n.get("1 month of data from {0}",a),twoMonths:Granite.I18n.get("2 months of data from {0}",a)};
if(c.hasOwnProperty(b)){return c[b]
}return""
});
Handlebars.registerHelper("getValueForProductConfidence",function(a){var c=ELM.Algorithm.productConfidence;
for(var b in c){if(c[b]===a){return b
}}});
Handlebars.registerHelper("getAlgorithmBasis",function(a,b,d){var c;
if(!a&&!b){return""
}if(a===ELM.Algorithm.key.CUSTOM_PROFILE_ATTRIBUTE){if(!d){return""
}c=d
}else{if(!a||b==="topMetric"){a=(b==="recentlyViewed")?ELM.Algorithm.key.RECENTLY_VIEWED:ELM.Algorithm.key.POPULARITY
}c=ELM.Algorithm.displayKey[a]
}return Granite.I18n.get("based on {0}",c)
});
Handlebars.registerHelper("getAlgorithmType",function(b,c){var a=ELM.Algorithm.displayType[c];
if(c==="topMetric"){return b
}return a||c
});
Handlebars.registerHelper("getInclusionRuleOperand",function(a,b){if(!b||!a){return""
}if(a===ELM.Algorithm.key.CUSTOM_PROFILE_ATTRIBUTE){a=ELM.Algorithm.key.CURRENT_ITEM
}return Granite.I18n.get("{0}'s {1}",[ELM.Algorithm.displayKey[a],b],"E.g. Current Item's brand")
});
Handlebars.registerHelper("getFeedType",function(a){var b={mbox:Granite.I18n.get("Mboxes"),saint:Granite.I18n.get("Analytics Classifications"),"google-atom-1":Granite.I18n.get("Google Product Feed"),csv:Granite.I18n.get("CSV")};
return b[a]||""
});
Handlebars.registerHelper("getFeedItemsCount",function(c){var b=new RegExp("^[0-9]+/[0-9]+$"),a=c&&c.message;
if(b.test(a)){return a.split("/")[0]
}return"---"
});
Handlebars.registerHelper("getAlgorithmCategory",function(a,b){var c={currentItem:Granite.I18n.get("Current Page Activity"),currentCategory:Granite.I18n.get("Current Page Activity"),customProfileAttribute:Granite.I18n.get("Custom"),lastPurchasedItem:Granite.I18n.get("Past Behavior"),lastViewedItem:Granite.I18n.get("Past Behavior"),mostViewedItem:Granite.I18n.get("Past Behavior"),favoriteCategory:Granite.I18n.get("Past Behavior"),recentlyViewed:Granite.I18n.get("Recently Viewed Items"),popularity:Granite.I18n.get("Popularity"),topSellers:Granite.I18n.get("Popularity"),topViewed:Granite.I18n.get("Popularity"),topMetric:Granite.I18n.get("Popularity")};
return c[a]||c[b]||""
});
Handlebars.registerHelper("getAttributeInfo",function(a,b){return ELM.Recommendation.Util.getProductEntityAttribute(a)[b]||""
});
Handlebars.registerHelper("getIndexingLastCompleteTime",function(a){var b=moment().diff(a,"hours");
if(b){return Granite.I18n.get("Results based on index built {0} hour(s) ago.",b)
}else{return Granite.I18n.get("Results based on index built less than an hour ago.")
}});
Handlebars.registerHelper("getURLUnescapedString",function(a){if(typeof(a)==="string"&&a.match(/%[0-9][0-9]/)){return decodeURIComponent(a)
}return a
});
var ELM=ELM||{};
ELM.Collections=ELM.Collections||{};
ELM.Models=ELM.Models||{};
ELM.Strategy=ELM.Strategy||{};
ELM.mboxes=ELM.mboxes||[];
ELM.SortOrderEnum={ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"};
$(function(){$(".template").each(function(b,f){var e=Handlebars.compile(f.innerHTML);
if($(f).attr("data-partial")!==undefined){var g=$(f).attr("data-partial");
Handlebars.registerPartial(g,f.innerHTML)
}var d=f.id.split(".");
var a=window;
for(var c=0;
c<d.length-1;
c++){if(typeof a[d[c]]==="undefined"){a[d[c]]={}
}a=a[d[c]]
}a[d[c]]=e
})
});
ELM.getResourceId=function(a,b){var d=a.substring(a.lastIndexOf("/")+1);
var c="external_";
if(b){c+=b+"_"
}c+=d.substring(0,d.indexOf("."));
return c
};
ELM.loadCssFile=function(a){var c=ELM.getResourceId(a,"css");
if(document.getElementById(c)){return
}var b=document.createElement("link");
b.setAttribute("id",c);
b.setAttribute("rel","stylesheet");
b.setAttribute("type","text/css");
b.setAttribute("href",a);
document.getElementsByTagName("head")[0].appendChild(b)
};
ELM.loadJsFile=function(b){var c=ELM.getResourceId(b,"js");
if(document.getElementById(c)){return
}var a=document.createElement("script");
a.setAttribute("type","text/javascript");
a.setAttribute("src",b);
document.getElementsByTagName("head")[0].appendChild(a)
};
$.ajaxSetup({cache:false});
"use strict";
ELM.Model=Backbone.Model.extend({url:function(){if(this.isNew()){return ELM.baseURI+"/"+this.urlRoot+"."+ELM.bullseyeSelector+".json"
}return ELM.baseURI+"/"+this.urlRoot+"/"+this.id+"."+ELM.bullseyeSelector+".json"
},silentSet:function(c,b,a){var d={silent:true};
if(a){_.extend(d,a)
}this.set(c,b,d)
},urlRoot:""});
ELM.Collection=Backbone.Collection.extend({url:function(a){if(!a||typeof a!=="string"){a=""
}return ELM.baseURI+"/"+this.urlRoot+"."+ELM.bullseyeSelector+a+".json"
},bulkUrl:function(){return this.url(".bulk")
},actionsUrl:function(){return ELM.baseURI+"/"+this.urlRoot+".action."+ELM.bullseyeSelector+".json"
},parse:function(a){return a.items
},urlRoot:""});
$(document).ready(function(){CUI.Datepicker.monthNames=[Granite.I18n.get("January"),Granite.I18n.get("February"),Granite.I18n.get("March"),Granite.I18n.get("April"),Granite.I18n.get("May"),Granite.I18n.get("June"),Granite.I18n.get("July"),Granite.I18n.get("August"),Granite.I18n.get("September"),Granite.I18n.get("October"),Granite.I18n.get("November"),Granite.I18n.get("December")];
CUI.Datepicker.dayNames=[Granite.I18n.get("Su"),Granite.I18n.get("Mo"),Granite.I18n.get("Tu"),Granite.I18n.get("We"),Granite.I18n.get("Th"),Granite.I18n.get("Fr"),Granite.I18n.get("Sa")]
});
"use strict";
ELM.Models.ReportModel=ELM.Model.extend({onFetch:function(a){this.fetch(a)
},getReportSuite:function(){return this.get("reportSuite")
},getActivityType:function(){return this.get("activityType")
},isBestWorstFilterEnabled:function(){return this.get("isBestWorstFilterEnabled")
}});
"use strict";
ELM.Models.GenericActivity=ELM.Model.extend({setTitle:function(a){this.set("jcr:title",a)
},getTitle:function(){return this.get("jcr:title")
},setDescription:function(a){this.set("jcr:description",a)
},getDescription:function(){return this.get("jcr:description")
},setNotes:function(a){this.set("notes",a,{silent:true})
},getNotes:function(){return this.get("notes")
}});
"use strict";
ELM.Models.Activity=ELM.Models.GenericActivity.extend({urlRoot:"activities",DATE_WHEN_APPROVED:"WHEN_APPROVED",DATE_WHEN_DEACTIVATED:"WHEN_DEACTIVATED",setTitle:function(a){this.set("jcr:title",a,{validate:true})
},getTitleOrDefault:function(){return this.getTitle()||Granite.I18n.get("Untitled Activity")
},getId:function(){return this.get("id")
},setId:function(a){this.silentSet("id",a)
},getTargetId:function(){var a=this.get("sync");
return a.root["targetId"]
},getMetrics:function(){return this.get("metrics")
},setMetrics:function(a){this.silentSet("metrics",a)
},getTargets:function(){return this.get("targets")
},setTargets:function(a){this.silentSet("targets",a)
},getTemplates:function(){return this.get("targets")["template"]
},setTemplates:function(b){var a=this.getTargets();
a.template=b;
this.silentSet("targets",a)
},setActivityUrl:function(a){var b=this.getTemplates();
b.activityUrl=a
},getActivityUrl:function(){return this.getTemplates()["activityUrl"]
},getExperiences:function(){return this.get("experiences")
},setExperiences:function(a){this.silentSet("experiences",a)
},addExperience:function(a){var b=this.getExperiences();
b.push(a);
this.setExperiences(b)
},getControlExperienceId:function(){var b=this.getExperiences(),a=this.get("controlExperienceId");
if(_.findWhere(b,{id:a})){return a
}return _.min(_.pluck(b,"id"))
},setcontrolExperienceId:function(a){this.silentSet("controlExperienceId",a)
},setControlExperience:function(a){this.silentSet("controlexperience",a)
},getControlExperience:function(){return this.get("controlexperience")
},getBestOpportunity:function(){return this.get("bestOpportunity")
},setBestOpportunity:function(a){this.set("bestOpportunity",a)
},getThirdPartyId:function(){return this.get("ttThirdPartyId")
},getLastModified:function(){return this.get("jcr:lastModified")
},setPriority:function(a){this.silentSet("priority",parseInt(a))
},setStartDate:function(a){this.silentSet("startDate",a)
},setEndDate:function(a){this.silentSet("endDate",a)
},getStatus:function(){return this.get("status")
},setStatus:function(a){this.set("status",a)
},getSyncMetadata:function(){return this.get("sync")
},getRootSyncMetadata:function(){return this.getSyncMetadata().root
},setSyncStatus:function(a){this.getRootSyncMetadata().targetSyncFailed=a;
return a
},getSyncStatus:function(){return this.getRootSyncMetadata().targetSyncFailed
},setSyncPendingStatus:function(a){this.getRootSyncMetadata().targetSyncPending=a
},getSyncPendingStatus:function(){return this.getRootSyncMetadata().targetSyncPending
},getPrivileges:function(){return this.get("privileges")
},getStartDate:function(){return this.get("startDate")
},getEndDate:function(){return this.get("endDate")
},getActivatedDate:function(){return this.get("activatedDate")
},getDeactivatedDate:function(){return this.get("deactivatedDate")
},getCallToAction:function(){return this.get("callToAction")
},setCallToAction:function(a){this.set("callToAction",a)
},getActivityType:function(){return this.get("activityType")
},setActivityType:function(a){this.silentSet("activityType",a)
},getReportingSolution:function(){return this.get("reportingSolution")
},getReportSuite:function(){return this.get("reportSuite")
},setReportSuite:function(a){this.silentSet("reportSuite",a)
},validate:function(a){if($.trim(a["jcr:title"]).length>236){return"activity name's length should be less than 236 chars"
}},addAudience:function(b){var a=this.getTargets(),c=a["ref:audiences"]||[];
this.removeAudience();
c.push(b.getReferenceString());
a["ref:audiences"]=c;
this.setTargets(a);
this.addAudienceData(b)
},removeAudience:function(){var a=this.getTargets();
a["ref:audiences"].length=0;
this.setTargets(a)
},getAudiencesRef:function(){var a=this.getTargets();
var b=a["ref:audiences"];
if(typeof b!="undefined"&&b.length>0){return b[0]
}},setReportingAudiences:function(b){var a=[];
_.each(b,function(d,c){a.push(d.getReferenceString());
this.addAudienceData(d)
},this);
this.silentSet("ref:reportAudiences",a)
},getReportingAudiencesRefs:function(){var a=this.get("ref:reportAudiences");
if(typeof a==="undefined"||a===null){a=[]
}return a
},getAudienceDataFromRef:function(a){var b=this.get("elm:references"),c={};
if(a&&b){c.id=a.substring(ELM.Models.Audience.prototype.urlRoot.length+2);
c["jcr:title"]=b[a]["jcr:title"];
c.reference=a
}return c
},addAudienceData:function(d){var b=d.getReferenceString(),a=d.getTitle(),c=this.get("elm:references")||{};
c[b]={"jcr:title":a};
this.silentSet("elm:references",c)
},getReportingAudiences:function(){var a=this.getReportingAudiencesRefs(),c=[],b=this;
_.each(a,function(d){c.push(b.getAudienceDataFromRef(d))
});
return c
},getDefaultRedirectOffer:function(){return{url:"",options:{includeAllUrlParameters:true,passMboxSession:false}}
},isUserApprover:function(){return this.getPrivileges().toLowerCase().indexOf(ELM.Activities.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.getPrivileges().toLowerCase().indexOf(ELM.Activities.privilege.WRITE)!==-1
},isUserObserver:function(a){return !(this.isUserApprover()||this.isUserEditor())
},createBackUp:function(){return jQuery.extend(true,{},this.toJSON())
},isChanged:function(b,a){return ELM.Util.hasChanged(this,b,a)
},getActivityMode:function(){return this.get("mode")
},setActivityMode:function(a){this.silentSet("mode",a)
},defaults:function(){return{"jcr:title":"","jcr:description":"",priority:0,callToAction:"",startDate:"",endDate:"",deactivatedDate:"",activatedDate:"",activityType:"A-B",metrics:[],experiences:[],controlExperienceId:0,segment:"",targets:{"ref:audiences":[],template:{activityUrl:"",targets:[]}},sync:{root:{targetSyncFailed:false}}}
}});
ELM.Models.ActivityCollision=ELM.Model.extend({getActivityId:function(a){return this.get("activities")[a].id
},getActivityType:function(a){return this.get("activities")[a].activityType
}});
"use strict";
ELM.Models.OneToOneActivity=ELM.Models.GenericActivity.extend({urlRoot:"activities",defaults:function(){return{activityType:"1-1","jcr:title":"",optimizingMetric:"CONVERSION_RATE","jcr:description":"",thumbnailSrc:"",priority:0,callToAction:"",startDate:"",endDate:"",activatedDate:"",deactivatedDate:"",metrics:[],locations:[],exclusions:[],reportinggroups:[],targets:{"ref:audiences":["/audiences/all_visitors"],template:{activityUrl:"",targets:[]}},"ref:reportAudiences":[],controlexperience:{},algorithmIds:["e_greedy_rf"],"elm:references":{"/audiences/all_visitors":{"jcr:title":"All Visitors"}}}
},setId:function(a){this.silentSet("id",a)
},getId:function(){return this.get("id")
},setActivityType:function(a){this.set("activityType",a)
},getActivityType:function(){return this.get("activityType")
},getTitleOrDefault:function(){return this.getTitle()||Granite.I18n.get("Untitled Activity")
},initReportingSolution:function(){if(this.getReportSuite()){this.setReportingSolution(ELM.Activities.reportingEngine.ANALYTICS)
}else{this.setReportingSolution(ELM.reportingEngine===ELM.Activities.reportingEngine.TRANSITIONAL?ELM.Activities.reportingEngine.TARGET:ELM.reportingEngine)
}},setReportingSolution:function(a){this.silentSet("reportingSolution",a)
},getReportingSolution:function(){return this.get("reportingSolution")
},setReportSuite:function(a){this.silentSet("reportSuite",a)
},removeReportSuite:function(){this.silentSet("reportSuite","")
},getReportSuite:function(){return this.get("reportSuite")
},setOptimizingMetric:function(a){this.set("optimizingMetric",a)
},getOptimizingMetric:function(){return this.get("optimizingMetric")
},getExcludedExperiencesNumber:function(){var a=this.getLocations(),b=this.getExclusions();
if(!_.isEmpty(a)&&!_.isEmpty(b)){return(b.length/a.length)
}return 0
},getGeneratedExperiencesNumber:function(){var a=this.getLocations(),b=1;
if(_.isEmpty(a)){return 0
}_.each(a,function(c){var d=c.offers;
var e=d.length;
if(d&&e){if(d[0].included){b*=e
}else{b*=e-1
}}});
return b
},getExperiencesAfterExclusionOrGeneratedExperiencesNumber:function(){return this.getGeneratedExperiencesNumber()-this.getExcludedExperiencesNumber()
},setExperiences:function(a){this.silentSet("experiences",a)
},getExperiences:function(){return this.get("experiences")
},removeExperiences:function(){this.unset("experiences",{silent:true})
},getExperiencesNumber:function(){var a=this.getExperiences();
if(a){return a.length
}return 0
},getExclusionsLimitLeft:function(){return 0
},getExperienceByIndex:function(a){return this.getExperiences()[a]
},generateExperienceName:function(b){function a(c){if(c<26){return String.fromCharCode(65+c)
}return a(Math.floor(c/26)-1)+String.fromCharCode(65+c%26)
}return Granite.I18n.get("Experience {0}",a(b))
},generateExperiences:function(){var d=this,c=[],a=this.getLocations(),f=a.length,b=0;
function e(g,h){if(h===f){c.push({"jcr:title":d.generateExperienceName(b++),offerlocations:g,excluded:false});
return
}_.each(a[h].offers,function(k,j){if(k.isDefault&&!k.included){return
}var i=g.concat([{locationLocalId:h,offerLocalId:j}]);
e(i,h+1)
})
}e([],0);
return c
},setPriority:function(a){this.silentSet("priority",parseInt(a))
},getPriority:function(){return this.get("priority")
},setCallToAction:function(a){this.set("callToAction",a)
},getCallToAction:function(){return this.get("callToAction")
},setStartDate:function(a){this.silentSet("startDate",a)
},getStartDate:function(){return this.get("startDate")
},setEndDate:function(a){this.silentSet("endDate",a)
},getEndDate:function(){return this.get("endDate")
},getActivatedDate:function(){return this.get("activatedDate")
},getDeactivatedDate:function(){return this.get("deactivatedDate")
},setMetrics:function(a){this.silentSet("metrics",a)
},getMetrics:function(){return this.get("metrics")
},setLocations:function(a){this.set("locations",a)
},getLocations:function(){return this.get("locations")
},isLocationNameUnique:function(a){var c=this.getLocations();
var b=_.some(c,function(d){return(d["jcr:title"]===a)
});
return !b
},addLocation:function(b){var a=_.clone(this.getLocations());
a.push(b);
this.setExclusions([]);
this.resetControlExperience(this.getControlExperienceType()==="default_content");
this.setLocations(a)
},removeLocation:function(b){var a=this.getLocations(),d=this.getLocationIndexBySelector(b),c=this;
a=_.reject(a,function(e){return c.getSelectorFromLocation(e)===b
});
if(a.length===0){this.setControlExperience({})
}else{this.resetControlExperience(this.getControlExperienceType()==="default_content")
}this.setExclusions([]);
this._updateReportingGroupsOnLocationDelete(d);
this.setLocations(a)
},setThumbnailSrc:function(a){this.silentSet("thumbnailSrc",a)
},getThumbnailSrc:function(){return this.get("thumbnailSrc")
},getOffersCountForLocation:function(d){var c=this._getLocationIndex(d),b="",a;
if(c!==-1){a=this.getLocations()[c].offers
}if(a&&a.length){b=a.length
}if(b&&!a[0].included){b-=1
}return b
},removeOffer:function(e,c){var a=_.clone(this.getLocations()),b=ELM.Util.clone(a[e]),d;
if(b&&b.offers){d=b.offers[c];
if(d.isDefault){d.included=false
}else{b.offers.splice(c,1)
}this._updateFieldsOnOfferDelete(e,c);
a[e]=b;
this.setLocations(a)
}},_updateFieldsOnOfferDelete:function(b,a){var d=this.getControlExperienceType(),c=this.getLocations()[b].offers[a];
this._updateExclusionsOnOfferDelete(b,a);
this._updateReportingGroupsOnOfferDelete(b,a);
if(d==="custom"){this._updateControlExperienceOnOfferDelete(b,a)
}else{if(d==="default_content"&&c.isDefault){this.resetControlExperience()
}}},_updateExclusionsOnOfferDelete:function(k,g){var f=this.getExclusions(),d=f.length,e=[],h=this.getLocations(),l=h.length,a=h[k].offers[g],o,n,m,c,b;
for(c=0;
c<d;
c+=l){o=[];
m=false;
for(b=0;
b<l;
b++){n=f[c+b];
if(n.locationIndex===k){if(n.offerIndex===g){m=true;
break
}else{if(!a.isDefault&&n.offerIndex>g){n.offerIndex--
}}}o.push(n)
}if(!m){e=e.concat(o)
}}this.setExclusions(e)
},_updateReportingGroupsOnOfferDelete:function(c,a){var b=this.getReportingGroups(),d=this.getLocations()[c].offers[a];
if(d.isDefault){return
}_.each(b,function(e){e.locationsandoffers=_.reject(e.locationsandoffers,function(f){return f.locationIndex===c&&f.offerIndex===a
});
_.each(e.locationsandoffers,function(f){if(f.locationIndex===c&&f.offerIndex>a){f.offerIndex--
}})
});
this.removeEmptyReportingGroups()
},_updateControlExperienceOnOfferDelete:function(d,a){var f=this.getCustomControlExperiences(),e=this.getLocations()[d].offers[a],c,b;
if(f){c=f.length;
for(b=0;
b<c;
b++){if(f[b].locationIndex===d){if(!e.isDefault&&f[b].offerIndex>a){f[b].offerIndex--
}else{if(f[b].offerIndex===a){this.resetControlExperience();
return
}}}}}},_updateReportingGroupsOnLocationDelete:function(b){var a=this.getReportingGroups();
_.each(a,function(c){c.locationsandoffers=_.reject(c.locationsandoffers,function(d){return d.locationIndex===b
});
_.each(c.locationsandoffers,function(d){if(d.locationIndex>b){d.locationIndex--
}})
});
this.removeEmptyReportingGroups()
},removeEmptyReportingGroups:function(){var a=_.reject(this.getReportingGroups(),function(b){return _.isEmpty(b.locationsandoffers)
});
this.setReportingGroups(a)
},getLocationBySelector:function(a){var b=this;
return _.find(this.getLocations(),function(c){return b.getSelectorFromLocation(c)===a
})
},getLocationIndexBySelector:function(b){var c=[],d=this,a=this.getLocations();
_.each(a,function(e){c.push(d.getSelectorFromLocation(e))
});
return c.indexOf(b)
},setExclusions:function(a){this.set("exclusions",a);
if(this.getControlExperienceType()==="custom"&&this.isOfferCombinationExcluded(this.getCustomControlExperiences())){this.resetControlExperience()
}},getExclusions:function(){return this.get("exclusions")
},isOfferCombinationExcluded:function(g){var h=this.getExclusions(),k=this.getLocations(),e=h.length,f=k.length,l,c,a;
for(var d=0;
d<e;
d+=f){a=true;
for(var b=0;
b<f;
b++){l=h[d+b];
c=g[b];
if(l.locationIndex===c.locationIndex&&l.offerIndex!==c.offerIndex){a=false;
break
}}if(a){return true
}}return false
},setLocationOffers:function(e,d){var a=this.getLocations()[e],g=this.getControlExperienceType(),b=this.getHumanFormattedExclusions(),c=this.getHumanFormattedReportGroups(),f=this.getHumanFormattedCustomControlExperiences();
a.offers=d;
this.updateExclusions(e,b);
this.updateReportGroups(e,c);
if(g==="custom"){this.updateCustomControlExperience(e,f)
}else{if(g==="default_content"&&!this.isDefaultContentIncluded(e)){this.resetControlExperience()
}}this.trigger("change:locations")
},updateExclusions:function(e,c){var f=this._getOfferNames(e),d=this.getLocations()[e].offers;
var a=_.filter(c,function(h){var g=f.indexOf(h[e]);
if(d[g]&&d[g].included===false){return false
}return g!==-1
});
var b=this.getExclusionsAsFlatArray(a);
this.setExclusions(b)
},updateReportGroups:function(e,f){var d=this._getOfferNames(e),c=this;
var a=_.map(f,function(h){var g=_.filter(h.offers,function(k,j){var i=c._getLocationIndex(k.locationTitle);
return i!==e||d.indexOf(k.offerTitle)!==-1
});
return{"jcr:title":h["jcr:title"],offers:g}
});
var b=this.getReportGroupsAsArray(a);
this.setReportingGroups(b);
this.removeEmptyReportingGroups()
},updateCustomControlExperience:function(f,c){var b=[],i=this.getLocations()[f],l=i["jcr:title"],k=c[l],a=this._getOfferNames(f),e=a.indexOf(k),d=e!==-1,j,g,h;
if(d){h=i.offers[e];
j=d&&h.isDefault&&h.included;
g=d&&!h.isDefault
}if(j||g){b=this.getCustomControlExperienceAsArray(c)
}if(_.isEmpty(b)){this.resetControlExperience()
}this.setCustomControlExperiences(b)
},getExclusionOffers:function(e){var a=this.getLocations(),d=[];
for(var c=0;
c<e.length;
c++){var b=e[c];
d.push(a[c].offers[b]["jcr:title"])
}return d
},getExclusionsAsFlatArray:function(a){var c=[],b=this;
_.each(a,function(e){var d=_.map(e,function(g,f){return{locationIndex:f,offerIndex:b._getOfferIndex(f,g)}
});
c=c.concat(d)
});
return c
},_getLocationIndex:function(b){var a=_.map(this.getLocations(),function(c){return c["jcr:title"]
});
return a.indexOf(b)
},getCustomControlExperienceAsArray:function(b){var a=this;
return _.map(b,function(f,d){var e=a._getLocationIndex(d);
var c=a._getOfferIndex(e,f);
return{locationIndex:e,offerIndex:c}
})
},getReportGroupsAsArray:function(c){var b,a=this;
b=_.map(c,function(e){var d=_.map(e.offers,function(g){var f=a._getLocationIndex(g.locationTitle);
return{locationIndex:f,offerIndex:a._getOfferIndex(f,g.offerTitle)}
});
return{"jcr:title":e["jcr:title"],locationsandoffers:d}
});
return b
},getHumanFormattedExclusions:function(){var c,b=this,a=this.getLocations();
function d(e,i){var h=[];
var g=_.map(e,function(k,j){return k.offerIndex
});
while(g.length){var f=g.splice(0,i);
h.push(f)
}return h
}c=d(this.getExclusions(),a.length);
return _.map(c,function(e){return b.getExclusionOffers(e)
})
},getHumanFormattedReportGroups:function(){var a=this.getLocations();
function b(c){return _.map(c,function(f){var d=f["jcr:title"],g={};
if(!g[d]){g[d]=[]
}var e=_.map(f.locationsandoffers,function(k,j){var i=a[k.locationIndex],h=i["jcr:title"],l=i.offers[k.offerIndex]["jcr:title"];
return{locationTitle:h,offerTitle:l}
});
return{"jcr:title":d,offers:e}
})
}return b(this.getReportingGroups())
},getHumanFormattedCustomControlExperiences:function(){var a=this.getLocations();
function b(d){var c={};
_.each(d,function(g){var f=a[g.locationIndex],e=f["jcr:title"],h=f.offers;
c[e]=h[g.offerIndex]["jcr:title"]
});
return c
}return b(this.getCustomControlExperiences())
},_getOfferNames:function(a){return _.map(this.getLocations()[a].offers,function(b){return b["jcr:title"]
})
},_getOfferIndex:function(b,c){var a=this._getOfferNames(b);
return a.indexOf(c)
},isAllDefaultContentIncluded:function(){var a=this.getLocations();
return _.every(a,function(b,c){return this.isDefaultContentIncluded(c)
},this)
},isDefaultContentIncluded:function(b){var a=this.getLocations()[b];
return _.some(a.offers,function(c){return c.isDefault&&c.included
})
},setReportingGroups:function(a){this.set("reportinggroups",a)
},getReportingGroups:function(){return this.get("reportinggroups")
},setTargets:function(a){this.set("targets",a)
},getTargets:function(){return this.get("targets")
},setTemplates:function(b){var a=this.getTargets();
a.template=b;
this.silentSet("targets",a)
},getTemplates:function(){return this.getTargets()["template"]
},setActivityUrl:function(a){var b=this.getTemplates();
b.activityUrl=a
},getActivityUrl:function(){return this.getTemplates()["activityUrl"]
},setTargetsRefAudiences:function(b){var a=_.clone(this.getTargets());
a["ref:audiences"]=b;
this.setTargets(a)
},getTargetsRefAudiences:function(){return this.getTargets()["ref:audiences"]
},addRefAudienceToTargets:function(c,b){var a=_.clone(this.getTargets());
a["ref:audiences"].splice(b,0,c);
this.setTargets(a)
},setElmReferences:function(a){this.silentSet("elm:references",a)
},getElmReferences:function(){return this.get("elm:references")
},updateElmReferences:function(c){var a=c.getReferenceString(),b=this.getElmReferences();
b[a]={"jcr:title":c.getTitle()};
this.setElmReferences(b)
},setReportingAudiencesRefs:function(b){var a=[];
_.each(b,function(d,c){a.push(d.getReferenceString());
this.addAudienceData(d)
},this);
this.silentSet("ref:reportAudiences",a)
},unsetReportingAudiencesRefs:function(){this.unset("ref:reportAudiences")
},getReportingAudiencesRefs:function(){return this.get("ref:reportAudiences")||[]
},getAudienceDataFromRef:function(a){var b=this.getElmReferences(),c={};
if(a&&b){c.id=a.substring(ELM.Models.Audience.prototype.urlRoot.length+2);
c["jcr:title"]=b[a]["jcr:title"];
c.reference=a
}return c
},addAudienceData:function(c){var a=c.getReferenceString(),b=this.getElmReferences();
b[a]={"jcr:title":c.getTitle()};
this.setElmReferences(b)
},getReportingAudiences:function(){var a=this.getReportingAudiencesRefs(),c=[],b=this;
_.each(a,function(d){c.push(b.getAudienceDataFromRef(d))
});
return c
},getAudiencesRef:function(){var a=this.getTargets(),b=a["ref:audiences"];
if(typeof b!="undefined"&&b.length){return b[0]
}},setControlExperience:function(a){this.set("controlexperience",a)
},getControlExperience:function(){return this.get("controlexperience")
},resetControlExperience:function(a){this.setControlExperience({visitorPercentage:this.getVisitorPercentage()||10,type:a&&this.getControlExperienceType()||"random"})
},setControlExperienceType:function(a){var b=_.clone(this.getControlExperience());
b.type=a;
if(a!=="custom"){delete b.customexperiences
}this.setControlExperience(b)
},getControlExperienceType:function(){return this.getControlExperience().type
},setCustomControlExperiences:function(b){var a=_.clone(this.getControlExperience());
a.customexperiences=b;
this.setControlExperience(a)
},getCustomControlExperiences:function(){return this.getControlExperience().customexperiences
},setVisitorPercentage:function(a){var b=ELM.Util.clone(this.getControlExperience());
b.visitorPercentage=a;
this.setControlExperience(b)
},getVisitorPercentage:function(){return this.getControlExperience().visitorPercentage
},getLocationsTitle:function(){return _.pluck(this.getLocations(),"jcr:title")
},getLocationsLastUsedIndex:function(){var b=ELM.Strategy.IndexedName("Location ");
var a=_.map(this.getLocationsTitle(),function(c){return c
});
return b.getLastUsedIndex(a)
},setStatus:function(a){this.set("status",a)
},getStatus:function(){return this.get("status")
},getLastModified:function(){return this.get("jcr:lastModified")
},getSyncMetadata:function(){return this.get("sync")
},getRootSyncMetadata:function(){return this.getSyncMetadata().root
},setSyncStatus:function(a){this.getRootSyncMetadata().targetSyncFailed=a
},getSyncStatus:function(){return this.getRootSyncMetadata()["targetSyncFailed"]
},setSyncPendingStatus:function(a){this.getRootSyncMetadata().targetSyncPending=a
},getSyncPendingStatus:function(){return this.getRootSyncMetadata()["targetSyncPending"]
},setBestOpportunity:function(a){this.set("bestOpportunity",a)
},getBestOpportunity:function(){return this.get("bestOpportunity")
},setActivityMode:function(a){this.silentSet("mode",a)
},getActivityMode:function(){return this.get("mode")
},getPrivileges:function(){return this.get("privileges")
},setAlgorithmIds:function(a){this.set("algorithmIds",a)
},getAlgorithmIds:function(){return this.get("algorithmIds")
},removeAlgorithmId:function(a){this.setAlgorithmIds(_.without(this.getAlgorithmIds(),a))
},setAlgorithms:function(a){this.set("algorithms",a)
},unsetAlgorithms:function(){this.unset("algorithms")
},getAlgorithms:function(){return this.get("algorithms")
},getSelectorFromLocation:function(a){return a["mbox-selector"]||a.selector
},isUserApprover:function(){return this.getPrivileges().toLowerCase().indexOf(ELM.Activities.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.getPrivileges().toLowerCase().indexOf(ELM.Activities.privilege.WRITE)!==-1
},isUserObserver:function(){return !(this.isUserApprover()||this.isUserEditor())
},createBackUp:function(){return jQuery.extend(true,{},this.toJSON())
},isChanged:function(b,a){return ELM.Util.hasChanged(this,b,a)
}});
ELM.Models.Recommendation=ELM.Models.GenericActivity.extend({urlRoot:"activities",defaults:function(){return{activityType:"recommendation","jcr:title":"","jcr:description":"",thumbnailSrc:"",status:"DRAFT",priority:0,startDate:"",endDate:"",activatedDate:"",deactivatedDate:"","ref:catalog":"",configuration:{defaultContent:10},"ref:recTemplates":[],"ref:algorithms":[],experiences:[],controlExperienceId:0,location:{},metrics:[],targets:{"ref:audiences":[""],template:{activityUrl:"",targets:[]}},recAlgoSessionId:new Date().getTime(),"elm:references":{"/audiences/all_visitors":{"jcr:title":"All Visitors"}}}
},setId:function(a){this.silentSet("id",a)
},getId:function(){return this.get("id")
},setActivityType:function(a){this.set("activityType",a)
},getActivityType:function(){return this.get("activityType")
},getTitleOrDefault:function(){return this.getTitle()||Granite.I18n.get("Untitled Activity")
},setPageType:function(a){this.silentSet("pageType",a)
},getPageType:function(){return this.get("pageType")
},removePageType:function(){this.unset("pageType",{silent:true})
},setIndustryType:function(a){this.silentSet("industryType",a)
},getIndustryType:function(){return this.get("industryType")
},removeIndustryType:function(){this.unset("industryType",{silent:true})
},initReportingSolution:function(){if(this.getReportSuite()){this.setReportingSolution(ELM.Activities.reportingEngine.ANALYTICS)
}else{this.setReportingSolution(ELM.reportingEngine===ELM.Activities.reportingEngine.TRANSITIONAL?ELM.Activities.reportingEngine.TARGET:ELM.reportingEngine)
}},setReportingSolution:function(a){this.silentSet("reportingSolution",a)
},getReportingSolution:function(){return this.get("reportingSolution")
},setReportSuite:function(a){this.silentSet("reportSuite",a)
},removeReportSuite:function(a){this.silentSet("reportSuite","")
},getReportSuite:function(){return this.get("reportSuite")
},setStatus:function(a){this.set("status",a)
},getStatus:function(){return this.get("status")
},getLastModified:function(){return this.get("jcr:lastModified")
},setCallToAction:function(a){this.set("callToAction",a)
},getCallToAction:function(){return this.get("callToAction")
},setStartDate:function(a){this.silentSet("startDate",a)
},getStartDate:function(){return this.get("startDate")
},setEndDate:function(a){this.silentSet("endDate",a)
},getEndDate:function(){return this.get("endDate")
},getActivatedDate:function(){return this.get("activatedDate")
},getDeactivatedDate:function(){return this.get("deactivatedDate")
},setPriority:function(a){this.silentSet("priority",parseInt(a))
},getPriority:function(){return this.get("priority")
},setRefCatalog:function(a){this.silentSet("ref:catalog",a)
},getRefCatalog:function(){return this.get("ref:catalog")
},updateRefCatalog:function(b){var a=b.reference,d=this.getRefCatalog(),c=this.getElmReferences();
this.setRefCatalog(a);
delete c[d];
c[a]=b
},setConfiguration:function(a){this.set("configuration",a)
},getConfiguration:function(){return this.get("configuration")
},setDefaultContent:function(b){var a=_.clone(this.getConfiguration());
a.defaultContent=b;
this.setConfiguration(a)
},getDefaultContent:function(){var a=this.get("configuration");
return a.defaultContent
},getExperiences:function(){return this.get("experiences")
},getControlExperienceId:function(){var b=this.getExperiences(),a=this.get("controlExperienceId");
if(_.findWhere(b,{id:a})){return a
}return _.min(_.pluck(b,"id"))
},setRefRecTemplates:function(b,a){a?this.silentSet("ref:recTemplates",b):this.set("ref:recTemplates",b)
},getRefRecTemplates:function(){return this.get("ref:recTemplates")
},updateRefRecTemplates:function(e,c){var b=[],d=this.getElmReferences(),a;
_.each(e,function(f){a=f.path;
b.push(a);
d[a]=f
});
this.setRefRecTemplates(b,c)
},removeTemplateByReference:function(b){var a=_.without(this.getRefRecTemplates(),b);
this.setRefRecTemplates(a);
delete this.getElmReferences()[b]
},removeTemplateByIndex:function(c,b){var a=_.clone(this.getRefRecTemplates());
a.splice(c,1);
this.setRefRecTemplates(a)
},getTemplateDataByIndex:function(b){var d=this.getRefRecTemplates()[b],a=this.getElmReferences(),c=a[d];
c.path=d;
return c
},getSelectedTemplatesData:function(){var a=this.getRefRecTemplates(),b=this.getElmReferences(),c=[];
_.each(a,function(d){b[d].path=d;
c.push(b[d])
});
return c
},setRefAlgorithms:function(b,a){a?this.silentSet("ref:algorithms",b):this.set("ref:algorithms",b)
},getRefAlgorithms:function(){return this.get("ref:algorithms")
},updateRefAlgorithms:function(e,b){var d=[],c=this.getElmReferences(),a;
_.each(e,function(f){a=ELM.Util.getCompleteResourcePath(f.reference);
d.push(a);
c[a]=f
});
this.setRefAlgorithms(d,b)
},removeAlgorithmByReference:function(a){var b;
a=ELM.Util.getCompleteResourcePath(a);
b=_.without(this.getRefAlgorithms(),a);
this.setRefAlgorithms(b);
delete this.getElmReferences()[a]
},removeAlgorithmByIndex:function(b,a){var c=_.clone(this.getRefAlgorithms());
c.splice(b,1);
this.setRefAlgorithms(c,a)
},getAlgorithmDataByIndex:function(b){var c=this.getRefAlgorithms()[b],a=this.getElmReferences();
return a[c]
},getSelectedAlgorithmsData:function(){var b=this.getRefAlgorithms(),a=this.getElmReferences(),c=[];
_.each(b,function(d){c.push(a[d])
});
return c
},setLocation:function(a){this.silentSet("location",a)
},getLocation:function(){return this.get("location")
},resetLocation:function(){var a=this.getLocation();
delete a.action;
delete a.selector;
delete a.mbox;
delete a.cssSelector
},setThumbnailSrc:function(a){this.silentSet("thumbnailSrc",a)
},getThumbnailSrc:function(){return this.get("thumbnailSrc")
},getSelector:function(){return this.getLocation().selector
},getAction:function(){return this.getLocation().action
},setClickTrackId:function(a){this.getLocation().clickTrackId=a
},getClickTrackId:function(){return this.getLocation().clickTrackId
},removeClickTrackId:function(){delete this.getLocation().clickTrackId
},setEntityIdRequired:function(a){var b=this.getLocation();
b.entityIdRequired=a
},getEntityIdRequired:function(){return this.getLocation().entityIdRequired
},setCategoryIdRequired:function(b){var a=this.getLocation();
a.categoryIdRequired=b
},getCategoryIdRequired:function(){return this.getLocation().categoryIdRequired
},setRecommendationGlobalConfig:function(b){var a=this.getLocation();
a.recommendationglobalconfig=b
},getRecommendationGlobalConfig:function(){return this.getLocation().recommendationglobalconfig
},setTargets:function(a){this.set("targets",a)
},getTargets:function(){return this.get("targets")
},setTemplates:function(b){var a=this.getTargets();
a.template=b;
this.silentSet("targets",a)
},getTemplates:function(){return this.getTargets()["template"]
},setActivityUrl:function(a){var b=this.getTemplates();
b.activityUrl=a
},getActivityUrl:function(){return this.getTemplates()["activityUrl"]
},setTargetsRefAudiences:function(b){var a=_.clone(this.getTargets()),c=[];
_.each(b,function(d){c.push(d.getReferenceString());
this.addAudienceData(d)
},this);
a["ref:audiences"]=c;
this.setTargets(a)
},setAudiences:function(b){var a=_.clone(this.getTargets());
a["ref:audiences"]=b;
this.setTargets(a)
},getAudiences:function(){var a=this.get("targets");
return a["ref:audiences"]
},setTargetsTargetUrls:function(b){var a=_.clone(this.getTargets());
a.targetUrls=b;
this.setTargets(a)
},getTargetsTargetUrls:function(){return this.getTargets()["targetUrls"]
},updateElmReferences:function(c){var b=_.clone(this.getElmReferences()),a=c.reference;
a=a?ELM.Util.getCompleteResourcePath(a):c.path;
if(b[a]){b[a]=c;
this.setElmReferences(b)
}},getAudienceDataFromRef:function(a){var b=this.getElmReferences(),c={};
if(a&&b){c.id=a.substring(ELM.Models.Audience.prototype.urlRoot.length+2);
c["jcr:title"]=b[a]["jcr:title"];
c.reference=a
}return c
},addAudienceData:function(c){var a=c.getReferenceString(),b=this.getElmReferences();
b[a]={"jcr:title":c.getTitle()}
},getReportingAudiences:function(){var a=this.getReportingAudiencesRefs(),b=[];
_.each(a,function(c){b.push(this.getAudienceDataFromRef(c))
},this);
return b
},getAudiencesRef:function(){var a=this.getTargets();
var b=a["ref:audiences"];
if(b&&b.length>0){return b[0]
}},getReportingAudiencesRefs:function(){return this.get("ref:reportAudiences")||[]
},setReportingAudiencesRefs:function(b){var a=[];
_.each(b,function(d,c){a.push(d.getReferenceString());
this.addAudienceData(d)
},this);
this.silentSet("ref:reportAudiences",a)
},unsetReportingAudiencesRefs:function(){this.unset("ref:reportAudiences")
},setElmReferences:function(b,a){a?this.silentSet("elm:references",b):this.set("elm:references",b)
},getElmReferences:function(){return this.get("elm:references")
},setMetrics:function(a){this.silentSet("metrics",a)
},getMetrics:function(){return this.get("metrics")
},setActivityMode:function(a){this.silentSet("mode",a)
},getActivityMode:function(){return this.get("mode")
},getSyncMetadata:function(){return this.get("sync")
},getRootSyncMetadata:function(){return this.getSyncMetadata().root
},getTargetId:function(){return this.getRootSyncMetadata().targetId
},setSyncStatus:function(a){this.getRootSyncMetadata().targetSyncFailed=a
},getSyncStatus:function(){return this.getRootSyncMetadata().targetSyncFailed
},setSyncPendingStatus:function(a){this.getRootSyncMetadata().targetSyncPending=a
},getSyncPendingStatus:function(){return this.getRootSyncMetadata()["targetSyncPending"]
},getRecId:function(){return this.getRootSyncMetadata().recId
},getRecAlgoSessionId:function(){return this.get("recAlgoSessionId")
},getPrivileges:function(){return this.get("privileges")
},isUserApprover:function(){return this.getPrivileges().toLowerCase().indexOf(ELM.Activities.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.getPrivileges().toLowerCase().indexOf(ELM.Activities.privilege.WRITE)!==-1
},isUserObserver:function(){return !(this.isUserApprover()||this.isUserEditor())
},createBackUp:function(){return jQuery.extend(true,{},this.toJSON())
},isChanged:function(b,a){return ELM.Util.hasChanged(this,b,a)
},getCatalogRefBasedOnAlgorithms:function(){var d=this.getRefAlgorithms(),b=this.getElmReferences(),c=this.getRefCatalog(),a;
if(d.length===0||!c){return c
}for(a=0;
a<d.length;
a++){if(b[d[a]].configuration.type!=="recentlyViewed"){return c
}}return""
},getModifiedAttributesToSave:function(){var a=_.clone(this.getLocation());
delete a.entityIdRequired;
delete a.categoryIdRequired;
return{location:a,"ref:catalog":this.getCatalogRefBasedOnAlgorithms(),reportingSolution:undefined}
}});
"use strict";
ELM.Models.MvtActivity=ELM.Models.OneToOneActivity.extend({defaults:function(){return{activityType:"MVT","jcr:title":"",optimizingMetric:"CONVERSION_RATE","jcr:description":"",thumbnailSrc:"",priority:0,callToAction:"",startDate:"",endDate:"",activatedDate:"",deactivatedDate:"",metrics:[],locations:[],experiences:[],exclusions:0,reportinggroups:[],targets:{"ref:audiences":["/audiences/all_visitors"],template:{activityUrl:"",targets:[]}},"ref:reportAudiences":[],controlexperience:{},algorithmIds:["full_factorial"],algorithms:[{algorithmId:"full_factorial","jcr:title":"Full Factorial"}],"elm:references":{"/audiences/all_visitors":{"jcr:title":"All Visitors"}}}
},getSyncMetadata:function(){return this.get("sync")
},getRootSyncMetadata:function(){return this.getSyncMetadata()["root"]
},getTargetId:function(){return this.getRootSyncMetadata()["targetId"]
},getSyncPendingStatus:function(){return this.getRootSyncMetadata()["targetSyncPending"]
},getExclusionsLimit:function(){return Math.round(this.getExperiencesNumber()/10)||1
},getExclusionsLimitLeft:function(){var b=this.getExclusionsLimit();
var a=this.getExcludedExperiencesNumber();
if(a){b-=a
}if(b<0){throw new Error("ELM.Models.MvtActivity: the count of excluded experience exceeds the limit")
}return b
},getExperiencesAfterExclusionOrGeneratedExperiencesNumber:function(){var a=this.getGeneratedExperiencesNumber(),b=this.getExperiencesNumber();
if(a!==b){return a
}else{return b-this.getExcludedExperiencesNumber()
}},setExclusions:function(){this.silentSet("exclusions",this.getExcludedExperiencesNumber())
},getGeneratedExperiencesNumber:function(){var a=this.generateExperiences();
return a.length
},cartesianProductOf:function(c){var b=[],a=c.length-1,d;
function e(f,k){for(var h=0,g=c[k].length;
h<g;
h++){d=f.slice(0);
d.push(c[k][h]);
if(k==a){b.push(d)
}else{e(d,k+1)
}}}e([],0);
return b
},generateIndexes:function(e,c){var b=[];
for(var d=e;
d<c;
d++){b.push(d)
}return b
},generateExperiences:function(){var g=this.getLocations(),j=g.length,c=[],a=[],k,e,b;
if(!j){return c
}for(var d=0;
d<j;
d++){k=g[d]["offers"];
e=k.length;
b=0;
if(!k[0]["included"]){b=1
}c.push(this.generateIndexes(b,e))
}c=this.cartesianProductOf(c);
j=c.length;
for(d=0;
d<j;
d++){var f=c[d],h=f.map(function(l,i){return{locationLocalId:i,offerLocalId:l}
});
a.push({"jcr:title":this.generateExperienceName(d),offerlocations:h,excluded:false})
}return a
},addLocation:function(b){var a=_.clone(this.getLocations());
a.push(b);
this.setLocations(a)
},removeLocation:function(b){var a=this.getLocations(),c=this;
a=_.reject(a,function(d){return c.getSelectorFromLocation(d)===b
});
this.setLocations(a)
},getControlExperienceId:function(){var c=this.getExperiences(),a=this.get("controlExperienceId"),b;
if(a){return a
}b=_.findWhere(c,{excluded:false});
if(b){return b.id
}throw this.toString()+": Activity must include at least one non-excluded experience."
},setcontrolExperienceId:function(a){this.silentSet("controlExperienceId",a)
},hasLotsOfExperiences:function(){return this.getExperiences().length>=15
},setLocationOffers:function(d,c){var a=ELM.Util.clone(this.getLocations()),b=a[d];
b.offers=c;
this.setLocations(a)
},updateExperiencesState:function(d,e){var f=_.clone(this.getExperiences()),a=d.length;
for(var c=0;
c<a;
c++){var b=d[c];
f[b]["excluded"]=e
}this.setExperiences(f);
this.trigger("change:exclusions")
},_updateFieldsOnOfferDelete:function(){},getExcludedExperiencesNumber:function(){var d=this.getExperiences(),a=d.length,c=0;
for(var b=0;
b<a;
b++){if(d[b]["excluded"]){c+=1
}}return c
},validate:function(){var a=this.getExperiencesNumber()-this.getExcludedExperiencesNumber();
if(a>ELM.mvtCombinationsPermissibleLimit){return{message:Granite.I18n.get("The number of combinations has crossed the permissible limit of {0}. Please reduce the number of locations or offers to bring it back to acceptable level",ELM.mvtCombinationsPermissibleLimit)}
}return void 0
},getLocationsNumber:function(){return this.getLocations().length
}});
"use strict";
ELM.Models.ReportSettings=ELM.Model.extend({getMetrics:function(){return this.get("metrics")
},setMetrics:function(a){this.silentSet("metrics",a)
},getExtremeOrders:function(){return this.get("extremeOrders")
},setExtremeOrders:function(a){this.silentSet("extremeOrders",a)
},getExperiences:function(){return this.get("experiences")
},getControlExperienceId:function(){return this.get("controlExperienceId")
},setcontrolExperienceId:function(a){this.silentSet("controlExperienceId",a)
},getControlExperience:function(){var a=this.getControlExperienceId();
return this.getExperiences()[a]
},getSuccessMetric:function(){return this.get("successMetric")
},setSuccessMetric:function(a){this.silentSet("successMetric",a)
},getSuccessMetricDisplayName:function(){var a,b=this.getSuccessMetric();
if(b&&b.type!=="analytics"){if(b.type==="revenue"&&this.getDimension()==="orders"){a="orders"
}else{if(b.type==="engagement"){a=b.engagementType
}else{a=this.getSuccessCriteriaMetric()
}}return ELM.ReportMetrics[a]
}return this.get("successMetricDisplayName")
},setSuccessMetricDisplayName:function(a){this.silentSet("successMetricDisplayName",a)
},setSuccessMetricSource:function(a){this.set("successMetricSource",a)
},getSuccessCriteriaMetric:function(){return this.get("successCriteriaMetric")
},setSuccessCriteriaMetric:function(a){this.silentSet("successCriteriaMetric",a)
},updateSuccessCriteriaMetric:function(){var a=this.getSuccessMetric(),b;
if(a){b={conversion:"conversionRate",revenue:this.getDimension(),engagement:"conversionRate",analytics:a.analyticsMetricId}[a.type]
}if(b==="orders"){b="conversionRate"
}this.setSuccessCriteriaMetric(b)
},getDimension:function(){return this.get("dimension")
},setDimension:function(a){this.silentSet("dimension",a)
},getCalculationMode:function(){return this.get("calculationMode")
},setCalculationMode:function(a){this.silentSet("calculationMode",a)
},setSegment:function(a){this.silentSet("segment",a)
},setBestWorstFilter:function(a){this.silentSet("bestWorstFilter",a)
},getBestWorstFilter:function(a){this.get("bestWorstFilter")
},setMetric:function(a){this.silentSet("metric",a)
},setResolution:function(a){this.silentSet("resolution",a)
},setResolutionFromDates:function(){var a=ELM.Util.getResolutionFromDates(this.get("startDate"),this.get("endDate"));
this.setResolution(a)
},getReportTitle:function(){var a=this.getSuccessMetricDisplayName(),b=this.getCalculationMode();
return{cumulative:Granite.I18n.get("Running")+" "+a,cumulativeDifference:Granite.I18n.get("Running Lift in")+" "+a,daily:a,dailyDifference:Granite.I18n.get("Lift in")+" "+a}[b]
},validate:function(d){var f=moment(d.endDate),a=moment(d.startDate),g=86400000,c=(moment()-a)/g,e=2*365,b=f&&a&&a.diff(f)>=g;
if(b){return{message:Granite.I18n.get("End date cannot be before start date."),source:"dates"}
}if(c>e){return{message:Granite.I18n.get("Start dates over 2 years old are not currently supported. Please choose a more recent start date."),source:"dates"}
}},onFetch:function(a){this.fetch(a)
},defaults:{startDate:"",endDate:"",resolution:"day",environment:"production",controlExperienceId:0,calculationMode:"cumulative",successMetric:"conversion_rate",successCriteriaMetric:"",extremeOrders:true,segment:""}});
"use strict";
ELM.Models.ReportSettingsOneToOne=ELM.Models.ReportSettings.extend({getReportTitle:function(){var b=(this.getDimension()==="sales")&&(this.getSuccessMetric().type==="revenue"),a=this.getSuccessMetricDisplayName(),e=this.getCalculationMode(),d=this.getReportLevel(),c;
if(d==="offerDetail"){c=Granite.I18n.get("Most Predictive Variables for")+" "+this.getCurrentOffer().name
}else{c={cumulative:Granite.I18n.get("Running")+" "+a,cumulativeDifference:Granite.I18n.get("Running Lift in")+" "+a,daily:a,dailyDifference:Granite.I18n.get("Lift in")+" "+a}[e]
}if(d==="offerLevel"){c+=" "+Granite.I18n.get("for")+" "+this.getCurrentAlgorithm().name
}return c
},setReportLevel:function(a){this.silentSet("reportLevel",a)
},getReportLevel:function(){return this.get("reportLevel")
},setCurrentOffer:function(a){this.silentSet("currentOffer",a)
},getCurrentOffer:function(){return this.get("currentOffer")
},unsetCurrentOffer:function(){this.unset("currentOffer",{silent:true})
},setCurrentAlgorithm:function(a){this.silentSet("currentAlgorithm",a)
},getCurrentAlgorithm:function(){return this.get("currentAlgorithm")
},validate:function(b){var d=86400000,c=100,a;
if(this.getReportLevel()==="offerLevel"){a=(moment(b.endDate)-moment(b.startDate))/d;
if(a>c){return{message:Granite.I18n.get("Start dates over 100 days old are not currently supported for offer level reports. Please choose a more recent start date."),source:"dates"}
}}return ELM.Models.ReportSettings.prototype.validate(b)
},defaults:{startDate:"",endDate:"",resolution:"day",environment:"production",controlExperienceId:0,calculationMode:"cumulative",successMetric:"conversion_rate",successCriteriaMetric:"",extremeOrders:true,segment:"",reportLevel:"activity"}});
"use strict";
ELM.Models.ActivitySummaryReport=ELM.Models.ReportModel.extend({url:function(){var e={},f=ELM.Activities.activityTypes.AB_TEST,g=ELM.Activities.activityTypes.EXPERIENCE_TARGETING,c=ELM.Activities.activityTypes.ONE_TO_ONE,h=ELM.Activities.activityTypes.MVT,d=ELM.Activities.activityTypes.RECOMMENDATION,b=this.getReportSuite(),a=this.getActivityType();
if(b){return"/apps/mac/target/sc/rs.at.json"
}e[f]="/summary.at.json";
e[g]="/summary.at.json";
e[c]="/summary.activitylevel.at.json";
e[h]="/summary.at.json";
e[d]="/summary.recommendations.at.json";
if(e.hasOwnProperty(a)){return"reports/activities/"+this.id+e[a]
}else{}}});
ELM.Models.ElementContributionSummaryReport=ELM.Models.ReportModel.extend({url:function(){return"reports/activities/"+this.id+"/summary.elementcontribution.at.json"
}});
"use strict";
ELM.Models.ActivityReportChart=ELM.Models.ReportModel.extend({url:function(){var e={},f=ELM.Activities.activityTypes.AB_TEST,g=ELM.Activities.activityTypes.EXPERIENCE_TARGETING,c=ELM.Activities.activityTypes.ONE_TO_ONE,h=ELM.Activities.activityTypes.MVT,d=ELM.Activities.activityTypes.RECOMMENDATION,b=this.getReportSuite(),a=this.getActivityType();
if(b){return"/apps/mac/target/sc/rs.at.json"
}e[f]="/performance.at.json";
e[g]="/performance.at.json";
e[c]="/performance.activitylevel.at.json";
e[h]="/performance.at.json";
e[d]="/performance.recommendations.at.json";
if(e.hasOwnProperty(a)){return"reports/activities/"+this.id+e[a]
}else{F.trigger("errorNotification",{message:Granite.I18n.get("Error making request for report data: this activity type is not recognized."),heading:Granite.I18n.get("Error")})
}},setGraphData:function(a){this.set("graphData",a)
},getGraphData:function(){return this.get("graphData")
},setYAxisFormat:function(b){var a;
if((b.calculationMode==="cumulativeDifference")||(b.calculationMode==="dailyDifference")){a="percent"
}else{a={conversionRate:"percent",orders:"percent",aov:"currency",rpv:"currency",sales:"currency"}[b.successCriteriaMetric]
}this.set("yAxisFormat",a)
},getYAxisFormat:function(a){return this.get("yAxisFormat")
},setBestGraphData:function(a){this.set("bestGraphData",a)
},getBestGraphData:function(){return this.get("bestGraphData")
},setWorstGraphData:function(a){this.set("worstGraphData",a)
},getWorstGraphData:function(){return this.get("worstGraphData")
},setHasTooManyExperiences:function(a){this.set("hasTooManyExperiences",a)
},getHasTooManyExperiences:function(){return this.get("hasTooManyExperiences")
}});
"use strict";
ELM.Models.OneToOneOfferLevelSummaryReport=ELM.Models.ActivityReportChart.extend({url:function(){return"reports/activities/"+this.id+"/summary.offergroup.at.json"
},setSuccessMetric:function(a){this.silentSet("successMetric",a)
},getSuccessMetric:function(){return this.get("successMetric")
},setSuccessMetricType:function(a){this.silentSet("successMetricType",a)
},getSuccessMetricType:function(){return this.get("successMetricType")
},setOffers:function(a){this.silentSet("offers",a)
},getOffers:function(){return this.get("offers")
},addOffer:function(b){var a=this.getOffers()||{};
a[b.offerId]=b;
this.setOffers(a)
},getOfferById:function(a){var b=this.getOffers();
return b[a]
},setFormattedSummaryResponse:function(a){this.set("formattedSummaryResponse",a);
this.updateSelectedSummaryData()
},getFormattedSummaryResponse:function(){return this.get("formattedSummaryResponse")
},setSummaryData:function(a){this.set("summaryData",a)
},unsetSummaryData:function(){this.unset("summaryData");
this.unset("formattedSummaryResponse")
},getSummaryData:function(){return this.get("summaryData")
},setFormattedGraphResponse:function(a){this.set("formattedGraphResponse",a);
this.updateSelectedGraphData()
},getFormattedGraphResponse:function(){return this.get("formattedGraphResponse")
},unsetGraphData:function(){this.unset("graphData");
this.unset("formattedGraphResponse")
},setDataPointFormat:function(a){this.set("dataPointFormat",a)
},getDataPointFormat:function(){return this.get("dataPointFormat")
},updateSelectedSummaryData:function(){var a=this.getCurrentAlgorithm(),b=this.getFormattedSummaryResponse();
if(a&&b){this.setSummaryData(_.clone(b[a.decisionStackId]))
}},updateSelectedGraphData:function(){var b=this.getCurrentAlgorithm(),c=this.getOfferLevelReportView(),a=this.getFormattedGraphResponse(),d;
if(b&&a){d=_.clone(a[b.decisionStackId]);
if(d){this.setGraphData(d[c])
}}},setCurrentAlgorithm:function(a){this.silentSet("currentAlgorithm",a)
},getCurrentAlgorithm:function(){return this.get("currentAlgorithm")
},setOfferLevelReportView:function(a){this.set("offerLevelReportView",a)
},getOfferLevelReportView:function(){return this.get("offerLevelReportView")
},setErrorMessage:function(b,a){this.set("errorMessage",{message:b,icon:a})
},defaults:{offerLevelReportView:"byOfferGroup",errorMessage:{message:Granite.I18n.get("We cannot complete your request due to a server error. Please contact Adobe client-care if problem persists."),icon:"icon-alert"}}});
ELM.Models.Content=ELM.Model.extend({defaults:{path:"",name:"",lastModified:"",isHTMLOffer:""},getName:function(){return this.get("name")
},getPath:function(){return this.get("path")
},isHTMLOffer:function(){return this.get("isHTMLOffer")==="text/html"
}});
ELM.Models.MboxItems=ELM.Model.extend({url:"/target/"+ELM.client+"/target/mboxes.at.json?pageSize=2000"});
ELM.Models.Offer=ELM.Model.extend({urlRoot:"offers",defaults:{"jcr:title":"","jcr:content":""}});
"use strict";
ELM.Models.Algorithm=ELM.Model.extend({urlRoot:"setup/recs/algorithms",defaults:function(){return{"jcr:title":"","jcr:description":"",pageTypes:["homePage"],industryType:"RETAIL_ECOMMERCE",configuration:{key:"",type:""},details:{inclusionrules:[],daysCount:"twoWeeks",minInventory:1}}
},ERROR_MESSAGES:{EMPTY_NAME:Granite.I18n.get("Criteria name cannot be empty"),EMPTY_PAGE_TYPE:Granite.I18n.get("Page Type(s) cannot be empty")},parse:function(a){var d=a.configuration,b=d.key,c=d.type;
if(!b){b=c==="recentlyViewed"?ELM.Algorithm.key.RECENTLY_VIEWED:ELM.Algorithm.key.POPULARITY
}else{if(c==="topMetric"){d.type=b;
b=ELM.Algorithm.key.POPULARITY
}}d.key=b;
return a
},clearId:function(){this.unset("id",{silent:true})
},clearPredefined:function(){this.unset("isPredefined",{silent:true})
},getId:function(){return this.get("id")
},getReference:function(){return this.get("reference")
},setTitle:function(a){this.set("jcr:title",a)
},getTitle:function(){return this.get("jcr:title")
},setDescription:function(a){this.set("jcr:description",a)
},getDescription:function(){return this.get("jcr:description")
},setConfiguration:function(b,a){a?this.silentSet("configuration",b):this.set("configuration",b)
},setDataSource:function(a){var b=_.clone(this.getConfiguration());
b.datasource=a;
this.setConfiguration(b)
},getConfiguration:function(){return this.get("configuration")
},setDetails:function(b,a){a?this.silentSet("details",b):this.set("details",b)
},getDetails:function(){return this.get("details")
},getKey:function(){return this.getConfiguration().key
},setSelected:function(a){this.silentSet("selected",a)
},getSelected:function(){return this.get("selected")
},setCompatible:function(a){this.silentSet("compatible",a)
},getCompatible:function(){return this.get("compatible")
},setPageTypes:function(a,b){b?this.silentSet("pageTypes",a):this.set("pageTypes",a)
},getPageTypes:function(){return this.get("pageTypes")
},setIndustryType:function(b,a){a?this.silentSet("industryType",b):this.set("industryType",b)
},getIndustryType:function(){return this.get("industryType")
},setIsReuseable:function(a){this.silentSet("isReuseable",a)
},getIsReuseable:function(){return this.get("isReuseable")
},clearIsReuseable:function(){this.unset("isReuseable",{silent:true})
},setRecAlgoSessionId:function(a){this.silentSet("recAlgoSessionId",a)
},setEntityAttributes:function(a){this.silentSet("entityAttributes",a)
},getEntityAttributes:function(){return this.get("entityAttributes")
},getRecAlgoSessionId:function(){return this.get("recAlgoSessionId")
},clearRecAlgoSessionId:function(){this.unset("recAlgoSessionId",{silent:true})
},createCopy:function(){var a=this.clone();
a.clearId();
a.setTitle("");
a.clearPredefined();
return a
},setValidationError:function(a){this.validationError={message:a||""}
},getValidationError:function(){return this.validationError
},validate:function(){if(!this.getTitle()){this.setValidationError(this.ERROR_MESSAGES.EMPTY_NAME);
return true
}if(this.getPageTypes().length===0){this.setValidationError(this.ERROR_MESSAGES.EMPTY_PAGE_TYPE);
return true
}return null
},getModifiedAttributesToSave:function(b,a){return{compatible:undefined,selected:undefined,isPredefined:undefined,entityAttributes:undefined,reportSuites:undefined,profileAttributes:undefined,scMetrics:undefined,configuration:b,details:a}
},getPrivileges:function(){return this.get("privileges")
},isUserApprover:function(){return this.getPrivileges().toLowerCase().indexOf(ELM.Products.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.getPrivileges().toLowerCase().indexOf(ELM.Products.privilege.WRITE)!==-1
},isUserObserver:function(){return !(this.isUserApprover()||this.isUserEditor())
}});
"use strict";
ELM.Models.AlgorithmConfigurationAndDetails=ELM.Model.extend({defaults:function(){return{configuration:{key:"",type:""},details:{inclusionrules:[],daysCount:"twoWeeks",minInventory:1}}
},ERROR_MESSAGES:{EMPTY_KEY:Granite.I18n.get("Criteria key cannot be empty"),EMPTY_ATTRIBUTE:Granite.I18n.get("Attribute name cannot be empty"),EMPTY_TYPE:Granite.I18n.get("Criteria type cannot be empty"),INVALID_VALUES:Granite.I18n.get("Values should be numeric.")+" "+Granite.I18n.get("Review the highlighted field below"),INVALID_RANGE:Granite.I18n.get("Minimum value must be lower than maximum value.")+" "+Granite.I18n.get("Review the highlighted field below"),INCOMPLETE_SINGLE_RULE:Granite.I18n.get("A Definition is incomplete for 1 inclusion rule.")+" "+Granite.I18n.get("Review the highlighted field below"),INCOMPLETE_MULTIPLE_RULES:Granite.I18n.get("Definitions are incomplete for {0} inclusion rules.")+" "+Granite.I18n.get("Review the highlighted fields below"),INVALID_SINGLE_RULE:Granite.I18n.get("A Definition is invalid for 1 inclusion rule.")+" "+Granite.I18n.get("Review the highlighted field below"),INVALID_MULTIPLE_RULES:Granite.I18n.get("Definitions are invalid for {0} inclusion rules.")+" "+Granite.I18n.get("Review the highlighted fields below"),EMPTY_DATA_SOURCE:Granite.I18n.get("Behavioral data source can not be empty")},setConfiguration:function(b,a){a?this.silentSet("configuration",b):this.set("configuration",b)
},getConfiguration:function(){return this.get("configuration")
},setDataSource:function(a){var b=_.clone(this.getConfiguration());
b.datasource=a;
this.setConfiguration(b,true)
},getDataSource:function(){return this.getConfiguration().datasource
},removeDataSource:function(a){var b=_.clone(this.getConfiguration());
delete b.datasource;
this.setConfiguration(b,a)
},setCustomProfileAttribute:function(a){var b=_.clone(this.getConfiguration());
b.attribute=a;
this.setConfiguration(b,true)
},getCustomProfileAttribute:function(){return this.getConfiguration().attribute
},removeCustomProfileAttribute:function(a){var b=_.clone(this.getConfiguration());
delete b.attribute;
this.setConfiguration(b,a)
},setKey:function(b,a){var c=_.clone(this.getConfiguration());
c.key=b;
this.setConfiguration(c,a)
},getKey:function(){return this.getConfiguration().key
},updateKey:function(b){var g=[ELM.Algorithm.key.CURRENT_ITEM,ELM.Algorithm.key.LAST_VIEWED_ITEM,ELM.Algorithm.key.MOST_VIEWED_ITEM,ELM.Algorithm.key.LAST_PURCHASED_ITEM,ELM.Algorithm.key.CUSTOM_PROFILE_ATTRIBUTE],f=[ELM.Algorithm.key.CURRENT_CATEGORY,ELM.Algorithm.key.FAVORITE_CATEGORY],d=this.getKey(),a=_.contains(g,b),e=_.contains(f,b),c="";
if(d===""||d===ELM.Algorithm.key.POPULARITY||d===ELM.Algorithm.key.RECENTLY_VIEWED||(_.contains(g,d)&&!a)||(_.contains(f,d)&&!e)){if(b===ELM.Algorithm.key.RECENTLY_VIEWED){c="recentlyViewed"
}this.resetDetails(c);
this.setType(c,true)
}if(e||b===ELM.Algorithm.key.RECENTLY_VIEWED||b===ELM.Algorithm.key.POPULARITY){this.removeDataSource(true)
}if(d===ELM.Algorithm.key.CUSTOM_PROFILE_ATTRIBUTE){this.removeCustomProfileAttribute(true)
}this.setKey(b)
},setType:function(b,a){var c=_.clone(this.getConfiguration());
c.type=b;
this.setConfiguration(c,a)
},getType:function(){return this.getConfiguration().type
},updateType:function(d,c){var a=this.getType(),b=["topSellers","topViewed"],c=true;
if(!d||!a||a==="fullDataOptimizing"||d==="fullDataOptimizing"){this.resetDetails(d);
c=false
}if(this.getKey()===ELM.Algorithm.key.POPULARITY&&d){if(_.contains(b,d)&&_.contains(b,a)){c=true
}else{if(_.contains(b,d)){this.removeDataSource(true);
c=false
}else{this.setDataSource("");
c=false
}}}this.setType(d,true);
return c
},setDetails:function(b,a){a?this.silentSet("details",b):this.set("details",b)
},getDetails:function(){return this.get("details")
},resetDetails:function(b){var a=this.defaults().details;
if(b==="fullDataOptimizing"){delete a.inclusionrules;
a.productConfidence="moderate"
}this.setDetails(a,true)
},setInventory:function(b){var a=_.clone(this.getDetails());
a.minInventory=b;
this.setDetails(a,true)
},getInventory:function(){var a=this.getDetails();
return a&&a.minInventory
},removeInventory:function(){var a=_.clone(this.getDetails());
delete a.minInventory;
this.setDetails(a,true)
},setDaysCount:function(b){var a=_.clone(this.getDetails());
a.daysCount=b;
this.setDetails(a,true)
},getDaysCount:function(){var a=this.getDetails();
return a&&a.daysCount
},setProductConfidence:function(a){var b=_.clone(this.getDetails());
b.productConfidence=a;
this.setDetails(b,true)
},getProductConfidence:function(){var a=this.getDetails();
return a&&a.productConfidence
},setInclusionRules:function(c,a){var b=_.clone(this.getDetails());
b.inclusionrules=c;
this.setDetails(b,a)
},getInclusionRules:function(){var a=this.getDetails();
return a&&a.inclusionrules
},addInclusionRule:function(b){var a=_.clone(this.getInclusionRules()),c=this.getDefaultInclusionRule();
c.attribute=b||"";
a.push(c);
this.setInclusionRules(a)
},deleteInclusionRule:function(a){var b=_.clone(this.getInclusionRules());
b.splice(a,1);
this.setInclusionRules(b)
},getDefaultInclusionRule:function(){return{values:[],attribute:"",operation:""}
},setInclusionRule:function(d,b,a){var c=_.clone(this.getInclusionRules());
c[b]=d;
this.setInclusionRules(c,a)
},getInclusionRule:function(a){return this.getInclusionRules()[a]
},shouldResetInclusionRule:function(d,b){var a=d.operation,c=["environment","inventory","margin","value"];
if(b===""){return true
}if(b==="value"&&a==="dynamicallyRanges"){return true
}if(_.intersection(c,[d.attribute,b]).length===1&&!_.contains(["equals","notEquals","dynamicallyRanges","dynamicallyMatches","dynamicallyDoesNotMatch","greaterOrEquals","lesserOrEquals"],a)){return true
}return false
},updateAttribute:function(b,a){var c=_.clone(this.getInclusionRule(a));
if(c.attribute===b){return
}if(this.shouldResetInclusionRule(c,b)){c=this.getDefaultInclusionRule()
}c.attribute=b;
this.setInclusionRule(c,a)
},updateOperation:function(a,b){var c=_.clone(this.getInclusionRule(b));
if(c.operation===a){return
}if(a==="dynamicallyMatches"||a==="dynamicallyDoesNotMatch"){c.values=[]
}if(a==="dynamicallyRanges"){delete c.values;
c.highRange="";
c.lowRange=""
}else{delete c.lowRange;
delete c.highRange;
c.values=c.values||[]
}c.operation=a;
this.setInclusionRule(c,b)
},updateValues:function(a,b){var c=_.clone(this.getInclusionRule(b));
c.values=a;
this.setInclusionRule(c,b)
},updateLowRange:function(b,a){var c=_.clone(this.getInclusionRule(a));
c.lowRange=b;
this.setInclusionRule(c,a)
},updateHighRange:function(b,a){var c=_.clone(this.getInclusionRule(a));
c.highRange=b;
this.setInclusionRule(c,a)
},setPriceOption:function(c,a){var b=_.clone(this.getDetails());
b.priceoption=c;
this.setDetails(b,a)
},getPriceOption:function(){var a=this.getDetails();
return(a&&a.priceoption)||{}
},removePriceOption:function(){var a=_.clone(this.getDetails());
delete a.priceoption;
this.setDetails(a)
},updatePriceType:function(a){var b=_.clone(this.getPriceOption());
if(b.type===a){return
}if(!a){this.removePriceOption();
return
}if(a==="aboveValue"||a==="belowValue"){delete b.min;
delete b.max
}b.type=a;
this.setPriceOption(b)
},getPriceType:function(){return this.getPriceOption().type
},setMinPrice:function(a){var b=_.clone(this.getPriceOption());
b.min=a;
this.setPriceOption(b)
},getMinPrice:function(){return this.getPriceOption().min
},setMaxPrice:function(a){var b=_.clone(this.getPriceOption());
b.max=a;
this.setPriceOption(b)
},getMaxPrice:function(){return this.getPriceOption().max
},setProfileAttributes:function(a){this.set("profileAttributes",a)
},getProfileAttributes:function(){return this.get("profileAttributes")
},removeProfileAttributes:function(){this.unset("profileAttributes",{silent:true})
},setSCMetrics:function(a){this.set("scMetrics",a)
},getSCMetrics:function(){return this.get("scMetrics")
},setReportSuites:function(a){this.set("reportSuites",a)
},getReportSuites:function(){return this.get("reportSuites")
},removeReportSuites:function(){this.unset("reportSuites",{silent:true})
},isInclusionRuleComplete:function(e){var b=e.operation,a=e.lowRange||"",f=e.highRange||"",c,d;
if(b==="dynamicallyMatches"||b==="dynamicallyDoesNotMatch"){return true
}if(b==="dynamicallyRanges"&&(!(ELM.Util.isInteger(a)&&ELM.Util.isInteger(f))||parseInt(a)>=parseInt(f))){return false
}d=a&&f;
c=e.values&&e.values.length>0;
return e.attribute&&b&&(c||d)
},isInclusionRuleEmpty:function(c){var a=!c.values||c.values.length===0,b=!c.lowRange&&!c.highRange;
return !c.attribute&&!c.operation&&a&&b
},setValidationError:function(b,c,a){this.validationError={message:b||"",fieldName:c||"",indexes:a||[]}
},getValidationError:function(){return this.validationError
},isPriceOptionValid:function(){var d=this.getPriceType(),c=this.getMinPrice()||"",a=this.getMaxPrice()||"",b;
if(!d||d==="aboveValue"||d==="belowValue"){return true
}if(!(ELM.Util.isFloat(c)&&ELM.Util.isFloat(a))){b=this.ERROR_MESSAGES.INVALID_VALUES
}else{if(parseFloat(c)>=parseFloat(a)){b=this.ERROR_MESSAGES.INVALID_RANGE
}else{return true
}}this.setValidationError(b,"priceOption")
},isInclusionRulesValid:function(){var c=this.getInclusionRules(),d,e,b,a,f=[];
if(this.getType()==="fullDataOptimizing"){return true
}d=c.length;
for(b=0;
b<d;
b++){e=c[b];
if(!this.isInclusionRuleEmpty(e)&&!this.isInclusionRuleComplete(e)){f.push(b)
}}d=f.length;
if(d>0){a=d===1?this.ERROR_MESSAGES.INCOMPLETE_SINGLE_RULE:Granite.I18n.get(this.ERROR_MESSAGES.INCOMPLETE_MULTIPLE_RULES,[d]);
this.setValidationError(a,"inclusionRules",f);
return false
}return true
},getCompleteInclusionRules:function(){var c=this.getInclusionRules(),d=c.length,a=[],e,b;
this.completeRulesIndexMap=[];
for(b=0;
b<d;
b++){e=c[b];
if(this.isInclusionRuleComplete(e)){a.push(e);
this.completeRulesIndexMap.push(b)
}}return a
},validateConfiguration:function(){if(!this.getKey()){this.setValidationError(this.ERROR_MESSAGES.EMPTY_KEY);
return true
}if(this.getKey()===ELM.Algorithm.key.CUSTOM_PROFILE_ATTRIBUTE&&!this.getCustomProfileAttribute()){this.setValidationError(this.ERROR_MESSAGES.EMPTY_ATTRIBUTE);
return true
}if(!this.getType()){this.setValidationError(this.ERROR_MESSAGES.EMPTY_TYPE);
return true
}if(this.getKey()===ELM.Algorithm.key.RECENTLY_VIEWED){return false
}},validateDetails:function(){if(!this.isPriceOptionValid()){return true
}if(!this.isInclusionRulesValid()){return true
}if(this.getDataSource()===""){this.setValidationError(this.ERROR_MESSAGES.EMPTY_DATA_SOURCE);
return true
}return null
},getModifiedConfigurationToSave:function(){var c=_.clone(this.getConfiguration()),a=c.key,b=c.type;
if(a===ELM.Algorithm.key.POPULARITY&&b!=="topSellers"&&b!=="topViewed"){c.key=c.type;
c.type="topMetric"
}else{if(a===ELM.Algorithm.key.POPULARITY||a===ELM.Algorithm.key.RECENTLY_VIEWED){c.key=""
}}return c
},getModifiedDetailsToSave:function(){var b=this.getType(),a=this.getDetails();
if(b==="recentlyViewed"){a=undefined
}else{if(b!=="fullDataOptimizing"){a=_.clone(a);
a.inclusionrules=this.getCompleteInclusionRules()
}}return a
},handleSaveFailure:function(d){var f=d["error.invalidFields"],a,g=[],c,b,e;
if(f){e=f.length;
for(b=0;
b<e;
b++){a=f[b];
c=parseInt(a.substring(a.indexOf("[")+1,a.indexOf("]")));
c=this.completeRulesIndexMap[c];
if(g.indexOf(c)===-1){g.push(c)
}}this.setValidationError(e===1?this.ERROR_MESSAGES.INVALID_SINGLE_RULE:Granite.I18n.get(this.ERROR_MESSAGES.INVALID_MULTIPLE_RULES,[g.length]),"inclusionRules",g)
}else{this.setValidationError(d["error.message"])
}}});
ELM.Models.Audience=ELM.Model.extend({urlRoot:"audiences",setTitle:function(a){this.silentSet("jcr:title",a)
},setTargets:function(a){this.silentSet("targets",a)
},getReferenceString:function(){return this.get("reference")
},getTitle:function(){return this.get("jcr:title")
},getTargets:function(){return this.get("targets")
},getId:function(){return this.get("id")
},isSelected:function(){return this.get("selected")
},setSelected:function(a){this.set("selected",a)
},toggleSelected:function(){this.setSelected(!this.isSelected())
},defaults:{selected:false,"jcr:title":"",targets:[],size:0}});
ELM.Models.DefaultAudiences=ELM.Model.extend({urlRoot:"audiences",url:function(){return"/apps/mac/"+ELM.bullseyeFolder+"/defaultContent/"+this.urlRoot+"."+ELM.bullseyeSelector+".json"
},parse:function(a){return a.items
}});
"use strict";
ELM.Models.Metric=ELM.Model.extend({defaults:{"jcr:title":"",type:"",action:"",matcher:"exact",worth:"",constraints:[]},getTitle:function(){return this.get("jcr:title")
},getType:function(){return this.get("type")
},getCountingRule:function(){return this.get("countingRule")
},getRevenueType:function(){return this.get("revenueType")
},getEngagementType:function(){return this.get("engagementType")
},getAnalyticsMetricId:function(){return this.get("analyticsMetricId")
},getAction:function(){return this.get("action")
},getMatcher:function(){return this.get("matcher")
},getConstraints:function(){return this.get("constraints")?this.get("constraints"):[]
},getConstraintTerms:function(){return _.pluck(this.getConstraints(),"term")
},getCompactConstraintTerms:function(){return _.compact(this.getConstraintTerms())
},getWorth:function(){return this.get("worth")
},setTitle:function(a){this.silentSet("jcr:title",$.trim(a))
},setType:function(a){this.set("type",a)
},setCountingRule:function(a){this.silentSet("countingRule",a)
},setRevenueType:function(a){this.set("revenueType",a)
},setEngagementType:function(a){this.set("engagementType",a)
},setAnalyticsMetricId:function(a){this.set("analyticsMetricId",a)
},setAnalyticsMetricSource:function(a){this.set("analyticsMetricSource",a)
},setAnalyticsMetrics:function(a){this.set("analyticsMetrics",a)
},clearAnalyticsMetrics:function(){this.unset("analyticsMetrics")
},setAction:function(a){this.set("action",a)
},setMatcher:function(a){this.silentSet("matcher",a)
},setConstraints:function(a){this.set("constraints",a)
},setMboxes:function(a){this.silentSet("mboxes",a)
},setWorth:function(c){c=$.trim(c);
var a=Granite.I18n.getLocale(),b=["de","es","fr","it","pt"];
if(b.indexOf(a)!=-1){c=c.split(".").join("").split(",").join(".")
}else{c=c.split(",").join("")
}this.silentSet("worth",c)
},addConstraint:function(){var a=this.getConstraints();
a.push({matcher:this.getMatcher(),term:"","ref:targetingAudience":"","elm:references":{}});
this.setConstraints(a);
this.trigger("change")
},removeConstraint:function(a){var b=this.getConstraints();
b.splice(a,1);
this.setConstraints(b);
this.trigger("change")
},updateConstraint:function(a,c,b){var d=this.getConstraints();
d[a][c]=$.trim(b);
this.setConstraints(d)
},updateConstraintMatcher:function(){var a=this.getMatcher(),b=_.map(this.getConstraints(),function(c){return _.extend(c,{matcher:a})
});
this.setConstraints(b)
},clearConstraintsSilently:function(){this.unset("constraints",{silent:true})
},clearConstraints:function(){this.unset("constraints")
},clearConstraintsExceptFirst:function(){var a=this.getConstraints();
a.splice(1);
this.setConstraints(a)
},clearAttributesSilently:function(){this.clear({silent:true})
},clearAllAttributesExcept:function(){var a=Array.prototype.slice.call(arguments),b=_.pick(this.attributes,a);
this.clearAttributesSilently();
this.silentSet(b)
},clearMboxes:function(){this.unset("mboxes",{silent:true})
},isGoalMetric:function(){return this.get("isGoalMetric")
},clearIsGoalMetricFlag:function(){this.unset("isGoalMetric",{silent:true})
},getActivityType:function(){return this.get("activityType")||""
},setActivityType:function(a){this.silentSet({activityType:a})
},getReportSuite:function(){return this.get("reportSuite")||""
},setReportSuite:function(a){this.silentSet({reportSuite:a})
},getMetricLocalId:function(){return this.get("metricLocalId")
},setMetricLocalId:function(a){this.silentSet("metricLocalId",a)
}});
ELM.Models.HostGroup=ELM.Model.extend({url:"setup/tt/hostgroups.at.json",defaults:{"jcr:title":""},setUrl:function(a){this.url="setup/tt/hostgroups/"+a+".at.json"
}});
ELM.Models.HostListItem=ELM.Model.extend({defaults:{"jcr:title":"",id:"",uri:""}});
ELM.Models.Plugin=ELM.Model.extend({url:"/target/geometrixx/target/setup/tt/plugins.at.json",defaults:{Name:"",Script:"",ServeCondition:"Display"}});
ELM.Models.AccountPreferences=ELM.Model.extend({url:function(){return"setup/accountPreferences.at.json"
},setTitle:function(a){this.set("jcr:title",a,{validate:true})
},getTitle:function(){return this.get("jcr:title")
},setId:function(a){this.set("id",a)
},getId:function(){return this.get("id")
},setIndustryType:function(a){this.set("industryType",a)
},setDefaultSimulatorUrl:function(a){this.set("defaultSimulatorUrl",a)
},getDefaultSimulatorUrl:function(){return this.get("defaultSimulatorUrl")
},setIsExpThumbsEnabled:function(a){this.set("isExpThumbsEnabled",a)
},getIsExpThumbsEnabled:function(){return this.get("isExpThumbsEnabled")
},setIsProjectedEarningsEnabled:function(a){this.set("isProjectedEarningsEnabled",a)
},getIsProjectedEarningsEnabled:function(){return this.get("isProjectedEarningsEnabled")
},setIsProxyEnabledInEE:function(a){this.set("isProxyEnabledInEE",a)
},getIsProxyEnabledInEE:function(){return this.get("isProxyEnabledInEE")
},setReportingEngine:function(a){this.set("reportingEngine",a)
},getReportingEngine:function(){return this.get("reportingEngine")
},setDefaultReportSuite:function(a){this.silentSet("defaultReportSuite",a)
},getDefaultReportSuite:function(){return this.get("defaultReportSuite")
},setCustomGlobalMbox:function(a){this.silentSet("customGlobalMbox",a)
},getCustomGlobalMbox:function(){return this.get("customGlobalMbox")
},setIsAlgorithmFilteringEnabled:function(a){this.silentSet("isAlgorithmFilteringEnabled",a)
},getIsAlgorithmFilteringEnabled:function(a){return this.get("isAlgorithmFilteringEnabled")
},setMboxes:function(a){this.silentSet("mboxes",a)
},clearMboxes:function(){this.unset("mboxes",{silent:true})
},validate:function(a){var d=Granite.I18n.get("URL cannot contain '\"<>|[]}"),e=Granite.I18n.get("Default Experience Composer URL can not be empty"),c=/["'<>|}\[\]]/,b=a.defaultSimulatorUrl;
if(!b){this.setValidationError(e);
return e
}if(b.match(c)){this.setValidationError(d);
return d
}return null
},setValidationError:function(a){this.validationError=a
},getValidationError:function(){return this.validationError
},defaults:{"jcr:title":"Account Preferences",defaultSimulatorUrl:"",isExpThumbsEnabled:true,isProjectedEarningsEnabled:false,isProxyEnabledInEE:false}});
ELM.Models.MboxSettings=ELM.Model.extend({url:function(){return"setup/mboxSettings.at.json"
},getId:function(){return this.get("id")
},setId:function(a){this.silentSet("id",a)
},setMboxes:function(a){this.silentSet("mboxes",a)
},clearMboxes:function(){this.unset("mboxes",{silent:true})
},getGlobalMboxSetting:function(){return this.get("globalmbox")
},setGlobalMboxSettingSilently:function(b,c){var a={"jcr:title":b,"auto-create":c};
this.silentSet("globalmbox",a)
},defaults:{"jcr:title":"Mbox Settings",globalmbox:{"jcr:title":"target-global-mbox","auto-create":true}}});
ELM.Models.Scene7Settings=ELM.Model.extend({url:function(){return"setup/scene7Settings.at.json"
},setTitle:function(a){this.set("jcr:title",a,{validate:true})
},getTitle:function(){return this.get("jcr:title")
},setId:function(a){this.set("id",a)
},getId:function(){return this.get("id")
},getJcrContent:function(){return this.get("jcr:content")
},setJcrContent:function(a){this.set("jcr:content",a)
},getItemFromJcrContent:function(b){var a=this.getJcrContent();
if(!!a){return a[b]
}return null
},getAdhocFolder:function(){return this.getItemFromJcrContent("adhocFolder")
},setAdhocFolder:function(b){var a=this.getJcrContent();
a.adhocFolder=b;
this.setJcrContent(a)
},getEmail:function(){return getItemFromJcrContent("email")
},setEmail:function(b){var a=this.getJcrContent();
a.email=b;
this.setJcrContent(a)
},getPassword:function(){return this.getItemFromJcrContent("password")
},setPassword:function(b){var a=this.getJcrContent();
a.password=b;
this.setJcrContent(a)
},getRegion:function(){return getItemFromJcrContent("region")
},setRegion:function(b){var a=this.getJcrContent();
a.region=b;
this.setJcrContent(a)
},validate:function(a){if(!a["jcr:content"]){this.setValidationError(Granite.I18n.get("Cannot save Scene7 settings."));
return"Cannot save Scene7 settings"
}if(!a["jcr:content"].adhocFolder){this.setValidationError(Granite.I18n.get("Adhoc folder cannot be empty"));
return"Adhoc folder cannot be empty"
}if(!a["jcr:content"].email){this.setValidationError(Granite.I18n.get("Email cannot be empty"));
return"Email cannot be empty"
}if(!a["jcr:content"].password){this.setValidationError(Granite.I18n.get("Password cannot be empty"));
return"Password cannot be empty"
}if(!a["jcr:content"].region){this.setValidationError(Granite.I18n.get("Region cannot be empty"));
return"Email cannot be empty"
}return null
},setValidationError:function(a){this.validationError=a
},getValidationError:function(){return this.validationError
},defaults:{"jcr:title":"Scene7 Settings","jcr:content":{}}});
ELM.Models.UserRole=ELM.Model.extend({urlRoot:"setup/userRoles",defaults:function(){return{"jcr:title":"",Avatar:"",email:"",groups:[]}
},getUserId:function(){return this.get("userId")
},updateGroup:function(a){this.set("groups",a)
},getGroups:function(){return this.get("groups")
}});
ELM.Models.ProductFilter=ELM.Model.extend({defaults:function(b){var a={"jcr:title":"",rules:[{attributeName:b||"name",operator:"contains",operands:[]}]};
if(this.isNumericAttribute(b)){a.rules[0].operator="equals"
}return a
},ERROR_MESSAGES:{INCOMPLETE_SINGLE_RULE:Granite.I18n.get("A Definition is incomplete for 1 rule.")+" "+Granite.I18n.get("Review the highlighted field below"),INCOMPLETE_MULTIPLE_RULES:Granite.I18n.get("Definitions are incomplete for {0} rules.")+" "+Granite.I18n.get("Review the highlighted fields below"),INVALID_SINGLE_RULE:Granite.I18n.get("A Definition is invalid for 1 rule.")+" "+Granite.I18n.get("Review the highlighted field below"),INVALID_MULTIPLE_RULES:Granite.I18n.get("Definitions are invalid for {0} rules.")+" "+Granite.I18n.get("Review the highlighted fields below")},getId:function(){return this.get("id")
},getReference:function(){return this.get("reference")
},clearId:function(){this.unset("id",{silent:true})
},setTitle:function(a){this.set("jcr:title",a,{silent:true})
},getTitle:function(){return this.get("jcr:title")
},setDescription:function(a){this.set("jcr:description",a,{silent:true})
},setRules:function(b,a){a?this.silentSet("rules",b):this.set("rules",b)
},getRules:function(){return this.get("rules")
},setRule:function(c,b,a){var d=_.clone(this.getRules());
d[b]=c;
this.setRules(d,a)
},getRule:function(a){return this.getRules()[a]
},addRule:function(a){var b=_.clone(this.getRules());
b.push(a);
this.setRules(b)
},getDefaultRule:function(a){return this.defaults(a).rules[0]
},addDefaultRule:function(){this.addRule(this.getDefaultRule())
},deleteRule:function(a){var b=_.clone(this.getRules());
b.splice(a,1);
if(b.length===0){b.push(this.getDefaultRule())
}this.setRules(b)
},getActiveColumns:function(){return this.get("activeColumns")
},setActiveColumnsNames:function(b,a){a?this.silentSet("activeColumns",b):this.set("activeColumns",b)
},setAttributeName:function(b,a){var c=_.clone(this.getRule(a));
if(b===c.attributeName){return
}if(this.shouldResetRule(c,b)){c=this.getDefaultRule(b)
}c.attributeName=b;
this.setRule(c,a)
},setOperator:function(a,b){var c=_.clone(this.getRule(b));
if(c.operator===a){return
}c.operator=a;
this.setRule(c,b)
},setOperands:function(c,b,a){var d=_.clone(this.getRule(b));
if(!_.isEqual(d.operands,c)){d.operands=c;
this.setRule(d,b,a)
}},setViewMode:function(a){this.silentSet("isViewMode",a)
},setEntityAttributes:function(a){this.silentSet("entityAttributes",a)
},createCopy:function(){var a=this.clone();
a.clearId();
a.setTitle("");
return a
},isNumericAttribute:function(a){return _.contains(["environment","inventory","margin","value"],a)
},isNumericOperator:function(a){return _.contains(["equals","notEquals","greaterOrEquals","lesserOrEquals"],a)
},shouldResetRule:function(c,a){var b=this.isNumericAttribute(a)^this.isNumericAttribute(c.attributeName);
if(b&&!this.isNumericOperator(c.operator)){return true
}return false
},setValidationError:function(b,c,a){this.validationError={message:b||"",fieldName:c||"",indexes:a||[]}
},getValidationError:function(){return this.validationError
},isRulesValid:function(b){var g=b||this.getRules(),a=["isValuePresent","isValueNotPresent","range"],e=g.length,f=[],d="",c=e;
while(c--){if((a.indexOf(g[c].operator)===-1)&&!g[c].operands.length){f.push(c)
}}e=f.length;
if(e>0){d=e===1?this.ERROR_MESSAGES.INCOMPLETE_SINGLE_RULE:Granite.I18n.get(this.ERROR_MESSAGES.INVALID_MULTIPLE_RULES,[e]);
this.setValidationError(d,"rules",f);
return false
}return true
},validate:function(){if(!this.getTitle()){this.setValidationError(this.ERROR_MESSAGES.EMPTY_NAME||Granite.I18n.get("Name cannot be empty"));
return true
}if(!this.isRulesValid()){return true
}return null
},handleSaveFailure:function(d){var f=d["error.invalidFields"],a,g=[],c,b,e;
if(f){e=f.length;
for(b=0;
b<e;
b++){a=f[b];
c=parseInt(a.substring(a.indexOf("[")+1,a.indexOf("]")));
if(g.indexOf(c)===-1){g.push(c)
}}this.setValidationError(e===1?this.ERROR_MESSAGES.INVALID_SINGLE_RULE:Granite.I18n.get(this.ERROR_MESSAGES.INVALID_MULTIPLE_RULES,[g.length]),"rules",g)
}else{this.setValidationError(d["error.message"])
}},getPrivileges:function(){return this.get("privileges")
},isUserApprover:function(){return this.getPrivileges().toLowerCase().indexOf(ELM.Products.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.getPrivileges().toLowerCase().indexOf(ELM.Products.privilege.WRITE)!==-1
},isUserObserver:function(){return !(this.isUserApprover()||this.isUserEditor())
},getModifiedAttributesToSave:function(){return{entityAttributes:undefined}
},setProductCount:function(b,a){a?this.silentSet("productCount",b):this.set("productCount",b)
}});
ELM.Models.ProductSearch=ELM.Models.ProductFilter.extend({isNumericOperator:function(a){return _.contains(["equals","notEquals","greaterOrEquals","lesserOrEquals","isValuePresent","isValueNotPresent"],a)
}});
ELM.Models.FeedIndexer=ELM.Model.extend({defaults:function(){return{"jcr:title":"indexFeed"}
},url:"/target/"+ELM.client+"/target/setup/recs/indexTriggers.at.json",parse:function(b){var a=this.get("environmentId"),c;
if(b.items){_.each(b.items,function(d){if(d.environmentId===a){c=d
}});
return c
}return b
}});
ELM.Models.ProductFacetsList=ELM.Model.extend({defaults:function(){return{category:"all",brand:"",environment:{hostGroups:[],selectedId:0},collections:[]}
},getEnvironmentId:function(){return this.get("environment").selectedId
},setEnvironmentId:function(c,b){var a=ELM.Util.clone(this.get("environment"));
a.selectedId=c;
this.set("environment",a,b)
}});
ELM.Models.ProductFacetsFilter=ELM.Models.ProductSearch.extend({defaults:function(){return{searchBy:"all",simpleSearch:"",hostGroups:[],facets:["brand","category"],rules:[],facetRules:[]}
},setSearchAttribute:function(a){this.set("searchBy",a)
},getSearchAttribute:function(){return this.get("searchBy")
},getAllFacetRules:function(){var a={},b=[];
_.each(this.get("facetRules"),function(c){_.each(c.rules,function(e){var d=a[e.attributeName];
if(!d){a[e.attributeName]=e
}else{d.operands=_.union(d.operands,e.operands)
}})
});
_.each(a,function(c){b=_.union(b,c)
});
return b
},getFacetRules:function(){return this.get("facetRules")
},getFacetRuleIndex:function(a){var b=-1;
_.each(this.get("facetRules"),function(d,c){if(d.name===a){b=c
}});
return b
},removeAllFacetRules:function(){this.set("facetRules",[])
},removeFacetRules:function(c){var a=ELM.Util.clone(this.get("facetRules")),b=this.getFacetRuleIndex(c);
a.splice(b,1);
this.set("facetRules",a)
},addFacetRules:function(d){var a=ELM.Util.clone(this.get("facetRules")),e=this.getFacetRuleIndex(d.name),b=e!==-1?e:a.length,c=a[b]||{name:d.name};
c.rules=d.rules;
a[b]=c;
this.set("facetRules",a)
},setSearchString:function(b,a){this.set("simpleSearch",b,a||{silent:true})
},getSearchString:function(){return this.get("simpleSearch")
},unsetAttributeRule:function(){this.unset("attributeRule")
},setAttributeRule:function(a){this.set("attributeRule",a)
},getFreeSearchRule:function(a){return{attributeName:a||"name",operator:"freeSearch",operands:[]}
},getAttributeRule:function(){var b=this.getSearchAttribute(),c=this.get("attributeRule"),a;
if(c&&b===c.attributeName){return c
}a=this.getFreeSearchRule(b);
this.setAttributeRule(a);
return a
},getHostGroups:function(){return this.get("hostGroups")
},setHostGroups:function(a){this.set("hostGroups",a)
},isDefaultRuleValid:function(){var a=this.get("attributeRule");
return !_.isUndefined(a)&&(a.operands.length!==0)
},isFacetRulesValid:function(){var a=this.get("facetRules"),c=a.length!==0,b=this;
_.each(a,function(d){c=c&&b.isRulesValid(d.rules)
});
return c
},validate:function(){if(this.get("searchBy")==="all"){return this.get("simpleSearch")!==""||this.isFacetRulesValid()
}else{return this.isDefaultRuleValid()||this.isFacetRulesValid()
}}});
ELM.Models.ProductSearchListItem=ELM.Model.extend({defaults:{environment:"",inventory:"",margin:"",message:"",name:"",baseUrl:"",pageUrl:"",thumbnailUrl:"",value:""}});
ELM.Models.Catalog=ELM.Models.ProductFilter.extend({urlRoot:"products/catalogs",ERROR_MESSAGES:_.extend({EMPTY_NAME:Granite.I18n.get("Collection name can not be empty")},ELM.Models.ProductFilter.prototype.ERROR_MESSAGES)});
ELM.Models.Feed=ELM.Model.extend({urlRoot:"products/feeds",defaults:function(){return{"jcr:title":"",isViewMode:false,feedType:"",scheduleType:"",environmentId:-1,connection:{type:"",attributes:{}}}
},clearId:function(){this.unset("id",{silent:true})
},getId:function(){return this.get("id")
},getPrivileges:function(){return this.get("privileges")||""
},isUserApprover:function(){return this.getPrivileges().toLowerCase().indexOf(ELM.Products.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.getPrivileges().toLowerCase().indexOf(ELM.Products.privilege.WRITE)!==-1
},isUserObserver:function(){return !(this.isUserApprover()||this.isUserEditor())
},isImportedItem:function(){return this.getPrivileges().toLowerCase().indexOf(ELM.Products.privilege.WRITE)===-1
},setTitle:function(a){this.set("jcr:title",a,{silent:true})
},getTitle:function(){return this.get("jcr:title")
},setViewMode:function(a){this.silentSet("isViewMode",a)
},getViewMode:function(){return this.get("isViewMode")
},setFeedType:function(a){this._initializeAttributeMapping(a);
this.set("feedType",a)
},getFeedType:function(){return this.get("feedType")
},hasFeedType:function(){return this.getFeedType()
},getConnection:function(){return this.get("connection")
},silentSetConnection:function(a){this.silentSet("connection",a)
},setConnection:function(a){this.set("connection",a)
},setEnvironmentId:function(a){this.silentSet("environmentId",a)
},getEnvironmentId:function(){return this.get("environmentId")
},setScheduleType:function(a){this.set("scheduleType",a)
},getScheduleType:function(){return this.get("scheduleType")
},setEntityAttributes:function(a){this.silentSet("entityAttributes",a)
},getEntityAttributes:function(){return this.get("entityAttributes")
},setHostGroups:function(a){this.set("hostGroups",a)
},getHostGroups:function(){return this.get("hostGroups")
},setGoogleFeedAttributes:function(a){this.silentSet("googleFeedAttributes",a)
},getGoogleFeedAttributes:function(){return this.get("googleFeedAttributes")
},setSaintAttributes:function(a){this.silentSet("saintAttributes",a)
},getSaintAttributes:function(){return this.get("saintAttributes")
},setAttributeMapping:function(a,b){if(b){this.silentSet("attributemapping",a)
}else{this.set("attributemapping",a)
}},getAttributeMapping:function(){return this.get("attributemapping")
},_initializeAttributeMapping:function(a){var b=undefined;
if(a===ELM.Products.FeedTypes.GOOGLE_FEED||a===ELM.Products.FeedTypes.SAINT){b=[{"jcr:title":"",value:"id"}]
}this.setAttributeMapping(b,true)
},silentSetConnectionType:function(b){var a=ELM.Util.clone(this.getConnection());
a.type=b;
a.attributes={};
this.silentSetConnection(a)
},setConnectionType:function(b){var a=ELM.Util.clone(this.getConnection());
a.type=b;
a.attributes={};
this.setConnection(a)
},getConnectionType:function(){return this.getConnection().type
},getAnalyticsReportSuite:function(){var a=this.getConnection(),b=this.getFeedType()===ELM.Products.FeedTypes.SAINT;
return b&&a.attributes.REPORTSUITE
},silentSetConnectionAttribute:function(c,d){var b=ELM.Util.clone(this.getConnection()),a=b.attributes;
a[c]=d;
this.silentSetConnection(b)
},setAnalyticsSuites:function(a){this.set("suites",a)
},createBackUp:function(){return jQuery.extend(true,{},this.toJSON())
},isChanged:function(a){if(typeof a==="object"){return !_.isEqual(a,this.toJSON())
}},setLastUpload:function(a){this.set("lastupload",a)
},unsetLastUpload:function(){this.unset("lastupload")
},getLastUpload:function(){return this.get("lastupload")
},setTargetSyncPending:function(a){this.set("targetSyncPending",a)
},getTargetSyncPending:function(){return this.get("targetSyncPending")
},setLastIndexed:function(a){this.set("lastIndexed",a)
},getLastIndexed:function(){return this.get("lastIndexed")
},createCopy:function(){var a=this.clone();
a.clearId();
a.setTitle("");
a.unsetLastUpload();
return a
}});
ELM.Models.ActionsInsertElement=ELM.Model.extend({defaults:function(){return{elementType:"div",content:"",selectorId:"cdq_element_"+new Date().getTime(),action:"insertAfter"}
},initialize:function(){this.setContent(this.getDefaultContent())
},defaultImageSrc:"//"+window.location.host+"/apps/mac/target/components/common/images/image-placeholder.png",getDefaultContent:function(){return Granite.I18n.get("Add Content Here.")
},getContentText:function(c){var c=c||{},b=c.content||"",a=this.getElementType(),d="<"+a,e="</"+a+">";
if(a==="img"){return d+' src="'+c.src+'">'+e
}return d+">"+b+e
},getContentForInsertElementAction:function(a){var b=this.getContent().trim(),a=a||{};
if(a.type=="text"){b=this.convertInnerHTMLToText(b)
}if(a.src){b=$(this.getContentText(a))[0].outerHTML
}return this.addIdIfNotExists(b)
},convertInnerHTMLToText:function(b){var a=$("<span></span>");
a.text(b);
return a[0].outerHTML
},addIdIfNotExists:function(a){var b=document.createElement("div");
b.innerHTML=a;
if(b.children.length>1||!b.firstElementChild){b.id=this.getSelectorId();
return b.outerHTML
}if(!b.firstElementChild.id){b.firstElementChild.id=this.getSelectorId()
}return b.innerHTML
},updateElementType:function(a){this.silentSet("elementType",a);
this.setContent(this.getDefaultContent())
},silentSetContent:function(a){this.silentSet("content",a)
},setContent:function(a){return this.set("content",a)
},getContent:function(){return this.get("content")
},silentSetAction:function(a){this.silentSet("action",a)
},getAction:function(){return this.get("action")
},getSelectorId:function(){return this.get("selectorId")
},getElementType:function(){return this.get("elementType")
}});
ELM.Models.ExperienceEditorInteractMode=ELM.Model.extend({defaults:function(){return{controlUrl:"",history:[],historyIndex:-1}
},setControlUrl:function(b,a){a?this.silentSet("controlUrl",b):this.set("controlUrl",b)
},getControlUrl:function(){return this.get("controlUrl")
},setHistoryIndex:function(b,a){a?this.silentSet("historyIndex",b):this.set("historyIndex",b)
},getHistoryIndex:function(){return this.get("historyIndex")
},setHistory:function(b,a){a?this.silentSet("history",b):this.set("history",b)
},getHistory:function(){return this.get("history")
},addToHistory:function(a){var c=this.getHistory(),b=this.getHistoryIndex();
if(a&&c[b]!==a){c.length=b+1;
c.push(a);
b=c.length-1
}this.setHistoryIndex(b,true);
this.setHistory(c,true)
},doForward:function(){this.setControlUrl(this.getHistory()[this.getHistoryIndex()+1],true);
this.setHistoryIndex(this.getHistoryIndex()+1)
},doBackward:function(){this.setControlUrl(this.getHistory()[this.getHistoryIndex()-1],true);
this.setHistoryIndex(this.getHistoryIndex()-1)
}});
ELM.Models.ProfileTargetedAlgorithms=ELM.Model.extend({url:"/target/"+ELM.client+"/target/setup/profiletargeted/algorithms.at.json"});
"use strict";
ELM.Models.TrafficEstimation=ELM.Model.extend({urlRoot:null,trafficEstimationStrategy:null,getTrafficEstimationStrategy:function(){if(!this.trafficEstimationStrategy){if(this.Formula){this.trafficEstimationStrategy=new this.Formula()
}else{throw new Error("Traffic estimation formula not defined.")
}}return this.trafficEstimationStrategy
},getTestDurationInDays:function(){var b=0;
var a=this.getTestDurationUnit();
if(a==="days"){b=this.ensureIntOrNull(this.getTestDuration())
}else{if("weeks"===a){b=this.ensureIntOrNull(this.getTestDuration())*7
}else{throw new Error("Unsupported testDurationUnit: ",a)
}}return b
},setTestDurationUnit:function(a){if(this.ALLOWED_TEST_DURATION_UNITS.indexOf(a)<0){throw new Error("Not an allowed test duration unit: "+a)
}this.silentSet("testDurationUnit",a)
},getTestDurationUnit:function(){return this.get("testDurationUnit")
},setTestDuration:function(a){var b=this._getValidInteger(a);
this.silentSet("testDuration",b,{validate:true,key:"testDuration"});
if(!this.validationError){this.updateDependentValues()
}},getTestDuration:function(){return this.get("testDuration")
},setConversionRate:function(b){var a=Number(b).valueOf();
this.silentSet("conversionRate",a,{validate:true,key:"conversionRate"});
if(!this.validationError){this.updateDependentValues()
}},getConversionRate:function(){return this.get("conversionRate")
},getActivityTraffic:function(){return this.get("activityTraffic")
},setActivityTraffic:function(b){var a=this._getValidInteger(b);
this.silentSet("activityTraffic",a,{validate:true,key:"activityTraffic"});
if(!this.validationError){this.updateDependentValues()
}},setExperienceCount:function(a){this.silentSet("experienceCount",a);
this.updateDependentValues()
},getExperienceCount:function(){return this.get("experienceCount")
},setStatisticallyOk:function(a){this.silentSet("statisticallyOk",a)
},setActivityDates:function(a,b){var c=false;
if(this.getStartDate()!==a){c=true;
this.silentSet("startDate",a)
}if(this.getEndDate()!==b){c=true;
this.silentSet("endDate",b)
}if(c){this.resetTestDuration()
}},setStartDate:function(a){if(this.getStartDate()!==a){this.silentSet("startDate",a);
this.resetTestDuration()
}},getStartDate:function(){return this.get("startDate")
},setEndDate:function(a){if(this.getEndDate()!==a){this.silentSet("endDate",a);
this.resetTestDuration()
}},getEndDate:function(){return this.get("endDate")
},hasAllData:function(){if(!_.isNull(this.validationError)){return false
}return this.getConversionRate()&&this.getActivityTraffic()&&this.getTestDurationInDays()
},resetTestDuration:function(){if(this.getStartDate()&&this.getEndDate()){var b=moment(this.getEndDate()).toDate().getTime()-moment(this.getStartDate()).toDate().getTime();
var a=Math.floor((b+3000)/this.MS_PER_DAY);
this.setTestDuration(a);
this.setTestDurationUnit("days")
}},reset:function(b){var c=this.defaults(),a={};
b=b||{};
if(b.userValuesOnly){a.activityTraffic=c.activityTraffic;
a.testDuration=c.testDuration;
a.testDurationUnit=c.testDurationUnit;
a.conversionRate=c.conversionRate
}else{a=c
}this.set(a,{silent:true});
this.trigger("change");
this.updateDependentValues()
},validationErrors:{CONVERSION_RATE_INVALID:{field:"conversionRate",message:Granite.I18n.get("Conversion rate must be a valid number.")},CONVERSION_RATE_NOT_IN_RANGE:{field:"conversionRate",message:Granite.I18n.get("Conversion rate must be greater than 0 and less than or equal to 100%.")},TRAFFIC_INVALID:{field:"activityTraffic",message:Granite.I18n.get("Activity impressions must be a valid number.")},TRAFFIC_NOT_IN_RANGE:{field:"activityTraffic",message:Granite.I18n.get("Activity impressions must be between 0 and 1,000,000,000,000.")},DURATION_INVALID:{field:"testDuration",message:Granite.I18n.get("Test duration must be a valid number.")},DURATION_BELOW_RANGE:{field:"testDuration",message:Granite.I18n.get("Test duration must be greater than 0.")}},_validators:{conversionRate:function(b){var a=ELM.Models.TrafficEstimation.prototype.validationErrors;
if(_.isNaN(b)){return a.CONVERSION_RATE_INVALID
}if(b<=0||b>100){return a.CONVERSION_RATE_NOT_IN_RANGE
}},activityTraffic:function(b){var a=ELM.Models.TrafficEstimation.prototype.validationErrors;
if(_.isUndefined(b)){return a.TRAFFIC_INVALID
}if(b<=0||b>1000000000000){return a.TRAFFIC_NOT_IN_RANGE
}},testDuration:function(b){var a=ELM.Models.TrafficEstimation.prototype.validationErrors;
if(_.isUndefined(b)){return a.DURATION_INVALID
}if(b<=0){return a.DURATION_BELOW_RANGE
}}},validate:function(c,b){var a=b.key,d=this._validators[a];
if(typeof d==="function"){return d(c[a])
}},_getValidInteger:function(a){var b=/^-?\d+$/;
if(!b.test(a)){return void 0
}return Number(a).valueOf()
},ensureIntOrNull:function(b){var a=null;
if(typeof b!=="number"){try{a=parseInt(b,10)
}catch(c){}}else{a=b
}if(_.isNaN(a)){a=null
}if(a!=null){a=Math.round(a)
}return a
},ensureFloatOrNull:function(b){var a=null;
if(typeof b!=="number"){try{a=parseFloat(b)
}catch(c){}}else{a=b
}if(_.isNaN(a)){a=null
}return a
},ALLOWED_TEST_DURATION_UNITS:["days","weeks"],NEAR_CERTAIN_PROBABILITY:99.99999999999,MS_PER_DAY:24*60*60*1000,defaults:function(){return{statisticallyOk:false,activityTraffic:null,experienceCount:0,testDuration:14,testDurationUnit:"days",conversionRate:1.5,startDate:null,endDate:null}
}});
"use strict";
ELM.Models.TrafficEstimation.ExperienceAdjustedABFormula=new Class({toString:"TrafficEstimation.ExperienceAdjustedABFormula",doublesEqual:function(e,c,d){if(_.isUndefined(d)){d=1e-12
}return Math.abs(e-c)<=d*Math.abs(e)
},getInverseNormalQuantile:function(a){return -Math.sqrt(2)*this.getInverseComplementaryErrorFunction(2*a)
},getComplementaryErrorFunction:function(a){if(a>=0){return this.getChebyshevApproximationForComplementaryErrorFunction(a)
}return 2-this.getChebyshevApproximationForComplementaryErrorFunction(-a)
},getChebyshevApproximationForComplementaryErrorFunction:function(h){var c,f,b,e,g=0,a=0;
if(h<0){throw new Error("getChebyshevApproximationForErrorFunction requires nonnegative argument")
}f=2/(2+h);
b=4*f-2;
for(c=this.ERROR_FUNCTION_APPROXIMATION_CHEBYSHEV_COEFFICIENTS.length-1;
c>0;
c--){e=g;
g=b*g-a+this.ERROR_FUNCTION_APPROXIMATION_CHEBYSHEV_COEFFICIENTS[c];
a=e
}return f*Math.exp(-h*h+0.5*(this.ERROR_FUNCTION_APPROXIMATION_CHEBYSHEV_COEFFICIENTS[0]+b*g)-a)
},getInverseComplementaryErrorFunction:function(f){var a,e,d,b,c;
if(f>=2){return -100
}if(f<=0){return 100
}b=(f<1)?f:2-f;
d=Math.sqrt(-2*Math.log(b/2));
a=-0.70711*((2.30753+d*0.27061)/(1+d*(0.99229+d*0.04481))-d);
for(c=0;
c<2;
c++){e=this.getComplementaryErrorFunction(a)-b;
a+=e/(1.1283791670955126*Math.exp(-(a*a))-a*e)
}return(f<1?a:-a)
},estimateRequiredVisits:function(o){o=o||{};
var j=o.experienceCount,i=o.conversionRate,e=o.powerPercent,l=o.significanceLevel,c=o.conversionRateDeltaTarget,g,h,f,a,d,b,n,k,m;
if(j==null||j<1){return 0
}if(!(i>0&&i<=1)){throw new Error("conversionRate must be between 0 (excl.) and 1 inclusive")
}if(c<=0){throw new Error("relativeConversionRateDiff must be greater than 0")
}if(e<0||e>1){throw new Error("powerPercent must be between 0 and 1, inclusive")
}if(l<0||l>1){throw new Error("significanceLevel must be between 0 and 1, inclusive")
}g=i*c;
h=i;
if(g>1-i&&!this.doublesEqual(g,1-i)){if(i<=0.5){g=1-i
}else{if(i<g){g=i
}h=Math.max(0,i-g)
}}f=Math.min(1,h+g);
a=(h*(1-h)+f*(1-f))/2;
d=l/Math.max(1,j-1);
b=this.getInverseNormalQuantile(1-(d/2));
n=this.getInverseNormalQuantile(e);
k=n+b;
m=(2*a*k*k)/(g*g);
return Math.ceil(j*m)
},estimatePossibleExperienceCount:function(b){var d=b.availableVisits,c,e,f,g,a;
c={experienceCount:0,conversionRate:b.conversionRate,powerPercent:b.powerPercent,significanceLevel:b.significanceLevel,conversionRateDeltaTarget:b.conversionRateDeltaTarget};
e=12.5;
g=0;
while(g<=d){e=Math.floor(e*2);
c.experienceCount=e;
g=this.estimateRequiredVisits(c)
}f=0;
while(true){if(e<=f){return f
}a=Math.floor((e-f)/2)+f;
c.experienceCount=a;
g=this.estimateRequiredVisits(c);
if(d<g){e=a
}else{if(e-f===1){c.experienceCount=e;
g=this.estimateRequiredVisits(c);
if(g<=d){return e
}else{return f
}}f=a
}}},ERROR_FUNCTION_APPROXIMATION_CHEBYSHEV_COEFFICIENTS:[-1.3026537197817094,0.6419697923564902,0.019476473204185836,-0.00956151478680863,-0.000946595344482036,0.000366839497852761,0.000042523324806907,-0.000020278578112534,-0.000001624290004647,0.00000130365583558,1.5626441722e-8,-8.5238095915e-8,6.529054439e-9,5.059343495e-9,-9.91364156e-10,-2.27365122e-10,9.6467911e-11,2.394038e-12,-6.886027e-12,8.94487e-13,3.13092e-13,-1.12708e-13,3.81e-16,7.106e-15,-1.523e-15,-9.4e-17,1.21e-16,-2.8e-17]});
"use strict";
ELM.Models.TrafficEstimation.OneToOneFormula=new Class({toString:"TrafficEstimation.OneToOneFormula",estimateRequiredDaysToBuildModel:function(a){return Math.ceil(((300*a.experienceCount)/a.conversionRate)/a.dailyTraffic)
},canModelBuildInTime:function(b,a){return b<=Math.ceil(0.5*a)&&b<=14
},estimatePossibleExperienceCount:function(a){var b=Math.min(14,Math.floor(0.5*a.testDurationInDays));
return Math.floor((b*a.conversionRate*a.dailyTraffic)/300)
}});
"use strict";
ELM.Models.TrafficEstimationMVT=ELM.Models.TrafficEstimation.extend({Formula:ELM.Models.TrafficEstimation.ExperienceAdjustedABFormula,updateDependentValues:function(){var b=this.calculateRequiredImpressions();
this.setRequiredImpressions(b);
var a=this.getRecommendedExperienceCount();
this.setRecommendedExperienceCount(a);
this.setStatisticallyOk(this.isStatisticallyOk())
},getRecommendedExperienceCount:function(){var c=this.getActivityTraffic(),a=this.getConversionRate(),b=this.getTestDurationInDays();
if(c&&b&&a>0){return this.getTrafficEstimationStrategy().estimatePossibleExperienceCount({availableVisits:c*b,conversionRate:a/100,powerPercent:this.getStatisticalPower()/100,significanceLevel:this.getSignificanceLevel(),conversionRateDeltaTarget:this.getConversionRateDeltaTarget()})
}return 0
},calculateRequiredImpressions:function(){var c=this.getExperienceCount(),a=this.getConversionRate(),b=0;
if(c>0&&a>0){b=this.getTrafficEstimationStrategy().estimateRequiredVisits({experienceCount:c,conversionRate:a/100,powerPercent:this.getStatisticalPower()/100,significanceLevel:this.getSignificanceLevel(),conversionRateDeltaTarget:this.getConversionRateDeltaTarget()})
}return b
},getRecommendedTestDurationInDays:function(){var a=this.getRequiredImpressions();
var b=this.getActivityTraffic();
if(!(_.isNumber(a)&&a>=0)){throw new Error("Required impressions must be present and >= 0")
}return b?Math.ceil(a/b):0
},setRecommendedTestDuration:function(a){this.silentSet("recommendedTestDuration",a)
},setRecommendedExperienceCount:function(a){this.silentSet("recommendedExperienceCount",a)
},getRequiredImpressions:function(){return this.get("requiredImpressions")
},setRequiredImpressions:function(a){this.silentSet("requiredImpressions",a)
},isStatisticallyOk:function(){return this.getRecommendedExperienceCount()>=this.getExperienceCount()
},getSignificanceLevelComplement:function(){return this.get("significanceLevelComplement")
},getSignificanceLevel:function(){return 1-this.getSignificanceLevelComplement()/100
},setSignificanceLevelComplement:function(b){var a=this.ensureFloatOrNull(b);
this.silentSet("significanceLevelComplement",_.isNull(a)?70:Math.min(Math.max(70,a),this.NEAR_CERTAIN_PROBABILITY));
this.updateDependentValues()
},getStatisticalPower:function(){return this.get("statisticalPower")
},setStatisticalPower:function(b){var a=this.ensureFloatOrNull(b);
this.silentSet("statisticalPower",_.isNull(a)?70:Math.min(Math.max(70,a),this.NEAR_CERTAIN_PROBABILITY));
this.updateDependentValues()
},getConversionRateDeltaTarget:function(){return this.get("conversionRateDeltaTarget")
},defaults:function(){return{statisticallyOk:false,recommendedTraffic:27589,activityTraffic:null,experienceCount:0,testDuration:14,testDurationUnit:"days",recommendedTestDuration:2,conversionRate:1.5,statisticalPower:80,significanceLevelComplement:95,conversionRateDeltaTarget:0.25,startDate:null,endDate:null}
}});
"use strict";
ELM.Models.TrafficEstimationOneToOne=ELM.Models.TrafficEstimation.extend({Formula:ELM.Models.TrafficEstimation.OneToOneFormula,updateDependentValues:function(){this.setRecommendedTestDuration(this.getRecommendedTestDurationInDays());
this.setRecommendedExperienceCount(this.getRecommendedExperienceCount());
this.setStatisticallyOk(this.isStatisticallyOk())
},getRecommendedTestDurationInDays:function(){var d=this.getActivityTraffic(),a=this.getConversionRate(),b=this.getTestDurationInDays(),c=this.getExperienceCount();
if(d&&b&&a>0){return this.getTrafficEstimationStrategy().estimateRequiredDaysToBuildModel({experienceCount:c,conversionRate:a/100,dailyTraffic:d,testDurationInDays:b})
}},setRecommendedTestDuration:function(a){this.silentSet("recommendedTestDuration",a)
},getRecommendedExperienceCount:function(){var c=this.getActivityTraffic(),a=this.getConversionRate(),b=this.getTestDurationInDays();
if(c&&b&&a>0){return this.getTrafficEstimationStrategy().estimatePossibleExperienceCount({dailyTraffic:c,testDurationInDays:b,conversionRate:a/100})
}return 0
},setRecommendedExperienceCount:function(a){this.silentSet("recommendedExperienceCount",a)
},isStatisticallyOk:function(){return this.getTrafficEstimationStrategy().canModelBuildInTime(this.getRecommendedTestDurationInDays(),this.getTestDurationInDays())
}});
ELM.Models.Exclusion=ELM.Models.ProductFilter.extend({urlRoot:"products/exclusions",ERROR_MESSAGES:_.extend({EMPTY_NAME:Granite.I18n.get("Exclusion name can not be empty")},ELM.Models.ProductFilter.prototype.ERROR_MESSAGES)});
ELM.Models.RecsTemplate=ELM.Models.Content.extend({url:function(){return"/content/dam/mac/"+ELM.client
},defaults:function(){return{path:"",name:"",lastModified:"",content:"",offerThumbnailUrl:"",displayVariables:[]}
},setTemplateName:function(a){this.silentSet("name",a)
},getTemplateName:function(){return this.get("name")
},setPath:function(a){this.silentSet("path",a)
},getPath:function(){return this.get("path")
},setSelected:function(a){this.set("selected",a)
},getSelected:function(){return this.get("selected")
},setTemplateContent:function(a){this.silentSet("content",a)
},unsetTemplateContent:function(){this.unset("content",{silent:true})
},getTemplateContent:function(){return this.get("content")
},getDisplayVariables:function(){return this.get("displayVariables")
},setDisplayVariables:function(a){this.set("displayVariables",a)
},setValidationError:function(a){this.validationError=a
},getValidationError:function(){return this.validationError
},unsetLastModified:function(){this.unset("lastModified",{silent:true})
},setThumbnailSrc:function(a){this.silentSet("offerThumbnailUrl",a)
},getThumbnailSrc:function(){return this.get("offerThumbnailUrl")
},clearThumbnailSrc:function(){this.unset("offerThumbnailUrl",{silent:true})
},isNew:function(){return !this.get("lastModified")
},saveTemplate:function(a,d){var b=this.getTemplateName(),e=b+(new Date()).getTime(),f=this.getTemplateContent(),c=this;
ELM.Recommendation.Util.validateOffer({offerName:b,offerContent:f,isRecsTemplate:true,success:function(){ELM.Recommendation.Util.saveOffer({offerUrl:c.url(),offerNodeName:e,offerName:b,offerContent:f,isRecsTemplate:true,success:function(){c.setPath(c.url()+"/"+e);
a()
},error:function(g){d(ELM.Recommendation.Util.ERROR_MESSAGES[g.status])
}})
},error:d})
},updateTemplate:function(a,d){var b=this.getTemplateName(),e=this.getTemplateContent(),c=this;
ELM.Recommendation.Util.validateOffer({offerName:b,offerContent:e,isRecsTemplate:true,success:function(){ELM.Recommendation.Util.updateOffer({offerName:b,offerContent:e,offerUrl:c.getPath(),success:a,error:function(){d(Granite.I18n.get("Failed to update the template."))
}})
},error:d})
},deleteTemplate:function(a,c){var b=this;
ELM.Recommendation.Util.deleteOffer({offerUrl:b.getPath(),success:function(e){var d=e.unsuccessful,h=d.length,j="",f="",g=0;
if(d&&h){for(;
g<h;
g+=1){j=d[g].reason;
if(j){if(j.toLowerCase().indexOf("is referred by other resources")!==-1){j=Granite.I18n.get("Referenced in an activity.")
}f+=Granite.I18n.get(j)
}}c(f);
return
}a()
},error:function(){c(Granite.I18n.get("Failed to delete the template."))
}})
},fetchTemplateContent:function(){var a=this;
return $.ajax({url:a.getPath(),success:function(b){a.setTemplateContent(b)
}})
}});
ELM.Models.RecommendationItemPicker=ELM.Model.extend({defaults:function(){return{selectedAlgorithms:[],selectedTemplates:[],pageType:"",industryType:ELM.industryType,action:"",singleSelectionMode:false,algorithmCompatibility:ELM.isAlgorithmFilteringEnabled}
},getSelectedAlgorithms:function(){return this.get("selectedAlgorithms")
},setSelectedAlgorithms:function(a){this.silentSet("selectedAlgorithms",a)
},getSelectedTemplates:function(){return this.get("selectedTemplates")
},setSelectedTemplates:function(a){this.silentSet("selectedTemplates",a)
},getPageType:function(){return this.get("pageType")
},setPageType:function(a){this.silentSet("pageType",a)
},getIndustryType:function(){return this.get("industryType")
},setIndustryType:function(b){var a=this.getPageType();
if(b&&ELM.INDUSTRY_PAGE_MAP[b].indexOf(a)===-1){this.setPageType("")
}this.set("industryType",b)
},getAction:function(){return this.get("action")
},setAction:function(a){this.silentSet("action",a)
},setSingleSelectionMode:function(a){this.silentSet("singleSelectionMode",a)
},getSingleSelectionMode:function(){return this.get("singleSelectionMode")
},getRecAlgoSessionId:function(){return this.get("recAlgoSessionId")
},getAlgorithmCompatibility:function(){return this.get("algorithmCompatibility")
},setAlgorithmCompatibility:function(a){this.silentSet("algorithmCompatibility",a)
}});
ELM.Models.RecsClientDetails=ELM.Model.extend({url:function(){return"productDetail/RECS.at.json"
},getRecsHost:function(){return"https://"+this.get("recsHost")
},getClientToken:function(){return this.get("clientToken")
}});
ELM.Collections.Offers=ELM.Collection.extend({urlRoot:"offers"});
ELM.Collections.Activities=ELM.Collection.extend({urlRoot:"activities",totalActivities:0,privileges:"",model:ELM.Models.Activity,parse:function(a){this.totalActivities=a.total?a.total:0;
this.privileges=a.privileges||"";
return a.items
},incrementTotalActivities:function(){this.totalActivities+=1
},decrementTotalActivities:function(){this.totalActivities-=1
},incrementTotalActivitiesBy:function(a){this.totalActivities+=a
},decrementTotalActivitiesBy:function(a){this.totalActivities-=a
},getTotalActivities:function(){return this.totalActivities
},setTotalActivities:function(a){this.totalActivities=a
},isUserApprover:function(){return this.privileges.toLowerCase().indexOf(ELM.Activities.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.privileges.toLowerCase().indexOf(ELM.Activities.privilege.WRITE)!==-1
},isUserObserver:function(a){return !(this.isUserApprover()||this.isUserEditor())
}});
ELM.Collections.ActivityCollisions=ELM.Collection.extend({model:ELM.Models.ActivityCollision,url:function(){return"activities/"+this.activityId+".collision.at.json"
},parse:function(a){return _.filter(a,function(b){return b.activities.length>0
})
},setActivityId:function(a){this.activityId=a;
return this
}});
ELM.Collections.ActivityMetrics=ELM.Model.extend({url:function(){return"activities/"+this.id+"/metrics.at.json"
},setMetrics:function(a){this.silentSet("metrics",a)
},defaults:{metrics:[]}});
ELM.Collections.Algorithms=ELM.Collection.extend({model:ELM.Models.Algorithm,urlRoot:"setup/recs/algorithms",parse:function(a){this.privileges=a.privileges||"";
return a.items
},isUserApprover:function(){return this.privileges.toLowerCase().indexOf(ELM.Products.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.privileges.toLowerCase().indexOf(ELM.Products.privilege.WRITE)!==-1
},isUserObserver:function(){return !(this.isUserApprover()||this.isUserEditor())
}});
ELM.Collections.Contents=ELM.Collection.extend({model:ELM.Models.Content,urlRoot:"/target/querybuilder.json",parse:function(b){var g=[],j;
b=b.hits;
j=b.length;
for(var d=0;
d<j;
d++){var f=b[d],c={},h,e=f["jcr:content"]["related"],a=_.isUndefined(e)||e.targetGlobalOffer||e.targetAnonymousOffer||e.offerThumbnail||e.status==="DELETED";
if(a){continue
}c.path=f["jcr:path"];
c.name=f["jcr:path"].substr(f["jcr:path"].lastIndexOf("/")+1);
c.lastModified=moment(f["jcr:content"]["jcr:lastModified"]).fromNow();
c.lastModifiedBy=f["jcr:content"]["jcr:lastModifiedBy"];
c.isHTMLOffer=(f["jcr:content"]["metadata"]["dc:format"]==="text/html")?"text/html":null;
h=f["jcr:content"]["metadata"]["dc:title"];
if(_.isArray(h)&&(h.length!==0)){h=h[0]
}else{if(typeof h!=="string"){h=""
}}if(h){c.name=h
}if(c.isHTMLOffer){c.offerThumbnailUrl=this.getThumbnailUrl(e,c)
}if(f["jcr:content"]["related"]["targetRecsTemplate"]){c.isPredefined=f["jcr:content"]["related"]["isPredefined"]
}g.push(c)
}return g
},url:function(){return this.urlRoot
},fetch:function(a){Backbone.Collection.prototype.fetch.apply(this,arguments)
},getThumbnailUrl:function(a,b){var c="";
_.each(a,function(e,d){if(_.isObject(e)&&e["jcr:primaryType"]==="dam:Asset"){c="/images/target/"+d
}});
return c
}});
ELM.Collections.Audiences=ELM.Collection.extend({urlRoot:"audiences",model:ELM.Models.Audience,parse:function(b){var a=b.items,c=_.find(a,function(e){return e.id==="all_visitors"
}),d=0;
if(c){d=a.indexOf(c)
}if(d){c=a[d];
a.splice(d,1);
a=_.sortBy(a,function(e){return e["jcr:title"].toLowerCase()
});
a.unshift(c)
}return a
}});
ELM.Collections.ReportingAudiences=ELM.Collection.extend({model:ELM.Models.Audience});
ELM.Collections.HostGroups=ELM.Collection.extend({url:"setup/tt/hostgroups.at.json?pageSize=1000",model:ELM.Models.HostGroup,parse:function(a){return a.items
}});
ELM.Collections.HostList=ELM.Collection.extend({url:"setup/tt/hostgroups.at.json",model:ELM.Models.HostListItem,totalHosts:0,setUrl:function(a){this.url="setup/tt/hostgroups/"+a+".at.json"
},parse:function(a){this.totalHosts=a.total;
return a.items
}});
ELM.Collections.Plugins=ELM.Collection.extend({url:"/target/geometrixx/target/setup/tt/plugins.at.json",model:ELM.Models.Plugin,parse:function(a){return items=[{Name:"TeaLeaf",Script:"TeaLeaf",ServeCondition:"Display"},{Name:"TeaLeaf",Script:"TeaLeaf",ServeCondition:"Display"},{Name:"TeaLeaf",Script:"TeaLeaf",ServeCondition:"Display"},{Name:"TeaLeaf",Script:"TeaLeaf",ServeCondition:"Display"},{Name:"TeaLeaf",Script:"TeaLeaf",ServeCondition:"Display"},{Name:"TeaLeaf",Script:"TeaLeaf",ServeCondition:"Display"},{Name:"TeaLeaf",Script:"TeaLeaf",ServeCondition:"Display"},{Name:"TeaLeaf",Script:"TeaLeaf",ServeCondition:"Display"},{Name:"TeaLeaf",Script:"TeaLeaf",ServeCondition:"Display"}]
}});
ELM.Collections.UserRoles=ELM.Collection.extend({urlRoot:"setup/userRoles",totalUsers:0,model:ELM.Models.UserRole,parse:function(a){this.totalUsers=a.total?a.total:0;
return a.items
}});
ELM.Collections.ProductSearchList=ELM.Collection.extend({model:ELM.Models.ProductSearchListItem,columns:null,activeColumns:null,searchCancelled:false,url:function(){if(ELM.isHaloProductSearchEnabled){return"products/productSearch.halosearch.at.json"
}else{return"products/productSearch.at.json"
}},parse:function(b){var a=b.items,c=this;
if(this.searchCancelled){return[]
}_.each(a,function(d){d.columns=c.columns;
if(d.categories){d.category=d.categories;
delete d.categories
}if(d.baseUrl){d.pageUrl=d.baseUrl+d.pageUrl
}d.activeColumns=c.activeColumns;
delete d.__client;
delete d.__recsID;
delete d._version_
});
if(ELM.isHaloProductSearchEnabled){this.totalSearchCount=b.total
}return a
}});
ELM.Collections.Catalogs=ELM.Collection.extend({urlRoot:"products/catalogs",model:ELM.Models.Catalog,parse:function(a){this.privileges=a.privileges||"";
return a.items
},isUserApprover:function(){return this.privileges.toLowerCase().indexOf(ELM.Products.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.privileges.toLowerCase().indexOf(ELM.Products.privilege.WRITE)!==-1
},isUserObserver:function(){return !(this.isUserApprover()||this.isUserEditor())
}});
ELM.Collections.Feeds=ELM.Collection.extend({urlRoot:"products/feeds",model:ELM.Models.Feed,parse:function(a){this.privileges=a.privileges||"";
return a.items
},isUserApprover:function(){return this.privileges.toLowerCase().indexOf(ELM.Products.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.privileges.toLowerCase().indexOf(ELM.Products.privilege.WRITE)!==-1
},isUserObserver:function(){return !(this.isUserApprover()||this.isUserEditor())
}});
ELM.Collections.Exclusions=ELM.Collection.extend({urlRoot:"products/exclusions",model:ELM.Models.Exclusion,parse:function(a){this.privileges=a.privileges||"";
return a.items
},isUserApprover:function(){return this.privileges.toLowerCase().indexOf(ELM.Products.privilege.APPROVER)!==-1
},isUserEditor:function(){return !this.isUserApprover()&&this.privileges.toLowerCase().indexOf(ELM.Products.privilege.WRITE)!==-1
},isUserObserver:function(){return !(this.isUserApprover()||this.isUserEditor())
}});
ELM.Collections.RecsTemplates=ELM.Collections.Contents.extend({model:ELM.Models.RecsTemplate});
ELM.InfiniteScrollList=new Class({toString:"InfiniteScrollList",extend:F.ListComponent,options:{defaultParams:{pageSize:10,page:1}},currentPage:1,loading:false,currentSearchString:"",totalNumberOfPagesToLoad:-1,fetch:function(b,f,e){var d=true,a=false,c=true;
if(!e){this.currentPage=1;
d=false;
a=true;
c=false
}if(b){this.params=_.extend({},this.options.defaultParams,b)
}else{this.params=_.extend({},this.options.defaultParams)
}this.params.page=this.currentPage;
if(this.currentSearchString&&this.currentSearchString!=""){this.params.search=this.currentSearchString
}this.collection.fetch({data:this.params,add:d,remove:a,update:c,success:function(g,h){this.totalNumberOfPagesToLoad=h.numPages;
if(!e){this.collection.trigger("loaded")
}this.trigger("collection:loaded",this.collection,h.total);
this.collectionLoaded=true;
if(typeof f==="function"){f.call(this,this.collection)
}this.loading=false
}.bind(this),error:function(h,g){if(typeof f==="function"){f.call(this,g)
}}});
return this
},handleScroll:function(c){if(this.loading){return
}var d=c.currentTarget;
var a=0.8;
var b=(d.scrollTop+d.clientHeight>=a*d.scrollHeight);
if(b){this.fetchAvailablePage()
}},fetchAvailablePage:function(){var a=this.totalNumberOfPagesToLoad!==undefined&&this.totalNumberOfPagesToLoad>0&&this.totalNumberOfPagesToLoad!=this.currentPage;
if(a){this.currentPage++;
this.loading=true;
this.fetchNextPage()
}},fetchNextPage:function(){this.fetch(this.fetchParams,null,true)
}});
ELM.Search=new Class({extend:F.Component,toString:"Search",options:{filterWaitTime:250},construct:function(a){this._searchParams={};
this._searchQuery="";
this.bind(this.handleKey);
this.bind(this.handleSubmit);
this.handleFilter=_.throttle(this.handleFilter,this.options.filterWaitTime);
this.view=new this.View({component:this,el:a.el,parent:a.parent,template:this.Template})
},View:F.View.extend({tag:"form",className:"searchForm",events:{"keyup input":"handleKey",submit:"handleSubmit"}}),Template:Handlebars.compile('<input type="text" placeholder="Search"><button>Search</button>'),handleFilter:function(a){this.trigger("search:filtered",a||this.getSearchParams())
},handleKey:function(){var a=this.view.$("input").val();
if(a!=this._searchQuery){this._searchQuery=a;
var b=this.getSearchParams();
this.trigger("search:changed",b);
this.handleFilter(b)
}},handleSubmit:function(){var a=this.getSearchParams();
this.trigger("search:submitted",a);
this.handleFilter(a);
return false
},getSearchParams:function(){return _.extend({search:this._searchQuery},this._searchParams)
},setSearchParams:function(b,a){if(_.isObject(b)){if(a){this._searchParams=b
}else{_.extend(this._searchParams,b)
}}return this
},clear:function(){this.view.$("input.search").val("");
this._searchQuery="";
this._searchParams={};
var a=this.getSearchParams();
this.trigger("search:changed",a);
this.trigger("search:submitted",a);
this.handleFilter(a);
return this
}});
ELM.BrowserDetector={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";
this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";
this.OS=this.searchString(this.dataOS)||"an unknown OS"
},searchString:function(d){for(var a=0;
a<d.length;
a++){var b=d[a].string;
var c=d[a].prop;
this.versionSearchString=d[a].versionSearch||d[a].identity;
if(b){if(b.indexOf(d[a].subString)!=-1){return d[a].identity
}}else{if(c){return d[a].identity
}}}},searchVersion:function(b){var a=b.indexOf(this.versionSearchString);
if(a==-1){return
}return parseFloat(b.substring(a+this.versionSearchString.length+1))
},isFirefox:function(){return this.browser=="Firefox"
},isIE:function(){return this.browser=="Explorer"
},isChrome:function(){return this.browser=="Chrome"
},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],browsersNotSupportingMixContent:[{name:"Firefox",version:23,helpLink:"http://microsite.omniture.com/t2/help/en_US/target/#target-Enabling_Mixed_Content_in_Firefox"},{name:"Explorer",version:10,helpLink:"http://microsite.omniture.com/t2/help/en_US/target/#target-Enabling_Mixed_Content_in_Internet_Explorer"},{name:"Chrome",version:30,helpLink:"http://microsite.omniture.com/t2/help/en_US/target/#target-Enabling_Mixed_Content_in_Chrome"}],supportsMixContent:function(){var a=true;
_.each(this.browsersNotSupportingMixContent,function(b){if(ELM.BrowserDetector.browser===b.name&&ELM.BrowserDetector.version>=b.version){a=false;
ELM.BrowserDetector.mixContentHelpLink=b.helpLink
}});
return a
}};
ELM.BrowserDetector.init();