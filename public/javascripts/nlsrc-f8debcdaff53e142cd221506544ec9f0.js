var tinyMCEPreInit = { base: '/nl/lib/tinymce358', suffix: '_src' };
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
window.Typekit||(window.Typekit={}),window.Typekit.config={f:"{contextPath}/c/jta4suz-{format}.css",fn:["adobe-clean",["i3","i4","i7","n3","n4","n7"],"adobe-clean-condensed",["i4","i7","n4","n7"],"adobe-clean-semilight",["i4","n4"]],p:"//p.typekit.net/p.gif?s=2&k=jta4suz&ht=tk&h={host}&f=7180.7181.7182.7183.7184.22477.22148.22149.22480.22484.22795.22796&a=109236&_={_}"},function(a,b){function c(a){return function(){return this[a]}}function d(a,b){var c=a.split("."),d=wb;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d=d[e]?d[e]:d[e]={}:d[e]=b}function e(a){return a.call.apply(a.bind,arguments)}function f(a,b){if(!a)throw Error();if(arguments.length>2){var c=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(d,c),a.apply(b,d)}}return function(){return a.apply(b,arguments)}}function g(){return g=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?e:f,g.apply(ub,arguments)}function h(a,b){this.ea=a,this.W=b||a,this.z=this.W.document}function i(a,c,d){a=a.z.getElementsByTagName(c)[0],a||(a=b.documentElement),a&&a.lastChild&&a.insertBefore(d,a.lastChild)}function j(a,b){function c(){a.z.body?b():setTimeout(c,0)}c()}function k(a,b,c){b=b||[],c=c||[];for(var d=a.className.split(/\s+/),e=0;b.length>e;e+=1){for(var f=vb,g=0;d.length>g;g+=1)if(b[e]===d[g]){f=tb;break}f||d.push(b[e])}for(b=[],e=0;d.length>e;e+=1){for(f=vb,g=0;c.length>g;g+=1)if(d[e]===c[g]){f=tb;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function l(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;e>d;d++)if(c[d]==b)return tb;return vb}function m(a){var b=a.W.location.protocol;return"about:"==b&&(b=a.ea.location.protocol),"https:"==("https:"==b?"https:":"http:")}function n(b,c,d){var e=b.z.getElementsByTagName("head")[0];if(e){var f=b.createElement("script",{src:c}),g=vb;f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=tb,d&&d(ub),f.onload=f.onreadystatechange=ub,"HEAD"==f.parentNode.tagName&&e.removeChild(f))},e.appendChild(f),a.setTimeout(function(){g||(g=tb,d&&d(Error("Script load timeout")))},5e3)}}function o(a,b,c){this.Xa=a,this.ha=b,this.Wa=c}function p(a,b,c,d){this.g=a!=ub?a:ub,this.o=b!=ub?b:ub,this.J=c!=ub?c:ub,this.m=d!=ub?d:ub}function q(a,b){return a.g>b.g||a.g===b.g&&a.o>b.o||a.g===b.g&&a.o===b.o&&a.J>b.J?1:a.g<b.g||a.g===b.g&&a.o<b.o||a.g===b.g&&a.o===b.o&&a.J<b.J?-1:0}function r(a,b){return 0===q(a,b)||1===q(a,b)}function s(a){a=yb.exec(a);var b=ub,c=ub,d=ub,e=ub;return a&&(a[1]!==ub&&a[1]&&(b=parseInt(a[1],10)),a[2]!==ub&&a[2]&&(c=parseInt(a[2],10)),a[3]!==ub&&a[3]&&(d=parseInt(a[3],10)),a[4]!==ub&&a[4]&&(e=/^[0-9]+$/.test(a[4])?parseInt(a[4],10):a[4])),new p(b,c,d,e)}function t(a,b,c,d,e,f,g,h,i,j,k){this.X=a,this.A=b,this.Va=c,this.F=d,this.T=e,this.Aa=f,this.n=g,this.l=h,this.Ra=i,this.S=j,this.B=k}function u(a,b){this.e=a,this.R=b}function v(a){var b=y(a.e,/(iPod|iPad|iPhone|Android|Windows Phone|BB\d{2}|BlackBerry)/,1);return""!=b?(/BB\d{2}/.test(b)&&(b="BlackBerry"),b):(a=y(a.e,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS|PlayStation|CrKey)/,1),""!=a?("Mac_PowerPC"==a?a="Macintosh":"PlayStation"==a&&(a="Linux"),a):"Unknown")}function w(a){var b=y(a.e,/(OS X|Windows NT|Android) ([^;)]+)/,2);if(b||(b=y(a.e,/Windows Phone( OS)? ([^;)]+)/,2))||(b=y(a.e,/(iPhone )?OS ([\d_]+)/,2)))return b;if(b=y(a.e,/(?:Linux|CrOS|CrKey) ([^;)]+)/,1))for(var b=b.split(/\s/),c=0;b.length>c;c+=1)if(/^[\d\._]+$/.test(b[c]))return b[c];return(a=y(a.e,/(BB\d{2}|BlackBerry).*?Version\/([^\s]*)/,2))?a:"Unknown"}function x(a){var b=v(a),c=w(a),d=s(c),e=y(a.e,/AppleWeb(?:K|k)it\/([\d\.\+]+)/,1),f=s(e),g="Unknown",h=new p,i="Unknown",j=vb;return/OPR\/[\d.]+/.test(a.e)?g="Opera":-1!=a.e.indexOf("Chrome")||-1!=a.e.indexOf("CrMo")||-1!=a.e.indexOf("CriOS")?g="Chrome":/Silk\/\d/.test(a.e)?g="Silk":"BlackBerry"==b||"Android"==b?g="BuiltinBrowser":-1!=a.e.indexOf("PhantomJS")?g="PhantomJS":-1!=a.e.indexOf("Safari")?g="Safari":-1!=a.e.indexOf("AdobeAIR")?g="AdobeAIR":-1!=a.e.indexOf("PlayStation")&&(g="BuiltinBrowser"),"BuiltinBrowser"==g?i="Unknown":"Silk"==g?i=y(a.e,/Silk\/([\d\._]+)/,1):"Chrome"==g?i=y(a.e,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):-1!=a.e.indexOf("Version/")?i=y(a.e,/Version\/([\d\.\w]+)/,1):"AdobeAIR"==g?i=y(a.e,/AdobeAIR\/([\d\.]+)/,1):"Opera"==g?i=y(a.e,/OPR\/([\d.]+)/,1):"PhantomJS"==g&&(i=y(a.e,/PhantomJS\/([\d.]+)/,1)),h=s(i),j="AdobeAIR"==g?h.g>2||2==h.g&&h.o>=5:"BlackBerry"==b?d.g>=10:"Android"==b?d.g>2||2==d.g&&d.o>1:f.g>=526||f.g>=525&&f.o>=13,new t(g,h,i,"AppleWebKit",f,e,b,d,c,z(a.R),new o(j,536>f.g||536==f.g&&11>f.o,"iPhone"==b||"iPad"==b||"iPod"==b||"Macintosh"==b))}function y(a,b,c){return(a=a.match(b))&&a[c]?a[c]:""}function z(a){return a.documentMode?a.documentMode:void 0}function A(a){this.Pa=a||"-"}function B(a,b,c){this.h=a,this.v=b,this.aa=c,this.r="wf",this.q=new A("-")}function C(a){var b=l(a.v,a.q.m(a.r,"active")),c=[],d=[a.q.m(a.r,"loading")];b||c.push(a.q.m(a.r,"inactive")),k(a.v,c,d),D(a,"inactive")}function D(a,b,c){a.aa[b]&&(c?a.aa[b](c.getName(),F(c)):a.aa[b]())}function E(a,b){this.X=a,this.ia=4,this.Y="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.Y=c[1],this.ia=parseInt(c[2],10))}function F(a){return a.Y+a.ia}function G(a,b){this.h=a,this.O=b,this.D=this.h.createElement("span",{"aria-hidden":"true"},this.O)}function H(a,b){var c;c=[];for(var d=b.X.split(/,\s*/),e=0;d.length>e;e++){var f=d[e].replace(/['"]/g,"");-1==f.indexOf(" ")?c.push(f):c.push("'"+f+"'")}c=c.join(","),d="normal",e=b.ia+"00","o"===b.Y?d="oblique":"i"===b.Y&&(d="italic"),a.D.style.cssText="display:block;position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+c+";"+("font-style:"+d+";font-weight:"+e+";")}function I(a){i(a.h,"body",a.D)}function J(a,b,c,d,e,f,g,h){this.ja=a,this.Oa=b,this.h=c,this.C=d,this.O=h||"BESbswy",this.B=e,this.P={},this.fa=f||5e3,this.ua=g||ub,this.N=this.M=ub,a=new G(this.h,this.O),I(a);for(var i in Ab)Ab.hasOwnProperty(i)&&(H(a,new E(Ab[i],F(this.C))),this.P[Ab[i]]=a.D.offsetWidth);a.remove()}function K(a,b,c){for(var d in Ab)if(Ab.hasOwnProperty(d)&&b===a.P[Ab[d]]&&c===a.P[Ab[d]])return tb;return vb}function L(a){var b=a.M.D.offsetWidth,c=a.N.D.offsetWidth;b===a.P.serif&&c===a.P["sans-serif"]||a.B.ha&&K(a,b,c)?xb()-a.Ta>=a.fa?a.B.ha&&K(a,b,c)&&(a.ua===ub||a.ua.hasOwnProperty(a.C.getName()))?M(a,a.ja):M(a,a.Oa):setTimeout(g(function(){L(this)},a),25):M(a,a.ja)}function M(a,b){a.M.remove(),a.N.remove(),b(a.C)}function N(a,b,c,d){this.h=b,this.G=c,this.ca=0,this.xa=this.ra=vb,this.fa=d,this.B=a.B}function O(a){0==--a.ca&&a.ra&&(a.xa?(a=a.G,k(a.v,[a.q.m(a.r,"active")],[a.q.m(a.r,"loading"),a.q.m(a.r,"inactive")]),D(a,"active")):C(a.G))}function P(){var a=[{name:"font-family",value:Rb.c[Sb+1]}];this.Sa=[Rb.c[Sb]],this.na=a}function Q(a){for(var b=a.Sa.join(","),c=[],d=0;a.na.length>d;d++){var e=a.na[d];c.push(e.name+":"+e.value+";")}return b+"{"+c.join("")+"}"}function R(a){this.h=a}function S(a,b){this.s=a,this.u=b}function T(a){this.Ua=a}function U(a,b,c,d){this.L=a,this.U=b,this.hb=c,this.ib=d,this.pa={},this.oa={}}function V(a,b,c,d){for(c.push(a.L),d[a.L]=a.H(b),a=a.oa[b]||[],b=0;a.length>b;b++){for(var e=a[b],f=e.L,g=vb,h=0;c.length>h;h++)c[h]==f&&(g=tb);g||(c.push(f),d[f]=e.H())}}function W(a,b){this.L=a,this.U=b}function X(){this.la=this.za=this.K=this.V=this.qa=tb}function Y(a){return"Windows"===a.n}function Z(a){return Y(a)&&0===q(a.l,new p(5,1))||Y(a)&&0===q(a.l,new p(5,2))||Y(a)&&0===q(a.l,new p(6,0))||Y(a)&&r(a.l,new p(6,1))}function $(a){return"Macintosh"===a.n&&(r(a.l,new p(10,4))||a.l.g===ub)}function _(a,b){return b.qa&&("iPhone"===a.n||"iPod"===a.n)}function ab(a,b){return _(a,b)&&r(a.l,new p(4,2))&&-1===q(a.l,new p(5))}function bb(a,b){return b.V&&"iPad"===a.n&&r(a.l,new p(4,2))&&-1===q(a.l,new p(5))}function cb(a,b){return b.K&&"Android"===a.n}function db(a,b){return cb(a,b)&&r(a.l,new p(2,2))&&-1===q(a.l,new p(3,1))}function eb(a,b){return cb(a,b)&&r(a.l,new p(3,1))&&-1===q(a.l,new p(4,1))}function fb(a){return"Linux"===a.n||"Ubuntu"===a.n}function gb(a){return"Safari"===a.getName()&&"AppleWebKit"===a.F||"Unknown"===a.getName()&&"AppleWebKit"===a.F&&("iPhone"===a.n||"iPad"===a.n||"iPod"===a.n)}function hb(a){return"Safari"===a.getName()&&"AppleWebKit"===a.F&&r(a.T,new p(525,13))&&-1===q(a.T,new p(534,50))}function ib(a){return"BuiltinBrowser"===a.getName()}function jb(a){this.wa=a}function kb(a,b){return b}function lb(a,b){var c,d=new X,e=b||d;for(c in Bb){var f=Bb[c];if(Cb[f]&&Cb[f](a,e))return f}for(c in Bb)if(f=Bb[c],Cb[f]&&Cb[f](a,d))return"x";return"k"}function mb(a){this.h=a,this.s="x",this.$=this.e=ub,this.u=[],this.Q=[],this.ya=this.ba=ub}function nb(a,b,c,d){this.Qa=a,this.ma=ub,this.h=b,this.e=c,this.v=d,this.t=[]}function ob(b,c){if(0!=b.t.length){b.ma=c.contextPath||".";for(var d=new B(b.h,b.v,c),e=vb,f=0;b.t.length>f;f++)b.t[f].init(),e=e||b.t[f].supportsConfiguredBrowser();if(e){k(d.v,[d.q.m(d.r,"loading")]),D(d,"loading");for(var g=new N(b.e,b.h,d,c.timeout),d=function(a,b,c){for(var d=[],e=0;a.length>e;e+=1){var f=a[e];if(b[f])for(var h=b[f],i=0;h.length>i;i+=1)d.push(new E(f,h[i]));else d.push(new E(f))}g.ga(d,{},ub,c)},e=0;b.t.length>e;e++)f=b.t[e],f.supportsConfiguredBrowser()&&(f.load(d,e==b.t.length-1,b.ma),f.performOptionalActions(a))}else C(d);b.t=[]}}function pb(a){this.I=a,this.t=[]}function qb(a,b,c,d){this.I=a,this.z=b,this.Na=c,this.ta=d}function rb(a,b,c){var d=0,e=0;return a=a.z,a.documentElement&&(a.documentElement[b]||a.documentElement[c])?(d=a.documentElement[b],e=a.documentElement[c]):a.body&&(a.body[b]||a.body[c])&&(d=a.body[b],e=a.body[c]),[d,e]}function sb(a,b,c,d){if(b.attachEvent){var e=a.I;b["e"+c+d]=d,b[c+d]=function(){b["e"+c+d](e.event)},b.attachEvent("on"+c,b[c+d])}else b.addEventListener(c,d,vb)}var tb=!0,ub=null,vb=!1,wb=this,xb=Date.now||function(){return+new Date};h.prototype.createElement=function(a,b,c){if(a=this.z.createElement(a),b)for(var d in b)b.hasOwnProperty(d)&&("style"==d?a.style.cssText=b[d]:a.setAttribute(d,b[d]));return c&&a.appendChild(this.z.createTextNode(c)),a},d("internalWebfont.BrowserInfo",o),o.prototype.Ka=c("Xa"),o.prototype.hasWebFontSupport=o.prototype.Ka,o.prototype.La=c("ha"),o.prototype.hasWebKitFallbackBug=o.prototype.La,o.prototype.Ma=c("Wa"),o.prototype.hasWebKitMetricsBug=o.prototype.Ma;var yb=/^([0-9]+)(?:[\._-]([0-9]+))?(?:[\._-]([0-9]+))?(?:[\._+-]?(.*))?$/;p.prototype.toString=function(){return[this.g,this.o||"",this.J||"",this.m||""].join("")},d("internalWebfont.UserAgent",t),t.prototype.getName=c("X"),t.prototype.getName=t.prototype.getName,t.prototype.Ja=c("Va"),t.prototype.getVersion=t.prototype.Ja,t.prototype.Fa=c("F"),t.prototype.getEngine=t.prototype.Fa,t.prototype.Ga=c("Aa"),t.prototype.getEngineVersion=t.prototype.Ga,t.prototype.Ha=c("n"),t.prototype.getPlatform=t.prototype.Ha,t.prototype.Ia=c("Ra"),t.prototype.getPlatformVersion=t.prototype.Ia,t.prototype.Ea=c("S"),t.prototype.getDocumentMode=t.prototype.Ea,t.prototype.Da=c("B"),t.prototype.getBrowserInfo=t.prototype.Da;var zb=new t("Unknown",new p,"Unknown","Unknown",new p,"Unknown","Unknown",new p,"Unknown",void 0,new o(vb,vb,vb));u.prototype.parse=function(){var a;if(-1!=this.e.indexOf("MSIE")||-1!=this.e.indexOf("Trident/")){a=v(this);var b=w(this),c=s(b),d=ub,e=ub,f=ub,g=ub,h=y(this.e,/Trident\/([\d\w\.]+)/,1),i=z(this.R),d=-1!=this.e.indexOf("MSIE")?y(this.e,/MSIE ([\d\w\.]+)/,1):y(this.e,/rv:([\d\w\.]+)/,1),e=s(d);""!=h?(f="Trident",g=s(h)):(f="Unknown",g=new p,h="Unknown"),a=new t("MSIE",e,d,f,g,h,a,c,b,i,new o("Windows"==a&&e.g>=6||"Windows Phone"==a&&c.g>=8,vb,vb))}else if(-1!=this.e.indexOf("Opera"))a:if(a="Unknown",b=y(this.e,/Presto\/([\d\w\.]+)/,1),c=s(b),d=w(this),e=s(d),f=z(this.R),c.g!==ub?a="Presto":(-1!=this.e.indexOf("Gecko")&&(a="Gecko"),b=y(this.e,/rv:([^\)]+)/,1),c=s(b)),-1!=this.e.indexOf("Opera Mini/"))g=y(this.e,/Opera Mini\/([\d\.]+)/,1),h=s(g),a=new t("OperaMini",h,g,a,c,b,v(this),e,d,f,new o(vb,vb,vb));else{if(-1!=this.e.indexOf("Version/")&&(g=y(this.e,/Version\/([\d\.]+)/,1),h=s(g),h.g!==ub)){a=new t("Opera",h,g,a,c,b,v(this),e,d,f,new o(h.g>=10,vb,vb));break a}g=y(this.e,/Opera[\/ ]([\d\.]+)/,1),h=s(g),a=h.g!==ub?new t("Opera",h,g,a,c,b,v(this),e,d,f,new o(h.g>=10,vb,vb)):new t("Opera",new p,"Unknown",a,c,b,v(this),e,d,f,new o(vb,vb,vb))}else/OPR\/[\d.]+/.test(this.e)?a=x(this):/AppleWeb(K|k)it/.test(this.e)?a=x(this):-1!=this.e.indexOf("Gecko")?(a="Unknown",b=new p,c="Unknown",d=w(this),e=s(d),f=vb,-1!=this.e.indexOf("Firefox")?(a="Firefox",c=y(this.e,/Firefox\/([\d\w\.]+)/,1),b=s(c),f=b.g>=3&&b.o>=5):-1!=this.e.indexOf("Mozilla")&&(a="Mozilla"),g=y(this.e,/rv:([^\)]+)/,1),h=s(g),f||(f=h.g>1||1==h.g&&h.o>9||1==h.g&&9==h.o&&h.J>=2||g.match(/1\.9\.1b[123]/)!=ub||g.match(/1\.9\.1\.[\d\.]+/)!=ub),a=new t(a,b,c,"Gecko",h,g,v(this),e,d,z(this.R),new o(f,vb,vb))):a=zb;return a},A.prototype.m=function(){for(var a=[],b=0;arguments.length>b;b++)a.push(arguments[b].replace(/[\W_]+/g,"").toLowerCase());return a.join(this.Pa)},E.prototype.getName=c("X"),G.prototype.remove=function(){var a=this.D;a.parentNode&&a.parentNode.removeChild(a)};var Ab={fb:"serif",eb:"sans-serif",$a:"monospace"};J.prototype.start=function(){this.M=new G(this.h,this.O),I(this.M),this.N=new G(this.h,this.O),I(this.N),this.Ta=xb(),H(this.M,new E(this.C.getName()+",serif",F(this.C))),H(this.N,new E(this.C.getName()+",sans-serif",F(this.C))),L(this)},N.prototype.ga=function(a,b,c,d){if(0===a.length&&d)C(this.G);else for(this.ca+=a.length,d&&(this.ra=d),d=0;a.length>d;d++){var e=a[d],f=b[e.getName()],h=this.G,i=e;k(h.v,[h.q.m(h.r,i.getName(),F(i).toString(),"loading")]),D(h,"fontloading",i),new J(g(this.Ba,this),g(this.Ca,this),this.h,e,this.B,this.fa,c,f).start()}},N.prototype.Ba=function(a){var b=this.G;k(b.v,[b.q.m(b.r,a.getName(),F(a).toString(),"active")],[b.q.m(b.r,a.getName(),F(a).toString(),"loading"),b.q.m(b.r,a.getName(),F(a).toString(),"inactive")]),D(b,"fontactive",a),this.xa=tb,O(this)},N.prototype.Ca=function(a){var b=this.G,c=l(b.v,b.q.m(b.r,a.getName(),F(a).toString(),"active")),d=[],e=[b.q.m(b.r,a.getName(),F(a).toString(),"loading")];c||d.push(b.q.m(b.r,a.getName(),F(a).toString(),"inactive")),k(b.v,d,e),D(b,"fontinactive",a),O(this)},R.prototype.toString=function(){return encodeURIComponent(this.h.W.location.hostname||this.h.ea.location.hostname)},S.prototype.toString=function(){for(var a=[],b=0;this.u.length>b;b++)for(var c=this.u[b],d=c.H(),c=c.H(this.s),e=0;d.length>e;e++){var f;a:{for(f=0;c.length>f;f++)if(d[e]===c[f]){f=tb;break a}f=vb}a.push(f?1:0)}for(a=a.join(""),a=a.replace(/^0+/,""),b=[],d=a.length;d>0;d-=4)c=a.slice(0>d-4?0:d-4,d),b.unshift(parseInt(c,2).toString(16));return b.join("")},T.prototype.m=function(a,b){var c=b||{},d=this.Ua.replace(/\{\/?([^*}]*)(\*?)\}/g,function(a,b,d){return d&&c[b]?"/"+c[b].join("/"):c[b]||""});return d.match(/^\/\//)&&(d=(a?"https:":"http:")+d),d.replace(/\/*\?*($|\?)/,"$1")},U.prototype.H=function(a){return a?(this.pa[a]||this.U).slice(0):this.U.slice(0)},U.prototype.ga=function(a,b,c){var d=[],e={};V(this,b,d,e),a(d,e,c)},W.prototype.H=c("U");var Bb={ab:"a",cb:"b",gb:"d",Za:"i",bb:"j",Ya:"k",NONE:"x"},Cb={a:function(a,b){return hb(a)&&Z(a)||ib(a)&&(db(a,b)||cb(a,b)&&r(a.l,new p(4,1)))||b.K&&"Silk"===a.getName()&&-1===q(a.A,new p(2))&&(db(a,b)||$)||b.K&&"Silk"===a.getName()&&r(a.A,new p(2))&&cb(a,b)&&r(a.l,new p(4,1))||gb(a)&&(bb(a,b)||ab(a,b))||"Chrome"===a.getName()&&r(a.A,new p(6))&&(bb(a,b)||ab(a,b))||"AdobeAIR"===a.getName()&&r(a.A,new p(2,5))&&(Y(a)&&a.l.g===ub||fb(a))},b:function(a){return hb(a)&&$(a)||"AdobeAIR"===a.getName()&&r(a.A,new p(2,5))&&$(a)},d:function(a,b){return"Chrome"===a.getName()&&r(a.A,new p(6))&&(Z(a)||fb(a)||$(a)||cb(a,b)||"CrOS"===a.n||"CrKey"===a.n||b.V&&"iPad"===a.n&&r(a.l,new p(5))||_(a,b)&&r(a.l,new p(5)))||"Gecko"===a.F&&1===q(a.T,new p(1,9,1))&&(Z(a)||fb(a)||$(a)||cb(a,b))||"Safari"===a.getName()&&"AppleWebKit"===a.F&&r(a.T,new p(534,50))&&(Z(a)||$(a))||gb(a)&&(b.V&&"iPad"===a.n&&r(a.l,new p(5))||_(a,b)&&r(a.l,new p(5)))||"Opera"===a.getName()&&r(a.A,new p(11,10))&&(Z(a)||fb(a)||$(a)||cb(a,b))||"MSIE"===a.getName()&&a.S>=9&&(Y(a)&&r(a.l,new p(6,1))||Y(a)&&0===q(a.l,new p(6,0)))||"MSIE"===a.getName()&&b.za&&"Windows Phone"===a.n&&r(a.l,new p(8))||ib(a)&&(b.la&&"BlackBerry"===a.n&&r(a.l,new p(10))||fb(a))},j:function(a,b){return ib(a)&&eb(a,b)||b.K&&"Silk"===a.getName()&&r(a.A,new p(2))&&(eb(a,b)||fb(a))},i:function(a){return"MSIE"===a.getName()&&r(a.A,new p(6,0))&&(void 0===a.S||9>a.S)&&Z(a)},x:function(){return vb}},Db={};Db.i=new jb(function(a,b,c){for(var d=0;b.length>d;d+=1){var e=b[d],f=a.replace(/(-1|-2)$/,"").slice(0,28)+"-"+e;c.push(new W(f,[e]))}for(a={},e=0;b.length>e;e++)c=b[e],d=c.charAt(1),(a[d]||(a[d]=[])).push(c);for(c=[[4,3,2,1,5,6,7,8,9],[7,8,9,6,5,4,3,2,1]],d=[],e=0;c.length>e;e++)for(var f=c[e],g=0;f.length>g;g++){var h=f[g];if(a[h]){d=d.concat(a[h]);break}}for(c=d,d={},a=[],e=0;c.length>e;e++)f=c[e],d[f]||(d[f]=tb,a.push(f));for(c=[],d=0;b.length>d;d++)for(e=b[d],f=0;a.length>f;f++)g=a[f],g==e&&c.push(g);return c});var Eb={};Eb.a=Eb.j=Eb.b=Eb.d=Eb.j=function(){return[]},Eb.i=function(a,b,c){return[new R(a),new S(b,c)]},Eb.k=function(a){return[new R(a)]},mb.prototype.supportsConfiguredBrowser=function(){return"x"!==this.s},mb.prototype.init=function(){if(this.Q.length>0){for(var a=[],c=0;this.Q.length>c;c++)a.push(Q(this.Q[c]));var c=this.h,a=a.join(""),d=this.h.createElement("style");d.setAttribute("type","text/css"),d.styleSheet?d.styleSheet.cssText=a:d.appendChild(b.createTextNode(a)),i(c,"head",d)}},mb.prototype.load=function(a,b,c){if(this.s){for(var d=Db[this.s]||new jb(kb),e=0;this.u.length>e;e++){for(var f=this.u[e],g=this.s,h=d,k=[],l=f.L.split(",")[0].replace(/"|'/g,""),n=f.H(),o=k,p=void 0,q=[],r={},s=0;n.length>s;s++)p=n[s],p.length>0&&!r[p]&&(r[p]=tb,q.push(p));n=q,h=h.wa?h.wa(l,n,o):n,f.pa[g]=h,f.oa[g]=k}if(this.ba){for(d=Eb[this.s](this.h,this.s,this.u),e=this.s,f=[],g=0;d.length>g;g++)f.push(d[g].toString());d={format:e,extras:f},c&&(d.contextPath=c),d=this.ba.m(m(this.h),d),c=this.h;var d=c.createElement("link",{rel:"stylesheet",href:d}),t=vb;d.onload=function(){t||(t=tb)},d.onerror=function(){t||(t=tb)},i(c,"head",d)}if(a){var u=this,v=this.s;j(this.h,function(){for(var c=0;u.u.length>c;c++)u.u[c].ga(a,v,b&&c==u.u.length-1)})}}},mb.prototype.collectFontFamilies=function(a,b){if(this.s)for(var c=0;this.u.length>c;c++)V(this.u[c],this.s,a,b)},mb.prototype.performOptionalActions=function(){if(this.da){var b=this,c=this.e,d=this.h;j(this.h,function(){var e=b.da;if(e.va){var f=a.__adobewebfontsappname__,f=f?f.toString().substr(0,20):"",e=e.va.m(m(d),{host:encodeURIComponent(d.W.location.hostname||d.ea.location.hostname),app:encodeURIComponent(f),_:(+new Date).toString()}),g=new Image(1,1);g.src=e,g.onload=function(){g.onload=ub}}e=b.da,e.ka&&(e=e.ka.m(c,d),i(d,"body",e))})}},nb.prototype.Z=function(a){this.t.push(a)},nb.prototype.load=function(a,b){var c=a,d=b||{};if("string"==typeof c?c=[c]:c&&c.length||(d=c||{},c=[]),c.length)for(var e=this,f=c.length,g=0;c.length>g;g++){var h=this.Qa.m(m(this.h),{id:encodeURIComponent(c[g])});n(this.h,h,function(){0==--f&&ob(e,d)})}else ob(this,d)},pb.prototype.Z=function(a){this.t.push(a)},pb.prototype.load=function(){var c=this.I.__webfonttypekitmodule__;if(c)for(var d=0;this.t.length>d;d++){var e=this.t[d],f=c[e.ya];f&&f(function(c,d,f){c=[],d={};var g=new u(navigator.userAgent,b).parse(),h=e;h.e=g,h.s=lb(h.e,h.$),e.supportsConfiguredBrowser()&&(e.init(),e.load(ub),e.collectFontFamilies(c,d),e.performOptionalActions(a)),f(e.supportsConfiguredBrowser(),c,d)})}},qb.prototype.m=function(a,b){var c=this.z.createElement("img");if(c.setAttribute("width",62),c.setAttribute("height",25),c.setAttribute("src",this.Na.m(m(b))),c.setAttribute("class","typekit-badge"),c.setAttribute("alt","Fonts by Typekit"),c.setAttribute("title","Information about the fonts used on this site"),c.style.position="fixed",c.style.zIndex=2e9,c.style.right=0,c.style.bottom=0,c.style.cursor="pointer",c.style.border=0,"Opera"!=a.getName()&&(c.style.content="none"),c.style.display="inline",c.style["float"]="none",c.style.height="25px",c.style.left="auto",c.style.margin=0,c.style.maxHeight="25px",c.style.maxWidth="62px",c.style.minHeight="25px",c.style.minWidth="62px",c.style.orphans=2,c.style.outline="none",c.style.overflow="visible",c.style.padding=0,c.style.pageBreakAfter="auto",c.style.pageBreakBefore="auto",c.style.pageBreakInside="auto",c.style.tableLayout="auto",c.style.textIndent=0,c.style.top="auto",c.style.unicodeBidi="normal",c.style.verticalAlign="baseline",c.style.visibility="visible",c.style.widows=2,c.style.width="65px",this.ta){var d=this.z,e=this.ta;sb(this,c,"click",function(){d.location.href=e})}var f=a.n;if("MSIE"==a.getName()&&"Windows Phone"!=f){c.style.position="absolute";var g=this,h=function(){var a=rb(g,"scrollLeft","scrollTop"),b=rb(g,"clientWidth","clientHeight");c.style.bottom="auto",c.style.right="auto",c.style.top=a[1]+b[1]-25+"px",c.style.left=a[0]+b[0]-3-62+"px"};sb(this,this.I,"scroll",h),sb(this,this.I,"resize",h)}return("iPhone"==f||"iPod"==f||"iPad"==f||"Android"==f||"Windows Phone"==f||"BlackBerry"==f)&&(c.style.display="none"),c};var Fb=new u(navigator.userAgent,b).parse();if(a.Typekit||(a.Typekit={}),!a.Typekit.load){var Gb=a.Typekit.config||{},Hb=ub;Gb.k&&(Hb=new T(Gb.k));var Ib=new nb(Hb,new h(a),Fb,b.documentElement),Jb=new pb(a);a.Typekit.load=function(){Ib.load.apply(Ib,arguments)},a.Typekit.addKit=function(){Ib.Z.apply(Ib,arguments)}}var Kb,Lb,Mb,Nb,Ob=ub,Pb=ub,Qb=ub,Rb=a.Typekit.config||{};Rb.b&&(Ob=new T(Rb.b),Pb=new qb(a,b,Ob,Rb.bu)),Rb.p&&(Qb=new T(Rb.p)),Lb=new function(){var a=Qb;this.ka=Pb,this.va=a},Nb=new mb(new h(a)),Nb.da=Lb,Mb=new X,Mb.qa=!Rb.si,Mb.V=!Rb.st,Mb.K=!Rb.sa,Mb.za=!Rb.sw,Mb.la=!Rb.sb,Nb.$=Mb,Rb.w&&(Nb.ya=Rb.w),Rb.f&&(Kb=new T(Rb.f),Nb.ba=Kb);var Sb;if(Rb.fn)for(Sb=0;Rb.fn.length>Sb;Sb+=2)Nb.u.push(new U(Rb.fn[Sb],Rb.fn[Sb+1]));if(Rb.c)for(Sb=0;Rb.c.length>Sb;Sb+=2)Nb.Q.push(new P);var Tb;(Tb=Jb)&&(Tb=!!Jb.I.__webfonttypekitmodule__),Tb?(Jb.Z(Nb),Jb.load()):(Nb.e=Fb,Nb.s=lb(Nb.e,Nb.$),a.Typekit.addKit(Nb))}(this,document);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.Widgets"),NL.Widgets.callWidgetMethod=function(a,b,c){var d=null;return SO.Utils.each(a.data(),function(a,e){return SO.isFunction(e[b])?(d=e[b].apply(e,void 0===c?[]:c),!1):void 0}),d},$.widget("NL.nlWidget",{id:null,_defaultTheme:"light",_currentTheme:null,_themePrefix:"clui-",_themableElts:null,_init:function(){return this.element.addClass("nlui-widget"),this.options.theme&&this.setTheme(this.options.theme||this._defaultTheme),this.options.id&&this.element.prop("id",this.options.id),this},setElementThemable:function(a){return this._themableElts||(this._themableElts=[]),this._themableElts.push(a),this},getWidget:function(){return this._widget},setTheme:function(a,b){var c,d;if(d=this._themePrefix+a,b=b||this.element,this._currentTheme&&b.removeClass(this._currentTheme),this._themableElts)for(c=0;this._themableElts.length>c;c+=1)this._currentTheme&&this._themableElts[c].removeClass(this._currentTheme),this._themableElts[c].addClass(d);return b.addClass(d),this._currentTheme=d,this},getTheme:function(){return this._currentTheme},_getCreateOptions:function(){var a=$.Widget.prototype._getCreateOptions.apply(this,arguments)||{};return a.locale=SO.LocaleManager.getLocale(),a.timezone=SO.TimezoneManager.getDefaultTimezone(),a.confManager=SO.configManager,a.popableManager=SO.PopableManager,a.layoutManager=SO.Widgets.LayoutManager,a.beforeAsyncLoad=function(){},a.afterAsyncLoad=function(){},a},_getConfManagerKey:function(){return this.options.confId?[this.widgetName,this.options.confId]:[this.widgetName]},_setOption:function(a){if("confManager"===a)throw new Error("You cannot change the local configuration once initialized");return $.Widget.prototype._setOption.apply(this,arguments)},getConf:function(){return this.options.confManager?this.options.confManager.get(this._getConfManagerKey(),{}):{}},saveConf:function(a){this.options.confManager&&this.options.confManager.set(this._getConfManagerKey(),a)},rebuildLayout:function(){},stopPropagation:function(a){this.options.popableManager.stopPropagation(a)},preventDefault:function(a){this.options.popableManager.preventDefault(a)},onValidation:function(){},refresh:function(){},setParamSubtree:function(a,b){var c=new SO.Structure.Jpath(a),d=[],e=this.options.params,f=c.getPartsCount();if(f>0)for(var g=0;f>g;g++){var h=c.getItem(g);if(!e.hasOwnProperty(h.key))throw"Property '"+h.key+"' does not exist";f>1&&(e=e[h.key])}if(SO.isPlainObject(b)){var i=[];for(i.push({widgetParam:e,param:b,jpath:new SO.Structure.Jpath(a)});i.length>0;){var j=i.pop();SO.Utils.each(j.param,function(a,b){void 0!==j.widgetParam[a]?SO.isPlainObject(j.widgetParam[a])?i.push({widgetParam:j.widgetParam[a],param:b,jpath:j.jpath.getJpath(a)}):(j.widgetParam[a]=b,d.push(j.jpath.getJpath(a))):SO.log.warn("Property '"+a+"' does not exist")})}}else e[h.key]=b,d.push(c);d.length>0&&this._applyParamChanges(d)},_applyParamChanges:function(){SO.assert(!1,"_applyParamChanges should be overriden to handle the change of paramaters")}}),$(function(){var a=$('script[type|="nl"]');a.each(function(){var a=$(this).attr("type").substr(3),b=a.split("/",2),c=b[0],d=b[1];switch(c){case"widget":if("done"===$(this).data("status"))break;var e,f=$(this).attr("selector");if(f&&$(":not(script)"+f).length)$(this).removeAttr("id"),e=$(f);else{e=$("<div>");var g=$(this).attr("data-widget-id");g&&e.attr("id",g),$(this).after(e)}var h=new Function("return "+$.trim($(this).html())+";");e[d](h()),$(this).data("status","done");break;default:throw new Error('Unknown type of Adobe Campaign script: "'+b[0]+'"')}})}),function(a){a.fn.nlData=function(a,b){return a="nl-"+a,void 0===b?b=this.attr("data-"+a)||this.data(a)||void 0:null===b?(this.removeData(a),this.removeAttr("data-"+a),this):(b=b.toString(),this.data(a,b),this.attr("data-"+a,b),this)}}(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Dialog",{DEFAULT_OPTIONS:{theme:"light",parent:"body",header:!0,headerAlign:"left",position:"center center",width:350,padding:void 0,height:"auto",minWidth:150,minHeight:50,maxWidth:null,maxHeight:null,resizable:!1,draggable:!0,closeButton:void 0,buttons:[],commandBarHidden:!1,closeOnEscape:!0,title:"",titleIcon:void 0,content:"",buttonsAlign:"right",modal:!1,autoOpen:!0,noPrimaryFirstButton:!1,dialogClass:"",closeText:"",commandBarConfig:null,resizeStart:null,resizeStop:null,resize:null,dragStart:null,dragStop:null,drag:null,open:null,close:null,cancel:null,focus:null,fullHeightElement:!1,destroyOnClose:!1,removeOnClose:!1,adaptable:!0,mode:null,effect:!1,vAlign:!1},_create:function(){this._$dialog=null,this._$header=null,this._$title=null,this._$titleText=null,this._$headerContent=null,this._$footer=null,this._$body=null,this._$modalDiv=null,this._cmdBar={left:null,right:null},this._defaultCmdBar="right",this._cmdController=null,this._$closeBt=null,this._isOpen=!1,this._isReady=!1,$(window),SO.assert(!this._options.fullPage,"Full page option is deprecated. Use option.mode='fullPage' instead."),this._options.fullPage&&!this._options.mode&&(this._options.mode="fullPage"),this._isInFullPage="transparent"===this._options.mode||"fullPage"===this._options.mode,this._isInFullPage&&void 0===this._options.padding&&(this._options.padding=!1),this._tmpSizePos={height:null,width:null,left:null,top:null};var a="nlui-dialog";return"maximize"===this._options.mode&&(a+=" nlui-dialog-witheffect nlui-dialog-maximize",this._options.closeButton=void 0===this._options.closeButton?!1:this._options.closeButton,this._options.resizable=!1,this._options.draggable=!1),this._options.closeButton=void 0===this._options.closeButton?!0:this._options.closeButton,this._render(),this._options.create&&this._options.create.call(this),this._options.layoutManager.registerWidget(this),this._floattable=this._$dialog[0],this.setFloatable(this._floattable),this._isOpen===!1&&this._options.autoOpen!==!1&&(this.open(),this._isReady=!0),"transparent"===this._options.mode&&(a+=" nlui-dialog-transparent"),(this._options.padding||void 0===this._options.padding)&&(a+=" nlui-dialog-haspadding"),this._options.effect&&(this._$dialog.css({transform:"scale(0)",opacity:"0"}),a+=" nlui-dialog-witheffect"),this._$dialog.addClass(a),this},_render:function(){var a,b,c,d;return a=this,d=this._options.commandBarConfig,SO.assert(null===this._$dialog),this._$dialog=$('<div class="nlui-dialog"></div>').show().on("mousedown",function(b){a.focus(b)}).appendTo(this._options.parent),this._isInFullPage&&"transparent"!==this._options.mode?this._$dialog.addClass("nlui-dialog-fullpage"):this._setResizable(),this.setElementThemable(this._$dialog),b=this.$el.attr("title"),this._options.title&&(b=this._options.title),this._options.header&&"transparent"!==this._options.mode?(this._addHeader(),this.setTitle(b)):this._$dialog.addClass("nlui-dialog-noheader"),null!==d?(d.left||d.right||(d={right:d}),SO.Utils.each(d,function(b,c){c.commands.length>0&&a._addCmdBar({iconSize:c.iconSize,controller:c.controller,commands:c.commands,commandConfigs:c.commandConfigs,onRefreshVisibility:c.onRefreshVisibility},b)})):$.each(this._options.buttons,function(b,c){var d;d="function"==typeof c?{label:b,onClick:c}:c,a.addButton(d,!0,d.position)}),this._options.commandBarHidden&&this.hideCommandBar(),this._options.closeButton&&this._addCloseButton(),this._addBody(),this._options.content&&(c=this._options.content,this.setContent(c)),this._options.draggable&&!this._isInFullPage&&this._$dialog.addClass("nlui-dialog-draggable").draggable({containment:"window",handle:this._$header,start:function(b,c){a._$dialog.removeClass("nlui-dialog-fittoright nlui-dialog-fittobottom"),a._options.dragStart&&a._options.dragStart.call(a,b,c)},drag:function(b,c){a._options.drag&&a._options.drag.call(a,b,c)},stop:function(b,c){a._options.dragStop&&a._options.dragStop.call(a,b,c),a._tmpSizePos.top=c.position.top,a._tmpSizePos.left=c.position.left}}),this._$dialog.attr("tabIndex",-1).keydown(function(b,c){a._options.closeOnEscape&&27===b.keyCode&&a.cancel(b,c)}),this._options.autoOpen===!1&&(this.updateSize(),this._$dialog.hide()),this._options.dialogClass&&this._$dialog.addClass(this._options.dialogClass),this},_initPosition:function(){var a,b,c,d,e,f,g;if("maximize"===this._options.mode)return this;a=this._options.position,g=$(window);try{if("string"==typeof a&&!this._isInFullPage){switch(b=a.split(" "),b[0]){case"center":c=g.outerWidth()/2-this._$dialog.outerWidth(!0)/2,d=null;break;case"right":c=null,d=0;break;case"left":c=0,d=null;break;default:c=parseInt(b[0],10),d=null}switch(b[1]){case"center":e=g.outerHeight()/2-this._$dialog.outerHeight(!0)/2,f=null;break;case"bottom":e=null,f=0;break;case"top":e=0,f=null;break;default:e=parseInt(b[1],10),f=null}}this._isInFullPage&&(e=c=d=f=0),e=0>e?$("body").scrollTop():e,c=0>c?0:c,this._$dialog.css({top:e,left:c,bottom:f,right:d})}catch(h){}return this._tmpSizePos.top=e,this._tmpSizePos.left=c,this},updateSize:function(){var a,b,c,d,e,f,g,h;switch(f=this._$header?this._$header.outerHeight(!0):0,g=this._$footer?this._$footer.outerHeight(!0):0,e=20,c=parseInt(this._options.width,10),c=isNaN(c)?0:c,this._options.width){case"auto":d=this._$body.outerWidth(!0)-this._$body.width(),c=this.$el.outerWidth(!0)+d+2;break;case"small":c=400;break;case"medium":c=584;break;case"large":c=1e3}return b=this._options.maxWidth||Math.max(c,this._options.minWidth),void 0===this._options.minHeight&&this._$dialog.css("minHeight",f+g),"auto"===this._options.height?(d=this._$body.outerHeight(!0)-this._$body.height(),a=this.$el.outerHeight(!0)+d+f+g+35,this._$dialog.removeClass("nlui-dialog-fixedheight")):(a=this._options.height,this._$dialog.addClass("nlui-dialog-fixedheight")),void 0!==a&&this._options.minHeight>a&&(a=this._options.minHeight),h=this._$dialog.css("border-width"),h&&(a+=2*parseInt(this._$dialog.css("border-width"),10)),a=this._options.maxHeight||a,this._isInFullPage||"maximize"===this._options.mode||this._$dialog.css({width:b+"px",height:a+"px"}),this._$body.css({top:this._$header?this._$header.outerHeight(!0):0,bottom:this._$footer?this._$footer.outerHeight(!0):0,left:0,right:0,position:"absolute"}),this._tmpSizePos.height=a,this._tmpSizePos.width=b,this},_addHeader:function(){var a="nlui-dialog-header";return this._$headerContent=$('<div class="nlui-dialog-header-content"></div>'),"center"===this._options.headerAlign?a+=" nlui-dialog-header-align-center":"right"===this._options.headerAlign&&(a+=" nlui-dialog-header-align-right"),this._$header=$('<div class="'+a+'"></div>').append(this._$headerContent),this._isInFullPage&&(this._$leftHeaderContent=$('<div class="nlui-dialog-header-left"></div>'),this._$rightHeaderContent=$('<div class="nlui-dialog-header-right"></div>'),this._$header.prepend(this._$leftHeaderContent,this._$rightHeaderContent)),this._$dialog.append(this._$header).removeClass("nlui-dialog-noheader"),this._$header},_addFooter:function(){return this._$footer=$('<div class="nlui-dialog-footer"></div>').css({"text-align":this._options.buttonsAlign}).appendTo(this._$dialog),this._$dialog.addClass("nlui-dialog-hasfooter"),this._$footer},_addBody:function(){var a=["nlui-dialog-element"];return this._$body=$('<div class="nlui-dialog-body"></div>').append(this.$el.show()).appendTo(this._$dialog),this._options.fullHeightElement&&a.push("nlui-dialog-fullheight"),this.$el.addClass(a.join(" ")),this._$body},_addCloseButton:function(){var a,b,c,d;return a=this,c="nlui-dialog-close-button","transparent"===this._options.mode||"fullPage"===this._options.mode?(b="closecircle_white",d=24,this._$closeBt=SO.IMG.genIcon(b,d,!1,!1).addClass(c)):(b="ui-icon-closethick",d=16,this._$closeBt=SO.IMG.genImage(b,d,!1,!1).addClass(c)),this._$closeBt.on("mousedown",function(b){"transparent"!==a._options.mode&&"fullPage"!==a._options.mode&&b.stopPropagation()}).on("click",function(b,c){a.cancel(b,c)}),this._isInFullPage&&"transparent"!==this._options.mode?this._$closeBt.appendTo(this._$rightHeaderContent):this._$closeBt.appendTo(this._$dialog),this._$closeBt},_addCmdBar:function(a,b){var c,d,e;b=b||this._defaultCmdBar,d="nlui-dialog-cmdbar","right"===b?(d+=" nlui-dialog-cmdbar-right",e=this._$rightHeaderContent):(d+=" nlui-dialog-cmdbar-left",e=this._$leftHeaderContent),this._cmdBar[b]=c=$('<div class="'+d+'"></div>').soCmdBar({iconSize:a.iconSize,separators:!1,rightSeparator:!1,leftSeparator:!1,commands:a.commands,commandConfigs:a.commandConfigs,controller:a.controller,onRefreshVisibility:a.onRefreshVisibility}),this._isInFullPage&&this._$header?(c.appendTo(this._$rightHeaderContent),e.append(c)):"maximize"!==this._options.mode?(null===this._$footer&&this._addFooter(),c.appendTo(this._$footer)):"maximize"===this._options.mode&&(null===this._$header&&this._addHeader(),c.appendTo(this._$header))},_setResizable:function(){var a=this;return this._options.resizable&&this._$dialog.resizable({handles:"all",minWidth:this._options.minWidth,minHeight:this._options.minHeight,maxWidth:this._options.maxWidth,maxHeight:this._options.maxHeight,start:function(b,c){a._options.resizeStart&&a._options.resizeStart.call(a,b,c)},resize:function(b,c){a._options.resize&&a._options.resize.call(a,b,c)},stop:function(b,c){a._tmpSizePos={width:c.size.width,height:c.size.height,top:c.position.top,left:c.position.left},a._options.resizeStop&&a._options.resizeStop.call(a,b,c)}}),this},_addModalDiv:function(){return this._$modalDiv=$('<div class="nlui-dialog-modaldiv"></div>').appendTo(this._options.parent),this.setFloatable(this._$modalDiv[0]),this._zIndexManager.bringToFront(this._floattable),this._$modalDiv},open:function(a,b){var c;return c=this,b=void 0===b?!0:b,this._$dialog.show(0,function(){c._options.effect&&$(this).css({transform:"scale(1)",opacity:"1"}),c.updateSize(),c._isOpen=!0,c._isReady===!1&&c._initPosition(),c.focus(a),c._options.open&&c._options.open.call(c,a,c),b&&c._options.layoutManager.rebuildLayout(c.$el),c._options.vAlign&&c._verticalAlign()}).addClass("nlui-dialog-opened"),"fullPage"!==this._options.mode||this._cmdBar.right&&(!this._cmdBar.right||this._cmdBar.right.soCmdBar("getCommands").length)?this._options.modal===!0&&null===this._$modalDiv?this._addModalDiv():this._$modalDiv&&this._$modalDiv.show():this.toggleCloseButton(!0),this},isOpen:function(){return this._isOpen},rebuildLayout:function(){var a,b,c,d;return this._options.adaptable&&(a=$(window),c=a.outerHeight(),d=a.outerWidth(),b=this._$dialog.offset(),"fullPage"!==this._options.mode&&"maximize"!==this._options.mode&&(this._tmpSizePos.height>=c?(this._$dialog.removeClass("nlui-dialog-fittobottom"),this.setAdaptable("vertical",!0)):this._tmpSizePos.top+this._tmpSizePos.height+10>c?(this._$dialog.addClass("nlui-dialog-fittobottom"),this.setAdaptable("vertical",!1)):(this._$dialog.removeClass("nlui-dialog-fittobottom"),this.setAdaptable("vertical",!1)),this._tmpSizePos.width>=d?(this._$dialog.removeClass("nlui-dialog-fittoright"),this.setAdaptable("horizontal",!0)):this._tmpSizePos.left+this._tmpSizePos.width+10>d?(this._$dialog.addClass("nlui-dialog-fittoright"),this.setAdaptable("horizontal",!1)):(this._$dialog.removeClass("nlui-dialog-fittoright"),this.setAdaptable("horizontal",!1)))),this},setAdaptable:function(a,b){var c;return"transparent"!==this._options.mode&&"fullPage"!==this._options.mode&&"maximize"!==this._options.mode&&(c="vertical"===a?"nlui-dialog-vadaptable":"nlui-dialog-hadaptable",b=void 0===b?!0:b,b?this._$dialog.addClass(c).resizable("destroy"):(this._$dialog.removeClass(c),this._isInFullPage||this._setResizable())),this},focus:function(a){var b;return a=a||{},b=$(a.target),this._$modalDiv&&(this._$modalDiv.show(),this._zIndexManager.bringToFront(this._$modalDiv[0])),this._zIndexManager.bringToFront(this._floattable),b.length>0&&(b.is(":focus")||b.parent().is(":focus"))?!1:(0===b.length&&this._$dialog.focus(),this._options.focus&&this._options.focus.call(this,a),this)},destroy:function(){this.$el.detach(),this._$dialog&&this._$dialog.remove&&this._$dialog.remove(),this._$dialog=null,this._$modalDiv&&(this._$modalDiv.remove(),this._$modalDiv=null),this.$el&&this._options.removeOnClose?this.$el.remove():this.$el&&$("body").append(this.$el.hide())},close:function(a,b,c){var d=this;return this._isOpen?this._options.beforeClose&&!1===this._options.beforeClose.call(this,a,b,c)?this:(this._isOpen=!1,this._options.effect?(this._$dialog.css({transform:"scale(0)",opacity:"0"}),setTimeout(function(){d._closeAction(a,b,c)},500)):this._closeAction(a,b,c),this):this},_closeAction:function(a,b,c){return this._$dialog&&this._$dialog.hide().removeClass("nlui-dialog-opened"),this._$modalDiv&&this._$modalDiv.hide(),this._options.close&&this._options.close.call(this,a,b,c),this._options.removeOnClose&&this._$dialog&&this._$dialog.length>0?(this._$dialog.remove(),this._$modalDiv&&(this._$modalDiv.remove(),this._$modalDiv=null)):this._options.destroyOnClose&&this.destroy(),this},cancel:function(a,b){return this._options.onCancel&&(this._options.cancel=this._options.onCancel),this._options.cancel&&this._options.cancel.call(this,a,b),this.close(a,b,"cancel"),this},setTitle:function(a,b){if(this._options.title=a,void 0===b&&(b=!1),null===this._$header&&(this._addHeader(),b=!0),!SO.isNundef(a)){if(null===this._$title){if(this._$title=$('<h1 class="nlui-dialog-title"></h1>').appendTo(this._$headerContent),this._options.titleIcon){var c=SO.IMG.genIcon(this._options.titleIcon);this._$title.append($(c.el).addClass("nlui-dialog-title-icon"))}this._$titleText=$("<span></span>").appendTo(this._$title)}this._$titleText.text(a)}return b&&(this.updateSize(),this._initPosition()),this},addButton:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;return d=this,h=a.name||"nlui-dialog-cmd"+SO.Utils.sequence().nextVal(),k=a.click||a.onClick||a.command,f=a.label||a.text,m=!1,n=!1,c=c||this._defaultCmdBar,"cancel"===a.preset&&(f=xtk_sirocco.dialog_cancel(),m=!0,p="coral-closeCircle",g="quiet"),"ok"===a.preset&&(g="transparent",p="coral-checkCircle",f=xtk_sirocco.dialog_ok(),n=!0),k&&(e=function(a){k.call(d.$el,a,this)}),(a.cancelMode||a.cancels)&&(m=!0),a.closeMode&&(n=!0),e=function(a,b){var c;k&&(c=k.call(d.$el,a,this)),m?d.cancel(a,b):n&&c!==!1&&d.close(a,b)},null===this._cmdBar[c]&&this._addCmdBar({},c),o=this._cmdBar[c],0===o.soCmdBar("getCommands").length&&this._options.noPrimaryFirstButton===!1?g="transparent":"primary"===a.mode&&this._options.noPrimaryFirstButton===!0&&(g="quiet"),a.command=e,l=$.extend({label:f,mode:g,icon:p},a),o.soCmdBar("addCommand",h,l,!1),i=o.soCmdBar("getCommands"),j=i[i.length-1],a.id&&j.prop("id",a.id),this._tmpBt=this._tmpBt||{left:[],right:[]},this._tmpBt[c].push(a),$.each(d._tmpBt[c],function(a,b){i[a].addClass(b["class"]).prop("id",b.id)}),b=void 0===b?!1:!0,b||(this.updateSize(),this._initPosition()),j},setContent:function(a){return this.$el.empty().append(a),this.updateSize(),this._initPosition(),this._options.layoutManager.rebuildLayout(this.$el),this},addContent:function(a){return this.$el.append(a),this.updateSize(),this._initPosition(),this._options.layoutManager.rebuildLayout(this.$el),this},setNoPrimaryFirstButton:function(a){var b=this.getButtons();return this._options.noPrimaryFirstButton=a,b.length>0&&a===!0?$.each(b,function(a,b){b.removeClass("nlui-button-primary")}):b.length>0&&b[0].addClass("nlui-button-primary"),this},setButtons:function(a,b){var c=this;return b=b||this._defaultCmdBar,this._options.buttons=a,this._cmdBar[b]&&(this._cmdBar[b].soCmdBar("destroy"),this._cmdBar[b]=null,this._tmpBt[b]=[]),$.each(a,function(a,d){var e;e="function"==typeof d?{label:a,onClick:d}:d,c.addButton(e,!1,b)}),this},setHeight:function(a){return this._options.height=a,this.updateSize(),this._initPosition(),this},setWidth:function(a){return this._options.width=a,this.updateSize(),this._initPosition(),this},setHeader:function(a){return this._options.header=a,a===!1&&this._$header?(this._$body.css("top",0),this._$header.remove(),this._$header=null,this._$dialog.addClass("nlui-dialog-noheader")):a===!0&&null===this._$header&&this._addHeader(),this.updateSize(),this._initPosition(),this},setMinWidth:function(a){return this._options.minWidth=a,this._setResizable(),this._initPosition(),this},setBeforeClose:function(a){return this._options.beforeClose=a,this},getBox:function(){return this._$dialog},getHeader:function(){return this._$header},getHeaderContent:function(){return this._$headerContent},getHeaderLeft:function(){return this._isInFullPage?this._$leftHeaderContent:void 0},getHeaderRight:function(){return this._isInFullPage?this._$rightHeaderContent:void 0},setHeaderContent:function(a){return this._$header||this._addHeader(),this._$headerContent.empty().append(a),this},getBody:function(){return this._$body},getFooter:function(){return this._$footer},getCommandBar:function(a){return a=a||this._defaultCmdBar,this._cmdBar[a]},hideCommandBar:function(a){return a=a||this._defaultCmdBar,this._cmdBar[a].hide(),this},showCommandBar:function(a){return a=a||this._defaultCmdBar,this._cmdBar[a].show(),this},getButton:function(a){var b;return $.each(this.getButtons(),function(c,d){return d.prop("id")===a?(b=d,!1):void 0}),b},getButtonConfigs:function(){return this._options.buttons},getButtons:function(){return this.getCommandBar().soCmdBar("getCommands")},getCommandAttribute:function(a,b,c){return a=a||this._defaultCmdBar,this._cmdBar[a].soCmdBar("getCommandAttribute",b,c)},setCommandAttribute:function(a,b,c,d){return a=a||this._defaultCmdBar,this._cmdBar[a].soCmdBar("setCommandAttribute",b,c,d)},getContentZone:function(){return this.getBody()},refreshRendering:function(){var a,b,a=this._$body[0];return"auto"===this._options.height&&(b=a.scrollHeight-a.offsetHeight,this._$dialog.css("height",this._$dialog[0].offsetHeight+b+"px")),this.updateSize(),this._initPosition(),this},_verticalAlign:function(){var a;return this._$dialog.addClass("nlui-dialog-valign"),a=this.$el[0].offsetHeight/2,"transparent"===this._options.mode&&(a+=this._$header[0].offsetHeight),this.$el.css("margin-top",-a+"px"),this},toggleCloseButton:function(a){return this._$closeBt&&this._$closeBt.toggle(a),this}}),$.widget("SO.soDialog",{_create:function(){this._widget=new SO.Widgets.Dialog(this.element,this.options)},_destroy:function(){this._widget.destroy()},open:function(a){this._widget.open(a)},isOpen:function(){return this._widget.isOpen()},rebuildLayout:function(){this._widget.rebuildLayout()},setAdaptable:function(a,b){this._widget.setAdaptable(a,b)},focus:function(a){this._widget.focus(a)},close:function(a,b,c){this._widget.close(a,b,c)},cancel:function(a,b){this._widget.cancel(a,b)},setTitle:function(a,b){this._widget.setTitle(a,b)},addButton:function(a,b,c){return this._widget.addButton(a,b,c)},setContent:function(a){this._widget.setContent(a)},addContent:function(a){this._widget.addContent(a)},setNoPrimaryFirstButton:function(a){this._widget.setNoPrimaryFirstButton(a)},setButtons:function(a){this._widget.setButtons(a)},setHeight:function(a){this._widget.setHeight(a)},setWidth:function(a){this._widget.setWidth(a)},setHeader:function(a){this._widget.setHeader(a)},setMinWidth:function(a){this._widget.setMinWidth(a)},setBeforeClose:function(a){this._widget.setBeforeClose(a)},setHeaderContent:function(a){this._widget.setHeaderContent(a)},getBox:function(){return this._widget.getBox()},getHeader:function(){return this._widget.getHeader()},getHeaderLeft:function(){return this._widget.getHeaderLeft()},getHeaderRight:function(){return this._widget.getHeaderRight()},getBody:function(){return this._widget.getBody()},getFooter:function(){return this._widget.getFooter()},getCommandBar:function(a){return this._widget.getCommandBar(a)},getButton:function(a){return this._widget.getButton(a)},getButtonConfigs:function(){return this._widget.getButtonConfigs()},getButtons:function(){return this._widget.getButtons()},getContentZone:function(){return this._widget.getContentZone()},refreshRendering:function(){this._widget.refreshRendering()},getHeaderContent:function(){return this._widget.getHeaderContent()},toggleCloseButton:function(a){this._widget.toggleCloseButton(a)},setCommandAttribute:function(a,b,c,d){this._widget.setCommandAttribute(a,b,c,d)},getCommandAttribute:function(a,b,c){this._widget.getCommandAttribute(a,b,c)},showCommandBar:function(a){this._widget.showCommandBar(a)},hideCommandBar:function(a){this._widget.hideCommandBar(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("cmdBar",{DEFAULT_OPTIONS:{controller:null,onRefreshVisibility:void 0,commandConfigs:{},commands:[],rendering:"bar",iconSize:void 0,mode:void 0,separators:void 0,rightSeparator:void 0,leftSeparator:void 0,maxButtons:null,overflowMode:void 0,overflowLeftIcon:void 0,overflowRightIcon:void 0,overflowLabel:void 0,minButtonWidth:void 0},_create:function(){SO.assert(null===this._options.controller,"cmdBar should not use controller anymore");var a,b;for(b=this,this._$buttonContainer=null,this._currentId=0,this._commands=[],this._commandConfigs={},SO.Utils.each(this._options.commandConfigs,function(a,c){b._commandConfigs[a]=c}),a=0;this._options.commands.length>a;a++)this.addCommand(this._options.commands[a],this._options.commandConfigs[this._options.commands[a]],!0);return this._$buttonContainer=$("<div></div>").appendTo(this.$el).addClass("nlui-cmdbar-nav"),"bar"===this._options.rendering&&this._$buttonContainer.soButtonBar({autoOpenMenu:this._options.autoOpenMenu,iconSize:this._options.iconSize,mode:this._options.mode,separators:this._options.separators,rightSeparator:this._options.rightSeparator,leftSeparator:this._options.leftSeparator,maxButtons:this._options.maxButtons,overflowMode:this._options.overflowMode,overflowLeftIcon:this._options.overflowLeftIcon,overflowRightIcon:this._options.overflowRightIcon,overflowLabel:this._options.overflowLabel}),this.refresh(),this},refresh:function(){var a=this._extendConfiguration(this._commands);return this._currentId=0,"bar"===this._options.rendering&&this._$buttonContainer.soButtonBar("setButtons",a),this},onCommandNotify:function(){this.refresh()},_extendConfiguration:function(a){var b,c,d,e,f;for(c=[],b=0;a.length>b;b++)d=a[b],null===d?c.push(null):(SO.isString(d)?(f=this._commandConfigs[d]||{},f.name=d,e=this._generateButtonConfig(f)):(f={},void 0!==d.name&&(f=$.extend(f,this._commandConfigs[d.name])),f=$.extend(f,d.config,{name:d.name,menuPosition:d.menuPosition,params:d.params}),e=this._generateButtonConfig(f),d.subCommands&&(e.subButtons=this._extendConfiguration(d.subCommands),e.menuPosition=f.menuPosition,void 0===e.rightIcon&&(e.rightIcon="ui-icon-triangle-1-s"))),c.push(e));return c},_generateButtonConfig:function(a){var b,c;return b=this,c={icon:a.icon,iconSize:a.iconSize,label:a.label,mode:a.mode,tooltip:a.help,pushed:a.isPushed,disabled:a.disabled,hidden:a.hidden},void 0!==a.name&&void 0!==a.command&&(c.onClick=function(){b.triggerCommand(a.name,a.params)}),c.uid="button"+this._currentId,this._currentId+=1,c},addCommand:function(a,b,c){return this._commands.push(a),SO.isString(a)&&!this._commandConfigs[a]&&(this._commandConfigs[a]=b),c||this.refresh(),this},removeCommand:function(a,b){var c=this._commands.indexOf(a);return-1!==c&&(this._commands.splice(c,1),delete this._commandConfigs[a],b||this.refresh()),this},reset:function(a){return this._commands=[],a||this.refresh(),this},triggerCommand:function(a,b){var c,d,e,f,g,h,i,j;return e=this._commandConfigs[a],c=this,f=$("<div></div>"),g={message:xtk_core.dialog_loadingLabel(),onCancel:null,open:function(){e.command(d,b,function(){f.soMessageBox("close")})}},h=function(a){f.soMessageBox({type:"loading",message:a.message,delay:a.delay,onCancel:a.onCancel,onOpen:a.open})},i=function(a,b){e.waitBox?h($.extend({},g,e.waitBox)):e.command(a,b)},j=function(){SO.isFunction(e.onBeforeExecuteCommand)&&e.onBeforeExecuteCommand(c),i(c,b)},e&&e.command&&(e.confirmDialog?$("<div></div>").soMessageBox({type:"confirm",title:e.confirmDialog.title,message:e.confirmDialog.message,confirmButtonLabel:e.confirmDialog.confirmButtonLabel,cancelButtonLabel:e.confirmDialog.cancelButtonLabel,onConfirm:j}):j()),this},_setLocalAttribute:function(a,b,c,d){var e,f;for(e=0;a.length>e;e++)f=a[e],f&&!SO.isString(f)&&(f.name===b&&void 0!==f.config&&void 0!==f.config[c]&&(f.config[c]=d),f.subCommands&&this._setLocalAttribute(f.subCommands,b,c,d));return this},getCommandAttribute:function(a,b){return this._commandConfigs[a][b]},setCommandAttribute:function(a,b,c,d){var e=this._commandConfigs[a][b];return e!==c&&(this._commandConfigs[a][b]=c,this._setLocalAttribute(this._commands,a,b,c),d||this.refresh()),this},hideAllCommands:function(a){var b;return b=function(a,c){var d,e;for(d=0;c.length>d;d++)e=c[d],null!==e&&(SO.isString(e)?a.setCommandAttribute(e,"hidden",!0,!0):(void 0!==e.name&&a.setCommandAttribute(e.name,"hidden",!0,!0),e.subCommands&&b(a,e.subCommands)))},b(this,this._commands),a||this.refresh(),this},destroy:function(){return this._$buttonContainer.remove(),this},getCommands:function(){return this._$buttonContainer.soButtonBar("getButtons")}}),$.widget("SO.soCmdBar",{_create:function(){this._widget=new SO.Widgets.cmdBar(this.element,this.options)},_destroy:function(){this._widget.destroy()},refresh:function(){this._widget.refresh()},onCommandNotify:function(a,b){this._widget.onCommandNotify(a,b)},addCommand:function(a,b,c){this._widget.addCommand(a,b,c)},removeCommand:function(a){this._widget.removeCommand(a)},reset:function(a){this._widget.reset(a)},triggerCommand:function(a,b){this._widget.triggerCommand(a,b)},createWaitBox:function(a){this._widget.createWaitBox(a)},executeCommand:function(a,b){this._widget.executeCommand(a,b)},runCommand:function(){this._widget.runCommand()},getCommandAttribute:function(a,b){return this._widget.getCommandAttribute(a,b)},setCommandAttribute:function(a,b,c,d){this._widget.setCommandAttribute(a,b,c,d)},hideAllCommands:function(a){this._widget.hideAllCommands(a)},getCommands:function(){return this._widget.getCommands()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){var a={flatToolbar:{className:"flatToolbar",separator18:"flatToolbar-separator18",separator24:"flatToolbar-separator24",leftBorder:"",rightBorder:"",separators:!0,leftSeparator:!1,rightSeparator:!1},subMenu:{className:"nlui-buttonbar-submenu",separator18:"nlui-horizontal-separator",separator24:"nlui-horizontal-separator",leftBorder:"",rightBorder:"",separators:!1,leftSeparator:!1,rightSeparator:!1}};SO.Widgets.define("buttonBar",{DEFAULT_OPTIONS:{buttons:[],iconSize:void 0,mode:void 0,separators:void 0,rightSeparator:void 0,leftSeparator:void 0,maxButtons:null,overflowMode:void 0,overflowLeftIcon:void 0,overflowRightIcon:void 0,overflowLabel:void 0},_create:function(){this._lastCompiledConfiguration=void 0,this._buttons=[],this._nlButtons=[],this._buttonCache=[],this._$ul=$("<ul></ul>").appendTo(this.$el).addClass("nlui-buttonbar-list");var b=a[this._options.mode];void 0!==b&&(this._$ul.addClass(b.className),this._options.separators=void 0!==this._options.separators?this._options.separators:b.separators,this._options.leftSeparator=void 0!==this._options.leftSeparator?this._options.leftSeparator:b.leftSeparator,this._options.rightSeparator=void 0!==this._options.rightSeparator?this._options.rightSeparator:b.rightSeparator);for(var c=0;this._options.buttons.length>c;c++)this.addButton(this._options.buttons[c],!0);this.refresh(),this._popableSubMenus=[]},_setOption:function(a,b){this._options[a]=b,("rightSeparator"===a||"leftSeparator"===a)&&(this._lastCompiledConfiguration=void 0)},addButton:function(a,b){return this._buttons.push(a),b||this.refresh(),this},setButtons:function(a){return this._buttons=a,this.refresh(),this},empty:function(){return this._buttons=[],this.refresh(),this},_toggleSubMenu:function(a,b){var c,d=this,e={},f=!0;return function(){var g=$(this),h={my:"left-2 top+1",at:"left bottom",collision:"flipfit",of:g.parent()};e.isOwnerOf=function(a){return SO.DOMUtils.isDescendantOf(a,g.parent())||a.is(g)},e.collapse=function(){var a=d._popableSubMenus.indexOf(this);c.remove(),f=!0,d._options.popableManager.removePopable(d._popableSubMenus[a]),d._popableSubMenus.splice(a,1)},f?(c=d._buildSubMenu(a.subButtons),g.parent().append(c),d._options.popableManager.addPopable(e),d._popableSubMenus.push(e),f=!1,b&&SO.Utils.extend(h,{my:"left top",at:"right top"}),c.position(h)):e.collapse()}},_compileSubMenuConfiguration:function(a,b){for(var c=this,d=!1,e=!0,f=!0,g=this._toggleSubMenu(a,b),h=0;!d&&a.subButtons.length>h;h++)null!==a.subButtons[h]&&(d=d||a.subButtons[h].isPushed);if(a.isPushed=d,void 0===a.disabled){for(var h=0;e&&a.subButtons.length>h;h++)null!==a.subButtons[h]&&(e=e&&a.subButtons[h].disabled);a.disabled=e}if(void 0===a.hidden){for(var h=0;f&&a.subButtons.length>h;h++)null!==a.subButtons[h]&&(f=f&&a.subButtons[h].hidden);a.hidden=f}return a.subButtons=SO.Utils.map(a.subButtons,function(a,d){var e;if(d&&d.onClick){var e=d.onClick;SO.Utils.extend(d,{onClick:function(a,b,d){for(var f=0;c._popableSubMenus.length>f;f++)c._popableSubMenus[f].collapse();e(a,b,d)}})}return null!==d&&$.extend(!0,d,c._compileButtonConfiguration(d,b+1),{mode:"submenu"}),d}),a.label&&void 0===a.rightIcon&&(a.rightIcon=b?"ui-icon-triangle-1-e":"ui-icon-triangle-1-s"),a.disabled||a.hidden||(a.onClick?a.onRightIconClick=g:a.onClick=g),a},_compileButtonConfiguration:function(a,b){return b=b||0,a&&a.subButtons?this._compileSubMenuConfiguration(a,b):a},_compileConfiguration:function(){var a=this,b=[];if(null!==this._options.maxButtons&&this._buttons.length>this._options.maxButtons){for(var c=0;this._options.maxButtons-1>c;c++)b.push(this._buttons[c]);for(var d=[],e=this._options.maxButtons-1;this._buttons.length>e;e++)d.push($.extend({},{iconSize:this._options.iconSize,mode:this._options.overflowMode,isPushed:!1},this._buttons[e]));var f={icon:this._options.overflowLeftIcon,rightIcon:this._options.overflowRightIcon,label:this._options.overflowLabel,mode:this._options.mode,subButtons:d};b.push(f)}else b=this._buttons;b=SO.Utils.map(b,function(b,c){return null===c?null:$.extend({iconSize:a._options.iconSize,mode:a._options.mode},c)}),this._options.separators&&(b=this._addSeparators(b)),b=SO.Utils.map(b,function(b,c){return a._compileButtonConfiguration(c)}),b=this._collapseSeparators(b);for(var g=!0,h=0;b.length>h;h++)null!==b[h]?b[h].hidden||(b[h].leftRounded=g,g=!1):g=!0;for(var i=!0,h=b.length-1;h>=0;h--)null!==b[h]?b[h].hidden||(b[h].rightRounded=i,i=!1):i=!0;return b},_collapseSeparators:function(a){for(var b=[],c=0;a.length>c;c++){var d=a[c];if(null!==d)d.subButtons&&(d.subButtons=this._collapseSeparators(d.subButtons)),b.push(d);else{var e=0===b.length?null:b[b.length-1];null!==e&&b.push(null)}}return null===b[b.length-1]&&b.splice(b.length-1,1),b},_compatibleCompiledConfs:function(a,b){if(void 0===a)return!1;if(a.length!==b.length)return!1;for(var c=0;b.length>c;c++){var d=a[c],e=b[c];if(d||e){if(!d||!e)return!1;if(!d.uid||!e.uid||d.uid!==e.uid)return!1}}return!0},_drawButton:function(a,b){b.is(":so-soSimpleButton")&&b.soSimpleButton("destroy"),b.children().remove(),b.empty(),b.addClass("nlui-buttonbar-item");var c=!1;return a.hidden||(a.mode="flatToolbar"===a.mode?"quiet":a.mode,b.soSimpleButton(a),c=!0),c},_drawSeparator:function(){var b="separator ";void 0===this._options.mode?b+="default-separator":void 0!==a[this._options.mode]&&(b+=24===this._options.iconSize?a[this._options.mode].separator24:a[this._options.mode].separator18);var c=$('<li class="'+b+'"></li>');return c},_drawSubMenuSeparator:function(){return $('<li class="'+a.subMenu.separator18+'"></li>')},_drawLeftSeparator:function(){var a=this._drawSeparator();a.appendTo(this._$ul),a.addClass("left-separator")},_drawRightSeparator:function(){var a=this._drawSeparator();a.appendTo(this._$ul),a.addClass("right-separator")},_addSeparators:function(a){for(var b=[],c=0,d=a.length;d>c;c++)a[c]&&a[c].subButtons&&(a[c].subButtons=this._addSeparators(a[c].subButtons)),b.push(a[c]),b.push(null);return b},_buildSubMenu:function(b){for(var c,d=$("<ul></ul>",{"class":a.subMenu.className}),e=!0,f=0,g=b.length;g>f;f++){var h=b[f];if(null!==h)c=$("<li></li>",{"class":"nlui-buttonbar-submenu-item"}),h.hidden?c.hide():e=!1,d.append(c),h.mode="quiet",this._drawButton(h,c);else{var i=this._drawSubMenuSeparator();e&&i.hide(),d.append(i),e=!0}}return d},_buildPopoverMenu:function(a){var b,c,d,e,f,g,h;for(d=$("<ul></ul>"),f=!0,b=0,h=a.length;h>b;b++)c=a[b],null!==c?(e=$('<li class="nlui-popover-menu-item"></li>'),c.hidden?e.hide():f=!1,d.append(e),c.hidden||(c.mode="popover",e.soSimpleButton(c))):(g=this._drawSubMenuSeparator(),f&&g.hide(),d.append(g),f=!0);return d},_fullBuild:function(a){this._$ul.children().remove(),this._buttonCache=[],this._options.leftSeparator&&this._drawLeftSeparator();for(var b=!0,c=0;a.length>c;c++){var d=a[c];if(null!==d){var e=$("<li></li>");d.hidden?e.hide():b=!1,this._$ul.append(e);var f=this._drawButton(d,e);this._buttonCache.push({container:e,created:f})}else{var g=this._drawSeparator();b&&g.hide(),this._$ul.append(g),this._buttonCache.push({container:g,created:!0}),b=!0}}this._options.rightSeparator&&this._drawRightSeparator()},_changeButtonOptions:function(a,b){return SO.Utils.extend(a,{mode:"flatToolbar"===a.mode?"quiet":a.mode}),a.subButtons?(b.children().remove(),this._drawButton(a,b),void 0):(b.soSimpleButton("setOptions",a),void 0)},_diffBuild:function(a){for(var b=!0,c=null,d=0;a.length>d;d++){var e=a[d],f=this._buttonCache[d];if(null!==e)if(e.hidden)f.container.hide();else{if(f.created)this._changeButtonOptions(e,f.container);else{var g=this._drawButton(e,f.container);f.created=g}f.container.show().css("display",""),b=!1}else f.container.css("display",b?"none":"inline-block"),b||(c=f.container),b=!0}b&&c&&c.hide()},refresh:function(){var a=this._compileConfiguration();this._compatibleCompiledConfs(this._lastCompiledConfiguration,a)?this._diffBuild(a):this._fullBuild(a),this._lastCompiledConfiguration=a,this._nlButtons=[];for(var b=0;a.length>b;b++){var c=a[b];c&&!c.hidden&&this._nlButtons.push(this._buttonCache[b].container)}},destroy:function(){},getButtons:function(){return this._nlButtons}}),$.widget("SO.soButtonBar",{_create:function(){this._widget=new SO.Widgets.buttonBar(this.element,this.options)},_destroy:function(){this._widget.destroy()},addButton:function(a,b){this._widget.addButton(a,b)},setButtons:function(a){this._widget.setButtons(a)},empty:function(){this._widget.empty()},refresh:function(){this._widget.refresh()},getButtons:function(){return this._widget.getButtons()}})})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){var a={"default":{buttonClass:"nlui-button nlui-button-default",pushedClass:"nlui-button nlui-button-default pushed",disabledClass:"nlui-button nlui-button-default disabled",iconsClass:"nlui-icon-inverse"},primary:{buttonClass:"nlui-button nlui-button-primary",pushedClass:"nlui-button nlui-button-primary pushed",disabledClass:"nlui-button nlui-button-primary disabled",iconsClass:"nlui-icon-inverse"},coral:{buttonClass:"nlui-button nlui-button-coral",pushedClass:"nlui-button nlui-button-coral pushed",disabledClass:"nlui-button nlui-button-coral disabled",iconsClass:void 0},error:{buttonClass:"nlui-button nlui-button-error",pushedClass:"nlui-button nlui-button-error pushed",disabledClass:"nlui-button nlui-button-error disabled",iconsClass:"nlui-icon-inverse"},success:{buttonClass:"nlui-button nlui-button-success",pushedClass:"nlui-button nlui-button-success pushed",disabledClass:"nlui-button nlui-button-success disabled",iconsClass:"nlui-icon-inverse"},warning:{buttonClass:"nlui-button nlui-button-warning",pushedClass:"nlui-button nlui-button-warning pushed",disabledClass:"nlui-button nlui-button-warning disabled",iconsClass:"nlui-icon-inverse"},info:{buttonClass:"nlui-button nlui-button-info",pushedClass:"nlui-button nlui-button-info pushed",disabledClass:"nlui-button nlui-button-info disabled",iconsClass:"nlui-icon-inverse"},inverse:{buttonClass:"nlui-button nlui-button-inverse",pushedClass:"nlui-button nlui-button-inverse pushed",disabledClass:"nlui-button nlui-button-inverse disabled",iconsClass:"nlui-icon-inverse"},white:{buttonClass:"nlui-button nlui-button-white",pushedClass:"nlui-button nlui-button-white",disabledClass:"nlui-button nlui-button-white disabled",iconsClass:void 0},transparent:{buttonClass:"nlui-button nlui-button-transparent",pushedClass:void 0,disabledClass:"nlui-button nlui-button-transparent disabled",iconsClass:void 0},universeMenu:{buttonClass:"nlui-button nlui-button-universeMenu",pushedClass:"nlui-button nlui-button-universeMenu-pushed",disabledClass:void 0,iconsClass:void 0},navMenu:{buttonClass:"nlui-button nlui-button-navMenu",pushedClass:"nlui-button nlui-button-navMenu-pushed",leftIconPushedClass:"nlui-icon-primary",disabledClass:void 0,iconsClass:void 0},submenu:{buttonClass:"nlui-button nlui-button-submenu",pushedClass:"nlui-button nlui-button-submenu pushed",rightIconPushedClass:"nlui-icon-inverse pushed",leftIconPushedClass:"nlui-icon-inverse pushed",disabledClass:"nlui-button nlui-button-submenu disabled",iconsClass:void 0},backToTheList:{buttonClass:"nlui-button",pushedClass:void 0,disabledClass:void 0,iconsClass:void 0},toolbar:{buttonClass:"nlui-button nlui-button-toolbar",pushedClass:"nlui-button nlui-button-toolbar pushed",disabledClass:"nlui-button nlui-button-toolbar disabled",iconsClass:void 0},flatToolbar:{buttonClass:"nlui-button nlui-button-flatToolbar",pushedClass:"nlui-button nlui-button-flatToolbar pushed",disabledClass:"nlui-button nlui-button-flatToolbar disabled",iconsClass:void 0},popover:{buttonClass:"",pushedClass:"nlui-button-popover-selected",disabledClass:"nlui-button-popover-disabled",iconsClass:void 0}},b={small:60,medium:100,large:150};SO.Widgets.define("Button",{DEFAULT_OPTIONS:{icon:void 0,rightIcon:void 0,iconSize:void 0,minWidth:void 0,label:void 0,help:void 0,mode:void 0,flat:!1,isPushed:!1,disabled:!1,isLink:!1,href:"",newWindow:!1,leftRounded:!0,rightRounded:!0,badgerValue:null,onClick:function(a,b,c){c()},onLeftIconClick:null,onRightIconClick:null},_create:function(){this.currentButtonClass=void 0,this.currentPushedClass=void 0,this.currentDisabledClass=void 0,this.currentLeftIconPushedClass=void 0,this.currentRightIconPushedClass=void 0,this.currentIconsClass=void 0,this.leftPointedCornerClass="left-pointed",this.rightPointedCornerClass="right-pointed",this.__options=SO.Utils.extend({},this._options),this._$contentWrapper=null,this._$labelWrapper=null,this._$label=null,this._$leftIcon=null,this._$rightIcon=null,this._$a=null,this._$badger=null,this._refresh()},_resetContainers:function(){this._$contentWrapper=null,this._$labelWrapper=null,this._$label=null,this._$leftIcon=null,this._$rightIcon=null},_setIconSize:function(a){a=parseInt(a,10)||0,this.__options.iconSize=16===a||20===a||0===a?20===a?20:16:a},_refreshIconClasses:function(){this._$leftIcon&&this.currentIconsClass&&this._$leftIcon.children(".nlui-icon").addClass(this.currentIconsClass),this._$rightIcon&&this.currentIconsClass&&this._$rightIcon.children(".nlui-icon").addClass(this.currentIconsClass),this._$contentWrapper.toggleClass("has-icon20",20===this.__options.iconSize),this._$contentWrapper.toggleClass("has-icon24",24===this.__options.iconSize),this.$el.toggleClass("nlui-button-iconOnly",SO.isEmpty(this.__options.label))},_setIcon:function(a,b){SO.isNundef(this.__options.iconSize)||SO.assert(18===this.__options.iconSize||24===this.__options.iconSize,"Icons buttons should now accept only 18px and 24px size");var c,d,e,f,g,h,i=this;if("left"===b)e="nlui-button-icon",f=i.__options.onLeftIconClick,g="icon";else{if("right"!==b)throw"Icon must be left or right";e="nlui-button-righticon",f=i.__options.onRightIconClick,g="rightIcon"}if(d="has-"+b+"Icon",c="_$"+b+"Icon",i.__options[g]=a,SO.isEmpty(a))i[c]&&(i[c].remove(),i[c]=null,i._$labelWrapper&&i._$labelWrapper.removeClass(d));else{switch(i[c]?(this._$contentWrapper.is(":so-soTooltip")&&i._$contentWrapper.soTooltip("hide"),i[c].children().remove()):(i[c]=$("<span></span>").addClass(e),i._$contentWrapper.prepend(i[c]),i._$labelWrapper&&i._$labelWrapper.addClass(d),this._setIconCallback(f,b)),i.__options.iconSize){case 16:case 20:this.$el.addClass("nlui-button-oldicon"),h=SO.IMG.genImage(a,i.__options.iconSize,!1,0);break;default:h=SO.IMG.genIcon(a,i.__options.iconSize)}this[c].html(h),this._refreshIconClasses()}},_setIconCallback:function(a,b){var c,d,e,f=this;if("left"===b)d=f.__options.onLeftIconClick,e="onLeftIconClick";else{if("right"!==b)throw"Icon must be left or right";d=f.__options.onRightIconClick,e="onRightIconClick"}if(f.__options[e]=a,c="_$"+b+"Icon",f[c])if(null!==a){var g=d||f.__options.onClick;SO.Event.unbind(f[c].get(0),"vclick"),this.__options.disabled||SO.Event.bind(f[c].get(0),"vclick",function(a){var b=a.originalEvent;return f._$contentWrapper.is(":so-soTooltip")&&f._$contentWrapper.soTooltip("hide"),b.ctrlKey||1===b.button||"_blank"===b.currentTarget.target?!0:(g($(f.$el),b,function(){f.__options.isLink&&(f.__options.newWindow?window.open(f.option.href,"_blank"):window.location=f.__options.href)}),void 0)},{stopPropagation:!0})}else SO.Event.unbind(f[c].get(0),"vclick")},setMode:function(a){this.__options.mode=a,this._updateClasses()},_setFlat:function(a){this.__options.flat=a,a||"white"===this.__options.mode?this.$el.removeClass("nlui-button-gradient"):this.$el.addClass("nlui-button-gradient")},_setLeftRoundedCorners:function(a){this.__options.leftRounded=a,this.$el.toggleClass(this.leftPointedCornerClass,!this.__options.leftRounded)},_setRightRoundedCorners:function(a){this.__options.rightRounded=a,this.$el.toggleClass(this.rightPointedCornerClass,!this.__options.rightRounded)},_updateClasses:function(){var b=this;this._setLeftRoundedCorners(b.__options.leftRounded),this._setRightRoundedCorners(b.__options.rightRounded),b._setFlat(b.__options.flat),$.each([this.currentButtonClass,this.currentPushedClass,this.currentDisabledClass,this.currentLeftIconPushedClass,this.currentRightIconPushedClass,this.currentIconsClass],function(a,c){void 0!==c&&b.$el.removeClass(c)});var c;c=SO.isEmpty(this.__options.mode)?"default":this.__options.mode,this.currentButtonClass=void 0,this.currentPushedClass=void 0,this.currentDisabledClass=void 0,this.currentLeftIconPushedClass=void 0,this.currentRightIconPushedClass=void 0,this.currentIconsClass=void 0,void 0!==a[c]&&(this.currentButtonClass=a[c].buttonClass,this.currentPushedClass=a[c].pushedClass,this.currentDisabledClass=a[c].disabledClass,this.currentLeftIconPushedClass=a[c].leftIconPushedClass,this.currentRightIconPushedClass=a[c].rightIconPushedClass,this.currentIconsClass=a[c].iconsClass),void 0===this.currentPushedClass&&(this.currentPushedClass=this.currentButtonClass),void 0===this.currentDisabledClass&&(this.currentDisabledClass=this.currentButtonClass),this._refreshIconClasses(),this.__options.isPushed&&this._setPushed(!0);var d=this.currentButtonClass;this.__options.disabled&&(d=this.currentDisabledClass),this.$el.addClass(d)},_setPushed:function(a){this.__options.isPushed=a,a?(this._$leftIcon&&this.currentLeftIconPushedClass&&this._$leftIcon.children(".nlui-icon").addClass(this.currentLeftIconPushedClass),this._$rightIcon&&this.currentRightIconPushedClass&&this._$rightIcon.children(".nlui-icon").addClass(this.currentRightIconPushedClass),this.__options.disabled||this.$el.addClass(this.currentPushedClass)):(this.$el.removeClass(this.currentPushedClass).addClass(this.currentButtonClass),this._$leftIcon&&this.currentLeftIconPushedClass&&this._$leftIcon.children(".nlui-icon").removeClass(this.currentLeftIconPushedClass),this._$rightIcon&&this.currentRightIconPushedClass&&this._$rightIcon.children(".nlui-icon").removeClass(this.currentRightIconPushedClass)),this._changeIconState("left",a),this._changeIconState("right",a)},_changeIconState:function(a,b){var c,d;a=a||"left","transparent"!==this.__options.mode&&"navMenu"!==this.__options.mode&&"flatToolbar"!==this.__options.mode||16===this.__options.iconSize||20===this.__options.iconSize||("left"===a?(c=this._$leftIcon,d=this.__options.icon):(c=this._$rightIcon,d=this.__options.rightIcon),c&&(c.empty(),b?c.append(SO.IMG.genIcon(d+"-active",this.__options.iconSize)):c.append(SO.IMG.genIcon(d,this.__options.iconSize))))},_setTooltip:function(a){this.__options.help=a,SO.isEmpty(this.__options.help)?this._$contentWrapper.is(":so-soTooltip")&&(this._$contentWrapper.soTooltip("setTitle",null),this._$contentWrapper.soTooltip("disable")):(this._$contentWrapper.soTooltip({gravity:"s"}),this._$contentWrapper.soTooltip("setTitle",this.__options.help),this._$contentWrapper.soTooltip("enable"))},setLabel:function(a){this.__options.label=a,SO.isEmpty(this.__options.label)?this._$labelWrapper&&(this._$labelWrapper.remove(),this._$labelWrapper=null,this._$label=null):(this._$labelWrapper||this._$label||(this._$labelWrapper=$('<span class="nlui-button-text"></span>').appendTo(this._$contentWrapper),this._$label=$('<span class="label"></span>').appendTo(this._$labelWrapper)),this._$label.text(this.__options.label))},_hover:function(a,b){var c=this,d=function(a){return function(){c.__options.disabled||$.each(b,function(b,c){SO.isNundef(c)||c.toggleClass("nlui-state-hover",a)})}};b=b||[a];for(var e=0;b.length>e;e++)b[e]&&b[e].removeClass("nlui-state-hover");a.hover(d(!0),d(!1))},_setWidth:function(a){var c;this.__options.minWidth=a,a&&(c=SO.isString(a)?b[this.__options.minWidth]:a,this.$el.css("min-width",c))},_setLink:function(a){this.__options.isLink=a,a===!1&&this._$a&&(this._$contentWrapper.unwrap(),this._$a=null),a===!0&&(this._$a||(this._$a=$('<a class="nlui-button-anchor"></a>'),this._$contentWrapper.wrap(this._$a)),SO.isEmpty(this.__options.href)||(this._$a.attr("href",this.__options.href),this.__options.newWindow&&this._$a.attr("target","_blank")))},_refresh:function(){this._$rightIcon&&this._$rightIcon.remove(),this._$leftIcon&&this._$leftIcon.remove(),this._$label&&this._$label.remove(),this._$labelWrapper&&this._$labelWrapper.remove(),this._$contentWrapper&&(this._$contentWrapper.is(":so-soTooltip")&&this._$contentWrapper.soTooltip("hide"),this._$contentWrapper.remove()),this._resetContainers(),this._$contentWrapper=$('<span class="nlui-button-wrapper"></span>'),this.$el.append(this._$contentWrapper),this._setWidth(this.__options.minWidth),this.setLabel(this.__options.label),this._setLink(this.__options.isLink),this._setButtonCallback(this.__options.onClick),this._setIconSize(this.__options.iconSize),SO.isEmpty(this.__options.icon)||this._setIcon(this.__options.icon,"left"),SO.isEmpty(this.__options.rightIcon)||this._setIcon(this.__options.rightIcon,"right"),this._setTooltip(this.__options.help),this._setBadgerValue(this.__options.badgerValue),this._updateClasses(),"submenu"===this.__options.mode?this.__options.icon&&this.__options.onLeftIconClick?this.__options.rightIcon&&this.__options.onRightIconClick?(this._hover(this._$label),this._hover(this._$leftIcon),this._hover(this._$rightIcon)):(this._hover(this._$labelWrapper,[this._$label,this._$rightIcon]),this._hover(this._$leftIcon)):this.__options.rightIcon&&this.__options.onRightIconClick?(this._hover(this._$labelWrapper,[this._$label,this._$leftIcon]),this._hover(this._$rightIcon)):this._hover(this._$labelWrapper):this._hover(this.$el)},_setButtonCallback:function(a){var b,c=this;b=this._$labelWrapper&&(this.__options.onLeftIconClick||this.__options.onRightIconClick)?this._$labelWrapper:this.$el,c.__options.onClick=a,null!==a?(SO.Event.unbind(b.get(0),"vclick"),this.__options.disabled||SO.Event.bind(b.get(0),"vclick",function(a){var b=a.originalEvent;c._$contentWrapper.is(":so-soTooltip")&&c._$contentWrapper.soTooltip("hide"),c.__options.onClick($(c.$el),b,function(){c.__options.isLink&&(c.__options.newWindow?window.open(c.__options.href,"_blank"):window.location=c.__options.href)})},{stopPropagation:!0,preventDefault:!0})):SO.Event.unbind(b.get(0),"vclick")},_setBadgerValue:function(a){SO.isEmpty(a)?this._$badger&&(this._$badger.destroy(),this._$badger=null):(this.__options.badgerValue=a,this._$badger?this._$badger.setValue(a):this._$badger=new SO.Widgets.Badger(this.$el,{value:this.__options.badgerValue}))},changeOptions:function(a){var b=SO.Utils.extend({},this.__options);return SO.Utils.extend(this.__options,a),void 0!==a.disabled&&a.disabled!==b.disabled?a.disabled===!0?this.disable():this.enable():(void 0!==a.label&&a.label!==b.label&&(this.setLabel(a.label),this._updateClasses()),void 0!==a.minWidth&&a.minWidth!==b.minWidth&&this._setWidth(a.minWidth),void 0!==a.help&&a.help!==b.help&&this._setTooltip(a.help),(void 0!==a.isLink||void 0!==a.href||void 0!==a.newWindow)&&(void 0!==a.isLink&&a.isLink!==b.isLink&&(this.__options.isLink=a.isLink),void 0!==a.href&&a.href!==b.href&&(this.__options.href=a.href),void 0!==a.newWindow&&a.newWindow!==b.newWindow&&(this.__options.newWindow=a.newWindow),this._setLink(this.__options.isLink)),void 0!==a.onClick&&a.onClick!==b.onClick&&this._setButtonCallback(a.onClick),void 0!==a.flat&&a.flat!==b.flat&&this._setFlat(a.flat),void 0!==a.leftRounded&&a.leftRounded!==b.leftRounded&&this._setLeftRoundedCorners(a.leftRounded),void 0!==a.rightRounded&&a.rightRounded!==b.rightRounded&&this._setRightRoundedCorners(a.rightRounded),void 0!==a.isPushed&&a.isPushed!==b.isPushed&&this._setPushed(a.isPushed),void 0!==a.iconSize&&a.iconSize!==b.iconSize?(this._setIconSize(this.__options.iconSize),this._setIcon(this.__options.icon,"left"),this._setIcon(this.__options.rightIcon,"right"),this._updateClasses()):(void 0!==a.icon&&a.icon!==b.icon?this._setIcon(a.icon,"left"):void 0!==a.onLeftIconClick&&a.onLeftIconClick!==b.onLeftIconClick&&this._setIconCallback(a.onLeftIconClick,"left"),void 0!==a.rightIcon&&a.rightIcon!==b.rightIcon?this._setIcon(a.rightIcon,"right"):void 0!==a.onRightIconClick&&a.onRightIconClick!==b.onRightIconClick&&this._setIconCallback(a.onRightIconClick,"right"),this._updateClasses()),void 0!==a.badgerValue&&this._setBadgerValue(a.badgerValue)),void 0!==a.mode&&a.mode!==b.mode&&this.setMode(a.mode),this},getOption:function(a){return this.__options.hasOwnProperty(a)?this.__options[a]:null},disable:function(){return this.__options.disabled=!0,this._refresh(),this},enable:function(){return this.__options.disabled=!1,this._refresh(),this},destroy:function(){var a=this;this._setIconCallback(null,"left"),this._setIconCallback(null,"right"),this._setButtonCallback(null),this.$el.removeClass(function(){for(var b="",c=["nlui-button-gradient",a.currentButtonClass,a.currentPushedClass,a.currentDisabledClass,a.currentLeftIconPushedClass,a.currentRightIconPushedClass,a.currentIconsClass,a.leftPointedCornerClass,a.rightPointedCornerClass],d=0;c.length>d;d++)void 0!==c[d]&&(b+=c[d]+" ");return b}),this._setBadgerValue(null),this._$contentWrapper.is(":so-soTooltip")&&this._$contentWrapper.soTooltip("hide"),this._$contentWrapper.remove()}}),$.widget("SO.soButton",{_create:function(){this._widget=new SO.Widgets.Button(this.element,this.options)},_destroy:function(){this._widget.destroy()},setMode:function(a){this._widget.setMode(a)},setLabel:function(a){this._widget.setLabel(a)},changeOptions:function(a){this._widget.changeOptions(a)},getOption:function(a){return this._widget.getOption(a)},disable:function(){this._widget.disable()},enable:function(){this._widget.enable()},getIconName:function(a){return this._widget.getIconName(a)}})})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.IMG"),SO.IMG.genImage=function(a,b,c,d){var e={};if(a){var f=a;f.indexOf(".")>=0?(SO.String.startsWith(f,"/")||SO.String.startsWith(f,"http")||(f=SO.route(""+f,"reverse_img")),e.src=f,e.type="background"):(e.type="class",e.src=f)}var g=null;return"background"===e.type?g=$('<span class="nlui-icon"></span>').css("background-image","url("+e.src+")"):"class"===e.type&&(g=$("<span></span>").addClass("nlui-icon").addClass(e.src),20===b&&g.addClass("nlui-icon20")),g&&(SO.isNundef(d)?g.addClass("nlui-icon-margin"):g.css("margin-right",d+"px")),g},SO.IMG.genIconClass=function(a,b){return"soui-icon-"+b+"-"+a},SO.IMG.genIcon=function(a,b){var c;return/^coral-/.test(a)?new SO.Icon({name:a.slice(6),size:b}):c=/.nlui-icon/.test(a)?this.genImage(a,b,!1,0):$('<i class="'+this.genIconClass(a,b)+'"></i>')},SO.Icon=function(a){a=SO.Utils.extend({size:18,state:"default"},a),Object.defineProperty(this,"el",{writable:!1,value:$("<i>",{"class":["coral-Icon","coral-Icon--size-"+a.size].join(" ")})[0]}),this.setName(a.name),this.setState(a.state)},SO.Icon.prototype._STATES={active:"coral-Icon--state-active",inverse:"color-Icon--state-inverse","default":"color-Icon--state-default",parent:void 0},SO.Icon.prototype.setState=function(a){return this._currentState&&this.el.classList.remove(this._STATES[this._currentState]),this._currentState=a,this.el.classList.add(this._STATES[a]),this},SO.Icon.prototype.setName=function(a){return/^coral-/.test(a)&&(a=a.slice(6)),this._currentName&&this.el.classList.remove("coral-Icon--"+this._currentName),this.el.classList.add("coral-Icon--"+a),this._currentName=a,this};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Tooltip",{DEFAULT_OPTIONS:{gravity:"autoNS",margin:75,fade:!0,opacity:1,mode:"default"},_classFromState:{normal:"nlui-tooltip-normal",success:"nlui-tooltip-success",info:"nlui-tooltip-info",warning:"nlui-tooltip-warning",error:"nlui-tooltip-error"},_create:function(){var a,b,c="hover",d=0;a=this._options.title,"string"==typeof a&&(this._options.title=function(){return a}),b=this._options.mode&&"default"!==this._options.mode?this._options.mode:"warning",this._classMode=this._classFromState[b]||"nlui-tooltip-normal",this._handleGravity(this._options.gravity);var e="nlui-tooltip "+this._classMode;SO.Browser.isTouchScreen()&&(c="vlongclick",d=1500),this.$el.tipsy($.extend({},this._options,{delayIn:500,className:e,offset:6,trigger:c,delayOut:d}))},show:function(){this.$el.tipsy("show")},hide:function(){this.$el.tipsy("hide")},enable:function(){this.$el.tipsy("enable")},disable:function(){this.$el.tipsy("disable")},setTitle:function(a){this.$el.attr("original-title",a)},_cleverPosition:function(a){return function(){var b,c="",d=this;return"autoNS"===a?(b=$(d).offset().top>$(document).scrollTop()+$(window).height()/2?"s":"n",c="a"):b="autoWE"===a?$(d).offset().left>$(document).scrollLeft()+$(window).width()/2?"e":"w":a,b.charAt(0)+c}},_handleGravity:function(a){this._options.gravity="autoNS"===a?this._cleverPosition("autoNS"):"autoWE"===a?this._cleverPosition("autoWE"):$.fn.tipsy.autoBounds(this._options.margin,this._options.gravity)}}),$.widget("SO.soTooltip",{_create:function(){this._widget=new SO.Widgets.Tooltip(this.element,this.options)},show:function(){this._widget.show()},hide:function(){this._widget.hide()},enable:function(){this._widget.enable()},disable:function(){this._widget.disable()},setTitle:function(a){this._widget.setTitle(a)}});
;// LICENSE Tipsy 1.0.0a - see licenses.txt §2.7
(function(a){function b(a,b){return"function"==typeof a?a.call(b):a}function c(b,c){this.$element=a(b),this.options=c,this.enabled=!0,this.fixTitle()}var d;c.prototype={show:function(){d&&d.hide(),d=this;var c=this.getTitle();if(c&&this.enabled){var e=this.tip();e.find(".tipsy-inner")[this.options.html?"html":"text"](c),e[0].className="tipsy",e.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body),this.options.className&&e.addClass(b(this.options.className,this.$element[0]));var f,g=a.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),h=e[0].offsetWidth,i=e[0].offsetHeight,j=b(this.options.gravity,this.$element[0]);switch(j.charAt(0)){case"n":f={top:g.top+g.height+this.options.offset,left:g.left+g.width/2-h/2};break;case"s":f={top:g.top-i-this.options.offset,left:g.left+g.width/2-h/2};break;case"e":f={top:g.top+g.height/2-i/2,left:g.left-h-this.options.offset};break;case"w":f={top:g.top+g.height/2-i/2,left:g.left+g.width+this.options.offset}}if(0===g.left&&0===g.top)return;if(2==j.length){if("a"==j.charAt(1)){var k="";0>f.left?k="w":f.left+h>a(window).width()+a(document).scrollLeft()&&(k="e"),j=j.charAt(0)+k}"w"==j.charAt(1)?f.left=g.left+g.width/2-15:"e"==j.charAt(1)&&(f.left=g.left+g.width/2-h+15)}e.css(f).addClass("tipsy-"+j);var l=e.find(".tipsy-arrow");l[0].className="tipsy-arrow tipsy-arrow-"+j.charAt(0),this.options.fade?e.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):e.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){a(this).remove()}):this.tip().remove(),d=null},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("original-title"))&&a.attr("original-title",a.attr("title")||"").removeAttr("title")},getTitle:function(){var a,b=this.$element,c=this.options;this.fixTitle();var a,c=this.options;return"string"==typeof c.title?a=b.attr("title"==c.title?"original-title":c.title):"function"==typeof c.title&&(a=c.title.call(b[0])),a=(""+a).replace(/(^\s*|\s*$)/,""),a||c.fallback},tip:function(){return this.$tip||(this.$tip=a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>')),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},a.fn.tipsy=function(b){function d(d){var e=a.data(d,"tipsy");return e||(e=new c(d,a.fn.tipsy.elementOptions(d,b)),a.data(d,"tipsy",e)),e}function e(){var a=d(this);a.hoverState="in",0==b.delayIn?a.show():(a.fixTitle(),setTimeout(function(){"in"==a.hoverState&&a.show()},b.delayIn))}function f(){var a=d(this);a.hoverState="out",0==b.delayOut?a.hide():setTimeout(function(){"out"==a.hoverState&&a.hide()},b.delayOut)}if(b===!0)return this.data("tipsy");if("string"==typeof b){var g=this.data("tipsy");return g&&g[b](),this}if(b=a.extend({},a.fn.tipsy.defaults,b),b.live||this.each(function(){d(this)}),"manual"!=b.trigger){var h=b.live?"live":"bind";this[h]("mouseenter",e)[h]("mouseleave",f),"vlongclick"==b.trigger&&this[h]("touchstart",e)[h]("touchend",f)}return this},a.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},a.fn.tipsy.elementOptions=function(b,c){return a.metadata?a.extend({},c,a(b).metadata()):c},a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"},a.fn.tipsy.autoWE=function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"},a.fn.tipsy.autoBounds=function(b,c){return function(){var d={ns:c[0],ew:c.length>1?c[1]:!1},e=a(document).scrollTop()+b,f=a(document).scrollLeft()+b,g=a(this);return e>g.offset().top&&(d.ns="n"),f>g.offset().left&&(d.ew="w"),b>a(window).width()+a(document).scrollLeft()-g.offset().left&&(d.ew="e"),b>a(window).height()+a(document).scrollTop()-g.offset().top&&(d.ns="s"),d.ns+(d.ew?d.ew:"")}}})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Badger",{DEFAULT_OPTIONS:{value:"",params:{size:24,position:"top-right",mode:"default",image:"",animation:!0,autoShow:!0}},_create:function(){this._oldCssPosition=this.$el.css("position"),this._oldCssOverflow=this.$el.css("overflow"),("visible"!==this._oldCssOverflow||"relative"!==this._oldCssPosition)&&this.$el.css("position","relative"),this._value=this._options.value,this._position=this._options.params.position,this._size=this._options.params.size,this._type=typeof this._options.value,this._mode=this._options.params.mode,this._image=this._options.params.image,this._animation=this._options.params.animation,this._autoShow=this._options.params.autoShow,this._$badgeElem=document.createElement("div"),this._$badgeInner=document.createElement("div"),this._$badgeContent=document.createElement("div"),this._refreshDisplay(),this._$badgeInner.appendChild(this._$badgeContent),this._$badgeElem.appendChild(this._$badgeInner),this.$el.append($(this._$badgeElem).hide()),this._autoShow&&this.show()},_setClasses:function(a,b,c,d){var e="nlui-badger";this._$badgeElem.className=e+" "+e+"-"+b+" "+e+"-"+a+" nlui-badger-animated",this._$badgeInner.className=e+"-inner "+e+"-"+d,this._$badgeContent.className=e+"-content "+e+"-"+c},_refreshDisplay:function(){$(this._$badgeElem).is(":visible")||this.show();var a;""!==this._image?(a=this._size>=30?"nlui-icon20":"nlui-icon",$(this._$badgeContent).html($("<span>",{"class":"nlui-badger-image light "+a+" nlui-icon-inverse "+this._image}))):this._$badgeContent.innerHTML=this._value,this._setClasses(this._position,this._size,this._type,this._mode),this._animation&&this._animate("animate-pulse")},_animate:function(a,b,c){var d=this;b&&b(d),this._animation?($(this._$badgeElem).removeClass(a).addClass(a),setTimeout(function(){$(d._$badgeElem).removeClass(a),c&&c(d)},200)):c&&c(d)},setValue:function(a){this._image="",this._type=typeof a,this._value=a,this._refreshDisplay()},setImage:function(a){this._value=null,this._image=SO.isEmpty(a)?"":a,this._refreshDisplay()},setMode:function(a){this._mode=a,this._refreshDisplay()},hide:function(){$(this._$badgeElem).is(":visible")&&this._animate("animate-hide",function(){},function(a){$(a._$badgeElem).hide()})},show:function(){$(this._$badgeElem).is(":visible")||this._animate("animate-show",function(a){$(a._$badgeElem).show()})},setPosition:function(a){this._position=a,this._refreshDisplay()},setSize:function(a){this._size=a,this._refreshDisplay()},getValue:function(){return SO.isEmpty(this._image)?this._value:this._image},destroy:function(){$(this._$badgeElem).remove(),delete this._$badgeElem,this.$el.css("overflow",this._oldCssOverflow).css("position",this._oldCssPosition)}}),$.widget("SO.soBadger",{_create:function(){this._widget=new SO.Widgets.Badger(this.element,this.options)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},setImage:function(a){this._widget.setImage(a)},setMode:function(a){this._widget.setMode(a)},hide:function(){this._widget.hide()},show:function(){this._widget.show()},setPosition:function(a){this._widget.setPosition(a)},setSize:function(a){this._widget.setSize(a)},destroy:function(){this._widget.destroy()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){var a=!1;SO.preventDelayedMsgBox=function(b){a=b},SO.Widgets.define("MessageBox",{DEFAULT_OPTIONS:{type:"info",delay:0,timeout:0,title:"",message:"",confirmButtonLabel:"",cancelButtonLabel:"",details:"",onOpen:null,onCancel:null,onConfirm:null,showTimer:!0,width:void 0},_iconForType:{warning:"coral-alert",error:"coral-alert",success:"coral-checkCircle",info:"coral-helpCircle"},_maxMessageLength:580,_create:function(){SO.assert(!this._options.error,"'error' argument for soMessageBox is not allowed any longer, use 'type' + 'message' instead");var a=this;this._timer=null,this._timeout=null,this._delay=null,this._$body=null,this._$spinner=null,this._$message=null,this._$messageContent=null,this._$timer=null,this._$details=null,this._dialogConfig={dialogClass:"nlui-messagebox nlui-messagebox-"+this._options.type,draggable:"confirm"===this._options.type,resizable:!1,header:!0,modal:!0,width:this._options.width,minHeight:70,noPrimaryFirstButton:!1,title:this._options.title||xtk_sirocco["dialog_"+this._options.type],titleIcon:this._iconForType[this._options.type],removeOnClose:!0,theme:this._options.theme,closeButton:"loading"!==this._options.type,open:function(){setTimeout(function(){SO.isFunction(a._options.onOpen)&&a._options.onOpen()},150)},cancel:this._options.onCancel,autoOpen:!1},this._options.delay?this._setDelay(this._options.delay):this._renderMessageBox()},_renderMessageBox:function(){this._dialog=new SO.Widgets.Dialog(this._dialogConfig),"loading"!==this._options.type||this._options.message||(this._options.message=xtk_sirocco.dialog_loadingLabel()),this._setType(this._options.type).setMessage(this._options.message)._setDetails(this._options.details)._setTimeout(this._options.timeout),"loading"===this._options.type&&this._setSpinner(),this._dialog.open()},_toggleDetails:function(){if(this._$details)this._$details.toggle();else{var a=this._options.message;SO.isEmpty(this._options.details)||(a=a+"\n\n"+this._options.details),this._$details=$("<pre></pre>",{"class":"nlui-messagebox-details",text:a}),this._$message.append(this._$details)}this._$messageContent.toggle(),this._dialog.setWidth(500)},_setButtons:function(a){var b=this,c=[];"confirm"===a?(c.push({text:b._options.cancelButtonLabel||xtk_sirocco.dialog_cancel(),cancels:!0,mode:"default"}),c.push({label:b._options.confirmButtonLabel||xtk_sirocco.dialog_doConfirm(),mode:"primary",click:function(){b.close(),SO.isFunction(b._options.onConfirm)&&b._options.onConfirm()}})):"loading"===a&&this._options.onCancel&&c.push({mode:"default",label:xtk_sirocco.dialog_cancel(),cancels:!0}),c.length>0&&this._dialog.setButtons(c)},setOnOpen:function(a){return this._options.onOpen=a,this},setMessage:function(a){var b,c=SO.String.truncate(a,this._maxMessageLength);return this._$body=this._$body||$("<div>",{"class":"nlui-messagebox-body"}),this._$message=this._$message||$("<div>",{"class":"nlui-messagebox-message"}),SO.isNundef(this._$messageContent)?(this._$messageContent=$("<span></span>",{text:c}),b=this._$messageContent.html(),this._$messageContent.html(b.replace(/\n/g,"<br>").replace(/\\n/g,"<br>")),this._$message.append(this._$messageContent),this._$body.append(this._$message)):this._$messageContent.text(c).html().replace(/\n/g,"<br>").replace(/\\n/g,"<br>"),"loading"===this._options.type&&this._options.showTimer&&this._setTimer(),this._dialog.setContent(this._$body),this._dialog.refreshRendering(),this._options.message=a,this},getMessage:function(){return this._options.message},_setSpinner:function(){this._$spinner=$("<div></div>").addClass("nlui-messagebox-spinner clui-wait-indicator").prependTo(this._$body),this._dialog.setHeader(!1),this._dialog.setMinWidth(this._options.width||260),this._dialog.setWidth(this._options.width||260)},_setTimer:function(){var a=this,b=+new Date,c=function c(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=a-3600*b-60*c;return 10>b&&(b="0"+b),10>c&&(c="0"+c),10>d&&(d="0"+d),("00"===b?"":b+":")+c+":"+d};this._$timer?this._$timer.text("(00:00)"):this._$timer=$('<span class="nlui-messagebox-timer"></span>').text("(00:00)").appendTo(this._$message),this._timer&&clearInterval(this._timer),this._timer=setInterval(function(){var d=Math.floor((+new Date-b)/1e3);a._$timer.text("("+c(d)+")")},250)},_setDelay:function(b){var c=this;return b>0&&(this._delay=setTimeout(function(){a||c._renderMessageBox()},1e3*b)),this._options.delay=b,this},_setType:function(a){return this._setButtons(a),this},_setDetails:function(a){var b=this,c=!SO.isEmpty(a);if(this._options.message&&this._options.message.length>=this._maxMessageLength&&(c=!0),c){var d=this._dialog.getButtonConfigs();d.unshift({text:xtk_sirocco.dialog_detail(),mode:"primary",click:function(){b._toggleDetails()}}),this._dialog.setButtons(d)}return this},_setTimeout:function(a){var b=this;return a>0&&(this._timeout=setTimeout(function(){b.close()},1e3*a)),this},isOpen:function(){this._dialog.isOpen()},close:function(){this._dialog instanceof SO.Widgets.Dialog&&(this._dialog.destroy(),this._dialog=null),this.$el.remove(),clearInterval(this._timer),clearTimeout(this._timeout),clearTimeout(this._delay)}}),$.widget("SO.soMessageBox",{_create:function(){this._widget=new SO.Widgets.MessageBox(this.element,this.options)},_destroy:function(){this._widget.close()},setMessage:function(a){this._widget.setMessage(a)},setOnOpen:function(a){this._widget.setOnOpen(a)},isOpen:function(){return this._widget.isOpen()},close:function(){this._widget.close()}})})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.UI"),NL.UI.Actions=function(a){return{_source:a,refresh:function(a){void 0!==a||location.reload(!0)},back:function(){history.back()},soap:function(a){if(void 0===a.provider)return SO.log.warn("Missing provider for soap call."),void 0;if(void 0===a.action)return SO.log.warn("Missing action for soap call."),void 0;var b=new NL.transport.SOAP({urn:a.provider,method:a.action});$.each(a.parameters,function(a,c){"string"==typeof c.value?b.writeString(c.name,c.value):"boolean"==typeof c.value?b.writeBoolean(c.name,c.value):"byte"===c.type?b.writeByte(c.name,c.value):b.writeInt(c.name,c.value)});try{b.start({async:a.async||!1,onSuccess:this._createAction(a.onSuccess,function(){location.reload(!0)})})}catch(c){var d;d="string"==typeof c?c:void 0!==c.message?c.message:xtk_core.soap_exception(),this._createAction(a.onError,function(){throw d}).call()}},confirmDialog:function(a){var b=this;void 0===a&&(a={});var c=$("<div></div>"),d=a.isError?xtk_core.dialog_error():xtk_core.dialog_confirm(),e=a.isError?xtk_core.dialog_error():xtk_core.dialog_confirm(),f=!0,g=void 0!==a.okLabel?a.okLabel:xtk_core.dialog_ok(),h=void 0!==a.cancelLabel?a.cancelLabel:xtk_core.dialog_cancel();d=void 0!==a.title?a.title:d,e=void 0!==a.msg?a.msg:e,f=void 0!==a.modal?a.modal:f,c.$contentMsg=$("<div></div>").appendTo(c),c.$contentError=$('<div id="" class="ui-state-error ui-corner-all" style="display: none;padding: 8px; margin-top: 6px"><p><span class="ui-icon ui-icon-alert" style="float:left; margin-right: .3em"></span><strong><div id="errMsg"></div></strong></p></div>').appendTo(c);var i=$.extend(a,{title:d,modal:f,autoOpen:!1,minWidth:350,minHeight:150,width:100,buttons:[{id:"ok",text:g,click:function(){try{b._createAction(a.onConfirm).call(),$(this).soDialog("close")}catch(d){c.$contentError.show(),c.$contentError.html('<p><span id="message">'+d+"</span></p>")}}},{id:"cancel",text:h,click:function(){b._createAction(a.onCancel).call(),$(this).soDialog("close")}}]});if($("body").prepend(c),c.soDialog(i),a.isError===!0)c.$contentError.show(),c.$contentError.html('<p><span id="message">'+e+"</span></p>");else if(a.isWarning===!0){var j=$("<p></p>");void 0!==a.warnMsg&&$('<span id="message"></span>').soActionMessage({message:a.warnMsg,state:"warning",displayIcon:"message"}).appendTo(j);var k=$('<p style="margin-top: 8px"></p>').append($("<span></span>").text(e));c.$contentMsg.append(j).append(k)}else c.$contentMsg.html('<p><span id="message">'+e+"</span></p>");c.soDialog("open")},alert:function(a){alert(a)},customCall:function(a){var b,c=window;if($.isArray(a.call)&&a.call.length>0){for(var c=window,d=0;a.call.length-1>d;d++)c=c[a.call[d]];b=a.call[a.call.length-1]}else"string"==typeof a.call&&(b=a.call);if(void 0===b)throw"No function call set.";if(!$.isFunction(c[b]))throw"No function ["+b+"] found.";c[b].apply(c,a.callArgs)},_createAction:function(a,b){var c,d=this,e=void 0!==this._source?this._source:this;if($.isFunction(a))c=function(){a.call(e)};else if($.isPlainObject(a)){var f;this._source&&$.isFunction(this._source[a.method])?f=this._source[a.method]:$.isFunction(this[a.method])&&(f=this[a.method]),$.isFunction(f)?c=$.isPlainObject(a.args)?function(){f.call(d,a.args)}:$.isArray(a.args)?function(){f.apply(d,a.args)}:function(){f.call(d)}:SO.log.warn("No action found (name: "+a.method+")")}else c=$.isFunction(b)?function(){b.call(d)}:function(){};return c},createActionCommand:function(a){return void 0!==a.action?this._createAction(a.action):void 0!==a.url?function(){document.location.href=a.url}:void 0}}},NL.UI.Actions.disable=function(a){var b=a.attr("nluiActionState");if(void 0===b||"enabled"==b){var c=$._data(a,"events");if(c){var d={};$.each(c,function(b,c){for(d[b]=[];c.length;)d[b].push(c[0].handler),a.unbind(b,c[0])}),a.data("storedEventsHandlers",d)}a.attr("nluiActionState","disabled")}},NL.UI.Actions.enable=function(a){var b=a.attr("nluiActionState");if(void 0===b||"disabled"==b){if(void 0!==a.data("storedEventsHandlers")){var c=a.data("storedEventsHandlers");$.each(c,function(b,c){for(var d=c.length,e=0;d>e;e++)a.bind(b,c[e])})}a.attr("nluiActionState","enabled")}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.MVC"),SO.MVC.Controller=function(a){var b={model:{},dataFormat:"typed",statemodel:{},displaymodel:{},metamodel:{},commandConfigs:{},views:{},unsavedText:xtk_core.ui_unsavedData()};if(SO.assert(!SO.isNundef(a&&a.metamodel),"Metamodel is required to create a controller"),a=SO.Utils.extend({},b,a),this._metamodel=a.metamodel instanceof SO.MVC.Metamodel?a.metamodel:new SO.MVC.Metamodel(a.metamodel||{}),this._dataFormat=a.dataFormat,a.model instanceof SO.MVC.Model)this._model=a.model;else{var c=a.model;if("json"===this._dataFormat){var d=this._metamodel.getAllTypes("/");c=SO.MVC.Model.parseJSON(c,d)}this._model=new SO.MVC.Model(c)}if(this._statemodel=a.statemodel instanceof SO.MVC.Statemodel?a.statemodel:new SO.MVC.Statemodel(a.statemodel),this._displaymodel=a.displaymodel instanceof SO.MVC.Displaymodel?a.displaymodel:new SO.MVC.Displaymodel(a.displaymodel),this._commands=a.commandConfigs,this._views=a.views,this._subController=null,this._unsavedText=a.unsavedText,this._dirty=!1,this._isDirtyInhibited=!1,this._dirtyInhibitorCounter=0,this._workingSpace=new SO.Structure.Set,this._propagationLevel=0,this._callbacks={onValueChanged:[],onErrorChanged:[],onDirtyChanged:[],onSave:[],onCheck:[],onRefreshVisibility:[],onFullRefresh:[]},a.workingSpace)if(SO.isArray(a.workingSpace))for(var e=0;a.workingSpace.length>e;e++)this._workingSpace.add(a.workingSpace[e]);else SO.assert(SO.isString(a.workingSpace),"WorkingSpace should be define by a string"),this._workingSpace.add(a.workingSpace);if(a.onValueChanged&&this.registerOnValueChanged(a.onValueChanged),a.onErrorChanged&&this.registerOnErrorChanged(a.onErrorChanged),a.onDirtyChanged&&this.registerOnDirtyChanged(a.onDirtyChanged),a.onSave&&this.registerOnSave(a.onSave),a.onCheck)if(SO.assert(SO.isPlainObject(a.onCheck)&&a.onCheck.hasOwnProperty("method")&&a.onCheck.hasOwnProperty("jpath")||SO.isArray(a.onCheck),"Bad onCheck definition on the configuration of the controller."),SO.isPlainObject(a.onCheck))this.registerOnCheck(a.onCheck.method,a.onCheck.jpath);else if(SO.isArray(a.onCheck))for(var e=0;a.onCheck.length>e;e++)this.registerOnCheck(a.onCheck[e].method,a.onCheck[e].jpath);a.onRefreshVisibility&&this.registerOnRefreshVisibility(a.onRefreshVisibility),a.pageController&&this.registerUnloadHandler(),this._observers={commands:[],views:[],blocks:[],jpath:{}},this._transactionStack=[],this._changeCollector=null,this._rangeEarlierStartDate=null,this._rangeLatestEndDate=null},SO.MVC.Controller.prototype={startTransaction:function(a){this._model.startTransaction(a),this._statemodel.startTransaction(a),this._transactionStack.push({dirty:this._dirty,changeCollector:this._changeCollector}),this._changeCollector=new SO.Structure.Set([],function(a,b){return a.jpath===b.jpath})},commit:function(a){this._model.commit(a),this._statemodel.commit(a);var b=this._transactionStack.splice(this._transactionStack.length-1)[0],c=this._changeCollector.toArray();this._changeCollector=b.changeCollector,null===this._changeCollector&&(this._changeCollector=new SO.Structure.Set([],function(a,b){return a.jpath===b.jpath}));var d;for(d=0;c.length>d;d++)this._changeCollector.add(c[d]);return c},commitAll:function(){this._model.commitAll(),this._statemodel.commitAll(),this._transactionStack=[]},rollback:function(a){this._model.rollback(a),this._statemodel.rollback(a);var b=this._transactionStack[this._transactionStack.length-1];this._transactionStack.splice(this._transactionStack.length-1),this._onDirtyChanged(null,this._dirty,b.dirty),this._dirty=b.dirty,this._changeCollector=b.changeCollector,this._refresh(),this._refreshVisibility()},registerUnloadHandler:function(){this._currentUnloadHandler||(this._currentUnloadHandler=this._unloadHandler.bind(this)),$(window).on("beforeunload",this._currentUnloadHandler)},unregisterUnloadHandler:function(){this._currentUnloadHandler&&$(window).off("beforeunload",this._currentUnloadHandler)},_unloadHandler:function(){var a=this.isDirty();return this._subController&&(a=a||this._subController.isDirty()),a?xtk_core.ui_unsavedData():void 0},_cleanUpChangeCollector:function(a){if(this._changeCollector)for(var b=this._changeCollector.toArray(),c=0;b.length>c;c++)SO.String.startsWith(b[c].jpath,a)&&this._changeCollector.remove(b[c])},propagateValues:function(a,b){var c=[],d=function(a,b,c){SO.Utils.each(b,function(b,e){var f=a;f+=SO.String.endsWith(f,"/")?b:"/"+b,SO.isPlainObject(e)?d(f,e,c):c.push({jpath:f,value:e})})};d(a,b,c);var e;for(e=0;c.length>e;e++){var f=c[e];this._metamodel.exists(f.jpath)&&this.setValueNotDirty(f.jpath,f.value,!0)}},setDefaultValuesNotDirty:function(a){var b=this,c=this.getValue(a),d=this.getType(a);if(void 0===c||"container"===d)if(["itempicker","link"].indexOf(d)>-1)this.setValueNotDirty(a,null);else if(["ANY","int64"].indexOf(d)>-1)this.setValueNotDirty(a,"");else if(["list","tree","grid"].indexOf(d)>-1)this.setValueNotDirty(a,[]);else if("container"===d){var e=b.getElements(a);SO.Utils.each(e,function(c){var d=a?a+"/"+c:c;b.setDefaultValuesNotDirty(d)})}else this.setValueNotDirty(a,NL.XTK.getDefaultTypeValue(d))},setValues:function(a,b){var c=this;this._propagationLevel+=1,SO.Utils.each(a,function(a,d){c.setValue(a,d,b)}),this._propagationLevel-=1,0===this._propagationLevel&&this._refreshVisibility()},isEqual:function(a,b,c){return a instanceof SO.Selection&&b instanceof SO.Selection&&"itempicker"===this.getType(c.getFullJpath())?this.areKeysEqual(this.getParams(c.getFullJpath()).source,a.getItem(),b.getItem()):SO.Utils.isEqual(a,b)},setValue:function(a,b,c,d){SO.assert(this._metamodel.exists(a),"'"+a+"' is not defined in metamodel"),a=new SO.Structure.Jpath(a);var e=this._model.setValue(a.getFullJpath(),b);if(!this.isEqual(e,b,a)){c&&(this._propagationLevel+=1);for(var f=!0,g=0;this._workingSpace.size()>g&&f;g++){var h=new SO.Structure.Jpath(a.getFullJpath());f=!h.startWith(this._workingSpace.toArray()[g])}!f||this._dirty||this._isDirtyInhibited||(this._dirty=!0,this._onDirtyChanged(a.getFullJpath(),!1,!0)),null===this._changeCollector||this._isDirtyInhibited||this._changeCollector.update({jpath:a.getFullJpath(),value:b}),this.notifyJpathObservers("value",a.getFullJpath(),b,d);var i=a.findCollection();i&&this.notifyJpathObservers("update",a.getFullJpath(),b,{position:i.positions[0]}),c&&(this._onValueChanged(a.getFullJpath(),e,b),this._propagationLevel-=1),0===this._propagationLevel&&this._refreshVisibility()}},setValueNotDirty:function(a,b,c,d){var e;this._isDirtyInhibited===!1&&(e=++this._dirtyInhibitorCounter,this._isDirtyInhibited=e),this.setValue(a,b,c,d),this._isDirtyInhibited===e&&(this._isDirtyInhibited=!1)},setValueCollectNoChange:function(a,b,c,d){this.setValueNotDirty(a,b,c,d),this.setDirty(!0)},setError:function(a,b,c,d){SO.assert(this._metamodel.exists(a),"'"+a+"' is not defined in metamodel"),SO.assert(null===b||SO.isPlainObject(b)&&b.hasOwnProperty("message"),"Given error not an object or does not have a message.");var e=this._statemodel.setError(a,b);SO.Utils.isEqual(e,b)||(this.notifyJpathObservers("error",a,b,d),c&&(this._propagationLevel+=1,this._onErrorChanged(a,e,b),this._propagationLevel-=1),0===this._propagationLevel&&this._refreshVisibility())},isInWorkingSpace:function(a){for(var b=!1,c=0;this._workingSpace.size()>c&&!b;c++){var d=new SO.Structure.Jpath(a);b=d.startWith(this._workingSpace.toArray()[c])}return b},_onErrorChanged:function(a,b,c){try{for(var d=0;this._callbacks.onErrorChanged.length>d;d++){var e=this._callbacks.onErrorChanged[d];e(a,this,b,c)}}catch(f){SO.log.warn("Error while processing the custom onErrorChanged methods for item "+a),SO.log.warn(f.message||f)}},_onValueChanged:function(a,b,c,d){try{for(var e=0;this._callbacks.onValueChanged.length>e;e++){var f=this._callbacks.onValueChanged[e];f(a,this,b,c,d)}}catch(g){SO.log.warn("Error while processing the custom onValueChanged calls"),SO.log.warn(g.message||g)}},_onDirtyChanged:function(a,b,c){if(b!==c)try{for(var d=0;this._callbacks.onDirtyChanged.length>d;d++){var e=this._callbacks.onDirtyChanged[d];e(c)}}catch(f){SO.log.warn("Error while processing the custom onDirtyChanged calls"),SO.log.warn(f.message||f)}},registerOnValueChanged:function(a){this._callbacks.onValueChanged.push(a)},registerOnErrorChanged:function(a){this._callbacks.onErrorChanged.push(a)},registerOnDirtyChanged:function(a){this._callbacks.onDirtyChanged.push(a)},registerOnRefreshVisibility:function(a){this._callbacks.onRefreshVisibility.push({method:a,observer:null})},registerOnFullRefresh:function(a){this._callbacks.onFullRefresh.push(a)},registerOnSave:function(a){this._callbacks.onSave.push(a)},registerOnCheck:function(a,b){this._callbacks.onCheck.push({method:a,jpath:b})},unregisterOnValueChanged:function(a){for(var b=0;this._callbacks.onValueChanged.length>b;b++)if(a===this._callbacks.onValueChanged[b]){this._callbacks.onValueChanged.splice(b,1);break}},unregisterOnErrorChanged:function(a){for(var b=0;this._callbacks.onErrorChanged.length>b;b++)if(a===this._callbacks.onErrorChanged[b]){this._callbacks.onErrorChanged.splice(b,1);break}},unregisterOnDirtyChanged:function(a){for(var b=0;this._callbacks.onDirtyChanged.length>b;b++)if(a===this._callbacks.onDirtyChanged[b]){this._callbacks.onDirtyChanged.splice(b,1);break}},unregisterOnRefreshVisibility:function(a){for(var b=this._callbacks.onRefreshVisibility,c=0;b.length>c;c++)null===b[c].observer&&b[c].method===a&&b.splice(c,1)},unregisterOnSave:function(a){for(var b=0;this._callbacks.onSave.length>b;b++)if(a===this._callbacks.onSave[b]){this._callbacks.onSave.splice(b,1);break}},unregisterOnCheck:function(a){for(var b=0;this._callbacks.onCheck.length>b;b++)if(a===this._callbacks.onCheck[b].method){this._callbacks.onCheck.splice(b,1);break}},_refreshVisibility:function(a){try{for(var b=0;this._callbacks.onRefreshVisibility.length>b;b++){var c=this._callbacks.onRefreshVisibility[b].method,d=this._callbacks.onRefreshVisibility[b].observer;(void 0===a||d===a||null===d)&&c(this)}}catch(e){SO.log.warn("Error while processing the custom onRefreshVisibility calls"),SO.log.warn(e.message||e)}},notifyJpathObservers:function(a,b,c,d){d=d||{};var e=[];if(SO.Utils.each(this._observers.jpath,function(a,c){var d=new SO.Structure.Jpath(a);(a===b||d.startWith(b))&&(e=e.concat(c))}),0!==e.length)for(var f=0;e.length>f;f++)e[f].onJpathNotify(a,b,c,d)},notifyViewObservers:function(a,b){for(var c=0;this._observers.views.length>c;c++)this._observers.views[c].onViewNotify(a,b)},notifyCommandObservers:function(a,b){for(var c=0;this._observers.commands.length>c;c++)this._observers.commands[c].onCommandNotify(a,b)},notifyBlockObservers:function(a,b,c){for(var d=0;this._observers.blocks.length>d;d++)this._observers.blocks[d].onBlockNotify(a,b,c)},registerObserver:function(a,b,c){SO.assert("jpath"!==a,"Using the deprecated 'jpath' family in the registerObserver method"),this._observers[a].push(b),c&&this._callbacks.onRefreshVisibility.push({method:c,observer:b})},registerJpathObserver:function(a,b,c){this._observers.jpath[a]||(this._observers.jpath[a]=[]),this._observers.jpath[a].push(b),c&&this._callbacks.onRefreshVisibility.push({method:c,observer:b})},unregisterObserver:function(a,b){if(SO.assert("jpath"!==a,"Using the deprecated 'jpath' family in the unregisterObserver method"),null!==b){for(var c=0;this._observers[a].length>c;c++)this._observers[a][c]===b&&this._observers[a].splice(c,1);for(var c=0;this._callbacks.onRefreshVisibility.length>c;c++)this._callbacks.onRefreshVisibility[c].observer===b&&this._callbacks.onRefreshVisibility.splice(c,1)}},unregisterJpathObserver:function(a,b){if(null!==b&&this._observers.jpath[a]){for(var c=0;this._observers.jpath[a].length>c;c++)this._observers.jpath[a][c]===b&&this._observers.jpath[a].splice(c,1);for(var c=0;this._callbacks.onRefreshVisibility.length>c;c++)this._callbacks.onRefreshVisibility[c].observer===b&&this._callbacks.onRefreshVisibility.splice(c,1)}},observerReady:function(a){this._refreshVisibility(a)},buildSubController:function(){if(null!==this._subController)throw"You cannot build a sub controller since it has already been created";this.startTransaction();var a=new SO.MVC.SubController(this);return this._subController=a,a},commitSubController:function(){if(null===this._subController)throw"You cannot commit the sub controller since it has not been created";var a,b=this.commit();for(a=0;b.length>a;a++)this.notifyJpathObservers("value",b[a].jpath,b[a].value),this._onValueChanged(b[a].jpath,null,b[a].value);return this.setDirty(this._subController.isDirty()),this._refresh(),this._refreshVisibility(),this._subController=null,this},rollbackSubController:function(){if(null===this._subController)throw"You cannot rollback the sub controller since it has not been created";return this.rollback(),this._subController=null,this},_refresh:function(){var a=new SO.Structure.Set;SO.Utils.each(this._observers.jpath,function(b,c){for(var d=0;c.length>d;d++)c[d].refresh&&a.add(c[d])}),a=a.toArray();for(var b=0;a.length>b;b++)a[b].refresh();for(var b=0;this._observers.views.length>b;b++)this._observers.views[b].refresh&&this._observers.views[b].refresh();for(var b=0;this._observers.commands.length>b;b++)this._observers.commands[b].refresh&&this._observers.commands[b].refresh();for(var b=0;this._callbacks.onFullRefresh.length>b;b++)this._callbacks.onFullRefresh[b]()},isDirty:function(a){if(this._changeCollector){for(var b=!1,c=this._changeCollector.toArray(),d=0;c.length>d&&!b;d++){var e=c[d],f=new SO.Structure.Jpath(e.jpath);b=a?f.contains(a):!0;for(var g=0;this._workingSpace.size()>g;g++)if(f.startWith(this._workingSpace.toArray()[g])){b=!1;break}}return b||!a&&this._dirty}return SO.assert(!a,"isDirty can't handle jpath parameter when controller have no changeCollector"),this._dirty},setDirty:function(a){if(a!==this._dirty)for(var b=0;this._callbacks.onDirtyChanged.length>b;b++){var c=this._callbacks.onDirtyChanged[b];c(a)}this._dirty=a},getCurrentPatch:function(a,b){if(void 0===a&&(a=""),a=SO.String.removePrefix(a,"/"),null===this._changeCollector)throw"You cannot get a patch since you did not open a transaction";var c=new SO.MVC.Model({});if(this._changeCollector)for(var d=this._changeCollector.toArray(),e=0;d.length>e;e++){var f=d[e].jpath;f=SO.String.removePrefix(f,"/");var g=d[e].value;if(SO.String.startsWith(f,a)){var h=SO.String.removePrefix(f,a);h=SO.String.removePrefix(h,"/"),h&&c.setValue(h,g)}}var i=c._model;if("json"===this._dataFormat||b){var j=this._metamodel.getAllTypes("/"),k={};SO.Utils.each(j,function(b,c){b=SO.String.removePrefix(b,"/"),SO.String.startsWith(b,a)&&(b=SO.String.removePrefix(b,a),b=SO.String.removePrefix(b,"/"),k[b]=c)}),i=SO.MVC.Model.serializeJSON(i,k)}return i},registerView:function(a,b){if(this._views[a])throw new Error("The view "+a+" is already registered in the controller.");this._views[a]=b},unregisterView:function(a){if(!this._views[a])throw new Error("The view "+a+" cannot be unregistred since it does not exist in the controller.");this._views[a]=void 0},getViewConfiguration:function(a){if(!this._views[a])throw new Error("Unable to get the configuration of the view "+a+" since it does not exist in the controller.");return this._views[a]},getViewAttribute:function(a,b){return this.getViewConfiguration(a)[b]},setViewAttribute:function(a,b,c){var d=this.getViewConfiguration(a);d[b]=c,this.notifyViewObservers(a,b)},registerCommand:function(a,b){if(this._commands[a])throw new Error("The command "+a+" is already registered in the controller.");this._commands[a]=b},unregisterCommand:function(a){if(!this._commands[a])throw new Error("The command "+a+" cannot be unregistred since it does not exist in the controller.");this._commands[a]=void 0},getCommandConfiguration:function(a){if(!this._commands[a])throw new Error("The command '"+a+"' is not defined");return this._commands[a]},getCommandAttribute:function(a,b){var c=this.getCommandConfiguration(a);return c[b]},setCommandAttribute:function(a,b,c){var d=this.getCommandConfiguration(a);d[b]=c,this.notifyCommandObservers(a,b)},check:function(a,b){var c=this;a=a||["/"],b=b||{};for(var d={valid:!0,message:""},e=0;a.length>e;e++){for(var f=this._getSubtree(a[e]),g=new SO.Structure.Jpath(a[e]),h=f,i=0;g.getPartsCount()>i;i++){var j=g.getItem(i);if("collection"!==j.type&&"tree"!==j.type||!j.positions)h=h[j.key].elements;else for(var k=0;j.positions.length>k;k++)h=h[j.key].data[j.positions[k]].elements}for(var l=[{obj:h,jpath:g}];l.length>0;){var j=l.shift(),m=j.jpath.getFullJpath();if(!(c.isDisabled(m)||c.isHidden(m)||b[m]&&!b[m].call(this,this)||(SO.Utils.each(j.obj,function(a,b){"collection"===b.type||"tree"===b.type?(l.push({obj:{},jpath:j.jpath.getJpath(a)}),SO.Utils.each(b.data,function(b,c){l.push({obj:c.elements,jpath:j.jpath.getJpath(a+"["+b+"]")})})):l.push({obj:b.elements,jpath:j.jpath.getJpath(a)})}),""===m))){this.setStrict(m,!0,!0);var n=this._statemodel.getError(m);if(null!==n)return{valid:!1,message:n,jpathError:m};for(var e=0;this._callbacks.onCheck.length>e;e++){var o=this._callbacks.onCheck[e],p=o.method(this);p.valid||(void 0!==o.jpath&&null!==o.jpath&&this.setError(o.jpath,{message:p.message},!0),d.valid&&(d=p))}}}}return d},_askForSave:function(a,b){if(!this.isDirty())return a(!0),void 0;var c=this,d=this._unsavedText+" "+xtk_core.ui_whatToDo(),e=$("<div></div>").text(d),f=[];f.push({text:xtk_core.dialog_save(),click:function(){e.soDialog("close"),c.save(a)}}),b&&f.push({text:xtk_core.dialog_dontSave(),click:function(){e.soDialog("close"),c._changeCollector?c._changeCollector.clear():c._dirty&&(c._dirty=!1,c._onDirtyChanged(null,!0,!1)),a(!0)}}),f.push({text:xtk_core.dialog_cancel(),click:function(){e.soDialog("close"),a(!1)}}),e.soDialog({title:xtk_core.dialog_confirm(),modal:!0,resizable:!1,width:400,buttons:f,beforeClose:function(){a(!1)}})},checkSave:function(a){this._askForSave(a,!0)},confirmSave:function(a){this._askForSave(a,!1)},save:function(a,b,c,d){var e=this;b=b||["/"],c=c||{},d=d||{};for(var f=[],g=[],h=function(a){for(var b=0;f.length>b;b++)if(f[b]===a){f.splice(b,1);break}},i=function(){for(var a=0;f.length>a;a++)void 0!==f[a].cancel&&f[a].cancel()},j=0;b.length>j;j++){for(var k=this._getSubtree(b[j]),l=new SO.Structure.Jpath(b[j]),m=k,n=0;l.getPartsCount()>n;n++){var o=l.getItem(n);if("collection"!==o.type&&"tree"!==o.type||!o.positions)m=m[o.key].elements;else for(var p=0;o.positions.length>p;p++)m=m[o.key].data[o.positions[p]].elements}for(var q=[{obj:m,jpath:l}];q.length>0;){var o=q.shift(),r=o.jpath.getFullJpath();if((!c[r]||c[r].call(this,this))&&(SO.Utils.each(o.obj,function(a,b){"collection"===b.type||"tree"===b.type?(q.push({obj:{},jpath:o.jpath.getJpath(a)}),SO.Utils.each(b.data,function(b,c){q.push({obj:c.elements,jpath:o.jpath.getJpath(a+"["+b+"]")})})):q.push({obj:b.elements,jpath:o.jpath.getJpath(a)})}),""!==r)){var s=this.check([r],d);s.valid||g.push(s)}}}if(0===g.length)if(this._callbacks.onSave.length>0){var t=!1,u=!0,v=$("<div></div>").soMessageBox({type:"loading",delay:3,onCancel:function(){u=!1,i()}}),w=0;SO.Utils.each(this._callbacks.onSave,function(c,d){c===e._callbacks.onSave.length-1&&(t=!0);var g=!1,j=d({controller:e,subtrees:b,success:function(){h(j),t&&0===f.length&&e.commitAll()},error:function(a){w++,SO.assert(a,"Error should be defined in controller error callback"),u=!1,v.soMessageBox("close"),$("<div></div>").soMessageBox({type:"error",message:a.message,details:a.details}),h(j),i()},complete:function(){if(t&&0===f.length){v.soMessageBox("close");var b=0,c=e._dirty;e._changeCollector&&(b=e._changeCollector.size(),e._changeCollector.clear()),e._dirty=!1,(b>0||c)&&e._onDirtyChanged(null,!0,!1),SO.isFunction(a)&&a(0===w)}g=!0}});g||null!==j||(j={fakeId:c}),SO.assert(void 0!==j,"Each onSave custom callback should return a job in order to enable standard behaviors"),g||void 0===j||f.push(j)})}else this.commitAll(),this._changeCollector&&this._changeCollector.clear(),this._dirty&&(this._dirty=!1,this._onDirtyChanged(null,!0,!1)),void 0!==a&&null!==a&&a(!0);else void 0!==a&&null!==a&&a(!1)},isItemComplete:function(a,b){SO.assert("list"===this._metamodel.getType(a)||"grid"===this._metamodel.getType(a)||"tree"===this._metamodel.getType(a),"Invalid type for jpath '"+a+"' : not a list or a grid");var c={elements:this._getSubtree(a)},d=function(a,b){if(0===b.length)return a;var c=b.shift();return d(a.elements[c],b)},e=function(a,b){var c=!0;return SO.Utils.each(a.elements,function(a,d){return b.hasOwnProperty(a)?(c=e(d,b[a]),c?void 0:!1):(c=!1,!1)}),c},f=e(d(c,a.split("/")),b);return f},setReadOnly:function(a,b,c){var d=this._displaymodel.setReadOnly(a,b);if(!c&&d!==b){var e=this._displaymodel.isReadOnly(a);this.notifyBlockObservers("readOnly",a,e)}},setDisabled:function(a,b,c){var d=this._displaymodel.setDisabled(a,b);if(!c&&d!==b){var e=this._displaymodel.isDisabled(a);this.notifyBlockObservers("disabled",a,e)}},setHidden:function(a,b,c){var d=this._displaymodel.setHidden(a,b);if(!c&&d!==b){var e=this._displaymodel.isHidden(a);this.notifyBlockObservers("hidden",a,e)}},setMandatory:function(a,b){SO.assert(this._metamodel.exists(a),"'"+a+"' is not defined in metamodel"),this._statemodel.setMandatory(a,b),this.notifyJpathObservers("mandatory",a,b)},setLabel:function(a,b){this._metamodel.setLabel(a,b),this.notifyJpathObservers("label",a,b)},setHelp:function(a,b){this._metamodel.setHelp(a,b),this.notifyJpathObservers("help",a,b)},setStrict:function(a,b,c){SO.assert(this._metamodel.exists(a),"'"+a+"' is not defined in metamodel");for(var d=this._metamodel.getAllJPaths(a),e=0;d.length>e;e++){var f=new SO.Structure.Jpath(d[e]),g=this._statemodel.setStrict(f.getFullJpath(),b);SO.Utils.isEqual(g,b)||this.notifyJpathObservers("strict",f.getFullJpath(),b,c)}},getType:function(a){return this._metamodel.getType(a)},getLabel:function(a){return this._metamodel.getLabel(a)},getDataPolicy:function(a){return this._metamodel.getDataPolicy(a)},getHelp:function(a){return this._metamodel.getHelp(a)},getLabelsPosition:function(a){return this._metamodel.getLabelsPosition(a)},getLabelsWidth:function(a){return this._metamodel.getLabelsWidth(a)},getError:function(a,b){return b?this._statemodel.getFirstError(a):this._statemodel.getError(a)},isMandatory:function(a){return this._statemodel.isMandatory(a)},isHidden:function(a){return this._displaymodel.isHidden(a)},isDisabled:function(a){return this._displaymodel.isDisabled(a)},isReadOnly:function(a){return this._displaymodel.isReadOnly(a)},isStrict:function(a){return this._statemodel.isStrict(a)},setParamSubtree:function(a,b,c){this._metamodel.setParamSubtree(a,b,c),this.notifyJpathObservers("params",a,null,{paramPath:b,value:c})},getParams:function(a){return this._metamodel.getParams(a)},getDisplayParams:function(a){return this._metamodel.getDisplayParams(a)},getDisplayFormat:function(a){return this._metamodel.getDisplayFormat(a)},getAllJPaths:function(){return this._metamodel.getAllJPaths()},getKeys:function(a){return this._metamodel.getKeys(a)},_getSubtree:function(a){SO.assert(a,"controller.getSubtree need a jpath");for(var b={},c=[a];c.length>0;){var d,e=c.shift(),f=new SO.Structure.Jpath(e);if(this.getType(f.getFullJpath()),d="/"===e?this._metamodel._metamodel:this._metamodel.getElements(f.getFullJpath())){var g=d;SO.Utils.each(g,function(a){var b=f.getJpath(a);c.push(b.getFullJpath())})}SO.Utils.extend(!0,b,f.buildObject())}return b},areKeysEqual:function(a,b,c){if(!b||!c)return!1;for(var d=this._metamodel.getKeys(a),e=!0,f=0;e&&d.length>f;f++){var g=d[f];e=e&&b[g]===c[g]&&void 0!==b[g]}return e},getValue:function(a){return this._model.getValue(a)},addCollectionItem:function(a,b,c,d){SO.assert("list"===this._metamodel.getType(a)||"grid"===this._metamodel.getType(a),"Invalid type for jpath '"+a+"' : not a list or a grid");var e=this._model.getValue(a);(null===c||void 0===c)&&(c=e.length);var f;d&&(f=SO.Utils.extend(!0,[],e));var g=this,h=function(b,h){h?g.notifyJpathObservers("cancelAdd",a):(SO.assert(function(){var c=g._model.getCollection(a),d=!0;return SO.Utils.each(c,function(c,e){g.areKeysEqual(a,e,b)&&(d=!1)}),d}(),"Duplicated item added with addCollectionItem"),g._model.addCollectionItem(a,b,c),g.notifyJpathObservers("add",a,void 0,{item:b,position:c}),g._dirty||(g._dirty=!0,g._onDirtyChanged(a,!1,!0)),d&&(g._propagationLevel+=1,g._onValueChanged(a,f,e,{type:"add",item:b,position:c}),g._propagationLevel-=1),0===g._propagationLevel&&g._refreshVisibility())};if(null===b||void 0===b){b={};var i=this._metamodel.getElements(a);for(var j in i){var k;k=void 0!==i[j].defaultValue?SO.isFunction(i[j].defaultValue)?i[j].defaultValue.call(this):i[j].defaultValue:NL.XTK.getDefaultTypeValue(i[j].type),b[j]=k}}var l=this._metamodel.getAddMethod(a);return null!==l?l(b,c,h):h(b,!1),c},addTreeItem:function(a,b,c){SO.assert("tree"===this._metamodel.getType(a),"Invalid type for jpath '"+a+"' : not a list");var d,e=this._model.getValue(a);c&&(d=SO.Utils.extend(!0,[],e));var f=this,g=function(b,g){g?f.notifyJpathObservers("cancelAdd",a):(f._model.addTreeItem(a,b),f.notifyJpathObservers("add",a,void 0,{item:b}),f._dirty||(f._dirty=!0,f._onDirtyChanged(a,!1,!0)),c&&(f._propagationLevel+=1,f._onValueChanged(a,d,e,{type:"add",item:b}),f._propagationLevel-=1),0===f._propagationLevel&&f._refreshVisibility())};if(null===b||void 0===b){b={};var h=this._metamodel.getElements(a);for(var i in h){var j;j=void 0!==h[i].defaultValue?SO.isFunction(h[i].defaultValue)?h[i].defaultValue.call(this):h[i].defaultValue:NL.XTK.getDefaultTypeValue(h[i].type),b[i]=j}}var k=this._metamodel.getAddMethod(a);return null!==k?k(b,a,g):g(b,!1),a},removeCollectionItem:function(a,b,c,d){SO.assert("list"===this._metamodel.getType(a)||"grid"===this._metamodel.getType(a),"Invalid type for jpath '"+a+"' : not a list or a grid");var e;c&&(e=SO.Utils.extend(!0,[],this._model.getValue(a)));var f=this,g=f._model.getValue(a),h=function(d,h){d?f.notifyJpathObservers("cancelRemove",a):(f._model.removeCollectionItem(a,b),f._cleanUpChangeCollector(a),f.notifyJpathObservers("remove",a,void 0,{position:b}),f._dirty||(f._dirty=!0,f._onDirtyChanged(a,!1,!0)),c&&(f._propagationLevel+=1,f._onValueChanged(a,e,g,{type:"remove",position:b}),f._propagationLevel-=1),0===f._propagationLevel&&f._refreshVisibility(),SO.isFunction(h)&&h.call())},i=this._metamodel.getRemoveMethod(a),j=SO.isArray(g)?a+"["+b+"]":a+"/"+b;null!==i?i(this._model.getValue(j),b,h):SO.isFunction(d)?d(this._model.getValue(j),b,h):h(!1)},removeTreeItem:function(a,b){SO.assert("tree"===this._metamodel.getType(a),"Invalid type for jpath '"+a+"' : not a tree");var c,d,e,f;d=new SO.Structure.Jpath(a),c=d.getFullJpath(),"]"===c[c.length-1]?c=c.substring(0,c.lastIndexOf("[")):(f=d.getLastFragmentPosition(),f.length>1&&(c+="["+f.slice(0,f.length-1).join(",")+"]")),b&&(e=SO.Utils.extend(!0,[],this._model.getValue(c)));var g=this,h=function(d){if(d)g.notifyJpathObservers("cancelRemove");else{g._model.removeTreeItem(a),g._cleanUpChangeCollector(a);var f=g._model.getValue(c);g.notifyJpathObservers("remove",{jpath:a}),this._dirty||(this._dirty=!0,this._onDirtyChanged(a,!1,!0)),b&&(g._propagationLevel+=1,g._onValueChanged(a,e,f,{type:"remove"}),g._propagationLevel-=1),0===g._propagationLevel&&g._refreshVisibility()}},i=this._metamodel.getRemoveMethod(a);null!==i?i(this._model.getValue(a),void 0,h):h(!1)},moveCollectionItem:function(a,b,c,d){SO.assert("list"===this._metamodel.getType(a),"Invalid type for jpath '"+a+"' : not a list");var e;d&&(e=SO.Utils.extend(!0,[],this._model.getValue(a))),this._model.moveCollectionItem(a,b,c);var f=this._model.getValue(a);this.notifyJpathObservers("move",a,void 0,{source:b,destination:c}),this._dirty||(this._dirty=!0,this._onDirtyChanged(a,!1,!0)),d&&(this._propagationLevel+=1,this._onValueChanged(a,e,f,{type:"move",source:b,destination:c}),this._propagationLevel-=1),0===this._propagationLevel&&this._refreshVisibility()},duplicateCollectionItem:function(a,b,c,d){SO.assert("list"===this._metamodel.getType(a),"Invalid type for jpath '"+a+"' : not a list"),(null===c||void 0===c)&&(c=b+1);var e;d&&(e=SO.Utils.extend(!0,[],this._model.getValue(a)));var f=this,g=function(g,h){if(h)f.notifyJpathObservers("cancelDuplicate",a);else{f._model.addCollectionItem(a,g,c);var i=f._model.getValue(a);f.notifyJpathObservers("duplicate",a,void 0,{destination:c,newItem:g}),f._dirty||(f._dirty=!0,f._onDirtyChanged(a,!1,!0)),d&&(f._propagationLevel+=1,f._onValueChanged(a,e,i,{type:"duplicate",source:b,destination:c}),f._propagationLevel-=1),0===f._propagationLevel&&f._refreshVisibility()}},h=this._model.getValue(a+"["+b+"]"),i={},j=this._metamodel.getElements(a);for(var k in j){var l;l=void 0!==j[k].duplicateValue?SO.isFunction(j[k].duplicateValue)?j[k].duplicateValue.call(this,h[k]):j[k].duplicateValue:h[k],i[k]=l}var m=this._metamodel.getDuplicateMethod(a);null!==m?m(i,h,c,g):g(i,!1)},getCollection:function(a,b,c,d,e,f){SO.assert(!(e&&b>0),"Collection: not (yet) able to refresh if the start index is not 0");var g=this._metamodel.getType(a);SO.assert(-1!==["list","tree","grid","chart"].indexOf(g),"Invalid type for jpath "+a+" : not a list, tree, grid or chart"),this.notifyJpathObservers("loading",a,!0);var h,i=null,j=this._metamodel.getDataSource(a);if(("list"===g||"grid"===g||"chart"===g)&&(h=this._model.getCollection(a)),j){var k=this,l={onError:function(b){d.onError(b),k.notifyJpathObservers("loading",a,!1)},onComplete:function(){d.onComplete(),k.notifyJpathObservers("loading",a,!1)}},m=j.getDataFormat();l.onSuccess=function(f){var h=null;if("json"===m){h=[];for(var i=k._metamodel.getAllTypes(a),j=0;f.length>j;j++){var l=SO.MVC.Model.parseJSON(f[j],i);h.push(l)}}else h=f;var n;e?(k.setValueNotDirty(a,h,!0),n=b>0||c>0?h.slice(b,b+c):h):"list"===g||"grid"===g?(k._model.fillCollection(a,h),n=k._model.getCollection(a),SO.isNundef(b)||(n=n.slice(b,b+c))):(k._model.fillTree(a,h),n=h),d.onSuccess(n)};var n=this._metamodel.getCurrentFilters(a),o=this._metamodel.getCurrentSorts(a);if(e)i=j.get(b,c,l,f,e,n,o);else{var p=h.length,q=b-p+c;null===b&&null===c||q>0?0===b?i=j.get(p,q,l,f,e,n,o):j.hasNext()?i=j.getNext(l):d.onSuccess([]):(d.onSuccess(h.slice(b,b+c)),d.onComplete&&d.onComplete(),i=null)}}else(null===b||void 0===b)&&(SO.log.warn("start is undefined. Fallback to 0"),b=0),(null===c||void 0===c)&&(SO.log.warn("lineCount is undefined. Fallback to the current data length"),c=h.length),0===c?d.onSuccess(h.slice(b)):h?d.onSuccess(h.slice(b,b+c)):d.onSuccess([]),d.onComplete?d.onComplete():null!==d.onComplete&&SO.log.warn("onComplete is not defined"),this.notifyJpathObservers("loading",a,!1);return i},getCount:function(a,b){SO.assert(-1!==["list","grid"].indexOf(this._metamodel.getType(a)),"Invalid type for jpath "+a+" : not a list");var c,d=this._metamodel.getDataSource(a),e=null;if(this.notifyJpathObservers("loading",a,!0),d){var f=this,g={onError:function(c){SO.isFunction(b.onError)&&b.onError(c),f.notifyJpathObservers("loading",a,!1)},onComplete:function(){SO.isFunction(b.onComplete)&&b.onComplete(),f.notifyJpathObservers("loading",a,!1)}};g.onSuccess=function(a){var c=null;a.hasOwnProperty("count")&&(c=a.count),b.onSuccess(c)},e=d.getCount(g)}else c=this._model.getCollection(a),e=!0,b.onSuccess(SO.Utils.count(c)),SO.isFunction(b.onComplete)&&b.onComplete(),this.notifyJpathObservers("loading",a,!1);return e},getPoint:function(a,b){var c=this._metamodel.getType(a);SO.assert("container"===c,"Invalid type for jpath "+a+" : not a container");var d=this._metamodel.getDataSource(a);if(d){var e=this,f={onError:function(a){b.onError(a)},onComplete:function(){b.onComplete()},onSuccess:function(c){e._model.setValue(a,c),b.onSuccess(c)}},g=this._metamodel.getCurrentFilters(a),h=this._metamodel.getCurrentSorts(a);return d.get(0,0,f,null,!0,g,h)}var i=this._model.getValue(a);return b.onSuccess(i),b.onComplete?b.onComplete():null!==b.onComplete&&SO.log.warn("onComplete is not defined"),null},getChildren:function(a,b,c,d,e){var f,g,h,i,j=null,k=this._metamodel.getType(a);if(SO.assert("tree"===k||"range"===k,"Invalid type for jpath "+a+" : not a tree"),g=this._metamodel.getDataSource(a),h="range"===k?$.extend([],this._model.getRangeChildren(a,this.getKeys(a))):$.extend([],this._model.getChildren(a)),g)if(f=this,i={onError:function(a){SO.assert("object"==typeof a,"error must be a object"),b.onError(a)
},onComplete:function(){b.onComplete()}},c||SO.isEmpty(h)){var l=f.getCurrentFilters(a),m=g.getDataFormat();i.onSuccess=function(d){!$.isArray(d)&&d.data&&(d=d.data);var e=null;if("json"===m){e=[];for(var g=f._metamodel.getAllTypes(a),h=0;d.length>h;h++){var i=SO.MVC.Model.parseJSON(d[h],g);e.push(i)}}else e=$.extend(!0,[],d);c?f.setValueNotDirty(a,e,!0):"range"===k?f._model.addRangeItems(a,e,f.getKeys(a)):f._model.fillTree(a,e),b.onSuccess(e)},g.prepareFromNode(e),j=g.get(null,null,i,d,c,l.filters)}else b.onSuccess(h),b.onComplete&&b.onComplete(),j=null;else b.onSuccess(h),b.onComplete?b.onComplete():null!==b.onComplete&&SO.log.warn("onComplete is not defined");return j},getRange:function(a,b,c,d){function e(b,c){var d=null;if("json"===c){d=[];for(var e=f._metamodel.getAllTypes(a),g=0;b.length>g;g++){var h=SO.MVC.Model.parseJSON(b[g],e);d.push(h)}}else d=$.extend(!0,[],b);return d}SO.assert(c>b,"Start date must be before end date"),SO.assert("range"===this._metamodel.getType(a),"Invalid type for jpath "+a+" : not a range"),b>=c&&d.onError("Start date must be before end date");var f,g,h,i=null,j=this._metamodel.getDataSource(a),k=this._metamodel.getCurrentFilters(a);if(!j||b>=this._rangeEarlierStartDate&&this._rangeLatestEndDate>=c)g=this._model.getRange(a,b,c),d.onSuccess(g),d.onComplete?d.onComplete():null!==d.onComplete&&SO.log.warn("onComplete is not defined");else{f=this;var l=j.getDataFormat();h={onError:function(a){d.onError(a)},onComplete:function(){d.onComplete()},onSuccess:function(g){var h=e(g,l);f._model.addRangeItems(a,h,f.getKeys(a)),d.onSuccess(f._model.getRange(a,b,c))}},null===this._rangeEarlierStartDate&&null===this._rangeLatestEndDate?(i=j.get(b,c,h,null,k,[]),this._rangeEarlierStartDate=b,this._rangeLatestEndDate=c):this._rangeEarlierStartDate>b&&this._rangeLatestEndDate>=c?(i=j.get(b,this._rangeEarlierStartDate,h,null,k,[]),this._rangeEarlierStartDate=b):b>=this._rangeEarlierStartDate&&c>this._rangeLatestEndDate?(i=j.get(this._rangeLatestEndDate,c,h,null,k,[]),this._rangeLatestEndDate=c):this._rangeEarlierStartDate>b&&c>this._rangeLatestEndDate&&(h.onSuccess=function(g){var h={onError:function(a){d.onError(a)},onComplete:function(){d.onComplete()},onSuccess:function(g){g=$.extend(!0,[],g);var h=e(g,l);f._model.addRangeItems(a,h,f.getKeys(a)),d.onSuccess(f._model.getRange(a,b,c))}};g=$.extend(!0,[],g);var m=e(g,l);f._model.addRangeItems(a,m,f.getKeys(a)),i=j.get(this._rangeLatestEndDate,c,h,null,k,[])},i=j.get(b,this._rangeEarlierStartDate,h,null,k,[]),this._rangeEarlierStartDate=b,this._rangeLatestEndDate=c)}return i},hasChildren:function(a,b){var c,d=!1,e=this._metamodel.getType(a);return SO.assert("tree"===e||"range"===e,"Invalid type for jpath "+a+" : not a tree or range"),d="range"===e?this._model.hasRangeChildren(a,this.getKeys(a)):this._model.hasChildren(a),d===!1&&(c=this._metamodel.getDataSource(a),SO.isNundef(c)||(d=c.hasChildren(b))),d},hasNext:function(a,b,c){var d,e=!1,f=this._metamodel.getDataSource(a);return SO.isNundef(f)?(d=this._model.getCollection(a),d&&(e=d.length>b+c)):e=f.hasNext(),e},hasCount:function(a){var b=!0,c=this._metamodel.getDataSource(a);return SO.isNundef(c)||(b=c.hasCount()),b},hasGrandChildren:function(a){var b=this._metamodel.getType(a);return SO.assert("tree"===b,"Invalid type for jpath "+a+" : not a tree"),this._model.hasGrandChildren(a)},getCurrentFilters:function(a){return this._metamodel.getCurrentFilters(a)},getCurrentSorts:function(a){return this._metamodel.getCurrentSorts(a)},getDataSourceCapabilities:function(a){SO.assert("list"===this._metamodel.getType(a)||"grid"===this._metamodel.getType(a)||"tree"===this._metamodel.getType(a),"Invalid type for jpath "+a+" : not a list or a tree");var b={},c=this._metamodel.getDataSource(a);return b=c?c.getCapabilities():{searchable:!0,realTime:!0,sortable:!1}},getDataSource:function(a){return this._metamodel.getDataSource(a)},getRemoveMethod:function(a){return this._metamodel.getRemoveMethod(a)},getElements:function(a){return this._metamodel.getElements(a)},getEnumValues:function(a){return this._metamodel.getEnumValues(a)},isSchemaWalkerSource:function(a){var b=!1,c=this._metamodel.getDataSource(a);return c&&(b=c instanceof NL.DataSource.SchemaWalker),b},getSchemaSourceLabelSingular:function(a){var b,c=this._metamodel.getDataSource(a);return c&&(b=c.getLabelSingular()),b},getSchemaSourceName:function(a){var b,c=this._metamodel.getDataSource(a);return c&&(b=c.schemaName),b},cancelGetCollection:function(a,b){SO.assert("list"===this._metamodel.getType(a)||"grid"===this._metamodel.getType(a)||"tree"===this._metamodel.getType(a),"Invalid type for jpath "+a+" : not a list or a tree");var c=this._metamodel.getDataSource(a);c&&c.cancel(b)},getOneElement:function(a,b,c){var d=this._metamodel.getType(a);if("list"!==d&&"grid"!==d&&"tree"!==d)throw"Invalid type for jpath "+a+" : not a list";var e=this._metamodel.getDataSource(a);e&&e.getOneElement(b,c)},applyFilter:function(a,b,c,d){var e=this._metamodel.getType(a);SO.assert(-1!==["list","tree","link","grid","chart"].indexOf(e),"Invalid type for jpath "+a+" : not a list, tree, grid, link or chart");for(var f=this._metamodel.getCurrentFilters(a),g=0;f.filters.length>g;g++){var h=f.filters[g];if(h.wildcard===b)return h.value=c,f.lastFilter=h,this._metamodel.setCurrentFilters(a,f),d&&this.notifyJpathObservers("filter",a,c,{wildcard:b}),this}return SO.log.warn("Unable to find wildcard "+b+" in "+a+" filters"),this},addFilter:function(a,b){for(var c=this._metamodel.getCurrentFilters(a),d=0;c.filters.length>d;d++)if(c.filters[d].wildcard===b.wildcard)return this;return c.filters.push(b),this._metamodel.setCurrentFilters(a,c),this},applySort:function(a,b,c,d){var e=this._metamodel.getType(a);SO.assert(-1!==["list","tree","link","grid"].indexOf(e),"Invalid type for jpath "+a+" : not a list, tree, grid or link");for(var f=this._metamodel.getCurrentSorts(a),g=0;f.sorts.length>g;g++){var h=f.sorts[g];if(h.id===b)return h.expr=c.expr,h.desc=c.desc,h.name=c.name,f.lastSort=h,this._metamodel.setCurrentSorts(a,f),d&&this.notifyJpathObservers("sort",a),this}return SO.log.warn("Unable to find id "+b+" in "+a+" sorts"),this},addSort:function(a,b){SO.assert(b.id,"addSort without id specified in sort argument is deprecated");for(var c=this._metamodel.getCurrentSorts(a),d=0;c.sorts.length>d;d++)if(c.sorts[d].id===b.id)return c.sorts[d]=b,this;return c.sorts.push(b),this._metamodel.setCurrentSorts(a,c),this},resetSort:function(a){return this._metamodel.setCurrentSorts(a,null),this},existsInMetaModel:function(a){return this._metamodel.exists(a)},safeGetType:function(a){var b=this.existsInMetaModel(a);return b?this.getType(a):(SO.log.debug("Missing metamodel information for "+a),null)},serializeXML:function(a,b){if(!(document&&document.implementation&&document.implementation.createDocument&&XMLSerializer))throw new Error("Unable to handle an XML document in current controller context.");var c=document.implementation.createDocument("","",null),d=c.createElement(b);c.appendChild(d);var e=this._metamodel.getAllTypes(a),f={};SO.Utils.each(e,function(b,c){b=SO.String.removePrefix(b,"/"),SO.String.startsWith(b,a)&&(b=SO.String.removePrefix(b,a),b=SO.String.removePrefix(b,"/"),f[b]=c)});var g=this.getValue(a),h=SO.MVC.Model.serializeJSON(g,f);this._valueToXML(c,d,h,a);var i=new XMLSerializer,j=i.serializeToString(c);return j},_valueToXML:function(a,b,c,d){var e,f,g,h,i=d;for(var j in c)if(c.hasOwnProperty(j)){if(g=c[j],f=i?i+"/"+j:j,e=this.safeGetType(f),!e)continue;switch(e){case"list":if(this._metamodel.getDataSource(f)){SO.log.warn("Lists with dataSource are not serialized");continue}if(SO.isArray(g))for(var k=0;g.length>k;k++)h=a.createElement(j),b.appendChild(h),this._valueToXML(a,h,g[k],f);if(SO.isObject(g)){h=a.createElement(j),b.appendChild(h);for(var l in g){var m=g[l],n=a.createElement(l);h.appendChild(n),this._valueToXML(a,n,m,f)}}break;case"grid":case"tree":SO.log.warn("Grid and tree XML Serialization may not be implemented yet");case"container":h=a.createElement(j),b.appendChild(h),this._valueToXML(a,h,g,f);break;case"link":case"itempicker":h=a.createElement(j),g&&(g=g.getItem(0),h.setAttribute("title",g.title),h.textContent=g.PKey),b.appendChild(h);break;case"dateonly":case"datetime":null===g?b.setAttribute(j,""):b.setAttribute(j,g);break;default:b.setAttribute(j,g)}}},parseXML:function(a,b){if(!DOMParser)throw new Error("Unable to parse an XML document in current controller context.");var c=new DOMParser,d=c.parseFromString(a,"text/xml"),e=d.firstChild,f={};this._XMLToValue(e,f,b,!0,!0);var g=this._metamodel.getAllTypes(b);f=SO.MVC.Model.parseJSON(f,g),this.setValueNotDirty(b,f)},_XMLToValue:function(a,b,c,d,e){var f={},g=c;d?f=b:(g=c+"/"+a.nodeName,b[a.nodeName]=f),e&&(g=c);for(var h,i=a.attributes.length,j=0;i>j;j++){h=a.attributes[j];var k=this.safeGetType(g+"/"+h.name);if(k){var l=h.value;switch(k){case"dateonly":case"datetime":l="null"===l||""===l?null:l;break;case"boolean":l=SO.Boolean.parse(l);break;case"number":case"integer":case"byte":case"short":case"long":l=SO.Integer.parse(l);break;case"double":l=SO.Float.parse(l);break;default:l=h.value}f[h.name]=l}}for(var m,n,o,p,q,r=a.childNodes.length,s=0;r>s;s++)if(m=a.childNodes[s],n=m.nodeName,o=c+"/"+n,p=this.safeGetType(o))switch(p){case"list":var t=this.getKeys(o);if(t&&t.length){n in f||(f[n]={});for(var u,v,w=m.childNodes.length,x=0;w>x;x++)u=m.childNodes[x],v={},f[n][u.nodeName]=v,this._XMLToValue(u,v,o,!0)}else n in f||(f[n]=[]),q={},f[n].push(q),this._XMLToValue(m,q,o,!0);break;case"itempicker":f[n]={PKey:m.textContent,title:m.getAttribute("title")};break;case"grid":case"tree":SO.log.warn("Grid and tree XML Parsing may not be implemented yet");default:this._XMLToValue(m,f,o,!1,!0)}}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.MVC"),SO.MVC.SubController=function(a){SO.MVC.SubController.baseConstructor.call(this,{model:a._model,metamodel:a._metamodel,statemodel:a._statemodel,displaymodel:a._displaymodel}),this._transactionStack=a._transactionStack,this._changeCollector=a._changeCollector,this._workingSpace=a._workingSpace,this._parent=a},SO.OO.extend(SO.MVC.SubController,SO.MVC.Controller),SO.MVC.SubController.prototype.getParent=function(){return this._parent};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a,b){a.widget("NL.nlInterceptor",a.NL.nlWidget,{options:{hoveringElement:null,containHovering:!1,centerOver:null,autoOpen:!0,hoveringMargin:0},_$mask:null,isVisible:function(){return this._$mask&&this._$mask.is(":visible")},_create:function(){var c=this;this.options.layoutManager.registerWidget(this),a(this.element).addClass("nlui-interceptor-intercepted"),this._$mask=a('<div class="nlui-interceptor-overlay ui-widget-overlay"></div>').hide(),this._$mask.css({position:"absolute"}),this.element.after(this._$mask),this.options.hoveringElement&&(a(this.options.hoveringElement).addClass("nlui-interceptor-hoveringElement"),a(this.options.hoveringElement).css({position:"absolute"})),this.options.autoOpen&&this.open(),a(b).on("resize",function(){setTimeout(function(){c.isVisible()&&c.options.layoutManager.rebuildLayout(c.element)},100)})},_positionOverlay:function(){var b=a(this.element).outerHeight(!0),c=a(this.element).outerWidth(!0);this._$mask.css({height:b+"px",width:c+"px"}).position({of:a(this.element),at:"center center",my:"center center"})},_positionHoveringElement:function(){this.options.centerOver&&!this.options.containHovering?a(this.options.hoveringElement).position({of:a(this.options.centerOver),at:"center center",my:"center center"}):a(this.options.hoveringElement).position({of:a(this._$mask),at:"center center",my:"center center"})},_setHoveringElementSize:function(){var a=this._$mask.outerWidth(!0)-this.options.hoveringMargin,b=this._$mask.outerHeight(!0)-this.options.hoveringMargin;this.options.hoveringElement.css({width:a+"px",height:b+"px"})},rebuildLayout:function(){this._$mask.css({height:0,width:0});var a=!1;if(this.options.hoveringElement&&this.options.containHovering&&(a=this.options.hoveringElement.is(":visible"),this.options.hoveringElement.hide()),this._positionOverlay(),this.options.hoveringElement){var b=this;setTimeout(function(){b.options.containHovering&&(b._setHoveringElementSize(),a&&b.options.hoveringElement.show(),b.options.layoutManager.rebuildLayout(b.options.hoveringElement)),b._positionHoveringElement()},0)}},open:function(){var b=this;b._positionOverlay(),b._$mask.show(),b._positionOverlay(),b.options.hoveringElement&&(b._positionHoveringElement(),a(b.options.hoveringElement).show(),b._positionHoveringElement())},destroy:function(){this.options.layoutManager.unRegisterWidget(this),a.Widget.prototype.destroy.call(this)},close:function(){var b=this;b._$mask.hide(),b.options.hoveringElement&&a(b.options.hoveringElement).hide()}})})(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";NL.require("/nl/core/shared/sirocco/structure/jpath.js").require("/nl/core/shared/sirocco/structure/selection.js"),SO.ns("SO.MVC"),SO.MVC.Model=function(a){this._model=a,this._transactionStack=[]},SO.MVC.Model.prototype.getValue=function(a){for(var b=new SO.Structure.Jpath(a),c=this._model,d=0;b.getPartsCount()>d;d++){var e=b.getItem(d);if("collection"===e.type){if(void 0===c[e.key])return void 0;if(c=c[e.key],void 0===c[e.positions[0]])return void 0;c=c[e.positions[0]]}else if("tree"===e.type){if(void 0===c[e.key])return void 0;c=c[e.key];for(var f=0;e.positions.length>f;f++){0!==f&&(c=c._children_);var g=e.positions[f];if(void 0===c[g])return void 0;c=c[g]}}else{if(!c||void 0===c[e.key])return void 0;if(c[e.key]instanceof SO.Selection&&b.getPartsCount()-1>d)if(c[e.key].isMono())c=c[e.key].getItem();else{if(!(e.positions.length>0))throw new Error("Trying to get item from multiple selection with no position.");if(c=c[e.key].getItems(),void 0===c[e.positions[0]])return void 0;c=c[e.positions[0]]}else c=c[e.key]}}return c},SO.MVC.Model.prototype.getRangeValue=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=[],o=null,p=new SO.Structure.Jpath(a);if(i=p.getLastTreeRoot(),m=p.getPartsCount(),p=new SO.Structure.Jpath(a),k=p.getItem(m-1).positions,j=p.getPartsCount(),k&&k.length>=3&&(d=this.getValue(i),void 0!==d&&(e=k[0].toString(),f=k[1].toString(),l=e+"-"+(1===f.length?"0":"")+f,d=d[l],void 0!==d&&(g=k[2],d=d[g],void 0!==d)))){for(c=m;j>c;c++)n.push(p.getItem(c).key);n.length===b.length&&(h=SO.Utils.indexOf(d,{keys:b,values:n},function(a,b){var c,d=0;for(c=0;b.keys.length>c;c++)a[b.keys[c]]===b.values[c]&&d++;return b.keys.length===d}),-1!==h&&(o=d[h]))}return o},SO.MVC.Model.prototype.getRange=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=[],s=[],t=new SO.Structure.Jpath(a);if(SO.assert(c>b),b>=c)return[];if(j=t.getLastTreeRoot(),e=""===j?this.getValue(a):this.getValue(j),k=b.substr(0,7),i=c.substr(0,7),g=parseInt(b.substr(8,2),10),f=parseInt(c.substr(8,2),10),void 0!==e)if(p=function(a,b){var c=a.start,d=b;return(a.start instanceof SO.DateOnly||a.start instanceof SO.DateTime)&&(c=a.start.toString()),(b instanceof SO.DateOnly||b instanceof SO.DateTime)&&(d=b.toString()),c.substr(0,d.length)>=d},q=function(a,b){var c=a.end,d=b;return(a.end instanceof SO.DateOnly||a.end instanceof SO.DateTime)&&(c=a.end.toString()),(b instanceof SO.DateOnly||b instanceof SO.DateTime)&&(d=b.toString()),c.substr(0,d.length)>=d},k===i&&void 0!==e[k])n=SO.Utils.getValueFromObj(e,k,{}),r=r.concat(this._filterArrayByCondition(this._getMonthElement(n,g,f),p,b));else{for(n=SO.Utils.getValueFromObj(e,k,null),n&&(r=r.concat(this._filterArrayByCondition(this._getMonthElement(e[k],g,31),p,b))),m=k;(m=this._addMonthToDate(m))!==i;)o=SO.Utils.getValueFromObj(e,m,null),null!==o&&(r=r.concat(this._filterArrayByCondition(this._getMonthElement(o,1,31),p,b)));l=SO.Utils.getValueFromObj(e,i,null),null!==l&&(r=r.concat(this._filterArrayByCondition(this._getMonthElement(l,1,f),p,b)))}for(h=Object.keys(e),h.sort(function(a,b){return b>a?-1:1}),d=0,m=h[d];k>=m&&h.length>d;)o=e[m],s=m===k?s.concat(this._filterArrayByCondition(this._getMonthElement(o,1,g),q,b)):s.concat(this._filterArrayByCondition(this._getMonthElement(o,1,31),q,b)),d++,m=h[d];return this._filterDoublon(s.concat(r))},SO.MVC.Model.prototype._filterDoublon=function(a){return a.reduce(function(a,b){return 0>a.indexOf(b)&&a.push(b),a},[])},SO.MVC.Model.prototype._getMonthElement=function(a,b,c){var d,e=[];if(a)for(d=b;c>=d;d++)void 0!==a[d]&&(e=e.concat(a[d]));return e},SO.MVC.Model.prototype._addMonthToDate=function(a){var b=a.split("-");return b[1]=parseInt(b[1],10),12===b[1]?(b[0]=(parseInt(b[0],10)+1).toString(),b[1]="01"):b[1]=(b[1]+1).toString(),1===b[1].length&&(b[1]="0"+b[1]),b.join("-")},SO.MVC.Model.prototype._filterArrayByCondition=function(a,b,c){for(var d,e,f=[],d=0;a.length>d;d++)e=a[d],b(e,c)===!0&&f.push(e);return f},SO.MVC.Model.prototype.setValue=function(a,b){var c,d=!1;a=new SO.Structure.Jpath(a);for(var e=this._model,f=null,g=0;a.getPartsCount()>g;g++){f=e;var h=a.getItem(g);if("collection"===h.type){if(void 0===e[h.key]&&(e[h.key]=[],d=!0),e=e[h.key],void 0===e[h.positions[0]]){for(var i=e.length;h.positions[0]>i;i++)e.push[void 0];e[h.positions[0]]={},d=!0}e=e[h.positions[0]]}else if("tree"===h.type){void 0===e[h.key]&&(e[h.key]=[],d=!0),e=e[h.key];for(var j=0;h.positions.length>j;j++){0!==j&&(e=e._children_);var k=h.positions[j];if(void 0===e[k]){for(var i=e.length;k>i;i++)e.push[void 0];e[k]={_children_:[]},d=!0}void 0===e[k]._children_&&(e[k]._children_=[],d=!0),e=e[k]}}else void 0===e[h.key]&&(e[h.key]={},d=!0),e=e[h.key]}if(null===f)throw new Error("[Model] Invalid jpath "+a);var l=a.getItem(a.getPartsCount()-1);return"collection"===l.type?(c=f[l.key][l.positions[0]],f[l.key][l.positions[0]]=b):(c=f[l.key],f[l.key]=b),d?void 0:c},SO.MVC.Model.prototype.fillCollection=function(a,b){var c=this.getValue(a);SO.assert(SO.isArray(c));for(var d=0;b.length>d;d++)c.push(b[d])},SO.MVC.Model.prototype.addCollectionItem=function(a,b,c){var d=this.getValue(a);SO.assert(SO.isArray(d)),null!==c&&void 0!==c?d.splice(c,0,b):d.push(b)},SO.MVC.Model.prototype.addTreeItem=function(a,b){var c,d=this.getValue(a);c=new SO.Structure.Jpath(a),"tree"!==c.getItem(c.getPartsCount()-1).type?d.push(b):d&&d._children_?d._children_.push(b):d._children_=[b]},SO.MVC.Model.prototype.addRangeItems=function(a,b,c){var d,e,f,g,h,i,j=new SO.Structure.Jpath(a);if(g=j.getLastTreeRoot(),e=""===g?this.getValue(a):this.getValue(g),SO.assert(SO.isArray(b)),""===g)for(d=0;b.length>d;d++)f=b[d],f.start&&f.end&&(i=this._existsRangeItem(a,f,c),i||(e=this._addRangeItem(f,e)),f._children_&&f._children_.length>0&&this.addRangeItems(a,f._children_,c));else h=this.getRangeValue(a,c),h&&(h._children_=h._children_?h._children_.concat(b):b)},SO.MVC.Model.prototype._existsRangeItem=function(a,b,c){var d;if(!a||SO.isNundef(b))return!1;if(!(b.start||b instanceof SO.DateOnly||b.start instanceof SO.DateTime))return!1;if(d=a,d+="["+b.start.getYear()+","+b.start.getMonth()+","+b.start.getDay()+"]",!SO.isNundef(c)&&SO.isArray(c))for(var e=0;c.length>e;e++)d+="/"+b[c[e]];return!SO.isNundef(this.getRangeValue(d,c))},SO.MVC.Model.prototype._addRangeItem=function(a,b){var c,d,e,f,g=!1;return a||a.start||a.start instanceof SO.DateOnly||a.start instanceof SO.DateTime?(e=a.start.getYear()+"-"+(10>a.start.getMonth()?"0":"")+a.start.getMonth(),c=a.start.getDay(),b.hasOwnProperty(e)||(b[e]={}),b[e].hasOwnProperty(c)||(b[e][c]=[],g=!0),g?b[e][c].push(a):(f=b[e][c],d=SO.Utils.indexOf(f,a,function(a,b){return a.end>b.end}),-1===d?b[e][c].push(a):b[e][c].splice(d,0,a)),b):null},SO.MVC.Model.prototype.removeCollectionItem=function(a,b){var c=this.getValue(a);SO.isArray(c)?(SO.assert(c.length>b),c.splice(b,1)):delete c[b]},SO.MVC.Model.prototype.removeTreeItem=function(a){var b,c,d,e;d=new SO.Structure.Jpath(a),b=d.getLastFragmentPosition(),SO.assert(0!==b.length,"Cannot remove without position"),1===b.length?(c=this.getValue(d.getLastFragment()),SO.assert(SO.isArray(c)),SO.assert(b[0]<c.length),c.splice(b[0],1)):(e=b.slice(0,-1),c=this.getValue(d.getLastFragment()+"["+e.join(",")+"]"),SO.assert(SO.isArray(c._children_)),SO.assert(b[b.length-1]<c._children_.length),c._children_.splice(b[b.length-1],1))},SO.MVC.Model.prototype.moveCollectionItem=function(a,b,c){var d=this.getValue(a);SO.assert(SO.isArray(d)),SO.assert(d.length>b),SO.assert(d.length>c),d.splice(c,0,d.splice(b,1)[0])},SO.MVC.Model.prototype.setCollection=function(a,b){this.setValue(a,b)},SO.MVC.Model.prototype.getCollection=function(a){return this.getValue(a)},SO.MVC.Model.prototype.fillTree=function(a,b){var c=this.getValue(a),d=-1===a.indexOf("[")?!0:!1;d||c._children_||(c._children_=[]);for(var e=0;b.length>e;e++)d?c.push(b[e]):c._children_.push(b[e])},SO.MVC.Model.prototype.getChildren=function(a){var b,c=-1===a.indexOf("[")?!0:!1;return b=this.getValue(a),c||(b=b._children_?b._children_:[]),b},SO.MVC.Model.prototype.getRangeChildren=function(a,b){var c=this.getRangeValue(a,b);return c=c&&c._children_?c._children_:[]},SO.MVC.Model.prototype.hasChildren=function(a){var b,c=!1,d=-1===a.indexOf("[")?!0:!1;return b=this.getValue(a),(d&&b.data&&b.data.length>0||b._children_&&b._children_.length>0)&&(c=!0),c},SO.MVC.Model.prototype.hasRangeChildren=function(a,b){var c,d=!1;return c=this.getRangeValue(a,b),c&&c._children_&&c._children_.length>0&&(d=!0),d},SO.MVC.Model.prototype.hasGrandChildren=function(a){var b,c,d,e=!1,f=this.getValue(a),g=-1===a.indexOf("[")?!0:!1;if(g&&f.data&&f.data.length>0||f._children_&&f._children_.length>0)for(c=g?f.data:f._children_,b=0;e===!1&&c.length>b;)d=c[b],d._children_&&d._children_.length>0&&(e=!0),b++;return e},SO.MVC.Model.prototype.startTransaction=function(a){var b=SO.Utils.extend(!0,{},this._model);this._transactionStack.push({oldModel:b,name:a})},SO.MVC.Model.prototype._popTransaction=function(a){if(0===this._transactionStack.length)throw"Cannot act on a transaction since the model is not in transaction";var b=this._transactionStack[this._transactionStack.length-1];if(void 0!==a&&b.name!==a)throw"Cannot act on a transaction since the transaction name is not valid";return this._transactionStack.splice(this._transactionStack.length-1),b},SO.MVC.Model.prototype.rollback=function(a){var b=this._popTransaction(a);this._model=b.oldModel},SO.MVC.Model.prototype.commit=function(a){this._popTransaction(a)},SO.MVC.Model.prototype.commitAll=function(){this._transactionStack=[]},SO.MVC.Model.parseJSON=function(a,b){var c=function(a,d){if("itempicker"===b[d]||"link"===b[d])return a?new SO.Selection({selectionMode:SO.isArray(a)?"multi":"mono",items:SO.isArray(a)?a:[a]}):null;if(SO.isObject(a)){var e={};return SO.Utils.each(a,function(a,b){var f=""===d?a:d+"/"+a;e[a]=c(b,f)}),e}if(SO.isArray(a)){for(var e=[],f=0;a.length>f;f++)e.push(c(a[f],d));return e}var g=b[d];switch("string"!=typeof a||"dateonly"!==g&&"datetime"!==g||(g=a.match(SO.DateOnly.REG_EXP)?"dateonly":"datetime"),g){case"dateonly":return SO.DateOnly.parse(a);case"datetime":return SO.DateTime.parse(a);case"time":return SO.Time.parse(a);case"timespan":return SO.TimeSpan.parse(a);default:return a}},d=c(a,"");return d},SO.MVC.Model.serializeJSON=function(a,b){var c=function(a,d){if(null===a)return null;var e=b[d];if("string"!=typeof a||"dateonly"!==e&&"datetime"!==e||(e=a.match(SO.DateOnly.REG_EXP)?"dateonly":"datetime"),"dateonly"===e)return SO.DateOnly.toString(a);if("datetime"===e)return SO.DateTime.toString(a);if("time"===e)return SO.Time.toString(a);if("timespan"===e)return a.toString();if("itempicker"===e)return a.getItems().length>1?a.getItems():a.getItem();if(SO.isObject(a)){var f={};return SO.Utils.each(a,function(a,b){var e=""===d?a:d+"/"+a;f[a]=c(b,e)}),f}if(SO.isArray(a)){for(var f=[],g=0;a.length>g;g++)f.push(c(a[g],d));return f}return a},d=c(a,"");return d};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.MVC"),SO.MVC.Metamodel=function(a){this._metamodel=a,this._checkIntegrity()},SO.MVC.Metamodel.prototype._findItem=function(a,b){a=new SO.Structure.Jpath(a);for(var c=this._metamodel,d=0;a.getPartsCount()>d;d++){var e=a.getItem(d).key,f=null;if(0!==d)if("list"===c.type||"link"===c.type||"grid"===c.type||"container"===c.type||"tree"===c.type||"chart"===c.type){if(void 0===c.elements){if(!b||d!==a.getPartsCount()-1)return null;c.elements={}}f=c.elements}else{if("range"===c.type)return c;if("itempicker"===c.type)SO.assert(c.params.source,"Missing source for item picker "+a),c=this._findItem(c.params.source,b),SO.assert("list"===c.type,"Item picker source should be a list at "+a),f=c.elements;else{if(void 0!==c.type)return null;f=c}}else f=c;if(void 0===f[e]){if(!b||d!==a.getPartsCount()-1)return null;f[e]={}}c=f[e]}return c},SO.MVC.Metamodel.prototype._getItem=function(a,b){var c=this._findItem(a,b);if(null===c)throw new Error("[Metamodel] Invalid jpath: "+a);return c},SO.MVC.Metamodel.prototype.getType=function(a){return this._getItem(a,!1).type},SO.MVC.Metamodel.prototype.getLabel=function(a){return this._getItem(a,!1).label},SO.MVC.Metamodel.prototype.getHelp=function(a){return this._getItem(a,!1).help},SO.MVC.Metamodel.prototype.getLabelsPosition=function(a){return this._getItem(a,!1).labelsPosition},SO.MVC.Metamodel.prototype.getLabelsWidth=function(a){return this._getItem(a,!1).labelsWidth},SO.MVC.Metamodel.prototype.getDataPolicy=function(a){return this._getItem(a,!1).dataPolicy},SO.MVC.Metamodel.prototype.getDisplayFormat=function(a){return this._getItem(a,!1).displayFormat},SO.MVC.Metamodel.prototype.setType=function(a,b){this._getItem(a,!0).type=b},SO.MVC.Metamodel.prototype.setLabel=function(a,b){this._getItem(a,!0).label=b},SO.MVC.Metamodel.prototype.setHelp=function(a,b){this._getItem(a,!0).help=b},SO.MVC.Metamodel.prototype.setLabelsPosition=function(a,b){this._getItem(a,!0).labelsPosition=b},SO.MVC.Metamodel.prototype.setLabelsWidth=function(a,b){this._getItem(a,!0).labelsWidth=b},SO.MVC.Metamodel.prototype.setCurrentFilters=function(a,b){this._getItem(a,!0).currentFilters=b},SO.MVC.Metamodel.prototype.setCurrentSorts=function(a,b){this._getItem(a,!0).currentSorts=b},SO.MVC.Metamodel.prototype.setElements=function(a,b){this._getItem(a,!0).elements=b},SO.MVC.Metamodel.prototype.setItem=function(a,b,c){var d=this._findItem(b);if(null===d)throw new Error("Invalid path: "+b);-1!==["container","list","grid","tree"].indexOf(d.type)?d.elements[a]=c:d[a]=c},SO.MVC.Metamodel.prototype.setSubtree=function(a,b){var c,d=new SO.Structure.Jpath(a),e=d.getPartsCount(),f="";for(c=0;e>1&&e-1>c;c++){var g=d.getItem(c).key,h=f?f+"/"+g:g;this.exists(h)||this.setItem(g,f,{type:"container",elements:[]}),f=h}this.setItem(d.getLastFragment(),f,b)},SO.MVC.Metamodel.prototype.importSubtree=function(a,b,c){var d=this;this.exists(a)?b.elements&&SO.Utils.each(b.elements,function(b,e){var f=a+"/"+b;d.exists(f)?c&&d.importSubtree(f,e):d.setSubtree(f,e)}):this.setSubtree(a,b)},SO.MVC.Metamodel.prototype.getKeys=function(a){var b=this._getItem(a,!1);if("itempicker"!==b.type&&"list"!==b.type&&"grid"!==b.type&&"tree"!==b.type&&"pathedit"!==b.type&&"link"!==b.type&&"range"!==b.type)throw"Unable to get keys for path "+a+" which is not a list nor a tree nor a link";return b.keys},SO.MVC.Metamodel.prototype.setKeys=function(a,b){for(var c=0;b.length>c;c++){var d=a+"/"+b[c];if(null===this._findItem(d,!1))throw"Invalid value for a key (jpath: "+a+", key: "+b[c]}var e=this._getItem(a,!0);e.keys=b},SO.MVC.Metamodel.prototype.getParams=function(a){return this._getItem(a,!1).params},SO.MVC.Metamodel.prototype.getDisplayParams=function(a){return this._getItem(a,!1).displayParams},SO.MVC.Metamodel.prototype.getParam=function(a,b){var c=this._getItem(a,!1);return c.params?c.params[b]:void 0},SO.MVC.Metamodel.prototype.setParam=function(a,b,c){var d=this._getItem(a,!1);d.params||(d.params={}),d.params[b]=c},SO.MVC.Metamodel.prototype.setParamSubtree=function(a,b,c){var d,e=this._getItem(a,!0);e.params||(e.params={}),d=e.params;var f=new SO.Structure.Jpath(b),g=f.getPartsCount();if(g>0){for(var h=0;g>h;h++){var i=f.getItem(h);h!==g-1&&(d[i.key]||(d[i.key]={}),d=d[i.key])}d[i.key]=c}else e.params=c},SO.MVC.Metamodel.prototype.getDataSource=function(a){var b=this._getItem(a,!0);SO.assert(-1!==["list","tree","link","grid","chart","container","range","int64"].indexOf(b.type),"Unable to get a datasource for path "+a+" which is not a list, link, grid, tree, chart, int64, range or container");var c=b.dataSourceConf;if(!SO.isNundef(c)&&SO.isNundef(b.dataSource)){var d=new NL.DataSource[c.dataSourceType](c);b.dataSource=d,b.dataSourceConf=void 0}return b.dataSource},SO.MVC.Metamodel.prototype.getCurrentFilters=function(a){var b=this._getItem(a,!0);return b.currentFilters||{lastFilter:null,filters:[]}},SO.MVC.Metamodel.prototype.getCurrentSorts=function(a){var b=this._getItem(a,!0);return b.currentSorts||{lastSort:null,sorts:[]}},SO.MVC.Metamodel.prototype.getEnumValues=function(a){var b=this._getItem(a,!0);return SO.assert("enum"===b.type,a+" is not an enumeration"),b.params.items},SO.MVC.Metamodel.prototype.getAddMethod=function(a){var b=this._getItem(a,!0);return SO.assert("list"===b.type||"grid"===b.type||"tree"===b.type,"Unable to get an 'add method' for path "+a+" which is not a list or a tree"),b.addMethod||null},SO.MVC.Metamodel.prototype.getRemoveMethod=function(a){var b=this._getItem(a,!0);return SO.assert("list"===b.type||"grid"===b.type||"tree"===b.type,"Unable to get a 'remove method' for path "+a+" which is not a list or a tree"),b.removeMethod||null},SO.MVC.Metamodel.prototype.getDuplicateMethod=function(a){var b=this._getItem(a,!0);return SO.assert("list"===b.type||"grid"===b.type||"tree"===b.type,"Unable to get a 'duplicate method' for path "+a+" which is not a list or a tree"),b.duplicateMethod||null},SO.MVC.Metamodel.prototype.getAllJPaths=function(a){a=a||"/";var b=[],c=this._getItem(a),d=this,e=new SO.Structure.Jpath(a),f=c===this._metamodel;return f||b.push(e.getFullJpath()),("container"===c.type||f)&&(f||(c=c.elements),SO.Utils.each(c,function(a,c){var f=e.getJpath(a);"container"===c.type?b=b.concat(d.getAllJPaths(f.getFullJpath())):b.push(f.getFullJpath())})),b},SO.MVC.Metamodel.prototype.getAllTypes=function(a){var b=this,c=function(a,d,e){var f=a===b._metamodel;if(f||(e[d]=a.type),-1!==["container","list","grid","tree","range"].indexOf(a.type)||f){var g=f?a:a.elements;SO.Utils.each(g,function(a,b){var f=""===d?a:d+"/"+a;c(b,f,e)})}},d=this._getItem(a),e={};return c(d,"",e),e},SO.MVC.Metamodel.prototype.getElements=function(a){var b=this._getItem(a);return b.elements},SO.MVC.Metamodel.prototype.exists=function(a){try{this._getItem(a)}catch(b){return!1}return!0},SO.MVC.Metamodel.prototype._checkIntegrity=function(a){a=a||"/";var b=this._getItem(a),c=b===this._metamodel,d=new SO.Structure.Jpath(a),e=this;"container"!==b.type||c||(b=b.elements||{}),SO.Utils.each(b,function(a,b){var c=d.getJpath(a);switch(SO.assert(b.type,"Metamodel integrity: "+c.getFullJpath()+" should have a type"),SO.assert(SO.isObject(b),"Metamodel integrity: "+c.getFullJpath()+" should be an object"),b.type){case"container":SO.assert(b.elements,"Metamodel integrity: "+c.getFullJpath()+" should have elements"),e._checkIntegrity(c.getFullJpath());break;case"list":case"grid":case"tree":SO.assert(b.keys,"Metamodel integrity: "+c.getFullJpath()+" should have keys"),SO.assert(b.elements,"Metamodel integrity: "+c.getFullJpath()+" should have elements");break;default:}})};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.MVC"),SO.MVC.Statemodel=function(a){this._statemodel=a,this._transactionStack=[]},SO.MVC.Statemodel.prototype._findItem=function(a,b){a=new SO.Structure.Jpath(a);for(var c=function(a,c){for(var d=0;c.length>d;d++){if(void 0===a[c[d]]){if(!b)return null;a[c[d]]={}}a=a[c[d]]}return a},d=this._statemodel,e=0;a.getPartsCount()>e&&null!==d;e++){var f=a.getItem(e).key,g=a.getItem(e).type;switch(g){case"collection":var h=[f,"data",a.getItem(e).positions[0]];a.getPartsCount()-1>e&&h.push("elements"),d=c(d,h);break;case"tree":for(var i=[f],j=a.getItem(e).positions,k=0;j.length>k;k++)i.push("data"),i.push(j[k]);a.getPartsCount()-1>e&&i.push("elements"),d=c(d,i);break;case"container":var h=[f];a.getPartsCount()-1>e&&h.push("elements"),d=c(d,h)}}return d},SO.MVC.Statemodel.prototype._getItem=function(a,b){var c=this._findItem(a,b);if(null===c)throw"Invalid jpath: "+a;return c},SO.MVC.Statemodel.prototype.exists=function(a){try{this._getItem(a)}catch(b){return!1}return!0},SO.MVC.Statemodel.prototype.getFirstError=function(){return SO.MVC.Statemodel.prototype._getFirstError(this._statemodel)},SO.MVC.Statemodel.prototype._getFirstError=function(a){var b=null,c=this;return SO.Utils.each(a,function(d){return a[d].error&&(b=a[d].error),a[d].elements&&!b&&(b=c._getFirstError(a[d].elements)),a[d].data&&!b&&(b=c._getFirstError(a[d].data)),b?!1:void 0}),b},SO.MVC.Statemodel.prototype._getState=function(a,b){var c=this._findItem(a);if(c&&void 0!==c[b])return c[b];for(var a=new SO.Structure.Jpath(a),d=a.getPartsCount()-1;d>=0;d--){var e=a.getItem(d);if("collection"===e.type||"tree"===e.type){e.type="container",e.positions=void 0,e.position=void 0;var c=this._findItem(a.getFullJpath());if(c&&void 0!==c[b])return c[b]}}return void 0},SO.MVC.Statemodel.prototype.setItem=function(a,b,c){var d=this._findItem(b);if(null===d)throw new Error("Invalid path: "+b);d===this._statemodel?d[a]=c:(d.elements||(d.elements={}),d.elements[a]=c)},SO.MVC.Statemodel.prototype.setSubtree=function(a,b){var c,d=new SO.Structure.Jpath(a),e=d.getPartsCount(),f="";for(c=0;e>1&&e-1>c;c++){var g=d.getItem(c),h=g.key,i=g.type,j=g.positions,k=f?f+"/"+h:h;switch(i){case"collection":k+="["+j[0]+"]";break;case"tree":for(var l,l=0;j.length>l;l++)k+="["+j[l]+"]";break;case"container":}this.exists(k)||this.setItem(h,f,{}),f=k}this.setItem(d.getLastFragment(),f,b)},SO.MVC.Statemodel.prototype.getError=function(a){return this._getState(a,"error")||null},SO.MVC.Statemodel.prototype.isHidden=function(a){return this._getState(a,"hidden")||!1},SO.MVC.Statemodel.prototype.isDisabled=function(a){return this._getState(a,"disabled")||!1},SO.MVC.Statemodel.prototype.isMandatory=function(a){return this._getState(a,"mandatory")||!1},SO.MVC.Statemodel.prototype.isStrict=function(a){return this._getState(a,"strict")||!1},SO.MVC.Statemodel.prototype.setError=function(a,b){var c=this._getItem(a,!0),d=c.error||null;return c.error=b,d},SO.MVC.Statemodel.prototype.setHidden=function(a,b){this._getItem(a,!0).hidden=b},SO.MVC.Statemodel.prototype.setDisabled=function(a,b){this._getItem(a,!0).disabled=b},SO.MVC.Statemodel.prototype.setMandatory=function(a,b){this._getItem(a,!0).mandatory=b},SO.MVC.Statemodel.prototype.setStrict=function(a,b){var c=this._getItem(a,!0),d=c.strict||!1;return c.strict=b,d},SO.MVC.Statemodel.prototype.startTransaction=function(a){var b=SO.Utils.extend(!0,{},this._statemodel);this._transactionStack.push({oldModel:b,name:a})},SO.MVC.Statemodel.prototype._popTransaction=function(a){if(0===this._transactionStack.length)throw"Cannot act on a transaction since the model is not in transaction";var b=this._transactionStack[this._transactionStack.length-1];if(void 0!==a&&b.name!==a)throw"Cannot act on a transaction since the transaction name is not valid";return this._transactionStack.splice(this._transactionStack.length-1),b},SO.MVC.Statemodel.prototype.rollback=function(a){var b=this._popTransaction(a);this._statemodel=b.oldModel},SO.MVC.Statemodel.prototype.commit=function(a){this._popTransaction(a)},SO.MVC.Statemodel.prototype.commitAll=function(){this._transactionStack=[]};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.MVC"),SO.MVC.Displaymodel=function(a){this._displaymodel=a},SO.MVC.Displaymodel.prototype._getDisplay=function(a,b){a=new SO.Structure.Jpath(a);for(var c=this._displaymodel,d=0;a.getPartsCount()>d;d++){var e=a.getItem(d).key;if(void 0===c[e])return!1;var f=c[e];if(f[b]===!0)return!0;c=c[e].children}return!1},SO.MVC.Displaymodel.prototype._setDisplay=function(a,b,c){a=new SO.Structure.Jpath(a);for(var d,e=this._displaymodel,f=0;a.getPartsCount()>f;f++){var g=a.getItem(f).key;void 0===e[g]&&(e[g]={children:{}});var d=e[g];void 0===d.children&&(d.children={}),e=e[g].children}var h=d[b];return d[b]=c,h},SO.MVC.Displaymodel.prototype.setHidden=function(a,b){return this._setDisplay(a,"hidden",b)},SO.MVC.Displaymodel.prototype.setDisabled=function(a,b){return this._setDisplay(a,"disabled",b)},SO.MVC.Displaymodel.prototype.setReadOnly=function(a,b){return this._setDisplay(a,"readOnly",b)},SO.MVC.Displaymodel.prototype.isHidden=function(a){return this._getDisplay(a,"hidden")},SO.MVC.Displaymodel.prototype.isDisabled=function(a){return this._getDisplay(a,"disabled")},SO.MVC.Displaymodel.prototype.isReadOnly=function(a){return this._getDisplay(a,"readOnly")};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.Structure.Jpath"),SO.Structure.Jpath=function(a){SO.assert(!SO.isNundef(a),"Invalid Jpath"),this._jpath=this._parseJpath(a)},SO.Structure.Jpath.prototype._parseJpath=function(a){var b,c=[],d=a.split("/");this._beginWithSlash=SO.String.startsWith(a,"/");for(var e=0;d.length>e;e++){var f=d[e];if(""!==f){var g="]"===f.charAt(f.length-1);if(g){var h=f.indexOf("["),i=f.substring(h+1,f.length-1);f=f.substring(0,h);var j=i.split(","),k=[];b=1===j.length?"collection":"tree";for(var l=0;j.length>l;l++)k.push(parseInt(j[l],10));c.push({type:b,key:f,positions:k})}else if(".."===f){if(0===e)throw"Can't use .. at first position";c.pop()}else c.push({type:"container",key:f})}}return c},SO.Structure.Jpath.prototype.getRoot=function(){return this._jpath.length>0?this._jpath[0].key:""},SO.Structure.Jpath.prototype.getLastFragment=function(){return this._jpath.length>0?this._jpath[this._jpath.length-1].key:""},SO.Structure.Jpath.prototype.getLastFragmentPosition=function(){var a=[];return this._jpath.length>0&&(a=this._jpath[this._jpath.length-1].positions||[]),a},SO.Structure.Jpath.prototype.getFullJpath=function(){for(var a=this._beginWithSlash?[""]:[],b=0;this._jpath.length>b;b++){var c=this._jpath[b];void 0!==c.positions?a.push(c.key+"["+c.positions.join(",")+"]"):a.push(c.key)}return a.join("/")},SO.Structure.Jpath.prototype.getPrefix=function(){for(var a=[],b=0;this._jpath.slice(0,-1).length>b;b++){var c=this._jpath[b];void 0!==c.positions?a.push(c.key+"["+c.positions.join(",")+"]"):a.push(c.key)}return a.join("/")},SO.Structure.Jpath.prototype.navigate=function(a){for(var b=a.split("/"),c=0;b.length>c;c++)switch(b[c]){case".":break;case"..":this._jpath=this._jpath.slice(0,-1);break;default:this._jpath=""===this.getFullJpath()?this._parseJpath(b[c]):this._jpath.concat(this._parseJpath(b[c]))}return this},SO.Structure.Jpath.prototype.getJpath=function(a){var b=new SO.Structure.Jpath(this.getFullJpath());return b.navigate(a),b},SO.Structure.Jpath.prototype.getPartsCount=function(){return this._jpath.length},SO.Structure.Jpath.prototype.getItem=function(a){return this._jpath[a]||null},SO.Structure.Jpath.prototype.getOffset=function(a){for(var b=[],c=0;this.getPartsCount()>c;c++)a===this.getItem(c).key&&b.push(c);return b.length>0?b:-1},SO.Structure.Jpath.prototype.contains=function(a){a=new SO.Structure.Jpath(a);for(var b=this.getOffset(a.getItem(0).key),c=-1!==b,d=0;b.length>=d;d++){for(var e=b[d],f=1;a.getPartsCount()>f;f++){e++;var g=this.getItem(e);if(null===g){c=!1;break}if(c=g.key===a.getItem(f).key,!c)break}if(c)return!0}return!1},SO.Structure.Jpath.prototype.startWith=function(a){var b=!0;a=new SO.Structure.Jpath(a);for(var c=0;a.getPartsCount()>c&&b;c++){var d=this.getItem(c);b=null===d?!1:d.key===a.getItem(c).key}return b},SO.Structure.Jpath.prototype.match=function(a){a=a.replace("/","/"),a=a.replace("*",".+");var b=new RegExp("^"+a+"$");return b.test(this.getFullJpath())},SO.Structure.Jpath.prototype.matchObjectStructure=function(a){for(var b=!0,c=0;this.getPartsCount()>c&&b;c++){var d=this.getItem(c);b=SO.OO.objectHasProperties(a,{mandatory:[d.key]}),a=a[d.key]}return b},SO.Structure.Jpath.prototype.splice=function(a,b){this._jpath.splice(a,b)},SO.Structure.Jpath.prototype.findCollection=function(){for(var a=null,b=this.getPartsCount()-1;b>=0&&!a;b--){var c=this.getItem(b);("collection"===c.type||"tree"===c.type)&&(a=c)}return a},SO.Structure.Jpath.prototype.buildObject=function(){for(var a={},b=a,c=0;this.getPartsCount()>c;c++){var d=this.getItem(c);b[d.key]={},b[d.key].type=d.type,b[d.key].elements={};var e=b[d.key];if(b=b[d.key].elements,d.columns)for(var f=0;d.columns.length>f;f++)b[d.columns[f]]={},b[d.columns[f]].type="container",b[d.columns[f]].elements={};if(d.positions){b=e;for(var g=0;d.positions.length>g;g++)b.data={},b.data[d.positions[g]]={},b.data[d.positions[g]].type="container",b.data[d.positions[g]].elements={},b=d.positions.length>1?b.data[d.positions[g]]:b.data[d.positions[g]].elements}}return a},SO.Structure.Jpath.prototype.getLastTreeRoot=function(){for(var a=null,b=this.getPartsCount()-1;b>=0&&!a;b--){var c=this.getItem(b);"tree"===c.type&&(a=c)}return null===a?"":(this.splice(b+1,this.getPartsCount()-b+1),this.navigate(a.key),this.toString())},SO.Structure.Jpath.prototype.toString=function(){return this.getFullJpath()};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";NL.require("/nl/core/shared/sirocco/core/so.js").require("/nl/core/shared/sirocco/utils.js").require("/nl/core/shared/sirocco/core/oo.js").require("/nl/core/shared/sirocco/type/_date.js").require("/nl/core/shared/sirocco/type/partialDate.js").require("/nl/core/shared/sirocco/type/_number.js"),SO.ns("NL.Locale"),NL.Locale=function(){throw new Error("NL.Locale can not be instantiated")};var _regionSettings={de:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%2D.%2M.%4Y",longDate:"%A, %D. %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D.%2M.%4Y %2H:%2N:%2S",AmPm:["AM","PM"],shortQuarter:"Q%C %4Y",longQuarter:"%Q %4Y",shortMonth:"%2M.%4Y",longMonth:"%B %4Y",shortWeek:"KW %2W/%4V",shortHour:"%2H Uhr",longHour:"%2H Uhr",longWeek:"Kalenderwoche %2W/%4V",daysName:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDaysName:["So","Mo","Di","Mi","Do","Fr","Sa"],monthsName:["Januar","Februar","M\u00e4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],quartersName:["1. Quartal","2. Quartal","3. Quartal","4. Quartal"],timeSpanUnits:{seconds:"s",minutes:"min",hours:"h",days:"T",months:"M",years:"J"},percentSeparator:"\u2009",currencySymbol:"\u20ac",booleanStrings:{"true":"wahr","false":"falsch"},units:{date:{year:"Jahr(en)",month:"Monat(en)",week:"Woche(n)",day:"Tag(en)",hour:"Stunde(n)",minute:"Minute(n)",second:"Sekunde(n)",ago:"Vor","in":"In",tomorrow:"Morgen",yesterday:"Gestern"},dataSize:[{symbol:"B",factor:1},{symbol:"kB",factor:1024},{symbol:"MB",factor:1048576},{symbol:"GB",factor:1073741824}],count:[{symbol:"",factor:1},{symbol:"Tsd.",factor:1e3},{symbol:"Mio.",factor:1e6},{symbol:"Mrd.",factor:1e9}]},colonSuffix:":"},"en-us":{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2M/%2D/%4Y",longDate:"%A, %D %B, %4Y",time:"%I:%2N:%2S %P",shortDateTime:"%2M/%2D/%4Y %I:%2N:%2S %P",AmPm:["AM","PM"],shortQuarter:"Q%C %4Y",longQuarter:"%Q %4Y",shortMonth:"%2M/%4Y",longMonth:"%B %4Y",shortWeek:"%4V-W%2W",longWeek:"%4V - Week %2W",shortHour:"%2Hh",longHour:"%2Hh",daysName:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDaysName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthsName:["January","February","March","April","May","June","July","August","September","October","November","December"],quartersName:["1st quarter","2nd quarter","3rd quarter","4th quarter"],timeSpanUnits:{seconds:"s",minutes:"mn",hours:"h",days:"d",months:"m",years:"y"},percentSeparator:"",currencySymbol:"$",booleanStrings:{"true":"true","false":"false"},units:{date:{year:"year(s)",month:"month(s)",week:"week(s)",day:"day(s)",hour:"hour(s)",minute:"minute(s)",second:"second(s)",ago:"ago","in":"In",tomorrow:"Tomorrow",yesterday:"Yesterday"},dataSize:[{symbol:"B",factor:1},{symbol:"kB",factor:1024},{symbol:"MB",factor:1048576},{symbol:"GB",factor:1073741824}],count:[{symbol:"",factor:1},{symbol:"k",factor:1e3},{symbol:"M",factor:1e6},{symbol:"G",factor:1e9}]},colonSuffix:":"},"en-gb":{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2D/%2M/%4Y",longDate:"%A %D %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"],currencySymbol:"\u00a3"},ar:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D. %B %4Y",time:"%2I:%2N:%2S %P",shortDateTime:"%2D/%2M/%4Y %2I:%2N:%2S %P",AmPm:["\u0635","\u0645"]},zh:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%4Y-%M-%D",longDate:"%A, %D. %B %4Y",time:"%P%I:%2N:%2S",shortDateTime:"%4Y-%M-%D %P%I:%2N:%2S",AmPm:["\u4e0a\u5348","\u4e0b\u5348"]},ko:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2D.%2M.%4Y",longDate:"%A, %D. %B %4Y",time:"%P %2I:%2N:%2S",shortDateTime:"%4Y. %M. %D %P %2I:%2N:%2S",AmPm:["\uc624\uc804","\uc624\ud6c4"]},da:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D-%2M-%4Y",longDate:"%D. %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D-%2M-%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},es:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D de %B de %4Y",time:"%H:%2N:%2S",shortDateTime:"%2M-%2D-%4Y %H:%2N:%2S",AmPm:["AM","PM"]},et:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%D.%2M.%4Y",longDate:"%D %B %4Y. a.",time:"%H:%2N:%2S",shortDateTime:"%D.%2M.%4Y %H:%2N:%2S",AmPm:["AM","PM"]},fi:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%D.%M.%4Y",longDate:"%D. %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%D.%M.%4Y %H:%2N:%2S",AmPm:["AM","PM"]},"fr-fr":{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A %D %B %4Y",partialDate:"%B, %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"],daysName:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDaysName:["dim","lun","mar","mer","jeu","ven","sam"],shortWeek:"%4V-S%2W",longWeek:"%4V - Semaine %2W",monthsName:["janvier","f\u00e9vrier","mars","avril","mai","juin","juillet","ao\u00fbt","septembre","octobre","novembre","d\u00e9cembre"],quartersName:["1er trimestre","2e trimestre","3e trimestre","4e trimestre"],percentSeparator:" ",currencySymbol:"\u20ac",timeSpanUnits:{seconds:"s",minutes:"mn",hours:"h",days:"j",months:"m",years:"a"},booleanStrings:{"true":"vrai","false":"faux"},units:{date:{year:"an(s)",month:"mois",week:"semaine(s)",day:"jour(s)",hour:"heure(s)",minute:"minute(s)",second:"seconde(s)",ago:"Il y a","in":"Dans",tomorrow:"Demain",yesterday:"Hier"},dataSize:[{symbol:"o",factor:1},{symbol:"ko",factor:1024},{symbol:"Mo",factor:1048576},{symbol:"Go",factor:1073741824}],count:[{symbol:"",factor:1},{symbol:"k",factor:1e3},{symbol:"M",factor:1e6},{symbol:"G",factor:1e9}]},colonSuffix:"\u00a0:"},"fr-be":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%D/%2M/%4Y",longDate:"%A %D %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%D/%2M/%4Y %H:%2N:%2S",AmPm:["AM","PM"],daysName:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDaysName:["dim","lun","mar","mer","jeu","ven","sam"],monthsName:["janvier","f\u00e9vrier","mars","avril","mai","juin","juillet","ao\u00fbt","septembre","octobre","novembre","d\u00e9cembre"],quartersName:["1er trimestre","2e trimestre","3e trimestre","4e trimestre"],percentSeparator:" "},el:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%D/%M/%4Y",longDate:"%A, %D %B %4Y",time:"%I:%2N:%2S %P",shortDateTime:"%D/%M/%4Y %I:%2N:%2S %P",AmPm:["\u03c0\u03bc","\u03bc\u03bc"]},he:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D. %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},hu:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%4Y.%2M.%2D.",longDate:"%4Y. %B %D.",time:"%H:%2N:%2S",shortDateTime:"%4Y.%2M.%2D. %H:%2N:%2S",AmPm:["DE","DU"]},id:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%D %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},ga:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%4Y/%2M/%2D",longDate:"%A, %D. %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%4Y/%2M/%2D %2H:%2N:%2S",AmPm:["a.m.","p.m."]},"it-it":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A %D %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},"it-ch":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D. %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%2D/%2M/%4Y %H:%2N:%2S",AmPm:["AM","PM"]},ja:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%4Y/%2M/%2D",longDate:"%A, %D. %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%4Y/%2M/%2D. %H:%2N:%2S",AmPm:["\u5348\u524d","\u5348\u5f8c"]},lv:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%4Y.%2M.%2D.",longDate:"%A, %4Y. gada %D. %B",time:"%2H:%2N:%2S",shortDateTime:"%4Y.%2M.%2D. %2H:%2N:%2S",AmPm:["AM","PM"]},lt:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%4Y.%D.%M.",longDate:"%4Y m. %B %D d.",time:"%2H:%2N:%2S",shortDateTime:"%4Y.%D.%M %2H:%2N:%2S",AmPm:["AM","PM"]},mt:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D ta' %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["QN","WN"]},"nl-nl":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%D-%M-%4Y",longDate:"%A %D %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%D-%M-%4Y %H:%2N:%2S",AmPm:["AM","PM"]},"nl-be":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%D/%2M/%4Y",longDate:"%A %D %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%D/%2M/%4Y %H:%2N:%2S",AmPm:["AM","PM"]},no:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%2D.%2M.%4Y",longDate:"%A %D. %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D.%2M.%4Y %2H:%2N:%2S",AmPm:["AM","PM"],daysName:["sundag","m\u00e5ndag","tysdag","onsdag","torsdag","fredag","laurdag"],monthsName:["januar","februar","mars","april","mai","juni","juli","august","september","oktober","november","desember"],percentSeparator:" "},pl:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%4Y-%2M-%2D",longDate:"%D %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%4Y-%2M-%2D %2H:%2N:%2S",AmPm:["AM","PM"]},"pt-pt":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D-%2M-%4Y",longDate:"%A, %D de %B de %4Y",time:"%H:%2N:%2S",shortDateTime:"%2D-%2M-%4Y %H:%2N:%2S",AmPm:["AM","PM"]},"pt-br":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D de %B de %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},ru:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%2D.%2M.%4Y",longDate:"%D %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%2D.%2M.%4Y %H:%2N:%2S",AmPm:["AM","PM"]},sl:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%D.%M.%4Y",longDate:"%D. %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%D.%M.%4Y %H:%2N:%2S",AmPm:["AM","PM"]},sk:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%D.%M.%4Y",longDate:"%D. %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%D.%M.%4Y %H:%2N:%2S",AmPm:["AM","PM"]},"sv-se":{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%4Y-%2M-%2D",longDate:"%A %D %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%4Y-%2M-%2D %2H:%2N:%2S",AmPm:["AM","PM"]},"sv-fi":{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%D.%M.%4Y",longDate:"%A %D %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%D.%M.%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},cs:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%D.%M.%4Y",longDate:"%D. %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%D.%M.%4Y %H:%2N:%2S",AmPm:["dop.","odp."]},th:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%M/%D/%4Y",longDate:"%A, %D. %B %4Y",time:"%I:%2N:%2S %P",shortDateTime:"%M/%D/%4Y %I:%2N:%2S %P",AmPm:["\u0e01\u0e48\u0e2d\u0e19\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07","\u0e2b\u0e25\u0e31\u0e07\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07"]},vi:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D. %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2H:%2N:%2S %2D/%2M/%4Y",AmPm:["SA","CH"]},wa:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D.%2M.%4Y",longDate:"%A, %D. %B %4Y",time:"%H:%2N:%2S",shortDateTime:"%D/%2M/%4Y %H:%2N:%2S",AmPm:["AM","PM"]}},_currencySettings={$:{before:!0,space:!1},"\u00a3":{before:!0,space:!1},"\u20ac":{before:!1,space:!1}},localeImpl=function(a){this.setLanguage(a)};SO.OO.defineProtocol("Locale",["getSettings","getFormat","setLanguage","getLanguage","getLocale","get","set"]),localeImpl.prototype.getSettings=function(){if(!this.settings)throw new Error("No language defined");return SO.Utils.extend(!0,{},this.settings)},NL.Locale.getFormat=function(a,b){return NL.session.locale.getFormat(a,b)},localeImpl.prototype.getFormat=function(a,b){var c=this.settings[a];if(SO.isEmpty(c))throw new SyntaxError("Invalid format ["+a+"]");return"time"!==a&&"shortDateTime"!==a||!SO.isBoolean(b)||b||(c=c.replace(/.%2S/,"")),c},localeImpl.prototype.setLanguage=function(a){if(!a)return!1;this.locale=a.toLowerCase().replace("_","-"),this.language=this.locale.substr(0,2);var b;this.settings=_regionSettings[this.locale];var c=NL.Locale.defaultLanguage,d=!0;if(this.settings)b=this.locale;else if(this.settings=_regionSettings[this.language],this.settings)b=this.language;else{for(var e in _regionSettings)if(e.substr(0,2)===this.language){this.settings=_regionSettings[e],b=e;break}this.settings||(this.settings=_regionSettings[c],d=!1,b=c)}if(b&&document&&(document.formatLanguage=b),null!==this.settings){for(var f=["daysName","monthsName","quartersName","digitGroupingSymbol","decimalSymbol","shortDate","longDate","time","shortDateTime","AmPm","shortWeek","longWeek","shortMonth","longMonth","shortQuarter","longQuarter","shortHour","longHour","units","booleanStrings","percentSeparator","timeSpanUnits","colonSuffix"],g=0;f.length>g;g++)void 0===this.settings[f[g]]&&(this.settings[f[g]]=_regionSettings[c][f[g]]);this.settings.digitGroupingRegEx="."===this.settings.digitGroupingSymbol?/\./g:new RegExp(this.settings.digitGroupingSymbol,"g")}return d},localeImpl.prototype.getLanguage=function(){return this.language},localeImpl.prototype.getLocale=function(){var a=this.locale.split("-");if(1===a.length){var b="";return b="en"===a[0]?"US":a[0].toUpperCase(),a[0]+"_"+b}return 2===a.length?a[0]+"_"+a[1].toUpperCase():this.locale},localeImpl.prototype.setLanguageFromHttpHeader=function(a,b){var c=NL.Locale.getValidLanguageFromHttpHeader(a,b);return null!==c?(this.setLanguage(c),!0):!1},localeImpl.prototype.get=function(a){var b=this.getSettings();return b[a]?b[a]:""},localeImpl.prototype.set=function(a,b){var c=this.getSettings();c[a]=b},NL.Locale.defaultLanguage="en-us",NL.Locale.getLocale=function(a){return new localeImpl(a||NL.Locale.defaultLanguage)},NL.Locale.getValidLanguageFromHttpHeader=function(a,b){for(var c=[],d=a.split(/[;,=]/),e=[],f=d.length,g=0;f>g;++g){var h=SO.String.trim(d[g]);if("q"===h){if(e.length>0){var i=NL.XTK.parseInt(d[g+1],0)||1;c.push({quality:i,locales:e}),e=[]}++g}else h&&e.push(h)}e.length>0&&c.push({quality:1,locales:e}),c=c.sort(function(a,b){return a.quality<b.quality});for(var g=0;c.length>g;++g)for(var j=c[g].locales,k=0;j.length>k;++k){var l=b(NL.session.locale.getLocale(),j[k]);if(l)return j[k]}return null},NL.Locale.parseBoolean=function(a,b){return NL.session.locale.parseBoolean(a,b)},localeImpl.prototype.parseBoolean=function(a,b){var c=b;if(void 0===b&&(b=!1),a&&a.valueOf&&SO.isString(a)&&(a=a.valueOf()),void 0===a||null===a||""===a)return b;var d=NL.XTK.parseBoolean(a,null,!0);if(null!==d)return d;var e=(""+a).toLowerCase();if(this.settings.booleanStrings){if(e===this.settings.booleanStrings["true"])return!0;if(e===this.settings.booleanStrings["false"])return!1}return NL.XTK.handleError("Cannot parse boolean '$1': not a valid boolean",a,c)},NL.Locale.formatBoolean=function(a,b,c){return NL.session.locale.formatBoolean(a,b,c)},localeImpl.prototype.formatBoolean=function(a,b,c){return SO.isEmpty(a)||!SO.isBoolean(a)?NL.XTK.handleError("Cannot format XTK boolean '$1': not a boolean",a,c):this.settings.booleanStrings[a?"true":"false"]},NL.Locale.parseString=function(a,b){return NL.session.locale.parseString(a,b)},localeImpl.prototype.parseString=function(a,b){if(SO.isEmpty(a)&&""!==a){if(void 0!==b)return b;throw new Error("Cannot parse string",a)}return a+""},NL.Locale.parseNumber=function(a,b){return NL.session.locale.parseNumber(a,b)},localeImpl.prototype.parseNumber=function(a,b){if(SO.isEmpty(a)){if(void 0!==b)return b;throw new Error("Cannot parse number",a)}if(SO.isNumber(a))return a;var c=a+"";if(""===c){if(void 0!==b)return b;throw new Error("Cannot parse number",a)}var d=c.replace(this.settings.digitGroupingRegEx,"");"."!==this.settings.decimalSymbol&&(d=d.replace(this.settings.decimalSymbol,"."));var e=NL.XTK.parseNumber(d,null);if(null===e){if(void 0!==b)return b;throw new Error("Cannot parse number",a)}return e},NL.Locale.parseInt=function(a,b){return NL.session.locale.parseInt(a,b)},localeImpl.prototype.parseInt=function(a,b){if(SO.isEmpty(a)){if(void 0!==b)return b;throw new Error("Cannot parse integer",a)}if(SO.isNumber(a)){if(!isFinite(a))return a;if(Math.floor(a)===a)return Math.floor(a);throw new Error("Cannot parse integer",a)}var c=a+"";if(""===c){if(void 0!==b)return b;throw new Error("Cannot parse integer",a)}var d=c.replace(this.settings.digitGroupingRegEx,"");"."!==this.settings.decimalSymbol&&(d=d.replace(this.settings.decimalSymbol,"."));var e=NL.XTK.parseInt(d,null);if(null===e){if(void 0!==b)return b;throw new Error("Cannot parse integer",a)}return e},NL.Locale.formatNumber=function(a,b,c){return NL.session.locale.formatNumber(a,b,c)},localeImpl.prototype.formatNumber=function(a,b,c){return this._formatNumber(a,b,c,!1)},NL.Locale.formatInt=function(a,b,c){return NL.session.locale.formatInt(a,b,c)},localeImpl.prototype.formatInt=function(a,b,c){return this._formatNumber(a,b,c,!0)},localeImpl.prototype._formatNumber=function(a,b,c,d){if(SO.isEmpty(a))return NL.XTK.handleError("Unable to format number $1",a,c);if(SO.isString(a)&&(a=NL.XTK.parseNumber(a,null)),!SO.isNumber(a)||!SO.Number.isFinite(a))return NL.XTK.handleError("Unable to format number $1",a,c);var e={};if(SO.isNumber(b)){if(0!==b&&d)return NL.XTK.handleError("Unable to format an integer with decimal places",void 0,c);e.decimalPlaces=b}else SO.isString(b)?e.pattern=b:SO.isNundef(b)||(e=JSON.parse(JSON.stringify(b)));if(d&&(e.decimalPlaces=0),!SO.isNundef(e.significantFigures)){if(!SO.isNumber(e.significantFigures))throw new SyntaxError('Cannot format number, the parameter "significantFigures" ['+e.significantFigures+"] is not a number");if(1>e.significantFigures)throw new SyntaxError('Cannot format number, the parameter "significantFigures" ['+e.significantFigures+"] is not valid");var f=Math.pow(10,e.significantFigures-1),g=1,h=0,i=!1;if(0!==a)for(0>a&&(a=-a,i=!0);f>a||a>=10*f;)f>a?(a*=10,g/=10,h+=1):(a/=10,g*=10);a=Math.round(a),a*=g,i&&(a=-a),0!==a%1&&SO.isNundef(e.pattern)&&SO.isNundef(e.decimalPlaces)&&(e.decimalPlaces=h)}if(!SO.isNundef(e.decimalPlaces)){var j="#,##0";if(e.decimalPlaces>0){j+=".";for(var k=0;e.decimalPlaces>k;k++)j+="0"}e.pattern=j}if(e.pattern||(e.pattern="#,##0"),e.addSymbol&&-1===e.pattern.indexOf("\u00a4")){var l=" ";SO.isNundef(e.symbol)?SO.isNundef(this.settings.currencySymbol)||(l=this.settings.currencySymbol):l=e.symbol;var m=_currencySettings[l];m||(m={before:!1,space:!0});var n=m.space?" ":"";e.pattern=m.before?"\u00a4"+n+e.pattern:e.pattern+n+"\u00a4"}return this._formatNumber2(a,e.pattern,{decimalSymbol:e.decimalSymbol,groupSymbol:e.groupSymbol,symbol:e.symbol,minusSign:e.minusSign,plusSign:e.plusSign})},localeImpl.prototype._formatNumber2=function(a,b,c){var d,e,f,g,h,i,j,k,l=a.toString(),m=this.settings,n="";i=c.decimalSymbol||m.decimalSymbol||".",j=c.groupSymbol||m.digitGroupingSymbol||" ",k=SO.isNundef(c.symbol)?SO.isNundef(m.currencySymbol)?" ":m.currencySymbol:c.symbol;var o=b.indexOf("."),p=0;if(-1!==o){g=b.substr(0,o),h=b.substr(o+1);for(var q,r=h.length,s=0;r>s&&(q=h.charAt(s),"#"===q||"0"===q);s++)p++}else g=b;if(o=l.indexOf("."),-1!==o){if(e=l.substr(o+1),void 0!==e.charAt(p)&&e.charAt(p)>=5){var t=a+Math.pow(10,-p)*(0>a?-1:1);o=l.indexOf("."),l=t.toString(),o=l.indexOf("."),e=l.substr(o+1)}d=l.substr(0,o)}else d=l;"-"===d.charAt(0)?(f=void 0!==c.minusSign?c.minusSign:"-",d=d.substr(1)):f=void 0!==c.plusSign?c.plusSign:"";for(var u,q,v,w=g.length,x=!1,y=d.length,z=!1,s=y;s>0;s--)u=d.charAt(s-1),q=g.charAt(--w),(" "===q||","===q)&&(n=j+n,w=g.length,z=!0,q=g.charAt(--w)),"\u00a4"===q?(x||(x=!0,n=k+n,w>0&&" "===g.charAt(w-1)&&(w--,n="%"==k&&"percentSeparator"in m?m.percentSeparator+n:" "+n)),w--,n=u+n):("0"===q||"#"===q)&&(n=u+n,void 0===v&&(v=w+1)),0===w&&(w=v,z=!0);for(;!z&&w>0;)q=g.charAt(--w),"0"===q&&(n="0"+n);if(void 0!==h){for(var A="",B=!1,r=h.length,s=0;r>s;s++){var C=h.charAt(s);("#"===C||"0"===C)&&void 0!==e&&e.length>s?(A+=e.charAt(s),B=!0):"0"===C?(A+="0",B=!0):" "===C?A+="%"==k&&"percentSeparator"in m?m.percentSeparator:" ":"\u00a4"===C&&(A+=k)}n+=(B?i:"")+A}var D=parseFloat(n.replace(/ /g,"").replace(/,/g,"."),10);return 0===D&&(f=""),"\u00a4"===g.charAt(0)&&(n=k+n),n=f+n},NL.Locale.formatPercent=function(a,b,c){return NL.session.locale.formatPercent(a,b,c)},localeImpl.prototype.formatPercent=function(a,b,c){if(SO.isEmpty(a)){if(void 0!==c)return c;throw new Error("Unable to format as a percentage",a)}SO.isNundef(b)&&(b=0),SO.assert(SO.isNumber(b));var d="#,##0";if(b>0){d+=".";for(var e=0;b>e;e++)d+="0"}d+=" ",d+="\u00a4";var f={pattern:d,symbol:"%"};return this.formatNumber(100*a,f,c)},NL.Locale.formatDataSize=function(a,b,c){return NL.session.locale.formatWithUnit(a,b,"dataSize",c)},localeImpl.prototype.formatDataSize=function(a,b,c){return this.formatWithUnit(a,b,"dataSize",c)},NL.Locale.formatWithUnit=function(a,b,c,d){return NL.session.locale.formatWithUnit(a,b,c,d)},localeImpl.prototype.formatWithUnit=function(a,b,c,d){if(SO.isEmpty(a)){if(void 0!==d)return d;throw new Error("Unable to format number with units",a)}SO.isNundef(b)&&(b=1),SO.isString(a)&&(a=NL.XTK.parseNumber(a,0)),SO.assert(SO.isNumber(b));var e=this.settings.units[c];if(void 0===e)throw new Error("Invalid unit '"+c+"'");var f=!1;0>a&&(a=-a,f=!0);for(var g=e.length-1;g>0&&e[g].factor>a;)g--;var h={significantFigures:b,addSymbol:!0,symbol:e[g].symbol};f&&(a=-a);var i=NL.Locale.formatNumber(a/e[g].factor,h,d);return SO.String.trim(i)},NL.Locale.getMonthName=function(a){return a=a instanceof Date?a.getMonth()+1:parseInt(a,10),NL.session.locale.get("monthsName")[a-1]},NL.Locale._splitFormat=function(a){"undefined"==typeof a&&(a="");for(var b=[],c=null,d=!1,e=0,f=0;a.length>f;f++){var g=a.charAt(f);"%"===g?(c&&c.length>0&&b.push({token:c,length:e}),d=!0,c="%",e=0):(null===c&&(c="",e=0),d&&("2"===g?e=2:"4"===g&&(e=4),-1==="0123456789ABDHILMNPQSY".indexOf(g)&&(b.push({token:c,length:e}),c="",e=0,d=!1)),c+=g,d||e++)}for(c&&c.length>0&&b.push({token:c,length:e}),f=0;b.length>f;f++){var h=b[f];0===h.length&&"%"===h.token.charAt(0)&&3===h.token.length&&h.token.charAt(1)===h.token.charAt(2)&&(h.length=2)}return b},NL.Locale.parseDateTime=function(a,b,c){return NL.session.locale.parseDateTime(a,b,c)},NL.Locale.parseDateOnly=function(a,b,c){return NL.session.locale.parseDateOnly(a,b,c)},NL.Locale.parseTime=function(a,b,c){return NL.session.locale.parseTime(a,b,c)},localeImpl.prototype.parseDateTime=function(a,b,c){return this._parseDate(a,b,c,0)},localeImpl.prototype.parseDateOnly=function(a,b,c){return this._parseDate(a,b,c,1)},localeImpl.prototype.parseTime=function(a,b,c){return this._parseDate(a,b,c,2)},localeImpl.prototype._parseDate=function(a,b,c,d){if(SO.isEmpty(a)){if(void 0!==c)return c;throw new Error("Unable to parse date",a)}if(SO.Date.isDate(a))return a;var e=a+"";if(""===e){if(void 0!==c)return c;throw new Error("Unable to parse date",a)}SO.isString(b)&&(b={pattern:b});var f=b.pattern,g=this.settings[f];g&&"string"==typeof g&&""!==g||(g=f);var h=b.utc;"undefined"==typeof h&&(h=!1,g.length>0&&"Z"===g.charAt(g.length-1)&&(g=g.substring(0,g.length-1),h=!0),(1===d||2===d)&&(h=!0));for(var i,j,k,l=NL.Locale._splitFormat(g),m=SO.Date.newUTCDateTime(0,1,1,0,0,0),n=this.settings.AmPm,o=0,p=!1,q=0;l.length>q;q++){var r=l[q],s=r.token,t=r.length,u="";if("%"===s.charAt(0)){if(0===t)if(q===l.length-1)u=e,e="";else{var v=l[q+1],w=v.token;if("%"===w.charAt(0))throw new Error("Invalid format ["+g+"]");var x=e.indexOf(w.charAt(0));if(-1===x||0===x)throw new Error("Invalid format ["+g+"]");u=e.substring(0,x),e=e.substring(x)}else u=e.substring(0,t),e=e.substring(t);var y=!1;if(0===d||1===d)switch(s){case"%A":y=!0;break;case"%B":for(var z=0;this.settings.monthsName.length>z;z++){var A=this.settings.monthsName[z];if(A&&A.toLowerCase()===u.toLowerCase()){m.setUTCMonth(z),y=!0;break}}y=!0;break;case"%DD":case"%2D":case"%D":i=Number(u),i>=1&&31>=i&&(m.setUTCDate(i),y=!0);break;case"%MM":case"%2M":case"%MN":case"%M":j=Number(u),j>=1&&12>=j&&(m.setUTCMonth(j-1),y=!0);break;case"%Y2":case"%2Y":k=Number(u)+1900,m.setUTCFullYear(k),y=!0;break;case"%Y4":case"%4Y":k=Number(u),m.setUTCFullYear(k),y=!0;break;case"%Y":k=Number(u),2>=u.length&&(k+=1900),m.setUTCFullYear(k),y=!0}if(0===d||2===d){var B,C,D,E;switch(s){case"%L":E=Number(u),E>=0&&999>=E&&(m.setUTCMilliseconds(E),y=!0);break;case"%S":case"%2S":D=Number(u),D>=0&&60>=D&&(m.setUTCSeconds(D),y=!0);break;case"%MI":case"%N":case"%2N":C=Number(u),C>=0&&60>=C&&(m.setUTCMinutes(C),y=!0);break;case"%H2":case"%2H":case"%H4":case"%H":B=Number(u),B>=0&&60>=B&&(m.setUTCHours(Number(u)),y=!0);break;case"%I":case"%2I":B=Number(u),B>0&&12>=B&&(12===B&&(B=0),p=!0,1===o&&(B+=12),m.setUTCHours(B),y=!0);break;case"%P":u.toLowerCase()===n[0].toLowerCase()?(o=0,y=!0):u.toLowerCase()===n[1].toLowerCase()&&(o=1,p&&m.setUTCHours(m.getUTCHours()+12),y=!0)}}if(!y){if(void 0!==c)return c;throw new SyntaxError("Invalid token ["+s+"] with value "+u)}}else if(u=e.substring(0,t),e=e.substring(t),u!==s){if(void 0!==c)return c;throw new Error("String does not match format: value=["+a+"] format=["+JSON.stringify(b)+"] token=["+s+"] tokenValue=["+u+"]")}}if((1===d||0===d)&&void 0!==j&&j!==m.getUTCMonth()+1){if(void 0!==c)return c;throw new Error("Day number is invalid for the expected month")}if(isNaN(m.getTime())){if(void 0!==c)return c;throw new Error("The string to parse doesn't fit with the required format")}return h||(m=NL.session.timezone.offset(m,!1)),m},NL.Locale.formatDateTime=function(a,b,c){return NL.session.locale.formatDateTime(a,b,c)},localeImpl.prototype.formatDateTime=function(a,b,c){return this._formatDate(a,b,c,0)},NL.Locale.formatDateOnly=function(a,b,c){return NL.session.locale.formatDateOnly(a,b,c)},localeImpl.prototype.formatDateOnly=function(a,b,c){return this._formatDate(a,b,c,1)},NL.Locale.formatTime=function(a,b,c){return NL.session.locale.formatTime(a,b,c)},localeImpl.prototype.formatTime=function(a,b,c){return this._formatDate(a,b,c,2)},localeImpl.prototype.formatDatePartial=function(a,b,c){var d=new SO.PartialDate(a);return"timeHour"===a.type||"timeMinute"===a.type||"timeSecond"===a.type?NL.Locale.formatTime(d._toDate(b),c,null):NL.Locale.formatDateTime(NL.session.timezone.localeToBrowser(d._toDate(b)),c,null)},NL.Locale.formatDatePartial=function(a,b,c){return NL.session.locale.formatDatePartial(a,b,c)},localeImpl.prototype._formatDate=function(a,b,c,d){if(SO.isEmpty(a)){if(void 0!==c)return c;throw new Error("Unable to format the value as a date",a)}if(SO.Date.isDate(a)||(0===d?a=NL.XTK.parseDateTime(a,null):1===d?a=NL.XTK.parseDateOnly(a,null):2===d&&(a=NL.XTK.parseDateTime(a,null))),null===a){if(void 0!==c)return c;throw new Error("Unable to format the value as a date",a)}var e=a,f=this.settings;SO.isString(b)?(f[b]&&(b=f[b]+""),b={pattern:b}):SO.isNundef(b)&&(1===d?b={pattern:f.shortDate}:0===d&&(b={pattern:f.shortDateTime}));var g=b.pattern,h=b.utc||!1;0===d&&g.length>0&&"Z"===g.charAt(g.length-1)&&(g=g.substring(0,g.length-1),h=!0),(1===d||2===d)&&(h=!0);var i=b.pattern;if(!h){var j=b.timezone||NL.session.timezone;j&&(e=j.offset(e,!0))}var k,l,m,n,o,p,q,r,s,t;return(0===d||1===d)&&(k=e.getUTCDate(),l=e.getUTCMonth()+1,m=e.getUTCFullYear(),n=e.getUTCDay(),o=SO.Date.getWeekNumber(e),i=i.replace(/%DD/g,k),i=i.replace(/%2D/g,SO.Number.padLeft(k,2)),i=i.replace(/%MN/g,SO.Number.padLeft(l,2)),i=i.replace(/%MM/g,SO.Number.padLeft(l,2)),i=i.replace(/%2M/g,SO.Number.padLeft(l,2)),i=i.replace(/%Y2/g,SO.Number.padLeft(m%100,2)),i=i.replace(/%2Y/g,SO.Number.padLeft(m%100,2)),i=i.replace(/%4Y/g,SO.Number.padLeft(m%1e4,4)),i=i.replace(/%Y4/g,SO.Number.padLeft(m%1e4,4)),i=i.replace(/%4V/g,o.year),i=i.replace(/%2W/g,o.week)),(0===d||2===d)&&(p=e.getUTCHours(),q=e.getUTCMinutes(),r=e.getUTCSeconds(),s=e.getUTCMilliseconds(),t=SO.Date.getAMPMHour(e,!0),i=i.replace(/%H4/,SO.Number.padLeft(p,2)),i=i.replace(/%H2/,SO.Number.padLeft(p,2)),i=i.replace(/%2H/,SO.Number.padLeft(p,2)),i=i.replace(/%2H/,SO.Number.padLeft(p,2)),i=i.replace(/%2I/,SO.Number.padLeft(t,2)),i=i.replace(/%2N/,SO.Number.padLeft(q,2)),i=i.replace(/%MI/,SO.Number.padLeft(q,2)),i=i.replace(/%2S/,SO.Number.padLeft(r,2))),(0===d||1===d)&&(i=i.replace(/%D/g,k),i=i.replace(/%M/g,l),i=i.replace(/%Y/g,m%100)),(0===d||2===d)&&(i=i.replace(/%H/,p),i=i.replace(/%I/,t),i=i.replace(/%P/,f.AmPm[Math.floor(p/12)]),i=i.replace(/%N/,q),i=i.replace(/%S/,r),i=i.replace(/%L/,SO.Number.padLeft(s,4))),i=null!==f.daysName?i.replace(/%A/g,f.daysName[n]):i.replace(/%A/g,""),i=null!==f.monthsName?i.replace(/%B/g,f.monthsName[l-1]):i.replace(/%B/g,l),i=null!==f.quartersName?i.replace(/%Q/g,f.quartersName[Math.floor((l-1)/3)]):i.replace(/%Q/g,""),i=i.replace(/%C/g,Math.floor(1+(l-1)/3))},NL.Locale.formatTimeSpan=function(a,b,c){return NL.session.locale.formatTimeSpan(a,b,c)},localeImpl.prototype.formatTimeSpan=function(a,b,c){var d=a;if(isNaN(d)){if(void 0!==c)return c;throw new Error("The value could not be converted to a time interval: "+d)}d=parseInt(d,10);var e=this.settings.timeSpanUnits||{},f=this.settings.timeSpanUnits,g="",h=0,i=3,j={seconds:e.seconds||f.seconds,minutes:e.minutes||f.minutes,hours:e.hours||f.hours,days:e.days||f.days,months:e.months||f.months,years:e.years||f.years};Date.SEC_PER_MIN=60,Date.SEC_PER_HOUR=3600,Date.SEC_PER_DAY=86400,Date.SEC_PER_MONTH=2592e3,Date.SEC_PER_YEAR=31104e3;var k=Math.floor(d/Date.SEC_PER_YEAR);d%=Date.SEC_PER_YEAR;var l=Math.floor(d/Date.SEC_PER_MONTH);d%=Date.SEC_PER_MONTH;var m=Math.floor(d/Date.SEC_PER_DAY);d%=Date.SEC_PER_DAY;var n=Math.floor(d/Date.SEC_PER_HOUR);d%=Date.SEC_PER_HOUR;var o=Math.floor(d/Date.SEC_PER_MIN),p=Math.floor(d%Date.SEC_PER_MIN);return k>0&&(h++,g+=k+j.years),l>0&&(h++,g+=(0===g.length?"":" ")+l+j.months),m>0&&i>h&&(h++,g+=(0===g.length?"":" ")+m+j.days),n>0&&i>h&&(h++,g+=(0===g.length?"":" ")+n+j.hours),o>0&&i>h&&(h++,g+=(0===g.length?"":" ")+o+j.minutes),(0===h||p>0&&i>h)&&(g+=(0===g.length?"":" ")+p+j.seconds),g},NL.session.setLocale=function(a){NL.session.locale=NL.Locale.getLocale(a)};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.Locale"),SO.Locale=function(a,b){this._name=a,this._settings=SO.Utils.extend(!0,{},b)},SO.Locale.prototype.getName=function(){return this._name},SO.Locale.prototype.getSettings=function(){return SO.Utils.extend(!0,{},this._settings)},SO.Locale.prototype.get=function(a){return this._settings[a]};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.LocaleManager"),function(){SO.LocaleManager.LOCALE_SETTINGS={de:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%2D.%2M.%4Y",longDate:"%A, %D. %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%2D.%2M.%4Y %2H:%2N:%2S",AmPm:["AM","PM"],shortQuarter:"Q%C %4Y",longQuarter:"%Q %4Y",shortMonth:"%2M.%4Y",longMonth:"%B %4Y",shortWeek:"KW %2W/%4V",shortHour:"%2H Uhr",longHour:"%2H Uhr",longWeek:"Kalenderwoche %2W/%4V",daysName:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDaysName:["So","Mo","Di","Mi","Do","Fr","Sa"],monthsName:["Januar","Februar","M\u00e4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],quartersName:["1. Quartal","2. Quartal","3. Quartal","4. Quartal"],timeSpanUnits:{seconds:"s",minutes:"min",hours:"h",days:"T",months:"M",years:"J"},percentSeparator:"\u2009",currencySymbol:"\u20ac",booleanStrings:{"true":"wahr","false":"falsch"},units:{date:{year:"Jahr(en)",month:"Monat(en)",week:"Woche(n)",day:"Tag(en)",hour:"Stunde(n)",minute:"Minute(n)",second:"Sekunde(n)",ago:"Vor",justnow:"Soeben","in":"In",tomorrow:"Morgen",yesterday:"Gestern",and:"und",agoBefore:!0,inBefore:!0,age:"Jahr(e) alt"},dataSize:[{symbol:"B",factor:1},{symbol:"kB",factor:1024},{symbol:"MB",factor:1048576},{symbol:"GB",factor:1073741824}],count:[{symbol:"",factor:1},{symbol:"Tsd.",factor:1e3},{symbol:"Mio.",factor:1e6},{symbol:"Mrd.",factor:1e9}]},colonSuffix:":"},"en-us":{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2M/%2D/%4Y",longDate:"%A, %D %B, %4Y",time:"%I:%2N:%2S %P",shortTime:"%I:%2N %P",shortDateTime:"%2M/%2D/%4Y %I:%2N:%2S %P",AmPm:["AM","PM"],shortQuarter:"Q%C %4Y",longQuarter:"%Q %4Y",shortMonth:"%2M/%4Y",longMonth:"%B %4Y",shortWeek:"%4V-W%2W",longWeek:"%4V - Week %2W",shortHour:"%I %P",longHour:"%2Hh",daysName:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDaysName:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthsName:["January","February","March","April","May","June","July","August","September","October","November","December"],quartersName:["1st quarter","2nd quarter","3rd quarter","4th quarter"],shortTimeSpan:"%Y %M %D %H %N %S",longTimeSpan:"%y %m %d %h %n %s",shortYears:"%Y",longYears:"%y",shortMonths:"%M",longMonths:"%m",shortDays:"%D",longDays:"%d",shortHours:"%H",longHours:"%h",shortMinutes:"%N",longMinutes:"%n",shortSeconds:"%S",longSeconds:"%s",shortDaysHours:"%D %H",longDaysHours:"%d %h",timeSpanUnits:{seconds:"s",minutes:"mn",hours:"h",days:"d",months:"m",years:"y"},percentSeparator:"",currencySymbol:"$",booleanStrings:{"true":"true","false":"false"},units:{date:{year:"year(s)",month:"month(s)",week:"week(s)",day:"day(s)",hour:"hour(s)",minute:"minute(s)",second:"second(s)",ago:"ago",justnow:"Just now","in":"In",tomorrow:"Tomorrow",yesterday:"Yesterday",and:"and",agoBefore:!1,inBefore:!0,age:"year(s) old"},dataSize:[{symbol:"B",factor:1},{symbol:"kB",factor:1024},{symbol:"MB",factor:1048576},{symbol:"GB",factor:1073741824}],count:[{symbol:"",factor:1},{symbol:"k",factor:1e3},{symbol:"M",factor:1e6},{symbol:"G",factor:1e9}]},colonSuffix:":"},"en-gb":{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2D/%2M/%4Y",longDate:"%A %D %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"],currencySymbol:"\u00a3"},ar:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D. %B %4Y",time:"%2I:%2N:%2S %P",shortTime:"%2I:%2N %P",shortDateTime:"%2D/%2M/%4Y %2I:%2N:%2S %P",AmPm:["\u0635","\u0645"]},zh:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%4Y-%M-%D",longDate:"%A, %D. %B %4Y",time:"%P%I:%2N:%2S",shortTime:"%P%I:%2N",shortDateTime:"%4Y-%M-%D %P%I:%2N:%2S",AmPm:["\u4e0a\u5348","\u4e0b\u5348"]},ko:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2D.%2M.%4Y",longDate:"%A, %D. %B %4Y",time:"%P %2I:%2N:%2S",shortTime:"%P %2I:%2N",shortDateTime:"%4Y. %M. %D %P %2I:%2N:%2S",AmPm:["\uc624\uc804","\uc624\ud6c4"]},da:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D-%2M-%4Y",longDate:"%D. %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%2D-%2M-%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},es:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D de %B de %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%2M-%2D-%4Y %H:%2N:%2S",AmPm:["AM","PM"]},et:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%D.%2M.%4Y",longDate:"%D %B %4Y. a.",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%D.%2M.%4Y %H:%2N:%2S",AmPm:["AM","PM"]},fi:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%D.%M.%4Y",longDate:"%D. %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%D.%M.%4Y %H:%2N:%2S",AmPm:["AM","PM"]},"fr-fr":{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A %D %B %4Y",partialDate:"%B, %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"],shortHour:"%Hh",daysName:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDaysName:["dim","lun","mar","mer","jeu","ven","sam"],shortWeek:"%4V-S%2W",longWeek:"%4V - Semaine %2W",monthsName:["janvier","f\u00e9vrier","mars","avril","mai","juin","juillet","ao\u00fbt","septembre","octobre","novembre","d\u00e9cembre"],quartersName:["1er trimestre","2e trimestre","3e trimestre","4e trimestre"],percentSeparator:" ",currencySymbol:"\u20ac",timeSpanUnits:{seconds:"s",minutes:"mn",hours:"h",days:"j",months:"m",years:"a"},booleanStrings:{"true":"vrai","false":"faux"},units:{date:{year:"an(s)",month:"mois",week:"semaine(s)",day:"jour(s)",hour:"heure(s)",minute:"minute(s)",second:"seconde(s)",ago:"Il y a",justnow:"A l'instant","in":"Dans",tomorrow:"Demain",yesterday:"Hier",and:"et",agoBefore:!0,inBefore:!0,age:"an(s)"},dataSize:[{symbol:"o",factor:1},{symbol:"ko",factor:1024},{symbol:"Mo",factor:1048576},{symbol:"Go",factor:1073741824}],count:[{symbol:"",factor:1},{symbol:"k",factor:1e3},{symbol:"M",factor:1e6},{symbol:"G",factor:1e9}]},colonSuffix:"\u00a0:"},"fr-be":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%D/%2M/%4Y",longDate:"%A %D %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%D/%2M/%4Y %H:%2N:%2S",AmPm:["AM","PM"],daysName:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDaysName:["dim","lun","mar","mer","jeu","ven","sam"],monthsName:["janvier","f\u00e9vrier","mars","avril","mai","juin","juillet","ao\u00fbt","septembre","octobre","novembre","d\u00e9cembre"],quartersName:["1er trimestre","2e trimestre","3e trimestre","4e trimestre"],percentSeparator:" "},el:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%D/%M/%4Y",longDate:"%A, %D %B %4Y",time:"%I:%2N:%2S %P",shortTime:"%I:%2N %P",shortDateTime:"%D/%M/%4Y %I:%2N:%2S %P",AmPm:["\u03c0\u03bc","\u03bc\u03bc"]},he:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D. %B %4Y",time:"%2H:%2N:%2S",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},hu:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%4Y.%2M.%2D.",longDate:"%4Y. %B %D.",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%4Y.%2M.%2D. %H:%2N:%2S",AmPm:["DE","DU"]},id:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%D %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},ga:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%4Y/%2M/%2D",longDate:"%A, %D. %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%4Y/%2M/%2D %2H:%2N:%2S",AmPm:["a.m.","p.m."]},"it-it":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A %D %B %4Y",time:"%2H:%2N:%2S",shorTime:"%2H:%2N",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},"it-ch":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D. %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%2D/%2M/%4Y %H:%2N:%2S",AmPm:["AM","PM"]},ja:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%4Y/%2M/%2D",longDate:"%A, %D. %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%4Y/%2M/%2D. %H:%2N:%2S",AmPm:["\u5348\u524d","\u5348\u5f8c"]},lv:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%4Y.%2M.%2D.",longDate:"%A, %4Y. gada %D. %B",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%4Y.%2M.%2D. %2H:%2N:%2S",AmPm:["AM","PM"]},lt:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%4Y.%D.%M.",longDate:"%4Y m. %B %D d.",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%4Y.%D.%M %2H:%2N:%2S",AmPm:["AM","PM"]},mt:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D ta' %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["QN","WN"]},"nl-nl":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%D-%M-%4Y",longDate:"%A %D %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%D-%M-%4Y %H:%2N:%2S",AmPm:["AM","PM"]},"nl-be":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%D/%2M/%4Y",longDate:"%A %D %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%D/%2M/%4Y %H:%2N:%2S",AmPm:["AM","PM"]},no:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%2D.%2M.%4Y",longDate:"%A %D. %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%2D.%2M.%4Y %2H:%2N:%2S",AmPm:["AM","PM"],daysName:["sundag","m\u00e5ndag","tysdag","onsdag","torsdag","fredag","laurdag"],monthsName:["januar","februar","mars","april","mai","juni","juli","august","september","oktober","november","desember"],percentSeparator:" "},pl:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%4Y-%2M-%2D",longDate:"%D %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%4Y-%2M-%2D %2H:%2N:%2S",AmPm:["AM","PM"]},"pt-pt":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D-%2M-%4Y",longDate:"%A, %D de %B de %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%2D-%2M-%4Y %H:%2N:%2S",AmPm:["AM","PM"]},"pt-br":{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D de %B de %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%2D/%2M/%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},ru:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%2D.%2M.%4Y",longDate:"%D %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%2D.%2M.%4Y %H:%2N:%2S",AmPm:["AM","PM"]},sl:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%D.%M.%4Y",longDate:"%D. %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%D.%M.%4Y %H:%2N:%2S",AmPm:["AM","PM"]},sk:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%D.%M.%4Y",longDate:"%D. %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%D.%M.%4Y %H:%2N:%2S",AmPm:["AM","PM"]},"sv-se":{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%4Y-%2M-%2D",longDate:"%A %D %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%4Y-%2M-%2D %2H:%2N:%2S",AmPm:["AM","PM"]},"sv-fi":{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%D.%M.%4Y",longDate:"%A %D %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%D.%M.%4Y %2H:%2N:%2S",AmPm:["AM","PM"]},cs:{digitGroupingSymbol:" ",decimalSymbol:",",shortDate:"%D.%M.%4Y",longDate:"%D. %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%D.%M.%4Y %H:%2N:%2S",AmPm:["dop.","odp."]},th:{digitGroupingSymbol:",",decimalSymbol:".",shortDate:"%M/%D/%4Y",longDate:"%A, %D. %B %4Y",time:"%I:%2N:%2S %P",shorTime:"%I:%2N %P",shortDateTime:"%M/%D/%4Y %I:%2N:%2S %P",AmPm:["\u0e01\u0e48\u0e2d\u0e19\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07","\u0e2b\u0e25\u0e31\u0e07\u0e40\u0e17\u0e35\u0e48\u0e22\u0e07"]},vi:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D/%2M/%4Y",longDate:"%A, %D. %B %4Y",time:"%2H:%2N:%2S",shortTime:"%2H:%2N",shortDateTime:"%2H:%2N:%2S %2D/%2M/%4Y",AmPm:["SA","CH"]},wa:{digitGroupingSymbol:".",decimalSymbol:",",shortDate:"%2D.%2M.%4Y",longDate:"%A, %D. %B %4Y",time:"%H:%2N:%2S",shortTime:"%H:%2N",shortDateTime:"%D/%2M/%4Y %H:%2N:%2S",AmPm:["AM","PM"]}};var a=Object.keys(SO.LocaleManager.LOCALE_SETTINGS),b=function(b){if(b&&"string"==typeof b){if(b=b.replace(/_/g,"-").toLowerCase(),-1!==a.indexOf(b))return b;switch(b){case"en":b=b+"-"+"us";break;case"de-de":b="de";break;default:b=b+"-"+b}return b}},c=c||void 0;SO.LocaleManager._defaultLocaleName=c&&c.language||c&&c.browserLanguage||"en-us",SO.LocaleManager._currentLocale=new SO.Locale(SO.LocaleManager._defaultLocaleName,SO.LocaleManager.LOCALE_SETTINGS[SO.LocaleManager._defaultLocaleName]),SO.LocaleManager.setDefaultLocale=function(c){if(c=b(c),-1===a.indexOf(c))throw new Error(c+" is not a valid locale.");return this._currentLocale=SO.LocaleManager.getLocale(c),this},SO.LocaleManager.getDefaultLocale=function(){return SO.LocaleManager._currentLocale},SO.LocaleManager.getLocale=function(c){if(c&&c instanceof SO.Locale)return c;var d=b(c);if(-1!==a.indexOf(d)){var e=SO.Utils.extend({},SO.LocaleManager.LOCALE_SETTINGS["en-us"],SO.LocaleManager.LOCALE_SETTINGS[d]);return new SO.Locale(d,e)}return null}}();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.Date"),SO.Date.ISO8601={date:"%4Y-%2M-%2D",dateTime:"%4Y-%2M-%2DT%2H:%2N:%2SZ"},SO.Date.formatToRegex=function(a,b){b=b||SO.LocaleManager.getDefaultLocale();var c=b.getSettings();c.timeSpanUnits,c.units.date;var d=function(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},e={regex:a,groups:{year:null,month:null,day:null,hours:null,minutes:null,seconds:null,milliseconds:null,ampm:null}},f={ampm:[{format:/%P/g,re:"("+c.AmPm.join("|")+")"}],milliseconds:[{format:/%L/g,re:"(\\d{3})"}],seconds:[{format:/%2S/g,re:"(\\d{2})"},{format:/%S/g,re:"(\\d+)"}],minutes:[{format:/%2N/g,re:"(\\d{2})"},{format:/%N/g,re:"(\\d+)"}],hours:[{format:/%2H|%2I/g,re:"(\\d{2})"},{format:/%H|%I/g,re:"(\\d+)"}],day:[{format:/%2D/g,re:"(\\d{2})"},{format:/%D/g,re:"(\\d+)"}],month:[{format:/%2M/g,re:"(\\d{2})"},{format:/%M/g,re:"(\\d+)"}],year:[{format:/%2Y/g,re:"(\\d{2})"},{format:/%4Y/g,re:"(\\d{4})"},{format:/%Y/g,re:"(\\d+)"}]};a=d(a),e.regex=d(e.regex),SO.Utils.each(f,function(b,c){for(var d=0;c.length>d;d++){var f=e.regex.search(c[d].format);e.groups[b]=-1!==f?a.search(c[d].format):e.groups[b],-1!==e.groups[b]&&(e.regex=e.regex.replace(c[d].format,c[d].re))}});var g=Object.keys(e.groups).map(function(a){return e.groups[a]}),h=g.filter(function(a){return null!==a}).sort(function(a,b){return a-b});for(var i in e.groups){var j=h.indexOf(e.groups[i]);e.groups[i]=-1!==j?j+1:null}return e.regex=new RegExp("^"+e.regex+"$"),e},SO.Date.getAMPMHour=function(a,b){var c=Math.floor(b?a.getUTCHours():a.getHours());return c>12?c-=12:1>c&&(c=12),c},SO.Date.weekBeginsAt=function(a,b){if(b>=0&&6>=b)for(var c=0;b>c;c++){var d=a.shift();a.push(d)}},SO.Date.getWeekNumber=function(a){var b,c,d;return b=new Date(a),b.setHours(0,0,0),b.setDate(b.getDate()+4-(b.getDay()||7)),d=new Date(b.getFullYear(),0,1),c=Math.ceil(((b-d)/864e5+1)/7),{year:b.getFullYear(),week:c}},SO.Date.isLeapYear=function(a){return 0===a%4&&0!==a%100||0===a%400},SO.Date.isDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)},SO.Date.newUTCDateOnly=function(a,b,c){var d=new Date(Date.UTC(a,b-1,c));return 1900>a&&d.setUTCFullYear(a),d},SO.Date.newUTCDateTime=function(a,b,c,d,e,f,g){var h=new Date(Date.UTC(a,b-1,c,d||0,e||0,f||0,g||0));return 1900>a&&h.setUTCFullYear(a),h},SO.Date.newTimeOnly=function(a,b,c,d){a=a||0,b=b||0,c=c||0,d=d||0;var e=new Date(Date.UTC(0,0,1,a,b,c,d));if(e.setUTCFullYear(0),isNaN(e.getTime())||0!==e.getUTCFullYear()||0!==e.getUTCMonth()||1!==e.getUTCDate()||e.getUTCHours()!==a||e.getUTCMinutes()!==b||e.getUTCSeconds()!==c||e.getUTCMilliseconds()!==d)throw new Error("Attempt to create an invalid Time Only.");return e},SO.Date.newDatePartial=function(a,b){var c=null;switch(SO.OO.assertObjectHasProperties(b,{optional:["year","quarter","month","day","hour","minute","second","timeHour","timeMinute","timeSecond"]}),a){case"year":c={type:a,year:parseInt(b.year,10)};break;case"month":c={type:a,year:parseInt(b.year,10),month:parseInt(b.month,10)};break;case"quarter":c={type:a,year:parseInt(b.year,10),quarter:parseInt(b.quarter,10)};break;case"day":c={type:a,year:parseInt(b.year,10),month:parseInt(b.month,10),day:parseInt(b.day,10)};break;case"hour":c={type:a,year:parseInt(b.year,10),month:parseInt(b.month,10),day:parseInt(b.day,10),hour:parseInt(b.hour,10)};break;case"minute":c={type:a,year:parseInt(b.year,10),month:parseInt(b.month,10),day:parseInt(b.day,10),hour:parseInt(b.hour,10),minute:parseInt(b.minute,10)};break;case"second":c={type:a,year:parseInt(b.year,10),month:parseInt(b.month,10),day:parseInt(b.day,10),hour:parseInt(b.hour,10),minute:parseInt(b.minute,10),second:parseInt(b.second,10)};break;case"timeHour":c={type:a,hour:parseInt(b.hour,10)};break;case"timeMinute":c={type:a,hour:parseInt(b.hour,10),minute:parseInt(b.minute,10)};break;case"timeSecond":c={type:a,hour:parseInt(b.hour,10),minute:parseInt(b.minute,10),second:parseInt(b.second,10)};break;default:throw"Can't create partial date : invalid type"}return c};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.Number"),SO.Number._CURRENCY_SETTINGS={$:{before:!0,space:!1},"\u00a3":{before:!0,space:!1},"\u20ac":{before:!1,space:!1}},SO.Number._format=function(a,b){var c=SO.Utils.extend(!0,{},b);if(!SO.isNundef(c.significantFigures)){if(!SO.isNumber(c.significantFigures))throw new SyntaxError('Cannot format number, the parameter "significantFigures" ['+c.significantFigures+"] is not a number");if(1>c.significantFigures)throw new SyntaxError('Cannot format number, the parameter "significantFigures" ['+c.significantFigures+"] is not valid");var d=Math.pow(10,c.significantFigures-1),e=1,f=0,g=!1;if(0!==a)for(0>a&&(a=-a,g=!0);d>a||a>=10*d;)d>a?(a*=10,e/=10,f+=1):(a/=10,e*=10);a=Math.round(a),a*=e,g&&(a=-a),0!==a%1&&SO.isNundef(c.pattern)&&SO.isNundef(c.decimalPlaces)&&(c.decimalPlaces=f)}if(!SO.isNundef(c.decimalPlaces)){var h="#,##0";if(c.decimalPlaces>0){h+=".";for(var i=0;c.decimalPlaces>i;i++)h+="0"}c.pattern=h}if(c.pattern||(c.pattern="#,##0"),c.addSymbol&&-1===c.pattern.indexOf("\u00a4")){var j=" ";SO.isNundef(c.symbol)?SO.isNundef(c.localeSettings.currencySymbol)||(j=c.localeSettings.currencySymbol):j=c.symbol;var k=SO.Number._CURRENCY_SETTINGS[j];k||(k={before:!1,space:!0});var l=k.space?" ":"";c.pattern=k.before?"\u00a4"+l+c.pattern:c.pattern+l+"\u00a4"}return SO.Number._applyPatternToNumber(a,c.pattern,{decimalSymbol:c.decimalSymbol,groupSymbol:c.groupSymbol,symbol:c.symbol,minusSign:c.minusSign,plusSign:c.plusSign,localeSettings:c.localeSettings})},SO.Number._applyPatternToNumber=function(a,b,c){var d,e,f,g,h,i,j,k,l=a.toString(),m=c.localeSettings,n="";i=c.decimalSymbol||m.decimalSymbol||".",j=c.groupSymbol||m.digitGroupingSymbol||" ",k=SO.isNundef(c.symbol)?SO.isNundef(m.currencySymbol)?" ":m.currencySymbol:c.symbol;var o=b.indexOf("."),p=0;if(-1!==o){g=b.substr(0,o),h=b.substr(o+1);for(var q,r=h.length,s=0;r>s&&(q=h.charAt(s),"#"===q||"0"===q);s++)p++}else g=b;if(o=l.indexOf("."),-1!==o){if(e=l.substr(o+1),void 0!==e.charAt(p)&&e.charAt(p)>=5){var t=a+Math.pow(10,-p)*(0>a?-1:1);o=l.indexOf("."),l=t.toString(),o=l.indexOf("."),e=l.substr(o+1)}d=l.substr(0,o)}else d=l;"-"===d.charAt(0)?(f=void 0!==c.minusSign?c.minusSign:"-",d=d.substr(1)):f=void 0!==c.plusSign?c.plusSign:"";for(var u,q,v,w=g.length,x=!1,y=d.length,z=!1,s=y;s>0;s--)u=d.charAt(s-1),q=g.charAt(--w),(" "===q||","===q)&&(n=j+n,w=g.length,z=!0,q=g.charAt(--w)),"\u00a4"===q?(x||(x=!0,n=k+n,w>0&&" "===g.charAt(w-1)&&(w--,n="%"==k&&"percentSeparator"in m?m.percentSeparator+n:" "+n)),w--,n=u+n):("0"===q||"#"===q)&&(n=u+n,void 0===v&&(v=w+1)),0===w&&(w=v,z=!0);for(;!z&&w>0;)q=g.charAt(--w),"0"===q&&(n="0"+n);if(void 0!==h){for(var A="",B=!1,r=h.length,s=0;r>s;s++){var C=h.charAt(s);("#"===C||"0"===C)&&void 0!==e&&e.length>s?(A+=e.charAt(s),B=!0):"0"===C?(A+="0",B=!0):" "===C?A+="%"==k&&"percentSeparator"in m?m.percentSeparator:" ":"\u00a4"===C&&(A+=k)}n+=(B?i:"")+A}var D=parseFloat(n.replace(/ /g,"").replace(/,/g,"."),10);return 0===D&&(f=""),"\u00a4"===g.charAt(0)&&(n=k+n),n=f+n},SO.Number.padLeft=function(a,b){return SO.String.padLeft(String(a),"0",b)},SO.Number.isFinite=function(a){return SO.isNumber(a)&&isFinite(a)},SO.Number.isNaN=function(a){return a!==a};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.PartialDate"),SO.PartialDate=function(a){switch(a.type){case"year":this._partialDate={year:parseInt(a.year,10)};break;case"month":this._partialDate={year:parseInt(a.year,10),month:parseInt(a.month,10)};break;case"quarter":this._partialDate={year:parseInt(a.year,10),quarter:parseInt(a.quarter,10)};break;case"day":this._partialDate={year:parseInt(a.year,10),month:parseInt(a.month,10),day:parseInt(a.day,10)};break;case"hour":this._partialDate={year:parseInt(a.year,10),month:parseInt(a.month,10),day:parseInt(a.day,10),hour:parseInt(a.hour,10)};break;case"minute":this._partialDate={year:parseInt(a.year,10),month:parseInt(a.month,10),day:parseInt(a.day,10),hour:parseInt(a.hour,10),minute:parseInt(a.minute,10)};break;case"second":this._partialDate={year:parseInt(a.year,10),month:parseInt(a.month,10),day:parseInt(a.day,10),hour:parseInt(a.hour,10),minute:parseInt(a.minute,10),second:parseInt(a.second,10)};break;case"timeHour":this._partialDate={hour:parseInt(a.hour,10)};break;case"timeMinute":this._partialDate={hour:parseInt(a.hour,10),minute:parseInt(a.minute,10)};break;case"timeSecond":this._partialDate={hour:parseInt(a.hour,10),minute:parseInt(a.minute,10),second:parseInt(a.second,10)};break;default:throw new Error(a.type+" is not a valid partial date type ")}if(this._partialDate=SO.Utils.extend({type:a.type},this._partialDate),!SO.PartialDate.isValid(this._partialDate))throw new Error("Invalid partialDate")},SO.PartialDate.isValid=function(a){var b=[31,null,31,30,31,30,31,31,30,31,30,31];if(!a)return!1;switch(SO.OO.assertObjectHasProperties(a,{mandatory:["type"],optional:["year","quarter","month","day","hour","minute","second","timeHour","timeMinute","timeSecond"]}),b[1]=SO.Date.isLeapYear(a.year)?29:28,a.type){case"year":return SO.PartialDate._isValidDateProperty(a.year,0,1e4);case"quarter":var c=SO.PartialDate._isValidDateProperty(a.year,1,1e4),d=SO.PartialDate._isValidDateProperty(a.quarter,1,4);return c&&d;case"month":var c=SO.PartialDate._isValidDateProperty(a.year,1,1e4),e=SO.PartialDate._isValidDateProperty(a.month,1,12);return c&&e;case"day":var c=SO.PartialDate._isValidDateProperty(a.year,1,1e4),e=SO.PartialDate._isValidDateProperty(a.month,1,12),f=SO.PartialDate._isValidDateProperty(a.day,1,b[parseInt(a.month,10)-1]);return c&&e&&f;case"hour":var c=SO.PartialDate._isValidDateProperty(a.year,1,1e4),e=SO.PartialDate._isValidDateProperty(a.month,1,12),f=SO.PartialDate._isValidDateProperty(a.day,1,b[parseInt(a.month,10)-1]),g=SO.PartialDate._isValidDateProperty(a.hour,0,23);return c&&e&&f&&g;case"minute":var c=SO.PartialDate._isValidDateProperty(a.year,1,1e4),e=SO.PartialDate._isValidDateProperty(a.month,1,12),f=SO.PartialDate._isValidDateProperty(a.day,1,b[parseInt(a.month,10)-1]),g=SO.PartialDate._isValidDateProperty(a.hour,0,23),h=SO.PartialDate._isValidDateProperty(a.minute,0,59);return c&&e&&f&&g&&h;case"second":var c=SO.PartialDate._isValidDateProperty(a.year,1,1e4),e=SO.PartialDate._isValidDateProperty(a.month,1,12),f=SO.PartialDate._isValidDateProperty(a.day,1,b[parseInt(a.month,10)-1]),g=SO.PartialDate._isValidDateProperty(a.hour,0,23),h=SO.PartialDate._isValidDateProperty(a.minute,0,59),i=SO.PartialDate._isValidDateProperty(a.second,0,59);return c&&e&&f&&g&&h&&i;case"timeHour":return SO.PartialDate._isValidDateProperty(a.hour,0,23);case"timeMinute":var g=SO.PartialDate._isValidDateProperty(a.hour,0,23),h=SO.PartialDate._isValidDateProperty(a.minute,0,59);return g&&h;case"timeSecond":var g=SO.PartialDate._isValidDateProperty(a.hour,0,23),h=SO.PartialDate._isValidDateProperty(a.minute,0,59),i=SO.PartialDate._isValidDateProperty(a.second,0,59);return g&&h&&i;default:return!1}},SO.PartialDate._isValidDateProperty=function(a,b,c){return SO.isInteger(a)&&a>=b&&c>=a},SO.PartialDate._applyFormatToPartialDate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n=b;return d=a.getUTCDate(),e=a.getUTCMonth()+1,f=a.getUTCFullYear(),g=a.getUTCDay(),h=SO.Date.getWeekNumber(a),n=n.replace(/%2D/g,SO.Number.padLeft(d,2)),n=n.replace(/%2M/g,SO.Number.padLeft(e,2)),n=n.replace(/%2Y/g,SO.Number.padLeft(f%100,2)),n=n.replace(/%4Y/g,SO.Number.padLeft(f%1e4,4)),n=n.replace(/%4V/g,h.year),n=n.replace(/%2W/g,h.week),i=a.getUTCHours(),j=a.getUTCMinutes(),k=a.getUTCSeconds(),l=a.getUTCMilliseconds(),m=SO.Date.getAMPMHour(a,!0),n=n.replace(/%2H/,SO.Number.padLeft(i,2)),n=n.replace(/%2I/,SO.Number.padLeft(m,2)),n=n.replace(/%2N/,SO.Number.padLeft(j,2)),n=n.replace(/%2S/,SO.Number.padLeft(k,2)),n=n.replace(/%D/g,d),n=n.replace(/%M/g,e),n=n.replace(/%Y/g,f%100),n=n.replace(/%H/,i),n=n.replace(/%I/,m),n=n.replace(/%P/,c.AmPm[Math.floor(i/12)]),n=n.replace(/%N/,j),n=n.replace(/%S/,k),n=n.replace(/%L/,SO.Number.padLeft(l,4)),n=n.replace(/%A/g,c.daysName[g]),n=n.replace(/%B/g,c.monthsName[e-1]),n=n.replace(/%Q/g,c.quartersName[Math.floor((e-1)/3)]),n=n.replace(/%C/g,Math.floor(1+(e-1)/3))},SO.PartialDate.prototype.format=function(a){a=SO.Utils.extend(!0,{},{format:"",locale:SO.LocaleManager.getDefaultLocale().getName(),interval:"left"},a);var b=SO.LocaleManager.getLocale(a.locale).getSettings(),c=b[a.format]||a.format;return SO.OO.assertObjectHasProperties(a,{mandatory:["format","locale","interval"]}),SO.assert(SO.isString(a.format)),SO.PartialDate._applyFormatToPartialDate(this._toDate(a.interval),c,b)},SO.PartialDate.prototype.compare=function(a){SO.assert(SO.isPartialDate(a));var b=this._toDate().valueOf(),c=a._toDate().valueOf();return c===b?0:c>b?-1:1},SO.PartialDate.prototype.equals=function(a){return SO.assert(SO.isPartialDate(a)),0===this.compare(a)},SO.PartialDate.prototype.greaterThan=function(a){return SO.assert(SO.isPartialDate(a)),1===this.compare(a)},SO.PartialDate.prototype.lessThan=function(a){return SO.assert(SO.isPartialDate(a)),-1===this.compare(a)},SO.PartialDate.prototype.toString=function(){return JSON.stringify(this._partialDate)},SO.PartialDate.prototype.toJSON=function(){return SO.Utils.extend({},this._partialDate)},SO.PartialDate.prototype.substract=function(a){return(this._toDate().getTime()-a._toDate().getTime())/1e3},SO.PartialDate.prototype._toDate=function(a){a=a||"left";var b=new Date,c=[31,null,31,30,31,30,31,31,30,31,30,31],d=function(a,b){b&&a.setUTCHours(0),a.setUTCMinutes(0),a.setUTCSeconds(0),a.setUTCMilliseconds(0)},e=parseInt(this._partialDate.year,10),f=null,g=null,h=null,i=null,j=null,k=null;c[1]=SO.Date.isLeapYear(e)===!0?29:28;var g=this._partialDate.type;switch(g){case"year":f=0,h=0;break;case"quarter":f=3*parseInt(this._partialDate.quarter,10)-3,h=0;break;case"month":f=parseInt(this._partialDate.month,10)-1,h=0;break;case"day":f=parseInt(this._partialDate.month-1,10),h=parseInt(this._partialDate.day,10);break;case"hour":f=parseInt(this._partialDate.month-1,10),h=parseInt(this._partialDate.day,10),i=parseInt(this._partialDate.hour,10);break;case"minute":f=parseInt(this._partialDate.month-1,10),h=parseInt(this._partialDate.day,10),i=parseInt(this._partialDate.hour,10),j=parseInt(this._partialDate.minute,10);break;case"second":f=parseInt(this._partialDate.month-1,10),h=parseInt(this._partialDate.day,10),i=parseInt(this._partialDate.hour,10),j=parseInt(this._partialDate.minute,10),k=parseInt(this._partialDate.second,10);break;case"timeHour":i=parseInt(this._partialDate.hour,10);break;case"timeMinute":i=parseInt(this._partialDate.hour,10),j=parseInt(this._partialDate.minute,10);break;case"timeSecond":i=parseInt(this._partialDate.hour,10),j=parseInt(this._partialDate.minute,10),k=parseInt(this._partialDate.second,10)}if("left"===a)b.setUTCFullYear(e),b.setUTCMonth(f,1),("day"===g||"hour"===g||"minute"===g||"second"===g)&&b.setUTCMonth(f,h),"year"===g||"quarter"===g||"month"===g||"day"===g?d(b,!0):("hour"===g&&(b.setUTCHours(i),d(b)),"minute"===g&&(b.setUTCHours(i),b.setUTCMinutes(j),b.setUTCSeconds(0)),"second"===g&&(b.setUTCHours(i),b.setUTCMinutes(j),b.setUTCSeconds(k)),("timeHour"===g||"timeMinute"===g||"timeSecond"===g)&&(b.setUTCFullYear(0),b.setUTCMonth(0,1),"timeHour"===g&&(b.setUTCFullYear(0),b.setUTCUTCMonth(0,1),b.setUTCHours(i),d(b)),"timeMinute"===g&&(b.setUTCFullYear(0),b.setUTCMonth(0,1),b.setUTCHours(i),b.setUTCMinutes(j),b.setUTCSeconds(0)),"timeSecond"===g&&(b.setUTCFullYear(0),b.setUTCMonth(0,1),b.setUTCHours(i),b.setUTCMinutes(j),b.setUTCSeconds(k))));else switch(g){case"year":b.setUTCFullYear(e),b.setUTCMonth(11,c[f]),d(b,!0);break;case"quarter":b.setUTCFullYear(e);var l=f+2;b.setUTCMonth(l,c[l]),d(b,!0);break;case"month":b.setUTCFullYear(e),b.setUTCMonth(f,c[f]),d(b,!0);break;case"day":b.setUTCFullYear(e),b.setUTCMonth(f,h),d(b,!0);break;case"hour":b.setUTCFullYear(e),b.setUTCMonth(f,h),b.setUTCHours(i),b.setUTCMinutes(59),b.setUTCSeconds(0);break;case"minute":b.setUTCFullYear(e),b.setUTCMonth(f,h),b.setUTCHours(i),b.setUTCMinutes(j);break;case"second":b.setUTCFullYear(e),b.setUTCMonth(f,h),b.setUTCHours(i),b.setUTCMinutes(j),b.setUTCSeconds(k);break;case"timeHour":b.setUTCFullYear(0),b.setUTCMonth(0,1),b.setUTCHours(i),d(b);break;case"timeMinute":b.setUTCFullYear(0),b.setUTCMonth(0,1),b.setUTCHours(i),b.setUTCMinutes(j),b.setUTCSeconds(0);break;case"timeSecond":b.setUTCFullYear(0),b.setUTCMonth(0,1),b.setUTCHours(i),b.setUTCMinutes(j),b.setUTCSeconds(k)}return b},SO.PartialDate.toString=function(a){return void 0!==a&&null!==a?a.toString():""},SO.PartialDate.format=function(a,b){return a.format(b)},SO.PartialDate.parse=function(a){return new SO.PartialDate(JSON.parse(a))};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";NL.require("/nl/core/shared/sirocco/core/so.js").require("/nl/core/shared/sirocco/core/oo.js").require("/nl/core/shared/sirocco/type/_number.js"),SO.ns("NL.Timezone"),NL.Timezone=function(a,b){if("undefined"==typeof a){var c=new Date,d=c.getTimezoneOffset(),e=d%60,f=(Math.abs(d)-e)/60,g=d>0?"-":"+";g+=SO.Number.padLeft(f,2),g+=SO.Number.padLeft(e,2),this.m_strName=g}else this.m_strName=a;this.m_vRange=SO.isArray(b)?b:[];var h=this.m_strName.match(/^([+\-])?(\d{2})(\d{2})?$/);if(h){h.shift();var i=h.shift()||"+",j=h.shift()||"00",k=h.shift()||"00",d=6e4*(parseInt(k,10)+60*parseInt(j,10))*("+"===i?1:-1);this.m_vRange.push({startDate:-Number.MAX_VALUE,offset:d})}},NL.Timezone.prototype._getOffset=function(a){for(var b=this.m_vRange.length,c=-1,d=a,e=null;b-c>1;){var f=Math.floor((b+c)/2);if(this.m_vRange[f].startDate>d)b=f;else{if(this.m_vRange[f].startDate===d||f+1>=this.m_vRange.length||this.m_vRange[f+1].startDate>d){e=this.m_vRange[f].offset;break}c=f}}return e},NL.Timezone.GMT="Etc/GMT",NL.Timezone.GMT_PLUS_0100="Etc/GMT-1",NL.Timezone.GMT_PLUS_0200="Etc/GMT-2",NL.Timezone.GMT_MINUS_0100="Etc/GMT+1",NL.Timezone.GMT_MINUS_0200="Etc/GMT+2",NL.Timezone.prototype.offset=function(a,b){var c=a.getTime(),d=this._getOffset(c);return null===d?a:b?new Date(c+d):new Date(c-d)},NL.Timezone.prototype.browserToLocale=function(a){return this.offset(new Date(a.getTime()+1e3*60*a.getTimezoneOffset()),!0)},NL.Timezone.prototype.localeToBrowser=function(a){return this.offset(new Date(a.getTime()-1e3*60*a.getTimezoneOffset()),!1)},function(){var a={};NL.Timezone.prototype._load=function(b,c){try{if("undefined"==typeof window||"function"!=typeof window.XMLHttpRequest&&"function"!=typeof window.ActiveXObject)if("undefined"!=typeof application&&"function"==typeof application.getTimezoneJson){var d=application.getTimezoneJson(this.m_strName||"");this.m_vRange=JSON.parse(d)}else this.m_vRange=[];else a[b]?this.m_vRange=a[b]:c?(a[b]=c,this.m_vRange=c):this.m_vRange=this._fetchAsClient(b)}catch(e){this.m_vRange=[]}this.m_vRange.sort(function(a,b){return a.startDate-b.startDate})},NL.Timezone.prototype._fetchAsClient=function(b){var c,d=b||"__default__";if(window.XMLHttpRequest)c=new XMLHttpRequest;else if(window.ActiveXObject)try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){c=new ActiveXObject("Microsoft.XMLHTTP")}var f="/xtk/registerTimezone.jssp?name="+encodeURIComponent(b);if(c.open("GET",f,!1),c.send(),200!==c.status)throw c.statusText;var g=JSON.parse(c.responseText);return a[d]=g.data,g.data}}(),NL.Timezone.prototype.getName=function(){return this.m_strName},NL.Timezone.prototype.getRange=function(){return this.m_vRange},NL.session.setTimezone=function(a,b){return SO.isEmpty(a)?(NL.session.timezone=void 0,void 0):(NL.session.timezone=new NL.Timezone(a,b),void 0)};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.Timezone"),SO.Timezone=function(a,b){this._name=a,this._timezoneData=b},SO.Timezone.prototype._defaultOffset=6e4*-1*(new Date).getTimezoneOffset(),SO.Timezone.prototype._getOffset=function(a){for(var b=0;this._timezoneData.length>b&&a>=this._timezoneData[b].startDate+(this._timezoneData[b-1]&&this._timezoneData[b-1].offset||0);b++);return this._timezoneData[b-1].offset},SO.Timezone.prototype._applyOffset=function(a,b){return new Date(a.getTime()+b)},SO.Timezone.prototype.getName=function(){return this._name},SO.Timezone.prototype.UTCToTimezone=function(a){return this._applyOffset(a,this._getOffset(+a))},SO.Timezone.prototype.timezoneToUTC=function(a){return this._applyOffset(a,-1*this._getOffset(+a))};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.TimezoneManager"),function(){var a=function(a){for(var b=[],c=0;a.length>c;c++)if(Array.isArray(a[c]))for(var d=0;a[c][0]>d;d++)b=b.concat(a[c].slice(1));else b.push(a[c]);return b},b=function(a){if(1===a.length)return a;for(var b=a[0],c=a[1],d=1,e=[],f=2;a.length>f+1;f+=2)a[f]===b&&a[f+1]===c?d++:(e.push([d,b,c]),b=a[f],c=a[f+1],d=1);e.push([d,b,c]),a.length>f&&e.push(a[f]);for(var f=0;e.length>f;f++)if(Array.isArray(e[f])&&1===e[f][0]){var g=e[f].slice(1);e.splice(f,1);for(var h=0;g.length>h;h++)e.splice(f+h,0,g[h])}return e},c=function(a){if(!a.length)return 0;for(var b,c,d=a.length-1,e=a[d];d;)for(c=a[--d];b=c%e;c=e,e=b);return e};SO.TimezoneManager.encodeTimezone=function(a,d){for(var e={},f={sgcd:0,s:[],o:[],d:[],r:[]},g=0;d.length>g;g++){var h,i=f.o.indexOf(d[g].offset);if(-1===i&&(f.o.push(d[g].offset),i=f.o.length-1),0===g)f.s.push(d[g].startDate),h=0;else{var j=d[g].startDate-d[g-1].startDate;h=f.s.indexOf(j),-1===f.s.indexOf(j)&&(f.s.push(j),h=f.s.length-1)}f.r.push(i),f.d.push(h)}f.sgcd=c(f.s),f.d=b(f.d),f.r=b(f.r);for(var g=0;f.s.length>g;g++)f.s[g]=f.s[g]/f.sgcd;return e[a]=JSON.stringify(f),e};var d=function(b,c){var d=[];-1===c.indexOf("{")&&(c=SO.TimezoneManager._definitions[c]),c=JSON.parse(c),c.d=a(c.d),c.r=a(c.r);for(var e=0;c.r.length>e;e++){for(var f=0,g=0;e+1>g;g++)f+=c.s[c.d[g]];d.push({startDate:f*c.sgcd,offset:c.o[c.r[e]]})}return{name:b,data:d}};SO.TimezoneManager._currentTimezone=null,SO.TimezoneManager._definitions={},SO.TimezoneManager.setDefaultTimezone=function(a){SO.TimezoneManager._currentTimezone=SO.TimezoneManager._definitions[a]?SO.TimezoneManager.getTimezone(a):null},SO.TimezoneManager.getDefaultTimezone=function(){return SO.TimezoneManager._currentTimezone},SO.TimezoneManager.getTimezone=function(a){if(a&&a instanceof SO.Timezone)return a;var b;return SO.TimezoneManager._definitions[a]?(b=d(a,SO.TimezoneManager._definitions[a]),new SO.Timezone(a,b.data)):null},SO.TimezoneManager.registerTimezones=function(a){SO.Utils.extend(SO.TimezoneManager._definitions,a)},SO.TimezoneManager.getCommonTimezones=function(){return["Pacific/Samoa","Etc/GMT+11","Pacific/Honolulu","Etc/GMT+10","America/Anchorage","Etc/GMT+9","America/Los_Angeles","Etc/GMT+8","America/Phoenix","America/Chihuahua","America/Denver","Etc/GMT+7","America/Regina","America/Chicago","America/Mexico_City","Etc/GMT+6","America/Bogota","America/New_York","America/Indianapolis","Etc/GMT+5","America/Caracas","America/Asuncion","America/Cuiaba","America/La_Paz","America/Manaus","America/Halifax","America/Santiago","Etc/GMT+4","America/St_Johns","America/Sao_Paulo","America/Buenos_Aires","America/Godthab","America/Montevideo","Etc/GMT+3","Atlantic/South_Georgia","Etc/GMT+2","Atlantic/Cape_Verde","Atlantic/Azores","Etc/GMT+1","Africa/Casablanca","Europe/London","Africa/Monrovia","Atlantic/Reykjavik","GMT","Africa/Luanda","Europe/Berlin","Europe/Belgrade","Europe/Paris","Europe/Sarajevo","Etc/GMT-1","Asia/Amman","Europe/Athens","Asia/Beirut","Europe/Bucharest","Asia/Damascus","Africa/Harare","Europe/Helsinki","Asia/Jerusalem","Africa/Cairo","Africa/Windhoek","Etc/GMT-2","Asia/Baghdad","Asia/Riyadh","Europe/Moscow","Africa/Nairobi","Etc/GMT-3","Asia/Tehran","Asia/Muscat","Asia/Baku","Asia/Yerevan","Indian/Mauritius","Asia/Tbilisi","Etc/GMT-4","Asia/Kabul","Asia/Yekaterinburg","Asia/Karachi","Etc/GMT-5","Asia/Calcutta","Asia/Colombo","Asia/Katmandu","Asia/Dhaka","Asia/Novosibirsk","Etc/GMT-6","Asia/Rangoon","Asia/Bangkok","Asia/Krasnoyarsk","Etc/GMT-7","Asia/Irkutsk","Asia/Kuala_Lumpur","Asia/Ulan_Bator","Asia/Shanghai","Australia/Perth","Asia/Taipei","Etc/GMT-8","Asia/Tokyo","Asia/Seoul","Asia/Yakutsk","Etc/GMT-9","Australia/Adelaide","Australia/Darwin","Australia/Brisbane","Australia/Canberra","Pacific/Guam","Australia/Hobart","Asia/Vladivostok","Etc/GMT-10","Pacific/Guadalcanal","Etc/GMT-11","Pacific/Auckland","Pacific/Fiji","Etc/GMT-12","Pacific/Tongatapu","Etc/GMT-13"]}}();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";function AjaxHelper(a,b){this.options=a,null==this.options.url&&(this.options.url=window.location.protocol+"//"+window.location.host+"/nl/jsp/soaprouter.jsp"),null==this.options.async&&(this.options.async=!0),this.strParentId=b}AjaxHelper.prototype.load=function(){var a=document.getElementById(this.strParentId);if(null!=a){a.innerHTML="<"+a.tagName+"/>";var b=document.createElement("div");b.className="loading",b.style.width="48px",b.style.height="48px",a.appendChild(b)}var c=new NL.transport.SOAP({urn:this.options.urn,method:this.options.method,url:this.options.url}),d=[];d.boolean=function(a,b){c.writeBoolean(a,b)},d.byte=function(a,b){c.writeByte(a,b)},d.document=function(a,b){c.writeDocument(a,b)},d.double=function(a,b){c.writeDouble(a,b)},d.element=function(a,b){c.writeElement(a,b)},d.float=function(a,b){c.writeFloat(a,b)},d.int=function(a,b){c.writeInt(a,b)},d.short=function(a,b){c.writeShort(a,b)},d.string=function(a,b){c.writeString(a,b)};for(var e=0;this.options.fonctionParams.length>e;e++){var f=this.options.fonctionParams[e];d[f.type](f.name,f.value)}if(this.options.async){var g=this;c.start({onSuccess:function(a){g.onSoapRequestCompleted(a,null)},onError:function(a){g.onSoapRequestCompleted(null,a)}})}else c.execute(this.options.url),this.onSoapRequestCompleted(c,null)},AjaxHelper.prototype.onSoapRequestCompleted=function(a,b){if(null!==b&&"undefined"!==b)return $("<div></div>").soMessageBox({type:"error",message:b.message,details:b.details}),void 0;var c=null!=a._currentResponseElement?a.getNextElement():null;if(a.checkNoMoreArgs(),null!=this.strParentId&&this.options.renderFunction){var d=document.getElementById(this.strParentId);null!=d?(d.innerHTML="<"+d.tagName+"/>",d.appendChild(this.options.renderFunction(c,this))):alert(xtk_core.ajaxhelper_norendering(this.strParentId))}else this.options.renderFunction&&this.options.renderFunction(c,this)};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.HTMLUtils"),SO.OO.defineProtocol("Clonable",["clone"]),function(){function a(a){return SO.String.endsWith(a,"px")&&(a=a.substr(0,a.length-2)),Number(a)}SO.HTMLUtils.closestLiteralFontSize=function(a){var b={"xx-small":9,"x-small":9,small:13,medium:16,large:18,"x-large":24,"xx-large":32},c="medium",d=0;for(var e in b)if(b.hasOwnProperty(e)){if(!(a>=b[e])){d>b[e]-a&&(c=e);break}c=e,d=a-b[e]}return c},SO.HTMLUtils.intFromLiteralFontSize=function(a){var b={"xx-small":1,"x-small":2,small:3,medium:4,large:5,"x-large":6,"xx-large":7};return b.hasOwnProperty(a)?b[a]:4},SO.HTMLUtils.getFontSizeEquivalents=function(a){var b={px:16,em:1,"%":100,pt:12,literal:"medium"},c={"xx-small":9,"x-small":9,small:13,medium:16,large:18,"x-large":24,"xx-large":32};if("string"==typeof a&&""!==a){var d=new RegExp("^(([0-9]*)?((.?)([0-9]+))?)([a-z-%]+)$",""),e=d.exec(a);if(e){var f=parseFloat(e[1]),g=e[6];if(b.hasOwnProperty(g)&&"literal"!==g){var h=SO.HTMLUtils.closestLiteralFontSize(f*b.px/b[g]);return{type:g,px:f*b.px/b[g],em:f*b.em/b[g],"%":f*b["%"]/b[g],pt:f*b.pt/b[g],literal:h,literalInt:SO.HTMLUtils.intFromLiteralFontSize(h)}}if(c.hasOwnProperty(g))return{type:"literal",px:c[g],em:c[g]*b.em/b.px,"%":c[g]*b["%"]/b.px,pt:c[g]*b.pt/b.px,literal:g,literalInt:SO.HTMLUtils.intFromLiteralFontSize(g)}}}return null},SO.HTMLUtils.htmlEncode=function(a){return $("<div></div>").text(a).html()},SO.HTMLUtils.htmlDecode=function(a){return $("<div></div>").html(a).text()},SO.HTMLUtils.getMaxZIndex=function(a){var b,c,d,e;return a=a||$("body"),e=$("div,span",a),d=Math.max.apply(null,$.map(e,function(a){return b=$(a),c=b.css("position"),"absolute"===c||"fixed"===c?parseInt(b.css("z-index"),10)||1:void 0}))},SO.HTMLUtils.borderLeftWidth=function(b){return a(b.css("border-left-width"))},SO.HTMLUtils.borderTopWidth=function(b){return a(b.css("border-top-width"))},SO.HTMLUtils.borderRightWidth=function(b){return a(b.css("border-right-width"))},SO.HTMLUtils.borderBottomWidth=function(b){return a(b.css("border-bottom-width"))},SO.HTMLUtils.paddingLeft=function(b){return a(b.css("padding-left"))},SO.HTMLUtils.paddingTop=function(b){return a(b.css("padding-top"))},SO.HTMLUtils.paddingRight=function(b){return a(b.css("padding-right"))},SO.HTMLUtils.paddingBottom=function(b){return a(b.css("padding-bottom"))},SO.HTMLUtils.marginLeft=function(b){return a(b.css("margin-left"))},SO.HTMLUtils.marginTop=function(b){return a(b.css("margin-top"))},SO.HTMLUtils.marginRight=function(b){return a(b.css("margin-right"))},SO.HTMLUtils.marginBottom=function(b){return a(b.css("margin-bottom"))}}(),SO.ns("SO.DOMUtils"),function(){SO.DOMUtils.isDescendantOf=function(a,b){return 0!==$(a).parents().filter(b).length},SO.DOMUtils.eventPositionIsInside=function(a,b){var c=a.pageX,d=a.pageY,e=!1;return b.each(function(a,b){var f=$(b).offset(),g=f.left,h=f.top,i=g+$(b).outerWidth(!0),j=h+$(b).outerHeight(!0);return e=!(c>i||g>c||d>j||h>d),!e}),e}}();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.Color"),function(){function a(a,b,c){return{r:255*h(a,255),g:255*h(b,255),b:255*h(c,255)}}function b(a,b,c){a=h(a,255),b=h(b,255),c=h(c,255);var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),i=(f+g)/2;if(f===g)d=e=0;else{var j=f-g;switch(e=i>.5?j/(2-f-g):j/(f+g),f){case a:d=(b-c)/j+(c>b?6:0);break;case b:d=(c-a)/j+2;break;case c:d=(a-b)/j+4}d/=6}return{h:d,s:e,l:i}}function c(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+6*(b-a)*(2/3-c):a}var e,f,g;if(a=h(a,360),b=h(b,100),c=h(c,100),0===b)e=f=g=c;else{var i=.5>c?c*(1+b):c+b-c*b,j=2*c-i;e=d(j,i,a+1/3),f=d(j,i,a),g=d(j,i,a-1/3)}return{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*g)}}function d(a,b,c){a=h(a,255),b=h(b,255),c=h(c,255);var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),i=f,j=f-g;if(e=0===f?0:j/f,f===g)d=0;else{switch(f){case a:d=(b-c)/j+(c>b?6:0);break;case b:d=(c-a)/j+2;break;case c:d=(a-b)/j+4}d/=6}return{h:d,s:e,v:i}}function e(a,b,c){a=6*h(a,360),b=h(b,100),c=h(c,100);var d=Math.floor(a),e=a-d,f=c*(1-b),g=c*(1-e*b),i=c*(1-(1-e)*b),j=d%6,k=[c,g,f,f,i,c][j],l=[i,c,c,g,f,f][j],m=[f,f,i,c,c,g][j];return{r:Math.round(255*k),g:Math.round(255*l),b:Math.round(255*m)}}function f(a,b,c,d){var e=[l(Math.round(a).toString(16)),l(Math.round(b).toString(16)),l(Math.round(c).toString(16))];return d||e[0].charAt(0)!==e[0].charAt(1)||e[1].charAt(0)!==e[1].charAt(1)||e[2].charAt(0)!==e[2].charAt(1)?e.join(""):e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0)}function g(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b}function h(a,b){j(a)&&(a="100%");var c=k(a);return a=Math.min(b,Math.max(0,parseFloat(a))),c&&(a*=b/100),1e-6>Math.abs(a-b)?1:a>=1?a%b/parseFloat(b):a}function i(a){return parseInt(a,16)}function j(a){return"string"==typeof a&&-1!==a.indexOf(".")&&1===parseFloat(a)}function k(a){return"string"==typeof a&&-1!==a.indexOf("%")}function l(a){return 1===a.length?"0"+a:""+a}function m(a){return 1>=a&&(a=100*a+"%"),a}var n={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};SO.Color=function(a){if(this._valid=!1,this._format=!1,this._parse(a),!this._valid)throw new Error(a.toString()+" is not a valid color")},SO.Color.prototype._parse=function(b){(SO.isNundef(b)||""===b)&&(b="transparent");var d,f={r:0,g:0,b:0},g=!1,h=!1,i=b;"string"==typeof b&&(b=this._stringToColor(b)),"object"==typeof b&&(b instanceof SO.Color?(f=a(b._r,b._g,b._b),d=b._a,g=!0,h="rgb"):b.hasOwnProperty("r")&&b.hasOwnProperty("g")&&b.hasOwnProperty("b")?(f=a(b.r,b.g,b.b),g=!0,h="rgb"):b.hasOwnProperty("h")&&b.hasOwnProperty("s")&&b.hasOwnProperty("v")?(b.s=m(b.s),b.v=m(b.v),f=e(b.h,b.s,b.v),g=!0,h="hsv"):b.hasOwnProperty("h")&&b.hasOwnProperty("s")&&b.hasOwnProperty("l")&&(b.s=m(b.s),b.l=m(b.l),f=c(b.h,b.s,b.l),g=!0,h="hsl"),b.hasOwnProperty("a")&&(d=Math.round(100*Math.min(1,Math.max(b.a,0)))/100)),SO.assert(g,"Unable to parse color: "+i.toString()),this._valid=g,this._format=b&&b.format||h,this._r=Math.min(255,Math.max(f.r,0)),this._g=Math.min(255,Math.max(f.g,0)),this._b=Math.min(255,Math.max(f.b,0)),this._a=SO.isNumber(d)?d:1},SO.Color.prototype._stringToColor=function(a){var b=!1,c=function(){var a="[-\\+]?\\d+%?",b="[-\\+]?\\d*\\.\\d+%?",c="(?:"+b+")|(?:"+a+")",d="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?",e="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?";return{rgb:new RegExp("rgb"+d),rgba:new RegExp("rgba"+e),hsl:new RegExp("hsl"+d),hsla:new RegExp("hsla"+e),hsv:new RegExp("hsv"+d),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();if(n[a])a=n[a],b=!0;else if("transparent"===a)return{r:0,g:0,b:0,a:0};a=a.replace(/^[\s,#]+|\s+$/g,"").toLowerCase();var d;return(d=c.rgb.exec(a))?{r:d[1],g:d[2],b:d[3]}:(d=c.rgba.exec(a))?{r:d[1],g:d[2],b:d[3],a:d[4]}:(d=c.hsl.exec(a))?{h:d[1],s:d[2],l:d[3]}:(d=c.hsla.exec(a))?{h:d[1],s:d[2],l:d[3],a:d[4]}:(d=c.hsv.exec(a))?{h:d[1],s:d[2],v:d[3]}:(d=c.hex6.exec(a))?{r:i(d[1]),g:i(d[2]),b:i(d[3]),format:b?"name":"hex6"}:(d=c.hex3.exec(a))?{r:i(d[1]+""+d[1]),g:i(d[2]+""+d[2]),b:i(d[3]+""+d[3]),format:b?"name":"hex"}:!1},SO.Color.prototype.getRgb=function(){return{r:this._r,g:this._g,b:this._b,a:this._a}},SO.Color.prototype._toRgbString=function(){return 1===this._a?"rgb("+this._r+", "+this._g+", "+this._b+")":"rgba("+this._r+", "+this._g+", "+this._b+", "+this._a+")"},SO.Color.prototype._toHexString=function(a){return"#"+f(this._r,this._g,this._b,a)},SO.Color.prototype._toName=function(){return g(n)[this.toString("hex6")]||!1},SO.Color.prototype.getName=function(){return this._toName()},SO.Color.prototype.getFilter=function(a,b){var c=f(this._r,this._g,this._b,!0),d=c,e=Math.round(255*parseFloat(this._a)).toString(16),g=e,h=a&&a.gradientType?"GradientType = 1, ":"";if(b){var i=new SO.Color(b);d=i.toString("hex6"),g=Math.round(255*parseFloat(i._a)).toString(16)}return"progid:DXImageTransform.Microsoft.gradient("+h+"startColorstr=#"+l(e)+c+",endColorstr=#"+l(g)+d+")"},SO.Color.prototype.getHsl=function(){var a=b(this._r,this._g,this._b);return{h:a.h,s:a.s,l:a.l,a:this._a}},SO.Color.prototype._toHslString=function(){var a=b(this._r,this._g,this._b);return 1===this._a?"hsl("+Math.round(360*a.h)+", "+Math.round(100*a.s)+"%, "+Math.round(100*a.l)+"%)":"hsla("+Math.round(360*a.h)+", "+Math.round(100*a.s)+"%, "+Math.round(100*a.l)+"%, "+this._a+")"},SO.Color.prototype.getHsv=function(){var a=d(this._r,this._g,this._b);return{h:a.h,s:a.s,v:a.v,a:this._a}},SO.Color.prototype._toHsvString=function(){var a=d(this._r,this._g,this._b);return 1===this._a?"hsv("+Math.round(360*a.h)+", "+Math.round(100*a.s)+"%, "+Math.round(100*a.v)+"%)":"hsva("+Math.round(360*a.h)+", "+Math.round(100*a.s)+"%, "+Math.round(100*a.v)+"%, "+this._a+")"},SO.Color.prototype.toString=function(a){a=a||this._format;var b=!1;return"rgb"===a&&(b=this._toRgbString()),"hex"===a&&(b=this._toHexString()),"hex6"===a&&(b=this._toHexString(!0)),"name"===a&&(b=this._toName()),"hsl"===a&&(b=this._toHslString()),"hsv"===a&&(b=this._toHsvString()),b},SO.Color.prototype.format=function(a){return this.toString(a&&a.format)},SO.Color.prototype.setAlpha=function(a){this._a=Math.min(1,Math.max(a,0))},SO.Color.prototype.getAlpha=function(){return this._a},SO.Color.prototype.isEqual=function(a){return a=new SO.Color(a),this._toRgbString()===a._toRgbString()},SO.Color.prototype.clone=function(){return new SO.Color(this)},SO.Color.safeParse=function(a,b){b=SO.Utils.extend({},b);var c=" is not a valid SO.Color object.",d=new SO.Color;void 0!==b.defaultValue&&(d=SO.assert(SO.isColor(b.defaultValue),b.defaultValue+" is not a valid default Value.")?b.defaultValue:new SO.Color),a=SO.assert(SO.isString(a),a+c)?a:d;try{return new SO.Color(a)}catch(e){return SO.assert(null,a+c),d.clone()}},SO.Color.parse=function(a){if(""===a||null===a||void 0===a)return new SO.Color;var b=SO.isString(a);if(SO.assert(b),!b)throw new Error(a+" is not a string");return new SO.Color(a)},SO.Color.toString=function(a){return void 0!==a&&null!==a?a.toString():""},SO.Color.format=function(a,b){return SO.assert(SO.isColor(a),a+" is not a valid SO.Color object")?a.format(b):""}}();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("NL.CSS"),NL.CSS.Background=function(a,b,c,d){this._color=new SO.Color,this._image="none",this._position="",this._tiling="",1===arguments.length?"object"!=typeof a||a instanceof SO.Color?(a instanceof SO.Color||"string"==typeof a)&&this._setColor(a):this.getAttributesFrom(a):4===arguments.length&&(this._setColor(a),this._setImage(b),this._setPosition(c),this._setTiling(d))},NL.CSS.Background.prototype={_getColor:function(){return this._color},_setColor:function(a){a instanceof SO.Color&&(this._color=a),"string"==typeof a&&(this._color=new SO.Color(a))},_getImage:function(){return this._image},_setImage:function(a){this._image="object"==typeof a&&null!==a?a:null===a?"none":a},_getPosition:function(){return this._position},_setPosition:function(a){var b=/(\d+)% (\d+)%/.exec(a);if(b){var c,d,e=!1,f=!1;switch(b[1]){case"0":c="left",e=!0;break;case"50":c="center",e=!0;break;case"100":c="right",e=!0}switch(b[2]){case"0":d="top",f=!0;break;case"50":d="center",f=!0;break;case"100":d="bottom",f=!0}e&&f&&(this._position=c+" "+d)}else{var g=["left","right","top","bottom","center"],h=!0;SO.isEmpty(a)||($.each(a.split(" "),function(a,b){h=$.inArray(b,g)>-1}),this._position=h?a:null)}},_getTiling:function(){return this._tiling},_setTiling:function(a){if(-1!=a.search("repeat"))switch(a){case"repeat":this._tiling="both";break;case"repeat-y":this._tiling="vertical";break;case"repeat-x":this._tiling="horizontal";break;case"no-repeat":this._tiling="none"}else{var b=["horizontal","vertical","both","none"],c=!0;c=$.inArray(a,b)>-1,this._tiling=c?a:""}},get:function(a){switch(a){case"color":return this._getColor();case"image":return this._getImage();case"position":return this._getPosition();case"tiling":return this._getTiling()}},set:function(a,b){switch(a){case"color":this._setColor(b);break;case"image":this._setImage(b);break;case"position":this._setPosition(b);break;case"tiling":this._setTiling(b)}},getAttributesFrom:function(a){this._setColor(a.css("background-color")),this._setImage(a.css("background-image")),this._setPosition(a.css("background-position")),this._setTiling(a.css("background-repeat"))},applyAttributesTo:function(a){if(null!==a){a.css("background-color",this._color.toString("rgb")),"none"!==this._image&&a.css("background-image","url('"+this._image+"')"),a.css("background-position",this._position);var b;switch(this._tiling){case"both":b="repeat";break;case"vertical":b="repeat-y";break;case"horizontal":b="repeat-x";break;case"none":b="no-repeat"}a.css("background-repeat",b)}},clone:function(){return new NL.CSS.Background(this._color,this._image,this._position,this._tiling)},isEqual:function(a){return SO.Utils.isEqual(this._color,a._color)&&SO.Utils.isEqual(this._image,a._image)&&SO.Utils.isEqual(this._position,a._position)&&SO.Utils.isEqual(this._tiling,a._tiling)}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("NL.CSS"),NL.CSS.Border=function(a,b,c){this._borderColor=new SO.Color("rgba (0, 0, 0, 0)"),this._borderWidth=0,this._borderStyle="none",1===arguments.length?"object"==typeof a&&this.getAttributesFrom(a):3===arguments.length&&(this.set("borderColor",c),this.set("borderWidth",a),this.set("borderStyle",b))},NL.CSS.Border.prototype={_getBorderColor:function(){return this._borderColor},_setBorderColor:function(a){a instanceof SO.Color&&(this._borderColor=a),"string"==typeof a&&(this._borderColor=new SO.Color(a))},_getBorderWidth:function(){return this._borderWidth},_setBorderWidth:function(a){this._borderWidth="string"==typeof a?parseInt(a.replace("px",""),10):parseInt(a,10)},_getBorderStyle:function(){return this._borderStyle},_setBorderStyle:function(a){var b=["none","solid","dotted","dashed","double","groove","ridge","inset","outset"];this._borderStyle=$.inArray(a,b)>-1?a:null},get:function(a){switch(a){case"borderColor":return this._getBorderColor();case"borderWidth":return this._getBorderWidth();case"borderStyle":return this._getBorderStyle()}},set:function(a,b){switch(a){case"borderColor":this._setBorderColor(b);break;case"borderWidth":this._setBorderWidth(b);break;case"borderStyle":this._setBorderStyle(b)}},_getComputedStyle:function(a){return document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(a,null):"undefined"!=typeof document.body.currentStyle?a.currentStyle:void 0},getAttributesFrom:function(a){var b=this._getComputedStyle(a[0]),c=""!==b.borderLeftStyle?b.borderLeftStyle:"none";this._borderColor=new SO.Color(b.borderLeftColor);var d=b.borderLeftWidth.replace("px","");switch(d){case"thin":this._borderWidth=1;break;case"medium":this._borderWidth=3;break;case"thick":this._borderWidth=5;break;default:this._borderWidth=parseInt(d,10)}this._borderStyle=c},applyAttributesTo:function(a){var b=["left","top","right","bottom"],c=this;SO.Utils.each(b,function(b,d){a.css("border-"+d+"-color",c._borderColor.toString("rgb")),a.css("border-"+d+"-width",c._borderWidth+"px"),a.css("border-"+d+"-style",c._borderStyle)})},toCssString:function(){return null!==this._borderColor&&null!==this._borderWidth&&null!==this._borderStyle&&null!==this._borderColor.toString("hex")?this._borderWidth+"px "+this._borderColor.toString("hex")+" "+this._borderStyle:null},clone:function(){return new NL.CSS.Border(this._borderWidth,this._borderStyle,this._borderColor)},isEqual:function(a){return SO.Utils.isEqual(this._borderColor,a._borderColor)&&this._borderStyle===a._borderStyle&&this._borderWidth===a._borderWidth}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("NL.CSS"),NL.CSS.Geometry=function(a,b,c,d){this._top=0,this._left=0,this._width=0,this._height=0,1===arguments.length?"object"==typeof a&&this.getAttributesFrom(a):4===arguments.length&&(this.set("width",c),this.set("height",d),this.set("top",a),this.set("left",b))},NL.CSS.Geometry.prototype={set:function(a,b){switch("string"==typeof b&&"auto"!==b.toLowerCase()&&(b=parseInt(b.replace("px",""),10)||0),a){case"width":this._setWidth(b);break;case"height":this._setHeight(b);break;case"top":this._setTop(b);break;case"left":this._setLeft(b)}},get:function(a){switch(a){case"width":return this._getWidth();case"height":return this._getHeight();case"top":return this._getTop();case"left":return this._getLeft()}},_getWidth:function(){return this._width},_getHeight:function(){return this._height},_getLeft:function(){return this._left},_getTop:function(){return this._top},_setWidth:function(a){this._width=a},_setHeight:function(a){this._height=a},_setLeft:function(a){this._left=a},_setTop:function(a){this._top=a},getAttributesFrom:function(a){this.set("width",a.css("width")),this.set("height",a.css("height")),this.set("left",a.css("left")),this.set("top",a.css("top"))},applyAttributesTo:function(a){null!==a&&(this._top>0||this._left>0?a.css("position","relative"):a.css("position","static"),a.css("width",this._width+"px"),a.css("height",this._height+"px"),a.css("left",this._left+"px"),a.css("top",this._top+"px"))},clone:function(){return new NL.CSS.Geometry(this._top,this._left,this._width,this._height)},isEqual:function(a){return this._top===a._top&&this._left===a._left&&this._width===a._width&&this._height===a._height}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.DOM"),NL.DOM.create=function(){var a,b,c={tag:null,clazz:void 0,text:void 0,attr:{},children:[]};b="string"==typeof arguments[0]?SO.Utils.extend({},c,{tag:arguments[0]},arguments[1]):SO.Utils.extend({},c,arguments[0]);var d=b.tag,e=b.clazz||b["class"],f=b.text,g=b.attr,h=b.children;if(null===d)throw new Error("Invalid tag name.");return a=document.createElement(d),void 0!==f&&a.appendChild(document.createTextNode(f)),void 0!==e&&(a.className=e),NL.DOM._setAttributes(a,g),h.length&&a.appendChild(NL.DOM._createFragment(h)),a},NL.DOM.$create=function(){return $(NL.DOM.create.apply(null,arguments))},NL.DOM._createFragment=function(a){for(var b=document.createDocumentFragment(),c=0,d=a.length;d>c;c++)b.appendChild(NL.DOM.create(a[c]));return b},NL.DOM._setAttributes=function(a,b){for(var c in b)b.hasOwnProperty(c)&&a.setAttribute(c,b[c])};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.Stack"),NL.Stack=function(){this._stack=[]},NL.Stack.prototype.isEmpty=function(){return 0===this._stack.length},NL.Stack.prototype.peek=function(){return this._stack[this._stack.length-1]},NL.Stack.prototype.pop=function(){return this._stack.pop()},NL.Stack.prototype.push=function(a){"undefined"!=typeof a&&this._stack.push(a)};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.Queue"),NL.Queue=function(){this._queue=[]},NL.Queue.prototype.push=function(a){this._queue.push(a)},NL.Queue.prototype.remove=function(){return this._queue.shift()},NL.Queue.prototype.peek=function(){return this._queue[0]};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.widget.Calendar"),NL.widget.Calendar.getFormat=function(a){return void 0===a&&(a=NL.session.locale.getSettings().shortDate),a=a.replace(/%D/,"%e"),a=a.replace(/%2D/,"%d"),a=a.replace(/%M/,"%m"),a=a.replace(/%2M/,"%m"),a=a.replace(/%Y/,"%y"),a=a.replace(/%2Y/,"%y"),a=a.replace(/%4Y/,"%Y")};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.MetaDataService"),NL.MetaDataService=function(a,b){var c,d=this;this._parent=a,this._cache={},this._cacheIsBusy=!1,this._dataSourceType=b&&void 0!==b.dataSourceType&&"metadata"===b.dataSourceType?"metadata":"point",b&&b.dataURL&&(c=new NL.DataSource.Rest({url:b.dataURL}),this._cacheIsBusy=!0,c.get(null,null,{onError:function(a){var b,c;b={type:"error",message:SO.isString(a.message)?a.message:a},SO.isString(a.details)&&b.message!==a.details&&(b.details=a.details),c=new SO.Widgets.MessageBox($("<div></div>"),b)},onSuccess:function(a){d._parseCacheData(a,SO.Utils.getValueFromObj(b,"prefixe","")),d._cacheIsBusy=!1}}))},NL.MetaDataService.prototype._parseCacheData=function(a,b){var c,d;if(a&&a.metadata)for(c in a.metadata)a.metadata.hasOwnProperty(c)&&(d=a.metadata[c],d.content&&this._addDatas(d.content,b))},NL.MetaDataService.prototype._addDatas=function(a,b){var c,d,e;for(c in a)a.hasOwnProperty(c)&&(e=a[c],d=SO.String.toIdentifier(b+c),this._addData(d,e.content))},NL.MetaDataService.prototype._addData=function(a,b){this._cache[a]=SO.Utils.extend(!0,{},b)},NL.MetaDataService.prototype._getResourceMetadata=function(a,b,c){var d,e=this,f=this._computeResourceURL(a,b),g=SO.String.toIdentifier(f),h=!this._isAbsolute(a);if(a&&h)this.get(b,null,function(b){if(SO.isPlainObject(b)){var f=a.split("/"),h=f.splice(-1,1);if(0===f.length)d=e._getMetadataFromJpath(b.content,new SO.Structure.Jpath(h[0]));else{var i=e._getMetadataFromJpath(b.content,new SO.Structure.Jpath(f.join("/")));d=i.content.subMetadata?e._getMetadataFromJpath(i.content.subMetadata.content,new SO.Structure.Jpath(h[0])):e._getMetadataFromJpath(i.content,new SO.Structure.Jpath(h[0]))}e._addData(g,d),c(d)}else c(null)});else{var i,j=f;NL.session.__securitytoken&&(j+="/?__securitytoken="+NL.session.__securitytoken),"metadata"===this._dataSourceType?i=new NL.DataSource.ResourceWalker({url:j,metadataUrl:!0}):(j=this._patchURL(f),j="/rest"+j,i=new NL.DataSource.PointSource({url:j})),i.get(null,null,{onSuccess:function(a){e._addData(g,a),c(a)},onError:function(){c(null)}})}},NL.MetaDataService.prototype._getMetadataFromJpath=function(a,b){for(var c=b.getPartsCount(),d=[],e=0;c>e;e++)d.push(b.getItem(e).key);return d.reduce(function(a,b,d){return a[b]&&"link"===a[b].resType?a[b]:a[b].content&&c-1>d?a[b].content:a[b]},a)},NL.MetaDataService.prototype._patchURL=function(a){var b=a.split("/");return b.splice(2,0,"resourceType"),b.join("/")},NL.MetaDataService.prototype._isAbsolute=function(a){return a&&"/"===a[0]},NL.MetaDataService.prototype._computeResourceURL=function(a,b){var c="";return a?this._isAbsolute(a)?c=a:b&&this._isAbsolute(b)&&(c=b+"/"+a):b&&(c=b),c},NL.MetaDataService.prototype.get=function(a,b,c){var d=this;if(2===arguments.length&&"function"==typeof arguments[1]&&(c=b,b=void 0),this._cacheIsBusy===!0)return setTimeout(function(){d.get(a,b,c)},100),void 0;var e=this._computeResourceURL(a,b),f=SO.String.toIdentifier(e);this._cache[f]?c(this._cache[f]):this._parent?this._parent.get(a,b,c):this._getResourceMetadata(a,b,c)},NL.MetaDataService.prototype._filterMetaData=function(a,b){for(var c,d=!0,e=0;b.length>e&&d;e++)switch(c=b[e],c.wildcard){case"$query":d=!a.unbound;break;case"$write":d=!a.readOnly;break;case"$bulkwrite":d=!a.readOnly&&"link"!==a.type;break;case"$link":d="link"===a.type}return d};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.DataSource"),NL.DataSource.Common=function(a){this.parallel=SO.Utils.getValueFromObj(a,"parallel",!1),this.settings=a,this._pagination={},this._capabilities={searchable:!1,realTime:!1,sortable:!1,getOneElement:!1},this._dataFormat="typed",this._lastTransportId=null,this._currentTransportObject={}},NL.DataSource.Common.prototype.getCapabilities=function(){return{searchable:this._capabilities.searchable,realTime:this._capabilities.realTime,sortable:this._capabilities.sortable,getOneElement:this._capabilities.getOneElement}},NL.DataSource.Common.prototype.getDataFormat=function(){return this._dataFormat},NL.DataSource.Common.prototype._start=function(a,b,c){var d,e;return SO.isNundef(a)?e=null:(d=this,this.parallel===!1&&SO.Utils.count(this._currentTransportObject)>1&&SO.Utils.each(this._currentTransportObject,function(a,b){b.cancel()}),a.start(c),this._currentTransportObject[b]=a,this._lastTransportId=b,e=b),e},NL.DataSource.Common.prototype.get=function(){SO.assert(!1,"Must be implemented")},NL.DataSource.Common.prototype.cancel=function(a){void 0===a&&(a=this._lastTransportId),this._currentTransportObject.hasOwnProperty(a)&&!SO.isNundef(this._currentTransportObject[a])&&(this._currentTransportObject[a].cancel(),delete this._currentTransportObject[a])},NL.DataSource.Common.prototype._transportOnSuccess=function(a,b,c,d,e,f){var g,h;a instanceof NL.transport.SOAP?(h=a.getNextElement(),a.checkNoMoreArgs()):h=a,g=this.formatOnSuccess(h,d,e,f),b(g)},NL.DataSource.Common.prototype._transportOnError=function(a,b){b(a)},NL.DataSource.Common.prototype._transportOnComplete=function(a,b){b&&b(),this._currentTransportObject.hasOwnProperty(a)&&delete this._currentTransportObject[a]},NL.DataSource.Common.prototype.formatOnSuccess=function(a){return a},NL.DataSource.Common.prototype._replaceConditionWildcards=function(a,b){return SO.Utils.each(b,function(b,c){var d,e,f,g;f=c.wildcard,e=c.value,d=a.expr,d&&-1!==d.indexOf(f)&&(a.expr=d.split(f).join(NL.XTK.escapeForLikeCond(e))),g=a.enabledIf,g&&-1!==g.indexOf(f)&&(a.enabledIf=g.split(f).join(NL.XTK.escape(e)))}),b},NL.DataSource.Common.prototype.isAutoPk=function(){return SO.Utils.getValueFromObj(this.settings,"autoPk",!1)},NL.DataSource.Common.prototype.setSetting=function(a,b){this.settings[a]=b},NL.DataSource.Common.prototype.prepareFromNode=function(){},NL.DataSource.Common.prototype.hasChildren=function(){return!1},NL.DataSource.Collection=function(a){NL.DataSource.Collection.baseConstructor.apply(this,[a])},SO.OO.extend(NL.DataSource.Collection,NL.DataSource.Common),NL.DataSource.Collection.prototype.get=function(a,b,c,d,e,f,g){this._pagination.start=a,this._pagination.lineCount=b,this._nextUrl=null,this._countUrl=null,this._countValue=null;var h=this._getTransportObject(f,g);return this.start(h,c,d,f,g)},NL.DataSource.Collection.prototype.getNext=function(a){var b=this._getTransportObject();return this.start(b,a)},NL.DataSource.Collection.prototype.hasNext=function(){return SO.isString(this._nextUrl)},NL.DataSource.Collection.prototype.getCount=function(a){if(!this.hasCount())return a.onError("This dataSource is not countable"),!1;if(SO.isNumber(this._countValue))return a.onSuccess({count:this._countValue}),a.onComplete(),!0;var b=new SO.Structure.URL(this._countUrl).toString(),c=new NL.transport.REST({url:b,method:"GET"});return this.start(c,a)},NL.DataSource.Collection.prototype.hasCount=function(){return SO.isString(this._countUrl)||SO.isNumber(this._countValue)},NL.DataSource.Collection.prototype.start=function(a,b,c,d,e){var f,g,h,i;return i={onSuccess:function(){},onError:function(){},onComplete:function(){}},g="data-source-collection-transport-"+SO.Utils.sequence().nextVal(),f=this,b=SO.Utils.extend(i,b),h={onSuccess:function(a){f._transportOnSuccess(a,b.onSuccess,void 0,c,d,e)},onError:function(a){f._transportOnError(a,b.onError)},onComplete:function(){f._transportOnComplete(g,b.onComplete)},loaderOff:SO.Utils.getValueFromObj(b,"loaderOff",!0)},this._start(a,g,h)},NL.DataSource.Timeline=function(a){NL.DataSource.Timeline.baseConstructor.apply(this,[a])},SO.OO.extend(NL.DataSource.Timeline,NL.DataSource.Common),NL.DataSource.Timeline.prototype.get=function(a,b,c,d,e,f,g){this._startDate=a,this._endDate=b;var h=this._getTransportObject(f,g);return this.start(h,c,f,g)},NL.DataSource.Timeline.prototype.start=function(a,b,c,d){var e,f,g,h;return h={onSuccess:function(){},onError:function(){},onComplete:function(){}},f="data-source-timeline-transport-"+SO.Utils.sequence().nextVal(),b=SO.Utils.extend(h,b),e=this,g={onSuccess:function(a){e._transportOnSuccess(a,b.onSuccess,void 0,c,d)},onError:function(a){e._transportOnError(a,b.onError)},onComplete:function(){e._transportOnComplete(f,b.onComplete)},loaderOff:SO.Utils.getValueFromObj(b,"loaderOff",!0)},this._start(a,f,g)},NL.DataSource.Soap=function(a){NL.DataSource.Soap.baseConstructor.apply(this,[a]),this.settings=$.extend({},{url:"/",encoding:"http://schemas.xmlsoap.org/soap/encoding/",schema:null,method:null,beforeSend:function(){},dataFilter:function(){}},a),this._params={},this._capabilities.searchable=!0},SO.OO.extend(NL.DataSource.Soap,NL.DataSource.Collection),NL.DataSource.Soap.prototype._getTransportObject=function(){var a,b;return b=new NL.transport.SOAP({urn:this.settings.schema,method:this.settings.method,nsEncoding:this.settings.encoding}),this.settings.params&&(this._params=$.extend(!0,this._params,this.settings.params)),a=this.settings.beforeSend(b,this._params),a===!1?(this._transportOnComplete(),void 0):b},NL.DataSource.Soap.prototype.formatOnSuccess=function(a){var b=a;return this.settings.dataFilter&&(b=this.settings.dataFilter(a)),b},NL.DataSource.Rest=function(a){NL.DataSource.Rest.baseConstructor.apply(this,[a]),this.settings=$.extend({},{url:"/",filterNames:[]},a),this._dataFormat="json",this._returnRaw=SO.Utils.getValueFromObj(a,"returnRaw",!1),this._capabilities.searchable=!0,this._capabilities.sortable=!0},SO.OO.extend(NL.DataSource.Rest,NL.DataSource.Collection),NL.DataSource.Rest.prototype.setURL=function(a){this.settings.url=a},NL.DataSource.Rest.prototype.getURL=function(){return this.settings.url},NL.DataSource.Rest.prototype._getTransportObject=function(a,b){if(this.hasNext())var c=new SO.Structure.URL(this._nextUrl);else{var d=SO.String.removeSuffix(this.settings.url,"/");SO.String.startsWith(d,"/rest")||(d="/rest"+d);for(var e=0;this.settings.filterNames.length>e;e++)d+="/"+this.settings.filterNames[e];for(var c=new SO.Structure.URL(d),f=a&&a.filters?a.filters:[],e=0;f.length>e;e++){var g=f[e],h=g.wildcard,i=g.value;c.query(h,i)}if(this._pagination.start&&c.query("_lineStart",this._pagination.start),this._pagination.lineCount&&c.query("_lineCount",this._pagination.lineCount),b&&b.sorts&&b.sorts.length>0){for(var j="",e=0;b.sorts.length>e;e++)e>0&&(j+=","),j+=b.sorts[e].expr,b.sorts[e].desc&&(j+=" desc");c.query("_order",j)}}var k=new NL.transport.REST({url:c.toString(),method:"GET"});return k},NL.DataSource.Rest.prototype.formatOnSuccess=function(a){var b=a;return this._returnRaw===!1&&a.content&&(b=Array.isArray(a.content)?a.content:this._formatUnorderedCollection(a.content),this._nextUrl=a.hasOwnProperty("next")&&a.next.hasOwnProperty("href")?a.next.href:null,a.hasOwnProperty("count")?a.count.hasOwnProperty("href")?this._countUrl=a.count.href:a.count.hasOwnProperty("value")&&(this._countValue=parseInt(a.count.value,10)):(this._countUrl=null,this._countValue=null)),b},NL.DataSource.Rest.prototype._formatUnorderedCollection=function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(a[b]);return c},NL.DataSource.RestTimeline=function(a){NL.DataSource.RestTimeline.baseConstructor.apply(this,[a]),this.settings=$.extend({},{url:"/",filterNames:[]},a),this._dataFormat="json",this._capabilities.searchable=!0},SO.OO.extend(NL.DataSource.RestTimeline,NL.DataSource.Timeline),NL.DataSource.RestTimeline.prototype._getTransportObject=function(a){var b,c,d,e,f,g,h,i=SO.String.removeSuffix(this.settings.url,"/");for(b=0;this.settings.filterNames.length>b;b++)i+="/"+this.settings.filterNames[b];for(SO.String.startsWith(i,"/rest")||(i="/rest"+i),c=new SO.Structure.URL(i),c.query("_lineCount",500),f=a&&a.filters?a.filters:[],b=0;f.length>b;b++)e=f[b],g=e.wildcard,d=e.value,c.query(g,d);return h=new NL.transport.REST({url:c.toString(),method:"GET"})},NL.DataSource.RestTimeline.prototype.formatOnSuccess=function(a){var b=a.content;return b},NL.DataSource.FunctionsList=function(a){NL.DataSource.FunctionsList.baseConstructor.apply(this,[a])},SO.OO.extend(NL.DataSource.FunctionsList,NL.DataSource.Rest),NL.DataSource.FunctionsList.prototype.formatOnSuccess=function(a){var b=[];return SO.Utils.each(a.group,function(a,c){var d=[];SO.Utils.each(c.function,function(a,b){d.push({id:b.PKey,label:""+b.name+b.args,output:""+b.name+b.args,help:b.help,apiName:b.name})}),b.push({id:c.PKey,label:c.label,selectable:!1,_children_:d,apiName:c.name})}),b};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";NL.DataSource.QueryDef=function(a){NL.DataSource.QueryDef.baseConstructor.apply(this,[a]),this.settings=$.extend({},{operation:"select",lineCount:10,firstRows:!0,search:{attributes:[],wildcard:"$1",caseSensitive:!1},select:{node:[]},where:{condition:[]},orderBy:{node:[]},conditionLinks:[],autoPk:!0},a),$.each(this.settings.select.node,function(a,b){if(b&&b.expr&&"string"!=typeof b.expr)throw"No expression was set on some select nodes"}),this._capabilities.searchable=!0,this._capabilities.sortable=!0},SO.OO.extend(NL.DataSource.QueryDef,NL.DataSource.Collection),NL.DataSource.QueryDef.prototype._transportOnError=function(a,b){"abort"!==a.jqStatus&&NL.DataSource.QueryDef.superClass._transportOnError.apply(this,[a,b])},NL.DataSource.QueryDef.prototype._newSearchWhereCondition=function(a,b,c){b||(b="$1");var d,e,f,g="";for(d=0;a.length>d;d++)f=a[d],d>0&&(g+=" or "),g+=c?f+" like '%"+b+"%'":"Lower ("+f+") like '%' + Lower('"+b+"') + '%'";return e="'"+b+"'"+" != ''",{expr:g,enabledIf:e}},NL.DataSource.QueryDef.prototype._getTransportObject=function(a,b){var c,d,e,f,g,h,f=a?a.filters:[],d=b?b.sorts:[];return g=$.extend(!0,{},this.settings),c=this,g.operation=this.settings.count?"count":"select",e=g.search,e.attributes.length>0&&(g.where||(g.where={condition:[]}),g.where.condition.push(this._newSearchWhereCondition(e.attributes,e.wildcard,e.caseSensitive))),g.where&&f.length>0&&SO.Utils.each(g.where.condition,function(a,b){f=c._replaceConditionWildcards(b,f)}),g.orderBy||(g.orderBy={node:[]}),this.settings.count||(d&&d.length>0&&(g.orderBy.node=[],$.each(d,function(a,b){g.orderBy.node.push({expr:b.expr,sortDesc:!!b.desc})})),this._pagination&&(SO.isNundef(this._pagination.start)||(g.startLine=this._pagination.start),this._pagination.lineCount&&(g.lineCount=this._pagination.lineCount))),h={url:"/xtk/queryList.jssp",type:"POST",data:{queryDef:encodeURIComponent(JSON.stringify(g))}},new NL.transport.AJAX(h)},NL.DataSource.QueryDef.prototype._replaceConditionWildcards=function(a,b){var c,d,e=this;return b=NL.DataSource.QueryDef.superClass._replaceConditionWildcards.apply(this,[a,b]),c=a.subQuery,c&&SO.Utils.each(c.whereExpr,function(a,c){b=e._replaceConditionWildcards(c,b)}),d=a.subWhereExpr,d&&d.length>0&&SO.Utils.each(d,function(a,c){b=e._replaceConditionWildcards(c,b)}),b},NL.DataSource.QueryDef.prototype.formatOnSuccess=function(a){return a.data},NL.DataSource.LogFile=function(a){NL.DataSource.LogFile.baseConstructor.apply(this,[a]),this.settings=$.extend({},{schema:"nl:monitoring",method:"GetLogFileContent",beforeSend:function(a,b){a.addParameter("process","string",b.process),a.addParameter("filterType","string",b.filterType),a.addParameter("filterValue","string",b.filterValue),a.addParameter("sortValue","string",b.sortValue),a.addParameter("startDateTime","string",b.startDateTime),a.addParameter("endDateTime","string",b.endDateTime),a.addParameter("startLine","int",b.startLine),a.addParameter("maxLineCount","int",b.maxLineCount)}},a),this._capabilities.searchable=!0,this._capabilities.sortable=!0},SO.OO.extend(NL.DataSource.LogFile,NL.DataSource.Soap),NL.DataSource.LogFile.prototype.get=function(a,b,c,d,e,f,g){var h,i,j=f?f.filters:[],k=g?g.sorts:[];0==a&&this._setStartLine(0);for(h in j)if(j.hasOwnProperty(h))switch(j[h].wildcard){case"$startDateTime":i=this._startDateWidgetValue2DateTime(j[h].value),this._setStartDate(i);break;case"$endDateTime":i=this._endDateWidgetValue2DateTime(j[h].value),this._setEndDate(i);break;case"$process":this._setProcess(j[h].value);break;case"$type":this._setType(j[h].value);break;case"$maxlinecount":this._setMaxLineCount(j[h].value);break;default:this._setFilterValue(j[h].value)}k&&k[0]&&"date"==k[0].expr&&this._setSortValue(k[0].name);var l=this._getTransportObject(j,k);return this.start(l,c)},NL.DataSource.LogFile.prototype._startDateWidgetValue2DateTime=function(a){SO.assert(!SO.isNundef(a));var b=SO.Date.newUTCDateTime(a.year,a.month,a.day,0,0,0);return NL.Locale.formatDateTime(b,SO.Date.ISO8601.dateTime)},NL.DataSource.LogFile.prototype._endDateWidgetValue2DateTime=function(a){SO.assert(!SO.isNundef(a));var b=SO.Date.newUTCDateTime(a.year,a.month,a.day,23,59,59);return NL.Locale.formatDateTime(b,SO.Date.ISO8601.dateTime)},NL.DataSource.LogFile.prototype._transportOnSuccess=function(a,b){var c,d;d=a.getNextString(),a.checkNoMoreArgs(),c=JSON.parse(d),this._setStartLine(c.startLine),b(c.content)},NL.DataSource.LogFile.prototype._setStartLine=function(a){this.settings.params.startLine=a},NL.DataSource.LogFile.prototype._setMaxLineCount=function(a){this.settings.params.maxLineCount=parseInt(a)+1},NL.DataSource.LogFile.prototype._setFilterValue=function(a){a!==this.settings.params.filterValue&&this._setStartLine(0),this.settings.params.filterValue=a},NL.DataSource.LogFile.prototype._setStartDate=function(a){a!==this.settings.params.startDateTime&&this._setStartLine(0),this.settings.params.startDateTime=a},NL.DataSource.LogFile.prototype._setEndDate=function(a){a!==this.settings.params.endDateTime&&this._setStartLine(0),this.settings.params.endDateTime=a},NL.DataSource.LogFile.prototype._setSortValue=function(a){a!==this.settings.params.sortValue&&this._setStartLine(0),this.settings.params.sortValue=a},NL.DataSource.LogFile.prototype._setProcess=function(a){a!==this.settings.params.process&&this._setStartLine(0),this.settings.params.process=a},NL.DataSource.LogFile.prototype._setType=function(a){a!==this.settings.params.filterType&&this._setStartLine(0),this.settings.params.filterType=a};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";NL.DataSource.Folder=function(a){NL.DataSource.Folder.baseConstructor.apply(this,[a]);var b=this;this.settings=$.extend({},{url:NL.session.serverURL+"/nl/jsp/soaprouter.jsp",encoding:"http://schemas.xmlsoap.org/soap/encoding/",filter:null,hasWriteAccess:!1,enable:!0,beforeSend:function(a,c){a.writeString("parentKey",SO.Utils.getValueFromObj(c,"parentKey")),a.writeString("folderFilter",b.settings.filter),a.writeBoolean("writeAccess",b.settings.hasWriteAccess),a.writeString("fullName",""),a.writeBoolean("sort",SO.Utils.getValueFromObj(b.settings,"sort",!1))}},a),this.settings.method="LoadChildren",this.settings.schema="xtk:folder"},SO.OO.extend(NL.DataSource.Folder,NL.DataSource.Soap),NL.DataSource.Folder.prototype.formatOnSuccess=function(a,b){var c=[],d=this;return $(a).children().each(function(){var a,b,e;a=$(this),b="/xtk/img/folder.png",SO.isEmpty(a.attr("image-name"))||(b="/"+a.attr("image-namespace")+"/img/"+a.attr("image-name")),e={id:a.attr("id"),label:a.attr("label"),fullName:a.attr("fullName"),icon:b,leaf:0===NL.Locale.parseInt(a.attr("childcount"),0),xml:this},e.disabled=$.isFunction(d.settings.enable)?!d.settings.enable.apply(e.xml):!d.settings.enable,NL.XTK.parseBoolean(a.attr("_shared"),!1)&&(e.label+=xtk_core.navtreeSharedFolder()),c.push(e)}),c=this._formatFolder(c,b)},NL.DataSource.Folder.prototype._formatFolder=function(a,b){var c,d,e,f;for(d=[],c=0;a.length>c;c++)e=SO.Utils.extend(!0,{},a[c]),f={name:e.id,id:e.id,nodePath:"/"+e.id,fullLabel:e.fullName.substring(0,e.fullName.lastIndexOf("/")),label:e.label,disabled:e.disabled,img:e.icon,selectable:!e.disabled},null!==b&&(f.nodePath=b+"/"+e.id),e.leaf===!1&&(f.children={folder:e.id}),d.push(f);return d},NL.DataSource.Folder.prototype.prepareFromNode=function(a){null!==SO.Utils.getValueFromObj(a,["folder"],null)&&this.setSetting("params",{parentKey:a.folder})},NL.DataSource.Folder.prototype.hasChildren=function(a){return!SO.isNundef(SO.Utils.getValueFromObj(a,["children","folder"],null))},NL.DataSource.SchemaWalker=function(a){NL.DataSource.SchemaWalker.baseConstructor.apply(this,[a]),this.storedResults={},this.linkedResults={};var b=void 0===a?{}:a;this.schemaName=b.schemaName?b.schemaName:"nms:recipient",this.originalSchemaName=this.schemaName,this.customFilters=a.customFilters,this._displaySchemaRootNode=SO.Utils.getValueFromObj(a,"displaySchemaRootNode",!0),this._capabilities.searchable=!0,this._capabilities.getOneElement=!0,this._withAdvancedField=SO.Utils.getValueFromObj(a,"getSchemaAdvancedFields",!1),this._fieldFilterCondition=SO.Utils.getValueFromObj(a,"schemaFieldsFilter",{unbound:!0}),this._oneElementRequest=0},SO.OO.extend(NL.DataSource.SchemaWalker,NL.DataSource.Collection),NL.DataSource.SchemaWalker.prototype.addLinkedResults=function(a,b){this.linkedResults[a]={data:b}},NL.DataSource.SchemaWalker.prototype.refresh=function(a,b){var c=this;this.storedResults={},$.each(this.storedResults,function(d){c.storedResults[d]=null,c.schemaName=d,c.get(a,b)})},NL.DataSource.SchemaWalker.prototype.findNodeByNodePath=function(a){var b,c,d,e,f,g,h,i,j,k,l=[];if(e=this,this.storedResults[this.schemaName]){for(d=this.storedResults[this.schemaName].data,-1!==a.indexOf("/",1)?(l=a.split("/"),""===l[0]&&(l=l.slice(1)),j=l[0],l=l.slice(1)):j=a,f=d.length,b=0;f>b;b++)if(h=d[b],g="/"==h.nodePath[0]&&"/"!=j[0],h.nodePath==(g?"/":"")+j){if(h.target&&l.length>0)return this.findLinkedNodeByNodePath(l,h.target.schema.id,h.nodePath);if(""===h.type)for(c=0;void 0===i&&h.children.length>c;)k=h.children[c],k.nodePath===h.nodePath+"/"+l[0]&&(i=k),c++;else i=h;return i}i=null}return i},NL.DataSource.SchemaWalker.prototype.findLinkedNodeByNodePath=function(a,b,c){var d,e,f,g,h,i,j,k;if(f=this,this.linkedResults[b]){for(e=this.linkedResults[b].data,j=c+"/"+a[0],a=a.slice(1),g=e.length,d=0;g>d;d++)if(i=e[d],h="/"==i.nodePath[0]&&"/"!=j[0],i.nodePath==(h?"/":"")+j)return a.length>0?(k=SO.isNundef(i.target)?i.children.schema.id:i.target.schema.id,this.findLinkedNodeByNodePath(a,k,i.nodePath)):i;return null}return void 0},NL.DataSource.SchemaWalker.prototype.search=function(a){var b,c,d,e,f;if(this.storedResults[this.schemaName]){for(e=[],d=a.toLowerCase(),c=this.storedResults[this.schemaName].data,f=c.length,b=0;f>b;b++)(c[b].label.toLowerCase().indexOf(d)>=0||c[b].nodePath.toLowerCase().indexOf(d)>=0)&&e.push(c[b]);return e}return void 0},NL.DataSource.SchemaWalker.prototype.getLabel=function(a){var b=this.findNodeByNodePath(a);return b?b.label:b},NL.DataSource.SchemaWalker.prototype.getLabelSingular=function(){var a;return SO.isNundef(this.storedResults[this.schemaName])||(a=this.storedResults[this.schemaName].labelSingular),a},NL.DataSource.SchemaWalker.prototype.isReady=function(){return void 0!==this.storedResults[this.schemaName]},NL.DataSource.SchemaWalker.prototype.get=function(a,b,c,d,e,f,g){if(e===!0&&this.setName(this.originalSchemaName),this.storedResults[this.schemaName]){var h=SO.Utils.extend(!0,{},this.storedResults[this.schemaName]);return this._transportOnSuccess(h,c.onSuccess,c.onComplete,d,f,g),void 0}return NL.DataSource.SchemaWalker.superClass.get.apply(this,[a,b,c,d,e,f,g])},NL.DataSource.SchemaWalker.prototype.getOneElement=function(a,b,c){var d,e=this;void 0===c&&this.setName(this.originalSchemaName),d={onSuccess:function(d){e._oneElementSuccess(d,a,b,c)},onError:function(a){b.onError&&b.onError(a)},onComplete:function(){1===e._oneElementRequest?e._oneElementRequest=0:e._oneElementRequest--}},this._oneElementRequest++,this.get(null,null,d,"")},NL.DataSource.SchemaWalker.prototype._oneElementSuccess=function(a,b,c,d){var e,f,g,h,i,j,k,l;if(k=b.split("/"),""===k[0]&&(k=k.slice(1)),SO.isNundef(d)?(d="",l=[]):(l=d.split("/"),""===l[0]&&(l=l.slice(1))),f=!1,k.length>l.length){for(e=0,i=k[l.length];a.length>e&&f===!1;)h=a[e],"/"+i===h.nodePath&&(f=!0),e++;if(f)if(k.length===l.length+1)this._oneElementCallSucessCallback(h,b,c);else if(h.children&&h.children.length>0){for(i+="/"+k[l.length+1],e=0,f=!1;h.children.length>e&&f===!1;)j=h.children[e],"/"+i===j.nodePath&&(f=!0),e++;f&&this._oneElementCallSucessCallback(j,b,c)}else g=SO.Utils.getValueFromObj(h,["target","schema","id"],null),null===g&&(g=SO.Utils.getValueFromObj(h,["children","schema","id"],null)),this.setName(g),this.getOneElement(b,c,d+h.nodePath)}f||(c.onSuccess(null),c.onComplete())},NL.DataSource.SchemaWalker.prototype._oneElementCallSucessCallback=function(a,b,c){a.nodePath=b,c.onSuccess(a),c.onComplete(),this.setName(this.originalSchemaName)},NL.DataSource.SchemaWalker.prototype._transportOnSuccess=function(a,b,c,d,e,f){this.storedResults[this.schemaName]=a,NL.DataSource.SchemaWalker.superClass._transportOnSuccess.apply(this,[a,b,c,d,e,f]),void 0!==c&&c()},NL.DataSource.SchemaWalker.prototype.formatOnSuccess=function(a,b,c){var d,e,f,g,h=a,i=!1;return g=[],""===b&&this._displaySchemaRootNode===!0&&0===this._oneElementRequest&&(e=this.schemaName,f=this.getLabelSingular(),i=!0),SO.Utils.getValueFromObj(a,["root","children"],!1)!==!1&&(g=$.extend(!0,[],h.root.children),d=$.extend({},h),d.root=null,a={infos:d,data:g},a=this._handleData(a,!1,c),a=this._formatSchemaNode(a,b)),i&&(a=[{label:f,name:e,nodePath:"/"+e,type:"nodeStruct",img:"nlui-icon-xtk-schema",selectable:!1,_children_:a,children:{schema:{id:e}},opened:!0}]),a},NL.DataSource.SchemaWalker.prototype._formatSchemaNode=function(a,b){var c,d,e,f,g,h,i,j,k;for(f=[],g=[],i=[],e=[],c=0;a.length>c;c++)if(j=SO.Utils.extend(!0,{},a[c]),!(this._filteredData(j)||this._withAdvancedField===!1&&j.isAdvanced))if(j.img=this._getCurrentNodeImg(j),null!==b&&(j.nodePath=b+j.nodePath),""===j.type){for(j.type="struct",j._children_=j.children,d=0;j._children_>d;d++)k=j._children_[d],k.img=this._getCurrentNodeImg(k);j.selectable=!1,g.push(j)}else"link"===j.type?(j.children=j.target,j.target=null,j.unbound?i.push(j):e.push(j)):f.push(j);return h=f.concat(g,e,i)},NL.DataSource.SchemaWalker.prototype._filteredData=function(a){var b,c=!1;for(b in this._fieldFilterCondition)if(this._fieldFilterCondition.hasOwnProperty(b)&&this._fieldFilterCondition[b]===a[b]){c=!0;break}return c},NL.DataSource.SchemaWalker.prototype._getCurrentNodeImg=function(a){var b;switch(a.type){case"link":b=a.unbound?a.collection?"nlui-icon-xtk-linkn":"nlui-icon-xtk-linkr":"nlui-icon-xtk-link0";break;case"CDATA":case"memo":b="nlui-icon-xtk-field-memo";break;case"struct":b="nlui-icon-xtk-struct";break;default:b=a.required?"nlui-icon-xtk-field-index":a.primary?"nlui-icon-xtk-field-pk":a.foreign?"nlui-icon-xtk-field-fk":a.calculated?"nlui-icon-xtk-field-calculated":"nlui-icon-xtk-field"}return b},NL.DataSource.SchemaWalker.prototype._getTransportObject=function(){var a;return a=new NL.transport.AJAX({url:"/xtk/schema.jssp",type:"POST",data:{name:this.schemaName}})},NL.DataSource.SchemaWalker.prototype.setName=function(a){SO.isNundef(a)||""===a||(this.schemaName=a)},NL.DataSource.SchemaWalker.prototype.getName=function(){return this.schemaName},NL.DataSource.SchemaWalker.prototype._handleData=function(a,b,c){var d,e,f,g,h,i,j,k,l=!1,m=a.data,n=[],o=this.customFilters,p=c?c.filters:[];if($.isArray(o)||$.isArray(p)&&p.length>0)for(l=!0,f=m.length,i=$.isArray(p)?p.length:0,k=$.isArray(o)?o.length:0,d=0;f>d;d++){for(j=!1,e=m[d],h=0;k>h&&!j;h++)o[h](e)||(j=!0);for(h=0;i>h&&!j;h++)g=p[h],-1===e.label.toLowerCase().indexOf(g.value.toLowerCase())&&-1===e.name.toLowerCase().indexOf(g.value.toLowerCase())&&(j=!0);j||n.push(e)}var q=function(a,b){var c=$.isArray(a.ancestors)?a.ancestors[0]+a.label:a.label,d=$.isArray(b.ancestors)?b.ancestors[0]+b.label:b.label;return d>c?-1:c===d?0:1};return l?n.sort(q):m.sort(q),l?n:m},NL.DataSource.SchemaWalker.prototype.prepareFromNode=function(a){null!==SO.Utils.getValueFromObj(a,["schema","id"],null)&&this.setName(a.schema.id)},NL.DataSource.SchemaWalker.prototype.hasChildren=function(a){return!SO.isNundef(SO.Utils.getValueFromObj(a,["children","schema","id"],null))},NL.DataSource.SchemaWalker.prototype.applyFilter=function(a,b){return"advancedField"===a?this._withAdvancedField=b:NL.DataSource.SchemaWalker.superClass.applyFilter.apply(this,[a,b]),this};var resourceWalkerGetElementImg=function resourceWalkerGetElementImg(a){var b="resource-field";return"PKey"===a.apiName?b="resource-pk":"collection"===a.type&&"true"===a.unbound?b="resource-n-link":"link"===a.type?b="resource-1-link":"item"===a.type?b="resource-struct":"memo"===a.type,b};NL.DataSource.ResourceWalker=function(a){NL.DataSource.ResourceWalker.baseConstructor.apply(this,[a]),this._version=SO.Utils.getValueFromObj(a,"version","head"),a.metadataUrl!==!0&&(this.settings.url+="metadata"),this._startUrl=this.settings.url,this._baseUrl="/"+this._version+"/resourceType/"},SO.OO.extend(NL.DataSource.ResourceWalker,NL.DataSource.Rest),NL.DataSource.ResourceWalker.prototype.get=function(a,b,c,d,e,f){"/"!==this.settings.url.substr(-1)&&(this.settings.url+="/");var g=NL.DataSource.ResourceWalker.superClass.get.apply(this,[a,b,c,d,e,f]);return this.settings.url=this._startUrl,g},NL.DataSource.ResourceWalker.prototype.prepareFromNode=function(a){a&&a.resTarget&&""!==a.resTarget&&(this.settings.url=this._baseUrl+a.resTarget)},NL.DataSource.ResourceWalker.prototype.hasChildren=function(a){return"true"===a.unbound&&a.resTarget&&""!==a.resTarget||"link"===a.resType&&a.resTarget&&""!==a.resTarget},NL.DataSource.ResourceWalker.prototype.formatOnSuccess=function(a,b,c){var d,e,c,f,g,h,i={};if(a.type&&"collection"===a.type?d=a.content.content.content.content:a.type&&"item"===a.type?(d=a.content,c=a.filters):a.resourceType&&(d=a.resourceType.content),d)for(f in d)if(d.hasOwnProperty(f)){if(e=SO.Utils.extend(!0,{},d[f]),e.img=resourceWalkerGetElementImg(e),"element"===e.metadata&&SO.Utils.count(e.content)>0)for(g in e.content)e.content.hasOwnProperty(g)&&(h=e.content[g],h.img=resourceWalkerGetElementImg(h));i[f]=e}return c&&(i._filters=c),i},NL.DataSource.MetaDataService=function(a){NL.DataSource.MetaDataService.baseConstructor.apply(this,[a]),this._metaDataService=a.metaDataService,this._resourceIdentifier=a.url,this._startUrl=this._resourceIdentifier,this._version=SO.Utils.getValueFromObj(a,"restVersion","head"),this._capabilities.searchable=!0,this._capabilities.realTime=!0},SO.OO.extend(NL.DataSource.MetaDataService,NL.DataSource.Common),NL.DataSource.MetaDataService.prototype.get=function(a,b,c,d,e,f){var g=this;this._metaDataService.get(this._resourceIdentifier,function(a){null===a?c.onError({message:xtk_core.datasourceEmptyData()}):(c.onSuccess(g.formatOnSuccess(a,d,f)),c.onComplete()),g._resourceIdentifier=g._startUrl})},NL.DataSource.MetaDataService.prototype.prepareFromNode=function(a){a&&a.resTarget&&""!==a.resTarget&&(this._resourceIdentifier="/"+this._version+"/resourceType/"+a.resTarget)},NL.DataSource.MetaDataService.prototype.hasChildren=function(a){return"true"===a.unbound&&a.resTarget&&""!==a.resTarget||"link"===a.resType&&a.resTarget&&""!==a.resTarget},NL.DataSource.MetaDataService.prototype.formatOnSuccess=function(a,b,c,d){function e(a,b){var c=0,d="label";return a[d]>b[d]?c=1:a[d]<b[d]&&(c=-1),c}var f,g,h=[],i=[],j=[],k=[],l=[];if(a)for(g in a)if(a.hasOwnProperty(g)){if("_filters"===g)continue;if(f=SO.Utils.extend(!0,{},a[g]),!this._metaDataService._filterMetaData(f,c))continue;f=this._formatOneNode(f,b),"true"===f.unbound&&f.resTarget&&""!==f.resTarget?l.push(f):"link"===f.resType&&f.resTarget&&""!==f.resTarget?h.push(f):"item"===f.type?(f._children_=[],SO.Utils.count(f.content)>0&&(f._children_=this.formatOnSuccess(f.content,f.nodePath,c,d)),k.push(f)):i.push(f)}return i.sort(e),k.sort(e),h.sort(e),l.sort(e),j=i.concat(k,h,l)},NL.DataSource.MetaDataService.prototype._formatOneNode=function(a,b){return a.img=resourceWalkerGetElementImg(a),a.nodePath=b?b:"",a.nodePath+="/"+a.apiName,("true"===a.unbound&&a.resTarget&&""!==a.resTarget||"link"===a.resType&&a.resTarget&&""!==a.resTarget)&&(a.children={resTarget:a.resTarget}),a};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";NL.DataSource.ProgramRestTimeline=function(a){NL.DataSource.ProgramRestTimeline.baseConstructor.apply(this,[a]),this._startUrl=this.settings.url},SO.OO.extend(NL.DataSource.ProgramRestTimeline,NL.DataSource.RestTimeline),NL.DataSource.ProgramRestTimeline.prototype._applyFilter=function(a,b,c){if(a){for(var d=0;a.length>d;d++){var e=a[d];if(e.wildcard===b)return e.value=c,a}a.push({wildcard:b,value:c})}return a},NL.DataSource.ProgramRestTimeline.prototype.get=function(a,b,c,d,e,f){e||(e={}),e.filters||(e.filters=[]),this._applyFilter(e.filters,"startDate",a),this._applyFilter(e.filters,"endDate",b);var g=NL.DataSource.ProgramRestTimeline.superClass.get.apply(this,[a,b,c,d,e,f]);return this.settings.url=this._startUrl,g},NL.DataSource.ProgramRestTimeline.prototype.prepareFromNode=function(a){var b=SO.Utils.getValueFromObj(a,["children","href"],null);null!==b&&(this.settings.url=b)},NL.DataSource.ProgramRestTimeline.prototype.hasChildren=function(a){return null===SO.Utils.getValueFromObj(a,["parent","PKey"],null)&&SO.Utils.getValueFromObj(a,["children","href"],!1)!==!1},NL.DataSource.ProgramRestTimeline.prototype.formatOnSuccess=function(a){var b,c;for(b=0;a.content.length>b;b++)c=a.content[b],c.parent&&""===c.parent.PKey&&(c.parent=null);return a.content};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";NL.DataSource.PointSource=function(a){NL.DataSource.PointSource.baseConstructor.apply(this,[a]),this.settings=$.extend({},{url:"/",filterNames:[]},a),this._capabilities.searchable=!0},SO.OO.extend(NL.DataSource.PointSource,NL.DataSource.Collection),NL.DataSource.PointSource.prototype._getTransportObject=function(a){for(var b=this.settings.url,c=0;this.settings.filterNames.length>c;c++)b+="/"+this.settings.filterNames[c];for(var d=new SO.Structure.URL(b),e=a?a.filters:[],c=0;e.length>c;c++){var f=e[c],g=f.wildcard,h=f.value;d.query(g,h)}var i=new NL.transport.REST({url:d.toString(),method:"GET"});return i};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.Structure.URL"),SO.Structure.URL=function(a){if(a=SO.isString(a)?this._parseURL(a):a,this._components=SO.Utils.extend({protocol:"",protocolHostSeparator:"://",host:"",port:"",path:"",query:{},hash:""},a),SO.isPlainObject(a)&&this._buildURLFromObject(a),!SO.Structure.URL.isValid(this+""))throw new Error(a+" is not a valid URL")},SO.Structure.URL.prototype._parseURL=function(a){var b,c,d,e={},f={},g=0;if(f.isSchemaRelative="//"===a.slice(0,2),b=a.indexOf(":"),!f.isSchemaRelative&&b>-1&&(f.protocol=a.slice(0,b),f.protocolHostSeparator=":",a=a.slice(b+1)),b=a.indexOf("//"),f.isSchemaRelative||0!==b||(a=a.slice(b+2),f.protocolHostSeparator+="//"),b=a.indexOf("#"),b>-1&&(f.hash=a.slice(b+1),a=a.slice(0,b)),b=a.indexOf("?"),b>-1){c=a.slice(b+1).split("&"),a=a.slice(0,b);for(var h=0,i=c.length;i>h;h++)d=c[h].split("="),d[0]&&(e[d[0]]="undefined"!=typeof d[1]?decodeURIComponent(d[1]):null);f.query=e}return g=f.isSchemaRelative?2:0,b=a.slice(g).indexOf("/"),b>-1?(b+=g,f.path=a.slice(b),a=a.slice(g,b)):f.isSchemaRelative&&(a=a.slice(g)),f.host=a.split(":")[0],f.port=a.split(":")[1],f},SO.Structure.URL.prototype._buildURLFromObject=function(a){this._setProtocol(a.protocol),this._setHost(a.host),this._setPort(a.port),this._setPath(a.path),this._setQuery(a.query),this._setHash(a.hash)},SO.Structure.URL.prototype._setProtocol=function(a){return a=a||"",this._components.protocol=a,this},SO.Structure.URL.prototype._setHost=function(a){return a=a||"",this._components.host=a,this},SO.Structure.URL.prototype._setPort=function(a){return a=a||"",/^\d*$/.test(a)?this._components.port=+a:SO.log.error("Port number must be a number"),this},SO.Structure.URL.prototype._setPath=function(a){return a=a||"",a=a.replace(/^\s+|\s+$/g,""),a?(a=/^\//.test(a)?a:"/"+a,this._components.path=a):this._components.path="",this},SO.Structure.URL.prototype._setQuery=function(){var a=this;return 2===arguments.length?void 0!==arguments[1]&&(this._components.query[arguments[0]]=arguments[1]):arguments[0]?SO.Utils.each(arguments[0],function(b,c){void 0!==c&&(a._components.query[b]=c)}):this._components.query={},this},SO.Structure.URL.prototype._setHash=function(a){return a=a||"",this._components.hash=a,this},SO.Structure.URL.prototype.protocol=function(){return arguments.length?this._setProtocol.apply(this,arguments):this._components.protocol},SO.Structure.URL.prototype.host=function(){return arguments.length?this._setHost.apply(this,arguments):this._components.host},SO.Structure.URL.prototype.port=function(){return arguments.length?this._setPort.apply(this,arguments):+this._components.port||""},SO.Structure.URL.prototype.path=function(){return arguments.length?this._setPath.apply(this,arguments):this._components.path},SO.Structure.URL.prototype.hash=function(){return arguments.length?this._setHash.apply(this,arguments):this._components.hash},SO.Structure.URL.prototype.query=function(){var a={};if(2===arguments.length||SO.isPlainObject(arguments[0])||null===arguments[0]||""===arguments[0])return this._setQuery.apply(this,arguments);if(1!==arguments.length)return SO.Utils.extend({},this._components.query);if(SO.isString(arguments[0]))return this._components.query[arguments[0]];if(SO.isArray(arguments[0])){for(var b=0,c=arguments[0].length;c>b;b++)a[arguments[0][b]]=this._components.query[arguments[0][b]];return a}},SO.Structure.URL.prototype.removeParam=function(){for(var a=Array.prototype.concat.apply([],arguments),b=0,c=a.length;c>b;b++)this._components.query.hasOwnProperty(a[b])&&delete this._components.query[a[b]];return this},SO.Structure.URL.prototype.toString=function(){var a=[];this._components.isSchemaRelative&&!this._components.protocol&&a.push("//");var b=SO.Utils.map(this._components.query,function(a,b){return null===b?encodeURIComponent(a):encodeURIComponent(a)+"="+encodeURIComponent(b)}).join("&"),c=this._components.path.split("/").map(function(a){return encodeURIComponent(a)}).join("/");return this._components.protocol&&a.push(this._components.protocol,this._components.protocolHostSeparator),this._components.host&&a.push(this._components.host),this._components.port&&a.push(":",this._components.port),(this._components.path||b||this._components.hash)&&a.push(/\/$/.test(a[a.length-1])?"":"/"),a.push(c.slice(1)),b&&a.push("?",b),this._components.hash&&a.push("#",encodeURIComponent(this._components.hash)),a.join("")},SO.Structure.URL._validRegex=new RegExp("^(\\w+(?:://|:)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))?)(?::\\d{2,5})?)?([^\\s]*)?$","i"),SO.Structure.URL.isValid=function(a){var b,c,d=SO.Structure.URL._validRegex.exec(a);if(d){if(b=d[1]||"",c=d[2]||"",b)return b+c===a;if(c)return 0===c.indexOf("/")&&c===a}return!1};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.TempMetaDataService"),NL.TempMetaDataService=function(a){this._parent=a,this._cache={}},SO.OO.extend(NL.TempMetaDataService,NL.MetaDataService),NL.TempMetaDataService.prototype._computeResourceURL=function(a,b){var c="";return a?this._isAbsolute(a)?c=a:b&&this._isAbsolute(b)&&(c=b+"/"+a):b&&(c=b),c=c.replace(/\/tmp\//,"/head/"),c+=/\/$/.test(c)?"":"/",c+="tempSchemas"},NL.TempMetaDataService.prototype.get=function(a,b,c){var d=this._computeResourceURL(a,b),e=SO.String.toIdentifier(d);2===arguments.length&&"function"==typeof arguments[1]&&(c=b,b=void 0),e+=this._isAbsolute(a)?"_abs":"_rel",this._cache[e]?c(this._cache[e]):/\/tmp\//.test(a)||/\/tmp\//.test(b)?this._getResourceMetadata(a,b,c):this._parent&&this._parent.get(a,b,c)};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.Cookie"),NL.Cookie.getDomain=function(a){var b=a,c=b.split(".");return c.length>2&&(b=c.slice(1).join(".")),b},NL.Cookie.extractVisitorId=function(a){for(var b=a.split("|"),c=0;b.length>c;c++)if("MCMID"==b[c]&&b.length>c+1){var d=b[c+1],e=d.indexOf("-");return 0>e?d:d.substring(0,e)}return""};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.DataPolicy"),NL.require("/nl/core/nlserver.js"),NL.DataPolicy.filter=function(a,b,c){if(SO.isEmpty(b))return"";switch(a){case"none":return b;case"smartCase":return SO.String.toSmartCase(b);case"upperCase":return b.toUpperCase();case"lowerCase":return b.toLowerCase();case"phone":return c||(c="^\\(?(\\+?)\\s*\\(?(\\d)[\\.\\- ]*(\\d)\\)?[\\.\\- ]*(\\d)[\\.\\- ]*(\\d)?[\\.\\- ]*(\\d)?[\\.\\- ]*(\\d)?[\\.\\- ]*(\\d)?[\\.\\- ]*(\\d)?[\\.\\- ]*(\\d)?[\\.\\- ]*(\\d)?[\\.\\- ]*(\\d)?[\\.\\- ]*(\\d)?[\\.\\- ]*(\\d)?[\\.\\- ]*(\\d)?[\\.\\- ]*$"),b.match(c)?b:null;case"email":var d=b.split("@");return 2===d.length&&d[0].match(/^[\S]+$/)&&d[1].match(/^([\w\-]+\.)+[\w\-]+$/)?b.toLowerCase():null;case"resIdentifier":case"identifier":return SO.String.toIdentifier(b)}throw a+": unknown datapolicy."};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.API"),NL.API.getConfig=function(method,params,success,error){var newParams={};if(newParams.method=method,SO.isPlainObject(params))for(var p in params)if(params.hasOwnProperty(p)){var paramValue=params[p];SO.assert(!SO.isFunction(paramValue),"You cannot have a function as parameter."),newParams[p]=SO.isPlainObject(paramValue)?JSON.stringify(paramValue):NL.XTK.toString(paramValue)}var transport=new NL.transport.AJAX({url:"/xtk/confGenerator.jssp",data:newParams,method:"post",dataFilter:function(data,type){return eval(data)}});transport.start({onSuccess:function(a,b){SO.assert(SO.isFunction(success),"You must specify a success callback function."),success.call(this,a,b)},onError:function(a){SO.assert(SO.isFunction(error),"You must specify an error callback function."),error.call(this,a)}})},NL.API.write=function(a,b,c,d,e){SO.assert(!SO.isEmpty(a)&&a.indexOf(":")>-1,"You have to specify a valid schema."),e=$.extend(!0,{},{rootTagName:a.split(":")[1],operation:"insertOrUpdate",key:""},e);var f=new NL.transport.SOAP({urn:"xtk:persist|xtk:packageDef",method:"Write",nsEncoding:"UTF-8"}),g=new NL.XML.Node(e.rootTagName);g.attr("_operation",e.operation),SO.isEmpty(e.key)||g.attr("_key",e.key),g.attr("xtkschema",a);for(var h in b)if(b.hasOwnProperty(h)){var i=b[h];"link"!==i.type?SO.isEmpty(i.xpath)?SO.log.warn("Cannot write item when no xpath given."):g.setXPathValue(NL.XTK.unexpandXPath(i.xpath),i.value,i.isCDATA):i.value&&SO.log.warn("Not treated link.")}f.writeElement("entity",g.toString());var j={onSuccess:function(a){SO.isFunction(c)&&c.call(this,a)}};return SO.isFunction(d)&&(j.onError=d),f.start(j),f};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.JS"),NL.JS.writeEval=function(a,b){};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL"),NL.QueryDef=function(a,b){this.xmlQuery=newDOMDocument("queryDef"),this.ndRoot=this.xmlQuery.documentElement,this.ndSelect=this.ndRoot.appendChild(this.xmlQuery.createElement("select")),this.ndOrderBy=null,this.ndWhere=null,this.ndGroupBy=null,this.ndRoot.setAttribute("xtkschema","xtk:queryDef"),this.ndRoot.setAttribute("schema",a),this.ndRoot.setAttribute("operation",b)},NL.QueryDef.prototype.OPERATION_GET="get",NL.QueryDef.prototype.OPERATION_GETIFEXISTS="getIfExists",NL.QueryDef.prototype.OPERATION_SELECT="select",NL.QueryDef.prototype.OPERATION_COUNT="count",NL.QueryDef.prototype.setDefinition=function(a){for(var b=0;a.attributes.length>b;b++)this.ndRoot.setAttribute(a.attributes[b].name,a.attributes[b].value);replaceContent(this.xmlQuery,"/queryDef/select",findElement(a,"select")),replaceContent(this.xmlQuery,"/queryDef/orderBy",findElement(a,"orderBy")),replaceContent(this.xmlQuery,"/queryDef/where",findElement(a,"where")),replaceContent(this.xmlQuery,"/queryDef/sysFilter",findElement(a,"sysFilter")),replaceContent(this.xmlQuery,"/queryDef/groupBy",findElement(a,"groupBy")),this.ndSelect=findElement(this.ndRoot,"select"),this.ndOrderBy=findElement(this.ndRoot,"orderBy"),this.ndWhere=findElement(this.ndRoot,"where"),this.ndGroupBy=findElement(this.ndRoot,"groupBy");var c=findElement(a,"conditionLink");if(null!=c&&null!=this.ndSelect){var d=c.getAttribute("xpath");if(""!=d&&void 0!=d){var e=findElement(a,d);null==e&&(e=this.ndSelect.appendChild(this.xmlQuery.createElement("node")),e.setAttribute("expr",d)),e.setAttribute("noComputeString","true"),e.setAttribute("conditionLink","true"),e.setAttribute("lineCount",c.getAttribute("lineCount"));var f=c.getAttribute("singleRow");null!=f&&"undefined"!=typeof f&&e.setAttribute("singleRow",f);var g=findElement(c,"where");null!=g&&e.appendChild(importNode(this.xmlQuery,g,!0));var h=findElement(c,"orderBy");null!=h&&e.appendChild(importNode(this.xmlQuery,h,!0))}}},NL.QueryDef.prototype.getSchema=function(){return this.ndRoot.getAttribute("schema")},NL.QueryDef.prototype.setLineCount=function(a){this.ndRoot.setAttribute("lineCount",a),this.ndRoot.setAttribute("firstRows","true")},NL.QueryDef.prototype.getLineCount=function(){return this.ndRoot.getAttribute("lineCount")},NL.QueryDef.prototype.setStartLine=function(a){this.ndRoot.setAttribute("startLine",a)},NL.QueryDef.prototype.getStartLine=function(){return this.ndRoot.getAttribute("startLine")},NL.QueryDef.prototype.setFirstRows=function(a){this.ndRoot.setAttribute("firstRows",this.booleanString(a))},NL.QueryDef.prototype.setOperation=function(a){this.ndRoot.setAttribute("operation",a)},NL.QueryDef.prototype.setFullLoad=function(a){this.ndRoot.setAttribute("fullLoad",this.booleanString(a))},NL.QueryDef.prototype.setDistinct=function(a){this.ndRoot.setAttribute("distinct",this.booleanString(a))},NL.QueryDef.prototype.setNewAutoPk=function(a){this.ndRoot.setAttribute("newAutoPk",this.booleanString(a))},NL.QueryDef.prototype.setUnExpandMemoData=function(a){this.ndRoot.setAttribute("unExpandMemoData",this.booleanString(a))},NL.QueryDef.prototype.setShowSQL=function(a){this.ndRoot.setAttribute("showSQL",this.booleanString(a))},NL.QueryDef.prototype.setExpandParam=function(a){this.ndRoot.setAttribute("expandParam",this.booleanString(a))},NL.QueryDef.prototype.setCheckActiveEnabledIf=function(a){this.ndRoot.setAttribute("checkActiveEnabledIf",this.booleanString(a))},NL.QueryDef.prototype.startLine=function(){var a=this.ndRoot.getAttribute("startLine");return"undefined"==typeof a||null==a?0:parseInt(a,10)},NL.QueryDef.prototype.addSelectExpr=function(a,b,c,d){var e=this.xmlQuery.createElement("node");return e.setAttribute("expr",a),"undefined"!=typeof b&&null!=b&&e.setAttribute("alias",b),"undefined"!=typeof c&&null!=c&&e.setAttribute("analyze",this.booleanString(c)),"undefined"!=typeof d&&null!=d&&e.setAttribute("anyType",this.booleanString(d)),this.ndSelect.appendChild(e)},NL.QueryDef.prototype.addSelectElement=function(a){return this.ndSelect.appendChild(a)},NL.QueryDef.prototype.createRootConditionIfNeeded=function(a,b){var c=null;if("undefined"!=typeof b)for(var d=firstChildElement(this.ndRoot);null!=d&&null==c;)d.getAttribute("name")==b&&(a&&"sysFilter"==d.nodeName||!a&&"where"==d.nodeName)&&(c=d),d=nextSiblingElement(d);else 0==a&&(c=this.ndWhere);return null==c&&(c=this.ndRoot.appendChild(this.xmlQuery.createElement(a?"sysFilter":"where")),"undefined"!=typeof b?c.setAttribute("name",b):0==a&&null==this.ndWhere&&(this.ndWhere=c)),c},NL.QueryDef.prototype.addWhereConditionExpr=function(a,b,c,d,e,f){"undefined"==typeof b&&(b=!1);var g=this.createRootConditionIfNeeded(b,c),h=g.appendChild(this.xmlQuery.createElement("condition"));return h.setAttribute("expr",a),"undefined"!=typeof d&&h.setAttribute("boolOperator",d),"undefined"!=typeof e&&h.setAttribute("enabledIf",e),"undefined"!=typeof f&&f&&h.setAttribute("constAsText","true"),h},NL.QueryDef.prototype.addWhereCondition=function(a,b,c,d){"undefined"==typeof c&&(c=!1);var e=this.createRootConditionIfNeeded(c,d),f=e.appendChild(this.xmlQuery.createElement("condition"));"undefined"!=typeof b&&""!=b&&(f.setAttribute("xpath",b),f.setAttribute("noComputeString","true"));for(var g=0;a.childNodes.length>g;g++)1==a.childNodes[g].nodeType&&f.appendChild(importNode(this.xmlQuery,a.childNodes[g],!0));return f},NL.QueryDef.prototype.addGroupByExpr=function(a){null==this.ndGroupBy&&(this.ndGroupBy=this.ndRoot.appendChild(this.xmlQuery.createElement("groupBy")));var b=this.xmlQuery.createElement("node");b.setAttribute("expr",a),this.ndGroupBy.appendChild(b)},NL.QueryDef.prototype.addOrderByExpr=function(a,b){null==this.ndOrderBy&&(this.ndOrderBy=this.ndRoot.appendChild(this.xmlQuery.createElement("orderBy")));var c=this.xmlQuery.createElement("node");c.setAttribute("expr",a),void 0!=b&&0!=b&&c.setAttribute("sortDesc","1"),this.ndOrderBy.appendChild(c)},NL.QueryDef.prototype.booleanString=function(a){return a?"true":"false"},NL.QueryDef.prototype.execute=function(a,b,c){var d=!1;void 0!=c&&null!=c&&(d=!0,this.asyncTarget=c);var e=new NL.transport.SOAP({urn:"xtk:queryDef",method:"ExecuteQuery",url:a});if(e.writeDocument("queryDef",this.xmlQuery),d){var f=this;return e.start({onSuccess:function(a){var b=a.getNextElement();a.checkNoMoreArgs(),f.asyncTarget.onXtkQueryCompleted(f,b,null)}}),null}if(this._error=null,e.start({async:!1}),e.isSuccess()){var g=e.getNextElement();return e.checkNoMoreArgs(),g}return this._error=e.getError(),null},NL.QueryDef.prototype.isSuccess=function(){return null===this._error},NL.QueryDef.prototype.getError=function(){return this._error};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("NL"),NL.XtkTooltipManager=function(){this.htmlObject=null,this.mousePosition=null,this.strText=null,this.tmrShow=new NL.XtkTimer(this),this.htmlTooltip=null};var g_nl_tooltipManager=new NL.XtkTooltipManager;NL.XtkTooltipManager.prototype.onTimer=function(){this.tmrShow.stop(),this.hideTooltip(),this.htmlTooltip=document.createElement("div"),this.htmlTooltip.className="tooltip",this.htmlTooltip.style.left=this.mousePosition.X+"px",this.htmlTooltip.style.top=this.mousePosition.Y+19+"px",this.htmlTooltip.innerHTML=void 0!=this.htmlObject.tooltipText?this.htmlObject.tooltipText:findXtkObject(this.htmlObject).getTooltipText(),document.body.appendChild(this.htmlTooltip);var a=document.body.clientWidth-this.mousePosition.X-this.htmlTooltip.clientWidth,b=document.body.clientHeight-this.mousePosition.Y-this.htmlTooltip.clientHeight;0>a&&(this.htmlTooltip.style.left=this.mousePosition.X+a-20+"px"),0>b&&(this.htmlTooltip.style.top=this.mousePosition.Y+b+"px")},NL.XtkTooltipManager.prototype.hideTooltip=function(){null!=this.htmlTooltip&&(document.body.removeChild(this.htmlTooltip),this.htmlTooltip=null)};var g_onEnterTooltip=function(a){var b=NewEvent(a),c=b.getSource();g_nl_tooltipManager.hideTooltip(),g_nl_tooltipManager.htmlObject=c,g_nl_tooltipManager.tmrShow.start(g_nl_tooltipManager,500);var d;d=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,scrollTop=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,g_nl_tooltipManager.mousePosition={X:b.data.clientX+d,Y:b.data.clientY+scrollTop}},g_onLeaveTooltip=function(){g_nl_tooltipManager.tmrShow.stop(),g_nl_tooltipManager.htmlObject=null,null!=g_nl_tooltipManager.htmlTooltip&&(document.body.removeChild(g_nl_tooltipManager.htmlTooltip),g_nl_tooltipManager.htmlTooltip=null)};NL.XtkTooltipManager.prototype.register=function(a,b){a.tooltipText=b,a.onmouseout=g_onLeaveTooltip,a.onmousemove=g_onEnterTooltip};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlFileDroppable",a.NL.nlWidget,{options:{onDrop:null,onDragOver:null,onDragEnter:null,onDragExit:null,accept:"all",onFileDropped:null},_create:function(){var b=this;return b.options.onFileDropped&&(b.options.onDrop=b.options.onFileDropped),this.element.on("dragenter dragover dragleave drop",function(c){switch(c.stopPropagation(),c.preventDefault(),c.type){case"dragover":a(this).addClass("ui-state-hover"),"function"==typeof b.options.onDragOver&&b.options.onDragOver.call(this,c);break;case"dragenter":"function"==typeof b.options.onDragEnter&&b.options.onDragEnter.call(this,c);break;case"dragleave":a(this).removeClass("ui-state-hover"),"function"==typeof b.options.onDragExit&&b.options.onDragExit.call(this,c);break;case"drop":a(this).removeClass("ui-state-hover"),"function"==typeof b.options.onDrop&&b.options.onDrop.call(this,c,c.originalEvent.dataTransfer.files)}}),this}})})(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){var b={$_bottomZone:null,_bottomZoneButtonMargin:80,_defaultButtonWidth:74,options:{noTitleBar:!1,noPrimaryFirstButton:!1,width:320,onCancel:function(){}},_create:function(){this.locale=NL.session.locale,this.options.minWidth<this.options.width&&(this.options.minWidth=this.options.width),this.options.minHeight<this.options.height&&(this.options.minHeight=this.options.height),this._attachCancelOnClose(),this._handleButtons(),a.ui.dialog.prototype._create.call(this),this.element.addClass("nlui-uiDialog");var b=this.uiDialog.find(".ui-dialog-buttonpane");this.$_bottomZone=a("<div></div>").addClass("nlui-uiDialog-bottom-zone").appendTo(b),this._refreshTitleBar(),this._refreshBottomZone()},_setOption:function(a,b){switch(a){case"buttons":this.options.buttons=b,this._handleButtons();break;case"close":this.options.close=b,this._attachCancelOnClose()}switch(this._super("_setOption",a,b),a){case"buttons":case"noPrimaryFirstButton":this._refreshButtons();break;case"bottomZone":this._refreshBottomZone();break;case"noTitleBar":this._refreshTitleBar()}},_attachCancelOnClose:function(){var b=this,c=this.options.close;this.options.close=function(d){c&&c.apply(this,arguments);var e=d.originalEvent?a(d.originalEvent.currentTarget):null;e&&e.is("button")&&(e.attr("nl-data-cancels")||e.is(":not(button)"))&&b.options.onCancel.apply(this,arguments)}},_handleButtons:function(){var a,b=this,c=this.options.buttons;if(SO.isObject(c))this._buttonsAsArray=!1;else if(SO.isArray(c))for(this._buttonsAsArray=!0,a=0;c.length>a;a++)c[a].cancels&&(c[a].click&&SO.log.warn("A cancelling button can't have a click callback defined."),c[a].click=function(a){b.close(a)})},destroy:function(){a.ui.dialog.prototype.destroy.call(this),this.$_bottomZone.remove()},getButtonSet:function(){return this.uiDialog.find(".ui-dialog-buttonpane .ui-dialog-buttonset")},getButton:function(a){return this.getButtonSet().find("#"+a)},getButtons:function(){return this.getButtonSet().find("button")},getBottomZone:function(){return this.uiDialog.find(".ui-dialog-buttonpane .nlui-uiDialog-bottom-zone")},getContentZone:function(){return this.uiDialog.find(".ui-dialog-content")},open:function(){a.ui.dialog.prototype.open.apply(this,arguments),this._refreshButtons(),this._refreshBottomZone()},cancel:function(){this.close(),this.options.onCancel&&this.options.onCancel()},_refreshButtons:function(){var b=this,c=this;this.getButtons().each(function(d){var e=a(this);e.removeClass("nlui-button-primary"),0!==d||c.options.noPrimaryFirstButton||e.addClass("nlui-button-primary"),e.outerWidth(!0)<c._defaultButtonWidth&&e.width(c._defaultButtonWidth),b._buttonsAsArray&&c.options.buttons[d]&&e.attr("nl-data-cancels",c.options.buttons[d].cancels===!0),e.blur()})},_refreshBottomZone:function(){var a=this.uiDialog.find(".ui-dialog-buttonpane"),b=this.getButtonSet();a.length>0&&this.$_bottomZone.width(a.width()-b.width()-this._bottomZoneButtonMargin).height(b.height()).appendTo(a)},_refreshTitleBar:function(){"undefined"!=typeof this.options.noTitleBar&&this.options.noTitleBar&&this.uiDialogTitlebar.remove()}};a.widget("NL.nlUiDialog",a.ui.dialog,b)})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";NL.FormController=function(a){a.widget("NL.nlForm",a.NL.nlWidget,{options:{controller:void 0,disabled:!1,readOnly:!1,strict:!1,showHelpText:!0,labelsWidth:"medium",labelsPosition:"left",boldLabels:!1,labelsCSSClasses:[],onRefreshVisibility:void 0},_create:function(){SO.assert(!!this.options.controller,"The controller is a mandatory option of the nlForm widget"),this._items=[],this.element.addClass("nlui-form"),this.options.onRefreshVisibility&&this.options.controller.registerOnRefreshVisibility(this.options.onRefreshVisibility),this.options.controller.registerObserver("blocks",this,null),this.refresh(),this.options.controller.observerReady(this)},refresh:function(){for(var b=this,c=[this.element];c.length>0;){var d=c.shift();if(d.hasClass("nlui-form")&&d!==this.element){var e=this.options.controller,f=d.nlForm("controller");if(e!==f)continue}var g=d.attr("data-nl-jpath");SO.isEmpty(g)||b._inject(d,g),d.children().each(function(){c.push(a(this))})}this.options.layoutManager.rebuildLayout(this.element)},destroy:function(){this.options.onRefreshVisibility&&this.options.controller.unregisterOnRefreshVisibility(this.options.onRefreshVisibility);for(var b=0;this._items.length>b;b++){var c=this._items[b];c.$elem.children().remove(),c.$elem.removeClass("nlui-form-mandatory readOnly"),this.options.controller.unregisterJpathObserver(c.jpath,this)}this._items=[],a.Widget.prototype.destroy.call(this)},_findItemByElement:function(a){for(var b=0;this._items.length>b;b++)if(this._items[b].$elem.get(0)===a.get(0))return this._items[b];return void 0},_findItemsByPath:function(a){for(var b=[],c=0;this._items.length>c;c++)this._items[c].jpath===a&&b.push(this._items[c]);return b},_compileDisplay:function(b,c){var d=this.options.controller,e=a.extend({},{readOnly:!1,disabled:!1,hidden:!1,mandatory:!1,strict:!1,labelsWidth:"medium",labelsBold:!1,labelsCSSClasses:[],showHelpText:!0,labelsPosition:"left",locale:null,help:null,error:null},{readOnly:this.options.readOnly,disabled:this.options.disabled,strict:this.options.strict,labelsWidth:this.options.labelsWidth,labelsBold:this.options.labelsBold,labelsCSSClasses:this.options.labelsCSSClasses,showHelpText:this.options.showHelpText,labelsPosition:this.options.labelsPosition,locale:this.options.locale},{labelsWidth:d.getLabelsWidth(c),labelsPosition:d.getLabelsPosition(c),label:d.getLabel(c),help:d.getHelp(c),locale:d.getLocale,error:d.getError(c)});return e.readOnly=e.readOnly||d.isReadOnly(c),e.disabled=e.disabled||d.isDisabled(c),e.hidden=e.hidden||d.isHidden(c),e.mandatory=e.mandatory||d.isMandatory(c),e.strict=e.strict||d.isStrict(c),e.mandatory=e.mandatory||d.isMandatory(c),e},_inject:function(a,b){var c=this._findItemByElement(a);c?c.vc&&c.vc.setValue(c.vc.controller.getValue(b)):(c={$elem:a.addClass("nlui-form-row"),jpath:b},this._items.push(c)),this._injectItem(c)},_injectItem:function(a){var b=this._compileDisplay(a.$elem,a.jpath);if(a.$elem.toggle(!b.hidden),!b.hidden){void 0===a.vc&&(this._createTheWidget(a,b),this.options.controller.registerJpathObserver(a.jpath,this));var c=this.options.controller.getError(a.jpath);this._updateError(a,c,a.vc.$div)}},_updateError:function(a,b){void 0===b?b=this.options.controller.getError(a.jpath):a.vc.setError(b);var c=null!==b;if(c){var d=this.options.controller.isReadOnly(a.jpath),e=this.options.controller.isDisabled(a.jpath);c=!d&&!e}a.$error.toggle(c)},_updateMandatory:function(a,b){void 0===b?b=this.options.controller.isMandatory(a.jpath):a.vc.setMandatory(b);var c=b;if(c){var d=this.options.controller.isReadOnly(a.jpath),e=this.options.controller.isDisabled(a.jpath);c=!d&&!e}a.$elem.toggleClass("nlui-form-mandatory",c)},_updateLabel:function(a,b){a.$label.text(b)},_updateHelp:function(a,b){var c=!SO.isNundef(b);c&&a.$help.text(b),a.$help.toggle(c)},_updateReadOnly:function(a,b){a.vc.setReadOnly(b),this._updateError(a),this._updateMandatory(a)},_updateDisabled:function(a,b){a.vc.setDisabled(b),this._updateError(a),this._updateMandatory(a)},_createTheWidget:function(b,c){b.$elem.addClass("nlui-form-field"),b.vc=ViewControllerManager.newViewController(this.options.controller,b.jpath,c),b.$value=b.vc.widget();var d=this.options.controller;b.label=d.getLabel(b.jpath),b.$label=a("<label></label>").addClass("nlui-form-label").text(b.label);var e=a("<td></td>").addClass("nlui-form-column-label");e.addClass("nlui-form-column-label-"+c.labelsWidth),c.labelsBold&&b.$label.addClass("bold"),a.each(c.labelsCSSClasses,function(a,c){b.$label.addClass(c)}),e.append(b.$label),b.$value.addClass("value"),b.vc.isVariableHeight()?b.$value.addClass("variable-height"):b.$value.addClass("fixed-height");var f=a("<td></td>");f.append(b.$value);var g=a("<td></td>").addClass("nlui-form-column-help");b.$help=a("<p></p>").attr("display","none").appendTo(g);var h=a("<td></td>");b.$error=a("<div></div>").addClass("nlui-form-error-message").attr("display","none").appendTo(h);var i,j=a("<table></table>");if("left"===c.labelsPosition)i=a("<tr></tr>").appendTo(j),e.appendTo(i),f.appendTo(i),i=a("<tr></tr>").appendTo(j),a("<td></td>").appendTo(i),h.appendTo(i),g&&(i=a("<tr></tr>").appendTo(j),a("<td></td>").appendTo(i),g.appendTo(i));else if("above"===c.labelsPosition){var k=a("<tr></tr>").appendTo(j);e.appendTo(k);var l=a("<tr></tr>").appendTo(j);f.appendTo(l);var m=a("<tr></tr>").appendTo(j);if(h.appendTo(m),g){var n=a("<tr></tr>").appendTo(j);g.appendTo(n)}}else"none"===c.labelsPosition?(i=a("<tr></tr>").appendTo(j),f.appendTo(i),i=a("<tr></tr>").appendTo(j),h.appendTo(i),g&&(i=a("<tr></tr>").appendTo(j),g.appendTo(i))):SO.assert(!1,"Invalid value ["+c.labelsPosition+"] for labelsPosition attribute");b.vc._errorDisplay=function(a){var c=!1;null!==a&&(b.$error.text(a.message),c=!0),b.$error.toggle(c)},b.$elem.append(j),b.vc.initialize({locale:this.options.locale,timezone:this.options.timezone,configManager:this.options.configManager}),this._updateWidget(b,c,!1)},_updateWidget:function(a,b,c){var d=b.mandatory&&!b.readOnly&&!b.disabled;a.$elem.toggleClass("nlui-form-mandatory",d);var e=!!b.error&&!b.readOnly&&!b.disabled;a.$value.toggleClass("error",e),a.$error.toggle(e);var f=!!b.showHelpText&&!!b.help;if(a.$help.text(b.help),a.$help.toggle(f),c){var g=this.options.controller.getLabel(a.jpath),h=a.label;h!==g&&(a.$label.text(g),a.label=g)}},_setOption:function(b,c){SO.log.warn("You should not use the nlForm setOption or option method to change parameters"),"readOnly"===b?this.setReadOnly(c):"locale"===b&&this.setLocale(c),a.NL.nlWidget.prototype._setOption.apply(this,arguments)},setReadOnly:function(a){this.options.readOnly=a,this.refresh()},setDisabled:function(a){this.options.disabled=a,this.refresh()},setLocale:function(a){this.options.locale=a,this.refresh()},controller:function(){return SO.log.warn("You should not get the controller from the nlForm widget"),this.options.controller},onJpathNotify:function(a,b,c,d){for(var e=this._findItemsByPath(b),f=0;e.length>f;f++){var g=e[f];if(g.vc){if(d._sourceObserver!==g.vc)switch(a){case"error":this._updateError(g,c);break;case"value":g.vc.setValue(c);break;case"strict":g.vc.setStrict(c);break;case"params":g.vc.setParamSubtree(d.paramPath,d.value);break;case"mandatory":this._updateMandatory(g,c);break;case"label":this._updateLabel(g,c);break;case"help":this._updateHelp(g,c);break;case"update":g.vc.setValue(c);break;case"add":case"remove":case"loading":break;default:throw"Unknown type in method onJpathNotify: "+a}}else this._injectItem(g)}},onBlockNotify:function(a,b,c){for(var d=this._findItemsByPath(b),e=0;d.length>e;e++){var f=d[e];if(f.vc)switch(a){case"readOnly":this._updateReadOnly(f,c);break;case"disabled":this._updateDisabled(f,c);break;case"hidden":if(!c){var g=this._compileDisplay(f.$elem,b);this._updateWidget(f,g,!0)}f.$elem.toggle(!c);break;default:throw"Unknown type in method onBlockNotify: "+a}else this._injectItem(f)}}}),SO.Widgets.define("quickform",{DEFAULT_OPTIONS:{controller:void 0,attributes:void 0},$form:void 0,_create:function(){var b=this;this.$form=this.$el;var c=this._options.attributes;a.each(c,function(c,d){a("<div></div>").attr("data-nl-jpath",d).appendTo(b.$form)}),this.$form.nlForm(this._options)},refresh:function(){return this.$form.nlForm("refresh")},controller:function(){return this.$form.nlForm("controller")}}),a.widget("SO.soQuickForm",{_create:function(){this._widget=new SO.Widgets.quickform(this.element,this.options)}})}(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.OO.defineProtocol("widgetAPI",["getValue","setValue","setError","setDisabled","setReadOnly","_validate","setMandatory"]),SO.Widgets.define("Input",{DEFAULT_OPTIONS:{value:null,disabled:!1,readOnly:!1,error:null,strict:!1,mandatory:!1,displayFormat:null,onInternalChange:function(){},onExternalChange:function(){},onTouched:function(){},errorDisplay:function(){},displayParams:{mode:"default",size:"regular",bold:!1,italic:!1,underline:!1},placeHolder:null,icon:null},_create:function(){var a=this;this._state=this._state||{},this._state.error=this._state.error||this._options.error,this._state.readOnly=this._state.readOnly||this._options.readOnly,this._state.disabled=this._state.disabled||this._options.disabled,this._state.strict=this._state.strict||this._options.strict,this._state.mandatory=this._state.mandatory||this._options.mandatory,this._checks=this._checks||[],this._checks.unshift({requirement:function(){return a._state.mandatory},test:function(b){return!a._isValueEmpty(b)},error:{message:xtk_sirocco.inputs_mandatoryErr()}}),this._value=this._options.value,this._displayValue=this._options.value,this._state.error=this._validate(this._displayValue,!0),this._options.displayParams?this._options.displayParams.className=this._computeDisplayClasses():this._options.displayParams={className:""},this._refreshDisplay(!0),null!==this._state.error&&(this._options.errorDisplay(this._state.error),this._options.onInternalChange(this._value,this._state.error,this._state.strict))},setError:function(a){this._state.error=a,this._options.errorDisplay(this._state.error),this._refreshDisplay(!1)},setReadOnly:function(a){this._state.readOnly=a,this._refreshDisplay(!0)},setDisabled:function(a){this._state.disabled=a,this._refreshDisplay(!1)},getValue:function(){return this._value},setValue:function(a){if(!this._focused){var b=this._state.error;this._value=a,this._displayValue=a,this._state.strict=!0,this._state.error=this._validate(this._value),SO.Utils.isEqual(b,this._state.error)||this._options.errorDisplay(this._state.error),this._refreshDisplay(!1),this._options.onExternalChange(this._state.error,this._state.strict)}},_setValue:function(a){if(this._state.strict=!0,!SO.Utils.isEqual(this._value,a)){var b=this._state.error;this._value=a,this._displayValue=a,this._state.error=this._validate(a),SO.Utils.isEqual(b,this._state.error)||this._options.errorDisplay(this._state.error),this._refreshDisplay(!1),this._options.onInternalChange(this._value,this._state.error,this._state.strict)}},setStrict:function(a){var b=this._state.error;this._state.strict=a;var c=this._validate(this._value);(!SO.Utils.isEqual(b,c)||a)&&this.setError(c),this._options.onExternalChange(this._state.error,this._state.strict)},setMandatory:function(a){var b=this._state.error;this._state.mandatory=a;var c=this._validate(this._value);SO.Utils.isEqual(b,c)||this.setError(c),this._options.onExternalChange(this._state.error,this._state.strict)},_validate:function(a,b){for(var c=this,d=a,e=[],f=null,g=0;0===e.length&&this._checks.length>g;g++){var h=this._checks[g];h.requirement(d)&&!h.test(d)&&(c._state.strict||h.instant&&!b||b&&!c._isValueEmpty(d))&&e.push(h.error)}return e.length>0&&(f=e[0]),f},_isValueEmpty:function(a){return SO.isNundef(a)||""===a},_applyParamChanges:function(){var a=this._state.error,b=this._validate(this._value);SO.Utils.isEqual(a,b)||(this.setError(b),this._options.onExternalChange(this._state.error,this._state.strict))},check:function(a,b){return this._validate(a,b)},_computeDisplayClasses:function(){var a=[];switch(this._options.displayParams.size){case"small":a.push("nlui-input-size-small");break;case"regular":a.push("nlui-input-size-regular");break;case"medium":a.push("nlui-input-size-medium");break;case"large":a.push("nlui-input-size-large");break;default:throw"Unknow size in _computeDisplayClasses"}switch(this._options.displayParams.mode){case"default":a.push("nlui-input-mode-default");break;case"primary":a.push("nlui-input-mode-primary");break;case"success":a.push("nlui-input-mode-success");break;case"error":a.push("nlui-input-mode-error");break;case"warning":a.push("nlui-input-mode-warning");break;case"info":a.push("nlui-input-mode-info");break;default:throw"Unknow mode in _computeDisplayClasses"}return this._options.displayParams.bold&&a.push("nlui-input-bold"),this._options.displayParams.italic&&a.push("nlui-input-italic"),this._options.displayParams.underline&&a.push("nlui-input-underline"),a.join(" ")},_getSafeDisplayValue:function(){var a=SO.isNundef(this._displayValue)?"":this._displayValue.toString();return SO.XSS.escapeXMLString(a)}}),$.widget("SO.soInputs",{_create:function(){this._widget=new SO.Widgets.Input(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("TextInput","Input",{DEFAULT_OPTIONS:{params:{minLength:null,maxLength:null,allowNumber:!0}},_create:function(){var a=this;this._checks=[{requirement:function(){return null!==a._value},test:function(a){return SO.isString(a)},error:{message:xtk_sirocco.inputs_incorrectValueErr()}},{requirement:function(){return null!==a._options.params.maxLength&&null!==a._value},test:function(b){return b.length<=a._options.params.maxLength},error:{message:xtk_sirocco.text_maxCharErr(a._options.params.maxLength)},instant:!0},{requirement:function(){return null!==a._options.params.minLength&&null!==a._value},test:function(b){return b.length>=a._options.params.minLength},error:{message:xtk_sirocco.text_minCharErr(a._options.params.minLength)}},{requirement:function(b){return!a._options.params.allowNumber&&null!==b},instant:!0,test:function(a){return null===a.match(/\d/)},error:{message:xtk_sirocco.text_numberNotAllowed()}}];var b=a._options;if(b.icon){var c="";c=/^coral-/.test(b.icon)?"coral-Icon coral-Icon--size-18 coral-Icon--"+b.icon.replace("coral-",""):"soui-icon-18-"+b.icon,this._icon=c}this._super()},_refreshDisplay:function(a){a&&(this._unbindEvents(),this._createMarkup(),this._bindEvents()),this._state.disabled?this._view.el.innerHTML=this._getSafeDisplayValue():(this._state.readOnly||null===this._state.error?(null===this._state.error&&this._view.$input.classList.contains("nlui-state-error")||this._state.readOnly)&&this._view.$input.classList.remove("nlui-state-error"):this._view.$input.classList.add("nlui-state-error"),this._view.$input.disabled=this._state.readOnly,this._view.$input.value=this._displayValue)},_unbindEvents:function(){this._view&&this._view.$input&&(this._onBlur&&this._view.$input.removeEventListener("blur",this._onBlur),this._onFocus&&this._view.$input.removeEventListener("focus",this._onFocus),this._onKeyUp&&this._view.$input.removeEventListener("keyup",this._onKeyUp))},_bindEvents:function(){var a=this;this._options.params,this._onBlur=function(){a._focused=!1;var b=$(this).val();a._setValue(b)},this._onFocus=function(){a._focused=!0},this._onKeyUp=function(b){if(13==b.keyCode)this.blur();else{var c=$(this).val();if(a._options.onTouched(c),!SO.Utils.isEqual(a._value,c)){var d=a._state.error;a._displayValue=c,a._state.error=a._validate(c),SO.Utils.isEqual(d,a._state.error)||(a._options.errorDisplay(a._state.error),a._refreshDisplay(!1))}}},a._state.disabled||(this._view.$input.addEventListener("blur",this._onBlur),this._view.$input.addEventListener("focus",this._onFocus),this._view.$input.addEventListener("keyup",this._onKeyUp))},_createMarkup:function(){var a=this._options;this.$el.addClass("nlui-text nlui-input nlui-input-fullwidth"),this.$el.empty(),this._view={},this._state.disabled?(SO.tie(this._view,{tag:"label",cls:a.displayParams.className}),this.$el.append(this._view.el)):(SO.tie(this._view,{tag:"div",cld:[{tag:"i",cls:["decorative-icon",this._icon?this._icon:""].join(" "),field:"$inputIcon"},{tag:"input",type:"text",cls:[a.displayParams.className,this._icon?"has-icon":""].join(" "),placeholder:a.placeHolder?a.placeHolder:"",field:"$input"}]}),a.icon&&this.$el.append(this._view.$inputIcon),this.$el.append(this._view.$input))},setPlaceHolder:function(a){return this._state.disabled||this._$text.attr("placeHolder",a),this}}),$.widget("SO.soTextInput",{_create:function(){this._widget=new SO.Widgets.TextInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},setPlaceHolder:function(a){this._widget.setPlaceHolder(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("NumberInput","Input",{DEFAULT_OPTIONS:{params:{type:"integer",decimalPlaces:2,range:{min:null,max:null,upStrict:!1,downStrict:!1},significantFigures:null,protectInternalValue:!0,unit:null}},_create:function(){this._state={},this._state.error=this._options.error,this._state.readOnly=this._options.readOnly,this._state.disabled=this._options.disabled,this._state.strict=this._options.strict,this._state.mandatory=this._options.mandatory,this._checks=this._checks||[];var a=this,b=a._options.params;this._checks=[{requirement:function(){return a._state.mandatory},test:function(b){return!a._isValueEmpty(b)},error:{message:xtk_sirocco.inputs_mandatoryErr()}},{requirement:function(a){return null!==a&&!/[\.,]$/.test(a)},test:function(a){switch(b.type){case"float":return SO.isFloat(a);case"integer":return SO.isInteger(a)}},error:{message:xtk_sirocco.inputs_incorrectValueErr()}},{requirement:function(){return null!==b.range&&null!==b.range.min},test:function(a){return b.range.downStrict?a>b.range.min:a>=b.range.min},error:{message:a._getErrorMessage("min")}},{requirement:function(){return null!==b.range&&null!==b.range.max},test:function(a){return b.range.upStrict?b.range.max>a:b.range.max>=a},error:{message:a._getErrorMessage("max")},instant:!0}],this._value=this._options.params.protectInternalValue?this._options.value:this._parseValue(this._formatDisplayValue(this._value))||this._options.value,this._displayValue=this._formatDisplayValue(this._value),this._state.error=this._validate(this._value,!0),this._options.displayParams.className=this._computeDisplayClasses(),this._refreshDisplay(!0),null!==this._state.error&&(this._options.errorDisplay(this._state.error),this._options.onInternalChange(this._value,this._state.error,this._state.strict))},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents()),this._state.disabled?(this.el.classList.add("nlui-state-readonly"),this._view.el.innerHTML=this._getSafeDisplayValue()):(this.el.classList.remove("nlui-state-readonly"),this._state.readOnly||null===this._state.error?(null===this._state.error&&this._view.$input.classList.contains("nlui-state-error")||this._state.readOnly)&&this._view.$input.classList.remove("nlui-state-error"):this._view.$input.classList.add("nlui-state-error"),this._view.$input.disabled=this._state.readOnly,this._focused||(this._view.$input.value=this._displayValue))},_bindEvents:function(){var a=this;a._state.disabled||(a._view.$input.addEventListener("focus",function(){this.value=a._value,a._focused=!0}),a._view.$input.addEventListener("blur",function(){a._focused=!1;var b=a._parseValue(this.value);b=null!==b?b:this.value,a._setValue(b),null===a._state.error&&(this.value=a._displayValue)}),a._view.$input.addEventListener("keyup",function(b){if(13==b.keyCode)this.blur();else{a._options.onTouched();var c=a._parseValue(this.value);c=null!==c?c:this.value;var d=a._state.error;a._displayValue=a._formatDisplayValue(c),a._state.error=a._validate(c),SO.Utils.isEqual(d,a._state.error)||(a._options.errorDisplay(a._state.error),a._refreshDisplay(!1))}}))},_createMarkup:function(){var a=this._options;this.$el.addClass("nlui-number nlui-input nlui-input-fullwidth"),this.$el.empty(),this._view={},this._state.disabled?(SO.tie(this._view,{tag:"label",cls:a.displayParams.className}),this.$el.append(this._view.el)):(SO.tie(this._view,{tag:"div",cld:[{tag:"i",cls:["decorative-icon",a.icon?"soui-icon-18-"+a.icon:""].join(" "),field:"$inputIcon"},{tag:"input",type:"text",cls:[a.displayParams.className,a.icon?"has-icon":"",a.clearable?"clearable":""].join(" "),placeholder:a.placeHolder?a.placeHolder:"",field:"$input"}]}),a.icon&&this.$el.append(this._view.$inputIcon),this.$el.append(this._view.$input))},setValue:function(a){var b=this._state.error;this._value=this._options.params.protectInternalValue?a:this._parseValue(this._formatDisplayValue(a))||a,this._displayValue=this._formatDisplayValue(a),this._state.strict=!0,this._state.error=this._validate(this._value),SO.Utils.isEqual(b,this._state.error)||this._options.errorDisplay(this._state.error),this._refreshDisplay(!1),this._options.onExternalChange(this._state.error,this._state.strict)},_setValue:function(a){if(this._state.strict=!0,!SO.Utils.isEqual(this._value,a)){var b=this._state.error;this._value=this._options.params.protectInternalValue?a:this._parseValue(this._formatDisplayValue(a))||a,this._displayValue=this._formatDisplayValue(a),this._state.error=this._validate(a),SO.Utils.isEqual(b,this._state.error)||(this._options.errorDisplay(this._state.error),this._refreshDisplay(!1)),this._options.onInternalChange(this._value,this._state.error,this._state.strict)}},_formatDisplayValue:function(a){if(void 0===a||null===a)return a;if(this._options.displayFormat)return SO.Format.formatValue(a,this._options.displayFormat,{locale:this._options.locale,timezone:this._options.timezone});switch(this._options.params.type){case"float":return SO.isFloat(a)?SO.Float.format(a,this._getFormat()):a;case"integer":return SO.isInteger(a)?SO.Integer.format(a,this._getFormat()):a}},_parseValue:function(a){if(void 0===a)return a;switch(this._options.params.type){case"float":return SO.Float.safeParse(a,{defaultValue:null});case"integer":return SO.Integer.safeParse(a,{defaultValue:null})}},_getFormat:function(){var a={};switch(this._options.params.type){case"integer":a.decimalPlaces=0;break;case"float":a.decimalPlaces=this._options.params.decimalPlaces,a.significantFigures=this._options.params.significantFigures}return null!==this._options.params.unit&&(a.addSymbol=!0,a.symbol=this._options.params.unit),a},_getErrorMessage:function(a){var b,c=this._options.params;switch(a){case"min":b=c.range.max?xtk_sirocco.number_outOfRangeMinMaxErr(c.range.min,c.range.max):c.range.downStrict?xtk_sirocco.number_outOfRangeMinStrictErr(c.range.min):xtk_sirocco.number_outOfRangeMinErr(c.range.min);break;case"max":b=c.range.min?xtk_sirocco.number_outOfRangeMinMaxErr(c.range.min,c.range.max):c.range.upStrict?xtk_sirocco.number_outOfRangeMaxStrictErr(c.range.max):xtk_sirocco.number_outOfRangeMaxErr(c.range.max)}return b}}),$.widget("SO.soNumberInput",{_create:function(){this._widget=new SO.Widgets.NumberInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("PasswordInput","Input",{DEFAULT_OPTIONS:{params:{minLength:null,maxLength:null,forceNumber:!1,forceCapitalChar:!1,forceSpecialChar:!1}},_create:function(){var a=this;this._checks=[{requirement:function(){return!0&&(a._state.strict||!SO.isNundef(a._value))&&null!==a._value},test:function(a){return SO.isString(a)},instant:!0,error:{message:xtk_sirocco.inputs_incorrectValueErr()}},{requirement:function(){return null!==a._options.params.maxLength&&null!==a._value},test:function(b){return b.length<=a._options.params.maxLength},error:{message:xtk_sirocco.password_maxCharErr(a._options.params.maxLength)},instant:!0},{requirement:function(){return null!==a._options.params.minLength&&null!==a._value},test:function(b){return b.length>=a._options.params.minLength},error:{message:xtk_sirocco.password_minCharErr(a._options.params.minLength)}},{requirement:function(){return a._options.params.forceNumber&&null!==a._value},test:function(a){return null!==a.match(/\d/)},error:{message:xtk_sirocco.password_atLeastOneDigit()}},{requirement:function(){return a._options.params.forceCapitalChar&&null!==a._value},test:function(a){return null!==a.match(/[A-Z]/)},error:{message:xtk_sirocco.password_atLeastOneCapital()}},{requirement:function(){return a._options.params.forceSpecialChar&&null!==a._value},test:function(a){return null!==a.match(/[?!@#\$%\^&\*()_\+\-={}\[\]\\:;"'<>,.\/]/)},error:{message:xtk_sirocco.password_atLeastOneSpecialChar()}}],this._super()},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents()),this._state.disabled?(this._displayValue=Array(this._value.length+1).join("\u2022"),this._view.el.innerHTML=this._displayValue):(this._state.readOnly||null===this._state.error?(null===this._state.error&&this._view.$input.classList.contains("nlui-state-error")||this._state.readOnly)&&this._view.$input.classList.remove("nlui-state-error"):this._view.$input.classList.add("nlui-state-error"),this._view.$input.disabled=this._state.readOnly,this._view.$input.value=this._displayValue)},_bindEvents:function(){var a=this;a._state.disabled||(this._view.$input.addEventListener("blur",function(){a._focused=!1;var b=$(this).val();a._setValue(b)}),this._view.$input.addEventListener("focus",function(){a._focused=!0}),this._view.$input.addEventListener("keyup",function(b){if(13==b.keyCode)this.blur();else{var c=$(this).val();a._options.onTouched(c);var d=a._state.error;a._displayValue=c,a._state.error=a._validate(c),SO.Utils.isEqual(d,a._state.error)||a._refreshDisplay(!1)}}))},_createMarkup:function(){var a=this._options;this.$el.addClass("nlui-password nlui-input nlui-input-fullwidth"),this.$el.empty(),this._view={},this._state.disabled?(SO.tie(this._view,{tag:"label",cls:a.displayParams.className}),this.$el.append(this._view.el)):(SO.tie(this._view,{tag:"div",cld:[{tag:"i",cls:["decorative-icon",a.icon?"soui-icon-18-"+a.icon:""].join(" "),field:"$inputIcon"},{tag:"input",type:"password",cls:[a.displayParams.className,a.icon?"has-icon":"",a.clearable?"clearable":""].join(" "),placeholder:a.placeHolder?a.placeHolder:"",field:"$input"}]}),a.icon&&this.$el.append(this._view.$inputIcon),this.$el.append(this._view.$input))}}),$.widget("SO.soPasswordInput",{_create:function(){this._widget=new SO.Widgets.PasswordInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("MemoInput","Input",{DEFAULT_OPTIONS:{fullHeight:!1,params:{rows:4,minLength:null,maxLength:null}},_create:function(){var a=this;this._checks=[{requirement:function(){return null!==a._options.params.maxLength&&null!==a._value},test:function(b){return b.length<=a._options.params.maxLength},error:{message:xtk_sirocco.memo_maxCharErr(a._options.params.maxLength)},instant:!0},{requirement:function(){return null!==a._options.params.minLength&&null!==a._value},test:function(b){return b.length>=a._options.params.minLength},error:{message:xtk_sirocco.memo_minCharErr(a._options.params.minLength)}}],this._super()},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents()),this._state.disabled?this._view.el.innerHTML=this._getSafeDisplayValue():(this._state.readOnly||null===this._state.error?(null===this._state.error&&this._view.el.classList.contains("nlui-state-error")||this._state.readOnly)&&this._view.el.classList.remove("nlui-state-error"):this._view.el.classList.add("nlui-state-error"),this._view.el.disabled=this._state.readOnly,this._view.el.value=this._displayValue)},_bindEvents:function(){var a=this;this._options.params,a._state.disabled||(this._view.el.addEventListener("blur",function(){a._focused=!1;var b=$(this).val();a._setValue(b)}),this._view.el.addEventListener("focus",function(){a._focused=!0}),this._view.el.addEventListener("keyup",function(){var b=$(this).val();if(a._options.onTouched(b),!SO.Utils.isEqual(a._value,b)){var c=a._state.error;a._displayValue=b,a._state.error=a._validate(b),SO.Utils.isEqual(c,a._state.error)||(a._options.errorDisplay(a._state.error),a._refreshDisplay(!1))}}))},_createMarkup:function(){var a=this._options;this.$el.addClass("nlui-memo nlui-input nlui-input-fullwidth"),this._options.fullHeight&&this.$el.addClass("nlui-input-fullheight"),this.$el.empty(),this._view={},this._state.disabled?(SO.tie(this._view,{tag:"label",cls:a.displayParams.className}),this.$el.append(this._view.el)):(SO.tie(this._view,{tag:"textarea",placeholder:a.placeHolder?a.placeHolder:"",cls:a.displayParams.className,rows:a.params.rows}),this.$el.append(this._view.el))}}),$.widget("SO.soMemoInput",{_create:function(){this._widget=new SO.Widgets.MemoInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("SearchInput","Input",{DEFAULT_OPTIONS:{params:{livePropagation:!0,delay:400}},_create:function(){var a=this;this._checks=[{requirement:function(){return null!==a._value},test:function(a){return SO.isString(a)},error:{message:xtk_sirocco.inputs_incorrectValueErr()}}],this._super()},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents()),this._state.readOnly||null===this._state.error?(null===this._state.error&&this._$content.hasClass("nlui-state-error")||this._state.readOnly)&&this._$content.removeClass("nlui-state-error"):this._$content.addClass("nlui-state-error"),this._$content.prop("disabled",this._state.readOnly),this._state.disabled?this._$content.text(this._getSafeDisplayValue()):(SO.isNundef(this._value)||""===this._value?this._$resetButton.hide():this._$resetButton.show(),SO.isNundef(this._displayValue)?this._$content.val(null):this._$content.val(this._displayValue)),a&&this.$el.append(this._$content,this._$iconLeft,this._$resetButton)},_bindEvents:function(){var a=this;this._options.params.livePropagation?this._$content.keyup(SO.Utils.debounce(function(){var b=$(this).val();a._setValue(b)},this._options.params.delay,!1)):(this._$content.keypress(function(b){if(13===b.which){var c=$(this).val();a._setValue(c)}}),this._$content.blur(function(){var b=$(this).val();a._setValue(b)})),this._state.disabled||this._$resetButton.click(function(){a._setValue("")})},_createMarkup:function(){this._$content&&this._$content.remove(),this.$el.addClass("nlui-search nlui-input"),this._state.disabled?this._$content=$('<label class="nlui-input-readonly"></label>'):(this._$iconLeft=$('<span class="nlui-search-button nlui-search-search nlui-icon nlui-icon-search"></span>'),this._$resetButton=$('<span class="nlui-search-button nlui-search-reset nlui-icon nlui-icon-closethick"></span>'),this._$content=$('<input placeholder="'+xtk_sirocco.search_placeHolder()+'" />'))}}),$.widget("SO.soSearchInput",{_create:function(){this._widget=new SO.Widgets.SearchInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("VariantInput","Input",{DEFAULT_OPTIONS:{params:{type:"text",widgetOptions:{}}},_create:function(){this._type=this._options.params.type,this._widgetsOptions={},this._widgetsOptions[this._type]=this._options.params.widgetOptions,this._values={},this._values[this._type]=this._options.value,this._state={},this._state.error=this._options.error,this._state.readOnly=this._options.readOnly,this._state.disabled=this._options.disabled,this._state.strict=this._options.strict,this._state.mandatory=this._options.mandatory,this._errors={},this._errors[this._type]=this._state.error,this._embededType=this._getEmbededType(),this._$text=$('<div class="nlui-variant-container"></div>'),this._$text[this._embededType]({params:this._widgetsOptions[this._type].params,value:this._values[this._type],error:this._state.error,readOnly:this._state.readOnly,disabled:this._state.disabled,mandatory:this._state.mandatory,strict:this._state.strict}),this._errors[this._type]=this._validate(this._values[this._type],!0),this._refreshDisplay(!0),null!==this._errors[this._type]&&this._options.onInternalChange(this._values[this._type],this._errors[this._type])},_refreshDisplay:function(a){a&&(this._createMarkup(),this._$text.appendTo(this.$el))},_createMarkup:function(){this._$text&&this._$text.remove();var a=this;this.$el.addClass("nlui-variant nlui-input"),this._embededType=this._getEmbededType(),this._$text=$('<div class="nlui-variant-container"></div>'),this._$text[this._embededType]({value:this._values[this._type],params:this._widgetsOptions[this._type].params,error:this._errors[this._type],readOnly:this._state.readOnly,disabled:this._state.disabled,mandatory:this._state.mandatory,onInternalChange:function(b,c){a._setValue(b),SO.Utils.isEqual(c,a._errors[a._type])||a.setError(c)},onExternalChange:function(b){SO.Utils.isEqual(b,a._errors[a._type])||a.setError(b),a._options.onExternalChange(b)},errorDisplay:a._options.errorDisplay})},_getEmbededType:function(){switch(this._type){case"text":return"soTextInput";case"memo":return"soMemoInput";case"number":return"soNumberInput";default:throw"Unknown type for soVariantInput: "+type}},setType:function(a){this._type=a,this._state.strict=!1,this._errors[this._type]||(this._errors[this._type]=null),this._widgetsOptions[this._type]||(this._widgetsOptions[this._type]={}),this._refreshDisplay(!0)},_setValue:function(a){this._state.strict=!0,SO.Utils.isEqual(this._values[this._type],a)||(this._errors[this._type],this._values[this._type]=a,this._errors[this._type]=this._validate(this._value),this._options.onInternalChange(a,this._errors[this._type]))},setValue:function(a){this._values[this._type]=a,this._state.strict=!0,this._errors[this._type]=this._validate(this._values[this._type]),this._$text[this._embededType]("setValue",a)},setEmbededWidgetParamSubtree:function(a,b){this._$text[this._embededType]("setParamSubtree",a,b);for(var c=new SO.Structure.Jpath(a),d={},e=d,f=0;c.getPartsCount()>f;++f){var g=c.getItem(f).key;f!==c.getPartsCount()-1?e=e[g]=e[g]||{}:e[g]=b}this._widgetsOptions[this._type].params=$.extend(!0,{},this._widgetsOptions[this._type].params,d)},setError:function(a){this._errors[this._type]=a,this._$text[this._embededType]("setError",a)},setReadOnly:function(a){this._state.readOnly=a,this._$text[this._embededType]("setReadOnly",a)},setDisabled:function(a){this._state.disabled=a,this._$text[this._embededType]("setDisabled",a)},setStrict:function(a){this._state.strict=a,this._$text[this._embededType]("setStrict",a)},setMandatory:function(a){this._state.mandatory=a,this._$text[this._embededType]("setMandatory",a)},getValue:function(){return this._values[this._type]},_validate:function(a,b){return this._$text[this._embededType]("check",a,b)}}),$.widget("SO.soVariantInput",{_create:function(){this._widget=new SO.Widgets.VariantInput(this.element,this.options)},setType:function(a){this._widget.setType(a)},setEmbededWidgetParams:function(a,b){this._widget.setEmbededWidgetParams(a,b)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},setEmbededWidgetParamSubtree:function(a,b){this._widget.setEmbededWidgetParamSubtree(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("OptionswitcherInput","Input",{DEFAULT_OPTIONS:{params:{labels:"on/off",style:"buttons",caption:""}},_create:function(){this._$buttonTrue=$(),this._$buttonFalse=$(),this._$wrapper=$(),this._$checkbox=$(),this._checks=[{requirement:function(){return!0},test:function(a){return SO.isBoolean(a)},error:{message:xtk_sirocco.inputs_incorrectValueErr()}}],this._super()},_refreshDisplay:function(a){if(a&&this._createMarkup(),this._state.readOnly&&null===this._state.error)if(SO.isNundef(this._displayValue))this._$label.text("");else{var b=this._getSwitcherLabels(),c=this._displayValue?0:1;this._$label.text(b[c])}else switch(this._state.disabled||this._state.readOnly||null===this._state.error?(null===this._state.error&&this._$wrapper.hasClass("nlui-state-error")||this._state.disabled)&&this._$wrapper.removeClass("nlui-state-error"):this._$wrapper.addClass("nlui-state-error"),this._options.params.style){case"buttons":null===this._state.error?SO.isNundef(this._displayValue)?(this._$buttonTrue.soButton("setMode","default"),this._$buttonFalse.soButton("setMode","default")):this._displayValue?(this._$buttonTrue.soButton("setMode","primary"),this._$buttonFalse.soButton("setMode","default")):(this._$buttonFalse.soButton("setMode","primary"),this._$buttonTrue.soButton("setMode","default")):(this._$buttonTrue.soButton("setMode","default"),this._$buttonFalse.soButton("setMode","default")),this._state.disabled?(this._$buttonTrue.soButton("disable"),this._$buttonFalse.soButton("disable"),null!==this._state.error&&(this._$buttonTrue.soButton("setMode","default"),this._$buttonFalse.soButton("setMode","default"))):(this._$buttonTrue.soButton("enable"),this._$buttonFalse.soButton("enable"));break;case"checkbox":this._$checkbox.prop("checked",this._displayValue),this._$checkbox.prop("disabled",this._state.disabled)}a&&this._$wrapper.append(this._$markup).appendTo(this.$el)},_createMarkup:function(){this._$wrapper&&this._$wrapper.remove(),this.$el.addClass("nlui-optionswitcher"),this._$wrapper=$('<div class="nlui-optionswitcher-wrapper"></div>');var a=this._getSwitcherLabels();if(this._state.readOnly)this._$label=$('<label class="nlui-input-readonly"></label>'),this._$markup=this._$label,this._$markup.addClass(this._options.displayParams.className);else switch(this._options.params.style){case"buttons":var b=this;this._$buttonTrue=$('<span class="normal"></span>').soButton({label:a[0],onClick:function(){var a=!0;b._setValue(a)}}),this._$buttonFalse=$('<span class="normal"></span>').soButton({label:a[1],onClick:function(){var a=!1;b._setValue(a)}}),this._$markup=$("<div></div>").append(this._$buttonTrue).append(this._$buttonFalse);break;case"checkbox":var b=this,c=SO.Utils.sequence().nextVal();this.$el.addClass("nlui-optionswitcher-checkbox"),this._$checkbox=$('<input id="'+c+'" type="checkbox" />').click(function(){var a=!b._value;b._setValue(a)}),this._$markup=$("<div class='nlui-optionswitcher-checkbox-container'></div>").append(this._$checkbox).append($("<label for="+c+" ></label>").text(this._options.params.caption))}},_getSwitcherLabels:function(){var a=[];if($.isArray(this._options.params.labels))a.push(this._options.params.labels[0]),a.push(this._options.params.labels[1]);else switch(this._options.params.labels){case"on/off":a.push(xtk_sirocco.optionSwitcher_on()),a.push(xtk_sirocco.optionSwitcher_off());break;case"true/false":a.push(xtk_sirocco.optionSwitcher_true()),a.push(xtk_sirocco.optionSwitcher_false());break;case"yes/no":a.push(xtk_sirocco.optionSwitcher_yes()),a.push(xtk_sirocco.optionSwitcher_no());break;case"0/1":a.push("1"),a.push("0");break;default:a.push(xtk_sirocco.optionSwitcher_true()),a.push(xtk_sirocco.optionSwitcher_false())}return a}}),$.widget("SO.soOptionSwitcher",{_create:function(){this._widget=new SO.Widgets.OptionswitcherInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){function a(a,b,c){return b>a&&(a=b),a>c&&(a=c),a}function b(a){var b={h:0,s:0,b:0},c=Math.min(a.r,a.g,a.b),d=Math.max(a.r,a.g,a.b),e=d-c;return b.b=d,b.s=0!==d?255*e/d:0,b.h=0!==b.s?a.r===d?(a.g-a.b)/e:a.g===d?2+(a.b-a.r)/e:4+(a.r-a.g)/e:-1,b.h*=60,0>b.h&&(b.h+=360),b.s*=100/255,b.b*=100/255,b}function c(a){var b={},c=Math.round(a.h),d=Math.round(255*a.s/100),e=Math.round(255*a.b/100);if(0===d)b.r=b.g=b.b=e;else{var f=e,g=(255-d)*e/255,h=(f-g)*(c%60)/60;360===c&&(c=0),60>c?(b.r=f,b.b=g,b.g=g+h):120>c?(b.g=f,b.b=g,b.r=f-h):180>c?(b.g=f,b.r=g,b.b=g+h):240>c?(b.b=f,b.r=g,b.g=f-h):300>c?(b.b=f,b.g=g,b.r=g+h):360>c?(b.r=f,b.g=g,b.b=f-h):(b.r=0,b.g=0,b.b=0)}return{r:Math.round(b.r),g:Math.round(b.g),b:Math.round(b.b)}}function d(a){var b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];return $.each(b,function(a,c){1===c.length&&(b[a]="0"+c)}),"#"+b.join("")}function e(a){return d(c(a))}SO.Widgets.define("ColorInput","Input",{CARDS:{palette:{icon:"coral-eyedropper",getBody:function(){return this._gridCard.el},refresh:function(a){this._refreshPaletteCard(a)}},opacity:{icon:"coral-transparency",getBody:function(){return this._opacityCard.el},refresh:function(a){this._refreshOpacityCard(a)}},details:{icon:"coral-edit",getBody:function(){return this._detailsCard.el},refresh:function(a){this._refreshDetailsCard(a)}}},DEFAULT_OPTIONS:{value:new SO.Color("rgba (0, 0, 0, 0)"),params:{target:null,cards:["palette","opacity","details"]}},_create:function(){this.$el.addClass("nlui-input nlui-colorpicker"),this._target=this._options.params.target,this._super()},_refreshDisplay:function(a){a&&(this._unbindEvents(),this._createMarkup(),this._bindEvents()),this._state.readOnly&&this.$el.addClass("nlui-colorpicker-readonly"),this._value&&!this._options.params.target&&(this._preview.color.style.backgroundColor=this._getColorFromFormatedValue(this._value).toString("rgb"))},_unbindEvents:function(){this._onMouseDown&&$(document).off("mousedown.nlui-colorpicker-panel touchstart.nlui-colorpicker-panel",".nlui-colorpicker-grid, .nlui-colorpicker-slider, .nlui-colorpicker-opacity-slider",this._onMouseDown),this._onMouseMove&&$(document).off("mousemove touchmove",this._onMouseMove),this._onMouseUp&&$(document).off("mouseup touchend",this._onMouseUp)},_bindEvents:function(){var a=this;this._onMouseMove=function(b){b.preventDefault(),a._pickerMove(a._target,b.originalEvent,!0)},this._onMouseUp=function(){a._tempColor&&a._setValue(a._getFormatedValue(a._tempColor)),a._target=null,a._tempColor=null,$(document).off("mousemove touchmove",a._onMouseMove)},this._onMouseDown=function(b){SO.DOMUtils.isDescendantOf(this,a._popoverContent.el)&&(a._target=this,a._onMouseMove(b),$(document).on("mousemove touchmove",a._onMouseMove),$(document).one("mouseup touchend",a._onMouseUp))},$(document).on("mousedown.nlui-colorpicker-panel touchstart.nlui-colorpicker-panel",".nlui-colorpicker-grid, .nlui-colorpicker-slider, .nlui-colorpicker-opacity-slider",this._onMouseDown)},_createMarkup:function(){var a=this,b=this._options.params;b.cards=SO.Utils.unique(b.cards),this._activeCard=b.cards[0],this._gridCard={},this._opacityCard={},this._detailsCard={},this._popoverContent={},this._menuButtons={},this.$el.empty(),SO.tie(this._gridCard,{tag:"div",cls:"nlui-colorpicker-palette-card",cld:[{tag:"div",cls:"nlui-colorpicker-card-header",cld:[{tag:"label",cls:"nlui-colorpicker-card-title",text:xtk_sirocco.colorPicker_palette_title()},{tag:"label",cls:"nlui-colorpicker-card-header-extralabel",field:"hexLabel"}]},{tag:"div",cls:"nlui-colorpicker-panel",cld:[{tag:"div",cls:"nlui-colorpicker-grid",field:"grid",cld:[{tag:"div",cls:"nlui-colorpicker-grid-saturation",cld:[{tag:"div",cls:"nlui-colorpicker-grid-val"},{tag:"div",cls:"nlui-colorpicker-picker grid-picker",field:"gridPicker",cld:[{tag:"div"}]}]}]},{tag:"div",cls:"nlui-colorpicker-slider",field:"hueSlider",cld:[{tag:"div",cls:"nlui-colorpicker-picker hue-picker",field:"huePicker"}]}]}]}),SO.tie(this._opacityCard,{tag:"div",cls:"nlui-colorpicker-opacity-card",cld:[{tag:"div",cls:"nlui-colorpicker-card-header",cld:[{tag:"label",cls:"nlui-colorpicker-card-title",text:xtk_sirocco.colorPicker_opacity_title()},{tag:"label",cls:"nlui-colorpicker-card-header-extralabel",field:"hexLabel"}]},{tag:"div",cls:"nlui-colorpicker-opacity",field:"opacitySlider"}]}),this._opactityInput=new SO.Widgets.NumberInput(a._opacityCard.opacitySlider,{params:{unit:"%",range:{min:0,max:100}},onInternalChange:function(b){var c=new SO.Color(a._getColorFromFormatedValue(a._value));c.setAlpha(b/100),a._setValue(a._getFormatedValue(c)),a._refreshOpacityCard()}}),SO.tie(this._detailsCard,{tag:"div",cls:"nlui-colorpicker-details-card",cld:[{tag:"div",cls:"nlui-colorpicker-card-header",cld:[{tag:"label",cls:"nlui-colorpicker-card-title",text:xtk_sirocco.colorPicker_details_title()},{tag:"label",cls:"nlui-colorpicker-card-header-extralabel",field:"hexLabel"}]},{tag:"div",cls:"nlui-colorpicker-form",cld:[{tag:"div",cls:"nlui-colorpicker-row",cld:[{tag:"span",text:"Hex"},{tag:"div",field:"hexInput"}]},{tag:"div",cls:"nlui-colorpicker-row",cld:[{tag:"span",text:"RGB"},{tag:"div",field:"rInput"},{tag:"div",field:"gInput"},{tag:"div",field:"bInput"}]}]}]});var c=function(b,c){if(!c){var d=new SO.Color(SO.Color.safeParse(a._detailsInputs.hex.getValue())),e=a._getColorFromFormatedValue(a._value);d.setAlpha(e.getAlpha()),d._valid?(e.toString("hex6")!==d.toString("hex6")&&0===d.getAlpha()&&d.setAlpha(1),a._setValue(a._getFormatedValue(d)),a._refreshDetailsCard()):a._detailsInputs.hex.setError({message:""})}},d=function(b,c){if(!c){var d=new SO.Color({r:a._detailsInputs.r.getValue(),g:a._detailsInputs.g.getValue(),b:a._detailsInputs.b.getValue(),a:a._opactityInput.getValue()/100});if(d._valid){var e=a._getColorFromFormatedValue(a._value);e.toString("hex6")!==d.toString("hex6")&&0===d.getAlpha()&&d.setAlpha(1),a._setValue(a._getFormatedValue(d)),a._refreshDetailsCard()}}},e={onInternalChange:d,params:{range:{min:0,max:255}}};this._detailsInputs={hex:new SO.Widgets.TextInput(this._detailsCard.hexInput,{onInternalChange:c}),r:new SO.Widgets.NumberInput(this._detailsCard.rInput,e),g:new SO.Widgets.NumberInput(this._detailsCard.gInput,e),b:new SO.Widgets.NumberInput(this._detailsCard.bInput,e)},SO.tie(this._popoverContent,{tag:"div",cls:"nlui-colorpicker-popover",cld:[{tag:"div",cls:"nlui-colorpicker-popover-menu",field:"menu"}]}),SO.Utils.each(b.cards,function(c,d){var e={},f=a.CARDS[d];SO.tie(e,{tag:"div",cls:(d===a._activeCard?"active ":"")+"nlui-colorpicker-card",cld:[{tag:"div",cls:"nlui-colorpicker-card-body",field:"body"}]}),a._menuButtons[d]=new SO.Widgets.SimpleButton($("<div></div>"),{onClick:function(){SO.Utils.each(b.cards,function(b,c){a.CARDS[c],a._menuButtons[c].setPushed(!1)}),a._menuButtons[d].setPushed(!0),a._menuButtons[d].setIcon(f.icon),a._popoverContent.el.querySelector(".active").classList.remove("active"),e.el.classList.add("active"),a._activeCard=d,a._refreshActiveCard()},icon:f.icon,iconSize:18,mode:"quiet"}),d===a._activeCard&&a._menuButtons[d].setPushed(!0),f.getBody&&e.body.appendChild(f.getBody.call(a)),a._popoverContent.menu.appendChild(a._menuButtons[d].el),a._popoverContent.el.insertBefore(e.el,a._popoverContent.menu)}),b.target||(this._preview={},SO.tie(this._preview,{tag:"div",cls:"nlui-colorpicker-preview",cld:[{tag:"div",cls:"nlui-colorpicker-preview-color",field:"color"}]}),this._target=this._preview.el),this.$el.append(this._target),this._state.readOnly||new SO.Widgets.popover(this._target,{params:{displayOn:"click",gravity:"e",content:this._popoverContent.el,onShow:function(){a._refreshActiveCard()}}})},_refreshActiveCard:function(a){this.CARDS[this._activeCard].refresh&&this.CARDS[this._activeCard].refresh.call(this,a)},_pickerMove:function(b,c){var d=b.querySelector("[class$=-picker]"),f=d.getBoundingClientRect(),g=b.getBoundingClientRect(),h=g.left,i=g.top,j=d.classList.contains("grid-picker")?4:2,k=Math.round(c.pageX-h-f.width/j),l=Math.round(c.pageY-i-f.height/j);0-f.width/j>k&&(k=-(f.width/j)),0-f.height/j>l&&(l=-(f.height/j)),k>g.width-f.width/j&&(k=g.width-f.width/j),l>g.height-f.height/j&&(l=g.height-f.height/j),d===this._gridCard.gridPicker?(d.style.left=k+"px",d.style.top=l+"px"):d.style.top=l-1+"px";var m=this._getCoord(this._gridCard.huePicker),n=this._gridCard.hueSlider.getBoundingClientRect(),o=this._getCoord(this._gridCard.gridPicker),p=this._gridCard.grid.getBoundingClientRect(),q=a(360-parseInt(m.y*(360/n.height),10),0,360),r=a(Math.floor(o.x*(100/p.width)),0,100),s=a(100-Math.floor(o.y*(100/p.height)),0,100),t=this._getColorFromFormatedValue(this._value);this._tempColor=new SO.Color(e({h:q,s:r,b:s})),this._tempColor.setAlpha(t.getAlpha()),t.toString("hex6")!==this._tempColor.toString("hex6")&&0===this._tempColor.getAlpha()&&this._tempColor.setAlpha(1),this._options.params.target||(this._preview.color.style.backgroundColor=this._tempColor.toString("rgb")),this._refreshPaletteCard(!0)},_getCoord:function(a){var b,c,d=a.parentNode,e=a.getBoundingClientRect(),f=d.getBoundingClientRect();return a?(b=e.left,c=e.top,{x:b-f.left+e.width/2,y:c-f.top+e.height/2}):null},_refreshPaletteCard:function(c){var d=this._getColorFromFormatedValue(this._value),f=this._tempColor?this._tempColor.getRgb():d.getRgb(),g=b(f),h=this._gridCard.grid;if(0===g.s&&(g.h=0),!c){var i,j,k=h.getBoundingClientRect(),l=this._gridCard.gridPicker,m=l.getBoundingClientRect(),n=this._gridCard.hueSlider,o=n.getBoundingClientRect(),p=this._gridCard.huePicker,q=p.getBoundingClientRect();i=a(Math.ceil(g.s/(100/k.width)),0,k.width),j=a(k.height-Math.ceil(g.b/(100/k.height)),0,k.height),l.style.top=j-m.height/4+"px",l.style.left=i-m.width/4+"px",j=a(o.height-g.h/(360/o.height),0,o.height),p.style.top=j-q.height/2+"px"}g.s>0&&(h.style.backgroundColor=e({h:g.h,s:100,b:100}));var d=this._getColorFromFormatedValue(this._value),r=this._tempColor?this._tempColor:d,s=100*r.getAlpha();this._gridCard.hexLabel.innerHTML=r.toString("hex6")+(null!==s&&100>s?", "+s+"%":"")},_refreshOpacityCard:function(){var a=this._getColorFromFormatedValue(this._value);this._opactityInput.setValue(100*a.getAlpha());var b=100*a.getAlpha();this._opacityCard.hexLabel.innerHTML=a.toString("hex6")+(null!==b&&100>b?", "+b+"%":"")},_refreshDetailsCard:function(){var a=this._getColorFromFormatedValue(this._value);this._detailsInputs.hex.setValue(a.toString("hex6")),this._detailsInputs.r.setValue(a.getRgb().r),this._detailsInputs.g.setValue(a.getRgb().g),this._detailsInputs.b.setValue(a.getRgb().b)},setValue:function(a){this._super(a),this._refreshActiveCard()},_getFormatedValue:function(a){return a},_getColorFromFormatedValue:function(a){return a}})})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("DropdownInput","Input",{DEFAULT_OPTIONS:{params:{items:[],maxHeight:null,minWidth:50,instruction:null,width:null,style:null}},_applyParamChanges:function(a){a.map(function(a){return a.contains("items")}).length>0&&(this._items=this._params.items,this._selectDefaultValue(),this._refreshDisplay(!0)),this._super()},_selectDefaultValue:function(){null!=this._value&&(this._selectedItem=this._getItemByValue(this._value)),this._items.length>0&&(null===this._value&&null===this._params.instruction||!this._selectedItem)&&(this._value=this._items[0].name,this._selectedItem=this._items[0]),0===this._items.length&&(this._value=null,this._state={readOnly:!0})},_refreshDisplay:function(a){a&&(null!==this._header&&this.el.removeChild(this._header.el),null!==this._drop&&null!==this._drop.el.parentNode&&document.body.removeChild(this._drop.el),this._createMarkup(),this._bindEvents()),this._selectedItem&&this._selectedItem.icon?(this._header._$headerItemIcon.className=this._selectedItem.icon,this._header._$headerItemIcon.style.display=""):this._header._$headerItemIcon.style.display="none",this._header._$headerItemText.textContent=this._selectedItem?this._selectedItem.label:this._params.instruction,this._state.readOnly&&this.el.classList.add("nlui-dropdown-disabled"),this._state.disabled&&this.el.classList.add("nlui-state-readonly")},_create:function(){var a=this;this.$el.addClass("nlui-input nlui-dropdown nlui-input-fullwidth"),this._params=this._options.params,this._items=this._params.items,this._selectedItem=null,this._value=this._options.value,this._drop=null,this._header=null,this._options.popableManager.addPopable({isOwnerOf:function(b){return SO.DOMUtils.isDescendantOf(b,$(a.$el))||b.is(a.$el)||SO.DOMUtils.isDescendantOf(b,a._drop.el)},collapse:function(){a.close()}}),this._selectDefaultValue(),this._super()},_bindEvents:function(){var a=this;this._header._$headerItem.addEventListener("click",function(){a._state.disabled||a._state.readOnly||(a._header._$headerItem.classList.contains("open")?a.close():a.open())}),this._drop._$listContainer.addEventListener("mousewheel",function(a){a.stopPropagation()})},_createMarkup:function(){this._header=SO.tie({},{tag:"div",cls:"nlui-dropdown-header",cld:[{tag:"div","class":"nlui-dropdown-header-item",field:"_$headerItem",cld:[{tag:"i","class":"nlui-dropdown-header-item-icon",field:"_$headerItemIcon"},{tag:"div","class":"nlui-dropdown-header-item-text",field:"_$headerItemText"},{tag:"i","class":"nlui-dropdown-header-item-arrow soui-icon-12-list-switcher-arrow"}]}]}),this._drop=SO.tie({},{tag:"div","class":"nlui-dropdown-list",cld:[{tag:"ul",field:"_$listContainer"}]}),this.$el.append(this._header.el)},_renderItem:function(a){var b,c,d,e=this,f=document.createElement("li");return function(a){SO.Event.bind(f,"vmousedown",function(){},{stopPropagation:!0}),SO.Event.bind(f,"vclick",function(){e._setValue(a.name),e.close()},{stopPropagation:!0})}(a),c=document.createElement("div"),c.className="nlui-dropdown-list-item-text-wrapper",b=document.createElement("div"),b.textContent=a.label,b.className="nlui-dropdown-list-item-text-content",a.icon&&(d=document.createElement("i"),d.className=a.icon,c.appendChild(d),c.addEventListener("mouseenter",function(){d.className=a.icon+"-over"}),c.addEventListener("mouseleave",function(){d.className=a.icon})),c.appendChild(b),f.appendChild(c),f},_createBeamList:function(){for(var a,b=0;this._items.length>b;b++)a=this._items[b],this._drop._$listContainer.appendChild(this._renderItem(a));return document.body.appendChild(this._drop.el),this._drop},setValue:function(a){var b=this._getItemByValue(a);this._selectedItem=b,this._super(a)},_setValue:function(a){var b=this._getItemByValue(a);this._selectedItem=b,this._super(a)},_getItemByValue:function(a){for(var b,c=0;this._items.length>c&&!b;c++)a===this._items[c].name&&(b=this._items[c]);return SO.assert(b||null===a,"Value '"+a+"' not found in dropdown items"),b},close:function(){this._header._$headerItem.classList.remove("open"),this._drop._$listContainer.style.display="none",this._drop._$listContainer.style.maxHeight=""},open:function(){null===this._drop.el.parentNode&&(this._drop=this._createBeamList(),this.setFloatable(this._drop._$listContainer)),this._header._$headerItem.classList.add("open");var a=this._header.el.getBoundingClientRect();this._drop.el.style.top=a.top+a.height+"px",this._drop.el.style.left=a.left+"px",this._drop.el.style.width=a.width+"px",this._overlay.show({targetEl:this.el})},setDisabled:function(a){a?this.el.classList.add("nlui-state-readonly"):this.el.classList.remove("nlui-state-readonly"),this._super(a)},setReadOnly:function(a){a?this.el.classList.add("nlui-dropdown-disabled"):this.el.classList.remove("nlui-dropdown-disabled"),this._super(a)}}),$.widget("SO.soDropdown",{_create:function(){this._widget=new SO.Widgets.DropdownInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("DateInput","Input",{DEFAULT_OPTIONS:{theme:"light",params:{selector:"year",userInput:!0,dataType:"partialdate",display:"lines"}},_create:function(){this._state={},this._state.error=this._options.error,this._state.readOnly=this._options.readOnly,this._state.disabled=this._options.disabled,this._state.strict=this._options.strict,this._state.mandatory=this._options.mandatory,this._maxZindex=null,this._userInput=!1,this._MONTH_DAYS=[31,null,31,30,31,30,31,31,30,31,30,31];var a=this,b=a._options.params;if(this._dataType=this._options.params.dataType,this._value=this._options.value,this._timeZone=this._options.timezone.getName(),this._selector=b.selector,this._checkInputValue(),this._currentDate=this._getCurrentDate().toJSON(),this._displayValue=null,this._tmpValue=null,this._isInit=!0,this._focused=!1,this._$text=null,this._starterButton=null,this._timePicker=null,this._$timePickerContainer=null,this._dateSelector=a._calendar(),"second"===this._selector){var c=this._value?new SO.PartialDate({type:"timeSecond",hour:this._value.hour,minute:this._value.minute,second:this._value.second}).toJSON():null,d={onInternalChange:function(){if(a._timePicker){var b=a._getTimeValue();a._setValue(b),a._$text&&(a._state.disabled?a._$text.text(a._formatDisplayValue(a._value)):a._$text.val(a._formatDisplayValue(a._value)))}},value:c,params:{flat:!0}};this._$timePickerContainer=$("<div></div>"),this._$timePickerContainer.addClass("timepicker-container"),this._timePicker=new SO.Widgets.TimeInput(this._$timePickerContainer,d)}this._format=this._getFormat();var e=this._options.locale.getSettings();this._daysName=SO.Utils.extend(!0,[],e.daysName),this._monthsName=SO.Utils.extend(!0,[],e.monthsName),this._quartersName=SO.Utils.extend(!0,[],e.quartersName),("quarter"===this._selector||"month"===this._selector)&&this._setNameDetails(),("day"===this._selector||"second"===this._selector)&&SO.Date.weekBeginsAt(this._daysName,1),this._quartersNameDetails=null,this._display=b.display,this._checks=[{requirement:function(){return a._state.mandatory},test:function(b){return!a._isValueEmpty(b)},error:{message:xtk_sirocco.dateSelector_errorEmptyDate()}},{requirement:function(a){return""!==a&&null!==a},test:function(a){return null===a?!0:SO.PartialDate.isValid(a)},error:{message:xtk_sirocco.dateSelector_errorBadDate()}}],this._state.error=this._validate(this._value,!0),this._options.displayParams.className=this._computeDisplayClasses(),this._refreshDisplay(!0),this._state.error&&(this._options.errorDisplay(this._state.error),this._options.onInternalChange(this._value,this._state.error,this._state.strict)),$("body").on("keyup",function(b){27===b.keyCode&&a._dateSelector._isOpen()&&a._dateSelector._close(null,!0)})},setTimeZone:function(a){this._timeZone=a},_getTimeValue:function(a){var b;b=a?a:this._value;var c=SO.Utils.extend(!0,{},this._timePicker.getValue());delete c.type;var d=SO.Utils.extend(!0,{},b,c);return d},_checkSetValue:function(a){switch(this._dataType){case"partialdate":return a;case"dateonly":if(SO.isDateOnly(a))return new SO.PartialDate({type:"day",year:a.getYear(),month:a.getMonth(),day:a.getDay()}).toJSON();break;case"datetime":if(SO.isDateTime(a)){var b=a.getComponents(this._timeZone);return new SO.PartialDate({type:"second",year:b.year,month:b.month,day:b.day,hour:b.hours,minute:b.minutes,second:b.seconds}).toJSON()}break;default:SO.log.error("Widget dateSelector :"+this._dataType+"is not a valid date type")}return null},_getLocalizedDate:function(){if(SO.isDateTime(this._value)){var a=this._value.getComponents(this._timeZone);this._value=new SO.PartialDate({type:"second",year:a.year,month:a.month,day:a.day,hour:a.hours,minute:a.minutes,second:a.seconds}).toJSON()}},_checkInputValue:function(){switch(SO.isDateOnly(this._value)&&(this._dataType="dateonly"),SO.isDateTime(this._value)&&(this._dataType="datetime"),this._dataType){case"partialdate":break;case"dateonly":this._selector="day",SO.isDateOnly(this._value)&&(this._value=new SO.PartialDate({type:"day",year:this._value.getYear(),month:this._value.getMonth(),day:this._value.getDay()}).toJSON());break;case"datetime":this._selector="second",this._getLocalizedDate();break;default:SO.log.error("Widget dateSeslector :"+this._dataType+"is not a valid date type")}},_checkOutputValue:function(a){var b;if(!a)return null;switch(b=a,this._dataType){case"partialdate":return b;case"dateonly":var a=new SO.DateOnly(b.year,b.month,b.day);return a;case"datetime":var c=this._timePicker.getValue(),a=new SO.DateTime;return a.setComponents({year:b.year,month:b.month,day:b.day,hours:c.hour,minutes:c.minute,seconds:c.second,milliseconds:0},this._timeZone),a;default:SO.log.error("Widget dateSelector :"+this._dataType+"is not a valid date type")}},_getCurrentDate:function(){var a=new Date;switch(this._selector){case"year":return new SO.PartialDate({type:"year",year:a.getFullYear()});case"month":return new SO.PartialDate({type:"month",year:a.getFullYear(),month:a.getMonth()+1});case"quarter":var b=this._getQuarterByMonth(a.getMonth()+1);return new SO.PartialDate({type:"quarter",year:a.getFullYear(),quarter:b});case"day":return new SO.PartialDate({type:"day",year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()});case"second":return new SO.PartialDate({type:"second",year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds()})}},_refreshDisplay:function(a){a&&this._createMarkup(),this._state.disabled||null===this._state.error?(null===this._state.error&&this._$text.hasClass("nlui-state-error")||this._state.readOnly)&&(this._$text.removeClass("nlui-state-error"),this._state.disabled||this._starterButton.$el.removeClass("nlui-dateselector-error")):(this._$text.addClass("nlui-state-error"),this._state.disabled||this._starterButton.$el.addClass("nlui-dateselector-error")),this._$text.prop("disabled",this._state.readOnly),this._state.disabled?this._$text.text(this._formatDisplayValue(this._value)):(this._cleanButton&&this._cleanButton.el&&(this._cleanButton.el.style.display=this._value&&!this._state.readOnly?"block":"none"),this._state.readOnly?this._starterButton.setDisabled(!0):this._starterButton.setDisabled(!1),this._userInput||this._$text.val(this._formatDisplayValue(this._value))),a&&(this._$text.appendTo(this._$inlineContainer),this._cleanButton&&this._cleanButton.el&&this._$inlineContainer.append(this._cleanButton.el),this._state.disabled||this._starterButton.$el.appendTo(this._$inlineContainer))},_getPlaceHolder:function(){if(!this._state.readOnly)switch(this._selector){case"year":return xtk_sirocco.dateSelector_chooseAYear();case"quarter":return xtk_sirocco.dateSelector_chooseAQuarter();case"month":return xtk_sirocco.dateSelector_chooseAMonth();case"day":return xtk_sirocco.dateSelector_chooseADate();case"second":return xtk_sirocco.dateSelector_chooseADateAndTime();default:return xtk_sirocco.dateSelector_chooseAYear()}},_createMarkup:function(){this._$inlineContainer&&this._$inlineContainer.children().remove();var a=this;this.$el.addClass("nlui-dateselector nlui-input"),this._$inlineContainer=$("<div></div>").addClass("nlui-dateselector-container"),this._state.disabled?(this._$text=$('<label class="nlui-input-readonly"></label>').addClass(this._options.displayParams.className),this._$text.appendTo(this._$inlineContainer)):(this._$text=$("<input>",{"class":["nlui-text-regular","nlui-dateselector-input",this._options.displayParams.className],placeHolder:this._getPlaceHolder()}),a._attachInputEvents(),this._options.icon&&(this._$text.addClass("has-icon"),this._$inlineContainer.append($('<i class="decorative-icon soui-icon-18-'+this._options.icon+'"></i>'))),this._options.params.userInput||(this._$text.addClass("nlui-dateselector-nouserinput"),this._$text.attr("readonly",!0)),this._starterButton=new SO.Widgets.SimpleButton($("<span>"),{icon:"coral-calendar",mode:"secondary",onClick:function(){a._dateSelector._isOpen()||a._$text.focus()}}),this._cleanButton=new SO.Widgets.SimpleButton($('<div class="nlui-dateselector-clean-button"></div>'),{iconSize:12,icon:"cancel",mode:"quiet",onClick:function(){a._setValue(null)}}),this._starterButton.$el.addClass("nlui-dateselector-starterbutton")),this.$el.append(this._$inlineContainer),SO.isNundef(this._value)&&this._$text.addClass("nlui-dateselector-defaulttext")},_attachInputEvents:function(){var a=this;this._$text.keydown(function(b){a._tabPressed=9===b.which}),this._$text.blur(function(b){return b.defaultBehavior?!0:(a._starterButton.$el.removeClass("nlui-dateselector-active"),null!==a._state.error&&a._starterButton.$el.addClass("nlui-dateselector-noshadow"),a._userInput=!1,a._tabPressed&&(a._value?a._dateSelector._close(a._value,!0):a._dateSelector._close(a._value)),a._value&&(a._setValue(a._value),a._dateSelector._setValue(a._value)),void 0)}),this._$text.focus(function(){if(a._starterButton.$el.removeClass("nlui-dateselector-noshadow"),a._starterButton.$el.addClass("nlui-dateselector-active"),a._focused||(a._focused=!0),null!==a._state.error||null!==a._validate(a._value,!0)||SO.isNundef(a._value)||SO.isEmpty(a._value)){if(a._timePicker){var b={type:"timeSecond",hour:a._currentDate.hour,minute:a._currentDate.minute,second:a._currentDate.second};a._timePicker.setValue(b)}a._$container&&a._dateSelector._open(),a._dateSelector._setValue(a._currentDate),$(this).val("")}else $(this).val(a._formatDisplayValue(a._value));$(this).removeClass("nlui-dateselector-defaulttext"),a._$container?a._state.readOnly||a._dateSelector._open():(a._options.popableManager.addPopable(a),a._$container=a._dateSelector._init(),$("body").append(a._$container),a._overlay.show({margin:8,targetEl:a.el}),a._$container.append(a._$timePickerContainer),$(document).bind("mousewheel DOMMouseScroll",function(){a._dateSelector._isOpen()&&(a._dateSelector._close(),a._$text.trigger("blur",{defaultBehavior:!0}))}))}),this._$text.keyup(function(b){var c=b.which;if(a._userInput=!0,13===c)return a.collapse(),void 0;var d=$(this).val();if(""===d)return a._setValue(null,d),void 0;switch(a._selector){case"year":var e=new RegExp("^([0-9]{4})$","gi"),f=e.test(d);if(f===!0){var g={type:"year",year:SO.Integer.safeParse(d+"")};a._setValue(g),a._dateSelector._setValue(a._value),a._tmpValue=g,a._dateSelector._open()}else a._dateSelector._notFound(d),a._tmpValue=d;break;case"day":case"second":var h;if(h=a._timePicker?SO.DateTime.safeParse(d,{locale:a._options.locale.getName()}):SO.DateOnly.safeParse(d,{locale:a._options.locale.getName()}),h&&h.getYear()>1900){var g=new SO.PartialDate({type:"day",year:h.getYear(),month:h.getMonth(),day:h.getDay()}).toJSON();if(a._timePicker){var i=h.getComponents(a._timeZone);g=new SO.PartialDate({type:"second",year:i.year,month:i.month,day:i.day,hour:i.hours,minute:i.minutes,second:i.seconds}).toJSON(),a._timePicker.setValue(new SO.PartialDate({type:"timeSecond",hour:g.hour,minute:g.minute,second:g.second}).toJSON())}a._setValue(g),a._dateSelector._setValue(a._value),a._dateSelector._open(),a._tmpValue=g}else a._dateSelector._notFound(d),a._tmpValue=d}})},_formatDisplayValue:function(a){return SO.PartialDate.isValid(a)?SO.PartialDate.format(new SO.PartialDate(a),{format:this._format,locale:this._options.locale.getName()}):null},_getQuarterByMonth:function(a){return a>=1&&3>=a?1:a>=4&&6>=a?2:a>=7&&9>=a?3:a>=10&&12>=a?4:void 0},_setNameDetails:function(){switch(this._quartersNameDetails=[],this._quartersNameDetails[0]=this._monthsName[0].substring(0,3)+" - "+this._monthsName[2].substring(0,3),this._quartersNameDetails[1]=this._monthsName[3].substring(0,3)+" - "+this._monthsName[5].substring(0,3),this._quartersNameDetails[2]=this._monthsName[6].substring(0,3)+" - "+this._monthsName[8].substring(0,3),this._quartersNameDetails[3]=this._monthsName[9].substring(0,3)+" - "+this._monthsName[11].substring(0,3),this._options.selector){case"month":for(var a=1,b=0;this._monthsName.length>b;b++)this._monthsName[b]=10>a?"0"+a+" - "+this._monthsName[b]:""+a+" - "+this._monthsName[b],a++;break;case"quarter":for(var b=0;this._quartersName.length>b;b++)this._quartersName[b]=""+this._quartersName[b]+"<br>("+this._quartersNameDetails[b]+")"}},_getFirstDayofMonth:function(a,b){var c=new Date(SO.Integer.safeParse(a+""),SO.Integer.safeParse(b+""),1).getDay()-1;return 6===c&&(c=0),-1===c&&(c=6),c},_calendar:function(){var a=this;return{_init:function(){this._value||(this._value=SO.Utils.extend({},a._value)),this._title=this._getTitle(),this._opened=!0,this._$html=$('<div class="nlui-dateselector-calendar"></div>'),this._$html.append(this._buildHeader(10)),this._$table=$('<table class="content"></table>');var b=this._refreshContent();switch(this._$table.append(b),this._$html.append(this._$table),a.setElementThemable(this._$html),a.setFloatable(this._$html[0]),this._$html.addClass(a.getTheme()),a._selector){case"day":this._$html.addClass("day-selector");break;case"month":this._$html.addClass("month-selector");break;case"quarter":this._$html.addClass("quarter-selector");break;case"year":this._$html.addClass("year-selector");break;case"second":this._$html.addClass("time-selector")}return this._$html},_setValue:function(a){this._value=SO.Utils.extend({},a)},_getContainer:function(){return this._$html},_reverse:function(){for(var b=$("tbody",this._$table),c=b.find("tr").length,d=$("tr:eq(1) td",b).length,e=b.find("td").map(function(){return{content:$(this).text(),date:$(this).data("date")}}).get(),f=[],g=0;c>g;g++)for(var h=0;d>h;h++)f.push(e[g+h*c]);$("td",b).removeClass("selected"),$("td",b).removeClass("current"),b.find("td").each(function(b){$(this).html(f[b].content).data("date",f[b].date),SO.Utils.isEqual(f[b].date,a._value)&&$(this).addClass("selected"),SO.Utils.isEqual(f[b].date,a._currentDate)&&$(this).addClass("current")})},_notFound:function(){this._$table.empty(),a.setError({message:xtk_sirocco.dateSelector_noDateFound()});var b=$("<tr></tr>"),c=$("<td align='center' valign='center'></td>").html(xtk_sirocco.dateSelector_noDateFound());b.append(c),b.appendTo(this._$table)},_close:function(b,c){var d=this;c||""!==b&&b&&(a._setValue(b),d._setValue(b),a._$text.val(a._formatDisplayValue(b))),this._opened=!1,d._$html.hide(),a._userInput||a._starterButton.$el.removeClass("nlui-dateselector-active")},_isOpen:function(){return this._opened},_open:function(){this._opened=!0;var b=this._refreshContent();this._$table.append(b),a._overlay.show({margin:8,targetEl:a.el})},_refreshContent:function(){var b=this;this._$table.empty();var c,d=$("<tbody></tbody>"),e=[];switch(a._selector){case"year":for(var f=b._value.year-b._value.year%10,g=f;f+10>g;g++)e.push({content:g,date:new SO.PartialDate({type:"year",year:g}).toJSON()});c=2;break;case"quarter":for(var g=1;4>=g;g++){var h=a._quartersName[g-1]+"<br />("+a._monthsName[3*g-3]+" - "+a._monthsName[3*g-1]+")";e.push({content:h,date:new SO.PartialDate({type:"quarter",year:b._value.year,quarter:g}).toJSON()})}c=2;break;case"month":for(var g=1;12>=g;g++){var i=10>g?"0"+g:g,h=i+" - "+a._monthsName[g-1];e.push({content:h,date:new SO.PartialDate({type:"month",year:b._value.year,month:g}).toJSON()})}c=3;break;case"day":case"second":a._MONTH_DAYS[1]=SO.Date.isLeapYear(b._value.year)?29:28;for(var j=a._MONTH_DAYS[SO.Integer.safeParse(b._value.month-1+"")],g=1;j>=g;g++){var k,h=g;if("day"===a._selector&&(k=new SO.PartialDate({type:"day",year:b._value.year,month:b._value.month,day:g}).toJSON()),"second"===a._selector){var l=a._timePicker.getValue();k=new SO.PartialDate({type:"second",year:b._value.year,month:b._value.month,day:g,hour:SO.isNumber(l.hour)?l.hour:0,minute:SO.isNumber(l.minute)?l.minute:0,second:SO.isNumber(l.second)?l.second:0}).toJSON()}e.push({content:h,date:k})}for(var m=a._getFirstDayofMonth(b._value.year,b._value.month-1),n=42-(m+j),g=0;m>g;g++)e.splice(0,0,{});for(var g=0;n>g;g++)e.push({});c=7}if("day"===a._selector||"second"===a._selector){for(var o=$("<thead></thead>"),p=$("<tr></tr>"),g=0;6>=g;g++){var q=$("<th class='thead nlui-text-regular'></th>");q.text(a._daysName[g].toUpperCase().substring(0,2)),p.append(q)}o.append(p),this._$table.prepend(o)}for(var r,g=0;e.length-1>=g;g++){var s=g%c,t=$("<td></td>");if(SO.Utils.isEqual(e[g].date,a._value)&&t.addClass("selected"),"second"!==a._selector)SO.Utils.isEqual(e[g].date,a._currentDate)&&t.addClass("current");else if(!$.isEmptyObject(e[g].date)){var u=new SO.PartialDate({type:"day",year:e[g].date.year,month:e[g].date.month,day:e[g].date.day}).toJSON(),v=new SO.PartialDate({type:"day",year:a._currentDate.year,month:a._currentDate.month,day:a._currentDate.day}).toJSON();SO.Utils.isEqual(u,v)&&t.addClass("current")}SO.isEmpty(e[g].content)?t.addClass("invisible"):(t.data("date",e[g].date),t.html($('<p class="nlui-text-regular nlui-text-regularmedium"></p>').append(e[g].content)),SO.Event.bind(t,"vclick",function(c){var d,e=$(c.element).data("date");d=a._timePicker?a._getTimeValue(e):$(c.element).data("date"),b._close(d)})),s||(d.append(r),r=$("<tr></tr>")),r.append(t)}return d.append(r),this._title=this._getTitle(),this._$centerBlock.html("<span class='nlui-h2'>"+this._title+"</span>"),d},_buildHeader:function(){var b=a._value;b||(b=this._value);var c=this,d=$('<div class="nlui-dateselector-header"></div>'),e=$('<div class="headerleft"></div>'),f=$('<div class="headerright"></div>'),g=$('<div class="soui-icon-18-calendar-previous nlui-dateselector-button"></div>'),h=$('<div class="nlui-icon nlui-icon-previous-large-step-2 nlui-dateselector-button"></div>'),i=$('<div class="soui-icon-18-calendar-next nlui-dateselector-button"></div>'),j=$('<div class="nlui-icon nlui-icon-next-large-step-2 nlui-dateselector-button"></div>');return this._$centerBlock=$('<div class="headline"></div>'),SO.Event.bind(j[0],"vclick",function(){c._next("year",1)}),SO.Event.bind(h[0],"vclick",function(){c._previous("year",1)}),SO.Event.bind(i[0],"vclick",function(){var a="day"!==b.type&&"second"!==b.type?"year":"month",d="year"!==b.type?1:10;c._next(a,d)}),SO.Event.bind(g[0],"vclick",function(){var a="day"!==b.type&&"second"!==b.type?"year":"month",d="year"!==b.type?1:10;c._previous(a,d)}),this._$centerBlock.html("<span class='nlui-h2'>"+this._title+"</span>"),f.append(i),"day"===b.type||"second"===b.type,e.append(g),d.append(e,this._$centerBlock,f),d},_next:function(a,b){switch(a){case"year":this._value.year+=b;break;case"month":12===this._value.month?(this._value.month=1,this._value.year++):this._value.month++}this._title=this._getTitle(),this._animate("previous")},_animate:function(a){var b=document.createElement("p").style,c="transition"in b||"WebkitTransition"in b||"MozTransition"in b||"msTransition"in b||"OTransition"in b;if(c){var d=this._$table.clone(!0);this._$html.append(d);var e=this._refreshContent();"previous"===a?this._$table.css("transform","translateX("+this._$table.width()+"px)"):this._$table.css("transform","translateX(-"+this._$table.width()+"px)"),this._$table.append(e),"previous"===a?this._$table.css("transform","translateX("+this._$table.width()+"px)"):this._$table.css("transform","translateX(-"+this._$table.width()+"px)"),d.addClass("moving"),this._$table.addClass("moving"),"previous"===a?d.css("transform","translateX(-"+this._$table.width()+"px)"):d.css("transform","translateX("+this._$table.width()+"px)"),this._$table.css("transform","translateX(0)");var f=this;d.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){$(this).remove(),f._$table.removeClass("moving")})}else{var e=this._refreshContent();this._$table.append(e)}},_previous:function(a,b){switch(a){case"year":this._value.year-=b;break;case"month":1===this._value.month?(this._value.month=12,this._value.year--):this._value.month--}this._title=this._getTitle(),this._animate("next")},_getTitle:function(){switch(this._value.type){case"year":return this._value.year-this._value.year%10+" - "+(this._value.year-this._value.year%10+9);case"quarter":return this._value.year;case"month":return this._value.year;case"day":case"second":return a._monthsName[this._value.month-1]+", "+this._value.year}}}},_getFormat:function(){var a;switch(this._selector){case"year":a="%4Y";break;case"quarter":a="shortQuarter";break;case"month":a="shortMonth";break;case"day":a="shortDate";break;case"second":a="shortDateTime"}return a},getValue:function(){return this._checkOutputValue(this._value)},_setValue:function(a,b){var c=this._state.error;if(this._displayValue=this._formatDisplayValue(a),this._state.strict=!0,this._state.error=this._validate(a),!SO.Utils.isEqual(a,this._value)&&null===this._state.error){var d=this._checkOutputValue(a);this._options.onInternalChange(d,this._state.error,this._state.strict),this._value=a}""===b&&(this._state.mandatory||(this._state.error=null),this._options.onInternalChange(null,this._state.error,this._state.strict),this._value=null),SO.Utils.isEqual(c,this._state.error)||this._options.errorDisplay(this._state.error),this._refreshDisplay(!1)},setValue:function(a){var b=this._state.error;a=this._checkSetValue(a),this._displayValue=this._formatDisplayValue(a),this._value=a,this._state.strict=!0,this._state.error=this._validate(this._value),this._isInit=!0,SO.Utils.isEqual(b,this._state.error)||this._options.errorDisplay(this._state.error),this._refreshDisplay(!1),this._options.onExternalChange(this._state.error,this._state.strict)},isOwnerOf:function(a){var b=!1;return(SO.DOMUtils.isDescendantOf(a,this._dateSelector._getContainer())||a.is(this._$text)||SO.DOMUtils.isDescendantOf(a,this._starterButton.$el))&&(b=!0),b},collapse:function(){var a=this;a._dateSelector._isOpen()&&(a._dateSelector._close(a._value),a._$text.trigger("blur",{defaultBehavior:!0}))}}),$.widget("SO.soDateSelector",{_create:function(){this._widget=new SO.Widgets.DateInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setTimeZone:function(a){this._widget.setTimeZone(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},setTheme:function(a,b){this._widget.setTheme(a,b)},isOwnerOf:function(a,b){return this._widget.isOwnerOf(a,b)},collapse:function(a){this._widget.collapse(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("TimeInput","Input",{DEFAULT_OPTIONS:{theme:"light",params:{flat:!1,dataType:"PartialDate"}},_create:function(){this._options.value=this._options.value||null,this._userInput=!1;var a=this;this._dataType=this._options.params.dataType,this._checkInputValue(),this._timePicker=null,this._tmpValue=null,this._isInit=!0,this._$text=null,this._$container=null,this._$hourSelector=null,this._$minuteSelector=null,this._$secondSelector=null,this._currentTime=this._getCurrentTime(),this._format=this._getFormat(),this._checks=[{requirement:function(){return a._state.mandatory},test:function(b){return!a._isValueEmpty(b)},error:{message:xtk_sirocco.timeSelector_errorEmptyTime()}},{requirement:function(a){return""!==a&&null!==a},test:function(b){return a._isValidTime(b)},error:{message:xtk_sirocco.timeSelector_errorBadTime()}}],this._super()},_checkSetValue:function(a){switch(this._dataType){case"PartialDate":return a;case"time":if(SO.isTime(a))return new SO.PartialDate({type:"timeSecond",hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds()}).toJSON();break;default:SO.log.error("Widget seslector :"+this._dataType+"is not a valid date type")}},_checkInputValue:function(){switch(this._dataType){case"PartialDate":break;case"time":SO.isTime(this._options.value)&&(this._options.value=new SO.PartialDate({type:"timeSecond",hour:this._options.value.getHours(),minute:this._options.value.getMinutes(),second:this._options.value.getSeconds()}).toJSON());break;default:SO.log.error("Widget timeSelector:"+this._dataType+" is not a valid date type")}},_checkOutputValue:function(a){var b;switch(b=a?a:this._value,this._dataType){case"PartialDate":return b;case"time":var a=new SO.Time(b.hour,b.minute,b.second);return(isNaN(a.getHours())||isNaN(a.getMinutes())||isNaN(a.getSeconds()))&&(a=""),a;default:SO.log.error("Widget timeSelector:"+this._dataType+"is not a valid date type")}},_getCurrentTime:function(){var a=new Date;return new SO.PartialDate({type:"timeSecond",hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds()}).toJSON()},_refreshDisplay:function(a){a&&this._createMarkup(),this._state.readOnly||null===this._state.error?(null===this._state.error&&this._$text.hasClass("nlui-state-error")||this._state.readOnly)&&this._$text.removeClass("nlui-state-error"):this._$text.addClass("nlui-state-error"),this._$text.prop("disabled",this._state.readOnly),this._state.disabled?(this._validate(this._value)&&this._setValue(this._currentTime),this._$text.text(this._formatDisplayValue(this._value))):this._options.params.flat||this._userInput||this._$text.val(this._formatDisplayValue(this._value)),a&&(this._options.params.flat||this._$text.appendTo(this.$el))},_createMarkup:function(){this.$el.empty();var a=this;if(this.$el.addClass("nlui-timeselector nlui-input nlui-input-fullwidth"),this._state.disabled?this._$text=$("<label></label>"):(this._$text=$('<input type="text"></input>'),this._$text[0].setAttribute("placeholder",xtk_sirocco.timeSelector_chooseTime()),a._attachInputEvents(),this._options.icon&&(this._$text.addClass("has-icon"),this.$el.append($('<i class="decorative-icon soui-icon-18-'+this._options.icon+'"></i>')))),this._options.params.flat){this._isValidTime(this._value)||this._setValue(this._currentTime),this._timePicker=this._timeSelector();var b=this._timePicker._init();this.$el.append(b)}SO.isNundef(this._value)&&this._$text.addClass("nlui-timeselector-defaultText")},_attachInputEvents:function(){var a=this;this._$text.keydown(function(b){a._tabPressed=9===b.which}),this._$text.blur(function(){a._userInput=!1,a._setValue(a._value),a._tabPressed&&a._timePicker._close(a._value)}),this._$text.focus(function(){null!==a._state.error||null!==a._validate(a._value,!0)||SO.isNundef(a._value)?(a._setValue(a._currentTime),a._$container&&a._timePicker._open(),$(this).val(a._formatDisplayValue(a._currentTime))):$(this).val(a._formatDisplayValue(a._value)),$(this).removeClass("nlui-timeselector-defaultText"),a._$container?a._state.readOnly||a._timePicker._open():(a._timePicker=a._timeSelector(),a._options.popableManager.addPopable(a),a._$container=a._timePicker._init(),a.setTheme(a._options.theme),$("body").append(a._$container),a._timePicker._positionTimePicker(25))}),this._$text.keyup(function(b){a._userInput=!0;var c=b.which;if(13===c)return a.collapse(),void 0;var d=$(this).val(),e=SO.Time.safeParse(d);if(e){var f={type:"timeSecond",hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds()};a._setValue(f),a._timePicker._setValue(f),a._timePicker._open(),a._tmpValue=f}else a._setValue(d),a._tmpValue=d})},_isValidTime:function(a){if(SO.PartialDate.isValid(a)){var b=parseInt(a.hour,10),c=parseInt(a.minute,10),d=parseInt(a.second,10);return b>=0&&23>=b&&c>=0&&59>=c&&d>=0&&59>=d?!0:!1}return!1},_formatDisplayValue:function(a){return SO.isNundef(a)||SO.isEmpty(a)?"":SO.PartialDate.isValid(a)?new SO.PartialDate(a).format({format:this._format}):xtk_sirocco.timeSelector_errorBadTime},_timeSelector:function(){var a=this;return{_init:function(){return this._value=SO.Utils.extend({type:"timeSecond"},a._value),this._opened=!0,this._$content=$('<div class="nlui-timeselector-widget"></div>'),a._options.params.flat&&this._$content.addClass("nlui-timeselector-flatmode"),a.setElementThemable(this._$content),a.setFloatable(this._$content[0]),this._addSelectors(),this._$content},_getDropdownItems:function(a){return Array.apply(null,{length:a}).map(Number.call,function(a){return{label:10>a?"0"+a:""+a,name:a}})},_addSelectors:function(){var b=this,c=$("<div class='nlui-timeselector-timewrapper'></div>"),d=$("<div class='nlui-timeselector-timeimage nlui-icon20 ui-icon-clock'></div>"),e=$("<div class='nlui-timeselector-timeseparator'></div>").text(":");this._$hourSelector=$("<div class='nlui-timeselector-timechooser'></div>").soDropdown({value:a._value.hour,onInternalChange:function(c){b._value.hour=c,a._setValue(b._value),a._$text.val(a._formatDisplayValue(b._value))},params:{items:b._getDropdownItems(24)}}),a._$hourSelector=this._$hourSelector,this._$minuteSelector=$("<div class='nlui-timeselector-timechooser'></div>").soDropdown({value:a._value.minute,onInternalChange:function(c){b._value.minute=c,a._setValue(b._value),a._$text.val(a._formatDisplayValue(b._value))},params:{items:b._getDropdownItems(60)}}),a._$minuteSelector=this._$minuteSelector,this._$secondSelector=$("<div class='nlui-timeselector-timechooser'></div>").soDropdown({value:a._value.second,onInternalChange:function(c){b._value.second=c,a._setValue(b._value),a._$text.val(a._formatDisplayValue(b._value))},params:{items:b._getDropdownItems(60)}}),a._$secondSelector=this._$secondSelector,c.append(d,this._$hourSelector,e.clone(),this._$minuteSelector,e.clone(),this._$secondSelector),this._$content.append(c)},_positionTimePicker:function(b){var c=$(document).scrollTop(),d=$(document).scrollLeft(),e=null,f=null,g=7;f=a._$text.offset().left+this._$content.outerWidth()+b>$(window).width()+d?$(window).width()+d-this._$content.outerWidth():a._$text.offset().left,e=a._$text.offset().top+this._$content.outerHeight()+b>$(window).height()+c?$(window).height()+c-(this._$html.outerHeight()+a._$text.height()+g):a._$text.offset().top+a._$text.height()+g;var h={left:f,top:e};this._$content.css(h)},_setValue:function(a){this._value=SO.Utils.extend({},a),this._$hourSelector.soDropdown("setValue",this._value.hour),this._$minuteSelector.soDropdown("setValue",this._value.minute),this._$secondSelector.soDropdown("setValue",this._value.second)},_getContainer:function(){return this._$content},_close:function(b){this._$content.hide(),a._setValue(b),a._$text.val(a._displayValue),this._opened=!1},_isOpen:function(){return this._opened},_open:function(){this._opened=!0,this._positionTimePicker(0),this._$content.show()}}},_getFormat:function(){return"time"},getValue:function(){return this._checkOutputValue(this._value)},_setValue:function(a){var b=this._state.error;this._displayValue=this._formatDisplayValue(a),this._state.strict=!0,this._state.error=this._validate(a),this._value=a;var c=this._checkOutputValue(a);this._options.onInternalChange(c,this._state.error,this._state.strict),SO.Utils.isEqual(b,this._state.error)||this._options.errorDisplay(this._state.error),this._refreshDisplay(!1)},setValue:function(a){a=this._checkSetValue(a);var b=this._state.error;this._displayValue=this._formatDisplayValue(a),SO.Utils.extend(a,{type:"timeSecond"}),this._value=a,this._state.strict=!0,this._state.error=this._validate(this._value),this._isInit=!0,this._timePicker&&this._timePicker._setValue(a),this._options.onExternalChange(this._state.error,this._state.strict),SO.Utils.isEqual(b,this._state.error)||this._options.errorDisplay(this._state.error),this._refreshDisplay(!1)},setError:function(a){this._state.error=a,this._options.errorDisplay(this._state.error),this._refreshDisplay(!0)},setReadOnly:function(a){this._state.readOnly=a,this._refreshDisplay(!0)},setDisabled:function(a){this._state.disabled=a,this._refreshDisplay(!0)},isOwnerOf:function(a){var b=!1;return(SO.DOMUtils.isDescendantOf(a,this._timePicker._getContainer())||a.is(this._$text))&&(b=!0),b},collapse:function(){var a=this;a._timePicker._isOpen()&&a._timePicker._close(a._value)}}),$.widget("SO.soTimeSelector",{_create:function(){this._widget=new SO.Widgets.TimeInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},setTheme:function(a,b){this._widget.setTheme(a,b)},isOwnerOf:function(a,b){return this._widget.isOwnerOf(a,b)},collapse:function(a){this._widget.collapse(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.Time"),SO.Time=function(a,b,c,d){if(!arguments.length){var e=new Date;return new SO.Time(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}this._date=new Date(Date.UTC(0,0,0,a||0,b||0,c||0,d||0))},SO.Time.REG_EXP=/^([0-9]{2})(?::([0-9]{2}))?(?::([0-9]{2}))?(?:\.([0-9]{3}))?$/,SO.Time._applyFormatToTime=function(a,b,c){var d,e,f,g,h,i=b;return d=a.getHours(),e=a.getMinutes(),f=a.getSeconds(),g=a.getMilliseconds(),h=SO.Date.getAMPMHour(a._date,!0),i=i.replace(/%2H/,SO.Number.padLeft(d,2)),i=i.replace(/%2I/,SO.Number.padLeft(h,2)),i=i.replace(/%2N/,SO.Number.padLeft(e,2)),i=i.replace(/%2S/,SO.Number.padLeft(f,2)),i=i.replace(/%H/,d),i=i.replace(/%I/,h),i=i.replace(/%P/,c.AmPm[Math.floor(d/12)]),i=i.replace(/%N/,e),i=i.replace(/%S/,f),i=i.replace(/%L/,SO.Number.padLeft(g,3))},SO.Time.prototype.format=function(a){a=SO.Utils.extend({format:"time"},a);var b=SO.LocaleManager.getDefaultLocale();void 0!==a.locale&&(b=SO.LocaleManager.getLocale(a.locale),b=SO.assert(b,a.locale+" is not valid locale name.")?b:SO.LocaleManager.getDefaultLocale());var c=b.getSettings(),d=c[a.format]||a.format;return SO.Time._applyFormatToTime(this,d,c)},SO.Time.prototype.getHours=function(){return this._date.getUTCHours()},SO.Time.prototype.getMinutes=function(){return this._date.getUTCMinutes()},SO.Time.prototype.getSeconds=function(){return this._date.getUTCSeconds()},SO.Time.prototype.getMilliseconds=function(){return this._date.getUTCMilliseconds()},SO.Time.prototype.setHours=function(a){SO.assert(SO.isInteger(a)&&a>=0&&24>a),this._date.setUTCHours(a)},SO.Time.prototype.setMinutes=function(a){SO.assert(SO.isInteger(a)&&a>=0&&60>a),this._date.setUTCMinutes(a)},SO.Time.prototype.setSeconds=function(a){SO.assert(SO.isInteger(a)&&a>=0&&60>a),this._date.setUTCSeconds(a)},SO.Time.prototype.setMilliseconds=function(a){a=parseInt(a,10),SO.assert(SO.isInteger(a)&&a>=0&&1e3>a),this._date.setUTCMilliseconds(a)},SO.Time.prototype.compare=function(a){SO.assert(SO.isTime(a));var b=this._date.valueOf(),c=a._date.valueOf();return c===b?0:c>b?-1:1},SO.Time.prototype.equals=function(a){return 0===this.compare(a)},SO.Time.prototype.greaterThan=function(a){return 1===this.compare(a)},SO.Time.prototype.greaterOrEqualsThan=function(a){return this.compare(a)>=0},SO.Time.prototype.lessThan=function(a){return-1===this.compare(a)},SO.Time.prototype.lessOrEqualsThan=function(a){return 0>=this.compare(a)},SO.Time.prototype.toString=function(){return SO.Number.padLeft(this.getHours(),2)+":"+SO.Number.padLeft(this.getMinutes(),2)+":"+SO.Number.padLeft(this.getSeconds(),2)+"."+SO.Number.padLeft(this.getMilliseconds(),3)},SO.Time._parseTime=function(a,b,c){var d,e=SO.isString(a);if(SO.assert(e),e){var d=SO.Date.formatToRegex(c,b),f=d.regex.exec(a);if(f){var g={hours:1,minutes:2,seconds:3,milliseconds:4};SO.Utils.extend(g,d.groups);var h=parseInt(f[g.hours],10),i=parseInt(f[g.minutes],10)||0,j=parseInt(f[g.seconds],10)||0,k=f[g.milliseconds]?parseInt(f[g.milliseconds].slice(1),10):0;if(!(0>h||h>24||0>i||i>60||0>j||j>60)){if(g.ampm){var l=b.get("AmPm"),m=l.indexOf(f[g.ampm]);if(-1===m)return;if(!(h>0&&13>h))return;1===m?h=12>h?h+12:h:0===m&&12===h&&(h=0)}var n=new Date(Date.UTC(0,0,0,h,i,j,k));return{date:n,hours:h,minutes:i,seconds:j,milliseconds:k}}}}},SO.Time.safeParse=function(a,b){b=SO.Utils.extend({format:"time"},b);var c=null,d=SO.LocaleManager.getDefaultLocale();void 0!==b.defaultValue&&(c=SO.assert(SO.isTime(b.defaultValue),b.defaultValue+" is not a valid default value.")?b.defaultValue:null),void 0!==b.locale&&(d=SO.LocaleManager.getLocale(b.locale),d=SO.assert(d,b.locale+" is not valid locale name.")?d:SO.LocaleManager.getDefaultLocale());var e=d.get(b.format)||b.format,f=SO.Date.formatToRegex(e,d).regex;if(a&&f.test(a)){var g=SO.Time._parseTime(a,d,e),h=g&&g.date;if(h)return new SO.Time(h.getUTCHours(),h.getUTCMinutes(),h.getUTCSeconds(),h.getUTCMilliseconds())}return SO.assert(null,a+" is not a valid SO.Time object."),c},SO.Time.parse=function(a){if(""===a||null===a||void 0===a)return null;var b=SO.Time.REG_EXP.exec(a);if(null===b)throw new Error(a+" is not a valid Time");var c=parseInt(b[1],10),d=parseInt(b[2],10),e=parseInt(b[3],10),f=parseInt(b[4],10);if(0>c||c>24||0>d||d>60||0>e||e>60)throw new Error(a+" is not a valid time.");return new SO.Time(c,d,e,f)},SO.Time.toString=function(a){return void 0!==a&&null!==a?a.toString():""},SO.Time.format=function(a,b){return SO.assert(SO.isTime(a),a+" is not valid SO.Time object.")?a.format(b):""};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.DateOnly"),SO.DateOnly=function(a,b,c){if(!arguments.length){var d=new Date;return new SO.DateOnly(d.getFullYear(),d.getMonth()+1,d.getDate())}this._date=new Date(Date.UTC(a||0,b-1||0,c||1))},SO.DateOnly.REG_EXP=/^([0-9]{4})(?:[\-\/]([0-9]{2}))?(?:[\-\/]([0-9]{2}))?$/,SO.DateOnly.prototype.substract=function(a){return(this._toDate().getTime()-a._toDate().getTime())/1e3},SO.DateOnly.prototype.format=function(a){a=SO.Utils.extend({format:"shortDate"},a);var b=SO.LocaleManager.getDefaultLocale();void 0!==a.locale&&(b=SO.LocaleManager.getLocale(a.locale),b=SO.assert(b,a.locale+" is not a valid locale name.")?b:SO.LocaleManager.getDefaultLocale());var c=b.getSettings(),d=c[a.format]||a.format,e=this.getDay(),f=this.getMonth(),g=this.getYear(),h=this.getWeekDay(),i=SO.Date.getWeekNumber(this._date),j=d;return j=j.replace(/%2D/g,SO.Number.padLeft(e,2)),j=j.replace(/%2M/g,SO.Number.padLeft(f,2)),j=j.replace(/%2Y/g,SO.Number.padLeft(g%100,2)),j=j.replace(/%4Y/g,SO.Number.padLeft(g%1e4,4)),j=j.replace(/%4V/g,i.year),j=j.replace(/%2W/g,i.week),j=j.replace(/%D/g,e),j=j.replace(/%M/g,f),j=j.replace(/%Y/g,g%100),j=null!==c.daysName?j.replace(/%A/g,c.daysName[h]):j.replace(/%A/g,""),j=null!==c.monthsName?j.replace(/%B/g,c.monthsName[f-1]):j.replace(/%B/g,f),j=null!==c.quartersName?j.replace(/%Q/g,c.quartersName[Math.floor((f-1)/3)]):j.replace(/%Q/g,""),j=j.replace(/%C/g,Math.floor(1+(f-1)/3))},SO.DateOnly.prototype.getYear=function(){return this._date.getUTCFullYear()},SO.DateOnly.prototype.getMonth=function(){return this._date.getUTCMonth()+1},SO.DateOnly.prototype.getWeekDay=function(){return this._date.getUTCDay()},SO.DateOnly.prototype.getDay=function(){return this._date.getUTCDate()},SO.DateOnly.prototype.setYear=function(a){this._date.setUTCFullYear(+a)},SO.DateOnly.prototype.setMonth=function(a){this._date.setUTCMonth(+a-1)},SO.DateOnly.prototype.setDay=function(a){this._date.setUTCDate(+a)},SO.DateOnly.prototype.add=function(a,b){if(SO.isTimeSpan(arguments[0])){var c=arguments[0],d=c.getDuration();return this.setYear(this.getYear()+~~(d/31104e3)),this.setMonth(this.getMonth()+~~(d%31104e3/2592e3)),this.setDay(this.getDay()+~~(d%31104e3%2592e3/86400)),this}switch(a){case"years":case"y":this.setYear(this.getYear()+b);break;case"months":case"m":this.setMonth(this.getMonth()+b);break;case"days":case"d":this.setDay(this.getDay()+b);break;default:SO.assert(!1,"SO.DateOnly.add : invalid unit '"+a+"'")}return this},SO.DateOnly.prototype.sub=function(a,b){return SO.isTimeSpan(arguments[0])?this.add(new SO.TimeSpan(-1*arguments[0].getDuration())):this.add(a,-1*b)},SO.DateOnly.prototype.compare=function(a){SO.assert(SO.isDateOnly(a));var b=this._date.valueOf(),c=a._date.valueOf();return c===b?0:c>b?-1:1},SO.DateOnly.prototype.equals=function(a){return 0===this.compare(a)},SO.DateOnly.prototype.greaterThan=function(a){return 1===this.compare(a)},SO.DateOnly.prototype.greaterOrEqualsThan=function(a){return this.compare(a)>=0},SO.DateOnly.prototype.lessThan=function(a){return-1===this.compare(a)},SO.DateOnly.prototype.lessOrEqualsThan=function(a){return 0>=this.compare(a)},SO.DateOnly.prototype.toString=function(){return[SO.Number.padLeft(this.getYear(),4),SO.Number.padLeft(this.getMonth(),2),SO.Number.padLeft(this.getDay(),2)].join("-")},SO.DateOnly.safeParse=function(a,b){b=SO.Utils.extend({format:"shortDate"},b);var c=SO.LocaleManager.getDefaultLocale(),d=null;void 0!==b.locale&&(c=SO.LocaleManager.getLocale(b.locale),c=SO.assert(c,b.locale+" is not a valid locale name.")?c:SO.LocaleManager.getDefaultLocale()),void 0!==b.defaultValue&&(d=SO.assert(SO.isDateOnly(b.defaultValue),b.defaultValue+" is not a SO.DateOnly object.")?b.defaultValue:null);var e=c.get(b.format)||b.format,f=SO.Date.formatToRegex(e,c),g=f.regex.exec(a);if(g){var h=parseInt(g[f.groups.year],10),i=parseInt(g[f.groups.month],10),j=parseInt(g[f.groups.day],10);if(i>=1&&12>=i&&j>=1&&31>=j)return new SO.DateOnly(h,i,j)}return SO.assert(null,a+" can not be parsed into a SO.DateOnly object."),d},SO.DateOnly.parse=function(a){if(""===a||null===a||void 0===a)return null;var b=SO.DateOnly.REG_EXP.exec(a);if(null===b)throw new Error(a+" is not a valid DateOnly");var c=parseInt(b[1],10),d=parseInt(b[2],10)||1,e=parseInt(b[3],10)||1;if(1>d||d>12||1>e||e>31)throw new Error(a+" is not a valid DateOnly");return new SO.DateOnly(c,d,e)},SO.DateOnly.toString=function(a){return void 0!==a&&null!==a?a.toString():""},SO.DateOnly.format=function(a,b){return SO.assert(SO.isDateOnly(a),a+" is not a SO.DateOnly object.")?a.format(b):""},SO.DateOnly.getCurrent=function(a){var b="function"==typeof getCurrentDate?getCurrentDate():new Date,c=SO.TimezoneManager.getTimezone(a)||SO.TimezoneManager.getDefaultTimezone();return b=c.UTCToTimezone(b),new SO.DateOnly(b.getFullYear(),b.getMonth()+1,b.getDate())},SO.DateOnly.prototype._toDate=function(){return this._date};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.DateTime"),SO.DateTime=function(a,b,c,d,e,f,g){this._date=arguments.length?new Date(Date.UTC(a,b-1,c,d||0,e||0,f||0,g||0)):new Date((new Date).toISOString())},SO.DateTime.REG_EXP=/^(\d{4})[\-\/](\d{2})[\-\/](\d{2})(?:[ T](?:(\d{2}))?(?::(\d{2}))?(?::(\d{2}))?(?:\.(\d{3}))?((?:([+-])(\d{2})(?:\:?(\d{2}))?)|Z))?$/,SO.DateTime._applyFormatToDateTime=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o=b,p=c.getSettings(),a=d.UTCToTimezone(a);return e=a.getUTCDate(),f=a.getUTCMonth()+1,g=a.getUTCFullYear(),h=a.getUTCDay(),i=SO.Date.getWeekNumber(a),o=o.replace(/%2D/g,SO.Number.padLeft(e,2)),o=o.replace(/%2M/g,SO.Number.padLeft(f,2)),o=o.replace(/%2Y/g,SO.Number.padLeft(g%100,2)),o=o.replace(/%4Y/g,SO.Number.padLeft(g%1e4,4)),o=o.replace(/%4V/g,i.year),o=o.replace(/%2W/g,i.week),j=a.getUTCHours(),k=a.getUTCMinutes(),l=a.getUTCSeconds(),m=a.getUTCMilliseconds(),n=SO.Date.getAMPMHour(a,!0),o=o.replace(/%2H/,SO.Number.padLeft(j,2)),o=o.replace(/%2I/,SO.Number.padLeft(n,2)),o=o.replace(/%2N/,SO.Number.padLeft(k,2)),o=o.replace(/%2S/,SO.Number.padLeft(l,2)),o=o.replace(/%D/g,e),o=o.replace(/%M/g,f),o=o.replace(/%Y/g,g%100),o=o.replace(/%H/,j),o=o.replace(/%I/,n),o=o.replace(/%P/,p.AmPm[Math.floor(j/12)]),o=o.replace(/%N/,k),o=o.replace(/%S/,l),o=o.replace(/%L/,SO.Number.padLeft(m,3)),o=o.replace(/%A/g,p.daysName[h]),o=o.replace(/%B/g,p.monthsName[f-1]),o=o.replace(/%Q/g,p.quartersName[Math.floor((f-1)/3)]),o=o.replace(/%C/g,Math.floor(1+(f-1)/3))},SO.DateTime.prototype.format=function(a){a=SO.Utils.extend({format:"shortDateTime"},a);var b=SO.LocaleManager.getDefaultLocale(),c=SO.TimezoneManager.getDefaultTimezone();void 0!==a.locale&&(b=SO.LocaleManager.getLocale(a.locale),b=SO.assert(b,a.locale+" is not a valid locale name")?b:SO.LocaleManager.getDefaultLocale()),void 0!==a.timezone&&(c=SO.TimezoneManager.getTimezone(a.timezone),c=SO.assert(c,a.timezone+" is not a valid timezone name")?c:SO.TimezoneManager.getTimezone());var b=SO.LocaleManager.getLocale(a.locale)||SO.LocaleManager.getDefaultLocale(),d=b.getSettings(),e=d[a.format]||a.format;return SO.assert(SO.isString(a.format)),SO.DateTime._applyFormatToDateTime(this._date,e,b,c)},SO.DateTime.prototype.getYear=function(){return this._date.getUTCFullYear()},SO.DateTime.prototype.getMonth=function(){return this._date.getUTCMonth()+1},SO.DateTime.prototype.getWeekDay=function(){return this._date.getUTCDay()},SO.DateTime.prototype.getDay=function(){return this._date.getUTCDate()},SO.DateTime.prototype.getHours=function(){return this._date.getUTCHours()},SO.DateTime.prototype.getMinutes=function(){return this._date.getUTCMinutes()},SO.DateTime.prototype.getSeconds=function(){return this._date.getUTCSeconds()},SO.DateTime.prototype.getMilliseconds=function(){return this._date.getUTCMilliseconds()},SO.DateTime.prototype.setYear=function(a){this._date.setUTCFullYear(+a)},SO.DateTime.prototype.setMonth=function(a){this._date.setUTCMonth(+a-1)},SO.DateTime.prototype.setDay=function(a){this._date.setUTCDate(+a)},SO.DateTime.prototype.setHours=function(a){this._date.setUTCHours(+a)},SO.DateTime.prototype.setMinutes=function(a){this._date.setUTCMinutes(+a)},SO.DateTime.prototype.setSeconds=function(a){this._date.setUTCSeconds(+a)},SO.DateTime.prototype.setMilliseconds=function(a){this._date.setUTCMilliseconds(+a)},SO.DateTime.prototype.getComponents=function(a){var b=SO.TimezoneManager.getTimezone(a),c=b?b.UTCToTimezone(this._date):this._date;return{year:c.getUTCFullYear(),month:c.getUTCMonth()+1,day:c.getUTCDate(),hours:c.getUTCHours(),minutes:c.getUTCMinutes(),seconds:c.getUTCSeconds(),milliseconds:c.getUTCMilliseconds()}},SO.DateTime.prototype.setComponents=function(a,b){var c,d=SO.TimezoneManager.getTimezone(b),e=SO.OO.assertObjectHasProperties(a,{mandatory:["year","month","day","hours","minutes","seconds","milliseconds"]});return e&&(c=new SO.DateTime(a.year,a.month,a.day,a.hours,a.minutes,a.seconds,a.milliseconds),this._date=d?d.timezoneToUTC(c._date):c._date),this},SO.DateTime.prototype.substract=function(a){return(this._toDate().getTime()-a._toDate().getTime())/1e3},SO.DateTime.prototype.add=function(a,b){if(SO.isTimeSpan(arguments[0])){var c=arguments[0];return this._date.setTime(+this._date+1e3*c.getDuration()),this}switch(a){case"days":case"d":this._date.setTime(this._date.getTime()+864e5*b);break;case"hours":case"h":this._date.setTime(this._date.getTime()+36e5*b);break;case"minutes":case"m":this._date.setTime(this._date.getTime()+6e4*b);break;case"seconds":case"s":this._date.setTime(this._date.getTime()+1e3*b);break;default:SO.assert(!1,"SO.DateTime.add : invalid unit '"+a+"'")}return this},SO.DateTime.prototype.sub=function(a,b){return SO.isTimeSpan(arguments[0])?this.add(new SO.TimeSpan(-1*arguments[0].getDuration())):this.add(a,-1*b)},SO.DateTime.prototype.compare=function(a){SO.assert(SO.isDateTime(a));var b=this._date.valueOf(),c=a._date.valueOf();return c===b?0:c>b?-1:1},SO.DateTime.prototype.equals=function(a){return 0===this.compare(a)},SO.DateTime.prototype.greaterThan=function(a){return 1===this.compare(a)},SO.DateTime.prototype.greaterOrEqualsThan=function(a){return this.compare(a)>=0},SO.DateTime.prototype.lessThan=function(a){return-1===this.compare(a)},SO.DateTime.prototype.lessOrEqualsThan=function(a){return 0>=this.compare(a)},SO.DateTime.prototype.toString=function(){return SO.Number.padLeft(this.getYear(),4)+"-"+SO.Number.padLeft(this.getMonth(),2)+"-"+SO.Number.padLeft(this.getDay(),2)+"T"+SO.Number.padLeft(this.getHours(),2)+":"+SO.Number.padLeft(this.getMinutes(),2)+":"+SO.Number.padLeft(this.getSeconds(),2)+"Z"},SO.DateTime.safeParse=function(a,b){b=SO.Utils.extend({format:"shortDateTime"},b);var c,d,e=SO.LocaleManager.getDefaultLocale(),f=SO.TimezoneManager.getDefaultTimezone(),g=null;if(void 0!==b.locale&&(e=SO.LocaleManager.getLocale(b.locale),e=SO.assert(e,b.locale+" is not a valid locale name.")?e:SO.LocaleManager.getDefaultLocale()),void 0!==b.timezone&&(f=SO.TimezoneManager.getTimezone(b.timezone),f=SO.assert(f,b.timezone+" is not a valid timezone name.")?f:SO.TimezoneManager.getDefaultTimezone()),void 0!==b.defaultValue&&(g=SO.assert(SO.isDateTime(b.defaultValue),b.defaultValue+" is not a valid default value")?b.defaultValue:null),c=e.get(b.format)||b.format,d=SO.Date.formatToRegex(c,e).regex,a&&d.test(a)){var h=SO.DateTime._parseDateTime(a,e,c,f),i=h&&h.date;if(h)return new SO.DateTime(i.getFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds())}return SO.assert(null,a+" can not be parsed into a SO.DateTime object (in the "+e.getName()+" locale)"),g},SO.DateTime._parseDateTime=function(a,b,c,d){var e=SO.isString(a);if(SO.assert(e),e){var f=SO.Date.formatToRegex(c,b),g=f.regex.exec(a);if(null!==g){var h={year:1,month:2,day:3,hours:4,minutes:5,seconds:6,milliseconds:7};SO.Utils.extend(h,f.groups);var i=parseInt(g[h.year],10),j=parseInt(g[h.month],10),k=parseInt(g[h.day],10),l=parseInt(g[h.hours],10),m=parseInt(g[h.minutes],10),n=parseInt(g[h.seconds],10),o=g[h.milliseconds]?parseInt(g[h.milliseconds].substring(1),10):0;if(!(1>j||j>12||1>k||k>31||0>l||l>24||0>m||m>60||0>n||n>60)){if(h.ampm){var p=b.get("AmPm"),q=p.indexOf(g[h.ampm]);if(-1===q)return;if(!(l>0&&13>l))return;1===q&&12>l?l+=12:0===q&&12===l&&(l=0)}var r=new Date(Date.UTC(i,j-1,k,l,m,n,o));if(j===r.getUTCMonth()+1)return r=d.timezoneToUTC(r),{date:r,year:i,month:j,day:k,hours:l,minutes:m,seconds:n,milliseconds:o}}}}},SO.DateTime.parse=function(a){if(""===a||null===a||void 0===a)return null;var b=SO.DateTime.REG_EXP.exec(a),c=" is not a valid DateTime";if(null===b)throw new Error(a+c);var d=parseInt(b[1],10),e=parseInt(b[2],10),f=parseInt(b[3],10),g=parseInt(b[4],10),h=parseInt(b[5],10),i=parseInt(b[6],10),j=parseInt(b[7],10),k=b[8],l=b[9],m=b[10]||0,n=b[11]||0;if(1>e||e>12||1>f||f>31||0>g||g>24||0>h||h>60||0>i||i>60)throw new Error(a+c);if("Z"!==k){l="+"===l?1:-1,m=+m,n&&(n=+n);var o=Date.UTC(d,e-1,f,g||0,h||0,i||0,j||0),p=new Date(o-6e4*l*(60*m+n));return new SO.DateTime(p.getUTCFullYear(),p.getUTCMonth()+1,p.getUTCDate(),p.getUTCHours(),p.getUTCMinutes(),p.getUTCSeconds(),p.getUTCMilliseconds())}return new SO.DateTime(d,e,f,g,h,i,j)},SO.DateTime.toString=function(a){return void 0!==a&&null!==a?a.toString():""},SO.DateTime.format=function(a,b){return SO.assert(SO.isDateTime(a),a+" is not a SO.DateTime object")?a.format(b):""},SO.DateTime.getCurrent=function(){var a="function"==typeof getCurrentDate?getCurrentDate():new Date;return SO.DateTime.parse(a.toISOString())},SO.DateTime.prototype._toDate=function(){return this._date};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.TimeSpan"),SO.TimeSpan=function(a){SO.isInteger(a)&&(a={seconds:a}),SO.isPlainObject(a)&&(this._seconds=(a.years||0)*SO.TimeSpan._components.YEARS+(a.months||0)*SO.TimeSpan._components.MONTHS+(a.days||0)*SO.TimeSpan._components.DAYS+(a.hours||0)*SO.TimeSpan._components.HOURS+(a.minutes||0)*SO.TimeSpan._components.MINUTES+(a.seconds||0),a.negative&&(this._seconds*=-1))},SO.TimeSpan.REG_EXP=/^(-?)P(?:(-?\d+)Y)?(?:(-?\d+)M)?(?:(-?\d+)D)?(?:T(?:(-?\d+)H)?(?:(-?\d+)M)?(?:(-?\d+)S)?)?$/,SO.TimeSpan._components={YEARS:31104e3,MONTHS:2592e3,DAYS:86400,HOURS:3600,MINUTES:60,SECONDS:1},SO.TimeSpan.prototype.getDuration=function(){return this._seconds},SO.TimeSpan.prototype.setDuration=function(a){return this._seconds=+a,this},SO.TimeSpan._formatToRegex=function(a,b){b=b||SO.LocaleManager.getDefaultLocale();var c=b.getSettings(),d=c.timeSpanUnits,e=c.units.date,f=function(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},g={regex:a,groups:{year:null,month:null,day:null,hours:null,minutes:null,seconds:null}},h={seconds:[{format:/%S\s*/g,re:"(?:(\\d+)"+d.seconds+"\\s*)?"},{format:/%s\s*/g,re:"(?:(\\d+)\\s+"+f(e.second)+"\\s*)?"}],minutes:[{format:/%N\s*/g,re:"(?:(\\d+)"+d.minutes+"\\s*)?"},{format:/%n\s*/g,re:"(?:(\\d+)\\s+"+f(e.minute)+"\\s*)?"}],hours:[{format:/%H\s*/g,re:"(?:(\\d+)"+d.hours+"\\s*)?"},{format:/%h\s*/g,re:"(?:(\\d+)\\s+"+f(e.hour)+"\\s*)?"}],day:[{format:/%D\s*/g,re:"(?:(\\d+)"+d.days+"\\s*)?"},{format:/%d\s*/g,re:"(?:(\\d+)\\s+"+f(e.day)+"\\s*)?"}],month:[{format:/%M\s*/g,re:"(?:(\\d+)"+d.months+"\\s*)?"},{format:/%m\s*/g,re:"(?:(\\d+)\\s+"+f(e.month)+"\\s*)?"}],year:[{format:/%Y\s*/g,re:"(?:(\\d+)"+d.years+"\\s*)?"},{format:/%y\s*/g,re:"(?:(\\d+)\\s+"+f(e.year)+"\\s*)?"}]};a=f(a),g.regex=f(g.regex),SO.Utils.each(h,function(b,c){for(var d=0;c.length>d;d++){var e=g.regex.search(c[d].format);g.groups[b]=-1!==e?a.search(c[d].format):g.groups[b],-1!==g.groups[b]&&(g.regex=g.regex.replace(c[d].format,c[d].re))}});var i=Object.keys(g.groups).map(function(a){return g.groups[a]}),j=i.filter(function(a){return null!==a}).sort(function(a,b){return a-b});for(var k in g.groups){var l=j.indexOf(g.groups[k]);g.groups[k]=-1!==l?l+1:null}return g.regex=new RegExp("^"+g.regex+"$"),g},SO.TimeSpan.prototype._applyFormat=function(a,b){var c=b.get(a)||a,d=b.get("timeSpanUnits"),e=b.get("units").date,f=this._seconds,g="shortTimeSpan"!==a&&"longTimeSpan"!==a;if("timeAgo"===a)return this._timeAgo(b);if("age"===a){var h=Math.floor(Math.abs(f/SO.TimeSpan._components.YEARS)),i=e.age.replace(/\((.+)\)/,h>1?"$1":"");return h+" "+i}if(/%Y\s*|%y\s*/.test(c)){var j=Math.floor(Math.abs(f/SO.TimeSpan._components.YEARS));c=c.replace(/%Y\s*/g,j||g?j+d.years+" ":""),c=c.replace(/%y\s*/g,j||g?j+" "+e.year+" ":""),f%=SO.TimeSpan._components.YEARS}if(/%M\s*|%m\s*/.test(c)){var k=Math.floor(Math.abs(f/SO.TimeSpan._components.MONTHS));c=c.replace(/%M\s*/g,k||g?k+d.months+" ":""),c=c.replace(/%m\s*/g,k||g?k+" "+e.month+" ":""),f%=SO.TimeSpan._components.MONTHS}if(/%D\s*|%d\s*/.test(c)){var l=Math.floor(Math.abs(f/SO.TimeSpan._components.DAYS));c=c.replace(/%D\s*/g,l||g?l+d.days+" ":""),c=c.replace(/%d\s*/g,l||g?l+" "+e.day+" ":""),f%=SO.TimeSpan._components.DAYS}if(/%H\s*|\%h\s*/.test(c)){var m=Math.floor(Math.abs(f/SO.TimeSpan._components.HOURS));c=c.replace(/%H\s*/g,m||g?m+d.hours+" ":""),c=c.replace(/%h\s*/g,m||g?m+" "+e.hour+" ":""),f%=SO.TimeSpan._components.HOURS}if(/%N\s*|%n\s*/.test(c)){var n=Math.floor(Math.abs(f/SO.TimeSpan._components.MINUTES));c=c.replace(/%N\s*/g,n||g?n+d.minutes+" ":""),c=c.replace(/%n\s*/g,n||g?n+" "+e.minute+" ":""),f%=SO.TimeSpan._components.MINUTES}return c=c.replace(/%S\s*/g,f||g?f+d.seconds+" ":""),c=c.replace(/%s\s*/g,f||g?f+" "+e.second+" ":""),c.trim()},SO.TimeSpan.parse=function(a){if(""===a||null===a||void 0===a)return null;var b=SO.TimeSpan.REG_EXP.exec(a);if(null===b||/T$/.test(a))throw new Error(a+" can't be parsed into a SO.TimeSpan");var c="-"===b[1],d=+b[2],e=+b[3],f=+b[4],g=+b[5],h=+b[6],i=+b[7];return new SO.TimeSpan({years:d,months:e,days:f,hours:g,minutes:h,seconds:i,negative:c})},SO.TimeSpan.toString=function(a){return SO.isTimeSpan(a)?a.toString():""},SO.TimeSpan.prototype.toString=function(){var a=this._seconds,b=Math.floor(Math.abs(a/SO.TimeSpan._components.YEARS));a%=SO.TimeSpan._components.YEARS;var c=Math.floor(Math.abs(a/SO.TimeSpan._components.MONTHS));a%=SO.TimeSpan._components.MONTHS;var d=Math.floor(Math.abs(a/SO.TimeSpan._components.DAYS));a%=SO.TimeSpan._components.DAYS;var e=Math.floor(Math.abs(a/SO.TimeSpan._components.HOURS));a%=SO.TimeSpan._components.HOURS;var f=Math.floor(Math.abs(a/SO.TimeSpan._components.MINUTES));return a%=SO.TimeSpan._components.MINUTES,a=Math.abs(a),[0>this._seconds?"-":"","P",b?b+"Y":"",c?c+"M":"",d?d+"D":"",e||f||a?"T":"",e?e+"H":"",f?f+"M":"",a?a+"S":""].join("")},SO.TimeSpan.prototype.format=function(a){a=SO.Utils.extend({format:"shortTimeSpan"},a);var b=SO.LocaleManager.getDefaultLocale();return void 0!==a.locale&&(b=SO.LocaleManager.getLocale(a.locale),b=SO.assert(b,a.locale+" is not valid locale name")?b:SO.LocaleManager.getDefaultLocale()),this._applyFormat(a.format,b)},SO.TimeSpan.prototype._timeAgo=function(a){var b,c=0>this._seconds?-1:1,d=Math.floor(Math.abs(this._seconds/SO.TimeSpan._components.YEARS)),e=Math.floor(Math.abs(this._seconds/SO.TimeSpan._components.MONTHS)),f=Math.floor(Math.abs(this._seconds/604800)),g=Math.floor(Math.abs(this._seconds/SO.TimeSpan._components.DAYS)),h=Math.floor(Math.abs(this._seconds/SO.TimeSpan._components.HOURS)),i=Math.floor(Math.abs(this._seconds/SO.TimeSpan._components.MINUTES)),j=Math.floor(Math.abs(this._seconds%SO.TimeSpan._components.MINUTES));b=d>0?{unit:"year",value:d}:e>0?11>e?{unit:"month",value:e}:{unit:"year",value:1}:f>0?{unit:"week",value:f}:g>0?{unit:"day",value:g}:h>0?22>h?{unit:"hour",value:h}:{unit:"day",value:1}:i>0?45>i?{unit:"minute",value:i}:{unit:"hour",value:1}:j>0?45>j?{unit:"second",value:j}:{unit:"minute",value:1}:{unit:"second",value:0},b.value=b.value*c;var k=a.getSettings(),l=k.units.date,m=l[b.unit];return 0>b.value?-1===b.value&&"day"===b.unit?l.tomorrow:l.inBefore?l.in+" "+Math.abs(b.value)+" "+m:Math.abs(b.value)+" "+m+" "+l.in:b.value>=0?1===b.value&&"day"===b.unit?l.yesterday:0===b.value?l.justnow:l.agoBefore?l.ago+" "+b.value+" "+m:b.value+" "+m+" "+l.ago:void 0},SO.TimeSpan.prototype.compare=function(a){SO.assert(SO.isTimeSpan(a));var b=this.getDuration(),c=a.getDuration();return c===b?0:c>b?-1:1},SO.TimeSpan.prototype.equals=function(a){return 0===this.compare(a)},SO.TimeSpan.prototype.greaterThan=function(a){return 1===this.compare(a)},SO.TimeSpan.prototype.greaterOrEqualsThan=function(a){return this.compare(a)>=0},SO.TimeSpan.prototype.lessThan=function(a){return-1===this.compare(a)},SO.TimeSpan.prototype.lessOrEqualsThan=function(a){return 0>=this.compare(a)},SO.TimeSpan.safeParse=function(a,b){b=SO.Utils.extend({format:"shortTimeSpan"},b);var c,d=SO.LocaleManager.getDefaultLocale(),e=null;void 0!==b.locale&&(d=SO.LocaleManager.getLocale(b.locale),d=SO.assert(d,b.locale+" is not a valid locale name.")?d:SO.LocaleManager.getDefaultLocale()),void 0!==b.defaultValue&&(e=SO.assert(SO.isTimeSpan(b.defaultValue),b.defaultValue+" is not a SO.TimeSpan object.")?b.defaultValue:null);var f=d.get(b.format)||b.format;c=SO.TimeSpan._formatToRegex(f,d);var g=c.regex.exec(a);if(g&&a){var h=+g[c.groups.year],i=+g[c.groups.month],j=+g[c.groups.day],k=+g[c.groups.hours],l=+g[c.groups.minutes],m=+g[c.groups.seconds];return new SO.TimeSpan({years:h,months:i,days:j,hours:k,minutes:l,seconds:m})}return SO.assert(null,a+" can not be parsed into a SO.TimeSpan object."),e},SO.TimeSpan.format=function(a,b){return SO.assert(SO.isTimeSpan(a),a+" is not a SO.TimeSpan object.")?a.format(b):""};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("MultiplechoiceInput","Input",{DEFAULT_OPTIONS:{params:{choices:[],columns:1,type:"checkbox",minChecked:null,maxChecked:null}},_create:function(){this.$el.addClass("nlui-multiplechoice"),this._inputName="nl-multiplechoice-"+SO.Utils.sequence().nextVal();var a=this._options;this._choicesElements={},this._widgets={},this._state={},this._state.error=a.error,this._state.readOnly=a.readOnly,this._state.disabled=a.disabled,this._state.strict=a.strict,this._state.mandatory=a.mandatory,this._checks=this._getChecks(),SO.isArray(this._options.value)||null===this._options.value||(this._options.value=[this._options.value]),this._value="radio"===this._options.params.type?[this._options.value[0]]:this._options.value,this._state.error=this._validate(this._value,!0),this._options.displayParams.className=this._computeDisplayClasses(),this._refreshDisplay(!0),null!==this._state.error&&(this._options.errorDisplay(this._state.error),this._options.onInternalChange(this._value,this._state.error))},_refreshDisplay:function(a){var b=this;if(a&&this._createMarkup(),this._state.disabled||null===this._state.error?null===this._state.error&&this._$text.hasClass("nlui-state-error")&&this._$text.removeClass("nlui-state-error"):this._$text.addClass("nlui-state-error"),SO.Utils.each(this._choicesElements,function(a,c){var d=c.$input.val();c.$input.prop("disabled",b._state.disabled);var e=-1!==$.inArray(d,b._value);if(c.$input.prop("checked",e),"checkbox"===b._options.params.type){var f=b._widgets[d];f.setValue(e);var g=f._state.disabled?"soui-icon-12-check-disabled":"soui-icon-12-check-active",h=f._state.disabled?"soui-icon-12-check-active":"soui-icon-12-check-disabled";e?f._$icon.addClass(g).removeClass(h):f._$icon.removeClass("soui-icon-12-check-active soui-icon-12-check-disabled")}}),this._state.readOnly)for(var c in this._widgets){var d=this._widgets[c];d.setReadOnly(!0)}a&&this._$text.appendTo(this.$el)},_createMarkup:function(){var a,b,c,d=this,e=this._options.params,f=Math.ceil(e.choices.length/e.columns);this._$text&&(this._$text.remove(),this._choicesElements={}),this._$text=$("<div>",{"class":"nlui-multiplechoice-wrapper"});for(var g="nlui-multiplechoice-column",h=0;e.columns>h;h++)a=h*f,b=e.choices.slice(a,a+f),h===e.columns-1&&(g+=" last-column"),c=$("<div>",{"class":g}),SO.Utils.each(b,function(a,b){c.append(d._buildInput(b))}),this._$text.append(c)},setValue:function(a){a="radio"===this._options.params.type&&null!==a?[a[0]]:a,this._super(a)},_buildInput:function(a){var b,c,d,e=this,f=this._options.params,g="nlui-multiplechoice-"+SO.Utils.sequence().nextVal(),h=$("<div>",{"class":"nlui-multiplechoice-item"});return"checkbox"===f.type?(c=new SO.Widgets.CheckBoxInput($("<div></div>"),{params:{label:a.label},onInternalChange:function(){var a=e._getCheckedInputs();e._setValue(a)}}),h.append(c.$el),b=c._$input,b.val(a.value),b.prop({id:g,name:this._inputName}),b.prop("name",this._inputName),this._widgets[a.value]=c):(b=$('<input id="'+g+'" type="'+f.type+'"" name="'+this._inputName+'"></input>').val(a.value),d=$("<label>",{html:a.label,"for":g}),h.append(b,d),b.on("change",function(){var a=e._getCheckedInputs();e._setValue(a)})),this._choicesElements[g]={$input:b,widget:c},h},_getCheckedInputs:function(){var a=SO.Utils.filter(this._choicesElements,function(){return this.widget?this.widget.getValue():this.$input.prop("checked")});return SO.Utils.map(a,function(){return this.$input.val()})},_applyParamChanges:function(a){for(var b=!1,c=!1,d=0;a.length>d;d++){var e=a[d];e.match("choices")?b=!0:e.match("columns")?b=!0:e.match("type")?(this._value="radio"==this._options.params.type?[this._value[0]]:this._value,b=!0):(e.match("minChecked")||e.match("maxChecked"))&&(c=!0)}if(c){this._checks=this._getChecks();var f=this._state.error;this._state.error=this._validate(this._value),SO.Utils.isEqual(f,this._state.error)||this._options.errorDisplay(this._state.error),this._options.onInternalChange(this._value,this._state.error)}this._refreshDisplay(b)},_getChecks:function(){var a=this;return[{requirement:function(){return a._state.mandatory},test:function(b){return!a._isValueEmpty(b)},error:{message:xtk_sirocco.inputs_mandatoryErr()}},{requirement:function(){return null!==a._options.params.minChecked},test:function(b){return a._isValueEmpty(b)?!1:b.length>=a._options.params.minChecked},error:{message:xtk_sirocco.multipleChoice_minCheckedErr(a._options.params.minChecked)}},{requirement:function(){return null!==a._options.params.maxChecked},test:function(b){return a._isValueEmpty(b)?!0:b.length<=a._options.params.maxChecked},error:{message:xtk_sirocco.multipleChoice_maxCheckedErr(a._options.params.maxChecked)}}]},_isValueEmpty:function(a){return null===a?!0:0===a.length},destroy:function(){this._$text.remove()}}),$.widget("SO.soMultipleChoice",{_create:function(){this._widget=new SO.Widgets.MultiplechoiceInput(this.element,this.options)},_destroy:function(){this._widget.destroy()},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("CheckBoxInput","Input",{DEFAULT_OPTIONS:{value:!1,icon:null,params:{disabledLabels:{yes:xtk_sirocco.checkBox_yes(),no:xtk_sirocco.checkBox_no()},label:""}},_create:function(){var a=this;return this._$wrapper=null,this._$innerWrapper=null,this._$input=null,this._$icon=null,this._icon=this._options.icon,this._$label=null,this._label=this._options.params.label,this._checks=[{requirement:function(b){return!a._isValueEmpty(b)},test:function(a){return SO.isBoolean(a)},error:{message:xtk_sirocco.inputs_incorrectValueErr()}}],this._super(),SO.assert(this._state.mandatory===!1,'"mandatory" state is not logical for a checkbox'),SO.assert(this._state.strict===!1,'"strict" state is not logical for a checkbox'),this._bindEvents(),this},_refreshDisplay:function(a){var b=this._value;if(a&&this._createMarkup(),this._state.readOnly||null===this._state.error?(null===this._state.error&&this._$input.hasClass("nlui-state-error")||this._state.readOnly)&&this._$input.removeClass("nlui-state-error"):this._$input.addClass("nlui-state-error"),this._$input.prop("disabled",this._state.readOnly),this._state.readOnly?this.$el.addClass("disabled"):this.$el.removeClass("disabled"),this._state.disabled)if(this._$wrapper.addClass("nlui-input-readonly"),this._$innerWrapper.addClass("nlui-input-readonly"),this._$input.addClass("nlui-input-readonly"),this._$label.hide(),SO.isNundef(b))this._$input.text("undefined");else{var c=b===!0?this._options.params.disabledLabels.yes:this._options.params.disabledLabels.no;this._$input.text(c)}else if(this._$wrapper.removeClass("nlui-input-readonly"),this._$innerWrapper.removeClass("nlui-input-readonly"),this._$input.removeClass("nlui-input-readonly"),this._$label.show(),this._$innerWrapper.toggleClass("nlui-checkbox-inner-wrapper-checked",this._state.readOnly&&b===!0),this._$input.is(":focus")?this._$innerWrapper.addClass("focus"):this._$innerWrapper.removeClass("focus"),SO.isNundef(b)?this._$input.prop("checked",!1):this._$input.prop("checked",b),b===!0){var d=this._state.readOnly?"soui-icon-12-check-disabled":"soui-icon-12-check-active",e=this._state.readOnly?"soui-icon-12-check-active":"soui-icon-12-check-disabled";this._$icon.addClass(d).removeClass(e)}else this._$icon.removeClass("soui-icon-12-check-active soui-icon-12-check-disabled");return this._$label.text(this._label),a&&(this._$wrapper.appendTo(this.$el),this._$innerWrapper.appendTo(this._$wrapper),this._$input.appendTo(this._$innerWrapper),this._$icon.appendTo(this._$innerWrapper),this._$label.appendTo(this.$el)),this},_createMarkup:function(){var a=this._options.displayParams.className+" nlui-checkbox-input",b=this._state.readOnly?"soui-icon-12-check-disabled":"soui-icon-12-check-active";return this._$wrapper&&this._$wrapper.remove(),this._$innerWrapper&&this._$innerWrapper.remove(),this._$input&&this._$input.remove(),this._$icon&&this._$icon.remove(),this._$label&&this._$label.remove(),this.$el.addClass("nlui-checkbox nlui-input"),this._$wrapper=$("<div></div>").addClass("nlui-checkbox-wrapper"),this._icon&&this._$wrapper.append($("<span />").addClass("nlui-checkbox-wrapper-image").append(SO.IMG.genIcon(this._icon,12))),this._$innerWrapper=$("<div></div>").addClass("nlui-checkbox-inner-wrapper"),this._$label=$("<span></span>",{text:this._label}).addClass("nlui-checkbox-label"),this._$input=this._state.disabled?$("<label></label>").addClass(a):$('<input type="checkbox" />').addClass(a).prop("checked",this.getValue()),this._$icon=$('<span class="nlui-checkbox-icon"></span>').addClass(b),this},_bindEvents:function(){var a=this;return this.$el.on("focus","input",function(){return a._state.disabled?!1:(a._refreshDisplay(!1),void 0)}),this.$el.on("blur","input",function(){return a._state.disabled?!1:(a._refreshDisplay(!1),void 0)}),SO.Event.bind(this.$el,"vclick",function(b){var c=b.originalEvent;return a._state.readOnly||a._state.disabled||c.offsetX>a._$label.position().left+a._$label.outerWidth()?!1:(a._setValue(!a.getValue()),void 0)}),this},_toggle:function(){var a=!this.getValue();return this._setValue(a),this},toggle:function(){var a=!this.getValue();return this.setValue(a),this},setLabel:function(a){return SO.assert(SO.isString(a),'"label" property should be a string'),this._label=a,this._refreshDisplay(!1),this},getLabel:function(){return this._label}}),$.widget("SO.soCheckBoxInput",{_create:function(){this._widget=new SO.Widgets.CheckBoxInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},toggle:function(){this._widget.toggle()},setLabel:function(a){this._widget.setLabel(a)},getLabel:function(){return this._widget.getLabel()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("RadioButtonInput","Input",{DEFAULT_OPTIONS:{params:{value:null,checked:!1,label:"",icon:null}},_create:function(){var a=this;this._$wrapper=null,this._$input=null,this._$icon=null,this._$label=null,this._checked=this._options.params.checked,this._icon=this._options.params.icon,this._label=this._options.params.label;var b=function(b){return!a._isValueEmpty(b)},c=function(a){return SO.isBoolean(a)||SO.isString(a)||SO.isNumber(a)||SO.isObject(a)};return SO.isNundef(this._options.value)||(SO.isBoolean(this._options.value)?c=function(a){return SO.isBoolean(a)}:SO.isString(this._options.value)?c=function(a){return SO.isString(a)}:SO.isInteger(this._options.value)?c=function(a){return SO.isInteger(a)}:SO.isFloat(this._options.value)&&(c=function(a){return SO.isFloat(a)})),this._checks=[{requirement:b,test:c,error:{message:xtk_sirocco.inputs_incorrectValueErr()}}],this._super(),this},_refreshDisplay:function(a){var b=this._value,c=this._checked;if(a&&(this._createMarkup(),this._bindEvents()),this._state.readOnly||null===this._state.error?(null===this._state.error&&this._$input.hasClass("nlui-state-error")||this._state.readOnly)&&this._$input.removeClass("nlui-state-error"):this._$input.addClass("nlui-state-error"),this._$input.prop("disabled",this._state.readOnly),this._state.readOnly?this.$el.addClass("disabled"):this.$el.removeClass("disabled"),this._state.disabled)this.$el.addClass("nlui-input-readonly"),this._$input.addClass("nlui-input-readonly"),this._$label.hide(),SO.isNundef(b)?this._$input.text("undefined"):this._$input.text(this._getSafeDisplayValue());else{var d,e;this.$el.removeClass("nlui-input-readonly"),this._$input.removeClass("nlui-input-readonly"),this._$label.show(),this._$input.prop("checked",c),c?(this._$icon.removeClass("soui-icon-24-radiobutton-inactive").removeClass("soui-icon-24-radiobutton-disabled-inactive").removeClass("soui-icon-24-radiobutton-focused-inactive"),this._state.readOnly?this._$icon.addClass("soui-icon-24-radiobutton-readonly-active").removeClass("soui-icon-24-radiobutton-active"):(d=this._$input.is(":focus")?"soui-icon-24-radiobutton-focused-active":"soui-icon-24-radiobutton-active",e=this._$input.is(":focus")?"soui-icon-24-radiobutton-active":"soui-icon-24-radiobutton-focused-active",this._$icon.addClass(d).removeClass(e).removeClass("soui-icon-24-radiobutton-disabled-active"))):(this._$icon.removeClass("soui-icon-24-radiobutton-active").removeClass("soui-icon-24-radiobutton-disabled-active").removeClass("soui-icon-24-radiobutton-readonly-active").removeClass("soui-icon-24-radiobutton-focused-active"),this._state.readOnly?this._$icon.addClass("soui-icon-24-radiobutton-disabled-inactive").removeClass("soui-icon-24-radiobutton-inactive"):(d=this._$input.is(":focus")?"soui-icon-24-radiobutton-focused-inactive":"soui-icon-24-radiobutton-inactive",e=this._$input.is(":focus")?"soui-icon-24-radiobutton-inactive":"soui-icon-24-radiobutton-focused-inactive",this._$icon.addClass(d).removeClass(e).removeClass("soui-icon-24-radiobutton-disabled-inactive")))}return this._isValueEmpty(this._label)?this._$label.hide():this._$label.text(this._label).show(),a&&(this._$wrapper.appendTo(this.$el),this._$innerWrapper.appendTo(this._$wrapper),this._$input.appendTo(this._$innerWrapper),this._$icon.appendTo(this._$innerWrapper),this._$label.appendTo(this.$el)),this},_createMarkup:function(){var a,b=this._options.displayParams.className+" nlui-radiobutton-input",c=this._checked;return this._$wrapper&&this._$wrapper.remove(),this._$innerWrapper&&this._$innerWrapper.remove(),this._$input&&this._$input.remove(),this._$icon&&this._$icon.remove(),this._$label&&this._$label.remove(),this.$el.addClass("nlui-radiobutton nlui-input"),this._$wrapper=$("<div></div>").addClass("nlui-radiobutton-wrapper"),this._$innerWrapper=$("<div></div>").addClass("nlui-radiobutton-inner-wrapper"),this._$label=$("<span></span>",{text:this._label}).addClass("nlui-radiobutton-label"),this._$input=this._state.disabled?$("<label></label>").addClass(b):$('<input type="radio" />').addClass(b).val(this.getValue()),this._icon&&this._$wrapper.append($("<span />").addClass("nlui-radiobutton-wrapper-image").append(SO.IMG.genIcon(this._icon,12))),a=this._state.readOnly?c?"soui-icon-24-radiobutton-readonly-active":"soui-icon-24-radiobutton-disabled-inactive":c?"soui-icon-24-radiobutton-active":"soui-icon-24-radiobutton-inactive",this._$icon=$('<span class="nlui-radiobutton-icon"></span>').addClass(a),this},_bindEvents:function(){var a=this;return a._$input.on("focus",function(){return a._state.disabled?!1:(a._refreshDisplay(!1),void 0)}),a._$input.on("blur",function(){return a._state.disabled?!1:(a._refreshDisplay(!1),void 0)}),a._$input.on("change",function(b){return b.stopPropagation(),a._state.readOnly||a._state.disabled||a.isChecked()?!1:(a._toggleChecked(),void 0)}),SO.Event.bind(a._$label,"vclick",function(b){return b.originalEvent.stopPropagation(),a._state.readOnly||a._state.disabled||a.isChecked()?!1:(a._toggleChecked(),void 0)}),SO.Event.bind(a.$el,"vclick",function(b){return b.originalEvent.stopPropagation(),a._state.readOnly||a._state.disabled||a.isChecked()?!1:(a._toggleChecked(),void 0)}),this},isChecked:function(){return this._checked},_setChecked:function(a){if(!SO.isBoolean(a))throw new Error('Invalid "checked" boolean flag');return this._checked=a,this.isChecked()&&this._setValue(this._options.params.value),this._refreshDisplay(!1),this._options.onInternalChange(this._value,this._state.error,this._state.strict),this},setChecked:function(a){if(!SO.isBoolean(a))throw new Error('Invalid "checked" boolean flag');return this._checked=a,this.isChecked()&&this.setValue(this._options.params.value),this._refreshDisplay(!1),this._options.onExternalChange(this._state.error,this._state.strict),this},_toggleChecked:function(){return this._checked=!this._checked,this.isChecked()&&this._setValue(this._options.params.value),this._refreshDisplay(!1),this._options.onInternalChange(this._value,this._state.error,this._state.strict),this},toggleChecked:function(){return this._checked=!this._checked,this.isChecked()&&this.setValue(this._options.params.value),this._refreshDisplay(!1),this._options.onExternalChange(this._state.error,this._state.strict),this},setLabel:function(a){return SO.assert(SO.isString(a),'"_label" property should be a string'),this._label=a,this._refreshDisplay(!1),this},getLabel:function(){return this._label}}),$.widget("SO.soRadioButtonInput",{_create:function(){this._widget=new SO.Widgets.RadioButtonInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},isChecked:function(){return this._widget.isChecked()},setChecked:function(a){return this._widget.setChecked(a)},toggleChecked:function(){return this._widget.toggleChecked()},setLabel:function(a){this._widget.setLabel(a)},getLabel:function(){return this._widget.getLabel()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("RadioGroup","Input",{DEFAULT_OPTIONS:{columns:"auto",radioButtons:[]},_create:function(){return this._super(),this._radioButtons={},this._currentValue=this._options.value,this._columns=[],this.el.classList.add("nlui-radiogroup"),this._name="nlui-radiogroup-"+SO.Utils.sequence().nextVal(),this._render(),this},_render:function(){var a,b;for(a=0,b=this._options.radioButtons.length;b>a;a+=1)this.addRadioButton(this._options.radioButtons[a]);return this},_appendRadioButton:function(a){return"auto"===this._options.columns?(this.el.classList.add("nlui-radiogroup-inline"),this.el.appendChild(a.el)):(void 0===this._colIndex?(this._createTable(),this._colIndex=1):this._colIndex<this._options.columns?(this._createColumn(),this._colIndex+=1):this._colIndex>=this._options.columns&&(this._createRow(),this._colIndex=1),this._currentColumn.appendChild(a.el)),this},addRadioButton:function(a){var b,c;return b=this,c=new SO.Widgets.RadioButtonInput({onInternalChange:function(a){b._preventValueChange||b._setValue(a)},onExternalChange:function(a){b._preventValueChange||b.setValue(a)},params:a}),c.el.setAttribute("name",this._name),this._appendRadioButton(c),this._radioButtons[a.value]=c,this._preventValueChange=!0,c._setChecked(this._options.value===a.value),this._preventValueChange=!1,this},_refreshDisplay:function(){var a,b,c;return this._preventValueChange=!0,a=this.getValue(),this._radioButtons&&null!==a&&this._currentValue!==a&&(b=this._radioButtons[this._currentValue],c=this._radioButtons[a],c&&!c.isChecked()&&c._setChecked(!0),b&&b.isChecked()&&b._setChecked(!1),this._currentValue=a),this._preventValueChange=!1,this},_createTable:function(){this._tableEl=document.createElement("table"),this.el.appendChild(this._tableEl),this._createRow()},_createRow:function(){return this._tableEl&&(this._currentRow=document.createElement("tr"),this._tableEl.appendChild(this._currentRow),this._createColumn()),this},_createColumn:function(){return this._currentRow&&(this._currentColumn=document.createElement("td"),this._currentRow.appendChild(this._currentColumn)),this},setReadOnly:function(a){return SO.Utils.each(this._radioButtons,function(b,c){c.setReadOnly(a)}),this},setDisabled:function(a){return SO.Utils.each(this._radioButtons,function(b,c){c.setDisabled(a)}),this}}),$.widget("SO.soRadioGroup",{_create:function(){this._widget=new SO.Widgets.RadioGroup(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},addRadioButton:function(a){this._widget.addRadioButton(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("TimeSpanInput","Input",{DEFAULT_OPTIONS:{displayFormat:"shortTimeSpan"},_create:function(){var a={shortTimeSpan:!0,shortTimeSpan_d:!0,shortTimeSpan_h:!0},b=this;return this._format=SO.Utils.extend({locale:this._options.locale.getName()},SO.Format.formats.shortTimeSpan),this._$wrapper=null,this._$input=null,this._checks=[{requirement:function(){return b._state.mandatory},test:function(a){return!b._isValueEmpty(a)},error:{message:xtk_sirocco.inputs_mandatoryErr()}},{requirement:function(a){return""!==a&&null!==a},test:function(a){return SO.isTimeSpan(a)},error:{message:xtk_sirocco.inputs_incorrectValueErr()},instant:!0},{requirement:function(){return SO.isString(b._checkValue)},test:function(){var a=b._options.locale,c=a.get(b._format.format),d=SO.TimeSpan._formatToRegex(c,a);return d.regex.test(b._checkValue)},error:{message:xtk_sirocco.inputs_incorrectValueErr()},instant:!0}],SO.assert(a.hasOwnProperty(this._options.displayFormat),'"'+this._options.displayFormat+'" format is not supported by the widget'),a.hasOwnProperty(this._options.displayFormat)&&(this._format=SO.Utils.extend(this._format,SO.Format.formats[this._options.displayFormat])),this._super(),SO.isTimeSpan(this._value)&&(this._displayValue=SO.TimeSpan.format(this._value,this._format),this._refreshDisplay(!1)),this},_refreshDisplay:function(a){return this._value,a&&(this._createMarkup(),this._bindEvents()),this._state.readOnly||null===this._state.error?(null===this._state.error&&this._$input.hasClass("nlui-state-error")||this._state.readOnly)&&this._$input.removeClass("nlui-state-error"):this._$input.addClass("nlui-state-error"),this._$input.prop("disabled",this._state.readOnly),this._state.readOnly?this._$input.addClass("nlui-timespan-input-disabled"):this._$input.removeClass("nlui-timespan-input-disabled"),this._state.disabled?(this._$input.text(this._getSafeDisplayValue()),this._$input.addClass("nlui-timespan-input-readonly")):(this._$input.is(":focus")||(SO.isNundef(this._displayValue)?this._$input.val(null):this._$input.val(this._displayValue)),this._$input.removeClass("nlui-timespan-input-readonly")),a&&(this._$wrapper.appendTo(this.$el),this._$input.appendTo(this._$wrapper)),this},_createMarkup:function(){var a=this._options.displayParams.className+" nlui-timespan-input";return this.getValue(),this._$wrapper&&this._$wrapper.remove(),this._$input&&this._$input.remove(),this.$el.addClass("nlui-timespan nlui-input nlui-input-fullwidth"),this._$wrapper=$("<div></div>").addClass("nlui-timespan-wrapper"),this._state.disabled?this._$input=$("<label></label>").addClass(a):(this._$input=$('<input type="text" />').addClass(a).val(this._displayValue),this._options.icon&&(this._$input.addClass("has-icon"),this._$wrapper.append($('<i class="decorative-icon soui-icon-18-'+this._options.icon+'"></i>')))),this},_bindEvents:function(){var a=this;return a._$input.on("focus",function(){return a._state.disabled?!1:(a._refreshDisplay(!1),void 0)}),a._$input.on("blur",function(){var b,c;return a._state.disabled?!1:(a._checkValue=$(this).val(),b=SO.String.trim(a._checkValue).split(/\s+/).join(" "),c=SO.TimeSpan.safeParse(b,a._format),a._setValue(c),a._options.onTouched(),void 0)}),this._$input.on("keyup",function(b){return a._state.disabled?!1:(13==b.keyCode&&this.blur(),void 0)}),this},_setValue:function(a){if(SO.assert(SO.isTimeSpan(a),"Invalid time span object"),SO.isString(a)&&SO.TimeSpan.REG_EXP.test(a)&&(a=SO.TimeSpan.parse(a)),this._state.strict=this._state.mandatory,this._isValueEmpty(this._value)||this._isValueEmpty(a)||null===a||!SO.Utils.isEqual(this._value.toString(),a.toString())){var b=this._state.error;this._displayValue=this._checkValue||SO.TimeSpan.format(a,this._format)||(null===a?"":this._displayValue),this._value=a,this._state.error=this._validate(this._value),this._checkValue=null,SO.Utils.isEqual(b,this._state.error)||this._options.errorDisplay(this._state.error),this._refreshDisplay(!1),this._options.onInternalChange(this._value,this._state.error,this._state.strict)}return this},setValue:function(a){SO.assert(SO.isTimeSpan(a),"Invalid time span object"),SO.isString(a)&&SO.TimeSpan.REG_EXP.test(a)&&(a=SO.TimeSpan.parse(a));var b=this._state.error;return this._state.strict=!0,this._displayValue=this._checkValue||SO.TimeSpan.format(a,this._format)||this._displayValue,this._value=a,this._state.error=this._validate(this._value),this._checkValue=null,SO.Utils.isEqual(b,this._state.error)||this._options.errorDisplay(this._state.error),this._refreshDisplay(!1),this._options.onExternalChange(this._state.error,this._state.strict),this}}),$.widget("SO.soTimeSpanInput",{_create:function(){this._widget=new SO.Widgets.TimeSpanInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("TimezonePickerInput","Input",{DEFAULT_OPTIONS:{value:"GMT",params:{items:[]}},_create:function(){var a=this;return this._delegate=null,this._$input=$("<div></div>"),this._allowed_timezones=[],this._timezones=this._options.params.items||[],this._timezones.sort(function(a,b){return SO.isNundef(a.displayOrder)||SO.isNundef(b.displayOrder)?0:a.displayOrder-b.displayOrder}),this._checks=[{requirement:function(){return null!==a._value},test:function(a){return SO.isString(a)},error:{message:xtk_sirocco.inputs_incorrectValueErr()}},{requirement:function(){return SO.isString(a._value)},test:function(b){return-1!==a._allowed_timezones.indexOf(b)},error:{message:xtk_sirocco.inputs_incorrectValueErr()}}],SO.Utils.each(this._timezones,function(b,c){a._allowed_timezones.push(c.name)}),this._super(),this},_refreshDisplay:function(a){return this._value,a&&this._createMarkup(),this._delegate._refreshDisplay(a),this._state.disabled||null===this._state.error?(null===this._state.error&&this._$input.hasClass("nlui-state-error")||this._state.disabled)&&this._$input.removeClass("nlui-state-error"):this._$input.addClass("nlui-state-error"),this._$input.prop("disabled",this._state.disabled),this._state.disabled?(this._$input.addClass("nlui-timezonepicker-input-disabled"),this._delegate.setDisabled(!0)):(this._$input.removeClass("nlui-timezonepicker-input-disabled"),this._delegate.setDisabled(!1)),this._state.readOnly?(this._$input.addClass("nlui-timezonepicker-input-readonly"),this._delegate.setReadOnly(!0)):(this._$input.removeClass("nlui-timezonepicker-input-readonly"),this._delegate.setReadOnly(!1)),a&&this._$input.appendTo(this.$el),this},_createMarkup:function(){this.getValue();var a=this;return this._$input&&this._$input.remove(),this.$el.addClass("nlui-timezonepicker nlui-input"),this._$input=$("<div></div>"),this._delegate=new SO.Widgets.DropdownInput(a._$input,{value:a.getValue(),params:{items:a._timezones,maxHeight:300},onInternalChange:$.proxy(a._onInternalChangeDelegate,a),onExternalChange:$.proxy(a._onExternalChangeDelegate,a),onTouched:$.proxy(a._onTouchedDelegate,a),errorDisplay:$.proxy(a._errorDisplayDelegate,a)}),this},setError:function(a){this._super(a),this._delegate.setError(a)},setReadOnly:function(a){this._super(a),this._delegate.setReadOnly(a)},setDisabled:function(a){this._super(a),this._delegate.setDisabled(a)},_setValue:function(a){return this._super(a),this._state.error||this._delegate._setValue(a),this},setValue:function(a){return this._super(a),this._state.error||this._delegate.setValue(a),this},getValue:function(){return this._super()},_onInternalChangeDelegate:function(a){return a!==this.getValue()&&this._setValue(a),this},_onExternalChangeDelegate:function(){var a=this._delegate.getValue();return a!==this.getValue()&&this.setValue(a),this},_onTouchedDelegate:function(){return this._options.onTouched(),this},_errorDisplayDelegate:function(a){return SO.isNundef(a)||SO.Utils.isEqual(a,this._state.error)||this.setError(a),this}}),$.widget("SO.soTimezonePickerInput",{_create:function(){this._widget=new SO.Widgets.TimezonePickerInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("CodeInput","Input",{DEFAULT_OPTIONS:{params:{presets:"xml",autoWrap:!1,prettyPrint:!1}},_create:function(){var a=this;return this._$input=$("<div></div>"),this._delegate=null,this._presets=this._options.params.presets,this._syntaxConfig={text:{gutter:!1,theme:"default",lineNumbers:!1,tabSize:2,indentUnit:2,mode:null},xml:{gutter:!1,theme:"default",lineNumbers:!1,tabSize:2,indentUnit:2,mode:"htmlmixed"},js:{theme:"default",lineNumbers:!1,tabSize:2,indentUnit:2,mode:"javascript"},sql:{theme:"default",lineNumbers:!1,indentUnit:2,tabSize:2,mode:"sql"},css:{theme:"default",lineNumbers:!1,indentUnit:2,tabSize:2,mode:"css"}},this._editor={resizing:!1,locked:!1,dirty:!1,config:CodeMirror.defaults,cursor:{line:0,ch:0},scrollTop:null,instance:null,$el:null},this._checks=[{requirement:function(){return!SO.isNundef(a._value)},test:function(a){return SO.isString(a)},error:{message:xtk_sirocco.inputs_incorrectValueErr()}}],null===this._options.value&&(this._options.value=""),SO.isString(this._options.value)&&(this._options.value=this._fixCrLf(this._options.value)),this._super(),SO.assert(this._syntaxConfig.hasOwnProperty(this._presets),'Invalid syntax type : "'+this._presets+'"'),this._syntaxConfig.hasOwnProperty(this._presets)&&(this._editor.config=this._syntaxConfig[this._presets]),this._options.layoutManager.registerWidget(this),this},_onBlur:function(a){return SO.isNundef(a)||this.$el.removeClass("focus"),this},_onFocus:function(a){return SO.isNundef(a)||this._state.disabled||this._state.readOnly||this.$el.addClass("focus"),this},_onUpdate:function(a){if(!SO.isNundef(a)){var b=this,c=b._editor.cursor,d=b._editor.scrollTop,e=a.getValue(),f=this._value,g=e!==f,h=a.getScrollerElement();!g||this._editor.locked||this._editor.resizing||(this._editor.dirty=!0,this._editor.locked=!0,this._setValue(e),setTimeout(function(){b._editor.locked=!1},0)),a.setCursor(c.line,c.ch),d&&h&&(h.scrollTop=d)}return this},_onChange:function(a){var b,c=this._options.onTouched||function(){};return SO.isNundef(a)||(this._editor.locked||(this._editor.cursor=a.getCursor(!0),b=a.getScrollerElement(),b&&(this._editor.scrollTop=b.scrollTop),this._editor.dirty||this._editor.locked||this._editor.resizing||c()),this._editor.resizing=!1),this},_refreshDisplay:function(a){var b=this._value,c=[];return a&&(this._createMarkup(),c.push(function(){this._createEditor()}),c.push(function(){this._unbindEvents(),this._bindEvents()})),this._delegate._refreshDisplay(a),c.push(function(){var a=this._editor.cursor;this._editor.locked=!0,this._editor.instance.setValue(b),this._editor.instance.setCursor(a.line,a.ch),this._editor.locked=!1}),this._options.params.prettyPrint&&!this._editor.dirty&&c.push(function(){this._applyPrettyPrint()}),this._state.disabled?(this.$el.addClass("nlui-code-readonly"),c.push(function(){this._editor.instance.setOption("readOnly",!0)})):(this.$el.removeClass("nlui-code-readonly"),c.push(function(){this._editor.instance.setOption("readOnly",!1)})),this._state.disabled||this._state.readOnly?this.$el.addClass("nlui-code-disabled"):this.$el.removeClass("nlui-code-disabled"),this._state.disabled?c.push(function(){this._editor.instance.setOption("mode",null),this._editor.instance.setOption("readOnly",!0)}):c.push(function(){this._editor.instance.setOption("mode",this._editor.config.mode),this._editor.instance.setOption("readOnly",this._state.readOnly?!0:!1)}),this._state.error?this.$el.addClass("error"):this.$el.removeClass("error"),a&&this._$input.appendTo(this.$el),this._deferDisplay(c),this},_deferDisplay:function(a){var b,c=this;if(!this.$el.is(":visible"))return setTimeout(function(){c._deferDisplay(a)},0),this;if(SO.isNundef(this._state.error))for(;a.length>0;)b=a.shift(),b.call(this);return this},_unbindEvents:function(){return $(this._editor.instance.getWrapperElement()).off("wheel",this.onMouseWheel),this},_bindEvents:function(){var a=this._editor.instance,b=a.getWrapperElement(),c=a.getScrollInfo().top;return this.onMouseWheel=function(d){var e=d.originalEvent,f=b.getBoundingClientRect(),g=e.deltaY,h=0>g?"up":"down",i=(e.pageY-f.top)*("up"===h?-1:1),j=a.getScrollInfo();c+=i,0>c?c=0:c>j.height&&(c=j.height),a.scrollTo(null,c)},$(b).on("wheel",this.onMouseWheel),this},_createMarkup:function(){this._value;var a=this,b=this._options.params;return this._$input&&this._$input.remove(),this._delegate&&(this._delegate.$el.remove(),this._delegate=null),this.$el.addClass("nlui-input nlui-code nlui-input-fullwidth"),this._$input=$("<div></div>"),this._delegate=new SO.Widgets.MemoInput(a._$input,{fullHeight:!0,value:a._value,params:b,onInternalChange:$.proxy(a._onInternalChangeDelegate,a),onExternalChange:$.proxy(a._onExternalChangeDelegate,a),onTouched:$.proxy(a._onTouchedDelegate,a),errorDisplay:$.proxy(a._errorDisplayDelegate,a)}),this},_createEditor:function(){var a=this,b=$.extend(!0,{},this._editor.config);return this._syntaxConfig.hasOwnProperty(this._presets)||this.$el.addClass("nlui-code-no-highlighting"),b.readOnly=this._state.readOnly?!0:!1,b.lineNumbers=this._state.readOnly?!1:b.lineNumbers,b.lineWrapping=this._options.params.autoWrap===!0?!0:!1,this._state.disabled&&(b.mode=null),this._editor.instance=CodeMirror.fromTextArea(a._$input.find("textarea").get(0),b),this._editor.instance.on("focus",$.proxy(this._onFocus,this)),this._editor.instance.on("blur",$.proxy(this._onBlur,this)),this._editor.instance.on("update",$.proxy(this._onUpdate,this)),this._editor.instance.on("change",$.proxy(this._onChange,this)),this},setError:function(a){this._super(a),this._delegate.setError(a)},setReadOnly:function(a){this._super(a)},setDisabled:function(a){this._super(a),this._delegate.setDisabled(a)},_setValue:function(a){return this._super(a),this._state.error||this._delegate._setValue(a),this},setValue:function(a){var b=this._editor.dirty;return this._editor.dirty=!1,this._super(a),this._editor.dirty=b,this._state.error||this._delegate.setValue(a),this.$el.hasClass("focus")&&this._editor.instance.focus(),this},getValue:function(){return""===this._value?null:this._super()},_onInternalChangeDelegate:function(a){return a!==this._value&&this._setValue(a),this},_onExternalChangeDelegate:function(){var a=this._delegate.getValue();return a!==this._value&&this.setValue(a),this},_onTouchedDelegate:function(){return this._options.onTouched(),this},_errorDisplayDelegate:function(a){return SO.isNundef(a)||SO.Utils.isEqual(a,this._state.error)||this.setError(a),this},_fixCrLf:function(a){var b=new RegExp("\\r(?!\\n)","gim");return a.replace(b,"\r\n")},_applyPrettyPrint:function(){var a,b=this,c=this._editor.instance,d=this._editor.cursor,e=this._$input.css(["position","visibility"]);return this._editor.locked=!0,c.setValue(this._value),CodeMirror.commands.selectAll(c),a={from:c.getCursor(!0),to:c.getCursor(!1)},this._$input.css({position:"fixed",visibility:"hidden"}),c.autoFormatRange(a.from,a.to),c.setCursor(d.line,d.ch),this._$input.css(e),setTimeout(function(){b._value=b._editor.instance.getValue(),b._editor.locked=!1},0),this},rebuildLayout:function(){return this._editor.resizing=!0,this},insertAtCaret:function(a){this._editor.instance.replaceSelection(a)},focus:function(){this._editor.instance.focus()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("CustomInput","Input",{DEFAULT_OPTIONS:{params:{dialogPadding:0,dialogAutoOpen:!1,dialogMode:"maximize",dialogCloseButton:!0,dialogClose:null,dialogOpen:null,dialogResizable:!1,dialogTitle:"",dialogCommandBarHidden:!1,dialogNoPrimaryFirstButton:!0,needRebuildOnOpen:!1,dialogAdaptable:!1,okButtonLabel:xtk_core.dialog_ok(),cancelButtonLabel:xtk_core.dialog_cancel(),ok:function(){},cancel:function(){},displayPickerButton:!0,extraActions:[],onSearch:null,inlineDisplay:null,placeHolder:"Placeholder",mode:"div",icon:"program",iconLeft:null,onInputChange:function(){}}},_create:function(){var a=this._options.params;SO.assert((a.onSearch||a.inlineDisplay)&&!(a.onSearch&&a.inlineDisplay),"onSearch XOR inlineDisplay should be defined"),this._extraActions={},this._mode=a.mode,this._super()},_refreshDisplay:function(a){var b=this._options.params;a&&(this._createMarkup(),this._bindEvents()),"div"===this._mode?(this._$field=this._view.$divField,this._view.$divFieldWrapper.style.display="inherit",this._view.$inputWrapper.style.display="none",null!==this._value?$(this._$field).html(b.inlineDisplay.call(this,this._value)):this._state.readOnly||$(this._$field).html($('<span class="nlui-customeditor-placeholder">').text(b.placeHolder))):(SO.assert(b.onInputChange,"CustomEditor can be in 'input' mode without onInputChange call back"),this._$field=this._view.$inputField,this._view.$divFieldWrapper.style.display="none",this._view.$inputField.style.display="inherit",null!==this._value&&this._$inputField.setValue(this._value)),this._state.readOnly?this._$field.classList.contains("nlui-state-readonly")||(this._$field.classList.add("nlui-state-readonly"),this._$inputField.setReadOnly(!0)):this._$field.classList.contains("nlui-state-readonly")&&(this._$field.classList.remove("nlui-state-readonly"),this._$inputField.setReadOnly(!1))},setMode:function(a){("div"===a||"input"===a)&&(this._mode=a,this._refreshDisplay(!1))},_bindEvents:function(){var a=this;$(a._view.$divFieldWrapper).focusin(function(){a._state.readOnly||(a._view.$divFieldWrapper.classList.add("nlui-customeditor-field-selected"),a._view.$clearButton.style.display=null!==a._value?"block":"none")}),$(a._view.$divFieldWrapper).focusout(function(){a._state.readOnly||(a._view.$divFieldWrapper.classList.remove("nlui-customeditor-field-selected"),a._view.$clearButton.style.display="none")})},_createMarkup:function(){var a,b=this,c=this._options.params,d=function(a){b._options.params.onInputChange.call(null,a)};if(this.$el[0])for(;this.$el[0].hasChildNodes();)this.$el[0].removeChild(this.$el[0].lastChild);this._view=SO.tie({},{tag:"div",cls:"nlui-customeditor-wrapper",cld:[{tag:"div",cls:"nlui-customeditor-field-wrapper",tabindex:"-1",field:"$divFieldWrapper",cld:[{tag:"i",cls:["decorative-icon",this._options.params.iconLeft?"soui-icon-18-"+this._options.params.iconLeft:""].join(" "),field:"$divFieldIcon"},{tag:"div",cls:["nlui-customeditor-field",this._options.params.iconLeft?"has-icon":""].join(" "),field:"$divField"},{tag:"div",cls:"nlui-customeditor-field-clear",field:"$clearButton"}]},{tag:"div",cls:"nlui-customeditor-input-wrapper",field:"$inputWrapper",cld:[{tag:"div",cls:"nlui-customeditor-input",field:"$inputField"}]},{tag:"div",cls:"nlui-customeditor-action-wrapper",field:"$actionWrapper"}]}),this._clearButton=new SO.Widgets.SimpleButton(this._view.$clearButton,{mode:"quiet",icon:"cancel",iconSize:12,onClick:function(){b._setValue(null),b._view.$clearButton.style.display="none"}}),this._$inputField=new SO.Widgets.TextInput(this._view.$inputField,{value:this._value,icon:this._options.params.iconLeft,params:{placeHolder:c.placeHolder},onTouched:function(b){clearTimeout(a),a=setTimeout(function(){d.call(null,b)},300)},onInternalChange:function(c){clearTimeout(a),d.call(null,c),b._setValue(c)}}),this.rebuildActions(),this.$el.addClass("nlui-input nlui-customeditor  nlui-input-fullwidth"),this.$el.append(this._view.el),this._options.params.dialogAutoOpen&&this.openDialog()},rebuildActions:function(){for(var a=this._options.params,b=this;b._view.$actionWrapper.hasChildNodes();)b._view.$actionWrapper.removeChild(b._view.$actionWrapper.lastChild);!this._options.readOnly&&a.displayPickerButton&&(this._browseButton=new SO.Widgets.SimpleButton(document.createElement("div"),{tooltip:xtk_sirocco.exprEdit_browseButtonTooltip(),mode:"secondary",icon:b._state.readOnly?"coral-lockOn":b._options.params.icon,disabled:b._state.readOnly,onClick:function(){b.openDialog()}}),this._view.$actionWrapper.appendChild(this._browseButton.el)),SO.Utils.each(a.extraActions,function(a,c){var d=!0;if(b._state.readOnly&&(d=d&&c.displayInReadOnly),null===b._value&&(d=d&&c.displayWithEmptyValue),d){var e=SO.tie({},{tag:"div",cls:"nlui-customeditor-button",field:"$extraButton"}),f=function(){c.action(b)},g=new SO.Widgets.SimpleButton(e.el,{mode:"secondary",icon:c.icon,disabled:b._state.readOnly&&!c.displayInReadOnly,onClick:f,tooltip:c.tooltip});b._extraActions[a]={buttonEl:e,button:g,action:f},b._view.$actionWrapper.appendChild(e.el)}})},openDialog:function(){this._dialog||this._createDialog(),this._dialog.open(),this._options.params.needRebuildOnOpen&&this._options.layoutManager.rebuildLayout(this._dialog.getBody())},closeDialog:function(){this._dialog.close()},_createDialog:function(){var a=this,b=this._options.params,c=[{mode:"quiet",text:this._options.params.cancelButtonLabel,icon:"coral-closeCircle",click:function(){a._options.params.cancel(),a.closeDialog()}},{text:this._options.params.okButtonLabel,mode:"transparent",icon:"coral-checkCircle",click:function(){var b=a._options.params.ok();b&&(b.valid&&a._setValue(b.value),a.closeDialog())}}];this._$dialog||(this._$dialog=$("<div></div>"),this._$dialog.appendTo("body")),this._dialog=new SO.Widgets.Dialog(this._$dialog,{autoOpen:!1,modal:!0,mode:b.dialogMode,close:b.dialogClose,open:function(){var c=$("<div></div>").css({width:"100%",height:"100%"});a._dialog.setContent(c),b.injectDialogContent&&b.injectDialogContent(c),b.dialogOpen.call(this)},fullHeightElement:b.dialogFullHeight,adaptable:b.dialogAdaptable,buttons:c,resizable:b.dialogResizable,removeOnClose:b.removeOnClose,title:b.dialogTitle,width:b.dialogWidth,height:b.dialogHeight,minWidth:b.dialogMinWidth,minHeight:b.dialogMinHeight,cancel:b.cancel,commandBarHidden:b.dialogCommandBarHidden,noPrimaryFirstButton:b.dialogNoPrimaryFirstButton,closeButton:b.dialogCloseButton,padding:b.dialogPadding,dialogClass:b.dialogClass})},getDialog:function(){return this._dialog}}),$.widget("NL.nlCustomEditor",{_create:function(){this._widget=new SO.Widgets.CustomInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},getDialog:function(){return this.getDialog()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("SimpleButton",{DEFAULT_OPTIONS:{tooltip:"",icon:"",iconSize:18,label:"",mode:"default",disabled:!1,pushed:!1,href:"",newWindow:!1,onClick:function(a,b){b()}},_modes:{"default":"nlui-simple-button-default-mode",primary:"nlui-simple-button-primary-mode",secondary:"nlui-simple-button-secondary-mode",warning:"nlui-simple-button-warning-mode",callToAction:"nlui-simple-button-call-to-action-mode",quiet:"nlui-simple-button-quiet-mode",transparent:"nlui-simple-button-transparent-mode"},_create:function(){this._render(this._options)},_render:function(a){this._button=this._buildButton(a),this.el.appendChild(this._button)},_refresh:function(a){this._options=SO.Utils.extend({},this._options,a),this.el.removeChild(this._button),this._tooltip&&(this._tooltip.hide(),this._tooltip=null),this._render(this._options)},_buildButton:function(a){var b=document.createElement("button"),c=[];return c.push("nlui-simple-button",this._modes[a.mode]),SO.isEmpty(a.icon)||(b.appendChild(this._buildIcon({icon:a.icon,iconSize:a.iconSize,label:a.label,pushed:a.pushed,mode:a.mode})),SO.isEmpty(a.label)?c.push("nlui-simple-button-icon-mode"):c.push("nlui-simple-button-auto-width")),SO.isEmpty(a.label)||b.appendChild(document.createTextNode(a.label)),SO.isEmpty(a.tooltip)||(this._tooltip=new SO.Widgets.Tooltip(b),this._tooltip.setTitle(a.tooltip)),SO.Event.bind(b,"vclick",function(b){a.onClick.call(this,b.originalEvent,function(){SO.Structure.URL.isValid(a.href)&&(a.newWindow?window.open(a.href,"_blank"):window.location=a.href)})}),a.disabled&&b.setAttribute("disabled",!0),a.pushed&&c.push("nlui-simple-button-pushed"),b.className=c.join(" "),b},_buildIcon:function(a){var b;return!/^coral-/.test(a.icon)&&a.pushed&&"transparent"===a.mode&&(a.icon=a.icon+"-active"),b=SO.IMG.genIcon(a.icon,a.iconSize),b.el&&~["primary","default","warning","callToAction"].indexOf(a.mode)?b.setState("parent"):b.el&&a.pushed&&~["transparent","quiet"].indexOf(a.mode)&&b.setState("active"),b=b.el||b[0],b.classList.add("nlui-simple-button-icon"),SO.isEmpty(a.label)||b.classList.add("nlui-simple-button-icon-margin"),b},setOptions:function(a){return this._refresh(a),this},setTooltip:function(a){return this._refresh({tooltip:a}),this},setIcon:function(a){return this._refresh({icon:a}),this},setMode:function(a){return this._refresh({mode:a}),this},setLabel:function(a){return this._refresh({label:a}),this},setDisabled:function(a){return this._refresh({disabled:!!a}),this},setPushed:function(a){return this._refresh({pushed:!!a}),this},destroy:function(){this._button.parentNode&&this.el.removeChild(this._button),this._button=null,this._tooltip&&(this._tooltip.hide(),this._tooltip=null)}}),$.widget("SO.soSimpleButton",{_create:function(){this._widget=new SO.Widgets.SimpleButton(this.element,this.options)},_destroy:function(){this._widget.destroy()},setOptions:function(a){this._widget.setOptions(a)},setTooltip:function(a){this._widget.setTooltip(a)},setIcon:function(a){this._widget.setIcon(a)},setMode:function(a){this._widget.setMode(a)},setLabel:function(a){this._widget.setLabel(a)},setDisabled:function(a){this._widget.setDisabled(a)},setPushed:function(a){this._widget.setPushed(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("ItemPicker","Input",{DEFAULT_OPTIONS:{params:{autoOpen:!1,controller:null,sourcePath:null,zoomAction:null,zoomInReadOnly:!1,zoomTooltip:"",dropdown:!1,placeHolder:xtk_core.list_selectItem(),dialogTitle:xtk_core.list_selectItem(),dialogHelp:null,inlineDisplay:function(){},onOpen:function(){},onClose:function(){}}},_create:function(){var a=this._options.params;SO.assert(a.controller&&a.sourcePath,"Controller & sourcePath should be defined"),this._super()},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents()),this._customEditor.rebuildActions()},_bindEvents:function(){},_createMarkup:function(){var a=this,b=a._options.params;this.$el.addClass("nlui-input nlui-itempicker");var c={configManager:a._options.configManager,onInternalChange:function(b){a._setValue(b)},value:this._value,readOnly:this._state.readOnly,params:{extraActions:{},ok:function(){return{value:a._pickerWidget.getValue(),valid:void 0!==a._pickerWidget.getValue()}},cancel:function(){a._pickerWidget.setValue(a._value)},inlineDisplay:b.inlineDisplay,placeHolder:this._options.params.placeHolder,injectDialogContent:function(b){a._injectDialogContent(b)},dialogTitle:this._options.params.dialogTitle,dialogFullHeight:!0,dialogOpen:function(){this.hideCommandBar(),this.toggleCloseButton(!0),a._options.params.onOpen.call(a)},dialogClose:function(){a._options.params.onClose.call(a)},removeOnClose:this._options.params.removeOnClose,dialogAutoOpen:this._options.params.autoOpen,icon:"folderSearch",dialogClass:this._options.params.dialogClass}};this._state.readOnly?this.el.classList.add("nlui-state-readonly"):this.el.classList.remove("nlui-state-readonly"),null!==this._options.params.zoomAction&&(c.params.extraActions.zoom={icon:"zoom",action:a._options.params.zoomAction,displayInReadOnly:a._options.params.zoomInReadOnly,displayWithEmptyValue:!1,tooltip:a._options.params.zoomTooltip}),this._options.params.dropdown&&(c.params.extraActions.dropdown={icon:"resource-opened",action:function(b){a._dropdownAction(b)},displayWithEmptyValue:!0,displayInReadOnly:!1}),this._customEditor=new SO.Widgets.CustomInput(this.$el,c)},_injectDialogContent:function(a){var b=this,c=b._options.params,d=document.createElement("div"),e=document.createElement("div");if(c.dialogHelp){var f=document.createElement("div");f.classList.add("nlui-itempicker-help"),d.appendChild(f),new SO.Widgets.TextFormat(f,{value:c.dialogHelp,params:{style:"medium"}})}d.appendChild(e);var g=c.controller.getParams(c.sourcePath)||{},h=a,i=new SO.Widgets.Shell(h,{navigationRail:!1,blackBar:!1,footer:!1,actionBar:{},rail:c.rail,canvas:{content:d,padding:!0}});if(g.actions&&g.actions.global&&(g.actions.global.count||g.actions.global.switchLayout||g.actions.global.columnConf)){var j=$("<div></div>");i.addActionBarContent("viewConfig",j),g.actions.global.placeholder=j}if(!c.rail&&g.actions&&g.actions.search&&g.actions.search.enable){var k=$("<div></div>");i.addRailView({icon:"coral-search",id:"search",caption:xtk_core.list_search_button_help(),label:xtk_core.list_search_button_help(),content:k,padding:!0},!1),g.actions.search.placeholder=k}var l;switch(c.controller.getType(c.sourcePath)){case"list":l=SO.Widgets.List;break;case"tree":l=SO.Widgets.Treelist}return b._pickerWidget&&b._pickerWidget.destroy(),b._pickerWidget=new l(e,{onSelection:function(){var a=b._customEditor.getDialog();a.showCommandBar(),a.toggleCloseButton(!1)},fitToParentHeight:!0,controller:c.controller,configManager:g.configManager||b._options.configManager,jpath:b._options.params.sourcePath,selection:b._value instanceof SO.Selection||null===b._value?b._value:new SO.Selection({selectionMode:"mono",items:[b._value]}),selectable:!0,displayColumnsHeader:g.displayColumnsHeader,confId:g.confId+b._options.params.sourcePath,selectionMode:"mono",renderingMethods:g.renderingMethods,defaultRendering:g.defaultRendering,actions:g.actions,metaDataUrl:g.metaDataUrl,uncollapsedNodePath:g.uncollapsedNodePath}),h},_toggleDropdown:function(a){this._dropDownDisplay=void 0===a?!this._dropDownDisplay:!!a,this._dropDownDisplay?this._overlay.show({targetEl:this.el}):this._overlay.hide()},_dropdownAction:function(a){var b=this,c=this._options.params,d=a.$el[0].getBoundingClientRect();if(b._dropdown)this._dropDownList.refresh();else{b._dropdown=document.createElement("div"),b._dropdown.classList.add("nlui-itempicker-dropdown"),b.setFloatable(b._dropdown),b._options.popableManager.addPopable({isOwnerOf:function(a){var c=this;return SO.DOMUtils.isDescendantOf(a,$(c.$el))||a.is(b._dropdown)||SO.DOMUtils.isDescendantOf(a,b._dropdown)||SO.DOMUtils.isDescendantOf(a,b._customEditor._extraActions.dropdown.button.$el)},collapse:function(){b._toggleDropdown(!1)}}),document.body.appendChild(b._dropdown);var e=c.controller.getParams(c.sourcePath);b._dropDownList=new SO.Widgets.List(b._dropdown,{theme:"light",controller:b._options.params.controller,jpath:b._options.params.sourcePath,selection:b._value,selectable:!0,displayColumnsHeader:e.displayColumnsHeader,selectionMode:"mono",onSelection:function(a){b._toggleDropdown(),b._setValue(a)},renderingMethods:{inline:{family:"line",renderer:function(a){var c=new SO.Selection({selectionMode:"mono",items:[a]});return b._options.params.inlineDisplay(c)}}},defaultRendering:"inline"})}b._dropdown.style.width=d.width+"px",b._toggleDropdown()},setValue:function(a){this._pickerWidget&&this._pickerWidget.setValue(a),this._dropDownList&&this._dropDownList.setValue(a),this._customEditor.setValue(a),this._super(a)},_setValue:function(a){this._pickerWidget&&this._pickerWidget.setValue(a),this._dropDownList&&this._dropDownList.setValue(a),this._customEditor.setValue(a),this._refreshDisplay(!1),this._super(a)},openDialog:function(){this._customEditor.openDialog()},closeDialog:function(){this._customEditor.closeDialog()}}),$.widget("SO.soItemPicker",{_create:function(){this._widget=new SO.Widgets.ItemPicker(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.Selection"),SO.Selection=function(a){this._mono="mono"===SO.Utils.getValueFromObj(a,"selectionMode","mono"),this._items=SO.Utils.getValueFromObj(a,"items",null)},SO.Selection.prototype.isMono=function(){return this._mono},SO.Selection.prototype.isEmpty=function(){return null===this._items||0===this._items.length},SO.Selection.prototype.getItem=function(){var a=null;return this._mono===!0?null!==this._items&&(a=SO.Utils.extend(!0,[],this._items)[0]):SO.assert(!1,"In Multi selection use getItems instead of getItem"),a},SO.Selection.prototype.getItems=function(){return SO.Utils.extend(!0,[],this._items)};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";var ViewControllerManager=function(){var a=function(a,b,c){if(this.controller=a,this.jpath=b,this.display=c,this.$div=$("<div></div>"),this._widgetOptions=null,void 0===this.widgetName)throw"The widget name must never be undefined!"};a.prototype.widget=function(){return this.$div},a.prototype._valueChanged=function(a){this.controller.setValue(this.jpath,a,!0,{_sourceObserver:this})},a.prototype._errorDisplay=function(){},a.prototype.isVariableHeight=function(){return!1},a.prototype.onInternalChange=function(a,b,c){SO.assert(void 0!==c,"onInternalChange should pass strict as 3rd argument"),this.controller.setStrict(this.jpath,c,{_sourceObserver:this}),this.controller.setError(this.jpath,b,!0,{_sourceObserver:this}),this._valueChanged(a)},a.prototype.onExternalChange=function(a,b){SO.assert(void 0!==b,"onExternalChange should pass strict as 2nd argument"),this.controller.setStrict(this.jpath,b,{_sourceObserver:this}),this.controller.setError(this.jpath,a,!0,{_sourceObserver:this})},a.prototype.onTouched=function(){var a=this.controller.isInWorkingSpace(this.jpath);a||this.controller.isDirty()||this.controller.setDirty(!0)},a.prototype.errorDisplay=function(a){this._errorDisplay(a)},a.prototype.setValue=function(a){this.$div[this.widgetName]("setValue",a)},a.prototype.setError=function(a){this.$div[this.widgetName]("setError",a)},a.prototype.setReadOnly=function(a){this.$div[this.widgetName]("setReadOnly",a)},a.prototype.setDisabled=function(a){this.$div[this.widgetName]("setDisabled",a)},a.prototype.setStrict=function(a){this.$div[this.widgetName]("setStrict",a)},a.prototype.setMandatory=function(a){this.$div[this.widgetName]("setMandatory",a)},a.prototype.setParamSubtree=function(a,b){this.$div[this.widgetName]("setParamSubtree",a,b)},a.prototype.initialize=function(a){this.$div[this.widgetName](SO.Utils.extend(a,this._widgetOptions))};var b=function(a,b,c){if(this.controller=a,this.jpath=b,this.display=c,this._widgetOptions=null,this.$div=$("<div></div>"),void 0===this.widgetCtor)throw"The widget name must never be undefined!"};b.prototype.widget=function(){return this.$div},b.prototype._errorDisplay=function(){},b.prototype.isVariableHeight=function(){return!1},b.prototype._valueChanged=function(a){this.controller.setValue(this.jpath,a,!0,{_sourceObserver:this})},b.prototype.onInternalChange=function(a,b,c){SO.assert(void 0!==c,"onInternalChange should pass strict as 3rd argument"),this.controller.setStrict(this.jpath,c,{_sourceObserver:this}),this.controller.setError(this.jpath,b,!0,{_sourceObserver:this}),this._valueChanged(a)},b.prototype.onExternalChange=function(a,b){SO.assert(void 0!==b,"onExternalChange should pass strict as 2nd argument"),this.controller.setStrict(this.jpath,b,{_sourceObserver:this}),this.controller.setError(this.jpath,a,!0,{_sourceObserver:this})},b.prototype.onTouched=function(){var a=this.controller.isInWorkingSpace(this.jpath);a||this.controller.isDirty()||this.controller.setDirty(!0)},b.prototype.errorDisplay=function(a){this._errorDisplay(a)},b.prototype.setValue=function(a){this.widgetInstance.setValue(a)},b.prototype.setError=function(a){this.widgetInstance.setError(a)},b.prototype.setReadOnly=function(a){this.widgetInstance.setReadOnly(a)},b.prototype.setDisabled=function(a){this.widgetInstance.setDisabled(a)},b.prototype.setStrict=function(a){this.widgetInstance.setStrict(a)},b.prototype.setMandatory=function(a){this.widgetInstance.setMandatory(a)},b.prototype.setParamSubtree=function(a,b){this.widgetInstance.setParamSubtree(a,b)},b.prototype.initialize=function(a){this.widgetInstance=new SO.ErrorDecorator(this.widgetCtor,this.$div,SO.Utils.extend(a,this._widgetOptions))};var c=function(a,b,d){c.baseConstructor.call(this,a,b,d),this.$text=$("<label></label>").appendTo(this.$div)};SO.OO.extend(c,a),c.prototype.setValue=function(a){if(null!==a&&void 0!==a){var b=this.controller.getParams(this.jpath),c=b.type,d=b.options;if("enum"===c&&null!==d){var e=_.find(d,function(b){return b.name===a});null!==e&&void 0!==e&&(a=e.label)}var f=b.format;void 0!==f&&null!==f&&$.isFunction(f)&&(a=f(a)),this.$text.text(a)}},c.prototype.initialize=function(){};var d=function(a,b,c){this.widgetCtor=SO.Widgets.TextInput,d.baseConstructor.call(this,a,b,c);var e=this,f=a.getParams(b),g=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(e.onInternalChange,this),onExternalChange:$.proxy(e.onExternalChange,this),onTouched:$.proxy(e.onTouched,this),errorDisplay:$.proxy(e.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),icon:c.icon,params:f,displayParams:g})};SO.OO.extend(d,b);var e=function(a,b,c,d){this.widgetName="soTextFormat",e.baseConstructor.call(this,a,b,c);var f=this;f._valueJpath=b;var g=$.extend(!0,{},a.getParams(b),d||{}),h=a.getDisplayParams(b),i=this._pathValue(a,b,g);this._widgetOptions=$.extend({onInternalChange:$.proxy(f.onInternalChange,this),onExternalChange:$.proxy(f.onExternalChange,this),onTouched:$.proxy(f.onTouched,this),errorDisplay:$.proxy(f.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:i,icon:c.icon,params:g,displayParams:h}),a.registerJpathObserver(f._valueJpath,{onJpathNotify:function(b){var c=f._pathValue(a,f._valueJpath,g);"value"===b&&c!=i&&(f.$div[f.widgetName]("setValue",c),i=c)},refresh:function(){var b=f._pathValue(a,f._valueJpath,g);b!=i&&(f.$div[f.widgetName]("setValue",b),i=b)}})};SO.OO.extend(e,a),e.prototype._pathValue=function(a,b,c){var d=a.getValue(b),e=a.getType(b);if(c.displayFormat)d=SO.Format.formatValue(d,c.displayFormat,{locale:c.locale.getName(),timezone:c.timezone.getName()}),SO.isNundef(d)&&(d=xtk_core.notDefined());else if(SO.isNundef(d))d=xtk_core.notDefined();else switch(e){case"datetime":d=SO.DateTime.format(d,{locale:c.locale.getName(),timezone:c.timezone.getName()}),SO.isNundef(d)&&(d=xtk_core.notDefined());break;case"dateonly":d=SO.DateOnly.format(d,{locale:c.locale.getName(),timezone:c.timezone.getName()}),SO.isNundef(d)&&(d=xtk_core.notDefined());break;default:}return d};var f=function(a,b,c){this.widgetCtor=SO.Widgets.PasswordInput,f.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),icon:c.icon,params:e})};SO.OO.extend(f,b);var g=function(a,b,c){this.widgetName="soSearchInput",g.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:e})};SO.OO.extend(g,a);var h=function(a,b,c){this.widgetCtor=SO.Widgets.NumberInput,h.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b),f=a.getDisplayParams(b),g=a.getDisplayFormat(b),i=a.getType(b).toLowerCase();this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),icon:c.icon,params:e,displayParams:f,displayFormat:g}),"double"===i&&(this._widgetOptions.params=$.extend({},this._widgetOptions.params,{type:"float"}))};SO.OO.extend(h,b);var i=function(a,b,c){this.widgetCtor=SO.Widgets.MemoInput,i.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b),f=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),icon:c.icon,params:e,displayParams:f})};SO.OO.extend(i,b),i.prototype.isVariableHeight=function(){return!0};var j=function(a,b,c,d){this.widgetCtor=SO.Widgets.CheckBoxInput,j.baseConstructor.call(this,a,b,c);var e=this,f=$.extend(!0,{},a.getParams(b),d||{}),g=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(e.onInternalChange,this),onExternalChange:$.proxy(e.onExternalChange,this),errorDisplay:$.proxy(e.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:f,icon:c.icon,displayParams:g})};SO.OO.extend(j,b);var k=function(a,b,c,d){this.widgetCtor=SO.Widgets.DropdownInput,k.baseConstructor.call(this,a,b,c);var e=this,f=SO.Utils.extend(!0,{},a.getParams(b),d);f.items=(d&&d.topItems||[]).concat(f.items);var g=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(e.onInternalChange,this),onExternalChange:$.proxy(e.onExternalChange,this),errorDisplay:$.proxy(e.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:f,displayParams:g})};SO.OO.extend(k,b);var l=function(a,b,c,d){this.widgetCtor=SO.Widgets.DropdownInput,l.baseConstructor.call(this,a,b,c);for(var e,f,g=this,h=b,i={items:d&&d.topItems||[],selection:"mono"},j=d.labelPath,k=d.namePath,m=d.srcPath,n=a.getValue(m),o=0;n.length>o;o++)e=a.getValue(m+"/"+o+"/"+j),f=a.getValue(m+"/"+o+"/"+k),i.items.push({label:e,name:f});d&&"noSelectionLabel"in d&&(d.instruction=d.noSelectionLabel);var p=a.getDisplayParams(m),q=SO.Utils.extend(!0,{},i,d);this._widgetOptions=$.extend({onInternalChange:$.proxy(g.onInternalChange,this),onExternalChange:$.proxy(g.onExternalChange,this),errorDisplay:$.proxy(g.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:q,displayParams:p}),a.registerJpathObserver(m,{onJpathNotify:function(b,c,d){"value"===b&&a.setParamSubtree(h,"/",{items:d})}})};SO.OO.extend(l,b);var m=function(a,b,c,d){this.widgetCtor=SO.Widgets.DateInput;var e,f=a.getType(b);"date"===f&&(SO.log.warn("Type date is deprecated use dateonly instead"),e={selector:"day",dataType:"dateonly"}),"datetime"===f?e={selector:"second",dataType:"datetime"}:"dateonly"===f&&(e={selector:"day",dataType:"dateonly"}),m.baseConstructor.call(this,a,b,c);var g=this,h=SO.Utils.extend({},a.getParams(b),d);e&&(h=SO.Utils.extend(h,e));var i=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(g.onInternalChange,this),onExternalChange:$.proxy(g.onExternalChange,this),errorDisplay:$.proxy(g.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),icon:c.icon,params:h,displayParams:i}),SO.isNundef(h.tzPath)||a.registerJpathObserver(h.tzPath,{onJpathNotify:function(b,c,d){if("value"===b){var e=SO.Utils.find(g._tzItems,function(a,b){return b.name===d?b.value:void 0}).value;SO.TimezoneManager.fetchTimezone(e,function(){g.$div[g.widgetName]("setTimeZone",e);var b=g.$div[g.widgetName]("getValue");a.setValue(c,b)})}}})};SO.OO.extend(m,b),m.prototype.initialize=function(a){var b,c,d,e;b=this,this.widgetInstance=new SO.ErrorDecorator(this.widgetCtor,this.$div,SO.Utils.extend(a,this._widgetOptions)),c=this._widgetOptions.params.tzPath,SO.isNundef(c)||(d=this.controller.getValue(c),e=d.replace("_","/"),this._tzItems=this.controller.getParams(c).items,SO.TimezoneManager.fetchTimezone(e,function(){b.widgetInstance.setTimeZone(e)}))};var n=function(a,b,c){this.widgetCtor=SO.Widgets.TimeInput;var d,e=a.getType(b);("timeonly"===e||"time"===e)&&(d={selector:"second",dataType:"time"}),n.baseConstructor.call(this,a,b,c);var f=this,g=a.getParams(b);d&&(g=SO.Utils.extend(g,d));var h=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(f.onInternalChange,this),onExternalChange:$.proxy(f.onExternalChange,this),errorDisplay:$.proxy(f.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),icon:c.icon,params:g,displayParams:h})};SO.OO.extend(n,b);var o=function(a,b,c){this.widgetName="nlCompactEditor",o.baseConstructor.call(this,a,b,c);var d=this,e=SO.Utils.extend(!0,{},a.getParams(b));if(void 0===e["_#compactConfig"])throw"Cant instantiate "+this.widgetName+" without _#compactConfig attr in params";var f=e["_#compactConfig"];e["_#compactConfig"]=void 0;var g=a.getDataSource(b),h=a._metamodel._getItem(b,!1).dataSourceConf,i=a.getElements(b),j=a.getKeys(b),k=new SO.MVC.Controller({metamodel:{tmp:{type:"list",dataSource:g,dataSourceConf:h,elements:i,keys:j}},model:{tmp:[]}}),l=$.extend({width:350,height:250,onDataLoadCallback:function(){d._widgetOptions.params.flat||d.$div[d.widgetName]("refreshInlineDisplay")},selection:a.getValue(b),fitToParentHeight:!0},e,{controller:k,jpath:"tmp"});f.flat||(l.autoLoad=!1),f=$.extend(!0,{widget:"soList",widgetOptions:l,dialogTitle:xtk_sirocco.colorPicker_dialogTitle(),dialogWidth:370,dialogHeight:360,dialogResizable:!1,flat:!1,needRebuildOnOpen:!0,allowResetValue:!0},f),this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:f})};SO.OO.extend(o,a),o.prototype.isVariableHeight=function(){return!0};var p=function(a,b,c){this.widgetName="nlNavigator",p.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),controller:a,jpath:b,params:e},e)};SO.OO.extend(p,a);var q=function(a,b,c){this.widgetName="nlCompactEditor",q.baseConstructor.call(this,a,b,c);var d=this,e=SO.Utils.extend(!0,{},a.getParams(b));SO.assert(e["_#compactConfig"]&&e["_#compactConfig"].flat!==!1,"List should not be instantiated with flat = false, use itempicker instead");var f={flat:!0},g=$.extend({onDataLoadCallback:function(){d._widgetOptions.params.flat||d.$div[d.widgetName]("refreshInlineDisplay")},selectionMode:"mono",controller:a,jpath:b,fitToParentHeight:!0},e);f.flat||(g.autoLoad=!1),f=$.extend(!0,{widget:"soList",widgetOptions:g,dialogWidth:370,dialogHeight:360,dialogResizable:!1,allowResetValue:!0,flat:!0,needRebuildOnOpen:!0},f),this._widgetOptions=$.extend({errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:f})};SO.OO.extend(q,a),q.prototype.isVariableHeight=function(){return!0};var r=function(a,b,c){this.widgetName="nlCompactEditor",r.baseConstructor.call(this,a,b,c);var d=this,e=SO.Utils.extend(!0,{},a.getParams(b));SO.assert(e["_#compactConfig"]&&e["_#compactConfig"].flat!==!1,"Grid should not be instantiated with flat = false, use itempicker instead");var f={flat:!0},g=$.extend({onDataLoadCallback:function(){d._widgetOptions.params.flat||d.$div[d.widgetName]("refreshInlineDisplay")},selectionMode:"mono",fitToParentHeight:!0,controller:a,jpath:b},e);f=$.extend(!0,{widget:"soList",widgetOptions:g,dialogWidth:370,dialogHeight:360,dialogResizable:!1,allowResetValue:!0,flat:!0,needRebuildOnOpen:!0},f),this._widgetOptions=$.extend({errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:f})};SO.OO.extend(r,a),r.prototype.isVariableHeight=function(){return!0};var s=function(a,b,c){this.widgetName="nlCompactEditor",s.baseConstructor.call(this,a,b,c);var d=this,e=SO.Utils.extend(!0,{},a.getParams(b));SO.assert(e["_#compactConfig"]&&e["_#compactConfig"].flat!==!1,"Treelist should not be instantiated with flat = false, use itempicker instead");var f={flat:!0},g=$.extend({onDataLoadCallback:function(){d._widgetOptions.params.flat||d.$div[d.widgetName]("refreshInlineDisplay")},controller:a,jpath:b,fitToParentHeight:!0},e);f.flat||(g.autoLoad=!1),f=$.extend(!0,{widget:"soTreeList",widgetOptions:g,dialogWidth:500,dialogHeight:500,dialogResizable:!1,allowResetValue:!0,flat:!1,needRebuildOnOpen:!0},f),this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:f})};SO.OO.extend(s,a),s.prototype.isVariableHeight=function(){return!0};var t=function(a,b,c){this.widgetName="soMultipleChoice",t.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b),f=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:e,displayParams:f})};SO.OO.extend(t,a),t.prototype.isVariableHeight=function(){return!0};var u=function(a,b,c){this.widgetCtor=SO.Widgets.ColorInput,u.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b),f=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:e,displayParams:f})};SO.OO.extend(u,b);var v=function(a,b,c){this.widgetCtor=SO.Widgets.BorderInput,v.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b),f=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:e,displayParams:f})};SO.OO.extend(v,b);var w=function(a,b,c){this.widgetCtor=SO.Widgets.BackgroundInput,w.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b),f=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:e,displayParams:f})};SO.OO.extend(w,b);var x=function(a,b,c){this.widgetCtor=SO.Widgets.ExprBuilder,x.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b),f=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),icon:c.icon,params:e,displayParams:f})};SO.OO.extend(x,b);var y=function(a,b,c){this.widgetCtor=SO.Widgets.compactInput,y.baseConstructor.call(this,a,b,c);var d=this,e=SO.Utils.extend(!0,{},a.getParams(b));if(void 0===e["_#compactConfig"])throw"Cant instantiate "+this.widgetName+" without _#compactConfig attr in params";var f=e["_#compactConfig"];e["_#compactConfig"]=void 0;var g=e;f=$.extend(!0,{widget:"nlGeometryEdit",widgetOptions:g,dialogWidth:350,dialogTitle:xtk_core.geometryEdit_dialogTitle()},f),this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,value:a.getValue(b),strict:c.strict,mandatory:c.mandatory,params:f})};SO.OO.extend(y,b),y.prototype.isVariableHeight=function(){return!1};var z=function(a,b,c,d){this.widgetCtor=SO.Widgets.ItemPicker,z.baseConstructor.call(this,a,b,c);var e=this,f=a.getParams(b),g=a.getDisplayParams(b),h=$.extend({},d,f,{controller:a,sourcePath:f.source,inlineDisplay:f.inlineRenderer,dropdown:f.dropdown,zoomAction:f.zoomAction,zoomInReadOnly:f.zoomInReadOnly,zoomTooltip:f.zoomTooltip,dialogTitle:f.dialogTitle,autoOpen:f.autoOpen,rail:f.rail,removeOnClose:f.removeOnClose});this._widgetOptions=$.extend({onInternalChange:$.proxy(e.onInternalChange,this),onExternalChange:$.proxy(e.onExternalChange,this),onTouched:$.proxy(e.onTouched,this),errorDisplay:$.proxy(e.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:h,displayParams:g})};SO.OO.extend(z,b);var A=function(a,b,c){this.widgetCtor=SO.Widgets.PathEdit,A.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b),f=e.metaDataService,g=a.getDisplayParams(b),h=$.extend({},e,{});this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:h,displayParams:g,metaDataService:f})};SO.OO.extend(A,b);var B=function(a,b,c){this.widgetCtor=SO.Widgets.ExprEdit,B.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b),f=e.metaDataService,g=a.getDisplayParams(b),h=$.extend({},e,{});this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:h,displayParams:g,metaDataService:f})};SO.OO.extend(B,b);var C=function(a,b,c,d){this.widgetCtor=SO.Widgets.TimeSpanInput,C.baseConstructor.call(this,a,b,c);var e=this,f=$.extend(!0,{},a.getParams(b),d||{}),g=a.getDisplayParams(b),h=a.getDisplayFormat(b),i=a.getValue(b);i instanceof SO.TimeSpan||!SO.isString(i)||(i=SO.TimeSpan.parse(i)),SO.isString(f.displayFormat)&&(h=f.displayFormat),this._widgetOptions=$.extend({onInternalChange:$.proxy(e.onInternalChange,this),onExternalChange:$.proxy(e.onExternalChange,this),errorDisplay:$.proxy(e.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:i,controller:a,jpath:b,icon:c.icon,params:f,displayParams:g,displayFormat:h})};SO.OO.extend(C,b);var D=function(a,b,c){this.widgetName="soTimezonePickerInput",D.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b),f=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:e,displayParams:f})};SO.OO.extend(D,a);var E=function(a,b,c,d){this.widgetName="soRadioGroup",F.baseConstructor.call(this,a,b,c);var e=this,f=a.getValue(b);a.getDisplayParams(b);var g=$.extend(!0,{},a.getParams(b),d||{});this._widgetOptions=$.extend({onInternalChange:$.proxy(e.onInternalChange,this),onExternalChange:$.proxy(e.onExternalChange,this),errorDisplay:$.proxy(e.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:f,radioButtons:g.radioButtons})};SO.OO.extend(E,a);var F=function(a,b,c,d){this.widgetName="soRadioButtonInput",F.baseConstructor.call(this,a,b,c);var e=this,f=a.getValue(b),g=a.getDisplayParams(b),h=$.extend(!0,{},a.getParams(b),d||{});h.checked=f===h.value,this._widgetOptions=$.extend({onInternalChange:$.proxy(e.onInternalChange,this),onExternalChange:$.proxy(e.onExternalChange,this),errorDisplay:$.proxy(e.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:f,params:h,displayParams:g}),a.registerJpathObserver(b,{onJpathNotify:function(a,b,c){e.jpath===b&&"value"===a&&e.$div[e.widgetName]("setChecked",c===h.value)}})};SO.OO.extend(F,a);var G=function(a,b,c,d){this.widgetCtor=SO.Widgets.CodeInput,G.baseConstructor.call(this,a,b,c);var e=this,f=$.extend(!0,{},a.getParams(b),d||{}),g=a.getDisplayParams(b);f.language&&(f.presets=f.language,delete f.language),this._widgetOptions=$.extend({onInternalChange:$.proxy(e.onInternalChange,this),onExternalChange:$.proxy(e.onExternalChange,this),onTouched:$.proxy(e.onTouched,this),errorDisplay:$.proxy(e.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:f,displayParams:g})};SO.OO.extend(G,b),G.prototype.isVariableHeight=function(){return!0};var H=function(a,b,c,d){this.widgetName="nlPersonalizedTextInput",H.baseConstructor.call(this,a,b,c);var e=this,f=$.extend(!0,{},a.getParams(b),d||{}),g=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(e.onInternalChange,this),onExternalChange:$.proxy(e.onExternalChange,this),onTouched:$.proxy(e.onTouched,this),errorDisplay:$.proxy(e.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),icon:c.icon,params:f,displayParams:g})};SO.OO.extend(H,a);var I=function(a,b,c){this.widgetName="soProgressBar",I.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b)||{},f=a.getDisplayParams(b);SO.assert(void 0!==e.source,"Progressbar viewcontroller should have a 'source' param"),this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(e.source),displayParams:f})};SO.OO.extend(I,a);var J=function(a,b,c){this.widgetName="soProgressCircle",J.baseConstructor.call(this,a,b,c);var d=this,e=a.getParams(b)||{},f=a.getDisplayParams(b);SO.assert(void 0!==e.source,"Progresscircle viewcontroller should have a 'source' param"),this._widgetOptions=$.extend({onInternalChange:$.proxy(d.onInternalChange,this),onExternalChange:$.proxy(d.onExternalChange,this),onTouched:$.proxy(d.onTouched,this),errorDisplay:$.proxy(d.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(e.source),displayParams:f})};SO.OO.extend(J,a);var K=function(a,b,c,d){this.widgetCtor=SO.Widgets.Image,K.baseConstructor.call(this,a,b,c);var e=this,f=$.extend(!0,{},a.getParams(b),d||{}),g=a.getDisplayParams(b);this._widgetOptions=$.extend({onInternalChange:$.proxy(e.onInternalChange,this),onExternalChange:$.proxy(e.onExternalChange,this),onTouched:$.proxy(e.onTouched,this),errorDisplay:$.proxy(e.errorDisplay,this)},{disabled:c.disabled,readOnly:c.readOnly,strict:c.strict,mandatory:c.mandatory,value:a.getValue(b),params:f,displayParams:g})};SO.OO.extend(K,b);var L=function(a,b,L,M){var N=a.getValue(b),O=a.getType(b),P=a.getDataPolicy(b);if(O||(SO.log.warn("nlForm: no type defined for jpath ["+b+"]. Use string."),O="string"),SO.isObject(M)&&SO.isString(M.editType)&&(O=M.editType),void 0===N&&SO.log.warn("nlForm: value of attribute ["+b+"] is unset"),O=O.toLowerCase(),"dbPassword"===P||"hashPassword"===P||"serverPassword"===P)return new f(a,b,L,M);switch(O){case"enum":return new k(a,b,L,M);case"enumlist":return new l(a,b,L,M);case"string":case"text":case"mntoken":return new d(a,b,L,M);case"password":return new f(a,b,L,M);case"search":return new g(a,b,L,M);case"number":case"integer":case"long":case"double":case"byte":case"short":return new h(a,b,L,M);case"memo":case"cdata":case"html":case"any":return new i(a,b,L,M);case"js":case"css":case"xml":case"sql":case"htmlSource":case"code":return new G(a,b,L,M);case"personalizedtext":return new H(a,b,L,M);case"boolean":return new j(a,b,L,M);case"date":case"dateonly":case"partialdate":case"datetime":return new m(a,b,L,M);case"timeonly":case"time":return new n(a,b,L,M);case"link":return SO.log.warn("The 'link' type is deprecated, you should use the 'itempicker' type instead"),new o(a,b,L,M);case"navigator":return new p(a,b,L,M);case"tree":return new s(a,b,L,M);case"pathedit":return new A(a,b,L,M);case"expredit":return new B(a,b,L,M);case"list":return new q(a,b,L,M);case"grid":return new r(a,b,L,M);case"multiplechoice":return new t(a,b,L,M);case"color":return new u(a,b,L,M);case"border":return new v(a,b,L,M);case"background":return new w(a,b,L,M);case"exprbuilder":return new x(a,b,L,M);case"geometry":return new y(a,b,L,M);case"itempicker":return new z(a,b,L,M);case"timespan":return new C(a,b,L,M);case"radiobutton":return new F(a,b,L,M);case"radiogroup":return new E(a,b,L,M);case"timezone":return new D(a,b,L,M);case"progressbar":return new I(a,b,L,M);case"progresscircle":return new J(a,b,L,M);case"image":return new K(a,b,L,M);case"value":return new e(a,b,L,M);default:SO.log.warn("Unknown input type: '"+O+"'")}return new c(a,b,L,M)};return{newViewController:L}}();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlMore",a.NL.nlWidget,{options:{minHeight:150,maxHeight:500,value:"",style:"empty"},_collapsed:null,_$container:null,_$textContainer:null,_$moreLinkContainer:null,_$lessLinkContainer:null,_$value:null,_predefinedStyles:{empty:{containerClass:void 0},border:{containerClass:"nlui-more-container-border"}},_linkPaddingTop:5,_create:function(){var b,c;b=a(this.element).contents(),this._$value=b.length>0?b:a("<div>"+this.options.value+"</div>").contents(),this.element.addClass("nlui-more"),a(this.element).children().remove(),this._$container=a('<div class="nlui-more-container"></div>').appendTo(a(this.element)),c=this._predefinedStyles[this.options.style],void 0!==c.containerClass&&this._$container.addClass(c.containerClass),this._$textContainer=a('<div class="nlui-more-text-container"></div>').appendTo(a(this._$container)),this._$textContainer.append(this._$value),this._$container.css("position","relative"),this.collapse(!0),this.options.layoutManager.registerWidget(this)},destroy:function(){a.remove(this._$container)},rebuildLayout:function(){this._collapsed===!0||null===this._collapsed?this.collapse(!0):this.expand(!0)},_setOption:function(b,c){"value"===b&&this.value(c),a.NL.nlWidget.prototype._setOption.apply(this,arguments)},value:function(b){return void 0===b?this._$value:(this._$value=a("<div>"+b+"</div>").contents(),this._$textContainer.children().remove(),this._$textContainer.contents().remove(),this._$textContainer.append(this._$value),this.rebuildLayout(),this)},collapse:function(b){if(!this._collapsed||b===!0){var c,d,e,f,g,h,i;f=this._$textContainer.height(),f>this.options.minHeight&&(null!==this._$lessLinkContainer&&(a(".nlui-more-link-container",this.element).remove(),this._$lessLinkContainer=null),this._$moreLinkContainer=a('<div class="nlui-more-link-container"></div>').appendTo(this._$container),e=a('<a class="nlui-more-a-more-link" href="javascript:;"></a>').text(xtk_core.more_moreText()).appendTo(this._$moreLinkContainer),g=e.height(),i=Math.max(Math.floor(this.options.minHeight/g)*g,g),f>i+g?(this._$textContainer.height(i).css("maxHeight",i+"px").css("overflow-y","hidden").scrollTop(0),h=i+g+this._linkPaddingTop,this._$container.height(h).css("maxHeight",h+"px").css("overflow-y","hidden"),d=Math.max(i,0),e.css("top",d+"px").css("padding-top",this._linkPaddingTop+"px"),c=this,a(".nlui-more-a-more-link",this._$container).on("click",function(){c.expand(!1)}),this._collapsed=!0):this._$moreLinkContainer.remove())}return this},expand:function(b){if(this._collapsed||b===!0){var c,d,e,f,g;null!==this._$moreLinkContainer&&(a(".nlui-more-link-container",this.element).remove(),this._$moreLinkContainer=null),this._$lessLinkContainer=a('<div class="nlui-more-link-container"></div>').appendTo(this._$container),f=a('<a class="nlui-more-a-less-link" href="javascript:;"></a>').text(xtk_core.more_lessText()).appendTo(this._$lessLinkContainer),d=Math.min(this._$textContainer[0].scrollHeight,this.options.maxHeight),f.css("top",d+"px").css("padding-top",this._linkPaddingTop+"px"),g=f.height(),e=this.options.maxHeight+g+this._linkPaddingTop,this._$textContainer.height("auto").css("maxHeight",this.options.maxHeight+"px").css("overflow-y","auto").scrollTop(0),this._$textContainer.height()<this._$textContainer[0].scrollHeight&&(this._$textContainer[0].scrollHeight<this.options.maxHeight?this._$textContainer.height(this._$textContainer[0].scrollHeight):this._$textContainer.height(this.options.maxHeight)),this._$textContainer[0].scrollHeight>this.options.maxHeight?this._$container.height(e).css("maxHeight",e+"px"):(e=this._$textContainer[0].scrollHeight+g+this._linkPaddingTop,this._$container.height(e).css("maxHeight",e+"px")),f.css("top",Math.min(this._$textContainer.height(),this.options.maxHeight)+"px"),c=this,f.on("click",function(){c.collapse(!1)}),this._collapsed=!1}return this}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlMultiSel",a.NL.nlWidget,{options:{value:[],onValueChanged:void 0,enabled:!0,source:null,itemRenderer:null},$input:void 0,tokens:void 0,_create:function(){var a=this;SO.isNundef(this.options.itemRenderer)&&(this.options.itemRenderer=this._defaultItemRenderer),this.element.addClass("nlui-multisel"),this.tokens=[],SO.Utils.map(a.options.value,function(b,c){a._addItem(c,!1)}),this._refresh()},_defaultItemRenderer:function(b,c){var d=b.label,e=a("<div></div>");if(SO.isEmpty(c.searchTerm))return e.text(d);var f=SO.XSS.escapeXMLString(c.searchTerm),g=new RegExp(c.searchTerm,"gi");return d=SO.XSS.escapeXMLString(d),d=d.replace(g,"<em>"+f+"</em>"),e.html(d)},_refresh:function(){var b=this;if(this.element.children().remove(),a.each(this.tokens,function(a,c){c.$close.toggle(b.options.enabled),c.$token.appendTo(b.element)}),this.options.enabled){var c=a('<input class="nlui-input"></input>').attr("type","text");c.appendTo(this.element),this.$input=c,this.$input.nlAutoComplete({source:this.options.source,itemRenderer:this.options.itemRenderer,select:function(a){b.$input.val(""),b._addItem(a,!0)}})}this.element.toggleClass("nlui-multisel-disabled",!this.options.enabled)},_setOption:function(b,c){"value"===b?(this.value(c),this._refresh()):"enabled"===b&&(this.options.enabled=!!c,this._refresh()),a.NL.nlWidget.prototype._setOption.apply(this,arguments)},_newToken:function(b){var c=this,d=b.label,e=a("<div></div>").addClass("nlui-multisel-token").text(d);b.icon&&NL.View.genImage(b.icon).appendTo(e),b.title&&(e.attr("title",b.title),e.soTooltip());var f=SO.Utils.sequence().nextVal(),g=a("<div></div>").addClass("nlui-multisel-close nlui-icon ui-icon-circle-close");g.appendTo(e),g.click(function(){c._removeItem(f,!0)}),g.toggle(this.options.enabled);var h={id:f,$token:e,$close:g,item:b};return this.tokens.push(h),e},_removeItem:function(a,b){var c,d=this,e=-1;if(c=SO.Utils.find(this.tokens,function(b,c){return e=b,c.id===a}),-1!==e){c=d.tokens[e];var f=c.$token;f.hide(300,function(){f.remove(),d.tokens.splice(e,1),b&&d._notifyChange()})}},_addItem:function(a,b){var c=this._newToken(a);c.insertBefore(this.$input),b&&this._notifyChange()},_notifyChange:function(){if(this.options.onValueChanged){var a=this.value();this.options.onValueChanged(a)}},value:function(a){var b=this;return void 0===a?SO.Utils.map(this.tokens,function(a,b){return b.item}):(this.tokens=[],SO.Utils.map(a,function(a,c){b._addItem(c,!1)}),this._notifyChange(),void 0)},setValue:function(a){return this.value(a),null},getValue:function(){return this.value()},setError:function(){SO.log.warn("The multisel widget does not handle setError")}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlAutoComplete",a.NL.nlWidget,{options:{source:null,valueAttribute:"label",itemRenderer:function(a){return a.label},select:function(){return!1}},_create:function(){var b=this.element,c=this,d=null;b.autocomplete({source:NL.DataSource.autoCompleteAdapter(this.options.source,{valueAttribute:c.options.valueAttribute}),close:function(){if(null!==d){var a=d;d=null,c.options.select(a)}},select:function(a,b){var c=b.item,e=c.item;d=e}}),b.data("autocomplete")&&(b.data("autocomplete")._renderItem=function(d,e){d.addClass("nlui-multisel-popup");var f={searchTerm:b.val()},g=c.options.itemRenderer(e.item,f);return g=a("<a></a>").append(g),a("<li></li>").data("item.autocomplete",e).append(g).appendTo(d)})}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Collection",{_create:function(){SO.assert(!this._options.onValidation,"onValidation is deprecated, use onDblClick instead"),SO.assert(!this._options.onInternalChange,"onInternalChange is deprecated, use onSelection instead"),this._options.onInternalChange&&(this._options.onSelection=this._options.onInternalChange),this._controller=this._controller||this._options.controller,this._jpath=this._jpath||this._options.jpath,this._searchPlugin=void 0,this._$header=void 0,this._$topHeader=void 0,this._$bottomHeader=void 0,this._$collapser=null,this._headerCollapsed=!1,this._$title=null,this._datasourceCaps=this._controller?this._controller.getDataSourceCapabilities(this._jpath):{},this._readOnly=this._readOnly||this._options.readOnly||!1},_createHeaderLine:function(){return $("<div></div>").nlLinearLayout({params:{orientation:"horizontal",size:38,spacer:10,gutter:10}}).appendTo(this._$header)},_getBottomHeaderLine:function(){return void 0===this._$bottomHeader&&(this._$bottomHeader=this._createHeaderLine().addClass("nlui-list-header-lineTopSeparator"),"collapsed"===this._options.headCollapse&&this._$bottomHeader.hide()),this._$bottomHeader},_saveListSettingsToLocalStorage:function(a,b){if(this._options.localStorage.settings&&this._options.confId){var c=this.getConf();c.hasOwnProperty("settings")||(c.settings={}),c.settings[a]=b,this.saveConf(c)}},_getListSettingsFromLocalStorage:function(a){if(this._options.localStorage.settings&&this._options.confId){var b=this.getConf();if(b.hasOwnProperty("settings")&&b.settings.hasOwnProperty(a))return b.settings[a]}return void 0},addPlugin:function(a,b){var c,d,e,f,g;if(c=this,this._jpath){switch(g=this._getConfManagerKey().concat([a+"ListPlugin"]),b.name&&(g=g.concat([b.name])),e=SO.Utils.extend({confId:g,controller:this._controller,jpath:this._jpath},b),a){case"search":this._datasourceCaps.searchable===!0&&(e=SO.Utils.extend({realTime:this._datasourceCaps.realTime},e),this._searchPlugin=d=new SO.Plugin.Search(e),f={zone:"tr",size:0,isLong:!1});break;case"FilterPlugin":d=new SO.Plugin.Filter(e);break;case"FilterComboPlugin":case"filterCombo":case"FilterComboPluginNoSaveConf":"FilterComboPluginNoSaveConf"===a&&(e.storeConfig=!1,SO.assert("FilterComboPluginNoSaveConf is deprecated, use filterCombo with storeConfig option as false")),d=new SO.Plugin.FilterCombo(e),f={zone:"br",size:175,isLong:!1};break;case"SortComboPlugin":case"sortCombo":d=new SO.Plugin.SortCombo(e),f={zone:"br",size:175,isLong:!1};break;case"folderNavigatorFilter":case"navigatorFilter":b.source&&(e.controller=b.source.controller,e.jpath=b.source.jpath),e.extraController=this._controller,e.extraJpath=this._jpath,d=new SO.Plugin.FilterNavigator(e),f={zone:"bl",size:0,isLong:!0};break;case"SearchDatePlugin":case"SearchDate":d=new SO.Plugin.SearchDate(e),f={zone:"br",size:150,isLong:!1};break;case"advancedPlugin":d=new SO.Plugin.FilterSchemaAdvanced(e),f={zone:"tr",size:38,isLong:!1}}return d&&(e&&(f=SO.Utils.extend(f,{zone:e.zone,size:e.size,isLong:e.isLong})),this._insertHeaderBlock(d.$node,f)),this}},addHeaderBlock:function(a){var b,c,d;for(d=$("<div></div>"),c=a.contents.length,b=0;c>b;b+=1)d.append(a.contents[b]);return this._insertHeaderBlock(d,{size:void 0===a.size?0:a.size,zone:void 0===a.zone?"tr":a.zone,isLong:void 0===a.isLong?!1:a.isLong}),this},resetSelection:function(){SO.log.warn("resetSelection is deprecated, use setValue(null) instead"),this._visualUnselect(),this._currentSelection=null},getValue:function(){return this._currentSelection},setValue:function(a,b){a instanceof SO.Selection||(a=new SO.Selection({selectionMode:this._options.selectionMode,items:[a]})),this._visualUnselect(),this._currentSelection=a,null!==a&&this._findAndSelect(a,b)},setReadOnly:function(a){return this._readOnly=a,this},isReadOnly:function(){return this._readOnly}}),$.widget("NL.nlCollection",{_create:function(){this._widget=new SO.Widgets.Collection(this.element,this.options)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Plugin=function(a){a=a||{},this.confId=a.confId||null,this.$node=null,this.parent=a.parent||null,this.controller=a.controller||null,this.jpath=a.jpath||null,this._confManager=SO.configManager,this.storeConfig=void 0===a.storeConfig?!0:a.storeConfig,this.theme=a.theme},SO.Plugin.prototype.render=function(a){return a=a||this.parent,this.$node&&a&&this.$node.appendTo(a),this},SO.Plugin.prototype.saveConf=function(a){return this._confManager&&this.confId&&this.storeConfig&&this._confManager.set(this.confId,a),this},SO.Plugin.prototype.getConf=function(){var a;return this._confManager&&this.confId&&this.storeConfig&&(a=this._confManager.get(this.confId,{})),a},SO.Plugin.Filter=function(a){a=a||{},SO.Plugin.call(this,a),this.wildcard=a.wildcard||null,this.controller.addFilter(this.jpath,{value:void 0===a.value?"":a.value,wildcard:this.wildcard})},SO.OO.extend(SO.Plugin.Filter,SO.Plugin),SO.Plugin.Filter.prototype._execute=function(a){return null!==a&&(this.saveConf({wildcard:this.wildcard,value:a}),this.controller.applyFilter(this.jpath,this.wildcard,a,!0)),this},SO.Plugin.Search=function(a){a=a||{},this.realTime=void 0!==a.realTime?a.realTime:!1,SO.Plugin.Filter.call(this,a),this._create()},SO.OO.extend(SO.Plugin.Search,SO.Plugin.Filter),SO.Plugin.Search.prototype._create=function(){var a;return a=this,this.$node=$("<div></div>").soSearchInput({theme:this.theme,onInternalChange:function(b){a._execute(b)}}),this},SO.Plugin.SearchDate=function(a){a=a||{},SO.Plugin.Filter.call(this,a),this.value=a.value||null,this.selector=a.selector||"day",this._create()},SO.OO.extend(SO.Plugin.SearchDate,SO.Plugin.Filter),SO.Plugin.SearchDate.prototype._create=function(){var a,b,c;return a=this,b=this.getConf(),c=b&&b.value?b.value:this.value,this.$node=$("<div></div>").soDateSelector({theme:this.theme,value:c,params:{selector:this.selector},onInternalChange:function(b,c){b&&!c&&a._execute(b)}}),c&&(this.$node.soDateSelector("setValue",c),a._execute(c)),this},SO.Plugin.FilterNavigator=function(a){a=a||{},SO.Plugin.Filter.call(this,a),this.emptyText=a.emptyText||xtk_core.noData(),this.items=a.items||[],this.extraController=a.extraController||null,this.extraJpath=a.extraJpath||null,this.extraController&&this.extraJpath&&this.extraController.addFilter(this.extraJpath,{value:"",wildcard:this.wildcard}),this._create()},SO.OO.extend(SO.Plugin.FilterNavigator,SO.Plugin.Filter),SO.Plugin.FilterNavigator.prototype._create=function(){var a,b;return a=this,b=this.getConf(),this.$node=$("<div></div>").nlNavigator({theme:this.theme,emptyText:this.emptyText,items:this.items,controller:this.controller,jpath:this.jpath,onInternalChange:function(b){a._execute(b)}}),b&&b.value&&this.$node.nlNavigator("setValue",b.value),this},SO.Plugin.FilterNavigator.prototype._execute=function(a){var b,c,d;if(this.saveConf({wildcard:this.wildcard,value:a}),a&&a.fullLabel)c=a.fullLabel;else if(a&&a.list)for(d=a.list.length,c="",b=0;d>b;b+=1)c+="/"+a.list[b].label;else c="";return this.extraController.applyFilter(this.extraJpath,this.wildcard,c,!0),this},SO.Plugin.FilterCombo=function(a){a=a||{},SO.Plugin.Filter.call(this,a),this.values=a.values||[],this.selected=a.selected||"",this._create()},SO.OO.extend(SO.Plugin.FilterCombo,SO.Plugin.Filter),SO.Plugin.FilterCombo.prototype._create=function(){var a,b;a=this,b=this.getConf();for(var c=[],d=new SO.Structure.Set(function(a,b){return a.value===b.value}),e=0;this.values.length>e;e++){var f=this.values[e];c.push({value:f.value,label:f.label}),d.add(f)}var g=function(b){var c=d.find({value:b});null!==c&&a._execute(c)};return this.$node=$("<div></div>").soDropdown({theme:this.theme,params:{items:c},value:this.selected||this.values[0].value,onInternalChange:g}),b&&b.value&&this.$node.soDropdown("setValue",b.value),g(this.$node.soDropdown("getValue")),this},SO.Plugin.FilterCombo.prototype._execute=function(a){return null!==a&&(this.saveConf({wildcard:this.wildcard,value:a.value}),this.controller.applyFilter(this.jpath,this.wildcard,a.expr,!0)),this},SO.Plugin.FilterSchemaAdvanced=function(a){a=a||{},SO.Plugin.call(this,a),this.values=a.values||[],this.wildcard="advancedField",this._$treeList=$(a.treeList),this.selected=a.selected||"",this._create()},SO.OO.extend(SO.Plugin.FilterSchemaAdvanced,SO.Plugin.Filter),SO.Plugin.FilterSchemaAdvanced.prototype._create=function(){var a,b,c;return a=this,this.selected===!0?(b=xtk_core.treeList_hide_advanced_fields_help,c=!0):(b=xtk_core.treeList_display_advanced_fields_help,c=!1),this.$node=$("<div></div>").soButton({help:b,icon:"nlui-icon-schema-advanced",isPushed:c,onClick:function(b){b.soButton("changeOptions",{isPushed:!a.selected,help:a.selected?xtk_core.treeList_display_advanced_fields_help:xtk_core.treeList_hide_advanced_fields_help}),a._execute({value:!a.selected})}}),this},SO.Plugin.FilterSchemaAdvanced.prototype._execute=function(a){return null!==a&&(this.saveConf({wildcard:this.wildcard,value:a.value}),this._$treeList.soTreeList("setRenderingMethod",a.value?"schemaAdvancedTreeRender":"defaultTreeRender"),this.controller.applyFilter(this.jpath,this.wildcard,a.value,!0),this.selected=a.value),this},SO.Plugin.Sort=function(a){a=a||{},SO.Plugin.call(this,a),this.id=this.jpath+"_"+SO.Utils.sequence().nextVal(),this.controller.addSort(this.jpath,{id:this.id})},SO.OO.extend(SO.Plugin.Sort,SO.Plugin),SO.Plugin.Sort.prototype._execute=function(a,b,c){return this.controller&&this.controller.applySort(this.jpath,this.id,{expr:a,desc:b,name:c},!0),this.saveConf({expr:this.wildcard,sortDesc:b,value:c}),this},SO.Plugin.SortCombo=function(a){a=a||{},SO.Plugin.Sort.call(this,a),this.values=a.values||[],this.selected=a.selected||"",this._create()},SO.OO.extend(SO.Plugin.SortCombo,SO.Plugin.Sort),SO.Plugin.SortCombo.prototype._create=function(){for(var a=this,b=this.getConf(),c=[],d=new SO.Structure.Set(function(a,b){return a.value===b.value}),e=0;this.values.length>e;e++){var f=this.values[e];c.push({value:f.value,label:f.label}),d.add(f)}var g;g=b&&b.value?b.value:this.selected?this.selected:this.values[0].value;var h=function(b){var c=d.find({value:b});null!==c&&a._execute(c.expr,c.sortDesc,c.value)};return this.$node=$("<div></div>").soDropdown({theme:this.theme,params:{items:c},value:g,onInternalChange:function(a){h(a)}}),h(g),this};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("List","Collection",{DEFAULT_OPTIONS:{controller:null,jpath:null,data:null,pagination:{perPage:30},localStorage:{selection:!1,settings:!0},autoLoad:!0,selectable:!1,selectionMode:"none",selection:null,onSelection:function(){},onClick:void 0,onZoom:void 0,onDblClick:function(){},actions:{search:!1,creation:!1,selection:!1,global:!1},actionsLabels:!1,refreshButtonContainer:null,renderingMethods:{},defaultRendering:null,emptyText:xtk_core.noData(),additionalItems:[],fitToParentHeight:!1,onDataLoadCallback:void 0,displayColumnsHeader:!0,refreshOnAdd:!1,metaDataUrl:null},_create:function(){var a,b,c;return a=this,SO.Widgets.List.superClass._create.apply(this,arguments),this._data=this._options.data,SO.assert(!this._controller&&!this._jpath||!this._data,"You must not provide static data and use a controller"),SO.assert(!!this._options.pagination!=!!this._options.postFilter,"Pagination should not be used with postFilter"),this._data&&(this._jpath="static",this._controller=new SO.MVC.Controller({model:{"static":this._data},metamodel:{"static":{type:"list"}},statemodel:{}})),SO.assert(!this._options.selectable||this._options.selectable&&"none"!==this._options.selectionMode,'The option selectable is true but the selectionMode is "none"'),"none"===this._options.selectionMode||this._options.selectable||(this._options.selectable=!0,SO.assert("none"!==this._options.selectionMode&&!this._options.selectable,"You must set the selectable option to true in complement with selectionMode")),this._controller.registerJpathObserver(this._options.jpath,this),this._creationCommandsList=[],this._creationCommandsConfig={},this._creationActionBar=null,this._selectionCommandsList=[],this._selectionCommandsConfig={},this._selectionActionBar=null,this._$buttonLoadMore=null,this._$buttonLoadAll=null,this._$buttonCount=null,this._$buttonSwitchLayout=null,this._$buttonCancelLoading=null,this._$buttonHeaderConf=null,this._needPagination=!0,this._needCount=!0,this._internalItems=[],this._items=[],this._extraItems=[],this._removedItems=[],this._options.layoutManager.registerWidget(this),this._currentItems=[],this._currentSelection=this._options.selection,this._$selectedItems=[],this._multiSelecting=!1,this._selectionMode=this._options.selectionMode,this._selectable=this._options.selectable,this._renderingMethod=null,this._isLoading=!1,this._selectionTogglerEnabled=!1,this._selectAllCheckbox=null,this._emptyClassName="nlui-list-empty",this._metaDataService=this._options.metaDataService||new NL.MetaDataService(void 0,{dataSourceType:"metadata"}),this._columnsIndexCompare=function(a,b){return a.name===b.name},SO.assert(0===function(){var b=0;return SO.Utils.each(a._options.renderingMethods,function(a,c){"grid"!==c.family&&"card"!==c.family&&"block"!==c.family&&"line"!==c.family&&(SO.log.warn("Missing or invalid family attribute for rendering method '"+a+"'"),b+=1)}),b}(),"Some rendering methods have no family"),this._options.rendering?b=this._options.rendering:(b=this._options.defaultRendering,c=this._getListSettingsFromLocalStorage("listLayout"),c&&(b=c)),b||(SO.log.warn("No default rendering has been provided"),b=Object.keys(this._options.renderingMethods),b=b[0]),this._updateRenderingObject(b),this._options.actions&&this._buildActions(),this._options.refreshButtonContainer&&this._options.refreshButtonContainer.append($("<div></div>").soSimpleButton({mode:"default",icon:"nlui-icon-list-refresh",onClick:function(){a._fetchData(!0)},help:xtk_core.list_refresh_button_help,helpGravity:"autoNS"})),this.$el.addClass("nlui-list"),this._options.fitToParentHeight&&this.$el.addClass("nlui-list-fittoparent"),this._options.autoLoad!==!1?this._fetchData(!0):this._needPagination&&this._createMarkup(),this._initEvents(),this},rebuildLayout:function(){return"card"===this._renderingMethod.family&&this.refreshCardsDisplay(!1),"grid"===this._renderingMethod.family&&this._checkColumnsOverflow(),this},_checkColumnsOverflow:function(){var a,b,c,d;if(this._headerColumns)for(c=this._headerColumns.length,a=0;c>a;a++)d=this._headerColumns[a],b=d.$node.children(".nlui-list-item-container"),b.length>0&&(d.$node[0].scrollWidth<b[0].scrollWidth?d.$node.soTooltip("enable"):d.$node.soTooltip("disable"));return this},selectable:function(a){return a?this._$listBody&&this._$listBody.addClass("nlui-list-selectable"):this._$listBody&&this._$listBody.removeClass("nlui-list-selectable"),this._selectable=a,this},_activeEditMode:function(a,b){var c,d,e,f;return e=b.data(),c=this,a?(this._checkCurrentEditing(),d=ViewControllerManager.newViewController(this._controller,e.colPath,{mandatory:this._controller.isMandatory(e.colPath),hidden:this._controller.isHidden(e.colPath),disabled:this._controller.isDisabled(e.colPath),strict:this._controller.isStrict(e.colPath),locale:this._options.locale},{editType:e.options.editType?e.options.editType:null}),this._chekFn=function(){c._checkCurrentEditing()},this._controller.registerOnValueChanged(this._chekFn),d.initialize(),b.empty().addClass("nlui-list-column-editing").append(d.$div),f=d.$div.find("input, textarea")[0],f.focus(),this._currentEdit=b):(b.off("mousedown.checktarget").removeClass("nlui-list-column-editing").empty().append(this._formatCellValue(e.colPath,e.colType,e.options)),this._controller.unregisterOnValueChanged(this._chekFn),c._currentEdit=null),this},_checkCurrentEditing:function(){return this._currentEdit&&this._activeEditMode(!1,this._currentEdit),this},_selectionEventCallback:function(a,b){this.stopPropagation(a);var c,d,e,f=b.data("row");c=this,"multi"===this._selectionMode?(this._multiSelecting||a.ctrlKey)&&null!==this._currentSelection?(d=this._currentSelection.getItems(),e=SO.Utils.indexOf(d,f,function(a,b){return c._controller.areKeysEqual(c._jpath,a,b)}),-1===e?(this._visualSelect(b),d.push(f),c._selectAllCheckbox&&d.length===this._currentItems.length&&c._selectAllCheckbox.setValue(!0)):(this._visualUnselect(b),d.splice(e,1),c._selectAllCheckbox&&c._selectAllCheckbox.setValue(!1)),this._currentSelection=new SO.Selection({selectionMode:this._selectionMode,items:d})):(this._visualUnselect(),null!==this._currentSelection&&-1!==SO.Utils.indexOf(this._currentSelection.getItems(),f)?this._currentSelection=null:(this._currentSelection=new SO.Selection({selectionMode:this._selectionMode,items:[f]}),this._visualSelect(b))):(this._visualUnselect(),null!==this._currentSelection&&-1!==SO.Utils.indexOf(this._currentSelection.getItems(),f,SO.Utils.isEqual)?this._currentSelection=null:(this._currentSelection=new SO.Selection({selectionMode:this._selectionMode,items:[f]}),this._visualSelect(b))),this._updateActionStates()},_initEvents:function(){var a=this;return this.$el.on("click",".nlui-list-body:not(.nlui-list-isloading) .nlui-list-pager",function(){a._fetchData(!1)}).on("click",".nlui-list-selectable .nlui-list-item",function(b){var c,d,e;c=$(this),d=a._options.hasOwnProperty("selectAndNavigate"),"card"===a._itemMode?a._selectionTogglerEnabled&&(d=!1):d=c.find("a").length>0,a._isLoading||("multi"!==a._selectionMode&&void 0===a._options.onClick||"card"===a._renderingMethod.family&&a._multiSelecting!==!0?(b.preventDefault(),e=a._multiSelecting,a._multiSelecting=!0,a._internalOnSelection(c,b),a._multiSelecting=e):void 0!==a._options.onClick?a._options.onClick(c.data("row")):(d||b.preventDefault(),e=a._multiSelecting,a._multiSelecting=!0,a._internalOnSelection(c,b),a._multiSelecting=e))}).on("click",".nlui-list-item-column-editable",function(b){var c=$(this);if(!a._isLoading)return c.hasClass("nlui-list-column-editing")||a._activeEditMode(!0,c),b.stopPropagation(),!1}).on("click",".nlui-list-column-sortable",function(){var b,c,d,e,f,g,h,i,j;if(!a._isLoading){if(c=$(this),e=!0,d=a._controller.getCurrentSorts(a._jpath),f=d.sorts.length,h=c.data("name"),i=c.data("sortId"),f>0)for(b=0;f>b;b+=1)g=d.sorts[b],i===g.id&&(e=!g.desc);i||(i=SO.Utils.sequence().nextVal()+h,a._controller.resetSort(a._jpath),a._controller.addSort(a._jpath,{expr:h,desc:e,id:i})),j=a._getListSettingsFromLocalStorage("columnsPatch"),j||(j={}),j.sorts=[{path:h,order:e?"desc":"asc"}],a._saveListSettingsToLocalStorage("columnsPatch",j),a._controller.applySort(a._jpath,i,{expr:h,desc:e},!0)}}),this._$buttonSwitchLayout&&this._$buttonSwitchLayout.on("mouseenter",function(){var a,b=$(this).data("icon"),c=$(this).data("arrow");b&&b.setState("active"),c&&(a=SO.IMG.genIcon("list-switcher-arrow-active",12),c.replaceWith(a),$(this).data("arrow",a))}).on("mouseleave",function(){var a,b=$(this).data("icon"),c=$(this).data("arrow");b&&b.setState("default"),c&&(a=SO.IMG.genIcon("list-switcher-arrow",12),c.replaceWith(a),$(this).data("arrow",a))}),this},_internalOnSelection:function(a,b){var c,d;c=a.data("row"),this._isEmpty||this.isReadOnly()||(this._selectionEventCallback(b,a),d=this._findPosition(c),this._options.onSelection(this._currentSelection,d)),b&&b.stopPropagation()},_selectAll:function(a){var b,c,d,e,f=[];d=-1===["block","card"].indexOf(this._itemMode)?this._$listBody.children("tbody").children():this._$listBody.find(".nlui-list-item");for(var b=0;d.length>b;b++)e=$(d[b]),c=e.data("row"),c&&(a?(f.push(c),this._visualSelect(e)):this._visualUnselect(e));return this._currentSelection=new SO.Selection({selectionMode:this._selectionMode,items:f}),this._updateActionStates(),this._options.onSelection(this._currentSelection),this},_updateRenderingObject:function(a){var b,c,d,e,f,g;if(b=this._options.renderingMethods[a],c=b?b.family:null,b){if(b.columns)for(d=[],e=b.columns.length,f=0;e>f;f++)g=b.columns[f],g.hasOwnProperty("visible")||(g.visible=!0),g.visible===!1&&d.push(g.name)}else SO.log.warn("Unable to find the rendering method to use ("+a+"). Will default to the first one."),SO.Utils.each(this._options.renderingMethods,function(c,d){return b=d,a=c,!1});if(this._renderingMethod=b,this._renderingMethod.key=a,this._saveListSettingsToLocalStorage("listLayout",a),this._itemMode=this._renderingMethod.family.toLowerCase(),this._selectable=this._options.selectable,this._selectionMode=this._options.selectionMode,d)for(;d.length>0;)this.hideColumn(d.shift());return this},_switchLayoutTo:function(){var a,b,c,d;for(d=this,b=[],this._$switcherIcon&&(c=SO.IMG.genIcon(this._renderingMethod.icon,24),this._$switcherIcon.empty().append(c.el),this._$buttonSwitchLayout.data("icon",c)),a=0;this._currentItems.length>a;a++)b.push($.extend(!0,{},this._currentItems[a].source));return this._$buttonLoadMore&&(this._$buttonLoadMore.remove(),this._buildLoadMoreAction()),this._refreshWithData(b,!0),this},setReadOnly:function(a){var b=this.isReadOnly()!==a,c=[];if(this._super(a),a?(this._creationActionBar&&this._creationActionBar.$el.detach(),this._selectionActionBar&&this._selectionActionBar.$el.detach()):(this._creationActionBar&&this._options.actions.creation.placeholder.append(this._creationActionBar.$el),this._selectionActionBar&&this._options.actions.selection.placeholder.append(this._selectionActionBar.$el)),b){for(var d=0;this._currentItems.length>d;d++)c.push($.extend(!0,{},this._currentItems[d].source));this._refreshWithData(c,!0)}return this},_buildActions:function(){var a=this;if(this._datasourceCaps.searchable&&this._options.actions&&this._options.actions.search){var b=this._options.actions.search,c=b.placeholder;c&&(this._controller.addFilter(this._jpath,{wildcard:b.wildcard}),this._searchActionInput=new SO.Widgets.SearchInput($("<div></div>"),{onInternalChange:function(c){a._controller.applyFilter(a._jpath,b.wildcard,c,!0)}}),c.append(this._searchActionInput.$el))}if(this._options.actions){if(this._options.actions.creation){var d=this._options.actions.creation,e=d.placeholder;"undefined"==typeof d.add||SO.isBoolean(d.add)&&d.add===!0?this._buildAddAction():d.add=!1,e&&this._creationCommandsList.length>0&&(this._creationActionBar=new SO.Widgets.cmdBar($("<div></div>"),{iconSize:24,commands:this._creationCommandsList,commandConfigs:this._creationCommandsConfig}),this.isReadOnly()||e.append(this._creationActionBar.$el))}if(this._options.actions.selection){var f=this._options.actions.selection,g=f.placeholder;SO.isBoolean(f.toggle)&&f.toggle===!0&&this._getActions("selection",["toggle"]).length>0?this._buildToggleSelectionAction():f.toggle=!1,"undefined"==typeof f.sort||SO.isBoolean(f.sort)&&f.sort===!0?(this._buildMoveUpAction(),this._buildMoveDownAction()):f.sort=!1,"undefined"==typeof f.remove||SO.isBoolean(f.remove)&&f.remove===!0?this._buildRemoveAction():f.remove=!1,"undefined"==typeof f.duplicate||SO.isBoolean(f.duplicate)&&f.duplicate===!0?this._buildDuplicateAction():f.duplicate=!1,this._options.onZoom?this._buildZoomAction():f.zoom=!1,g&&this._selectionCommandsList.length>0&&(this._selectionActionBar=new SO.Widgets.cmdBar($("<div></div>"),{iconSize:24,commands:this._selectionCommandsList,commandConfigs:this._selectionCommandsConfig}),this.isReadOnly()||g.append(this._selectionActionBar.$el))}if(this._options.actions.global){var h=this._options.actions.global,i=h.placeholder;this._buildCancelLoadingAction(i),"undefined"==typeof h.count||SO.isBoolean(h.count)&&h.count===!0?this._buildCountAction(i):h.count=!1;var j=this._options.metaDataUrl;null!==j?(this._$buttonHeaderConf=new SO.Widgets.SimpleButton($('<div class="nlui-list-actionbt"></div>'),{mode:"transparent",iconSize:24,icon:"coral-columnSettings",tooltip:xtk_core.grid_listConfig(),onClick:function(){a._createListHeaderEditor(j)}}),i.append(this._$buttonHeaderConf.$el)):(this._$buttonHeaderConf=null,h.headerConf=!1),SO.isBoolean(h.switchLayout)&&h.switchLayout===!0?this._buildSwitchLayoutAction(i):h.switchLayout=!1}}return this._updateActionStates(),this},_createListHeaderEditor:function(a){var b,c=$.extend(!0,{},this._renderingMethod);b=this,c.sorts=this._controller.getCurrentSorts(this._jpath).sorts,new SO.Widgets.ListHeadEditor({metaDataService:b._metaDataService,resourcePath:a,renderingObject:c,currentPatch:b._getListSettingsFromLocalStorage("columnsPatch"),onSave:function(a){var c,d=[];for(b.setRenderingPatch(a),c=0;b._currentItems.length>c;c++)d.push($.extend(!0,{},b._currentItems[c].source));b._refreshWithData(d,!0)}})},_buildAddAction:function(){var a=this;return this._creationCommandsList.push("add"),this._creationCommandsConfig.add={mode:"transparent",icon:"coral-add",help:xtk_core.grid_addRow(),label:this._options.actionsLabels?xtk_core.grid_addRow():null,tooltip:xtk_core.grid_addRow(),iconSize:24,command:function(){a._controller.addCollectionItem(a._jpath,void 0,a._currentItems.length,!0)}},this},_buildMoveUpAction:function(){var a=this;return this._selectionCommandsList.push("sortUp"),this._selectionCommandsConfig.sortUp={mode:"transparent",iconSize:24,help:xtk_core.grid_moveRowUp(),label:this._options.actionsLabels?xtk_core.grid_moveRowUp():null,icon:"list-sort-up",command:function(){var b,c=a._findSelectionPositions(a._currentSelection);if(SO.isArray(c)&&c.length>0)for(;c.length>0;)b=c.shift(),a._controller.moveCollectionItem(a._jpath,b,b-1,!0)}},this},_buildMoveDownAction:function(){var a=this;return this._selectionCommandsList.push("sortDown"),this._selectionCommandsConfig.sortDown={mode:"transparent",help:xtk_core.grid_moveRowDown(),label:this._options.actionsLabels?xtk_core.grid_moveRowDown():null,iconSize:24,icon:"list-sort-down",command:function(){var b,c=a._findSelectionPositions(a._currentSelection);if(SO.isArray(c)&&c.length>0)for(;c.length>0;)b=c.pop(),a._controller.moveCollectionItem(a._jpath,b,b+1,!0)}},this},_buildRemoveAction:function(){var a=this;return this._selectionCommandsList.push("delete"),this._selectionCommandsConfig.delete={mode:"transparent",icon:"coral-delete",iconSize:24,help:xtk_core.grid_removeRow(),label:this._options.actionsLabels?xtk_core.grid_removeRow():null,command:function(){var b,c=a._findSelectionPositions(a._currentSelection);SO.isArray(c)&&c.length>0&&$("<div></div>").soMessageBox({title:xtk_core.listDeleteConfirmTitle(),message:xtk_core.listDeleteConfirm(),type:"confirm",onConfirm:function(){for(a._removedItems=c.map(function(b){return{$el:a._currentItems[b].$container,position:b}});c.length>0;)b=c.pop(),a._controller.removeCollectionItem(a._jpath,b,!0,function(a,b,c){c(!1)})}})}},this},_buildDuplicateAction:function(){var a=this;return this._selectionCommandsList.push("duplicate"),this._selectionCommandsConfig.duplicate={mode:"transparent",iconSize:24,icon:"coral-copy",help:xtk_core.grid_duplicateRow(),label:this._options.actionsLabels?xtk_core.grid_duplicateRow():null,command:function(){var b,c=a._findSelectionPositions(a._currentSelection);SO.isArray(c)&&c.length>0&&$("<div></div>").soMessageBox({title:xtk_core.listDeleteConfirmTitle(),message:xtk_core.listDuplicateConfirm(),type:"confirm",onConfirm:function(){for(;c.length>0;)b=c.shift(),a._controller.duplicateCollectionItem(a._jpath,b,b+1,!0)}})}},this},_buildZoomAction:function(){var a=this;return this._selectionCommandsList.push("zoom"),this._selectionCommandsConfig.zoom={mode:"transparent",iconSize:24,icon:"coral-preview",help:xtk_core.list_zoomRow(),label:this._options.actionsLabels?xtk_core.list_zoomRow():null,command:function(){var b,c=a._findSelectionPositions(a._currentSelection);1===c.length&&(b=c[0],a._options.onZoom(a._currentSelection,b))}},this},_buildLoadMoreAction:function(){var a,b,c,d,e;return"timeline"===this._itemMode?(this._$buttonLoadMore=$('<tfoot class="nlui-list-load-more nlui-list-load-more-tllist"></tfoot>'),b=$('<tr class="nlui-list-item nlui-list-pager"></tr>').appendTo(this._$buttonLoadMore),this._$pagerColumn=$('<td class="nlui-tllist-item-cell"></td>').appendTo(b),c=$('<div class="nlui-tllist-item-container nlui-tllist-cell-circle"></div>').appendTo(this._$pagerColumn),d=SO.IMG.genIcon("timelinelist-see-more",18).addClass("nlui-list-load-more-tllist-icon").appendTo(c),e=$('<img class="nlui-list-loading" src="/xtk/img/loading.gif"/>').appendTo(c),this._$buttonLoadMore.addClass("nlui-list-pager-"+this._itemMode)):("card"!==this._itemMode?(a=this._renderingMethod.columns?this._renderingMethod.columns.length:1,this._selectCheckboxDisplayed()&&a++,this._$buttonLoadMore=$('<tfoot class="nlui-list-load-more"></tfoot>'),b=$('<tr class="nlui-list-pager"></tr>').appendTo(this._$buttonLoadMore),this._$pagerColumn=$('<td class="nlui-list-pager-column" colspan="'+a+'"></td>').appendTo(b),c=$('<div class="nlui-list-pager-container"></div>').text(xtk_core.navigation_scrollingNext()).appendTo(this._$pagerColumn)):(this._$buttonLoadMore=$('<div class="nlui-list-pager"></div>'),c=$('<div class="nlui-list-pager-container"></div>').text(xtk_core.navigation_scrollingNext()),this._$buttonLoadMore.append(c)),this._removePagination()),this},_buildCancelLoadingAction:function(a){var b=this,c=$('<div class="nlui-list-loading-indicator clui-wait-indicator"></div>'),d=$('<div class="nlui-list-loading-label"></div>').text(xtk_core.dialog_loading()),e=$("<div class='nlui-list-actionbt'></div>").soSimpleButton({mode:"transparent",tooltip:xtk_core.dialog_cancel(),iconSize:24,icon:"stop",onClick:function(){b._cancel(),b._setLoading(!1)}});return this._$buttonCancelLoading=$('<div class="nlui-list-loading"></div>'),this._$buttonCancelLoading.append(c).append(d).append(e),this._$buttonCancelLoading.addClass("nlui-list-loading-hidden"),a&&a.append(this._$buttonCancelLoading),this},_buildLoadAllAction:function(a){return this._$buttonLoadAll=$("<div class='nlui-list-actionbt'></div>").soSimpleButton({mode:"transparent",iconSize:24,icon:"loadAll",onClick:function(){}}),a&&a.append(this._$buttonLoadAll),this},_buildCountAction:function(a){var b=this;return this._$buttonCount=$('<div class="nlui-list-count-area nlui-list-actionbt"></div>').soSimpleButton({mode:"transparent",onClick:function(){b._countData()}}),a&&a.append(this._$buttonCount),this},_buildSwitchLayoutAction:function(a){var b,c,d,e=this,f=this._renderingMethod.key,g={},h=$("<ol></ol>");this._$buttonSwitchLayout=$('<div class="nlui-list-switcher nlui-list-actionbt"></div>'),this._$switcherIcon=$("<div></div>"),SO.Utils.each(this._options.renderingMethods,function(a,c){var d=$("<li class='nlui-popover-menu-item'></li>");g[a]=new SO.Widgets.SimpleButton(d,{mode:"quiet",icon:c.icon,iconSize:24,label:c.label,isPushed:a===f,onClick:function(){e._updateRenderingObject(a),e._switchLayoutTo(a),SO.Utils.each(g,function(a,b){e._renderingMethod.key===a?b.$el.addClass("nlui-button-popover-selected"):b.$el.removeClass("nlui-button-popover-selected")}),f=a,b.hide()}}),e._renderingMethod.key===a&&d.addClass("nlui-button-popover-selected"),h.append(d)}),h.off("click").on("click",".nlui-popover-menu-item",function(a){a.target===this&&(a.stopPropagation(),$("button",this).click())}),this._renderingMethod.icon&&(c=SO.IMG.genIcon(this._renderingMethod.icon,24),this._$switcherIcon.empty().append(c.el),this._$buttonSwitchLayout.append(this._$switcherIcon).data("icon",c)),d=SO.IMG.genIcon("list-switcher-arrow",12),this._$buttonSwitchLayout.append(d.addClass("nlui-list-switcher-arrow")).data("arrow",d),b=new SO.Widgets.popover(this._$buttonSwitchLayout,{params:{classNames:"nlui-popover-menu nlui-list-switcher-popover",gravity:"s",displayOn:"click",content:h}});var i=new SO.Widgets.Tooltip(this._$buttonSwitchLayout,{gravity:"n"});return i.setTitle(xtk_core.grid_listDisplay()),this._$buttonSwitchLayout.on("click",function(){i.hide()}),a&&a.append(this._$buttonSwitchLayout),this},_buildToggleSelectionAction:function(){var a=this,b=this._selectable,c=b?xtk_core.list_disable_selection():xtk_core.list_enable_selection(),d="coral-checkCircle",e="transparent";return this._selectionCommandsList.push("toggle"),this._selectionCommandsConfig.toggle={mode:e,iconSize:24,icon:d,help:c,label:this._options.actionsLabels?c:null,command:function(b,c){var e;e=c&&c.hasOwnProperty("active")?c.active:a._selectable?!1:!0;var f=e?"coral-closeCircle":d,g=e?xtk_core.list_disable_selection():xtk_core.list_enable_selection();a.selectable(e),a.setMultiSelecting(!1),a._selectionTogglerEnabled=e,"multi"===a._selectionMode&&a.setMultiSelecting(!0),e||a._selectAll(!1),a._selectionActionBar.setCommandAttribute("toggle","icon",f),a._selectionActionBar.setCommandAttribute("toggle","help",g),a._updateActionStates()}},this},_createMarkup:function(){var a;switch(this._renderingMethod.family.toLowerCase()){case"card":this._itemMode="card",this._$itemsBody=$("<div></div>"),this._$listBody=$("<div></div>").append(this._$itemsBody),a="nlui-list-family-card";break;case"block":this._itemMode="block",this._$itemsBody=$("<div></div>"),this._$listBody=$("<div></div>").append(this._$itemsBody),a="nlui-list-family-block";break;case"timeline":this._itemMode="timeline",this._$itemsBody=$("<tbody></tbody>"),this._$listBody=$("<table></table>").append(this._$itemsBody),this._$listBody.append(this._$buttonLoadMore),a="nlui-list-family-timeline";break;default:this._itemMode="line",this._$listBody=$("<table></table>"),"grid"===this._renderingMethod.family&&this._options.displayColumnsHeader&&this._addListHead(),this._$itemsBody=$("<tbody></tbody>"),this._$listBody.append(this._$itemsBody),a="nlui-list-family-line",this._renderingMethod.columns?this.$el.addClass("nlui-list-multicolumns"):this.$el.removeClass("nlui-list-multicolumns")}return this.$el.append(this._$listBody.addClass("nlui-list-body")),this._listModeClass!==a&&this.$el.addClass(a).removeClass(this._listModeClass),this._listModeClass=a,this._needPagination&&this._addPagination(),this.selectable(this._selectable),"grid"===this._renderingMethod.family&&this._checkColumnsOverflow(),this},_addListHead:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(i=this._renderingMethod.columns.length,o=this,q=this._getActions("selection",["toggle"]).length>0,i>0){if(this._headerColumns=[],b=$("<tr>"),m={},this._$tableHeader=$('<thead class="nlui-list-head"></thead>').append(b),this._$listBody.append(this._$tableHeader),this._selectable&&i>1&&q&&(h=$('<th class="nlui-list-item-column nlui-list-column-0 nlui-list-column-align-center nlui-list-selection-checkbox-container"></th>'),h.data({name:""}),b.append(h),"multi"===this._selectionMode&&(o._selectAllCheckbox=n=new SO.Widgets.CheckBoxInput({value:!1,readOnly:this.isReadOnly(),onInternalChange:function(a){n.setValue(a),o._selectAll(a)}}),h.append(n.$el),p=$('<div class="nlui-list-item-column-separator"></div>').appendTo(h)),this._headerColumns.push({$node:h,label:g})),j=this._controller.getCurrentSorts(this._jpath),k=j.sorts.length,k>0)for(a=0;k>a;a+=1)l=j.sorts[a],l.id=SO.Utils.sequence().nextVal()+l.expr,l.expr&&(m[l.expr]={id:l.id,expr:l.expr,desc:l.desc});for(a=0;i>a;a++)c=this._renderingMethod.columns[a],g=c.label||"",d=this._renderingMethod.columns&&c?c:{},r=this._jpath+"["+a+"]",SO.assert(d.name,"Missing name for column "+r),d.name&&(s=r+"/"+d.name,this._controller.existsInMetaModel(s)&&(t=this._controller.getType(s))),e="long"!==t&&"double"!==t&&"number"!==t||d.align?d.align?d.align:"left":"right",f=$('<div class="nlui-list-item-container">'+g+"</div>").append(SO.IMG.genIcon("list-switcher-arrow",18).addClass("nlui-list-sort-icon")),h=$('<th class="nlui-list-item-column nlui-list-column-'+a+" nlui-list-column-align-"+e+'"></th>').append(f),m[c.name]&&(this._updateColumnSort(h,m[c.name].desc),h.data("sortId",m[c.name].id)),this._datasourceCaps.sortable&&h.addClass("nlui-list-column-sortable"),h.data({name:c.name}).append(f).soTooltip({title:g}),b.append(h),d.width&&h.css("width",d.width),d.minWidth&&h.css("min-width",d.minWidth),this._headerColumns.push({$node:h,label:g})}return this},_updateColumnSort:function(a,b){b===!0?a.children("div.nlui-list-item-container").children(".nlui-list-sort-icon").addClass("nlui-list-column-sort-desc"):a.children("div.nlui-list-item-container").children(".nlui-list-sort-icon").addClass("nlui-list-column-sort-asc")},_addPagination:function(){return this._needPagination&&!this._$buttonLoadMore&&this._buildLoadMoreAction(),this._$buttonLoadMore&&(this.$el.addClass("nlui-list-haspager"),this._isLoading||this._$buttonLoadMore.removeClass("nlui-list-load-more-hidden"),this._$listBody.append(this._$buttonLoadMore.addClass("nlui-list-pager-"+this._renderingMethod.family))),this},_removePagination:function(){return this._$buttonLoadMore&&(this.$el.removeClass("nlui-list-haspager"),this._$buttonLoadMore.addClass("nlui-list-load-more-hidden").detach()),this},_addCount:function(){return this._$buttonCount&&this._$buttonCount.removeClass("nlui-list-count-area-hidden"),this},_removeCount:function(){return this._$buttonCount&&this._$buttonCount.addClass("nlui-list-count-area-hidden"),this},_updateActionStates:function(){if(this._options.actions){var a=this._options.actions,b=this._findSelectionPositions(this._currentSelection),c=this._isLoading,d=this._selectable,e=this._selectionMode,f=this._selectionTogglerEnabled;if(a.creation&&a.creation.add){var g=c||b.length>0;this._creationActionBar.setCommandAttribute("add","disabled",g)}if(a.selection&&a.selection.toggle){var h="card"!==this._renderingMethod.family||0===this._currentItems.length;this._selectionActionBar.setCommandAttribute("toggle","hidden",h),!h&&f&&(this.selectable(!0),this._findAndSelect(this._currentSelection))}if(a.selection&&a.selection.remove){var i=c||!d||0===b.length;this._selectionActionBar.setCommandAttribute("delete","hidden",i)}if(a.selection&&a.selection.sort){var j=b[0],k=b[b.length-1],l=c||!d||"none"===e||0===b.length||0===j,m=c||!d||"none"===e||0===b.length||k===this._currentItems.length-1;this._selectionActionBar.setCommandAttribute("sortUp","hidden",l),this._selectionActionBar.setCommandAttribute("sortDown","hidden",m)}if(a.selection&&(a.selection.duplicate||a.selection.zoom)){var n=c||!d||"none"===e||1!==b.length;a.selection.duplicate&&this._selectionActionBar.setCommandAttribute("duplicate","hidden",n),a.selection.zoom&&this._selectionActionBar.setCommandAttribute("zoom","hidden",n)}null!==this._$buttonHeaderConf&&("grid"!==this._renderingMethod.family?this._$buttonHeaderConf.$el.hide():this._$buttonHeaderConf.$el.show())}return this},_fetchData:function(a){var b,c,d,e,f,g;return b=this._options.pagination?this._options.pagination.perPage:0,this._currentJob&&this._cancel(),a?(c=0,this._needPagination=!0,this._internalItems=[],this._count=null,this._needCount=!0):c=this._internalItems.length,this._startLine=c,d=this,e=this._jpath,this._$errorArea&&this._$errorArea.remove(),this._setLoading(!0),g=b>0?b+1:0,this._askedLineCount=g,f={onSuccess:function(b){var e,f,h,i,j;if(d._needPagination=d._controller.hasNext(d._jpath,c,g),d._needPagination&&b.pop(),d._internalItems=d._internalItems.concat(b),d._options.postFilter)for(h=b,i=d._controller.getCurrentFilters(d._jpath),b=[],e=0;h.length>e;e+=1)f=h[e],d._options.postFilter(f,i)&&b.push(f);d._options.postSort&&(j=d._controller.getCurrentSorts(d._jpath),b.sort(function(a,b){return d._options.postSort(a,b,j)})),d._handleSuccess(b,a)},onError:function(a){d._handleError(a),d._needPagination=!1},onComplete:function(){d._setLoading(!1),d._currentJob=null}},this._currentJob=this._controller.getCollection(e,c,g,f,a),this},_cancel:function(){return this._currentJob&&this._controller.cancelGetCollection(this._jpath,this._currentJob),this},_handleSuccess:function(a,b){return this._refreshWithData(a,b),SO.isNundef(this._currentSelection)||this.setValue(this._currentSelection,!0),void 0!==this._options.onDataLoadCallback&&this._options.onDataLoadCallback(this),this},_handleError:function(a){var b;void 0!==this._$errorArea&&(this._$errorArea.remove(),this._$errorArea=void 0),this._$errorArea=$("<div></div>").addClass("nlui-list-actionbt nlui-list-error-area");var c=SO.IMG.genIcon("alert",18).addClass("nlui-list-error-icon").appendTo(this._$errorArea);return b=new SO.Widgets.Tooltip(c,{mode:"error",gravity:"n"}),b.setTitle(xtk_core.grid_listError()),SO.Event.bind(c,"vclick",function(c){c.originalEvent.preventDefault(),b.hide(),$("<div></div>").soMessageBox({type:"error",message:a.message,details:a.details})}),this._options.actions&&this._options.actions.global&&this._options.actions.global.placeholder&&this._options.actions.global.placeholder.prepend(this._$errorArea),this},setJpath:function(a){return this._jpath=a,this._fetchData(!0),this},_setLoading:function(a){return this._isLoading=a,a?setTimeout($.proxy(this._showLoading,this),200):this._hideLoading(),this},_showLoading:function(){return this._isLoading&&("timeline"===this._itemMode&&this._$buttonLoadMore?this._$buttonLoadMore.addClass("nlui-list-load-more-in-progress"):"timeline"!==this._itemMode&&(this._needPagination&&this._removePagination(),this._removeCount(),this._$buttonCancelLoading&&this._$buttonCancelLoading.removeClass("nlui-list-loading-hidden")),this._$listBody&&this._$listBody.addClass("nlui-list-isloading"),this._updateActionStates()),this},_hideLoading:function(){return this._isLoading||("timeline"===this._itemMode&&this._$buttonLoadMore?this._$buttonLoadMore.removeClass("nlui-list-load-more-in-progress"):"timeline"!==this._itemMode&&(this._needPagination&&this._addPagination(),this._$buttonCancelLoading&&this._$buttonCancelLoading.addClass("nlui-list-loading-hidden"),this._addCount()),this._$listBody&&this._$listBody.removeClass("nlui-list-isloading"),this._updateActionStates()),this},setMultiSelecting:function(a){this._multiSelecting=a},_refreshWithData:function(a,b){return"grid"===this._renderingMethod.family&&this._applyRenderingPatch(),b&&(this._items=[],this._extraItems=[],this._removedItems=[],this._currentItems=[],this._views=[],this.$el.addClass(this._emptyClassName).children(":not(.nlui-list-header)").remove(),this._createMarkup()),b&&0===a.length&&0===this._options.additionalItems.length?(this._addExtraItem(this._renderNoDataItem,"nlui-list-item-empty"),"card"===this._renderingMethod.family&&this.refreshCardsDisplay(!1)):(this._render(a),this._currentItems.length>0&&this.$el.removeClass(this._emptyClassName),"card"===this._renderingMethod.family&&(this.refreshCardsDisplay(!0),this._options.actions.selection.toggle?this._currentSelection instanceof SO.Selection&&!this._currentSelection.isEmpty()?this._selectionActionBar.triggerCommand("toggle",{active:!0}):this._selectionActionBar.triggerCommand("toggle",{active:!1}):this.selectable(this._selectable))),this._needPagination?this._addPagination():this._removePagination(),this._updateCount(),this._updateActionStates(),this._oldRenderingMethod=this._renderingMethod,this
},setRenderingPatch:function(a){var b,c,d,e=this._getListSettingsFromLocalStorage("columnsPatch");for(e||(e={}),e.columns=a.columns,e.sorts=a.sorts,this._controller.resetSort(this._jpath),b=0;e.sorts.length>b;b++)d=e.sorts[b],c=d.id?d.id:SO.Utils.sequence().nextVal()+d.expr,this._controller.addSort(this._jpath,{expr:d.expr,desc:d.desc,id:c});e.sorts.length>0&&this._controller.applySort(this._jpath,c,{expr:d.expr,desc:d.desc},!0),this._saveListSettingsToLocalStorage("columnsPatch",e)},_applyRenderingPatch:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(g=this._getListSettingsFromLocalStorage("columnsPatch"),l=this._userOptions.renderingMethods[this._renderingMethod.key],d=l.columns,e=d.length,g){if(j=$.extend(!0,{},this._renderingMethod),m=g.columns){for(a=0;m.length>a;a++)switch(k=m[a],k.operation){case"delete":h=SO.Utils.indexOf(j.columns,{name:k.path},this._columnsIndexCompare),h>=0&&j.columns.splice(h,1);break;case"insert":if(this._controller.existsInMetaModel(this._jpath+"/"+k.path))if(SO.Utils.indexOf(j.columns,{name:k.path},this._columnsIndexCompare)>=0)k.operation="modify",j=this._renderingModifyColumns(k,j);else{for(i={name:k.path,label:k.label,editable:!1},b=0;e>b;b++)if(c=d[b],c.name===k.path){c.editable&&(i.editable=c.editable);break}h=this._getRenderingInsertIndex(k,j),h>=0?j.columns.splice(h,0,i):j.columns.push(i)}break;case"modify":this._controller.existsInMetaModel(this._jpath+"/"+k.path)&&(j=this._renderingModifyColumns(k,j))}this._$pagerColumn&&(f=j.columns.length,this._selectCheckboxDisplayed()&&(f+=1),this._$pagerColumn.attr("colspan",f))}this._renderingMethod=j}},_selectCheckboxDisplayed:function(){var a=!1;return this._getActions("selection",["toggle"]).length>0&&(this._renderingMethod.columns&&this._renderingMethod.columns.length>1&&this._selectable||void 0!==this._options.onClick)&&(a=!0),a},_renderingModifyColumns:function(a,b){var c,d,e;return(a.before||a.after)&&(d=SO.Utils.indexOf(b.columns,{name:a.path},this._columnsIndexCompare),d>=0&&(c=this._getRenderingInsertIndex(a,b),d!==c?(e=b.columns.splice(d,1),0>c?b.columns.push(e[0]):(c>d&&(c-=1),b.columns.splice(c,0,e[0]))):b.columns[d].label!==a.label&&(b.columns[d].label=a.label))),b},_getRenderingInsertIndex:function(a,b){var c;return a.before?c=":first:"===a.before?0:":last:"===a.before?b.columns.length-2:SO.Utils.indexOf(b.columns,{name:a.before},this._columnsIndexCompare):a.after&&(":first:"===a.after?c=1:":last:"===a.after?c=-1:(c=SO.Utils.indexOf(b.columns,{name:a.after},this._columnsIndexCompare),c>=0&&c++)),c},_addExtraItem:function(a,b){return this._renderItem(null,null,{content:a,className:"nlui-list-item-extra"+(b?" "+b:"")}),this},_render:function(a){var b,c,d,e;if(c=a.length,d=this._currentItems.length,e=this._options.additionalItems.length,0===d)for(b=0;this._options.additionalItems.length>b;b++)this._addExtraItem(this._options.additionalItems[b]);for(b=0;c>b;b+=1)this._renderItem(b+d+e,a[b]);return this},_renderNoDataItem:function(a){var b={},c=$(SO.IMG.genIcon("coral-file",48).el).addClass("nlui-list-item-nodata-icon"),d=$("<p></p>").addClass("nlui-list-item-nodata-text").text(a._options.emptyText),e=$('<div class="nlui-list-item-nodata"></div>').append(c).append(d);return b.item=e,b},_renderItem:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;switch(u=this,this._itemMode){case"line":for(h=$('<tr class="nlui-list-item-default"></tr>'),this._selectCheckboxDisplayed()&&(i=$('<td class="nlui-list-item-column nlui-list-column-align-center nlui-list-selection-checkbox-container"></td>'),i.data({name:""}),h.append(i),b&&(v=new SO.Widgets.CheckBoxInput({value:!1,readOnly:this.isReadOnly(),onInternalChange:function(){var a=u._multiSelecting;u._currentJob||(u._multiSelecting=!0,u._internalOnSelection(h),u._multiSelecting=a)}}),i.append(v.$el),h.data("checkbox",v))),f=c?[c.content]:this._renderingMethod.columns?this._renderingMethod.columns:[this._renderingMethod],g=f.length,null===a&&null===b&&(q=this._renderingMethod.columns?this._renderingMethod.columns.length:1),d=0;g>d;d+=1){if(e=f[d],j=$('<div class="nlui-list-item-container"></div>'),i=$('<td class="nlui-list-item-column"></td>').append(j),l=this._jpath+"["+a+"]",e.width&&i.width(e.width),e.name&&(t=l+"/"+e.name,this._controller.existsInMetaModel(t)&&(s=this._controller.getType(t)),i.data({colPath:t,colType:s})),"long"!==s&&"double"!==s&&"number"!==s||e.align?e.align&&i.addClass("nlui-list-column-align-"+e.align):i.addClass("nlui-list-column-align-right"),q&&i.attr("colspan",q),h.append(i),e.renderer&&!e.editable||c)c&&"function"==typeof c.content?(o=c.content(this,a,j),void 0!==o.click&&j.click(o.click),j.append(o.item)):(k=c?c.content:e.renderer(b,a,j),"string"==typeof k?j.text(k):j.append(k));else if(m=!0,r=void 0===e.editable?!1:e.editable,!this._controller.isReadOnly(t)&&r?/boolean|enum|link/.test(s)?m=!1:i.addClass("nlui-list-item-column-editable"):e.displayInput&&(m=!1),m){if(x=SO.Utils.extend({},{locale:this._options.locale,render:{callback:e.renderer,row:b,index:b,$container:j}},this._controller.getParams(t)),"enum"===s)for(x.itemsMap={},w=0,y=x.items.length;y>w;w+=1)z=x.items[w],x.itemsMap[z.name]=z.label;i.data("options",x),j.append(this._formatCellValue(t,s,x))}else n=ViewControllerManager.newViewController(this._controller,t,{readOnly:m,mandatory:this._controller.isMandatory(t),hidden:this._controller.isHidden(t),disabled:this._controller.isDisabled(t),strict:this._controller.isStrict(t),locale:this._options.locale}),this._views.push(n),i.data("view",n),n.initialize(),j.append(n.$div),r||"dateonly"!==s||n.controller.getValue(t)||n.$div.empty();h.append(i)}break;case"timeline":if(h=$("<tr></tr>"),c)j=$('<div class="nlui-tllist-item-container"></div>'),i=$('<td class="nlui-tllist-item-cell"></td>'),i.append(j),h.append(i),"function"==typeof c.content?(o=c.content(this,a,j),j.append(o.item)):j.append(c.content),c.className&&h.addClass(c.className);else for(p=this._renderingMethod.renderer(b,a),d=0;2>d;d+=1)j=$('<div class="nlui-tllist-item-container"></div>'),i=$('<td class="nlui-tllist-item-cell"></td>'),0===d&&p.icon?j.addClass("nlui-tllist-cell-circle").append(SO.IMG.genIcon(p.icon,18)):1===d&&p.right&&(i.append($('<div class="nlui-timeline-list-cell-arrow"></div>')),"string"==typeof p.right?j.text(p.right):j.append(p.right)),i.append(j),h.append(i);break;default:j=$('<div class="nlui-list-item-container"></div>'),h=$('<div class="nlui-list-item-default"></div>').append(j),c&&"function"==typeof c.content?(o=c.content(this,a,j),void 0!==o.click&&j.click(o.click),j.append(o.item)):(k=c?c.content:this._renderingMethod.renderer(b,a,j),"string"==typeof k?j.text(k):j.append(k))}for(var A=this._currentSelection&&this._currentSelection.getItems()||[],d=0;A.length>d;d++){var B=A[d];this._controller.areKeysEqual(this._jpath,B,b)&&!b.newAdded&&this._visualSelect(h)}return null!==b&&h.addClass("nlui-list-item"),this._$itemsBody.append(h.data("row",b)),c?(h.addClass(c.className),this._extraItems.push(h)):(this._currentItems.push({source:b,$container:h}),this._items.push(h)),this},_formatCellValue:function(a,b,c){var d,e,f,g,h;switch(d=this._controller.getValue(a),g=this._controller.getDisplayFormat(a),b){case"enum":e=c.itemsMap[d];break;case"link":e=d?d.title:"";break;default:"dateonly"!==b||!d||d instanceof SO.DateOnly||d instanceof SO.PartialDate||(d=new SO.PartialDate(d)),"timespan"===b&&(d=SO.TimeSpan.parse(d)),"date"===b&&"string"==typeof d&&(/z$/i.test(d)?(d=SO.DateTime.parse(d),b="datetime"):d=SO.DateOnly.parse(d)),h=g||SO.Format.getDefaultFormatForType(b),e=SO.Format.formatValue(d,h,{locale:this._options.locale,timezone:this._options.timezone})}return c.render.callback&&SO.isFunction(c.render.callback)&&(e=c.render.callback(c.render.row,c.render.index,c.render.$container,this)),f=document.createElement("div"),f.classList.add("nlui-list-item-container"),f.textContent=e,f},refreshCardsDisplay:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;if(b=this,m=240,e=this._items.length,f=this._$itemsBody?this._$itemsBody.width():0,g=0,e>0&&(e+=this._extraItems.length),(a||e!==this._tmpItemsLen)&&(this._tmpColumnCount=null,this._$columns=[],this._columns=[]),f>0&&(this._$itemsBody.addClass("nlui-list-card-container"),k=Math.floor(f/m),l=100/k+"%",h=this._tmpColumnCount!==k||e!==this._tmpItemsLen,k>0&&h)){for(this._$columns=this._$columns||[],this._columnsHeight=h?[]:this._columnsHeight,c=k;this._tmpColumnCount>k&&this._tmpColumnCount>c;c+=1)this._$columns[c].hide();for(c=0;k>c;c+=1)j=this._$columns[c],h&&(j||(j=$('<div class="nlui-list-card-column"></div>'),this._$itemsBody.append(j),this._$columns.push(j)),this._columnsHeight.push(0),0===c&&j.append(this._items)),j.show().css("width",l);var n=this._items.length>0?[].concat(this._extraItems).concat(this._items):this._items;for(e=n.length,c=0;h&&e>c;c+=1)d=n[c],i=d.outerHeight(!0),g=this._findSpaceInCardsColumn(g,i,0),this._$columns[g].append(d),this._columnsHeight[g]+=i,g+=1;this._tmpColumnCount=k,this._tmpItemsLen=e}return this},_findSpaceInCardsColumn:function(a,b,c){var d,e,f,g,h,i,j;return e=this._columnsHeight.length-1,c+=1,a>=this._columnsHeight.length&&(a=0),f=a+1,i=this._columnsHeight[a-1],g=this._columnsHeight[f],h=this._columnsHeight[a],j=i&&i>h+b/2,d=0===h||g+b>=h+b||j?a:e!==a||i&&!j?2===c?a===e?a:f:this._findSpaceInCardsColumn(f,b,c):e},_visualUnselect:function(a){var b,c,d,e,f=this._selectable,g=this._selectionMode,h=this._options.onClick;if(void 0===a){for(b=0;this._$selectedItems.length>b;b++)c=this._$selectedItems[b].removeClass("nlui-list-selected"),"card"===this._renderingMethod.family&&(d=c.data("selectedIcon"))?d.remove():(f||"none"!==g||void 0!==h)&&(e=c.data("checkbox"),e&&e.setValue(!1)),this._currentSelected===c&&(this._currentSelected=null);this._$selectedItems=[]}else b=SO.Utils.indexOf(this._$selectedItems,a,function(a,b){return a[0]===b[0]}),-1!==b&&(c=this._$selectedItems[b].removeClass("nlui-list-selected"),"card"===this._renderingMethod.family&&(d=c.data("selectedIcon"))?d.remove():(f||"none"!==g||void 0!==h)&&(e=c.data("checkbox"),e&&e.setValue(!1)));return this},_visualSelect:function(a){var b,c,d=this._selectable,e=this._selectionMode,f=this._options.onClick;return a.addClass("nlui-list-selected"),this._currentSelected&&this._currentSelected!==a&&"multi"!==e&&this._currentSelected.removeClass("nlui-list-selected"),"card"===this._renderingMethod.family?a.data("row")&&0===$(".nlui-list-selected-icon",a).length&&(b=SO.IMG.genIcon("card-selected",48).addClass("nlui-list-selected-icon"),a.data("selectedIcon",b).append(b)):(d||"none"!==e||void 0!==f)&&(c=a.data("checkbox"),c&&c.setValue(!0)),this._currentSelected=a,this._$selectedItems.push(a),this},_findAndSelect:function(a,b){var c,d,e,f,g,h=[],i=[];if(!SO.isNundef(a)){for(g=a.getItems(),c=0;h.length<g.length&&this._currentItems.length>c;c++){for(e=this._currentItems[c],f=!1,d=0;f===!1&&g.length>d;)f=this._controller.areKeysEqual(this._jpath,g[d],e.source),d++;f&&(h.push(e),i.push(e.source),this._visualSelect(e.$container),b&&this._scrollTo(e.$container))}SO.isNundef(h)||(this._currentSelection=new SO.Selection({selectionMode:this._selectionMode,items:i}))}return this},_findSelectionPositions:function(a){var b,c,d,e,f,g;return b=this,g=this._jpath,f=this._controller,c=[],SO.isNundef(a)||(d=a.getItems(),e=this._currentItems,SO.Utils.each(d,function(a,b){SO.Utils.each(e,function(a,d){return f.areKeysEqual(g,b,d.source)?(c.push(a),!1):void 0})})),c.sort(function(a,b){return a-b})},_findPosition:function(a){var b,c;if(SO.isNundef(a))c=-1;else for(b=0;this._currentItems.length>b;b++)if(this._controller.areKeysEqual(this._jpath,a,this._currentItems[b].source)){c=b;break}return c},_scrollTo:function(a){var b,c,d;return c=a.parent().parent(),d=a.position(),b=d.top-c.height(),b>0&&c.animate({scrollTop:b},500),this},refresh:function(){return this._fetchData(!0),this},disableItemByPath:function(a,b){var c,d,e;for(d=this._views.length,c=0;d>c;c+=1)if(e=this._views[c],e.jpath===a){e.setReadOnly(b);break}return this},onJpathNotify:function(a,b,c,d){var e,f,g,h,i;if(b=new SO.Structure.Jpath(b),b.contains(this._jpath)){switch(f=[],g=!1,a){case"add":if(this._options.refreshOnAdd)this.refresh();else{for(g=!0,e=0;this._currentItems.length>e;e++)f.push($.extend(!0,{},this._currentItems[e].source));d.item.newAdded=!0,f.push($.extend(!0,{},d.item))}break;case"cancelAdd":break;case"remove":if(g=!1,i=this._removedItems.pop(),this._currentEdit&&SO.DOMUtils.isDescendantOf(this._currentEdit,i.$el)&&(this._currentEdit=null),i.$el.remove(),this._currentItems.splice(i.position,1),this._internalItems.splice(i.position,1),0===this._removedItems.length){for(g=!0,e=0;this._currentItems.length>e;e++)f.push($.extend(!0,{},this._currentItems[e].source));this.setValue(null),this._options.onSelection(void 0,void 0)}break;case"cancelRemove":break;case"move":for(g=!0,e=0;this._currentItems.length>e;e++)e!==d.source?f.push($.extend(!0,{},this._currentItems[e].source)):h=$.extend(!0,{},this._currentItems[e].source);f.splice(d.destination,0,h);break;case"duplicate":for(g=!0,d.newItem.newAdded=!0,e=0;this._currentItems.length>e;e++)e===d.destination&&f.push(d.newItem),f.push($.extend(!0,{},this._currentItems[e].source));d.destination===this._currentItems.length&&f.push(d.newItem);break;case"cancelDuplicate":break;case"strict":break;case"sort":case"filter":case"update":this.refresh();break;case"error":break;case"params":break;case"value":this._needPagination=this._controller.hasNext(this._jpath,this._startLine,this._askedLineCount),this._refreshWithData(c,!0),0===c.length&&(this._internalItems=c,this._updateCount());break;case"loading":return this;default:throw"Unknown type in method onJpathNotify: "+a}g&&this._refreshWithData(f,!0)}return this._updateActionStates(),this},refreshInlineDisplay:function(a){var b;return SO.isNundef(this._currentSelection)||(b=this._currentSelection.label),SO.isNundef(b)?(a.addClass("emptyvalue"),a.html($("<span/>",{html:this._options.emptyText}))):(a.removeClass("emptyvalue"),a.html($("<span/>",{html:b}))),this},getConfId:function(){return this._options.confId},onBlockNotify:function(){return this},_updateCount:function(){var a=this._internalItems.length,b=this._count||(this._needPagination?"?":a),c=SO.Format.formatValue(a,"integer")+" / "+("?"===b?b:SO.Format.formatValue(b,"integer"));return this._$buttonCount&&(this._$buttonCount.soSimpleButton("setLabel",c),SO.isNumber(this._count)||!this._needPagination?(this._needCount=!1,this._$buttonCount.addClass("nlui-list-count-area-done")):this._$buttonCount.removeClass("nlui-list-count-area-done")),this},_countData:function(){var a,b=this,c=this._jpath,d=this._controller.hasCount(c);return d&&this._needCount?(this._currentJob&&this._cancel(),this._$errorArea&&this._$errorArea.remove(),this._setLoading(!0),a={onSuccess:function(a){b._count=a,b._needCount=!1,b._updateCount()},onError:function(a){b._handleError(a)},onComplete:function(){b._setLoading(!1),b._currentJob=null}},this._currentJob=this._controller.getCount(c,a),this):this},destroy:function(){var a=["nlui-list"];return this._oldFamilyClass&&a.push(this._oldFamilyClass),this.$el.removeClass(a.join(" ")),this._options.layoutManager.unRegisterWidget(this),this.$el.empty(),this._controller.unregisterJpathObserver(this._options.jpath,this),this},_getActions:function(a,b){var c=this,d=[];return this._options.actions.hasOwnProperty(a)&&!SO.isBoolean(this._options.actions[a])&&(d=Object.keys(this._options.actions[a]),SO.isArray(b)&&(d=SO.Utils.filter(d,function(a,c){return-1===b.indexOf(c)})),d=SO.Utils.filter(d,function(b,d){var e=c._options.actions[a];return SO.isNundef(e[d])||SO.isBoolean(e[d])&&e[d]===!0})),d},showColumn:function(a,b){return this._updateColumnVisibility("insert",a,b)},hideColumn:function(a,b){return this._updateColumnVisibility("delete",a,b)},_updateColumnVisibility:function(a,b,c){var d=[],e=this._currentItems;e.length;var f,g=this._userOptions.renderingMethods[this._renderingMethod.key].columns.slice(),h=this._renderingMethod.columns.slice(),i=this._getListSettingsFromLocalStorage("columnsPatch"),j=[].concat(g).concat(h);i&&i.columns&&(j=j.concat(i.columns.slice())),j=SO.Utils.unique(j,function(a,b){return!a.name&&a.path&&(a.name=a.path),!b.name&&b.path&&(b.name=b.path),a.name===b.name});for(var k,l=j.length,m={sorts:this._controller.getCurrentSorts(this._jpath),columns:[]},n=0;l>n;n++)if(f=j[n],f.name===b){k={operation:a,path:f.name,label:f.label},"insert"===a&&(0===n?k.before=":first:":k.after=j[n-1].name);break}if(!k)return this;if(m.columns.push(k),this.setRenderingPatch(m),!SO.isNundef(c)&&c===!0){for(var o=0;e.length>o;o++)d.push($.extend(!0,{},e[o].source));this._refreshWithData(d,!0)}return this}}),$.widget("SO.soList",{_create:function(){this._widget=new SO.Widgets.List(this.element,this.options)},_destroy:function(){this._widget.destroy()},rebuildLayout:function(){this._widget.rebuildLayout()},refresh:function(){this._widget.refresh()},refreshInlineDisplay:function(a){this._widget.refreshInlineDisplay(a)},onJpathNotify:function(a,b,c,d){this._widget.onJpathNotify(a,b,c,d)},selectable:function(a){this._widget.selectable(a)},getConfId:function(){return this._widget.getConfId()},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a,b,c){a.widget("NL.nlLinearLayout",a.NL.nlWidget,{options:{params:{gutter:4,spacer:20,size:0,orientation:"horizontal"}},_create:function(){var a=this.options.params;SO.assert("horizontal"===a.orientation||"vertical"===a.orientation,a.orientation+" is not a valid orientation for nlLinearLayout"),this._mainOrientation="horizontal"===a.orientation?"left":"top",this._secondOrientation="horizontal"===a.orientation?"right":"bottom",this._mainDimension="horizontal"===a.orientation?"width":"height",this._secondDimension="horizontal"===a.orientation?"height":"width",this.element.addClass("nlui-linearLayout",a.orientation),this.options.layoutManager.registerWidget(this),this._widgets={}},addWidget:function(b,c){c=a.extend({position:this._mainOrientation,size:0},c);var d=a("<div></div>").addClass("nlui-linearLayout-cell").append(b);this.element.append(d);var e=SO.Utils.sequence().nextVal();return this._widgets[e]={$cell:d,$widget:b,constraints:c},e},removeWidget:function(a){this._widgets.hasOwnProperty(a)&&(this._widgets[a].$widget.remove(),delete this._widgets[a])},rebuildLayout:function(){var b=this;this.options.params.size>0&&this.element.css(this._secondDimension,this.options.params.size+"px");var d=this.options.params.gutter,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0;a.each(this._widgets,function(a,d){if(d!==c){var e=d.$cell,m=d.constraints;m.position===b._mainOrientation&&(h++,m.size>0?g+=m.size:i++),m.position===b._secondOrientation&&(k++,m.size>0?j+=m.size:l++),e[b._secondDimension]()>f&&(f=e[b._secondDimension]())}});var m=this.element[this._mainDimension](),n=SO.HTMLUtils.paddingLeft(this.element),o=SO.HTMLUtils.paddingTop(this.element),p=m;h>0&&k>0&&(e=this.options.params.spacer,p-=e),h>1&&(p-=d*(h-1)),p-=g,k>1&&(p-=d*(k-1)),p-=j;var q=0,r=0;i>0||l>0?(q=Math.floor(p/(i+l)),r=p%(i+l)):k>0&&(e+=p);var s="horizontal"===this.options.params.orientation?n:o;a.each([this._mainOrientation,this._secondOrientation],function(f,g){g===b._secondOrientation&&(s+=e);var h=!0;a.each(b._widgets,function(a,e){if(e!==c){var f=e.$cell,i=e.constraints;if(i.position===g){h||(s+=d,r>0&&(r--,s++)),h=!1;var j=q;i.size>0&&(j=i.size);var k="horizontal"===b.options.params.orientation?o:s,l="horizontal"===b.options.params.orientation?s:n;f[b._mainDimension](j).css({top:k,left:l}),"vertical"===b.options.params.orientation&&f[b._secondDimension](b.options.params.size),s+=j}}})}),0===this.options.params.size&&this.element[this._secondDimension](f)}})})(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.assert(void 0===NL.Widgets.drapDropManager,"The dragDrop manager was already defined."),NL.Widgets.dragDropManager=function(){var a=null,b=[],c=[],d=null,e=null,f=function(){return a?a.draggable().data("draggable"):null},g=function(a){return a?"pointer":"intersect"},h=!0,i=function(a){var b=a.offset(),c=$(a[0].contentDocument);return{left:b.left-c.scrollLeft(),top:b.top-c.scrollTop()}},j=function(a){var b=f();b&&b._mouseDown(a)},k=function(a){var b=f();if(b){if(h){var c=i(a.data.$frame);b.offset.click.left-=c.left,b.offset.click.top-=c.top,h=!1}b._mouseMove(a)}},l=function(a){var b=f();if(b){var c=i(a.data.$frame);b.offset.click.left+=c.left,b.offset.click.top+=c.top,h=!0}},m=function(a){var b=f();if(b){var c=i(a.data.$frame);b.offset.click.left+=c.left,b.offset.click.top+=c.top,h=!0,b._mouseUp(a)}$("body").trigger("mouseup")};return{initIFrameFix:function(a){var b=void 0===a?$("iframe"):a;b.each(function(){var a=$(this),b=a.contents().find("body");b.unbind("mousedown",j).unbind("mousemove",k).unbind("mouseout",l).unbind("mouseup",m).bind("mousedown",{$frame:a},j).bind("mousemove",{$frame:a},k).bind("mouseout",{$frame:a},l).bind("mouseup",{$frame:a},m)})},registerDraggingZone:function(a){null===e?(e=a.isCursorVisible(),d=!0):e!==a.isCursorVisible()&&(d=!1)},registerDroppingZone:function(a){b.push(a),d&&a._droppableOption("tolerance",g(e)),"listOfDraggables"===a.options.type&&c.push(a)},notifyDragStart:function(c){if(a=c.element,!d)for(var e=b.length,f=g(c.isCursorVisible()),h=0;e>h;h++)b[h].options.lockTolerance||b[h]._droppableOption("tolerance",f)},notifyDragStop:function(){a=null},notifyDOMModification:function(){for(var a=c.length,b=0;a>b;b++)c[b].makeInsertion()},getCurrentDraggable:function(){return a},getDroppingInsertionZones:function(){return c}}}(),function(a,b,c){var d="nlDraggable-",e=d+"accept-",f=1,g=2,h=function(a){var b=a.offset();return{x:(b.left+a.outerWidth(!0))/2,y:(b.top+a.outerHeight(!0))/2}},i=function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},j=function(a,b){var c=k(a,b);if(c.touching)return 0;var d=a.offset(),e=b.offset();return c.horizontalTouching?d.left<e.left?e.left-(d.left+a.outerWidth(!0)):d.left-(e.left+b.outerWidth(!0)):c.verticalTouching?d.top<e.top?e.top-(d.top+a.outerHeight(!0)):d.top-(e.top+b.outerHeight(!0)):d.top<e.top&&d.left<e.left?i({x:d.left+a.outerWidth(!0),y:d.top+a.outerHeight(!0)},{x:e.left,y:e.top}):d.top<e.top&&d.left>e.left?i({x:d.left,y:d.top+a.outerHeight(!0)},{x:e.left+b.outerWidth(!0),y:e.top}):d.top>e.top&&d.left<e.left?i({x:d.left+a.outerWidth(!0),y:d.top},{x:e.left,y:e.top+b.outerHeight(!0)}):d.top>e.top&&d.left>e.left?i({x:d.left,y:d.top},{x:e.left+b.outerWidth(!0),y:e.top+b.outerHeight(!0)}):void 0},k=function(b,c){var d=b.outerHeight(!0),e=b.outerWidth(!0),f=c.outerHeight(!0),g=c.outerWidth(!0),h=b.offset(),i=c.offset(),j=i.top,k=h.top,l=i.left,m=h.left,n=l+g,o=m+e,p=j+f,q=k+d,r=j>=k&&q>=j||p>=k&&q>=p||k>=j&&p>=k||q>=j&&p>=q,s=l>=m&&o>=l||n>=m&&o>=n||m>=l&&n>=m||o>=l&&n>=o,t=r&&s,u=t?(Math.min(p,p)-Math.max(j,k))*(Math.min(n,o)-Math.max(l,m)):0,v={right:o>n?(Math.min(p,q)-Math.max(j,k))/d:0,left:l>m?(Math.min(p,q)-Math.max(j,k))/d:0,top:j>k?(Math.min(n,o)-Math.max(l,m))/e:0,bottom:q>p?(Math.min(n,o)-Math.max(l,m))/e:0},w=0,x=null;return a.each(v,function(a,b){b>w&&(x=a,w=b)}),{overflow:x,horizontalTouching:r,verticalTouching:s,touching:t,touchingAmount:u}},l=function(b){var c=b.length,d=[],e=[],h=Number.MAX_VALUE,i=Number.MAX_VALUE,j=0,k=0;b.each(function(){var b=a(this),c=b.offset().top,f=b.offset().left;d.push(c),e.push(f),h>c&&(h=c),i>f&&(i=f)});for(var l=0;c>l;l++)j+=d[l]-h,k+=e[l]-i;return k>j?f:g};a.widget("NL.nlDraggable",a.NL.nlWidget,{options:{dragZoneId:null,helper:"original",data:{},onStart:function(){},onDrag:function(){},onStop:function(){},draggableOptions:{}},_defaultOptions:{containment:"document",scroll:!1,revert:"invalid"},_create:function(){var b=this,d=this.options,f=this.element;b.manager=NL.Widgets.dragDropManager;var g={revertDuration:0};a.each(["create","start","drag","stop","helper"],function(){d.draggableOptions[this]&&SO.log.error("jQuery UI option definition is not allowed here ("+this+").")}),null!==d.dragZoneId&&d.dragZoneId!==c&&f.addClass(e+d.dragZoneId),g.start=function(c,e){b.manager.notifyDragStart(b),b._styleBeforeDragging=b.element.attr("style"),b._hideWhenDragging&&b.element.toggle(!1),a.isFunction(d.onStart)&&d.onStart.call(this,d.dragZoneId,b.options.data,e)},a.isFunction(d.onDrag)&&(g.drag=function(a,c){d.onDrag.call(this,d.dragZoneId,b.options.data,c)}),g.stop=function(c,e){b.manager.notifyDragStop(b),b._hideWhenDragging&&b.element.toggle(!0),a.isFunction(d.onStop)&&d.onStop.call(this,d.dragZoneId,b.options.data,e)},f.draggable(a.extend({},this._defaultOptions,g,d.draggableOptions)),b.manager.registerDraggingZone(b),this._setHelper(d.helper)},_setOption:function(a,b){b!==c&&"helper"===a&&this._setHelper(b)},_setHelper:function(a){this._hideWhenDragging="cloneAndHide"===a,"cloneAndHide"===a?this.element.draggable("option","helper","clone"):this.element.draggable("option","helper",a)},_draggableOption:function(a,b){return this.element.draggable("option",a,b)},isCursorVisible:function(){return"none"!==this._draggableOption("cursor")},styleBeforeDragging:function(){return this._styleBeforeDragging},data:function(a,b){return b===c?this.options.data[a]:(this.options.data[a]=b,void 0)}});var m="nlui-droppable-dropzone",n=function(b,c){b.data._onHelperDrag.call(b.data,a.extend({draggable:a(this)},c))},o=function(b,c){b.data._onHelperDragStop.call(b.data,a.extend({draggable:a(this)},c))},p=function(a){a.data._onAfterDrop.call(a.data)};a.widget("NL.nlDroppable",a.NL.nlWidget,{options:{acceptedIds:[],type:null,draggableSelector:"*",lockTolerance:!1,onDrop:function(){},onOver:function(){},onOut:function(){},isInsertionCompatible:function(){return!0},onInsertion:function(){},onMove:function(){},onAfterDrop:function(){},droppableOptions:{}},_defaultOptions:{},_callbacksOverrides:{drop:"onDrop",over:"onOver",out:"onOut"},_overrideCallback:function(b,d){var e=this;return e.options[e._callbacksOverrides[b]]?function(f,g){g.draggable.data("nlDraggable")!==c&&e.options[e._callbacksOverrides[b]].call(d[0],g.draggable.nlDraggable("option","dragZoneId"),g.draggable.nlDraggable("option","data"),a.extend({},g,{event:f}))}:null},_create:function(){var b=this,c=this.options,d=this.element;b.manager=NL.Widgets.dragDropManager;var f={};if(b._classBefore=this.element.attr("class"),a.each(["drop","over","out"],function(a,e){c.droppableOptions[e]&&SO.log.error("jQuery UI callback definition is not allowed here ("+e+").");var g=b._overrideCallback(e,d);"drop"===e?f[e]=function(a,c){c.draggable.bind("dragstop",b,p),g&&g(a,c)}:g&&(f[e]=g)}),c.acceptedIds.length){for(var g="."+e+c.acceptedIds[0],h=1;c.acceptedIds.length>h;h++)g+=", ."+e+c.acceptedIds[h];f.accept=g}"listOfDraggables"===b.options.type&&b.makeInsertion(),this.element.droppable(a.extend({},this._defaultOptions,f,c.droppableOptions)),b.manager.registerDroppingZone(b)},destroy:function(){this.element.droppable("destroy"),a.Widget.prototype.destroy.call(this),this.element.attr("class",this._classBefore)},_getDraggableList:function(){return this.element.children(this.options.draggableSelector).not(".ui-draggable-dragging").not("."+m)},makeInsertion:function(){var b=this,c=b.element,d=this._getDraggableList();if(b._insertionItems={},b._anchors=[],b._orientation=l(d),c.children("."+m).remove(),d.unbind("drag",n).bind("drag",b,n),d.each(function(c,d){var e=a(d);b._anchors.push({point:h(e),$element:e}),e.is(":ui-draggable")&&e.draggable("option","revert",!0),e.is(":nl-nlDraggable")&&e.nlDraggable("option","helper","cloneAndHide"),e.before(a('<div class="'+m+'"> </div>').toggle(!1)),e.nlDroppable({lockTolerance:!0,droppableOptions:{tolerance:"touch"}}).data("nlDroppable-itemIndex",c)}),0===d.length)c.append(a('<div class="'+m+'"> </div>').toggle(!1)),this._emptyDroppingZone=!0;else{var e=a(d[0]);this._itemDisplay={display:e.css("display"),margin:e.css("margin"),"box-sizing":e.css("box-sizing"),"float":e.css("float")},a(d[d.length-1]).after(a('<div class="'+m+'"> </div>').toggle(!1)),this._emptyDroppingZone=!1}},_onAfterDrop:function(){a.isFunction(this.options.onAfterDrop)&&this.options.onAfterDrop()},_checkCompatibleInsertion:function(b,c){return!a.isFunction(this.options.isInsertionCompatible)||this.options.isInsertionCompatible.call(this.element,b.nlDraggable("option","dragZoneId"),c,b.nlDraggable("option","data"))},_refreshDropZones:function(){a("."+m).toggle(!1);var b=this.manager.getCurrentDraggable();this._insertionItems.before?this._insertionItems.before.next("."+m).outerWidth(b.outerWidth()).outerHeight(b.outerHeight()).toggle(!0).css(this._itemDisplay):this._insertionItems.after&&this._insertionItems.after.prev("."+m).outerWidth(b.outerWidth()).outerHeight(b.outerHeight()).toggle(!0).css(this._itemDisplay)},_setItemOrder:function(a,b){this._dropPossible(null!==a||null!==b),this._insertionItems={before:a,after:b},this._refreshDropZones()},_dropPossible:function(a){a?this.manager.getCurrentDraggable().draggable("option","revert",!1):this.manager.getCurrentDraggable().draggable("option","revert",!0)},_onHelperDrag:function(a){for(var b=this.manager.getDroppingInsertionZones(),c=null,d=0,e=a.helper,f=0;b.length>f;f++)if(b[f].element.is(":visible")){b[f]._setItemOrder(null,null);var g=k(e,b[f].element);g.touching&&g.touchingAmount>d&&(d=g.touchingAmount,c=f)}if(null===c)for(var h=Number.MAX_VALUE,f=0;b.length>f;f++)if(b[f].element.is(":visible")){var i=j(e,b[f].element);h>i&&(h=i,c=f)}SO.assert(SO.isNumber(c),"Closest drop zone was not found."),null!==c&&b[c]._handleDrag(a)},_handleDrag:function(a){var b=this._anchors.length,c=a.draggable;if(c.unbind("dragstop",o).bind("dragstop",this,o),0===b)this.element.find("."+m).outerWidth(c.outerWidth()).outerHeight(c.outerHeight()).toggle(!0);else{for(var d=h(a.helper),e=Number.MAX_VALUE,j=null,k=0;b>k;k++){var l=i(d,this._anchors[k].point);e>l&&(e=l,j=k)}SO.assert(SO.isNumber(j),"Closest anchor was not found.");var n=!1;j===b-1&&(n=this._orientation===f&&d.x>this._anchors[j].point.x||this._orientation===g&&d.y>this._anchors[j].point.y),0===j?b>1||!n?this._setItemOrder(null,this._anchors[j].$element):this._setItemOrder(this._anchors[j].$element,null):j===b-1&&n?this._setItemOrder(this._anchors[j].$element,null):this._setItemOrder(this._anchors[j-1].$element,this._anchors[j].$element)}},_onHelperDragStop:function(a){var b=a.draggable;b.unbind("dragstop",o);var c=this.element.find(b).length>0;if(0!==this._anchors.length||c){if(this._insertionItems.before||this._insertionItems.after){var d=!1,e=this._insertionItems.before,f=this._insertionItems.after,g=this._getInsertionIndex(e,f);c&&e&&this.element.children().index(e)>=this.element.children().index(b)&&g--;var h=c&&g===b.data("nlDroppable-itemIndex");!h&&this._checkCompatibleInsertion(b,g)&&(b.draggable("option","revertDuration",0),e?(e.after(b),d=!0):f&&(f.before(b),d=!0)),d&&(c?this._completeItemMove(b,g):this._completeItemInsertion(b,g))}}else this._checkCompatibleInsertion(b,null,null)&&(this.element.append(b),this._completeItemInsertion(b,0));this._setItemOrder(null,null)},_getInsertionIndex:function(a,b){return SO.assert(a!==c&&b!==c,"Incomplete function call ["+a+", "+b+"]"),a?this._getDraggableList().index(a)+1:b?this._getDraggableList().index(b):0},_completeItemMove:function(b,c){a.isFunction(this.options.onMove)&&this.options.onMove.call(this.element,b.nlDraggable("option","dragZoneId"),c,b.nlDraggable("option","data"),b),this._finalizeItemMove(b)},_completeItemInsertion:function(b,c){a.isFunction(this.options.onInsertion)&&this.options.onInsertion.call(this.element,b.nlDraggable("option","dragZoneId"),c,b.nlDraggable("option","data"),b),this._finalizeItemMove(b)},_finalizeItemMove:function(a){a.attr("style",a.nlDraggable("styleBeforeDragging")),this.manager.notifyDOMModification()},_droppableOption:function(a,b){return this.element.droppable("option",a,b)}})}(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("ListHeadEditor",{DEFAULT_OPTIONS:{metaDataService:void 0,resourcePath:"",renderingObject:{},onSave:function(){},dialogTitle:xtk_core.list_configuration_title(),currentPatch:{}},_create:function(){this._resourceWalker=null,this._fieldList=null,this._renderingObject=$.extend(!0,{},this._options.renderingObject),this._dialog=null,this._currentController=null,this._jpathRes="listeHeaderResourceWalker",this._jpathList="listField",this._newPatchColumn=[],this._metaDataService=this._options.metaDataService,this._actionBar=null,this._createDialog()},_createDialog:function(){var a,b,c,d,e,f,g,h;a=this,b={},this._metaDataService||(this._metaDataService=new NL.MetaDataService(void 0,{dataSourceType:"metadata"})),b[this._jpathRes]=[],b[this._jpathList]=this._computeColumnsToList(this._renderingObject),g=$('<div class="nlui-list-header-dialog-body-content"></div>'),c=$('<div class="nlui-list-header-dialog-content"></div>').appendTo(g),d=$('<div class="nlui-list-header-dialog-leftcontainer"></div>').appendTo(c),e=$('<div class="nlui-list-header-dialog-rightcontainer"></div>').appendTo(c);var i=new SO.Widgets.GrayBar($('<div class="nlui-list-header-graybar"></div>'));e.prepend(i.$el);var j=$("<div></div>");i.addActionBarContent("globalActions",j);var k=$("<div></div>");i.addActionBarContent("localActions",k);var l={mode:"transparent",iconSize:24,icon:"coral-arrowRight",command:function(){a._onResourceFieldValidated(a._resourceWalker.getValue())}};this._actionBar=new SO.Widgets.cmdBar($("<div></div"),{iconSize:24,commands:["addToListCmd"],commandConfigs:{addToListCmd:l}}),j.append(this._actionBar.$el),this._actionBar.setCommandAttribute("addToListCmd","hidden",!0),f=this._getMetaResourceMetaModel(),f.dataSource=new NL.DataSource.MetaDataService({url:this._options.resourcePath,metaDataService:this._metaDataService}),h={},h[this._jpathRes]=f,h[this._jpathList]={type:"list",elements:{name:{type:"string",label:"name"},expression:{type:"string",label:"expression"},sort:{type:"enum",label:"sort",params:{selection:"mono",items:[{name:"",label:xtk_core.list_head_editor_sort_no()},{name:"asc",label:xtk_core.list_head_editor_sort_asc()},{name:"desc",label:xtk_core.list_head_editor_sort_desc()}]}}},keys:["name"],removeMethod:function(b,c,d){a.onResourceFieldRemoved(b,c),d()}},this._currentController=new SO.MVC.Controller({model:b,metamodel:h,statemodel:{}}),this._resourceWalker=new SO.Widgets.Treelist($("<div></div>"),{controller:this._currentController,jpath:this._jpathRes,layoutType:"default",selectable:!0,selectionMode:"mono",mode:"default",onDblClick:function(b){a._onResourceFieldValidated(b)},onSelection:function(b){a._onResourceFieldSelected(b)},renderingMethods:{defaultTreeRender:{family:"treeNode",renderer:NL.RenderFunctions.defaultTree,icon:"",label:xtk_core.treeList_hide_advanced_fields_help}},fitToParentHeight:!0,defaultRendering:"defaultTreeRender"}),d.append(this._resourceWalker.$el),this._fieldList=new SO.Widgets.List($("<div></div>"),{controller:this._currentController,jpath:this._jpathList,selectable:!0,selectionMode:"multi",renderingMethods:{grid:{family:"grid",label:xtk_core.list_layout_grid(),icon:"viewList",columns:[{name:"name",label:xtk_core.list_head_editor_name(),width:150,editable:!0},{name:"expression",label:xtk_core.list_head_editor_value(),width:150,minWidth:100,renderer:function(a,b,c){return a.img&&c.append(SO.IMG.genIcon(a.img,18)),$("<label></label").text(a.expression).addClass("nlui-input-size-regular nlui-input-mode-default")}},{name:"sort",label:xtk_core.list_head_editor_sort(),editable:!0,width:60,minWidth:60}]}},defaultRendering:"grid",actions:{selection:{sort:!0,remove:!0,duplicate:!1,placeholder:k},global:!1}}),e.append(this._fieldList.$el),this._dialog=new SO.Widgets.Dialog($('<div class="nlui-list-header-editor-dialog"></div>'),{title:this._options.dialogTitle,modal:!0,removeOnClose:!0,dialogClass:"",width:900,height:600,padding:!1,autoOpen:!0,mode:"maximize",cancel:function(){},buttons:[{preset:"cancel",mode:"transparent"},{id:"qe_edit_dialog_ok",preset:"ok",onClick:function(){a.saveListHeader()}}]}),this._dialog.setContent(g)},_computeColumnsToList:function(a){var b,c,d,e,f,g,h,i=[],j=a.sorts,k=a.columns;for(h=function(a,b){return a.expr===b.expression},b=0;k.length>b;b++)g=k[b],d={name:g.label},this._currentController&&(f=this._currentController.getValue(this._jpathList+"["+b+"]")),d.expression=g.expression?g.expression:f&&""!==f.expression?f.expression:g.name||g.label,f&&""!==f.sort?d.sort=f.sort:(d.sort="",j&&j.length>0&&(e=SO.Utils.indexOf(j,d,h),-1!==e&&(d.sort=j[e].desc?"desc":"asc"))),i.push(d);return c=this,i},_updateListLabel:function(a){var b,c,d,e,f,g,h,i,j;for(f=this._currentController.getValue(this._jpathList),b=0;f.length>b;b++){if(i=f[b],-1===i.expression.indexOf("/"))h=a[i.expression]?a[i.expression].label:i.expression;else{for(j=i.expression.split("/"),h=null,g=$.extend(!0,{},a),c=0;j.length-1>c;c++)d=g[j[c]],g=d&&d.content?d.content:null;null!==g&&(d=g[j[j.length-1]],h=d.label)}e=i.name,""!==h&&h!==e&&(i.name=h,this._currentController.setValue(this._jpathList+"["+b+"]",i))}this._fieldList.refresh()},_onResourceFieldSelected:function(a){var b;b=a&&!a.isEmpty()?!1:!0,this._actionBar.setCommandAttribute("addToListCmd","hidden",b)},_onResourceFieldValidated:function(a){var b,c,d,e=a.getItem();c={editable:!0,label:e.label,name:e.nodePath?e.nodePath.substr(1):e.expression,sort:null},b=SO.Utils.indexOf(this._renderingObject.columns,c,function(a,b){return a.name===b.name?!0:!1}),d=$.extend(!0,[],this._currentController.getValue(this._jpathList)),-1===b?(this._renderingObject.columns.push(c),this._newPatchColumn.push({operation:"insert",after:":last:",path:c.name,label:c.label}),d.push({name:c.label,expression:c.name,sort:""})):this._renderingObject.columns[b]=$.extend(!0,this._renderingObject.columns[b],c),this._currentController.setValue(this._jpathList,d,!0)},saveListHeader:function(){var a,b,c,d,e,f,g=this._currentController.getValue(this._jpathList),h={sorts:[],columns:this._newPatchColumn};for(f=function(a,b){return a.expression===b.expression?!0:!1},a=0;g.length>a;a++)c=g[a],("desc"===c.sort||"asc"===c.sort)&&h.sorts.push({expr:c.expression,desc:"desc"===c.sort}),b=SO.Utils.indexOf(this._renderingObject.columns,c,f),-1===b?(this._renderingObject.columns.push(c),e={operation:"insert",path:c.expression,label:c.name}):e=b!==a||this._renderingObject.columns[a].label!==c.name?{operation:"modify",path:c.expression,label:c.name}:null,e&&(d?e.after=d.expression:e.before=":first:",this._newPatchColumn.push(e)),d=c;this._options.onSave(h)},onResourceFieldRemoved:function(a){var b,c;b=SO.Utils.indexOf(this._newPatchColumn,a,function(a,b){return a.name===b.expression||a.expression===b.expression}),-1!==b?this._newPatchColumn.splice(b,1):(this._newPatchColumn.push({operation:"delete",path:a.expression}),c=SO.Utils.indexOf(this._renderingObject.columns,a,function(a,b){return a.name===b.expression&&a.label===b.name}),-1!==c&&this._renderingObject.columns.splice(c,1))},_getMetaResourceMetaModel:function(){return{type:"tree",elements:{PKey:{type:"string",label:"PKey"},apiName:{type:"string",label:"apiName"},desc:{type:"string",label:"desc"},help:{type:"string",label:"help"},icon:{type:"string",label:"icon"},label:{type:"string",label:"label"},lazyLoaded:{type:"boolean",label:"lazyLoaded"},length:{type:"string",label:"length"},privacy:{type:"number",label:"privacy"},readOnly:{type:"boolean",label:"readOnly"},required:{type:"boolean",label:"required"},resName:{type:"string",label:"resName"},resType:{type:"string",label:"resType"},type:{type:"string",label:"type"},nodePath:{type:"string",label:"nodePath"}},keys:["PKey","apiName"]}}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";function treeListDataFilter(a,b){function c(a,b){var c,d,e=!1;for(c in a.filters)a.filters.hasOwnProperty(c)&&(d=a.filters[c].filter,""!==d.value&&-1===b.apiName.toLowerCase().indexOf(d.value.toLowerCase())&&-1===b.label.toLowerCase().indexOf(d.value.toLowerCase())&&(e=!0));return e}function d(a,b){var e,f,g,i,j,k;for(f=!1,i=!0,k=SO.Utils.extend(!0,{},b),j=[],e=0;b.children.length>e;e++)g=b.children[e],f=c(a,g.source),f===!0&&!SO.isNundef(g.children)&&SO.isArray(g.children)&&g.children.length>0&&(h=d(a,g),k.children[e]=h.element,f=f&&h.filter),f||j.push(k.children[e]),i=i&&f;return k.children=j,{filter:i,element:k}}var e,f,g,h,i,j;for(f=[],e=0;a.length>e;e++)i=a[e],j=SO.Utils.extend({},i),g=!1,g=c(b,i.source),g===!0&&!SO.isNundef(i.children)&&SO.isArray(i.children)&&i.children.length>0&&(h=d(b,i),j=h.element,g=g&&h.filter),!g&&j&&f.push(j);return f}SO.ns("SO.Collection"),SO.Collection.Item=function(a,b){this.source=a,this.element=b,this.children=[]},SO.Widgets.define("Treelist","Collection",{DEFAULT_OPTIONS:{controller:null,jpath:null,title:null,headless:!1,layoutType:"default",layoutSize:"small",maxHeight:0,defaultRendering:null,renderingMethods:null,emptyText:xtk_core.noData(),additionalItems:[],autoLoad:!0,onCancel:function(){},search:!0,searchWildcard:"$1",navigator:null,navigatorWildcard:"$2",folderFilter:null,plugins:[],headerBlocks:[],localStorage:{selection:!1,settings:!0},selectable:!1,selectionMode:"none",selection:null,onSelection:function(){},onDblClick:function(){},onAdd:function(){},onDelete:function(){},onMove:function(){},onDuplicate:function(){},groupByAttribute:null,groupHeadRenderer:null,headCollapse:"none",fitToParentHeight:!1,onDataLoadCallback:void 0,beforeAsyncLoad:void 0,afterAsyncLoad:void 0,mode:"default",subElementClosedClass:"",subElementOpenedClass:"",toggleEffect:"blind",expandAll:!1,hideExpandIcon:!1,advancedPlugin:!1,refreshButton:!0,actions:{sort:!1,add:!1,remove:!1,duplicate:!1},fillIncompleteObject:!1,uncollapsedNodePath:null},_create:function(){SO.Widgets.Treelist.superClass._create.apply(this,arguments);var a,b=this;SO.assert(0===function(){var a=0;return SO.Utils.each(b._options.renderingMethods,function(b,c){"treeNode"!==c.family&&(SO.log.warn("Missing or invalid family attribute for rendering method '"+b+"'"),a+=1)}),a}(),"Some rendering methods have no family"),SO.assert(!this._options.selectable||this._options.selectable&&"none"!==this._options.selectionMode,'The option selectable is true but the selectionMode is "none"'),"none"===this._options.selectionMode||this._options.selectable||(this._options.selectable=!0,SO.assert("none"!==this._options.selectionMode&&!this._options.selectable,"You must set the selectable option to true in complement with selectionMode")),this._previousClickElementRef=void 0,this._loading=!1,this._deferredCallbacks=[],this._initRenderingMethod(),SO.assert(!!this._options.controller&&this._options.controller instanceof SO.MVC.Controller,"You must provide a controller to the treelist"),this._waitingTreeSelection=[],SO.isNundef(this._options.selection)||!this._options.selection.getItem||this._options.selection.isEmpty()||(a=this._options.selection.getItem().nodePath,SO.isNundef(a)||(a=a.slice(1),this._waitingTreeSelection=a.split("/"))),this._previousClickElementRef=void 0,this._lastGroupValue=null,this._currentItems=[],this._currentSelection=this._options.selection,null===this._options.selection||void 0===this._options.selection||this._options.selection instanceof SO.Selection||(SO.assert("Selection must be a SO.Selection object"),this._currentSelection=new SO.Selection({selectionMode:"mono",items:[this._options.selection]})),this._$selectedItems=[],this._currentSelectionTreePath=[],this._options.layoutManager.registerWidget(this),this.plugins=[];var c=this._getListSettingsFromLocalStorage("listLayout");if(!SO.isNundef(c)){var d=c.split("-");this._options.layoutType=d[0],this._options.layoutSize=d[1]}switch(this.$el.addClass("nlui-list-container").addClass("nlui-list-layout-"+this._options.layoutType).addClass("nlui-list-layout-"+this._options.layoutSize),this._$errorArea=$("<div></div>").addClass("nlui-list-error-area"),this._buildHeader(),this._buildBody(),this._buildPlugins(),this.$el.on("click",function(){b.$el.focus()}),this._options.fitToParentHeight&&(this.$el.addClass("nlui-treelist-fittoparent"),this._$body.css("min-height","0")),this._options.layoutManager.rebuildLayout(this.$el),this._itemExpandState={},this._oldItemExpandState={},this._currentSearchItems=[],this._needToScrollAt=void 0,this._openIconClass="nlui-tree-list-open-icon",this._closeIconClass="nlui-tree-list-close-icon",this._options.mode){case"default":""===this._options.subElementClosedClass&&(this._options.subElementClosedClass="resource-closed"),""===this._options.subElementOpenedClass&&(this._options.subElementOpenedClass="resource-opened");break;case"tree":""===this._options.subElementClosedClass&&(this._options.subElementClosedClass="nlui-icon-plus"),""===this._options.subElementOpenedClass&&(this._options.subElementOpenedClass="nlui-icon-minus")}this._onGoingRequest=0,this._waitingScrollItem=null,this._scrollOffsetElement=[],b=this,this.$el.addClass("nlui-treelist"),this._options.autoLoad!==!1&&b._fetchData({preSelection:b._options.selection,parentPath:""}),this._controller.registerJpathObserver(this._options.jpath,this)},_buildHeader:function(){if(!this._options.headless){var a,b=this;this._$header=$("<div></div>").addClass("nlui-list-header"),this._$header.appendTo(this.$el),this._$topHeader=this._createHeaderLine();var c=this._getListSettingsFromLocalStorage("headCollapse");void 0!==c&&(this._options.headCollapse=c);var d=-1;for("none"!==this._options.headCollapse&&(d=this._addCollapseIcon()),SO.isEmpty(this._options.title)||(this._$title=SO.isString(this._options.title)?$("<div></div>").addClass("nlui-list-title").append($("<span></span>").text(this._options.title)):$("<div></div>").addClass("nlui-list-title").append(this._options.title),this._$listBusy=$('<span class="nlui-list-title-busy">&nbsp;</span>'),this._$listBusy.appendTo(this._$title),this._$topHeader.nlLinearLayout("addWidget",this._$title,{position:"left",size:0})),this._buildActions(),a=0;this._options.headerBlocks.length>a;a++)this.addHeaderBlock(this._options.headerBlocks[a]);"none"!==this._options.headCollapse&&(void 0===this._$bottomHeader?(this._$topHeader.nlLinearLayout("removeWidget",d),this._$header.css("overflow",""),this._$collapser=null):null!==this._$title&&(this._$title.addClass("nlui-list-title-clickable"),this._$title.on("click",function(a){b._toggleListHeaderHandler(a)})))}},_buildPlugins:function(){var a,b,c;for(b=this,a=0;this._options.plugins.length>a;a++)c=this._options.plugins[a],"EmptyPlugin"===c.pluginClass?(this.addHeaderBlock(c),SO.assert("EmptyPlugin is deprecated, use headerBlocks config or addHeaderBlock function")):this.addPlugin(c.pluginClass,c);this._options.search&&(this.addPlugin("search",{wildcard:this._options.searchWildcard,size:this._options.title?172:0}),!this._datasourceCaps.realTime&&this._options.refreshButton&&this._addRefreshButton()),this._options.navigator&&this.addPlugin("navigatorFilter",$.extend({name:"folderNavigatorFilter"},this._options.navigator,{wildcard:this._options.navigatorWildcard})),this._options.advancedPlugin&&this.addPlugin("advancedPlugin",{jpath:this._jpath,controller:this._controller,treeList:$(this.$el)})},_buildBody:function(){this._$list=$("<ol></ol>"),this._$body=$("<div></div>").addClass("nlui-list-body").append(this._$list).appendTo(this.$el),this._options.selectable&&this._$body.addClass("nlui-list-selectable"),this._options.droppable&&this._$list.nlDroppable(this._options.droppable===!0?this._defaultDroppableOptions:$.extend({},this._defaultDroppableOptions,this._options.droppable))},_onDataFetched:function(){for(var a,b=this._deferredCallbacks;b.length>0;)a=b.shift(),a.call(this);return this},_fetchData:function(a){var b,c,d,e,f;return c=this._jpath,a||(a={}),a&&a.treePath&&(c+="["+a.treePath+"]"),this._currentJob&&this._cancel(),this._hideError(),b=this,this._loading=!0,a.callbacks=a.customCallbacks?a.customCallbacks:{onSuccess:function(c){c={records:c.length,data:c},b._handleSuccess(c,a)},onError:function(a){b._handleError(a)},onComplete:function(){b._handleComplete()}},a.callbacks&&a.callbacks.onComplete&&(f=a.callbacks.onComplete,a.callbacks.onComplete=function(){f(),0===b._onGoingRequest&&(b._loading=!1,setTimeout(b._onDataFetched.bind(b),0))}),d=SO.Utils.getValueFromObj(a,"parentPath",""),this._onGoingRequest++,e=this._controller.getChildren(c,a.callbacks,a.refresh,d,a.currentNode)},_handleSuccess:function(a,b){var c=this;this._$list.find(".nlui-list-info").remove(),b.count||(a.data||"string"!=typeof a?($.each(this.plugins,function(a,b){var d=b.applyDisplayCriteriae();SO.isNundef(d)||c.$el.soTreeList("option",d)}),SO.isNundef(a.data)&&(a.data=[]),this._refreshWithData(a.data),SO.isNundef(b.preSelection)||this.setValue(b.preSelection,!0),void 0!==this._options.onDataLoadCallback&&this._options.onDataLoadCallback(this)):SO.log.error(a)),this._checkScrollElement()},_handleError:function(a){var b,c,d;return this._$errorArea=$("<div></div>").addClass("nlui-list-error-area"),b=SO.IMG.genIcon("alert",18).addClass("nlui-list-error-icon").appendTo(this._$errorArea),c=new SO.Widgets.Tooltip(b,{mode:"error",gravity:"n"}),c.setTitle(xtk_core.grid_listError()),SO.Event.bind(b,"vclick",function(b){b.originalEvent.preventDefault(),c.hide(),$("<div></div>").soMessageBox({type:"error",message:a.message,details:a.details})}),d=this._$topHeader.nlLinearLayout("addWidget",this._$errorArea,{position:"right",size:20}),this._$topHeader.nlLinearLayout("rebuildLayout"),this._$errorArea.attr("data-id",d),this},_hideError:function(){return this._$errorArea&&(this._$topHeader.nlLinearLayout("removeWidget",this._$errorArea.attr("data-id")),this._$topHeader.nlLinearLayout("rebuildLayout"),this._$errorArea=null),this},_handleComplete:function(){this._setLoading(!1),this._currentJob=null},_checkScrollElement:function(){this._onGoingRequest--,0>=this._onGoingRequest&&(this._onGoingRequest=0,null!==this._waitingScrollItem&&(this._scrollTo(this._waitingScrollItem),this._waitingScrollItem=null))},focusSearchInput:function(){},_setLoading:function(a){void 0!==this._$listBusy&&this._$listBusy.toggle(a)},_buildActions:function(){var a=this;this._options.actions&&(this._options.actions.add&&(this._$buttonAdd=$("<div></div>").soButton({mode:"success",icon:"nlui-icon-list-insert-row",onClick:function(){a._controller.addTreeItem(a._getCurrentFullJPath(),void 0,!0)}}),this.addHeaderBlock({contents:[this._$buttonAdd]})),this._options.actions.remove&&(this._$buttonRemove=$("<div></div>").soButton({mode:"default",icon:"nlui-icon-list-delete-row",onClick:function(){a._currentSelectionTreePath.length>0&&a._controller.removeTreeItem(a._getCurrentFullJPath(),void 0,!0)}}),this.addHeaderBlock({contents:[this._$buttonRemove]})),this._options.actions.sort&&(this._$buttonUp=$("<div></div>").soButton({mode:"default",icon:"nlui-icon-list-move-up",onClick:function(){var b=a._findPosition(a._currentSelection);b>0&&a._controller.moveCollectionItem(a._getCurrentFullJPath(),b,b-1,!0)}}),this._$buttonDown=$("<div></div>").soButton({mode:"default",icon:"nlui-icon-list-move-down",onClick:function(){var b=a._findPosition(a._currentSelection);a._currentItems.length-1>b&&a._controller.moveCollectionItem(a._getCurrentFullJPath(),b,b+1,!0)}}),this.addHeaderBlock({contents:[this._$buttonUp]}),this.addHeaderBlock({contents:[this._$buttonDown]})),this._options.actions.duplicate&&(this._$buttonDuplicate=$("<div></div>").soButton({mode:"default",icon:"coral-copy",onClick:function(){var b=a._findPosition(a._currentSelection);-1!==b&&a._controller.duplicateCollectionItem(a._getCurrentFullJPath(),b,b+1,!0)}}),this.addHeaderBlock({contents:[this._$buttonDuplicate]}))),this._updateActionStates()},_getCurrentFullJPath:function(){var a=this._jpath;return this._currentSelectionTreePath.length>0&&(a+="["+this._currentSelectionTreePath.join(",")+"]"),a},_updateActionStates:function(){this._options.actions&&(this._options.actions.remove&&this._$buttonRemove.soButton("changeOptions",{disabled:0===this._currentSelectionTreePath.length}),this._options.actions.sort&&(this._$buttonUp.soButton("changeOptions",{disabled:0===this._currentSelectionTreePath.length}),this._$buttonDown.soButton("changeOptions",{disabled:0===this._currentSelectionTreePath.length})),this._options.actions.duplicate&&this._$buttonDuplicate.soButton("changeOptions",{disabled:0===this._currentSelectionTreePath.length}))},_addLayoutSwitch:function(){var a,b,c,d,e,f,g=this,h=null,i=null,j={},k=this._renderingMethod.key;f=$("<ol></ol>").addClass("nlui-list-layout-widget-container"),e=function(a,b){i||(i=function(a){$(a.target).parents().is(h)===!1&&e(!1,!1)}),f.toggle(a),a?$("body").on("click",i):($("body").off("click",i),b||h.removeClass("nlui-state-hover"))},d=function(a){return function(){var b;g._updateRenderingObject(a);for(b in j)j[b].soButton("changeOptions",{isPushed:b===a});g._switchLayoutTo(a),h.soButton("changeOptions",{icon:SO.Utils.getValueFromObj(g._renderingMethod,"icon")}),e(!1,!1),k=a}},SO.Utils.each(this._options.renderingMethods,function(a,c){b={mode:"submenu",icon:c.icon,label:c.label,isPushed:a===k,onClick:d(a)},j[a]=$("<div></div>").soButton(b).addClass("nlui-list-layout-button"),f.append($("<li></li>").append(j[a]))}),c={mode:"default",icon:this._renderingMethod.icon,rightIcon:"ui-icon-triangle-1-s",onClick:function(){"none"===f.css("display")?e(!0):e(!1,!0)}},h=$("<div></div>").soButton(c),h.on("mouseout",function(){"none"!==f.css("display")&&h.addClass("nlui-state-hover")}),h.append(f),a={zone:void 0!==this._$bottomHeader?"br":"tr",size:44,isLong:!1},this._insertHeaderBlock(h,a)},_updateRenderingObject:function(a){var b=this._options.renderingMethods[a];b||(SO.log.warn("Unable to find the rendering method to use ("+a+"). Will default to the first one."),SO.Utils.each(this._options.renderingMethods,function(c,d){return b=d,a=c,!1})),this._renderingMethod=b,this._renderingMethod.key=a,this._saveListSettingsToLocalStorage("listLayout",a)},setRenderingMethod:function(a){""!==a&&this._updateRenderingObject(a)},empty:function(){this._currentItems.length=0,this.setValue(null),this._$list.empty()},_refreshWithData:function(a){if(this._currentItems.length=0,this._$list.empty(),0===a.length&&(!SO.isArray(this._options.additionalItems)||SO.isArray(this._options.additionalItems)&&0===this._options.additionalItems.length)){this.$el.addClass("nlui-tree-list-empty");var b=$(SO.IMG.genIcon("coral-file",48).el).addClass("nlui-list-item-nodata-icon"),c=$("<p></p>").addClass("nlui-list-item-nodata-text").text(this._options.emptyText),d=$('<li class="nlui-list-item-nodata"></li>').append(b).append(c);this._$list.append(d)}else this.$el.removeClass("nlui-tree-list-empty"),this._render(a);this._options.droppable&&this._$list.nlDroppable("makeInsertion"),this._options.layoutManager.rebuildLayout(this.$el)},_switchLayoutTo:function(a){var b,c,d;for(c=[],b=0;this._currentItems.length>b;b++)c.push($.extend(!0,{},this._currentItems[b].source));this._updateRenderingObject(a),this._refreshWithData(c,!0),this._options.pagination&&null!==this._$paginationContainer&&(d=this._$paginationContainer.children().css("display"),this._$paginationContainer.remove(),this._$paginationContainer=null,this._addPagination(),"none"!==d&&this._setLoading(!1))},rebuildLayout:function(){if(null!==this._$body){if(0!==this._options.maxHeight){var a=this._$body.outerHeight(!0)-this._$body.height();this._$body.css({overflow:"auto",height:this._options.maxHeight-a-this._$header.outerHeight(!0)+"px"})}if(this._options.fitToParentHeight){var b=this.$el.css("overflow-y");this.$el.css("overflow-y","hidden");var c,d,e;c=this._$body.outerHeight(!0)-this._$body.height(),e=this._$header?this._$header.outerHeight(!0):0,d=this.$el.height(),this.$el.css("overflow-y",b)}}this._scrollIfNeeded()},_addRefreshButton:function(){var a=this;return this._refreshButton=$("<div></div>").soButton({mode:"default",icon:"nlui-icon-list-refresh",onClick:function(){a.refresh()},help:xtk_core.list_refresh_button_help,helpGravity:"autoNS"}),this._insertHeaderBlock(this._refreshButton,{zone:"tr",size:50,isLong:!1}),this},_insertHeaderBlock:function(a,b){var c=!0,d=SO.Utils.extend({},{zone:"tr",size:0},b);if(b)switch(d.zone){case"tl":SO.Utils.extend(d,{position:"left"});break;case"tr":SO.Utils.extend(d,{position:"right"});break;case"bl":SO.Utils.extend(d,{position:"left"}),c=!1;break;case"br":SO.Utils.extend(d,{position:"right"}),c=!1}else c=void 0===this._$bottomHeader;var e=this._$topHeader;c||(e=this._getBottomHeaderLine()),e.nlLinearLayout("addWidget",a,d)},_addCollapseIcon:function(){var a,b=this;return this._$collapserIcon=$('<span class="nlui-list-head-collapse-icon nlui-icon20">&nbsp;</span>'),this._$collapser=$('<div class="nlui-list-head-collapse"></div>').append(this._$collapserIcon).on("click",function(a){b._toggleListHeaderHandler(a)}).soTooltip({gravity:"n"}).soTooltip("setTitle",xtk_core.list_collapse_header()),"uncollapsed"===this._options.headCollapse?(this._$collapser.data("current-state","uncollapsed"),this._$collapserIcon.addClass("nlui-icon-list-header-collapse")):(this._$collapserIcon.addClass("nlui-icon-list-header-expand"),a=this._$topHeader.outerHeight(!0),a>0&&this._$header.height(a),this._$collapser.soTooltip("setTitle",xtk_core.list_expand_header()),this._$collapser.data("current-state","collapsed")),this._saveListSettingsToLocalStorage("headCollapse",this._options.headCollapse),this._$topHeader.nlLinearLayout("addWidget",this._$collapser,{size:20,isLong:!1,position:"left"})},_toggleListHeaderHandler:function(a){var b;this._$header.css("overflow","hidden"),"uncollapsed"===this._$collapser.data("current-state")?(this._$collapserIcon.removeClass("nlui-icon-list-header-collapse").addClass("nlui-icon-list-header-expand"),this._$collapser.data("current-state","collapsed"),this._saveListSettingsToLocalStorage("headCollapse","collapsed"),this._$bottomHeader&&this._$bottomHeader.hide(),this._$header.height(this._$topHeader.outerHeight(!0)),this._options.layoutManager.rebuildLayout(this.$el),this._$header.css("overflow",""),this._$collapser.soTooltip("setTitle",xtk_core.list_expand_header())):(this._$collapserIcon.removeClass("nlui-icon-list-header-expand").addClass("nlui-icon-list-header-collapse"),this._$collapser.data("current-state","uncollapsed"),this._saveListSettingsToLocalStorage("headCollapse","uncollapsed"),this._$header.css("overflow","hidden"),this._$bottomHeader&&this._$bottomHeader.hide(),this._options.layoutManager.rebuildLayout(this._$header),b=0,void 0!==this._$topHeader&&(b+=this._$topHeader.outerHeight(!0)),void 0!==this._$bottomHeader&&(b+=this._$bottomHeader.outerHeight(!0)),this._$header.height(b),this._$header.css("overflow",""),this._options.layoutManager.rebuildLayout(this.$el),this._$collapser.soTooltip("setTitle",xtk_core.list_collapse_header())),$(a.currentTarget).hasClass("nlui-list-head-collapse")&&(this._$collapser.soTooltip("hide"),this._$collapser.soTooltip("show"))},_visualUnselect:function(){for(var a=0;this._$selectedItems.length>a;a++)this._$selectedItems[a].removeClass("nlui-list-selected");this._$selectedItems=[]},_visualSelect:function(a){a.addClass("nlui-list-selected"),this._$selectedItems.push(a)},_findAndSelect:function(a,b){var c,d,e,f,g,h=0,i=!0,j=this._currentItems,k=this,l=function l(a,b){var c=null;return k._checkSelection(a,b.source)?(c=b,f=b.element.children("ol.nlui-tree-list-sub-element"),("none"===f.css("display")||0===f.length)&&k.toggleSubElement(b.element,!0),0===f.length&&(i=!1)):b.children&&b.children.length>0&&SO.Utils.each(b.children,function(b,d){return c=l(a,d),SO.isNundef(c)?void 0:!1}),c};if(!SO.isNundef(a)){for(e=a.getItems();e.length>h&&i;){for(g=e[h],c=0,d=null;null===d&&j.length>c;)d=l(g,j[c]),c++;h++,null===d?i=!1:e.length>h&&d.children&&(j=d.children)}h===e.length&&null!==d&&(SO.isNundef(d)||(this._currentSelection=new SO.Selection({selectionMode:"mono",items:[d.source]}),this._visualSelect(d.element),this._setSelectionTreePath(d.element),b&&this._addToWaitingScroll(d)))}},_addToWaitingScroll:function(a){this._waitingScrollItem=a},_scrollTo:function(a){var b,c,d,e,f,g,h,i,j,k,l=this;if(this._loading)return this._deferredCallbacks.push(function(){l._scrollTo(a)}),!1;for(g=d=a.element.parents("div.nlui-list-body"),h=a.element.position(),k=g.length>0&&g[0].clientHeight<g[0].scrollHeight,i=0,b=0;this._scrollOffsetElement.length>b;b++)f=this._scrollOffsetElement[b],a.element!==f&&(i+=f.position().top);if(e=h.top+i,e>0){if(!k)for(j=g.parents(),c=0;j.length>c&&(g=$(j[c]),!(k=g.length>0&&g[0].clientHeight<g[0].scrollHeight));c++);if(k)return g[0]!==d[0]&&(e+=d.offset().top),g.animate({scrollTop:e},500),!0}return!1},refresh:function(){var a,b;SO.isNundef(this._currentSelection)||(a=this._currentSelection,null!==a&&(a=a.getItem()),b=a.nodePath.slice(1),this._waitingTreeSelection=b.split("/")),this._currentSearchItems=[],this._itemExpandState={},this._oldItemExpandState={},this._fetchData({refresh:!0,parentKey:null,parentPath:""})},_onItemClick:function(a,b){this.setValue(null),(this._options.selectable||this._options.hideExpandIcon)&&this._isSelectableItem(a)?this._options.selectable&&(this._setSelectedItem(a),this._selectItem(a,b)):this.toggleSubElement(b,!0),this._updateActionStates()},_onItemDoubleClick:function(a,b){(this._options.selectable||this._options.hideExpandIcon)&&this._isSelectableItem(a)&&this._options.selectable&&(this._setSelectedItem(a),this._setSelectionTreePath(b),this._options.onDblClick(this._currentSelection,this._currentSelectionTreePath)),this._updateActionStates()},_checkSelection:function(a,b){var c;return c=a&&b&&this._controller.areKeysEqual(this._jpath,a,b)&&(!a.nodePath||a.nodePath&&a.nodePath===b.nodePath)?!0:!1},_renderItem:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o=this,h=$("<li></li>");if(c&&SO.isFunction(b)){var p=b(o,a,h);SO.isFunction(p.click)&&h.click(p.click),SO.isFunction(p.dblclick)&&h.dblclick(p.dblclick);var q=p.item;h.append(q),d.append(h)}else{var r,s=a+1;r=this._renderingMethod.renderer(b,s,h,this),"string"==typeof r?h.text(r):h.append(r);var t=new SO.Collection.Item(b,h);o._currentItems.push(t),g=this._currentSelection,null!==g&&(g=g.getItem()),this._checkSelection(g,b)&&this._visualSelect(h),h.click(function(a){var c;(void 0===o._previousClickElementRef||o._eventNotSrcEqual(a))&&(c=$(a.srcElement).nlData("clicked-list-item-ref"),SO.isNundef(c)&&(c="clicked-list-item-ref-"+SO.Utils.sequence().nextVal(),$(a.srcElement).nlData("clicked-list-item-ref",c)),o._previousClickElementRef=c,o.stopPropagation(a),o._onItemClick(b,h),setTimeout(function(){o._previousClickElementRef=void 0},1e3))}),h.dblclick(function(a){o._onItemDoubleClick(b,h),o.stopPropagation(a)}),d.append(h)}"grid"!==this._options.layoutType&&(m=d.parent().nlData("item-reference-index"),SO.isNundef(m)&&(m=""),""!==m?(i=this._currentItems.pop(),n=this._getCurrentCollectionItemByItemReference(m,this._currentItems),SO.isArray(n.children)||(n.children=[]),n.children.push(i),i.searchReference=this._addCurrentElementToSearch(i,n.searchReference),m+="_"):(i=this._currentItems[this._currentItems.length-1],i.searchReference=this._addCurrentElementToSearch(i)),h.nlData("item-reference-index",m+a),h.nlData("item-search-index",i.searchReference),h.addClass("nlui-tree-list-item"),e=h.contents(),h.children().remove(),j=$("<ol></ol>"),j.appendTo(h),k=$("<li></li>").addClass("nlui-tree-list-item-contents").appendTo(j),this._isSelectableItem(b)||k.addClass("nlui-tree-list-item-not-selectable"),$(e).addClass("nlui-tree-list-item-label"),k.append(e),k=this._iconRender(b,k),f=$("<span></span>").addClass("nlui-tree-list-icon-container").prependTo(h),b.nodePath&&(l=b.nodePath.lastIndexOf("/"),-1===l?l=0:l++,1===this._waitingTreeSelection.length&&this._waitingTreeSelection[0]===b.nodePath.slice(l)&&(h.addClass("nlui-list-selected"),this._waitingTreeSelection=[],this._selectItem(i.source,i.element),this._setSelectedItem(i.source),void 0!==i&&(this._needToScrollAt=i))),this._displayCurrentChildren(m,a,b,h,f))},_displayCurrentChildren:function(a,b,c,d,e){var f,g,h;g=d.nlData("item-search-index"),void 0===g&&(g=a+b),h=g.split("_"),f=this._jpath,h.length>0&&(f+="["+h.join(",")+"]"),this._controller.hasChildren(f,c)?this._renderItemChildren(d,e,c,b,a):$("<span>&nbsp;</span>").addClass("empty-icon").appendTo(e)},_renderItemChildren:function(a,b,c,d,e){var f,g;this._options.expandAll===!0&&this._options.hideExpandIcon===!0&&a.addClass("nlui-tree-list-hide-icon"),g=this._needToExpandThisElement(c,d,e,a),g?(SO.IMG.genIcon(this._options.subElementOpenedClass,18).addClass(this._closeIconClass).appendTo(b),this._loadSubElement(a,!1),this._setExpandedState(a.nlData("item-search-index"),g)):(c._children_&&c._children_.length>0&&this._createSubElements({data:c._children_},a,!1),SO.IMG.genIcon(this._options.subElementClosedClass,18).addClass(this._closeIconClass).appendTo(b)),f=this,b.on("click",function(a){a.stopPropagation(),f.toggleSubElement($(a.currentTarget).parent(),!0)})},_render:function(a){this._oldItemExpandState=SO.Utils.extend(!0,{},this._itemExpandState);var b,c=this;b=0,$.each(this._options.additionalItems,function(a,d){b++,c._renderItem(a,d,!0,c._$list)}),1===a.length&&(a[0].opened=!0,this._waitingTreeSelection.length>1&&(this._waitingTreeSelection=this._waitingTreeSelection.slice(1))),$.each(a,function(a,d){c._renderItem(a+b,d,!1,c._$list)}),this._options.layoutManager.rebuildLayout(this.$el),this._scrollIfNeeded()},setValue:function(a,b){null===a&&(this._waitingTreeSelection=[],this._currentSelectionTreePath=[]),this._visualUnselect(),this._currentSelection=Array.isArray(a)?new SO.Selection({selectionMode:"mono",items:[a[a.length-1]]}):a instanceof SO.Selection?new SO.Selection({selectionMode:"mono",items:a.getItems()}):new SO.Selection({selectionMode:"mono",items:[a]}),null!==a&&(this._findAndSelect(this._currentSelection,b),this._checkScrollElement())},check:function(a,b){return this._options.strict&&b||!b?this._options.mandatory&&null===this._currentSelection?{message:xtk_core.field_mandatoryErr()}:null:null},_eventNotSrcEqual:function(a){var b=$(a.srcElement).nlData("clicked-list-item-ref");return this._previousClickElementRef!==b},refreshInlineDisplay:function(a){var b,c,d,e,f,g,h;if(SO.isNundef(this._currentSelection)){if(this._waitingTreeSelection.length>0)return h="/"+this._waitingTreeSelection.join("/"),this.loadElementToDisplayInline(h,a),void 0}else if(c=this._currentSelection,null!==c&&(c=c.getItem()),g=c.label,f=!this._options.fillIncompleteObject||this._controller.isItemComplete(this._jpath,c),!(!SO.isNundef(g)&&f||(d=c,SO.isNundef(d)||(b=d.nodePath.split("/"),b=b.slice(1),this._currentItems.length>0&&(e=this._seekElementToSelect(this._currentItems,b),SO.isNundef(e)||(g=e.source.label)),!SO.isNundef(g)&&f||!this._datasourceCaps.getOneElement))))return this.loadElementToDisplayInline(d.nodePath,a),void 0;SO.isNundef(g)?(a.addClass("emptyvalue"),a.html($("<span/>",{html:this._options.emptyText}))):(a.removeClass("emptyvalue"),a.html($("<span/>",{html:g})))},destroy:function(){this._options.layoutManager.unRegisterWidget(this),this._controller.unregisterJpathObserver(this._options.jpath,this)},_setSelectedItem:function(a){this._currentSelection=new SO.Selection({selectionMode:"mono",items:[a]})},_selectItem:function(a,b){this._options.selectable&&(SO.isNundef(a)||this._visualSelect(b),this._currentSelection=new SO.Selection({selectionMode:"mono",items:[a]}),this._setSelectionTreePath(b),this._options.onSelection(new SO.Selection({selectionMode:"mono",items:[a]}),this._currentSelectionTreePath))},onJpathNotify:function(a,b,c,d){var e;switch(a){case"add":e=b.substring(b.indexOf("[")+1,b.indexOf("]")).split(","),this._refreshNodeFromTreePath(e),this.setValue(d.item),this._options.onSelection(d.item,this._currentSelectionTreePath);break;case"cancelAdd":break;case"remove":e=b.substring(b.indexOf("[")+1,b.indexOf("]")).split(","),e=1===e.length?[""]:e.slice(0,-1),this.setValue(null),this._refreshNodeFromTreePath(e);break;case"cancelRemove":break;case"move":break;case"duplicate":break;case"cancelDuplicate":break;case"error":case"value":case"strict":break;case"filter":var f;this._options.search&&d.wildcard&&this._options.searchWildcard===d.wildcard&&(f=""===c?this._currentSearchItems:treeListDataFilter(this._currentSearchItems,{filters:{search:{filter:{value:c}}}}),this._refreshWithData(this._formatSearchData(f)));break;case"loading":break;default:throw"Unknown type in method onJpathNotify: "+a}},_refreshNodeFromTreePath:function(a){var b,c,d,e,f=this;1===a.length&&""===a[0]?this.refresh():(d=this._getCurrentCollectionItemByItemReference(a.join("_"),this._currentItems),e=this._getCurrentCollectionItemByItemReference(a.join("_"),this._currentSearchItems),d.element.children("span.nlui-tree-list-icon-container").remove(),d.element.children("ol.nlui-tree-list-sub-element").remove(),b=$("<span></span>").addClass("nlui-tree-list-icon-container").prependTo(d.element),d.children=[],e.children=[],c={customCallbacks:{},treePath:a.join(","),parentPath:SO.Utils.getValueFromObj(d,["source","nodePath"],""),setBusy:!1},c.customCallbacks.onSuccess=function(c){c.length>0?(void 0===d.source.children&&(d.source.children={}),d.source.children.data=c,f._setExpandedState(a.join("_"),!0),f._oldItemExpandState=SO.Utils.extend(!0,{},f._itemExpandState),f._renderItemChildren(d.element,b,d.source,a[a.length-1],a.join("_"))):(d.source.children&&(d.source.children={}),$("<span>&nbsp;</span>").addClass("empty-icon").appendTo(b))},c.customCallbacks.onError=function(){},c.customCallbacks.onComplete=function(){},this._fetchData(c))},_initRenderingMethod:function(){this._renderingMethod=null;var a=this._options.defaultRendering,b=this._getListSettingsFromLocalStorage("listLayout");if(b&&(a=b),a)this._updateRenderingObject(a);else{SO.log.warn("No default rendering has been provided");var c="";this._options.layoutType&&this._options.layoutSize&&(c=this._options.layoutType+"-"+this._options.layoutSize),this._updateRenderingObject(c)}},_setSelectionTreePath:function(a){this._currentSelectionTreePath=a.nlData("item-search-index").split("_")},_addCurrentElementToSearch:function(a,b){var c,d,e,f,g,h,i;for(g=SO.Utils.extend(!0,{},a),void 0===b?(e=this._currentSearchItems,g.searchReference=""):(i=this._getCurrentCollectionItemByItemReference(b,this._currentSearchItems),SO.isArray(i.children)||(i.children=[]),e=i.children,g.searchReference=b+"_"),d=!1,f=e.length,c=0;!d&&f>c;)h=e[c],this._checkSelection(g.source,h.source)&&(d=!0,g.searchReference=h.searchReference),c++;return d===!1&&(e.push(g),g.searchReference+=e.length-1),g.searchReference},_seekElementToSelect:function(a,b){for(var c,d,e,f=0,g="";a.length>0&&b.length>f;){for(g+="/"+b[f],c=0,d=null;null===d&&a.length>c;)e=a[c],e.source.nodePath===g&&(d=e),c++;f++,null!==d&&(a=d.children),b.length>f&&(this._waitingTreeSelection=b)}return d},_needToExpandThisElement:function(a,b,c,d){var e,f,g=!1;return this._options.expandAll||a.opened===!0?g=!0:(g=this._getOldExpandedState(d.nlData("item-search-index")),f=this._waitingTreeSelection.length,g===!1&&f>1&&(e=a.nodePath.lastIndexOf("/"),-1===e?e=0:e++,this._waitingTreeSelection[0]===a.nodePath.slice(e)&&(g=!0,this._waitingTreeSelection=this._waitingTreeSelection.slice(1),this._scrollOffsetElement.push(d))),g===!1&&null!==this._options.uncollapsedNodePath&&this._options.uncollapsedNodePath.substr(0,a.nodePath.length)===a.nodePath&&((!this._options.selection||this._options.selection.isEmpty())&&this._options.uncollapsedNodePath===a.nodePath&&this._addToWaitingScroll({element:d}),this._scrollOffsetElement.push(d),g=!0)),g},_getCurrentCollectionItemByItemReference:function(a,b){var c,d,e;for(void 0===b&&(b=this._currentItems),e=SO.isNumber(a)?[a]:a.split("_"),d=b[e[0]],c=1;e.length>c&&SO.isArray(d.children)&&d.children.length>0;)d=d.children[e[c]],c++;
return d},_getCurrentElementSourceByItemReference:function(a){var b,c,d;for(d=SO.isNumber(a)?[a]:a.split("_"),c=this._currentItems[d[0]].source,b=1;d.length>b&&SO.isArray(c.children.data)&&c.children.data.length>0;)c=c.children.data[d[b]],b++;return SO.isNundef(c.children)&&(c.children={}),c.children},_getAllElementsSourceByItemReference:function(a){var b,c,d,e;for(c=[],e=SO.isNumber(a)?[a]:a.split("_"),d=this._currentSearchItems[e[0]],c.push(d.source),b=1;e.length>b&&!SO.isNundef(d.children)&&SO.isArray(d.children)&&d.children.length>0;)d=d.children[e[b]],c.push(d.source),b++;return c},_searchExpandedStateObject:function(a,b){var c,d,e,f;for(d=this._getAllElementsSourceByItemReference(a),f=b,c=0;d.length>c;c++){if(e=this._getInteranalStateHash(d[c]),SO.isNundef(f)||SO.isNundef(e)){f=void 0;break}SO.isNundef(f[e])&&(f[e]={expanded:!1}),f=f[e]}return f},_getOldExpandedState:function(a){var b,c;return b=!1,c=this._searchExpandedStateObject(a,this._oldItemExpandState),SO.isNundef(c)||(b=c.expanded),b},_setExpandedState:function(a,b){var c=this._searchExpandedStateObject(a,this._itemExpandState);SO.isNundef(c)||b===!1?c=void 0:c.expanded=b},_getInteranalStateHash:function(a){var b,c,d;if(void 0!==a){b="";for(c in a)a.hasOwnProperty(c)&&"children"!==c&&"_children_"!==c&&(d=a[c],SO.isString(d)||SO.isNumber(d)||SO.isNundef(d)?(SO.isString(d)&&a[c].replace("_","|underscore|"),b+=a[c]+"_"):b+=SO.isBoolean(d)?(a[c]?1:0)+"_":$(a[c]).serialize().replace("_","|underscore|")+"_")}return b},_createSubElements:function(a,b,c){var d,e,f,g;e="nlui-tree-list-sub-element","link"===this._options.layoutType&&(e+=" nlui-tree-list-link"),f=$("<ol></ol>").addClass(e),f.appendTo(b),d=this,!SO.isNundef(a.data)&&a.data.length>0&&$.each(a.data,function(a,b){d._renderItem(a,b,!1,f)}),g=$("<div></div>").addClass("nlui-tree-list-unfold-link-arrow").append($("<div></div>")),b.append(g),c!==!0&&(f.hide(),g.hide())},toggleSubElement:function(a,b){var c,d,e,f;c=this,f=a.children("span.nlui-tree-list-icon-container").children("i"),d=a.children("ol.nlui-tree-list-sub-element"),(f.hasClass(this._closeIconClass)||f.hasClass(this._openIconClass))&&(0===d.length?this._loadSubElement(a,b):(b===!1?(a.children("div.nlui-tree-list-unfold-link-arrow").toggle(),d.toggle({complete:function(){}})):(a.children("div.nlui-tree-list-unfold-link-arrow").toggle(),d.toggle({effect:this._options.toggleEffect,duration:0,complete:function(){}})),e=a.nlData("item-search-index"),f.hasClass(this._closeIconClass)?(a.addClass("nlui-tree-list-item-open"),this._setItemIconTo("open",f),this._setExpandedState(e,!0)):(a.removeClass("nlui-tree-list-item-open"),this._setItemIconTo("close",f),this._setExpandedState(e,!1))))},_loadSubElement:function(a,b){var c,d;c=a.nlData("item-reference-index"),this._setItemIconTo("loading",a.children("span.nlui-tree-list-icon-container").children("span.nlui-icon")),this._hideError(),d=this._getCurrentElementSourceByItemReference(c),SO.isArray(d.data)?(this._onGoingRequest++,this._loadDataCallBack(d,{$container:a,animated:b})):this._loadChildren(d,a,b)},_loadChildren:function(a,b,c){function d(a){e._controller.cancelGetCollection(e._jpath,a.data.currentJob),b.children("span.nlui-tree-list-icon-container").off("click",d)}var e,f,g,h,i,j,h=b.nlData("item-search-index");i=h.split("_"),j=this._getCurrentCollectionItemByItemReference(h,this._currentSearchItems),e=this,this._hideError(),g={customCallbacks:{},treePath:i.join(","),parentPath:SO.Utils.getValueFromObj(j,["source","nodePath"],""),setBusy:!1},g.customCallbacks.onSuccess=function(d){a.data=d,e._loadDataCallBack(a,{$container:b,animated:c})},g.customCallbacks.onError=function(a){e._handleError(a),e._setItemIconTo("close",b.children("span.nlui-tree-list-icon-container").children("span.nlui-icon"))},g.customCallbacks.onComplete=function(){b.children("span.nlui-tree-list-icon-container").off("click",d)},g.currentNode=a,f=this._fetchData(g),b.children("span.nlui-tree-list-icon-container").on("click",{currentJob:f},d)},_loadDataCallBack:function(a,b){this._createSubElements(a,b.$container,!1),this._setItemIconTo("close",b.$container.children("span.nlui-tree-list-icon-container").children("span.nlui-icon")),this.toggleSubElement(b.$container,b.animated),this._scrollIfNeeded(),this._checkScrollElement()},_scrollIfNeeded:function(){void 0!==this._needToScrollAt&&(this._addToWaitingScroll(this._needToScrollAt),this._needToScrollAt=void 0)},_setItemIconTo:function(a,b){switch(a){case"open":b.removeClass("soui-icon-18-"+this._options.subElementClosedClass+" nlui-tree-list-loading-element "+this._closeIconClass).addClass("soui-icon-18-"+this._options.subElementOpenedClass+" "+this._openIconClass);break;case"close":b.removeClass("soui-icon-18-"+this._options.subElementOpenedClass+" nlui-tree-list-loading-element "+this._openIconClass).addClass("soui-icon-18-"+this._options.subElementClosedClass+" "+this._closeIconClass);break;case"loading":b.removeClass("soui-icon-18-"+this._options.subElementOpenedClass+" "+"soui-icon-18-"+this._options.subElementClosedClass+" "+this._openIconClass+" "+this._closeIconClass).addClass("nlui-tree-list-loading-element")}},_iconRender:function(a,b){return a.img&&SO.IMG.genIcon(a.img,18).addClass("nlui-tree-list-item-icon").prependTo(b),b},toggleAdvancedField:function(){this._options.displaySchemaAdvancedFields=!this._options.displaySchemaAdvancedFields,this._refreshWithData(this._formatSearchData(this._currentSearchItems))},_formatSearchData:function(a){var b,c,d,e=[];for(b=0;a.length>b;b++)c=$.extend(!0,{},a[b].source),d=$.extend(!0,[],a[b].children),SO.Utils.count(d)>0&&(c.children=c.children||{},c.children.data=this._formatSearchData(d)),e.push(c);return e},_isSelectableItem:function(a){return!(a.selectable===!1)},loadElementToDisplayInline:function(a,b){var c,d=this;c=this._currentSelection,null!==c&&(c=c.getItem()),void 0!==this._options.beforeAsyncLoad&&this._options.beforeAsyncLoad(),void 0!==this._options.beforeAsyncLoad&&this._options.beforeAsyncLoad(c,null),this._controller.getOneElement(this._jpath,a,{onSuccess:function(a){d._currentSelection=new SO.Selection({selectionMode:"mono",items:[SO.Utils.extend(!0,{},{nodePath:a.nodePath},a)]}),b.removeClass("emptyvalue"),b.html($("<span/>",{html:a.label}))},onComplete:function(){void 0!==d._options.afterAsyncLoad&&d._options.afterAsyncLoad(c,d.check(c,!1),!1)}})}}),$.widget("SO.soTreeList",{_create:function(){this._widget=new SO.Widgets.Treelist(this.element,this.options)},_destroy:function(){this._widget.destroy()},refreshInlineDisplay:function(a){this._widget.refreshInlineDisplay(a)},focusSearchInput:function(){this._widget.focusSearchInput()},setRenderingMethod:function(a){this._widget.setRenderingMethod(a)},empty:function(a){this._widget.empty(a)},rebuildLayout:function(){this._widget.rebuildLayout()},refresh:function(){this._widget.refresh()},check:function(){this._widget.check()},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},onJpathNotify:function(a,b,c,d){this._widget.onJpathNotify(a,b,c,d)},toggleSubElement:function(a,b){this._widget.toggleSubElement(a,b)},toggleAdvancedField:function(){this._widget.toggleAdvancedField()},loadElementToDisplayInline:function(a,b){this._widget.loadElementToDisplayInline(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("BorderInput","ColorInput",{CARDS:SO.Utils.extend({},SO.Widgets.ColorInput.prototype.CARDS,{border:{title:"Border",icon:"coral-strokeWeight",getBody:function(){return this._borderCard.el},refresh:function(){this._refreshBorderCard()}}}),DEFAULT_OPTIONS:{value:new NL.CSS.Border,params:{cards:["border","palette","opacity","details"]}},_createMarkup:function(){var a=this;this._borderCard={},SO.tie(this._borderCard,{tag:"div",cls:"nlui-colorpicker-border-card",cld:[{tag:"div",cls:"nlui-colorpicker-card-header",cld:[{tag:"label",cls:"nlui-colorpicker-card-title",text:xtk_sirocco.colorPicker_border_title()}]},{tag:"div",cls:"nlui-colorpicker-form",cld:[{tag:"div",cls:"nlui-colorpicker-row",cld:[{tag:"span",text:xtk_sirocco.colorPicker_border_weight()},{tag:"div",field:"weightInput"}]},{tag:"div",cls:"nlui-colorpicker-row",cld:[{tag:"span",text:xtk_sirocco.colorPicker_border_style()},{tag:"div",field:"styleInput"}]}]}]}),this._weightInput=new SO.Widgets.NumberInput(this._borderCard.weightInput,{value:this._value.get("borderWidth"),params:{unit:"px",range:{min:0}},onInternalChange:function(b){a._value.set("borderWidth",b),a._options.onInternalChange(a._value)}}),this._styleInput=new SO.Widgets.DropdownInput(this._borderCard.styleInput,{value:this._value.get("borderStyle"),params:{items:[{name:"none",label:xtk_sirocco.colorPicker_border_style_none()},{name:"dotted",label:xtk_sirocco.colorPicker_border_style_dotted()},{name:"dashed",label:xtk_sirocco.colorPicker_border_style_dashed()},{name:"solid",label:xtk_sirocco.colorPicker_border_style_solid()},{name:"double",label:xtk_sirocco.colorPicker_border_style_double()},{name:"groove",label:xtk_sirocco.colorPicker_border_style_groove()},{name:"ridge",label:xtk_sirocco.colorPicker_border_style_ridge()},{name:"inset",label:xtk_sirocco.colorPicker_border_style_inset()},{name:"outset",label:xtk_sirocco.colorPicker_border_style_outset()}]},onInternalChange:function(b){"none"===b?a._value.set("borderWidth",0):0===a._value.get("borderWidth")&&a._value.set("borderWidth",1),a._value.set("borderStyle",b),a._options.onInternalChange(a._value),a._refreshBorderCard()}}),this._super()},_refreshBorderCard:function(){this._weightInput.setValue(this._value.get("borderWidth")),this._styleInput.setValue(this._value.get("borderStyle")),this._weightInput.setDisabled("none"===this._value.get("borderStyle"))},_getFormatedValue:function(a){return new NL.CSS.Border(this._weightInput.getValue(),this._styleInput.getValue(),a)},_getColorFromFormatedValue:function(a){return a.get("borderColor")}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("BackgroundInput","ColorInput",{DEFAULT_OPTIONS:{value:new NL.CSS.Background},_getFormatedValue:function(a){return new NL.CSS.Background(a)},_getColorFromFormatedValue:function(a){return a.get("color")}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("ExprBuilder","Input",{DEFAULT_OPTIONS:{params:{fieldFilters:[],help:null,targetResource:null,mode:"js",prefix:null}},_create:function(){var a=this,b=this._options.metaDataService||new NL.MetaDataService(void 0,{dataSourceType:"metadata"}),c=this._options.functionsListService||new NL.DataSource.FunctionsList({url:"/rest/head/funcList/xtk:merged"});this._controller=new SO.MVC.Controller({model:{fields:[],functions:[]},metamodel:{fields:{type:"tree",elements:{PKey:{type:"string",label:"PKey"},apiName:{type:"string",label:"apiName"},desc:{type:"string",label:"desc"},help:{type:"string",label:"help"},icon:{type:"string",label:"icon"},label:{type:"string",label:"label"},lazyLoaded:{type:"boolean",label:"lazyLoaded"},length:{type:"string",label:"length"},privacy:{type:"number",label:"privacy"},readOnly:{type:"boolean",label:"readOnly"},required:{type:"boolean",label:"required"},resName:{type:"string",label:"resName"},resType:{type:"string",label:"resType"},type:{type:"string",label:"type"},nodePath:{type:"string",label:"nodePath"}},keys:["PKey","apiName","nodePath"],dataSource:new NL.DataSource.MetaDataService({url:this._options.params.targetResource,metaDataService:b})},functions:{type:"tree",elements:{id:{type:"integer",label:"id"},label:{type:"string",label:"label"},output:{type:"string",label:"output"}},keys:["id"],dataSource:c}}}),SO.Utils.each(this._options.params.fieldFilters,function(b,c){a._controller.addFilter("fields",{wildcard:"$"+c})}),this._super()},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents())},_bindEvents:function(){},_createMarkup:function(){var a=this,b=this._options;this.$el.addClass("nlui-exprbuilder nlui-input"),this.$el.empty(),this._view={},SO.tie(this._view,{tag:"div",cld:[{tag:"div",cls:"nlui-exprbuilder-code",field:"$textArea"},{tag:"div",cls:"nlui-exprbuilder-help",field:"$help",appendIf:null!==b.params.help},{tag:"div",cls:"nlui-exprbuilder-bottom-container",field:"$bottomContainer",cld:[{tag:"div",cls:"nlui-exprbuilder-left-container",field:"$leftContainer",cld:[{tag:"div",cls:"nlui-exprbuilder-list-title",text:xtk_core.exprBuilder_fieldsAvailable()},{tag:"div",cls:"nlui-exprbuilder-fieldsTreeList",field:"$fieldsTreelist"}]},{tag:"div",cls:"nlui-exprbuilder-right-container",field:"$rightContainer",cld:[{tag:"div",cls:"nlui-exprbuilder-list-title",text:xtk_core.exprBuilder_functionList()},{tag:"div",cls:"nlui-exprbuilder-functionsTreeList",field:"$functionsTreelist"}]}]}]}),b.params.help&&(this._help=new SO.Widgets.TextFormat(this._view.$help,{value:b.params.help,params:{icon:"coral-infoCircle"}})),this._code=new SO.Widgets.CodeInput(this._view.$textArea,{placeHolder:b.placeHolder,value:a._value,params:{presets:"js"},onInternalChange:function(b){a._value=b,a._options.onInternalChange(b)}}),this.$el.append(this._view.el.children);var c=function(b){return $("<div></div>").append($("<span />").text(b.label),new SO.Widgets.SimpleButton($('<div class="nlui-list-item-extra-button"></div>'),{icon:"coral-jumpToTop",iconSize:18,mode:"quiet",onClick:function(b){b.stopPropagation(),b.preventDefault(),a._addItemHandler()}}).el)};this._fieldsTreelist=new SO.Widgets.Treelist(this._view.$fieldsTreelist,{fitToParentHeight:!0,theme:this._options.theme,controller:this._controller,jpath:"fields",layoutType:"default",selectionMode:"mono",selectable:!0,mode:"default",keyAttributes:["name"],onSelection:function(){"query"===b.params.mode&&a._functionsTreelist.setValue(null)},onDblClick:function(){a._addItemHandler()},defaultRendering:"defaultTreeRender",renderingMethods:{defaultTreeRender:{renderer:c,label:"",icon:"",family:"treeNode"}}}),"query"===b.params.mode?this._functionsTreelist=new SO.Widgets.Treelist(this._view.$functionsTreelist,{refreshButton:!1,fitToParentHeight:!0,theme:this._options.theme,controller:this._controller,jpath:"functions",layoutType:"default",selectionMode:"mono",selectable:!0,mode:"default",keyAttributes:["name"],onSelection:function(){a._fieldsTreelist.setValue(null)},onDblClick:function(){a._addItemHandler()},defaultRendering:"defaultTreeRender",renderingMethods:{defaultTreeRender:{renderer:c,label:"",icon:"",family:"treeNode"}}}):(this._view.$leftContainer.classList.add("nlui-exprbuilder-right-container-full-width"),this._view.$bottomContainer.classList.add("nlui-exprbuilder-functions-hidden"))},_formatFieldNodePath:function(a,b){var c=this._options.params,d=this._options.params.mode;switch(a=c.prefix?c.prefix+a:a.substr(1),d){case"js":a=a.replace(/\//g,".");break;case"query":if(-1!==a.indexOf("/")){var e="/";"attribute"===b&&(e+="@"),e+="$1",a="["+a.replace(/\/([^\/]*)$/,e)+"]"}else"attribute"===b&&(a="@"+a)}return a},_addItemHandler:function(){var a=null,b=null;this._fieldsTreelist.getValue()&&this._fieldsTreelist.getValue().getItem()&&(a="fieldsList",b=this._fieldsTreelist.getValue().getItem(),this._fieldsTreelist.setValue(null)),"query"===this._options.params.mode&&this._functionsTreelist.getValue()&&this._functionsTreelist.getValue().getItem()&&(a="functionsList",b=this._functionsTreelist.getValue().getItem(),this._functionsTreelist.setValue(null)),b&&("fieldsList"===a?this._code.insertAtCaret(this._formatFieldNodePath(b.nodePath,b.metadata)):this._code.insertAtCaret(b.output)),this._code.focus()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("geometryInput","Input",{DEFAULT_OPTIONS:{params:{mode:"semi"}},_create:function(){var a=this,b=this._options;this._checks=[{requirement:function(){return a._state.mandatory},test:function(b){return!a._isValueEmpty(b)},error:{message:xtk_core.field_mandatoryErr()}}],this._state={},this._state.error=b.error,this._state.readOnly=b.readOnly,this._state.disabled=b.disabled,this._state.strict=b.strict,this._state.mandatory=b.mandatory,this._value=b.value,this._$geometryObject=this._options.value||new NL.CSS.Geometry,this._$form=$("<div></div>"),"full"===b.params.mode&&this._$form.append($('<div data-nl-jpath="top"></div>')).append($('<div data-nl-jpath="left"></div>')),this._$form.append($('<div data-nl-jpath="width"></div>')).append($('<div data-nl-jpath="height"></div>')),this._$container=this._$form.appendTo(this.$el),this._$model={top:this._$geometryObject.get("top"),left:this._$geometryObject.get("left"),width:this._$geometryObject.get("width"),height:this._$geometryObject.get("height")},this._$metamodel={top:{label:xtk_core.geometryEdit_top(),type:"number",params:{range:{min:0}}},left:{label:xtk_core.geometryEdit_left(),type:"number",params:{range:{min:0}}},width:{label:xtk_core.geometryEdit_width(),type:"number",params:{range:{min:0}}},height:{label:xtk_core.geometryEdit_height(),type:"number",params:{range:{min:0}}}},this._$controller=new SO.MVC.Controller({model:this._$model,metamodel:this._$metamodel,onValueChanged:function(b,c,d,e){a._$geometryObject.set(b,e),a._options.onInternalChange(a._$geometryObject,a._state.error,a._state.strict)}}),this._$container.nlForm({controller:this._$controller})},_refreshForm:function(){this._$controller.setValue("top",this._$geometryObject.get("top")),this._$controller.setValue("left",this._$geometryObject.get("left")),this._$controller.setValue("width",this._$geometryObject.get("width")),this._$controller.setValue("height",this._$geometryObject.get("height"))},getValue:function(){return this._$geometryObject},setValue:function(a){SO.isNundef(a)&&(a=new NL.CSS.Geometry),this._$geometryObject=a,this._options.onExternalChange(this._state.error,this._state.strict),this._refreshForm()},check:function(a,b){return this._validate(a,b)},_refreshDisplay:function(){},refreshInlineDisplay:function(a){a.empty();var b=this._$geometryObject;SO.isNundef(b)||("full"!==this._options.params.mode?(a.addClass("center"),a.append($("<span></span>",{text:b.get("width"),"class":"label"}),$("<span></span>",{text:"x","class":"separator"}),$("<span></span>",{text:b.get("height"),"class":"label"}))):a.html(b.get("top")+" | "+b.get("left")+" | "+b.get("width")+" | "+b.get("height")))},destroy:function(){}}),$.widget("NL.nlGeometryEdit",{_create:function(){this._widget=new SO.Widgets.geometryInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},refreshInlineDisplay:function(a){this._widget.refreshInlineDisplay(a)},refresh:function(){}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("compactInput","Input",{DEFAULT_OPTIONS:{params:{widget:null,widgetOptions:{fitToParentHeight:!1},flat:!1,onlyButton:!1,buttonOptions:void 0,dialogTitle:"",zoomIcon:"edition",dialogWidth:300,dialogHeight:"auto",dialogMinWidth:150,dialogMinHeight:50,dialogResizable:!1,displayPreviewBackground:!1,allowResetValue:!1,needRebuildOnOpen:!1}},_create:function(){this._state={},this._state.error=this._options.error,this._state.readOnly=this._options.readOnly,this._state.disabled=this._options.disabled,this._state.strict=this._options.strict,this._state.mandatory=this._options.mandatory,this._value=this._getCloneValue(this._options.value);var a=this._computeEmbeddedWidgetOptions();this._$widget=$("<div></div>"),this._$widget[this._options.params.widget](a),this._state.error=this._validate(this._value,!0),this._refreshDisplay(!0),null!==this._state.error&&(this._options.errorDisplay(this._state.error),this._options.onInternalChange(this._value,this._state.error,this._state.strict)),this._options.params.flat||this._options.params.onlyButton||this._$widget[this._options.params.widget]("refreshInlineDisplay",this._$display)},_refreshDisplay:function(a){a&&this._createMarkup(),this._options.params.flat||this._options.params.onlyButton||(this._state.disabled||this._state.readOnly||null===this._state.error?(null===this._state.error&&this.$el.hasClass("nlui-state-error")||this._state.disabled||this._state.readOnly)&&this.$el.removeClass("nlui-state-error"):this.$el.addClass("nlui-state-error"),this._$innerButton.toggle(!this._isValueEmpty(this._value)&&!this._state.readOnly),this._state.readOnly?(this._zoomButton.$el.hide(),this.$el.addClass("nlui-state-readonly")):(this._zoomButton.$el.show(),this.$el.removeClass("nlui-state-readonly")),this._state.disabled?(this.$el.addClass("nlui-state-disabled"),this._$resetButton.addClass("nlui-state-disabled"),this._zoomButton.setDisabled(!0)):(this.$el.removeClass("nlui-state-disabled"),this._$resetButton.removeClass("nlui-state-disabled"),this._zoomButton.setDisabled(!1)))},_createMarkup:function(){var a=this;if(this._$text&&this._$text.remove(),this._options.params.onlyButton){this._$dialog=$();var b=SO.Utils.extend(this._options.params.buttonOptions,{onClick:function(){a._state.readOnly||a._state.disabled||a._openDialog()}});this._$text=$('<div class="nlui-compacteditor-container-onlyButton"></div>'),this._text=new SO.Widgets.SimpleButton(this._$text,b)}else this._options.params.flat?(this._$text=$('<div class="nlui-compacteditor-container-flat"></div>').append(this._$widget),this._$text.append(this._$widget)):(this._$widget.addClass("nlui-compacteditor-widget-in-dialog"),this._$dialog=$(),this._$text=$('<div class="nlui-compacteditor-container"></div>').click(function(){a._state.readOnly||a._state.disabled||a._openDialog()}),this._$display=$('<div class="nlui-compacteditor-display"></div>').click(function(){a._state.readOnly||a._state.disabled||a._openDialog()}),this._$text.append(this._$display),this._options.params.displayPreviewBackground?(this._$displayBackground=$('<div class="nlui-compacteditor-display-background"></div>'),this._$displayBackground.append(this._$display).appendTo(this._$text)):this._$text.append(this._$display),this._zoomButton=new SO.Widgets.SimpleButton(document.createElement("div"),{icon:this._options.params.zoomIcon,mode:"secondary",disabled:this._state.disabled,onClick:function(){a._state.readOnly||a._state.disabled||a._openDialog()}}),this._zoomButton.$el.addClass("nlui-compacteditor-button"),this._$resetButton=$('<div class="ui-icon nlui-icon ui-icon-circle-close nlui-compacteditor-button-delete"></div>'),this._$resetButton.click(function(){a._isValueEmpty(a._value)||a._state.readOnly||a._state.disabled||a._setValue(null)}),this._$innerButton=$('<div class="nlui-compacteditor-inner-button"></div>').append(this._$resetButton),this.$el.addClass("nlui-compacteditor"),this.$el.append(this._zoomButton.$el),this._options.params.allowResetValue&&(this._$text.addClass("allowreset"),this.$el.append(this._$innerButton)));this.$el.append(this._$text)},_computeEmbeddedWidgetOptions:function(){var a=this,b={disabled:this._state.disabled,readOnly:this._state.readOnly,value:this._getCloneValue(this._value),strict:this._state.strict,mandatory:this._state.mandatory,params:this._options.params.widgetOptions};return this._options.params.flat?this._embedListLike()?b.onSelection=function(b,c,d){a._value=null===b?b:b.getItem(),a._options.onInternalChange(a._value,c,d)}:b.onInternalChange=function(b,c,d){a._value=b,a._options.onInternalChange(b,c,d)}:(this._embedListLike()&&(b.onDblClick=function(b){a.closeDialog(),a._setValue(b)}),b.beforeAsyncLoad=function(){a.startSpinner()},b.afterAsyncLoad=function(b,c,d){a.stopSpinner(),a._value=b,a._options.onInternalChange(b,c,d)}),b=SO.Utils.extend({},!0,b,this._options.params.widgetOptions)},_createDialog:function(){var a=this,b=[{text:xtk_core.dialog_cancel(),click:function(){a._revertEmbeddedValue(),a.closeDialog()}},{text:xtk_core.dialog_ok(),mode:"primary",click:function(){a._setValue(a._getCloneValue(a._$widget[a._options.params.widget]("getValue"))),a.closeDialog()}}];this._$dialog=$("<div></div>").appendTo("body").soDialog({autoOpen:!1,modal:!0,buttons:b,noPrimaryFirstButton:!0,resizable:this._options.params.dialogResizable,title:this._options.params.dialogTitle,width:this._options.params.dialogWidth,height:this._options.params.dialogHeight,minWidth:this._options.params.dialogMinWidth,minHeight:this._options.params.dialogMinHeight,cancel:function(){a._revertEmbeddedValue()}}),this._$dialog.soDialog("setContent",this._$widget)},_openDialog:function(){0===this._$dialog.length&&this._createDialog(),this._$dialog.soDialog("open"),this._options.params.needRebuildOnOpen&&this._options.layoutManager.rebuildLayout(this._$dialog.soDialog("getBody"))},closeDialog:function(){this._$dialog.soDialog("close")},startSpinner:function(){this._spinning||(this.setDisabled(!0),this._zoomButton.setIcon("/xtk/img/loading.gif"),this._spinning=!0)},stopSpinner:function(){this.setDisabled(!1),this._zoomButton.setIcon(this._options.params.zoomIcon),this._spinning=!1},setValue:function(a){var b=this._getCloneValue(a);this._$widget[this._options.params.widget]("setValue",b),this._value=a,this._options.params.flat||this._options.params.onlyButton||this._$widget[this._options.params.widget]("refreshInlineDisplay",this._$display),this._state.strict=!0,this._state.error=this._validate(this._value),this._refreshDisplay(!1),this._options.onExternalChange(this._state.error,this._state.strict)},_setValue:function(a){this._state.strict=!0;var b;b=this._embedInput()?this._$widget[this._options.params.widget]("check",a):null,SO.Utils.isEqual(b,this._state.error)||this.setError(b),this._$widget[this._options.params.widget]("setValue",this._getCloneValue(a)),this._value=a,this._options.onInternalChange(this._value,this._state.error,this._state.strict),this._options.params.flat||this._options.params.onlyButton||(this._$widget[this._options.params.widget]("refreshInlineDisplay",this._$display),this.closeDialog()),this._refreshDisplay(!1)},_validate:function(a,b){return this._embedInput()?this._$widget[this._options.params.widget]("check",a,b):null},setReadOnly:function(a){this._state.readOnly=a,this._refreshDisplay(!1),this._embedInput()&&this._$widget[this._options.params.widget]("setReadOnly",a)},setDisabled:function(a){this._state.disabled=a,this._refreshDisplay(!1),this._embedInput()&&this._$widget[this._options.params.widget]("setDisabled",a)},destroy:function(){this._$widget[this.options.params.widget]("destroy"),this._$dialog.remove(),this.$el.children().remove(),this.$el.removeClass("ui-widget nlui-compacteditor")},setStrict:function(a){this._state.strict=a,this._embedInput()&&this._$widget[this._options.params.widget]("setStrict",a);var b=this._state.error,c=this._validate(this._value);SO.Utils.isEqual(b,c)||this.setError(c),this._options.onExternalChange(this._state.error,this._state.strict)},setMandatory:function(a){this._state.mandatory=a,this._embedInput()&&this._$widget[this._options.params.widget]("setMandatory",a);var b=this._state.error,c=this._validate(this._value);SO.Utils.isEqual(b,c)||this.setError(c),this._options.onExternalChange(this._state.error,this._state.strict)},setError:function(a){this._state.error=a,this._embedInput()&&this._$widget[this._options.params.widget]("setError",a),this._options.errorDisplay(this._state.error),this._refreshDisplay(!1)},refreshInlineDisplay:function(){this._$widget[this._options.params.widget]("refreshInlineDisplay",this._$display)},_isValueEmpty:function(a){return SO.isNundef(a)||""===a},_revertEmbeddedValue:function(){this._$widget[this._options.params.widget]("setValue",this._getCloneValue(this._value))},_getCloneValue:function(a){return SO.isNundef(a)?null:SO.isObject(a)?SO.OO.implementsProtocol(a,"Clonable")?a.clone():SO.Utils.extend(!0,{},a):a},_embedInput:function(){return"nlKPI"!==this._options.params.widget&&"soList"!==this._options.params.widget&&"soGrid"!==this._options.params.widget&&"soTreeList"!==this._options.params.widget},_embedListLike:function(){return"soList"===this._options.params.widget||"soTreeList"===this._options.params.widget||"soGrid"===this._options.params.widget}}),$.widget("NL.nlCompactEditor",{_create:function(){this._widget=new SO.Widgets.compactInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},refreshInlineDisplay:function(a){this._widget.refreshInlineDisplay(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("PersonalizedTextInput","Input",{DEFAULT_OPTIONS:{params:{multiLine:!1,placeHolder:"",icon:null,customEditorOptions:{icon:"edition",dialogTitle:"",dialogHeight:"auto",dialogResizable:!1,dialogCommandBarHidden:!0,dialogMode:"fullPage",dialogCloseButton:!0,dialogAdaptable:!1,dialogFullHeight:!0,allowResetValue:!0,needRebuildOnOpen:!1,okButtonLabel:xtk_core.dialog_ok(),cancelButtonLabel:xtk_core.dialog_cancel()},shellOptions:{blackBar:!1,actionBar:{localActions:[],viewConfig:[]},breadcrumb:{collapsed:!0},rail:{padding:!0,collapsed:!0,tabs:[]},navigationRail:{collapsed:!0},canvas:{},footer:!1},singleLineOptions:{minLength:null,maxLength:null,allowNumber:!0},multiLineOptions:{persoBlock:{insertion:!0,edition:!0,deletion:!0},persoField:{insertion:!0,edition:!0,deletion:!0},target:{resource:""}}}},_create:function(){var a=this;return this._customInput=null,this._dialog=null,this._actionBar=null,this._shell=null,this._multiLine=this._options.params.multiLine,this._icon=this._options.icon,this._dialogOpen=!1,this._$multiLineEditorWrapper=$(),this._$toolbarContainer=$(),this._$customInput=$(),this._$singleLineEditor=$(),this._$multiLineEditor=$(),this._$shell=$(),this._$propertiesContainer=$(),this._$globalCommandsContainer=$(),this._$visualCommandsContainer=$(),this._focused=!1,this._checks=[{requirement:function(){return!SO.isNundef(a._value)},test:function(a){return SO.isString(a)},error:{message:xtk_sirocco.inputs_incorrectValueErr()}}],SO.isNundef(this._options.value)&&(this._options.value=""),this._super(),SO.assert(SO.isBoolean(this._multiLine),'Invalid "multiLine" param'),this},_refreshDisplay:function(a){var b=this,c=[];return a&&this._createMarkup(),this.isMultiLine()?(this._state.readOnly?(this.$el.addClass("nlui-personalizedtext-readonly"),this._$customInput.addClass("nlui-state-readonly"),this._$multiLineEditor&&this._$multiLineEditor.is(":nl-nlDCE")&&this._$multiLineEditor.nlDCE("setReadOnly",!0)):(this.$el.removeClass("nlui-personalizedtext-readonly"),this._$customInput.removeClass("nlui-state-readonly"),this._$multiLineEditor&&this._$multiLineEditor.is(":nl-nlDCE")&&this._$multiLineEditor.nlDCE("setReadOnly",!1)),this._state.error?this.$el.addClass("nlui-personalizedtext-error"):this.$el.removeClass("nlui-personalizedtext-error")):(this._state.disabled?(this._$customInput.addClass("nlui-personalizedtext-input-disabled"),this._customInput.setDisabled(!0)):(this._$customInput.removeClass("nlui-personalizedtext-input-disabled"),this._customInput.setDisabled(!1)),this._state.readOnly?(this.$el.addClass("nlui-personalizedtext-readonly"),this._$customInput.addClass("nlui-state-readonly"),this._customInput.setReadOnly(!0)):(this.$el.removeClass("nlui-personalizedtext-readonly"),this._$customInput.removeClass("nlui-state-readonly"),this._customInput.setReadOnly(!1)),this._state.error?this.$el.addClass("nlui-personalizedtext-error"):this.$el.removeClass("nlui-personalizedtext-error")),a&&(this.isMultiLine()?c.push(function(){b._initMultiLineEditor()}):this._$customInput.appendTo(this.$el)),c.push(function(){b._bindEvents()}),this._deferDisplay(c),this},_deferDisplay:function(a){var b,c=this;if(!this.$el.is(":visible"))return setTimeout(function(){c._deferDisplay(a)},0),this;if(SO.isNundef(this._state.error))for(;a.length>0;)b=a.shift(),b.call(this);return this},_createMarkup:function(){var a=this.getValue(),b=SO.isString(a)&&-1!==a.indexOf("nl-dce")?!0:!1,c=this,d={};return this._$customInput&&this._$customInput.remove(),this._$shell&&this._$shell.remove(),this._$actionBar&&this._$actionBar.remove(),this._$globalCommandsContainer&&this._$globalCommandsContainer.empty(),this._$propertiesContainer&&this._$propertiesContainer.empty(),this._$visualCommandsContainer&&this._$visualCommandsContainer.empty(),this._$toolbarContainer&&this._$toolbarContainer.empty(),this._$multiLineEditorWrapper&&this._$multiLineEditorWrapper.remove(),this._actionBar=null,this.$el.addClass("nlui-personalizedtext"),this.isMultiLine()&&this.$el.addClass("flat-mode"),this._$customInput=$('<div class="nlui-personalizedtext-wrapper"></div>'),this.isMultiLine()?this._createMultiLineEditor():(this._createSingleLineEditor(),d=SO.Utils.extend({},this._options.params.customEditorOptions,{mode:b?"div":"input",placeHolder:this._options.params.placeHolder,dialogClose:$.proxy(c._onDialogClose,c),inlineDisplay:$.proxy(c._getInlineContent,c),ok:$.proxy(c._onDialogClickOk,c),cancel:$.proxy(c._onDialogClickCancel,c),injectDialogContent:$.proxy(c._injectDialogContent,c),iconLeft:this._icon,dialogOpen:function(){var a=SO.isNundef(c._dialog);return c._dialog=this,c._dialogOpen=!0,a||(c._dialog.setContent(c._getDialogContent(c.getValue())),c._dialog.toggleCloseButton(!0),c._dialog.hideCommandBar()),c._initMultiLineEditor(),c}}),this._customInput=new SO.Widgets.CustomInput(this._$customInput,{value:this.getValue(),params:d,onInternalChange:function(a){SO.isNundef(a)&&(a=""),c._setValue(a)}})),this},_getDialogContent:function(a){return this._setValue(a),this._customInput.setValue(this.getValue()),this._createMultiLineEditor(),this._$shell},_injectDialogContent:function(a){return this._createMultiLineEditor(),a.append(this._$shell),this._$shell},_getInlineContent:function(){return this._$singleLineEditor.length>0&&this._$singleLineEditor.remove(),this._createSingleLineEditor(),this._$singleLineEditor},_initMultiLineEditor:function(){var a=this,b=SO.Utils.extend(!0,{},this._options.params.multiLineOptions);return 0===this._$multiLineEditor.parent().length&&(this.isMultiLine()?(this._$multiLineEditorWrapper.append(this._actionBar.$el),this._$multiLineEditorWrapper.append(this._$multiLineEditor),this.$el.append(this._$multiLineEditorWrapper)):(this._$multiLineEditorWrapper.append(this._actionBar.$el),this._$multiLineEditorWrapper.append(this._$multiLineEditor),this._$shell().getCanvas().append(this._$multiLineEditorWrapper))),""===b.target.resource&&(b.persoBlock={insertion:!1,edition:!1,deletion:!1},b.persoField={insertion:!1,edition:!1,deletion:!1}),this._$multiLineEditor.nlDCE(SO.Utils.extend(b,{content:this.getValue(),contentType:"text",source:!1,readOnly:this._state.readOnly,globalCommandsContainer:this._$globalCommandsContainer,propertiesContainer:this._$propertiesContainer,visualCommandsContainer:this._$visualCommandsContainer,toolbarContainer:this._$toolbarContainer,onInternalChange:function(b){var c=a.getValue();b!==c&&(a.isMultiLine()?a._setValue(b):(a._dialog.showCommandBar(),a._dialog.toggleCloseButton(!1)))},onTouched:function(){!a.isMultiLine()&&a.isDialogOpen()?(a._dialog.showCommandBar(),a._dialog.toggleCloseButton(!1)):this.onInternalChange(a._$multiLineEditor.nlDCE("getContent"))},onSelectBlock:function(b){!a.isMultiLine()&&b.length>0&&"body"!==b[0].nodeName.toLowerCase()&&a._shell.showRail()}})),this},_onDialogOpen:function(a,b){var c=SO.isNundef(this._dialog);return this._dialog=b,this._dialogOpen=!0,c||(this._dialog.setContent(this._getDialogContent(this.getValue())),this._dialog.toggleCloseButton(!0),this._dialog.hideCommandBar()),this._initMultiLineEditor(),this},_onDialogClose:function(){return this._dialogOpen=!1,this._$shell.remove(),this._shell=null,this._setValue(this._customInput.getValue()),this._bindEvents(),this},_onDialogClickOk:function(){var a=!0,b=this._$multiLineEditor.nlDCE("getContent");return this._customInput.setValue(b),{valid:a,value:b}},_onDialogClickCancel:function(){return this._dialogOpen=!1,this},_bindEvents:function(){var a=this,b=this.$el;return b.on("keyup","input",function(b){13!==b.keyCode&&a._options.onTouched()}),b.on("focus","input",function(){b.addClass("nlui-personalizedtext-focus"),a._focused=!0}),b.on("blur","input",function(){b.removeClass("nlui-personalizedtext-focus"),a._focused=!1}),this},_createSingleLineEditor:function(){this._options.params.singleLineOptions;var a=this.getValue(),b=SO.isString(a)&&-1!==a.indexOf("nl-dce")?!0:!1;return this._$singleLineEditor=$('<div class="nlui-personalizedtext-input-single-line"></div>'),b&&this._$singleLineEditor.html(a).addClass("has-perso"),this},_createMultiLineEditor:function(){var a=SO.Utils.extend(!0,{},this._options.params.shellOptions),b=this._options.params.multiLineOptions;return this._actionBar=new SO.Widgets.GrayBar($('<nav class="nlui-personalizedtext-input-multiline-actionbar"></nav>')),this._$toolbarContainer=$('<div class="nlui-personalizedtext-input-multiline-toolbar"></div>'),this._actionBar.addActionBarContent("globalActions",this._$toolbarContainer),this._$multiLineEditorWrapper=$('<div class="nlui-personalizedtext-input-multiline-wrapper"></div>'),this._$multiLineEditor=$('<div class="nlui-personalizedtext-input-multiline"></div>'),this._$shell=$('<div class="nlui-personalizedtext-shell"></div>'),this._$propertiesContainer=this.isMultiLine()?b.propertiesContainer:$('<div class="nlui-personalizedtext-input-multiline-propertiescontainer"></div>'),this._$globalCommandsContainer=this.isMultiLine()?b.globalCommandsContainer:$('<div class="nlui-personalizedtext-input-multiline-globalcommandscontainer"></div>'),this._$visualCommandsContainer=this.isMultiLine()?b.visualCommandsContainer:$('<div class="nlui-personalizedtext-input-multiline-visualcommandscontainer"></div>'),this.isMultiLine()||(a.canvas.content=this._$multiLineEditorWrapper.append(this._actionBar.$el,this._$multiLineEditor),a.actionBar.localActions.push(this._$globalCommandsContainer),a.actionBar.viewConfig.push(this._$visualCommandsContainer),a.rail.tabs.push({content:this._$propertiesContainer,icon:"content-block-properties",id:"dceSideBarRailTab",label:xtk_sirocco.personalizedText_properties(),selected:!1}),this._shell=new SO.Widgets.Shell(this._$shell,a)),this},isMultiLine:function(){return this._multiLine},isDialogOpen:function(){return this._dialogOpen},_setValue:function(a){if(this._super(a),!this._state.error)if(this.isMultiLine())this.isDialogOpen()&&this._$multiLineEditor.nlDCE("setContent",a);else{var b=SO.isString(a)&&-1!==a.indexOf("nl-dce")?!0:!1;b?this._customInput.setMode("div"):this._customInput.setMode("input"),this._customInput.setValue(a)}return this},setValue:function(a){if(this._super(a),!this._state.error)if(this.isMultiLine())this.isDialogOpen()&&this._$multiLineEditor.nlDCE("setContent",a);else{var b=SO.isString(a)&&-1!==a.indexOf("nl-dce")?!0:!1;b?this._customInput.setMode("div"):this._customInput.setMode("input"),this._customInput.setValue(a)}return this},getValue:function(){return this._super()},setReadOnly:function(a){this._super(a),this.isMultiLine()&&this._$multiLineEditor&&this._$multiLineEditor.is(":nl-nlDCE")&&this._$multiLineEditor.nlDCE("setReadOnly",a)}}),$.widget("NL.nlPersonalizedTextInput",{_create:function(){this._widget=new SO.Widgets.PersonalizedTextInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";var ConfManager;(function(a){var b,c,d=function(b,c,d){this._list=void 0!==d?d.getList():[],this._list=this._list.concat(b);var e,f=c.length;for(e=0;f>e;e++){var g=a.inArray(c[e],this._list);g>=0&&this._list.splice(g,1)}};d.prototype.getList=function(){return this._list},d.prototype.selector=function(){return this._list.join(", ")},d.Html4BlockLevelList=["body","address","blockquote","center","dir","div","dl","fieldset","form",":header","hr","isindex","menu","ol","p","pre","table","ul","dd","dt","li","tbody","td","tfoot","th","thead","tr","button","del","ins","map","object","noframes","noscript","frameset","applet","iframe","script"];var e=new d(d.Html4BlockLevelList,["isindex","noframes","noscript","frameset","applet","iframe","script"]),f=new d(["body","div:not(.nl-dce-selectionExclude)","a","label"],["div"],e);IE&&(f=new d([],["table","tbody","td","tfoot","th","thead","tr"],f));var g=f.selector(),h=new d(["img","input","select","textarea","span.nl-dce-field","span.nl-dce-fragment"],[],f);IE&&(h=new d(["table","tbody","td","tfoot","th","thead","tr"],[],h));var i=h.selector(),j=".nl-dce-field, .nl-dce-fragment",k="a, button, input[type='button'], input[type='submit'], input[type='image']",l="a, abbr, acronym, address, b, blockquote, center, dd, div, dt, em, fieldset, form, :header, i, label, li, p, q, span:not(.nl-dce-field, .nl-dce-fragment), strong, td, th",m=function(a){return a&&0!==a.closest(".nl_toolbar").length},n="nl-dce-todo",o="nl-dce-done",p=["body","head"],q={},r="nl-dce-boundary";b=function(b,c,d,e){this._dceController=b,this.editor=void 0;var f=this,g=!1,h=a.extend({},d,{oninit:function(a){g=!0,f.editor=a,e(a),a.undoManager.onAdd.add(function(a){f.editor&&f._dceController._updateUndoRedoButtons(a.hasUndo(),a.hasRedo())}),a.undoManager.onBeforeAdd.add(function(a,b){b.content=b.content.split(/nl_currentSelectionOver/gi).join(""),b.content=b.content.split(/ class=""/gi).join("")}),a.undoManager.onUndo.add(function(){f._dceController.onUndo()}),a.undoManager.onRedo.add(function(){f._dceController.onRedo()})}});c.tinymce(h),g&&(this.editor=c.tinymce()),this.currentBookmark=null},b.prototype.destroy=function(){this.editor.destroy()},b.prototype.encodeRaw=function(a,b){return tinymce.html.Entities.encodeRaw(a,b)},b.prototype.decode=function(a){return tinymce.html.Entities.decode(a)},b.prototype.getNewId=function(a){return a+String((new Date).getTime())+String(Math.floor(100*Math.random()))},b.prototype.isLoaded=function(){return void 0!==this.editor},b.prototype.select=function(a){return this.editor.$(a)},b.prototype.getWindow=function(){return this.editor.getWin()},b.prototype.getIFrame=function(){return a(this.editor.getContentAreaContainer()).find("iframe").first()},b.prototype.getDocument=function(){return this.editor.getDoc()},b.prototype.save=function(a){return this.editor.save({no_events:!!a})},b.prototype.focus=function(){this.editor.focus()},b.prototype.isDirty=function(){return this.editor.save({no_events:!0}),this.editor.isDirty()},b.prototype.setDirty=function(a){this.editor.isNotDirty=!a},b.prototype.setSelection=function(b){this.editor.selection.select(a(b).get(0))},b.prototype.moveCaretAtEvent=function(b){var c=a(this.getDocument()),d=a(b.target);if(d.is(l)){var e,f,g,h,i=b.originalEvent.pageX-c.scrollLeft(),j=b.originalEvent.pageY-c.scrollTop(),k=[],m=d[0].childNodes.length;for(h=0;m>h;h++)if(e=d[0].childNodes[h],3===e.nodeType){this.setSelection(e),f=this.getClientRects(),g=f.length;var n;for(n=0;g>n;n++)if(i>=f[n].left&&f[n].right>=i&&j>=f[n].top&&f[n].bottom>=j){k.push(e);break}}if(1===k.length){var o=k[0];this.setSelection(d);for(var p,q,r,s=this.editor.selection.getRng().startOffset,t=o.length-1,u=!1,v=NL.XTK.parseInt((t-s)/2)+s,w=200,x=0;w>x&&v!==s&&v!==t;)this.setCursorLocation(o,s),p=this.getClientRects()[0],this.setCursorLocation(o,v),q=this.getClientRects()[0],this.setCursorLocation(o,t),r=this.getClientRects()[0],r.top===p.top&&(u=!0),!u&&q.top!==r.top&&q.bottom>=j||u&&q.left>=i?t=v:s=v,v=NL.XTK.parseInt((t-s)/2)+s,x++;this.setCursorLocation(o,v)}else 0===k.length?SO.log.warn("No container found."):SO.log.warn("This insertion scenario is not handled (multiple text node candidates)")}},b.prototype.clearDirty=function(){return this.editor.clearDirty(),this},b.prototype.setContent=function(b){var c=this;return this.editor.setContent(b),this.select(j).each(function(b,d){c.setBoundaries(a(d))}),this},b.prototype.setSelectionContent=function(a){return this.editor.selection.setContent(a)},b.prototype.addContentToNode=function(a,b,c){this.editor.dom.add(a,b,c)},b.prototype.getSelectionContent=function(a){return a&&this.restoreBookmark(),this.editor.selection.getContent()},b.prototype.getTextSelection=function(a){a&&this.restoreBookmark();var b=this.getSelectionContent(!1);return SO.HTMLUtils.htmlDecode(b)},b.prototype.getSelectionNode=function(a){return a&&this.restoreBookmark(),this.editor.selection.getNode()},b.prototype.replaceSelection=function(b){if(this.editor.selection){var c=a(b).attr("id"),d=!1;SO.isEmpty(c)&&(c=this.getNewId("tmpId"),a(b).attr("id",c),d=!0),this.editor.selection.setContent(a("<div></div>").append(b).html());var e=this.editor.dom.get(c);return this.setSelection(e),d&&e.removeAttribute("id"),IE&&(e.oncontrolselect=function(){return!1}),e}return null},b.prototype.createBookmark=function(a){return"complex"===a?(this._dceController.clearAllBookmarks(),this.editor.selection.getBookmark()):this.editor.selection.getBookmark(2,!1)},b.prototype.storeBookmark=function(){this.currentBookmark=this.createBookmark()},b.prototype.restoreBookmark=function(){this.currentBookmark&&this.moveToBookmark(this.currentBookmark)},b.prototype.discardCurrentBookmark=function(){this.currentBookmark=null},b.prototype.moveToBookmark=function(a){this.isValidBookmark(a)&&this.editor.selection.moveToBookmark(a)},b.prototype.isValidBookmark=function(a){if(SO.isNundef(a))return!1;if(a.start&&SO.isArray(a.start)){for(var b=0;a.start.length>b&&0===a.start[b];)++b;return a.start.length>b}return a.id&&SO.isString(a.id)?a.id.length>0:!1},b.prototype.executeCommand=function(a,b,c){a&&this.editor.execCommand(a,!1,b,c)},b.prototype._postTextEditionBookmarkFix=function(){IE||this.setContentEditable(this.getSelectionNode());var a=this;setTimeout(function(){a.restoreBookmark(),a._dceController.notifyBookmarkChangeAction()},0)},b.prototype.executeEditingCommand=function(a){if(IE)try{this.executeCommand(a)}catch(b){SO.log.debug("Could not execute command"),SO.log.debug(b)}else this.executeCommand(a);this.storeBookmark(),this._postTextEditionBookmarkFix()},b.prototype.setCaret=function(a,b){if("bookmark"===a)this.editor.selection.moveToBookmark(b);else if("start"===a||"end"===a){var c="start"===a;this.editor.selection.collapse(c)}this.storeBookmark(),this._dceController.notifyBookmarkChangeAction()},b.prototype.insertContent=function(a,b){this.executeCommand("mceInsertContent",a,{skip_undo:!!b})},b.prototype.storeDataInElement=function(b,c){c&&a.each(c,function(a,c){b.nlData(a,c)})},b.prototype.insertNode=function(b,c,d,e){var f="";c&&(f=SO.HTMLUtils.htmlEncode(c));var g=this.getNewId(b);d&&d.id&&0===this.select("#"+d.id).length&&(g=d.id);var h=a.extend({},d,{id:g}),i=a("<"+b+">"+f+"</"+b+">");i.attr(h),e&&this.storeDataInElement(i,e);var k=a("<div></div>").append(i).html();this.insertContent(k,i.is(j));var l=this.select("#"+g);return l.is(j)?this.setBoundaries(l):this.registerUndoLevel(),l},b.prototype.setBoundaries=function(b){var c=b.parent().contents(),d=c.index(b),e=a(c.get(d-1)),f=a(c.get(d+1));0!==e.length&&e.hasClass(r)||b.before(a(this.getBoundary("before"))),0!==f.length&&f.hasClass(r)||b.after(a(this.getBoundary("after")))},b.prototype.getBoundary=function(a){return'<span class="'+r+'" data-position="'+a+'">&#8203;</span>'},b.prototype.removeBoundaries=function(a){var b=new RegExp('(<span class="'+r+'"[^>]+>[^<]+</span>)',"gi");return a.replace(b,"")},b.prototype.setTextColor=function(a){this.restoreBookmark(),this.executeCommand("forecolor",a)},b.prototype.setNodeTextColor=function(a,b){this.restoreBookmark();var c=this.createBookmark("complex");this.selectAllText(b),this.storeBookmark(),this.setTextColor(a),this.moveToBookmark(c),this.storeBookmark()},b.prototype.toggleBold=function(){this.restoreBookmark(),this.editor.formatter.toggle("bold"),this.storeBookmark()},b.prototype.toggleItalic=function(){this.restoreBookmark(),this.editor.formatter.toggle("italic"),this.storeBookmark()},b.prototype.toggleUnderline=function(){this.restoreBookmark(),this.editor.formatter.toggle("underline"),this.storeBookmark()},b.prototype.toggleTextAlign=function(a){this.restoreBookmark(),("left"===a||"center"===a||"right"===a)&&(this._dceController._currentSelection.css("text-align")===a?this._dceController._currentSelection.css("text-align",""):this._dceController._currentSelection.css("text-align",a),this.selectAllText(this._dceController._currentSelection),this._dceController.notifyBookmarkChangeAction())},b.prototype.getClientRects=function(){return this.editor.selection.selectedRange.getClientRects()},b.prototype.setCursorLocation=function(a,b){var c=this.editor.selection.setCursorLocation(a,b);return this.storeBookmark(),c},b.prototype.isSelectionEmpty=function(a){a&&this.restoreBookmark();var b=this.editor.selection;return b.isCollapsed()&&""===this.getSelectionContent(!1)},b.prototype.isSelectionCoherentWithNode=function(b){return b&&this.restoreBookmark(),!a(this.getSelectionNode(!1)).is(this.getDocument())},b.prototype.selectText=function(a,b,c){var d=this.editor.dom.createRng();d.setStart(a,b),d.setEnd(a,c),this.editor.selection.setRng(d)},b.prototype.selectAllText=function(b){b&&this.selectText(a(b).get(0),0,a(b).get(0).childNodes.length)},b.prototype.isSelectionFormatted=function(a,b){return a&&this.restoreBookmark(),this.editor.formatter&&this.editor.formatter.match(b)},b.prototype.setFontSize=function(b,c){var d,e,f;c?(e="",f=c):(e=this.getSelectionContent(),f=this.getSelectionNode(!0));var g;if(c||""===e||a.trim(e)===a.trim(a(f).text())||a.trim(a("<span></span>").append(e).text())===a.trim(a(f).text()))a(f).css({fontSize:b}),d=f;else{g=a('<span class="nl-dce-selectionExclude">'+e+"</span>"),g.css({fontSize:b});var h=this.replaceSelection(g);h||a("<div></div>").soMessageBox({type:"error",message:nms_contentEditor.contentEditor_cannotInsertNewFontSizeNode()}),d=h}return d},b.prototype.increaseFontSize=function(b){this.restoreBookmark();var c,d,e,f=this;if(b)c=b,d=SO.HTMLUtils.getFontSizeEquivalents(a(b).css("font-size"));else{if(e=this.getSelectionNode(!0),e&&9===e.nodeType)return;d=SO.HTMLUtils.getFontSizeEquivalents(a(e).css("font-size"))}var g;g="literal"===d.type?this.setFontSize(d.literalInt,c):this.setFontSize(NL.XTK.parseNumber(d[d.type])+1+d.type,c),a(g).children().each(function(a,b){f.increaseFontSize(b)}),g!==c&&this.select(g),this.storeBookmark(),this._postTextEditionBookmarkFix()},b.prototype.decreaseFontSize=function(b){this.restoreBookmark();var c,d,e,f=this;if(b)c=b,d=SO.HTMLUtils.getFontSizeEquivalents(a(b).css("font-size"));else{if(e=this.getSelectionNode(!0),e&&9===e.nodeType)return;d=SO.HTMLUtils.getFontSizeEquivalents(a(e).css("font-size"))}var g;g="literal"===d.type?this.setFontSize(d.literalInt,c):this.setFontSize(NL.XTK.parseNumber(d[d.type])-1+d.type,c),a(g).children().each(function(a,b){f.decreaseFontSize(b)}),g!==c&&this.select(g),this.storeBookmark(),this._postTextEditionBookmarkFix()},b.prototype.hasNotEditableLastChild=function(a){var b,c=a.contents();for(b=c.length-1;b>-1;b--){var d=c[b];if(3===d.nodeType){if(!d.textContent||d.textContent.match(/^\ *$/g))continue;return!1}return IE?"true"===d.contentEditable:"false"===d.contentEditable}return!1},b.prototype.setContentEditable=function(b){var c=this;a(b).get(0).contentEditable=!0,a(b).find(j).each(function(){this.contentEditable=IE?!0:!1,c.hasNotEditableLastChild(b)&&c.addContentToNode(b.get(0),"br")})},b.prototype.stopContentEditable=function(b){var c=a(b);c.is("button")||(c.get(0).contentEditable=!1,c.removeAttr("contentEditable"),c.find(j).each(function(b,c){a(c).contentEditable=!1,a(c).removeAttr("contentEditable")}))},b.prototype.registerUndoLevel=function(){this._dceController._isInhibited("undo")||this.editor.undoManager.add()},b.prototype.clearUndo=function(){this.editor.undoManager.clear()},b.prototype.undo=function(){this.editor.undoManager.undo()},b.prototype.redo=function(){this.editor.undoManager.redo()},b.prototype.hasUndo=function(){return this.editor.undoManager.hasUndo()},b.prototype.hasRedo=function(){return this.editor.undoManager.hasRedo()},b.prototype._moveCaret=function(b,c,d){var e=this.editor,f=e.selection.getSel(),g=e.dom.createRng();return 3!==b.nodeType?(g.selectNodeContents(b),g.collapse(c),f.removeAllRanges(),f.addRange(g),f.collapse(b,d)):(d=c?0:a(b).text().length,g.setStart(b,d),g.setEnd(b,d),g.collapse(!0),f.removeAllRanges(),f.addRange(g),f.collapseToEnd()),this},b.prototype._moveCaretBeforeNode=function(b){var c=b.previousSibling,d=!1,e=0;return c||(c=b.nextSibling,d=!0),c&&a(c).is(j)&&(c=d?c.nextSibling:c.previousSibling),c&&this._moveCaret(c,d,e),this},b.prototype._moveCaretAfterNode=function(b){var c=b.nextSibling,d=!0,e=0;return c||(c=b.previousSibling,d=!1),c&&a(c).is(j)&&(c=c.nextSibling),c&&this._moveCaret(c,d,e),this},b.prototype._handleNonEditableNodeDeletion=function(b){var c,d,e,f,g=a(b),h=!1,i=0;return g.hasClass(r)?(c=g.parent().contents(),"after"===g.attr("data-position")?(e=3,f="prev"):(e=1,f="next"),c.each(function(a,f){return f===b&&a>=e?(d=c.get(a-e),!1):void 0}),this._dceController.getLayoutManager().deleteBlock(g[f]())):g.is(j)&&(c=g.parent().contents(),c.each(function(a,e){return e===b&&a>=2?(d=c.get(a-2),!1):void 0}),this._dceController.getLayoutManager().deleteBlock(g)),d?(this._moveCaret(d,h,i),!0):!1},b.prototype._handleEditableContentDeletion=function(a){a.preventDefault(),this.editor.getDoc().execCommand("Delete",!1,null)},b.prototype.preventStuckCaret=function(b){var c,d,e,f,g,h,i,k,l=b.type,m=b.keyCode,n=this.editor,o=n.selection.getSel(),p=o.anchorNode,q=0;if(!p)return this;if(3===p.nodeType&&(p=p.parentNode&&p.parentNode.classList.contains("nl_currentSelection")?46===m?p.nextSibling:p.parentNode:p.parentNode),c=a(p),d=c.is(j),e=c.hasClass(r),!d&&!e)return 8===m&&"keydown"===l&&this._handleEditableContentDeletion(b),!1;if(-1!==["click","mouseup"].indexOf(l))return this._moveCaretAfterNode(p);if("keydown"===l)switch(m){case 37:case 38:d&&(p=c.prev().get(0)),this._moveCaretBeforeNode(p);break;case 39:case 40:d&&(p=c.next().get(0)),this._moveCaretAfterNode(p);break;case 8:case 46:this._handleNonEditableNodeDeletion(p)&&b.preventDefault()}else if("keypress"===l&&c.hasClass(r)){if(g=n.getDoc(),i=c.attr("data-position"),h="after"===i?p.nextSibling:p.previousSibling,f="after"===i?!0:!1,h){if("br"===h.nodeName.toLowerCase()){switch(i){case"before":k=g.createTextNode(""),a(h).after(k);break;case"after":k=g.createTextNode(""),a(h).before(k)}h=k}}else{switch(i){case"before":k=g.createTextNode(""),c.before(k);break;case"after":k=g.createTextNode(""),c.after(k)}h=k}h&&(b.preventDefault(),this._moveCaret(h,f,q),b.charCode&&this.executeCommand("mceInsertContent",32===b.charCode?"&nbsp;":String.fromCharCode(b.charCode)))}return this},ConfManager=function(){this._configs={}},ConfManager.prototype.setConfig=function(a,b,c){this._configs[a]=this._configs[a]||{},this._configs[a][b]=c},ConfManager.prototype.getConfig=function(a,b){return this._configs[a]?SO.Utils.extend(!0,{},this._configs[a][b]):void 0},c=function(b){var c=a.extend({},{contentEditor:null},b);this.contentEditor=c.contentEditor},c.prototype.insertBlockAt=function(){},c.prototype.deleteBlock=function(b){var c=a(b).prev(),d=a(b).next();c.hasClass(r)&&c.remove(),d.hasClass(r)&&d.remove(),a(b).remove(),this.contentEditor.registerUndoLevel()},c.prototype.duplicateBlock=function(b){var c=a(b),d=c.clone(),e=d.length>0&&-1!==["input","select","textarea"].indexOf(d.get(0).nodeName.toLowerCase()),e=function e(a){return a.length>0&&-1!==["input","select","textarea"].indexOf(a.get(0).nodeName.toLowerCase())};return d.find("*[id], *[name]").each(function(b,c){var d=a(c);d.removeAttr("id"),e(d)&&d.removeAttr("name")}),d.removeAttr("id"),e(d)&&d.removeAttr("name"),c.after(d),d},c.prototype.isTableCompatible=function(){},c.prototype.addRow=function(){},c.prototype.deleteRow=function(){},c.prototype.moveRow=function(){},c.prototype.addColumn=function(){},c.prototype.deleteColumn=function(){},c.prototype.moveColumn=function(){},c.prototype.mergeCells=function(){},c.prototype.splitCells=function(){},c.prototype.generateTable=function(){},a.widget("NL.nlDCE",a.NL.nlWidget,{options:{id:"",propertiesContainer:null,globalCommandsContainer:null,visualCommandsContainer:null,toolbarContainer:null,content:"",contentType:"page",onTouched:null,onInternalChange:null,onHTMLEdition:null,onSourceEdition:null,onSelectBlock:null,onContentLoaded:null,readOnly:!1,source:!1,pageProperties:!1,changeContent:!1,saveAsTemplate:!1,uploadContent:!1,getUploadData:null,pageEditionExtension:[],pageFlagExtension:[],target:{metaDataService:null,namespace:"",name:"",resource:"",label:"",uncollapsedNodePath:""},hyperlinks:{linkTarget:!1,external:!1,landingPage:!1,pURL:!1,navigationActions:!1,subscription:!1,unsubscription:!1},hasPreviousAction:!1,hasNextAction:!1,form:{button:{navigationActions:!1},subscription:!1,bindingStorage:{xpath:!1}},formatting:{text:!1,block:!1},layout:{block:!1},localization:{enabled:!1,languages:[]},conditionalVisibility:{enabled:!1,help:""},image:{insertion:!1,edition:!1,deletion:!1},persoField:{insertion:!1,edition:!1,deletion:!1},persoBlock:{insertion:!1,edition:!1,deletion:!1,contentType:""},elementTitle:!1},_initConfAccessor:function(){var a=this;this.confAccessor=new ConfManager,this.confAccessor.setConfig("list","fieldWithoutCalculated",{controller:new SO.MVC.Controller({metamodel:{fields:{type:"tree",elements:{nodePath:{type:"string"},label:{type:"string"},type:{type:"string"},hasEnumeration:{type:"boolean"},enumeration:{type:"enum"}},keys:["nodePath"],dataSource:new NL.DataSource.MetaDataService({url:this.options.target.resource,metaDataService:this.options.target.metaDataService})}},model:{fields:[]},statemodel:{}}),configManager:this.options.configManager,jpath:"fields",fillIncompleteObject:!0,renderingMethods:{"default":{family:"treeNode",label:"",icon:"",renderer:function(a,b,c){var d=a.thumbnail;return d||(d=""),NL.RenderFunctions.iconLabel({label:a.label,icon:d},b,c)}}},defaultRendering:"default",confId:"DCEFieldWithout",selectable:!0,selectionMode:"mono",title:nms_contentEditor.plugin_title_Field(),searchWildcard:"text",uncollapsedNodePath:this.options.target.uncollapsedNodePath}),this.confAccessor.setConfig("list","fieldWithCalculated",{controller:new SO.MVC.Controller({metamodel:{fields:{type:"tree",elements:{nodePath:{type:"string"},label:{type:"string"},type:{type:"string"},hasEnumeration:{type:"boolean"},enumeration:{type:"enum"}},keys:["nodePath"],dataSource:new NL.DataSource.MetaDataService({url:this.options.target.resource,metaDataService:this.options.target.metaDataService})}},model:{fields:[]},statemodel:{}}),jpath:"fields",configManager:this.options.configManager,fillIncompleteObject:!0,renderingMethods:{"default":{family:"treeNode",label:"",icon:"",renderer:function(a,b,c){var d=a.thumbnail;return d||(d=""),NL.RenderFunctions.iconLabel({label:a.label,icon:d},b,c)}}},defaultRendering:"default",confId:"DCEFieldWith",selectable:!0,selectionMode:"mono",title:nms_contentEditor.plugin_title_Field(),searchWildcard:"text",uncollapsedNodePath:this.options.target.uncollapsedNodePath});var b=new SO.MVC.Controller({metamodel:{templates:{type:"list",elements:{name:{type:"string"},title:{type:"string"},label:{type:"string"}},keys:["name"],dataSource:new NL.DataSource.Rest({url:"/rest/head/contentModelBase",filterNames:["byText","byContentType"]})}},model:{templates:[]},statemodel:{}});b.addFilter("templates",{wildcard:"contentType",value:this.options.persoBlock.contentType}),b.addSort("templates",{expr:"title",desc:!1,id:"templatesSort"}),this.confAccessor.setConfig("list","contentModel",{controller:b,jpath:"templates",configManager:this.options.configManager,renderingMethods:{"default":{family:"card",label:xtk_core.list_layout_card(),icon:"coral-viewCard",renderer:function(a,b,c){var d=a.thumbnail;return d||(d="/nms/img/contentModels/miniatures/default.png"),NL.RenderFunctions.detailedCard({label:a.title,image:d,description:a.description},b,c)}}},defaultRendering:"default",confId:"DCENewContent",selectable:!0,selectionMode:"mono",title:nms_contentEditor.template_availableModels(),searchWildcard:"text",additionalItems:[function(b,c,d){var e=b._options.renderingMethods[b._options.defaultRendering].renderer({id:0,name:"dceUploadFile",label:nms_contentEditor.template_contentNotSettedLink(),title:nms_contentEditor.template_contentNotSettedLink(),thumbnail:"/nms/img/contentModels/miniatures/downloadContent.png"},c,d,b);return{item:e,click:function(){a.options.beforeUpload(function(){a.launchZIPUpload()})}}}],fitToParentHeight:!0});var c=new SO.MVC.Controller({metamodel:{contentFragments:{type:"list",elements:{name:{type:"string"},title:{type:"string"},label:{type:"string",label:nms_contentEditor.plugin_title_ContentFragment()}},keys:["name"],dataSource:new NL.DataSource.Rest({url:"/rest/head/contentFragmentBase",filterNames:["byText","byContentType"]})}},model:{contentFragments:[]},statemodel:{}});c.addFilter("contentFragments",{wildcard:"contentType",value:this.options.persoBlock.contentType}),c.addSort("contentFragments",{expr:"title",desc:!1,id:"contentFragmentsSort"}),this.confAccessor.setConfig("list","contentFragment",{controller:c,jpath:"contentFragments",configManager:this.options.configManager,actions:{global:{switchLayout:!1,count:!0},search:{enable:!0,wildcard:"text"}},metaDataUrl:"/rest/head/resourceType/contentFragmentBase",renderingMethods:{grid:{family:"grid",label:xtk_core.list_layout_grid(),icon:"coral-viewList",columns:[{name:"title",label:nms_contentEditor.media_personalizationBloc_label()}]}},displayColumnsHeader:!0,defaultRendering:"grid",confId:"DCEContentFragment",selectable:!0,selectionMode:"mono",title:nms_contentEditor.plugin_title_ContentFragment(),searchWildcard:"text",pagination:{perPage:50}});var d=new SO.MVC.Controller({metamodel:{landingPage:{type:"list",elements:{name:{type:"string"},title:{type:"string"},type:{type:"enum",params:{items:[{label:nms_contentEditor.plugin_hyperLinkEdit_Type_generic(),name:"generic"},{label:nms_contentEditor.plugin_hyperLinkEdit_Type_acquisition(),name:"acquisition"},{label:nms_contentEditor.plugin_hyperLinkEdit_Type_subscription(),name:"subscription"},{label:nms_contentEditor.plugin_hyperLinkEdit_Type_unsubscription(),name:"unsubscription"},{label:nms_contentEditor.plugin_hyperLinkEdit_Type_blackList(),name:"blackList"}]}},service:{type:"link",elements:{title:{type:"string"}}}},keys:["name"],dataSource:new NL.DataSource.Rest({url:"/rest/head/landingPageBase",filterNames:["byText","noDynamicService"]})}},model:{landingPage:[]},statemodel:{}});d.addSort("landingPage",{expr:"title",desc:!1,id:"landingPageSort"}),this.confAccessor.setConfig("list","landingPage",{controller:d,actions:{global:{switchLayout:!0,count:!0},search:{enable:!0,wildcard:"text"}},metaDataUrl:"/rest/head/resourceType/landingPageBase",configManager:this.options.configManager,jpath:"landingPage",renderingMethods:{"default":{family:"card",label:xtk_core.list_layout_card(),icon:"coral-viewCard",renderer:function(a,b,c){return NL.RenderFunctions.detailedCard({label:a.title,image:a.thumbnail,description:a.description},b,c)}},grid:{family:"grid",label:xtk_core.list_layout_grid(),icon:"coral-viewList",columns:[{name:"title",label:nms_contentEditor.plugin_hyperLinkEdit_LandingPage()},{name:"type",label:nms_contentEditor.plugin_hyperLinkEdit_Type()},{name:"service/title",label:nms_contentEditor.plugin_hyperLinkEdit_Service()}]}},displayColumnsHeader:!0,defaultRendering:"default",confId:"DCELandingPage",selectable:!0,selectionMode:"mono",title:nms_contentEditor.plugin_hyperLinkEdit_LandingPage(),searchWildcard:"text",pagination:{perPage:50}});var e=new SO.MVC.Controller({metamodel:{service:{type:"list",elements:{name:{type:"string"},title:{type:"string"},label:{type:"string"}},keys:["name"],dataSource:new NL.DataSource.Rest({url:"/rest/head/serviceBase",filterNames:["byText"]})}},model:{service:[]},statemodel:{}});e.addSort("service",{expr:"title",desc:!1,id:"serviceSort"}),this.confAccessor.setConfig("list","subscription",{controller:e,jpath:"service",configManager:this.options.configManager,actions:{global:{switchLayout:!0,count:!0},search:{enable:!0,wildcard:"text"}},metaDataUrl:"/rest/head/resourceType/serviceBase",renderingMethods:{"default":{family:"card",label:xtk_core.list_layout_card(),icon:"coral-viewCard",renderer:function(a,b,c){return NL.RenderFunctions.detailedCard({label:a.title,image:a.thumbnail,description:a.description},b,c)}},grid:{family:"grid",label:xtk_core.list_layout_grid(),icon:"coral-viewList",columns:[{name:"title",label:nms_contentEditor.plugin_hyperLinkEdit_serviceChoice()}]}},displayColumnsHeader:!0,defaultRendering:"default",confId:"DCEService",selectable:!0,selectionMode:"mono",title:nms_contentEditor.plugin_formBinding_service(),searchWildcard:"text",pagination:{perPage:50}}),this.confAccessor.setConfig("list","validPUrl",{controller:new SO.MVC.Controller({metamodel:{purl:{type:"list",elements:{name:{type:"string"},title:{type:"string"},label:{type:"string"}},keys:["name"],dataSource:new NL.DataSource.Rest({url:"/rest/head/purlBase",filterNames:["byText","publishedByDates"]})}},model:{purl:[]},statemodel:{}}),jpath:"purl",configManager:this.options.configManager,filters:[{wildcard:"startDate",value:""},{wildcard:"endDate",value:""}],renderingMethods:{"default":{family:"line",label:"",icon:"",renderer:function(a,b,c){var d=a.icon;return d||(d=""),NL.RenderFunctions.iconLabel({label:a.title,icon:d},b,c)}}},defaultRendering:"default",confId:"DCEValidPurl",selectable:!0,selectionMode:"mono",title:nms_contentEditor.plugin_hyperLinkEdit_PUrl(),searchWildcard:"text",pagination:{perPage:50}})},_initInstancePrivateVariables:function(){this.MIN_EDITOR_HEIGHT=320,this.ACTIONBAR_HEIGHT=44,this.OUTLINE_WIDTH=3,this._initConfAccessor(),this._contentEditor=null,this._layoutManager=null,this._sourceEditor=null,this._plugins={},this._sideBarSections={},this._actionHandlers={},this._$flagToolbar=void 0,this._flagCommands=[],this._currentSelection=null,this._startElement=null,this._currentState="",this._isDirty=!1,this._inhibitorTokens={dirty:null,focus:null,undo:null},this._inhibitorCount=0,this._editionState="",this._contentSynchronized=!1,this._serverUrl=window.location.protocol+"//"+window.location.host,this._cssPath="/nl/core/dce/contentEditor_inner.css",this._cssOnPath="/nl/core/dce/contentEditor_inner_on.css",this._contentSetted=!1,this._numberOfContentSetted=0,this._emptyContent=!0,this._contentBodyClass="",this._resourcesToLoad={},this._preLoadedContent=null,this._uploadingType="",this._zipUploadDone=!1,this._zipUploadTreatmentJob=null,this._$dialogTemplateList=null,this._$waitDialog=null,this._$sourceHTMLEditorTab=a('<div class="nlui-dce-sourceMode" style="display:none;"></div>'),this._$HTMLEditorRawContent=a("<textarea></textarea>"),this._$HTMLEditorCenterPanel=a('<div class="nlui-dce-workspaceContainer nlui-dce-editionMode nlui-dce-sourceMode"></div>'),this._$fullHTMLEditorTab=a('<div class="nlui-dce-editionMode nlui-dce-htmlWorkspace" style="display:none;"></div>'),this._$fullHtmlEditor=a("<textarea></textarea>"),this._$HTMLEditorMediaLibrary=a("<div></div>"),this._$HTMLEditorPropertiesTabs=a("<div></div>"),this._$pageEdition=a("<div></div>"),this._$pleaseSelectBlock=a('<div class="nlui-dce-pleaseSelectBlock" style="display:none;"></div>'),this._$HTMLEditorPropertiesPanel=a("<div></div>"),this._$templateCarousel=a('<div class="nlui-dce-templateCarousel nlui-dce-templateMode ui-corner-all"></div>'),this._$templateCarouselListContainer=a('<div class="nlui-dce-templateCarouselListContainer"></div>'),this._$models=a('<div class="nlui-dce-models"></div>'),this._$templateCarouselButtonContainer=a('<div class="nlui-dce-templateCarouselButtonContainer"></div>'),this._$templateValidation=a("<div></div>")},_create:function(){SO.assert(this.element&&this.element.closest("body").length>0,"The DCE widget must be instantiated in the DOM."),SO.assert(this.options.propertiesContainer&&this.options.globalCommandsContainer&&this.options.visualCommandsContainer,"Containers must be given to display sidebar features and global commands."),SO.assert("page"===this.options.contentType||"fragment"===this.options.contentType||"text"===this.options.contentType,'Content type must be "fragment" or "page".'),SO.assert("text"!==this.options.contentType||!SO.isNundef(this.options.toolbarContainer),"Container must be given to display the widget's toolbar"),this._initInstancePrivateVariables();var b=this;if(this.options.id||(this.options.id=SO.Utils.sequence().nextVal()),this.editorId="editor_"+this.options.id,this.element.addClass("nlui-dce"),this.isReadOnly()){var c=a("<div />").addClass("nlui-dce-readonly");a(SO.IMG.genIcon("coral-lockOn",24).el).appendTo(c),this.element.prepend(c)}this._$sourceHTMLEditorTab.append(this._$HTMLEditorRawContent),this._$HTMLEditorCenterPanel.append(this._$sourceHTMLEditorTab,this._$fullHTMLEditorTab.append(this._$fullHtmlEditor)),this._$fullHtmlEditor.attr("id",this.editorId),this._$HTMLEditorPropertiesTabs.append(this._$pleaseSelectBlock.text(nms_contentEditor.pleaseSelectBlock()),this._$HTMLEditorPropertiesPanel),this.options.propertiesContainer&&this.options.propertiesContainer.append(this._$HTMLEditorPropertiesTabs),this._$templateCarouselListContainer.append(this._$models),this._$templateCarouselButtonContainer.append(a('<div  style="width: 100%;margin-top: 10px;padding-top: 6px;"></div>').append(this._$templateValidation)),this._$templateCarousel.append(this._$templateCarouselListContainer,this._$templateCarouselButtonContainer),this.element.append(this._$HTMLEditorCenterPanel,this._$templateCarousel);var d=this.getConfManager().getConfig("list","contentModel");d&&this._$models.soList(a.extend({},d,{onDblClick:function(){b.templateCarouselValidation()},onSelection:function(){b._$templateValidation.soSimpleButton("setDisabled",!1)}})),this._$templateValidation.soSimpleButton({mode:"primary",label:nms_contentEditor.template_useSelected(),disabled:!0,onClick:function(){b.templateCarouselValidation()}}).css("float","right"),this.checkReadOnly(),this._$pageEdition.nlPageEdition({dceWidget:this,configManager:this.options.configManager,displayProperties:"page"===this.options.contentType&&this.options.pageProperties,displaySource:this.options.source,displayChangeContent:this.options.changeContent,displaySaveTemplate:this.options.saveAsTemplate,displayUpload:this.options.uploadContent,pageEditionExtension:this.options.pageEditionExtension,leftContainer:this.options.globalCommandsContainer,rightContainer:this.options.visualCommandsContainer}),this.init(),this.options.layoutManager.registerWidget(this),this.options.popableManager.addPopable(this)},isOwnerOf:function(a){return SO.DOMUtils.isDescendantOf(a,this.element)||SO.DOMUtils.isDescendantOf(a,this.getContentElement("html"))||SO.DOMUtils.isDescendantOf(a,".nl-dce-dialog")||SO.DOMUtils.isDescendantOf(a,".nlui-tooltip")||SO.DOMUtils.isDescendantOf(a,"[class^=nlui-dce-pageEdition]")||!SO.isNundef(this.options.toolbarContainer)&&SO.DOMUtils.isDescendantOf(a,this.options.toolbarContainer)},collapse:function(){if(!this.hasResourcesToLoad()){var a=this._startInhibitor("focus"),b=this._startInhibitor("undo");this.setDirty(this.isDirty(),this._contentSynchronized),this._stopInhibitor("undo",b),this._stopInhibitor("focus",a)}},rebuildLayout:function(){return this.iframeResize(),!1},destroy:function(){this._contentEditor&&this._contentEditor.isLoaded()&&this._contentEditor.destroy(),this._$pageEdition&&this._$pageEdition.is(":nl-nlPageEdition")&&(this._$pageEdition.nlPageEdition("destroy"),this._$pageEdition.remove()),this.element.is(":nl-nlEditBox")&&this.element.nlEditBox("destroy"),this._$dialogTemplateList&&this._$dialogTemplateList.is(":nl-nlListInDialog")&&(this._$dialogTemplateList.nlListInDialog("destroy"),this._$dialogTemplateList.remove()),this._$flagToolbar&&this._$flagToolbar.is(":nl-nlFloatToolbar")&&(this._$flagToolbar.nlFloatToolbar("destroy"),this._$flagToolbar.remove()),this.options.propertiesContainer&&this._$HTMLEditorPropertiesTabs&&this._$HTMLEditorPropertiesTabs.remove(),this.options.popableManager.removePopable(this)
},_startInhibitor:function(a){var b="inhib_"+a+"_"+this._inhibitorCount++;return null===this._inhibitorTokens[a]&&(this._inhibitorTokens[a]=b),b},_stopInhibitor:function(a,b){SO.assert(a,"A type must be provided to stop inhibition"),SO.assert(b,"A token must be provided to stop inhibition"),b===this._inhibitorTokens[a]&&(this._inhibitorTokens[a]=null)},_isInhibited:function(a){return null!==this._inhibitorTokens[a]},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments),"content"===b&&(this.resetContent(),this.setContent(c)),"readOnly"===b&&this.checkReadOnly(!1),"pageFlagExtension"===b&&this.updateFlagToolbar(),this.updatePluginConfig(),this.updateMessageBox()},_getClassFromBody:function(a){var b=new RegExp(".*<body[^>]*class=(?:(?:\"([^\"]*)\")|(?:'([^']*)')|([^ ]*)).*>"),c=b.exec(a.toLowerCase());return c&&4===c.length?c[1]||c[2]||c[3]:""},setDialogTemplateList:function(a){this._$dialogTemplateList=a},getDialogTemplateList:function(){return this._$dialogTemplateList},getUploadingType:function(){return this._uploadingType},setUploadingType:function(a){this._uploadingType=a},getContentEditor:function(){return this._contentEditor},getLayoutManager:function(){return this._layoutManager},getCurrentSelection:function(){return this._currentSelection},templateCarouselValidation:function(){var a=this._$models.soList("getValue"),b=a.getItem();if(b){var c=b.name;"dceUploadFile"===c?(this.launchZIPUpload(),this.element.nlInterceptor("close")):(this.loadFromTemplate(b.PKey),this.element.nlInterceptor("close"))}},onContentEditorInit:function(){this.loadedResource("contentEditorAsync");var b=this;if(this.setContent(b.options.content),a(window).on("resize",function(){b.iframeResize(),b.sourceFrameResize()}),this.iframeResize(),!IE)try{this._contentEditor.getDocument().execCommand("insertBrOnReturn",!1,!0)}catch(c){}},patchContentEditorContent:function(){var b=this;if("page"===this.options.contentType&&this.getContentElement("head").length>0){var c={};a(this._$fullHtmlEditor.val()).filter("link, meta, style").each(function(){var d=a(this).attr("media"),e=!0;d&&(c.hasOwnProperty(d)||(c[d]=IsMediaType(d)),e=c[d]);var f=this.nodeName.toUpperCase();("META"===f||"STYLE"===f||e)&&b.getContentElement("head").append(this)}),this.getContentElement("body").addClass(this._contentBodyClass)}},_stopHoverSelection:function(){this.getContentElement(".nl_currentSelectionOver").removeClass("nl_currentSelectionOver")},deselectAll:function(b){this._currentSelection?("edition"===this._currentState&&"text"===this._editionState&&this.notifyTextEditionEnd(this._currentSelection),this._contentEditor.isLoaded()&&(this._contentEditor.stopContentEditable(this._currentSelection),this._contentEditor.discardCurrentBookmark()),this.element.is(":nl-nlEditBox")&&this.element.nlEditBox("stop"),this.notifyDeselect(this._currentSelection),this._currentSelection.removeClass("nl_currentEditing nl_currentSelection"),this._currentSelection=null,this._editionState=""):(this.element.is(":nl-nlEditBox")&&this.element.nlEditBox("stop"),this.getContentElement(".nl_currentEditing").removeClass("nl_currentEditing"),this.getContentElement(".nl_currentSelection").removeClass("nl_currentSelection"),this.getContentElement('[contentEditable="true"]').each(function(b,c){c.contentEditable=!1,a(c).removeAttr("contentEditable")})),IE||this.clearBrowserSelection(),this.notifyFocusOn(null),b&&this.selectPage(),this._$pleaseSelectBlock.show()},setCurrentState:function(b){var c=this._currentState;this.checkReadOnly(!c||c===b);var d=a(this.element),e=a(".nlui-dce-editionMode",d),f=a(".nlui-dce-templateMode",d),g=a(".nlui-dce-sourceMode",d);if("string"==typeof b){switch("edition"!==b&&this.deselectAll("template"===b&&!this._emptyContent),this._currentState=b,"edition"!==b&&(this._editionState=""),c!==b&&(e.hide(),f.hide(),g.hide()),b){case"edition":this.updateMessageBox(),this.iframeResize(),a(this.element).is(":nl-nlInterceptor")&&a(this.element).nlInterceptor("close"),this._$dialogTemplateList&&this._$dialogTemplateList.is(":nl-nlListInDialog")&&this._$dialogTemplateList.nlListInDialog("closeDialog"),e.show(),this.options.onHTMLEdition&&this.options.onHTMLEdition(),this._$pageEdition.nlPageEdition("updateCommandState",{undo:{hidden:!1},redo:{hidden:!1},pageEditionChangeContent:{hidden:!1},pageEditionUpload:{hidden:!1},pageEditionSaveTemplate:{hidden:!1},pageEditionPageProperties:{hidden:!1},pageEditionMessages:{hidden:!1},pageEditionMarking:{hidden:!1},pageEditionSource:{hidden:!1}});break;case"template":this.updateMessageBox(),f.show(),this._emptyContent?(a(this.element).is(":nl-nlInterceptor")?a(this.element).nlInterceptor("open"):a(this.element).nlInterceptor({hoveringElement:this._$templateCarousel,containHovering:!0,centerOver:this._$HTMLEditorCenterPanel,autoOpen:!0}),this._$models.soList("rebuildLayout")):this._$templateCarousel.hide(),this._$pageEdition.nlPageEdition("updateCommandState",{undo:{hidden:!0},redo:{hidden:!0},pageEditionChangeContent:{hidden:!0},pageEditionUpload:{hidden:!0},pageEditionSaveTemplate:{hidden:!0},pageEditionPageProperties:{hidden:!0},pageEditionMessages:{hidden:!0},pageEditionMarking:{hidden:!0},pageEditionSource:{hidden:!1}});break;case"source":this.updateMessageBox(),g.show(),this.iframeResize(),a(this.element).is(":nl-nlInterceptor")&&a(this.element).nlInterceptor("close"),this.options.onSourceEdition&&this.options.onSourceEdition(),this._$pageEdition.nlPageEdition("updateCommandState",{undo:{hidden:!0},redo:{hidden:!0},pageEditionChangeContent:{hidden:!0},pageEditionUpload:{hidden:!0},pageEditionSaveTemplate:{hidden:!0},pageEditionPageProperties:{hidden:!0},pageEditionMessages:{hidden:!0},pageEditionMarking:{hidden:!0},pageEditionSource:{hidden:!1}});break;default:this.updateMessageBox(),e.show()}b!==c&&SO.Widgets.LayoutManager.rebuildLayout()}},toggleMarkingCallback:function(a){"active"===a?this.getContentElement("head").append('<link rel="stylesheet" href="'+this._cssOnPath+'" type="text/css" />'):this.getContentElement('link[href="'+this._cssOnPath+'"]').remove()},initSourceEditor:function(){var a=this;this._sourceEditor=CodeMirror.fromTextArea(this._$HTMLEditorRawContent.get(0),{mode:"text/html",tabMode:"indent",lineNumbers:!0,lineWrapping:!0,readOnly:this.isReadOnly()}),this._sourceEditor.on("change",function(){a._isInhibited("dirty")||a.isReadOnly()||a.setDirty(!0)})},getSourceEditor:function(){return this._sourceEditor||this.initSourceEditor(),this._sourceEditor},updateFullHTMLEditorTab:function(){var a=this.getSourceEditor();this.resetContent(),this.setContent(a.getValue())},updateSourceHTMLEditorTab:function(){var a=this.getSourceEditor(),b=this.getContent(!0),c=this._startInhibitor("dirty");a.setValue(b),this._stopInhibitor("dirty",c),a.refresh()},setCurrentSelection:function(b){if(b){var c=this.getContentElement(b);if(c.addClass("nl_currentSelection"),this._currentSelection=c,this._contentEditor.isLoaded()&&!SO.Browser.isTouchScreen()){var d=this._contentEditor.getWindow();if(d){var e=a(d),f=e.scrollTop(),g=e.scrollLeft();this._isInhibited("focus")||this._currentSelection.focus(),e.scrollTop(f),e.scrollLeft(g)}}}else this.deselectAll(!0)},isDirty:function(){var a=!1;return this._contentEditor&&this._contentEditor.isLoaded()&&this._contentSetted&&!this.hasResourcesToLoad()&&(a=this._contentEditor.isDirty()),this._isDirty=a,a},setDirty:function(a,b){this._contentSynchronized=!1;var c=!this.isReadOnly()&&a;this._contentEditor&&this._contentEditor.isLoaded()&&this._contentEditor.setDirty(c),this._isDirty=c,this._isDirty&&!this._contentSynchronized&&(b?this.options.onTouched&&this.options.onTouched():this.options.onInternalChange&&(this.options.onInternalChange(this.getValue()),this._contentSynchronized=!0))},getConfManager:function(){return this.confAccessor},setServerUrl:function(a){this._serverUrl=a,this._cssPath=this._serverUrl+this._cssPath,this._cssOnPath=this._serverUrl+this._cssOnPath},getServerUrl:function(){return this._serverUrl},patchBodyAttributes:function(a,b){var c="",d=a.toLowerCase(),e=a.substr(0,d.indexOf("<body"));c=a.substr(d.indexOf("<body"));var f=c.substr(0,5);c=c.substr(5);var g=c.substr(0,c.indexOf(">"));c=c.substr(c.indexOf(">"));var h=c.substr(0,1);c=c.substr(1);var i=g.toLowerCase();if(i.indexOf("style=")>0){var j=g.substr(0,i.indexOf("style=")),k=g.substr(i.indexOf("style="));k=k.substr(6);var l=k.substr(0,1);k=k.substr(1),k=k.substr(k.indexOf(l)+1),g=j+'style="'+SO.XSS.escapeXMLAttribute(b)+'"'+k}else g+=' style="'+SO.XSS.escapeXMLAttribute(b)+'"';if(i=g.toLowerCase(),i.indexOf("class=")>0){var m=g.substr(0,i.indexOf("class=")),n=g.substr(i.indexOf("class="));n=n.substr(6);var o=n.substr(0,1);if("'"===o||'"'===o)n=n.substr(1),n=n.substr(n.indexOf(o)+1);else{var p=n.indexOf(" ")>=0?n.indexOf(" "):n.length;n=n.substr(p)}g=m+'class="'+SO.XSS.escapeXMLAttribute(this._contentBodyClass)+'"'+n}else g+=' class="'+SO.XSS.escapeXMLAttribute(this._contentBodyClass)+'"';return e+f+g+h+c},getContent:function(b){var c,d,e,f=this._startInhibitor("dirty");if("source"===this._currentState)e=this.getSourceEditor().getValue();else{var g;if(b&&(c=this._currentSelection,d=this._contentEditor.currentBookmark,this.element.nlEditBox("stop"),this.getContentElement("."+n).removeClass(n),this.getContentElement("."+o).removeClass(o),this.getContentElement(".nl_currentSelectionOver").removeClass("nl_currentSelectionOver"),g=this._editionState,this.deselectAll(),this._contentEditor.isLoaded()&&this.getContentElement("button").each(function(b,c){var d=a(c);d.removeAttr("contentEditable")}),"page"===this.options.contentType?this.notifyClean(this.getContentElement("body")):this.notifyClean(this.getContentElement("body").children())),e="",!this._emptyContent){if(e=this._$fullHtmlEditor.val(),e=this._contentEditor.removeBoundaries(e),"page"===this.options.contentType){var h=this.getContentElement("body")[0],i="";if(h){var j=h.attributes;j&&j.style&&j.style.value&&(i=j.style.value)}e=this.patchBodyAttributes(e,i)}"text"===this.options.contentType?(e=e.replace(/\<br\s*\/\>/g,"\n"),e=e.replace(/\<br\s*\>/g,"\n"),-1===e.indexOf("data-nl")&&(e=this._contentEditor.decode(e))):e=e.replace(/&lt;%/g,"<%").replace(/%&gt;/g,"%>")}if(b){var k=this.getContentElement("body");("fragment"===this.options.contentType||"text"===this.options.contentType)&&(k=k.children()),this.notifyInsertion(k,!0),c&&(this.forceSelectBlock(c),"text"===g&&this.editBlock("click","user"),d&&(this._contentEditor.moveToBookmark(d),this._contentEditor.storeBookmark())),this.updateMessageBox()}}return this._stopInhibitor("dirty",f),e},getValue:function(){return this.preSaveContent(),this.getContent(!0)},clearAllBookmarks:function(){this._contentEditor.discardCurrentBookmark()},cleanRawContent:function(a){var b=a;return b=a.replace(/<%/g,"&lt;%").replace(/%>/g,"%&gt;")},preSaveContent:function(){if("source"!==this._currentState&&this._contentEditor.isLoaded()){var a=this._contentEditor.save(this._isInhibited("undo"));""!==a&&(this._emptyContent=!1)}},onContentSetted:function(b){var c=this,d="";if(this._emptyContent&&this.options.changeContent)return this.setCurrentState("template"),void 0;switch("edition"!==this._currentState&&"source"!==this._currentState&&this.setCurrentState("edition"),this.options.contentType){case"page":d="nl_contentType-page";break;case"fragment":d="nl_contentType-fragment";break;case"text":d="nl_contentType-text"}this.getContentElement("body").addClass(d),this.getContentElement("head").append('<link rel="stylesheet" href="'+this._cssPath+'" type="text/css" />');var e=this.getContentElement("body");("fragment"===this.options.contentType||"text"===this.options.contentType)&&(e=e.children()),this.notifyInsertion(e,b),this.activeInteractions(),this.updateMessageBox(),this.deselectAll(!0),this._contentEditor.isLoaded()&&a(window).on("scroll",function(){c.iframeScrolled()}),c.iframeResize()},isContentSetted:function(){return this._contentSetted},isEmptyContent:function(){return this._emptyContent},highlightDone:function(a){a.removeClass(n).addClass(o)},highlightToDo:function(a){a.removeClass(o).addClass(n)},_compareMessages:function(a,b){var c=3,d=3,e={error:0,warning:1,info:2,normal:3,success:4};return a.type&&SO.isNumber(e[a.type])&&(c=e[a.type]),b.type&&SO.isNumber(e[b.type])&&(d=e[b.type]),c-d},updateMessageBox:function(){var a=[];if(!this.isReadOnly()&&this._actionHandlers&&!this._emptyContent){var b,c=this._actionHandlers.message,d=c.length;for(b=0;d>b;b++){var e=c[b].plugin;this._plugins[e.getName()].enabled&&(a=a.concat(e.getMessages()))}}this._$pageEdition.nlPageEdition("setMessages",a.sort(this._compareMessages))},getContentElement:function(b){return this._contentEditor&&this._contentEditor.isLoaded()?this._contentEditor.select(b):a()},sourceFrameResize:function(){var b=this.getSourceEditor();b.refresh();var c=a(b.getScrollerElement());c.css("height",this.element.height())},iframeResize:function(){var a=this.element.height();a>=this.MIN_EDITOR_HEIGHT+this.ACTIONBAR_HEIGHT&&this._contentEditor&&this._contentEditor.isLoaded()&&this._contentEditor.getIFrame().height(a),this._currentSelection&&this.element.nlEditBox("repositionToolbar")},iframeScrolled:function(){this._currentSelection&&this.element.is(":nl-nlEditBox")&&this.element.nlEditBox("repositionToolbar")},selectPage:function(){this.notifyFocusOn(this.getContentElement("html"))},forceSelectBlock:function(a,b,c){var d={type:"click"};b&&(d.type="dblclick"),a&&a.length>0&&(this._startElement=a,this.selectBlock(a,d,c))},selectBlock:function(a,b,c){var d;if(this._contentEditor.isLoaded()&&this._contentEditor.isSelectionCoherentWithNode(!1,a)&&(d=this._contentEditor.createBookmark()),!this._currentSelection||m(a)||a&&a.is(this._currentSelection)||this.deselectAll(!1),this._$pleaseSelectBlock.hide(),a&&(SO.Browser.isTouchScreen()||a.is(this._startElement)||a.find(this._startElement).length>0||this._currentSelection&&this._currentSelection.find(this._startElement).length>0&&this._currentSelection.find(a).length>0)&&!a.is(this._currentSelection)){this.setCurrentSelection(a),this._editionState="properties";var e;b&&(e=b.type),this.displayNlEditBox(e,a),this.displayBlockProperties(b),this.notifyFocusOn(a),this.options.onSelectBlock&&this.options.onSelectBlock.call(this,a),"text"===this.options.contentType&&"body"===a.get(0).nodeName.toLowerCase()&&this.editBlock("click",c)}},displayBlockProperties:function(a){var b=this._currentSelection;return b?(b.is('input[type="button"], input[type="submit"], button')&&!m(b)&&(SO.isFunction(a.stopPropagation)&&a.stopPropagation(),SO.isFunction(a.preventDefault)&&a.preventDefault()),!0):!1},editBlock:function(a,b,c){var d=this._currentSelection;if(!d)return!1;if(d&&d.is(g)&&!d.is(j)){this._contentEditor.isLoaded()&&!this.isReadOnly()&&this._contentEditor.setContentEditable(d);try{c||"user"!==b&&b?("start"===b||"end"===b)&&this._contentEditor.isLoaded()&&(this._contentEditor.selectAllText(d[0]),this._contentEditor.setCaret(b)):this._contentEditor.isLoaded()&&this._contentEditor.isSelectionCoherentWithNode(!1,d)&&(c=this._contentEditor.createBookmark())}catch(e){}d.addClass("nl_currentEditing"),this._editionState="text",this.displayNlEditBox(a,d),this._isInhibited("focus")||this._contentEditor.focus(),this.notifyTextEditionStart(d)}},displayPluginAdvancedEdition:function(a){var b=this._currentSelection;return b?(this.notifyAdvancedEdition(b,a),void 0):!1},activeInteractions:function(){var b=this,c=this.getContentElement("body"),d=this.getContentElement("html"),e=a(this._contentEditor.getWindow());this._currentSelection&&this.element.nlEditBox("repositionToolbar"),this.getContentElement("form").each(function(a,b){b.autocomplete="off"}),this.getContentElement('input[type="button"], input[type="submit"], input[type="image"], button').each(function(){var c=a(this);c.attr("id")||b._contentEditor.isLoaded()&&c.attr("id",b._contentEditor.getNewId("input")),"button"===c[0].nodeName.toLowerCase()&&b._contentEditor.isLoaded()&&b._contentEditor.setContentEditable(c)});var f=function(a){var c=a.target.nodeName.toLowerCase(),d=NL.XTK.toString(a.target.type,"").toLowerCase();("select"===c||"option"===c||"input"===c&&"range"===d)&&a.preventDefault();var e=b.getContentElement(a.target);b._startElement=e},g=function(c){var d,e=b.getContentElement(c.target);c&&(d=c.type);var f=null;if(!m(e)&&!e.hasClass("nl_toolbar"))if(e.is(i))f=e;else{var g=e.closest(i).not("html");m(g)||e.hasClass("nl_toolbar")||(f=g)}"edition"===b._currentState&&("properties"===b._editionState&&b._currentSelection&&b._currentSelection.is(f)?f.is(j)||b.isReadOnly()||b.editBlock(d,"user"):"text"===b._editionState&&b._currentSelection&&b._currentSelection.is(f)||b.selectBlock(f,c,"user"));var h="";e.length&&(h=e[0].nodeName.toLowerCase());var l=NL.XTK.toString(e.attr("type"));(("click"===c.type||"touchend"===c.type||"mouseup"===c.type||"dblclick"===c.type)&&e.is(k)||e.closest(k).length>0||a._data(e,"events")&&a._data(e,"events").click||e.data("events")&&e.data("events").click||!SO.isEmpty(e.attr("onclick"))||"input"===h&&["checkbox","radio","color","date","datetime-local","week","month","file"].indexOf(l)>-1||"label"===h&&(e.find('input[type="checkbox"], input[type="radio"]').length>0||!SO.isEmpty(e.attr("for"))))&&(b.options.popableManager.preventDefault(c),f&&f.focus()),b.options.popableManager.handle(c)};if(SO.Browser.isTouchScreen()?(SO.Event.unbind(c,"tap"),SO.Event.bind(c,"tap",function(a){g(a.originalEvent),b._contentEditor.focus()},{stopPropagation:!1,preventDefault:!1})):(c.unbind("mousedown").bind("mousedown",f),c.unbind("click").bind("click",g),c.unbind("dblclick").bind("dblclick",g)),SO.Browser.isTouchScreen()?(SO.Event.unbind(d,"tap"),SO.Event.bind(d,"tap",function(a){var c=a.originalEvent;c.target&&"html"===c.target.nodeName.toLowerCase()&&b.deselectAll(!0)},{stopPropagation:!1,preventDefault:!1})):(d.unbind("click").bind("click",function(a){a.target&&"html"===a.target.nodeName.toLowerCase()&&b.deselectAll(!0)}),d.unbind("dblclick").bind("dblclick",function(a){a.target&&"html"===a.target.nodeName.toLowerCase()&&b.deselectAll(!0)})),SO.Browser.isTouchScreen()){var h=!1;SO.Event.unbind(e,"slide"),SO.Event.bind(e,"slide",{onStart:function(){h=!0,b._currentSelection&&b.element.is(":nl-nlEditBox")&&b.element.nlEditBox("hide")},onStop:function(){h=!1,b._currentSelection&&b.element.is(":nl-nlEditBox")&&b.element.nlEditBox("refresh","all")}},{stopPropagation:!1,preventDefault:!1}),this._$fullHTMLEditorTab.unbind("scroll").bind("scroll",function(){h||b.iframeScrolled()})}else a(this._contentEditor.getWindow()).unbind("scroll").bind("scroll",function(){b.iframeScrolled()});SO.Browser.isTouchScreen()||(c.unbind("mouseover").bind("mouseover",function(a){var c,d=b.getContentElement(a.target);if(a&&(c=a.type),!m(d)&&!d.hasClass("nl_toolbar"))if(d.is(i))a.stopPropagation(),a.preventDefault(),d.parent().removeClass("nl_currentSelectionOver"),d.addClass("nl_currentSelectionOver"),d.is(b._currentSelection)||b.displayNlEditBox(c,d);else{var e=d.closest(i).not("html");m(e)||e.hasClass("nl_toolbar")||(a.stopPropagation(),a.preventDefault(),e.parent().removeClass("nl_currentSelectionOver"),e.addClass("nl_currentSelectionOver"),e.is(b._currentSelection)||b.displayNlEditBox(c,e))}}),c.unbind("mouseout").bind("mouseout",function(c){var d=b.getContentElement(c.target),e=d;if(d.is(i))e=d,e.removeClass("nl_currentSelectionOver"),e.is(b._currentSelection)||b.element.nlEditBox("stopHover");else{var f=d.closest(i).not("html");e=f,e.is(j)||(e.removeClass("nl_currentSelectionOver"),e.is(b._currentSelection)||b.element.nlEditBox("stopHover"))}"edition"===b._currentState&&a(this).is("body")&&b._contentEditor.isLoaded()&&b._contentEditor.storeBookmark()}))},initEditBox:function(){q=a.extend(q,{controller:this,contentEditor:this._contentEditor,editionCommands:this.getPluginEditionCommands(),overCommands:this.getPluginOverCommands(),toolbarContainer:this.options.toolbarContainer,toolbarOptions:{iframe:this._contentEditor.getIFrame(),container:this._$fullHTMLEditorTab},outlineWidth:this.OUTLINE_WIDTH}),this.element.nlEditBox(q)},initFlagToolbar:function(){this.createFlagToolbar(),this.updateFlagToolbar()},createFlagToolbar:function(){this._$flagToolbar=a("<div></div>").nlFloatToolbar({style:"toolbar",outer:{top:!1,bottom:!1,left:!1,right:!1},position:"top-left",commandConfigs:{},commands:[],iconSize:20,separators:!0,margins:{top:5,right:0,bottom:0,left:5}}),a("body").append(this._$flagToolbar)},updateFlagToolbar:function(){var a={},b=[];SO.Utils.each(this.options.pageFlagExtension,function(c,d){a[d.name]={icon:d.config.icon,help:d.config.label,action:d.config.action,badgerValue:d.config.badgerValue,command:d.config.command},b.push(d.name)}),this._$flagToolbar.nlFloatToolbar("setCommands",a,b,this._flagCommands),this._$flagToolbar.nlFloatToolbar("refresh"),0===b.length&&this.hideFlagToolbar(),this._flagCommands=b},displayFlagToolbar:function(){this._flagCommands.length>0&&this._$flagToolbar.nlFloatToolbar("show",this._contentEditor.getIFrame())},hideFlagToolbar:function(){this._$flagToolbar&&this._$flagToolbar.hide()},updateFlagToolbarPosition:function(){this._$flagToolbar&&this._$flagToolbar.is(":visible")&&this._$flagToolbar.nlFloatToolbar("show",this._contentEditor.getIFrame())},displayNlEditBox:function(a,b){var c=[];this.isReadOnly()||(a&&"click"!==a&&"touchend"!==a&&"dblclick"!==a?"mouseover"===a&&(c=this.getPluginOverCommandNames(b),c.length>0&&this.element.nlEditBox("over",b,c)):(IE&&(b.get(0).oncontrolselect=function(){return!1}),"properties"===this._editionState?c=this.getPluginPropertiesCommandNames(b):"text"===this._editionState&&(c=this.getPluginTextCommandNames(b)),c.length>0&&this.element.nlEditBox("edit",b,c)))},resetContent:function(){this.deselectAll(!1),this.setDirty(!1),this._$pageEdition.nlPageEdition("stopHighlight");var a=this.getContentElement("head");a.length>0&&a.find("style, meta, link").remove(),this._numberOfContentSetted=0},_updateUndoRedoButtons:function(a,b){var c,d;c=SO.isBoolean(a)?!a:!this._contentEditor.hasUndo(),d=SO.isBoolean(b)?!b:!this._contentEditor.hasRedo(),this._$pageEdition.nlPageEdition("updateCommandState",{undo:{disabled:c},redo:{disabled:d}})},registerUndoLevel:function(){this._contentEditor.registerUndoLevel(),this._updateUndoRedoButtons()},_clearUndo:function(){this._contentEditor.clearUndo(),this._updateUndoRedoButtons()},undo:function(){if(this._contentEditor.hasUndo()){var a=this._startInhibitor("undo");this._contentEditor.undo(),this._stopInhibitor("undo",a)}},onUndo:function(){this._updateUndoRedoButtons(),this.updateMessageBox(),this._currentSelection=null,this.deselectAll(!0),this._stopHoverSelection();var a=this.getContentElement("body");("fragment"===this.options.contentType||"text"===this.options.contentType)&&(a=a.children()),this.notifyInsertion(a,!0),this.activeInteractions(),this._contentEditor.focus()},redo:function(){if(this._contentEditor.hasRedo()){var a=this._startInhibitor("undo");this._contentEditor.redo(),this._stopInhibitor("undo",a)}},onRedo:function(){this._updateUndoRedoButtons(),this.updateMessageBox(),this._currentSelection=null,this.deselectAll(!0),this._stopHoverSelection();var a=this.getContentElement("body");("fragment"===this.options.contentType||"text"===this.options.contentType)&&(a=a.children()),this.notifyInsertion(a,!0),this.activeInteractions(),this._contentEditor.focus()},setContent:function(b,c){var d=this,e=b;if(this.hasResourcesToLoad())return this.startWaitDialog(nms_contentEditor.loadingContent(),function(){d.loadedResource("content",{data:e})}),void 0;this._numberOfContentSetted++;var f=this._emptyContent;if(this._contentSetted=!0,this._emptyContent=""===a.trim(e),!this._emptyContent){"text"===this.options.contentType&&(-1===e.indexOf("data-nl")&&(e=this._contentEditor.encodeRaw(e,!0)),e=e.replace(/\r?\n/g,"<br />")),"page"===this.options.contentType&&(this._contentBodyClass=this._getClassFromBody(e)),e=this.cleanRawContent(e);var g=new RegExp("<!doctype [^>]*>","im"),h=e.match(g);if(h&&h.length>0){var i=h[0],j=this._contentEditor.editor.getParam("doctype");this._contentEditor.isLoaded()&&j!==i}for(var k,l=new RegExp("<!(?:\n|\r|s)*--[^[](?:[^-]|-[^-]|\n|\r|s)*--(?:\n|\r|s)*>","ig");k=l.exec(e);){var m,n=k.index,o=k[0].length,q=e.substr(0,n),r=e.substr(n,o),s=e.substr(n+o,e.length);for(m=0;p.length>m;m++)r=r.replace(new RegExp("<(/?)("+p[m]+")","ig"),"&lt;$1$2");e=q+r+s}}return this._contentEditor.setContent(e),this._emptyContent&&this.options.changeContent?(this.setCurrentState("template"),void 0):(this._contentEditor.isLoaded()&&(this.getContentElement&&this.getContentElement("head link").each(function(b,c){a(c).attr("href")&&a(c).remove()}),d.patchContentEditorContent(),1===this._numberOfContentSetted&&this._contentEditor.clearDirty(),setTimeout(function(){d.patchContentEditorContent(),1===d._numberOfContentSetted&&d._contentEditor.clearDirty()},0)),"edition"!==this._currentState&&"source"!==this._currentState?this.setCurrentState("edition"):this._$dialogTemplateList&&this._$dialogTemplateList.is(":nl-nlListInDialog")&&this._$dialogTemplateList.nlListInDialog("closeDialog"),this._isInhibited("dirty")||f===this._emptyContent||this.setDirty(!0),1===this._numberOfContentSetted&&(this._clearUndo(),this.registerUndoLevel()),this._contentEditor.isLoaded()&&this.onContentSetted(c),void 0)},setValue:function(a){var b=this._startInhibitor("undo"),c=this.getValue();this._stopInhibitor("undo",b),a!==c&&(this.resetContent(),this.setContent(a,!0))},loadFromTemplate:function(a){var b=this;if(a){var c=new NL.transport.REST({url:"/rest/head/contentModel/"+a+"/content",method:"GET"});c.start({onSuccess:function(a){a&&b.startWaitDialog(nms_contentEditor.loadingContent(),function(){b.resetContent(),b.setContent(a),b.setDirty(!0),b.stopWaitDialog(),b.options.onContentLoaded&&b.options.onContentLoaded.call(b)})},onError:function(){}})}},launchSaveAsTemplate:function(){var b=this;this.startWaitDialog(nms_contentEditor.template_saveContentAsTemplate(),function(){var c=a('<div class="nlui-dce-templateMode"></div>').append('<div data-nl-jpath="label"></div>'),d=new SO.MVC.Controller({model:{label:"",content:""},metamodel:{label:{label:nms_contentEditor.template_storeContentModelLabel(),type:"string"},content:{type:"string"}},statemodel:{},onSave:function(a){a.controller.setValue("content",b.getContent(!0));var c=null;return b.startWaitDialog(nms_contentEditor.template_saveContentAsTemplate(),function(){var d=modelConfig.extramodel;SO.Utils.each(d,function(b,c){c.value=a.controller.getValue(b)}),c=NL.API.write("nms:contentModel",d,function(){b.stopWaitDialog(),a.success(),a.complete()},function(c){b.stopWaitDialog(),a.error(c),a.complete()})}),c}});c.nlForm({controller:d,labelsPosition:"above"}).soDialog({title:nms_contentEditor.template_saveContentAsTemplate(),modal:!0,destroyOnClose:!0,removeOnClose:!0,noPrimaryFirstButton:!0,open:function(){b.stopWaitDialog()},buttons:[{label:nms_contentEditor.dialog_cancel(),preset:"cancel"},{label:nms_contentEditor.dialog_ok(),mode:"primary",click:function(){var a=this;d.save(function(b){b&&a.soDialog("close")})}}]})})},launchZIPUpload:function(){var b=this;if(this.options.getUploadData)var c=this.options.getUploadData(),d=new SO.Widgets.MonoFileDropZone(a("<div></div>"),{uploader:new NL.Uploader({jobCreateResource:"/rest/head/job"}),job:{priority:0,entitySchema:c.schema,method:"LoadContent",arguments:{resource:c.resource}},onJobComplete:function(){var a=new NL.transport.REST({method:"GET",url:c.resource});a.start({onSuccess:function(a){b.setContent(a),e.destroy(),b.options.onContentLoaded&&b.options.onContentLoaded.call(b)}})}}),e=new SO.Widgets.Dialog(a(d.el),{width:"auto",height:146,padding:!1,autoOpen:!0,title:nms_contentEditor.template_titleZipUpload(),modal:!0})},clearBrowserSelection:function(){var a,b=this._contentEditor.getWindow();try{b&&SO.isFunction(b.getSelection)&&(a=b.getSelection(),SO.isFunction(a.empty)?a.empty():SO.isFunction(a.removeAllRanges)&&a.removeAllRanges())}catch(c){}},checkReadOnly:function(a){var b=this.isReadOnly();b?this.options.globalCommandsContainer&&this.options.globalCommandsContainer.hide():(this.options.propertiesContainer&&this.options.propertiesContainer.show(),this._contentSetted&&!a&&(this.activeInteractions(),this.updateMessageBox())),this._sourceEditor&&this._sourceEditor.setOption("readOnly",b),this.hasResourcesToLoad()||this.updatePluginConfig(),this.iframeResize()},setReadOnly:function(a){this.options.readOnly=a,this.checkReadOnly()},initWidgets:function(){},updatePluginConfig:function(){var a=!1,b=this.getPluginContext();SO.Utils.each(this._plugins,function(c,d){var e=d.enabled;d.plugin.updateConfig(b.pluginConf),d.enabled=b.enabledPlugins.indexOf(c)>-1,a=e!==d.enabled}),a&&this.updateMessageBox();var c=this._currentSelection;this.deselectAll(!0),c&&c.length>0&&this.forceSelectBlock(c)},getPluginList:function(){var a=this.getPluginContext(),b=["ElementTitlePlugin","FormBindingPlugin","InlineInsertionPlugin","HyperLinkEditPlugin","ImagePlugin","OfferPlugin","BarcodePlugin","ConditionalPlugin","BlockStylePlugin","FontStylePlugin","LayoutPlugin","LocalizablePlugin"];return SO.Utils.map(b,function(b,c){return{constructor:NL.DCE[c],enabled:a.enabledPlugins.indexOf(c)>-1,config:a.pluginConf}})},getActions:function(){return["focusOn","deselect","inlineInsertion","binding","dblclickEdition","advancedEdition","over","insertion","deletion","textEdition","bookmarkChange","message","clean"]},initPlugins:function(){var a=this.getPluginList(),b=this.getActions(),c=a.length;this._plugins={};var d;for(d=0;c>d;d++){var e=a[d].config,f=new a[d].constructor(this,void 0===e?{}:e),g=f.getName();this._plugins[g]={plugin:f,enabled:a[d].enabled};var h;for(h=0;b.length>h;h++)f.getRegistration().indexOf(b[h])>-1&&this.registerPluginToAction(b[h],f)}this.updateMessageBox()},registerPluginToAction:function(a,b){this._actionHandlers[a].push({plugin:b})},initDroppingZone:function(){var a=this;NL.Widgets.dragDropManager.initIFrameFix(a._contentEditor.getIFrame()),this.getContentElement("body").nlDroppable({onDrop:function(b,c,d){a.handleDrop(b,c,d)}})},handleDrop:function(b,c,d){var e=a(this._contentEditor).getDocument(),f=this,g=a(d.event.target),h=!1;if(g.is(l)){var i;try{this._contentEditor.isLoaded()&&(i=this._contentEditor.createBookmark())}catch(j){}var k,m,n,o,p=d.event.originalEvent.pageX-e.scrollLeft(),q=d.event.originalEvent.pageY-e.scrollTop(),r=[],s=g[0].childNodes.length;for(o=0;s>o;o++)if(k=g[0].childNodes[o],3===k.nodeType){this._contentEditor.setSelection(k),m=this._contentEditor.getClientRects(),n=m.length;var t;for(t=0;n>t;t++)if(p>=m[t].left&&m[t].right>=p&&q>=m[t].top&&m[t].bottom>=q){r.push(k);break}}if(1===r.length){for(var u,v,w,x=r[0],y=0,z=x.length-1,A=!1,B=NL.XTK.parseInt((z-y)/2,0)+y,C=200,D=0;C>D&&B!==y&&B!==z;)this._contentEditor.setCursorLocation(x,y),u=this._contentEditor.getClientRects()[0],this._contentEditor.setCursorLocation(x,B),v=this._contentEditor.getClientRects()[0],this._contentEditor.setCursorLocation(x,z),w=this._contentEditor.getClientRects()[0],w.top===u.top&&(A=!0),!A&&v.top!==w.top&&v.bottom>=q||A&&v.left>=p?z=B:y=B,B=NL.XTK.parseInt((z-y)/2,0)+y,D++;this._contentEditor.setCursorLocation(x,B),h=f.notifyInlineInsertionAction(b,c.selection,c.source,a(d.event.target))}else 0===r.length?SO.log.warn("No container found."):SO.log.warn("This insertion scenario is not handled (multiple text node candidates)");i&&this._contentEditor.moveToBookmark(i)}h||f.notifyBindingAction(b,c.selection,c.source,a(d.event.target))},notifyFocusOn:function(b){var c,d=this._actionHandlers.focusOn,e=d.length;for(c=0;e>c;c++){var f=d[c].config,g=d[c].plugin;if(this._plugins[g.getName()].enabled){var h,i,j=this._sideBarSections[g.getName()];j&&j.section?(h=j,i=j.section):(i=a("<div></div>"),this._$HTMLEditorPropertiesPanel.append(i),h={plugin:g,config:f,section:i,loaded:!1},this._sideBarSections[g.getName()]=h),g.fillSidebarSection(b,i)&&(h.loaded=!0)}}},notifyDeselect:function(a){var b,c=this._actionHandlers.deselect,d=c.length,e=!1;
for(b=0;d>b;b++){var f=c[b].plugin;this._plugins[f.getName()].enabled&&(e=f.onDeselect(a)||e)}return e},notifyAdvancedEdition:function(b,c,d){var e,f=this;e="dblclick"===c?this._actionHandlers.dblclickEdition:this._actionHandlers.advancedEdition;var g,h=[],i={},j=a("<div></div>"),k=e.length,l=!1;for(g=0;k>g;g++){var m=e[g].plugin;if(this._plugins[m.getName()].enabled){var n="pluginAdvanced_"+m.getName()+"_tab",o=m.getAdvancedEditionData(b);if(o){var p=a("<div></div>");j.append(p),h.push({id:n,caption:m.getLabel(),selector:p}),i[n]={data:o,loaded:!1},l=!0}}}if(l){var q=nms_contentEditor.plugin_AdvancedEdition();if(h.length>1){var r="";d&&(r="pluginAdvanced_"+d+"_tab"),j.nlNotebook({layout:"horizontal",height:365,tabs:h,defaultSelected:r,onSelect:function(a,b){if(!i[a].loaded){var c=i[a].data;b.append(c.content),c.formConfig&&b.nlForm(c.formConfig)}i[a].loaded=!0}})}else{var s=h[0],o=i[s.id].data;i[s.id].loaded=!0,q=s.caption,j.append(o.content).nlForm(o.formConfig)}a("<div></div>").append(j).soDialog({title:q,height:560,width:600,modal:!0,destroyOnClose:!0,removeOnClose:!0,noPrimaryFirstButton:!0,buttons:[{label:nms_contentEditor.dialog_cancel(),click:function(){a(this).soDialog("close")}},{label:nms_contentEditor.dialog_ok(),mode:"primary",click:function(){var b,c=0;if(SO.Utils.each(i,function(a,d){if(d.loaded){var e=d.data;e.formConfig&&(e.formConfig.controller.check(["/"],e.checkConditions).valid||(c++,h.length>1&&(b||(b=h[a].id))))}}),0===c){var d,e=0;SO.Utils.each(i,function(a,b){if(b.loaded){var c=b.data;c.formConfig&&c.formConfig.controller.save(function(b){b||(e++,h.length>1&&(d||(d=h[a].id)))},["/"],c.saveConditions,c.checkConditions)}}),0===e?(f.notifyElementChange(f._currentSelection),a(this).soDialog("close")):h.length>1&&d&&j.nlNotebook("switchTab",d)}else h.length>1&&b&&j.nlNotebook("switchTab",b)}}]})}return l},notifyTextEditionStart:function(a){var b,c=this._actionHandlers.textEdition,d=c.length,e=!1;for(b=0;d>b;b++){var f=c[b].plugin;this._plugins[f.getName()].enabled&&(e=f.onTextEditionStart(a)||e)}return e},notifyTextEditionEnd:function(a){var b,c=this._actionHandlers.textEdition,d=c.length,e=!1;for(b=0;d>b;b++){var f=c[b].plugin;this._plugins[f.getName()].enabled&&(e=f.onTextEditionEnd(a)||e)}return e},notifyInsertion:function(a,b){var c,d=this._actionHandlers.insertion,e=d.length,f=!1;for(c=0;e>c;c++){var g=d[c].plugin;this._plugins[g.getName()].enabled&&(f=g.onSubtreeInsertion(a)||f)}return this.updateMessageBox(),this._isInhibited("dirty")||this.setDirty(!0),b?this._updateUndoRedoButtons():this.registerUndoLevel(),f},notifyClean:function(a){var b,c=this._actionHandlers.clean,d=c.length,e=!1;for(b=0;d>b;b++){var f=c[b].plugin;this._plugins[f.getName()].enabled&&(e=f.cleanSubtree(a)||e)}return this.updateMessageBox(),this._updateUndoRedoButtons(),e},notifyDeletion:function(a,b){this.deselectAll();var c,d=this._actionHandlers.deletion,e=d.length,f=!1;for(c=0;e>c;c++){var g=d[c].plugin;this._plugins[g.getName()].enabled&&(f=g.onSubtreeDeletion(a,b)||f)}this.updateMessageBox();var h=this._startInhibitor("undo");return this.setDirty(!0),this._stopInhibitor("undo",h),f},notifyBindingAction:function(a,b,c,d){var e,f=this._actionHandlers.binding,g=f.length;for(e=0;g>e;e++){var h=f[e].plugin;this._plugins[h.getName()].enabled&&h.handleBindingAction(a,b,c,d)}},notifyInlineInsertionAction:function(a,b,c,d){var e,f=this._actionHandlers.inlineInsertion,g=f.length;for(e=0;g>e;e++){var h=f[e].plugin;this._plugins[h.getName()].enabled&&h.handleInlineInsertionAction(a,b,c,d)}this.registerUndoLevel()},notifyBookmarkChangeAction:function(){var a,b=this._actionHandlers.bookmarkChange,c=b.length;if(this.isReadOnly())return!1;for(a=0;c>a;a++){var d=b[a].plugin;if(this._plugins[d.getName()].enabled){var e=d.getUpdatedCommandStates();this.element.nlEditBox("changeCommandStates",e)}}},getPluginOverCommands:function(){var a,b=this._actionHandlers.over,c=b.length,d={};for(a=0;c>a;a++){var e=b[a].plugin;this._plugins[e.getName()].enabled&&(d[e.getName()]=e.getOverCommands())}return d},getPluginEditionCommands:function(){var a,b=this,c=this._actionHandlers.focusOn,d=c.length,e={};for(a=0;d>a;a++){var f=c[a].plugin;this._plugins[f.getName()].enabled&&(e[f.getName()]=f.getEditionCommands())}return e.allPlugins=[{where:"root",command:{name:"advancedEdition",icon:"coral-gear",help:nms_contentEditor.plugin_AdvancedEdition(),action:function(){b.displayPluginAdvancedEdition()}}}],e},getPluginOverCommandNames:function(a){var b,c=this._actionHandlers.over,d=c.length,e=[];for(b=0;d>b;b++){var f=c[b].plugin;if(this._plugins[f.getName()].enabled){var g=f.getOverCommandNames(a);g.length>0&&(e=e.concat(g))}}return e},getPluginTextCommandNames:function(a){var b,c=this._actionHandlers.focusOn,d=c.length,e=[],f=!1;for(b=0;d>b;b++){var g=c[b].plugin;if(this._plugins[g.getName()].enabled){var h=g.getTextCommandNames(a),i=h.names;f=f||h.advancedEdition,i.length>0&&(e=e.concat(i))}}return f&&e.push("advancedEdition"),e},getPluginPropertiesCommandNames:function(a){var b,c=this._actionHandlers.focusOn,d=c.length,e=[],f=!1;for(b=0;d>b;b++){var g=c[b].plugin;if(this._plugins[g.getName()].enabled){var h=g.getPropertiesCommandNames(a),i=h.names;f=f||h.advancedEdition,i.length>0&&(e=e.concat(i))}}return f&&e.push("advancedEdition"),e},storeDataInElement:function(a,b){this._contentEditor.isLoaded()&&this._contentEditor.storeDataInElement(a,b),this.updateMessageBox()},insertNodeAtSelection:function(b,c,d,e){var f,g,h;return this._contentEditor.isLoaded()&&(this._contentEditor.focus(),this._contentEditor.restoreBookmark(),f=this._contentEditor.insertNode(b,c,d,e),g=f.next(),1===g.length&&g.hasClass(r)?(h=this._contentEditor.getDocument().createTextNode(""),g.after(a(h)),this._contentEditor.setSelection(a(h))):this._contentEditor.setSelection(f),this._contentEditor.setCaret("end"),this.updateMessageBox(),this.activeInteractions()),f},notifyElementChange:function(a){this._currentSelection&&this._currentSelection.length&&a[0]===this._currentSelection[0]&&SO.Utils.each(this._sideBarSections,function(b,c){var d=c.plugin;c.loaded?d.updateSidebarSection(a):d.fillSidebarSection(a,c.section)&&(c.loaded=!0,d.updateSidebarSection(a))}),this.displayNlEditBox(null,a),this.updateMessageBox(),this.registerUndoLevel()},isSelectableElement:function(a){return a.is(i)},isEditableElement:function(a){return a.is(g)&&!a.is(j)},insertInclusionAtSelection:function(a,b,c){var d=this.insertNodeAtSelection("span",a,b,c);return d},replaceWith:function(b,c){var d=a("<"+c+"></"+c+">"),e=this._contentEditor.getNewId(c);return d.attr("id",e),b.replaceWith(d),this.getContentElement("#"+e)},conservativeWrap:function(b,c){if(SO.isEmpty(c))return null;var d=a("<"+c+' id="'+this._contentEditor.getNewId(c)+'"></'+c+">");return d.insertBefore(b),d.append(b),d},addResourceToLoad:function(a){this._resourcesToLoad[a]=!1},hasResourcesToLoad:function(){var a,b=!0;return SO.Utils.each(this._resourcesToLoad,function(c,d){b?(a=d,b=!1):a=a&&d}),!a},loadedResource:function(a,b){if("content"===a&&(this._preLoadedContent=b.data),this._resourcesToLoad[a]=!0,!this.hasResourcesToLoad()){this.initPlugins(),this.initEditBox(),this.initFlagToolbar();var c=this._startInhibitor("dirty"),d=this._startInhibitor("undo");if(this.setContent(this._preLoadedContent),this._stopInhibitor("undo",d),this._stopInhibitor("dirty",c),this.clearBrowserSelection(),this.setDirty(!1),this._preLoadedContent=null,this.stopWaitDialog(),"content"===a&&(this._clearUndo(),this.registerUndoLevel()),"text"===this.options.contentType){var e=this.getContentElement("body");e.css("margin",this.OUTLINE_WIDTH),this.forceSelectBlock(e,!1,"end")}}},init:function(){var d=this;this.addResourceToLoad("content"),this.initWidgets();var e=this.getActions();this._actionHandlers={};var f;for(f=0;e.length>f;f++)this._actionHandlers[e[f]]=[];a(window).unload(function(){try{if(a("*").unbind(),IE)try{a("body").remove(),a("*").remove()}catch(b){}}catch(b){}});var g=null;if(this.options.content&&a.trim(this.options.content)){var h=new RegExp("<!doctype [^>]*>","im"),i=this.options.content.match(h);i&&i.length>0&&(g=i[0].replace(/\r\n|\n\r|\r|\n/g," "))}this.addResourceToLoad("contentEditorSync"),this.addResourceToLoad("contentEditorAsync");var j="table,style";"page"===this.options.contentType&&(j+=",fullpage"),"text"===this.options.contentType&&(j+=",paste"),this._contentEditor=new b(this,this._$fullHtmlEditor,{id:this.editorId,width:"100%",height:this.MIN_EDITOR_HEIGHT+"px",readonly:!0,visual:!1,verify_html:!1,ie7_compat:!1,forced_root_block:!1,object_resizing:!1,doctype:g,custom_undo_redo_levels:10,skin:"dce",theme:"advanced",plugins:j,content_css:!1,editor_css:!1,convert_urls:!1,valid_elements:"*[*]",entity_encoding:"raw",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,forecolor,|,undo,redo,|,formatselect,fontselect,fontsizeselect",theme_advanced_buttons2:"tablecontrols",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"none",theme_advanced_resizing:!0,paste_strip_class_attributes:"all",paste_remove_spans:!0,paste_text_sticky:!0,paste_remove_styles:!0,paste_text_linebreaktype:"br",setup:function(a){"text"===d.options.contentType&&a.onInit.add(function(a){a.pasteAsPlainText=!0}),a.onChange.add(function(a){d._isInhibited("dirty")||("edition"===d._currentState&&"text"===d._editionState?d.setDirty(!0,!0):d.setDirty(a.isDirty()||a.undoManager&&a.undoManager.hasUndo()))}),a.onEvent.add(function(a,b){if(SO.Browser.isTouchScreen())return!0;d._contentEditor.preventStuckCaret({type:b.type.toLowerCase(),keyCode:b.keyCode,charCode:b.charCode,preventDefault:b.preventDefault});var c=b.shiftKey,e=b.ctrlKey;if(!c&&!e&&"text"===d._editionState){var f=d._contentEditor.currentBookmark;d._contentEditor.storeBookmark();var g=SO.Utils.isEqual(f,d._contentEditor.currentBookmark);g||d.notifyBookmarkChangeAction(),IE||"click"!==b.type||!g||d._contentEditor.isSelectionEmpty()||setTimeout(function(){d._contentEditor.storeBookmark(),d.notifyBookmarkChangeAction()},0),"keyup"===b.type.toLowerCase()&&d.element.is(":nl-nlEditBox")&&d.element.nlEditBox("repositionToolbar")}return"text"!==d._editionState&&b.type.match(/key.+/i)?(b.ctrlKey&&90===b.keyCode&&"keyup"===b.type.toLowerCase()&&d.undo(),b.ctrlKey&&89===b.keyCode&&"keyup"===b.type.toLowerCase()&&d.redo(),!1):!0})}},function(a){d.onContentEditorInit(a)}),this.loadedResource("contentEditorSync"),this._layoutManager=new c({contentEditor:d._contentEditor})},startWaitDialog:function(b,c){var d=function(){};SO.isFunction(c)&&(d=c),this._$waitDialog&&this._$waitDialog.is(":so-soMessageBox")?(this._$waitDialog.soMessageBox("setMessage",b),this._$waitDialog.soMessageBox("isOpen")?(this._$waitDialog.soMessageBox("setOnOpen",null),d()):(this._$waitDialog.soMessageBox("setOnOpen",d),this._$waitDialog.soMessageBox("open"))):(this.stopWaitDialog(),this._$waitDialog=a("<div></div>").soMessageBox({type:"loading",message:b,onOpen:d,showTimer:!1}))},stopWaitDialog:function(){this._$waitDialog&&this._$waitDialog.is(":so-soMessageBox")&&this._$waitDialog.soMessageBox("isOpen")&&(this._$waitDialog.soMessageBox("setOnOpen",function(){}),this._$waitDialog.soMessageBox("close"))},getPluginContext:function(){var a={},b=[],c=[],d=[],e=[];return this.options.layout.block?(b=["*"],d=["*"],this.options.image.deletion||c.push("img"),this.options.persoField.deletion||c.push(".nl-dce-field"),this.options.persoBlock.deletion||c.push(".nl-dce-fragment"),this.options.image.insertion||e.push("img"),this.options.persoField.insertion||e.push(".nl-dce-field"),this.options.persoBlock.insertion||e.push(".nl-dce-fragment")):(c=["*"],e=["*"],this.options.image.deletion&&b.push("img"),this.options.persoField.deletion&&b.push(".nl-dce-field"),this.options.persoBlock.deletion&&b.push(".nl-dce-fragment"),this.options.image.insertion&&d.push("img"),this.options.persoField.insertion&&d.push(".nl-dce-field"),this.options.persoBlock.insertion&&d.push(".nl-dce-fragment")),a.pluginConf={configManager:this.options.configManager,contentType:this.options.contentType,target:this.options.target.resource,hasLinkTarget:this.options.hyperlinks.linkTarget,hasLandingPage:this.options.hyperlinks.landingPage,hasLinkAction:this.options.hyperlinks.navigationActions,hasSubscriptionLink:this.options.hyperlinks.subscription,hasUnsubscriptionLink:this.options.hyperlinks.unsubscription,hasButtonAction:this.options.form.button.navigationActions,hasPreviousAction:this.options.hasPreviousAction,hasNextAction:this.options.hasNextAction,hasSubscription:this.options.form.subscription,help:this.options.conditionalVisibility.help,languages:this.options.localization.languages,deletableBlocks:b.join(", "),notDeletableBlocks:c.join(", "),duplicableBlocks:d.join(", "),notDuplicableBlocks:e.join(", "),persoFieldInsertion:this.options.persoField.insertion,persoBlockInsertion:this.options.persoBlock.insertion,readOnly:this.isReadOnly()},a.enabledPlugins=[],(this.options.form.button.navigationActions||this.options.form.subscription||this.options.form.bindingStorage.xpath)&&a.enabledPlugins.push("FormBindingPlugin"),(this.options.persoField.insertion||this.options.persoField.edition||this.options.persoBlock.insertion||this.options.persoBlock.edition)&&a.enabledPlugins.push("InlineInsertionPlugin"),(this.options.hyperlinks.external||this.options.hyperlinks.linkTarget||this.options.hyperlinks.landingPage||this.options.hyperlinks.pURL||this.options.hyperlinks.navigationActions||this.options.hyperlinks.subscription||this.options.hyperlinks.unsubscription)&&a.enabledPlugins.push("HyperLinkEditPlugin"),this.options.image.edition&&a.enabledPlugins.push("ImagePlugin"),this.options.conditionalVisibility.enabled&&a.enabledPlugins.push("ConditionalPlugin"),this.options.formatting.block&&a.enabledPlugins.push("BlockStylePlugin"),this.options.formatting.text&&a.enabledPlugins.push("FontStylePlugin"),(this.options.layout.block||this.options.image.deletion||this.options.persoField.deletion||this.options.persoBlock.deletion)&&a.enabledPlugins.push("LayoutPlugin"),this.options.localization.enabled&&a.enabledPlugins.push("LocalizablePlugin"),this.options.elementTitle&&a.enabledPlugins.push("ElementTitlePlugin"),a},isReadOnly:function(){return this.options.readOnly},getPageProperties:function(){var b=this,c=this.getContent(),d=c.toLowerCase(),e=c.substr(d.indexOf("<head")+5,d.indexOf("</head>")-d.indexOf("<head")-5);e=e.substr(e.indexOf(">")+1);var f=a();try{f=a("<div></div>").append(a(e).not("script"))}catch(g){}var h={title:f.find("title").text(),keywords:NL.XTK.toString(f.find('meta[name="keywords"]').attr("content")),description:NL.XTK.toString(f.find('meta[name="description"]').attr("content"))},i={title:{type:"string",label:nms_contentEditor.landingPageProperties_title(),help:nms_contentEditor.landingPageProperties_title_help()},keywords:{label:nms_contentEditor.landingPageProperties_keyWords(),help:nms_contentEditor.landingPageProperties_keyWords_help(),type:"memo",params:{rows:1}},description:{label:nms_contentEditor.landingPageProperties_description(),help:nms_contentEditor.landingPageProperties_description_help(),type:"memo",params:{rows:2}}},j=new SO.MVC.Controller({model:h,metamodel:i,onSave:function(a){return b._$pageEdition.nlPageEdition("stopHighlight"),b.setPageProperties(a.controller),a.success(),a.complete(),null}}),k=a('<div><div data-nl-jpath="title"></div><div data-nl-jpath="keywords"></div><div data-nl-jpath="description"></div></div>');return{label:nms_contentEditor.pagePropertiesTabTitle(),markup:k,formConfig:{controller:j,labelsPosition:"above",labelsBold:!0}}},getTitleProperty:function(b){var c=this.getContent(),d=c.toLowerCase();if(d.indexOf("<title")>-1){var e=c.substr(d.indexOf("<title"),d.indexOf("</title>")+8),f=a(e);return f.attr(b)}return""},setPageProperties:function(b){var c=this.getContent(),d=c.toLowerCase(),e="",f="",g=b.getValue("title"),h=b.getValue("keywords")?b.getValue("keywords").replace(/\r\n|\n\r|\r|\n/g," "):"",i=b.getValue("description")?b.getValue("description").replace(/\r\n|\n\r|\r|\n/g," "):"",j=d.indexOf("<head");if(j>-1){var k=c.substr(0,j);e=c.substr(j),f=d.substr(j);var l=e.substr(0,5);e=e.substr(5),f=f.substr(5);var m=f.indexOf(">"),n=e.substr(0,m);e=e.substr(m),f=f.substr(m);var o=e.substr(0,1);e=e.substr(1),f=f.substr(1);var p=f.indexOf("</head>"),q=e.substr(0,p);e=e.substr(p);var r=e.substr(0,7);e=e.substr(7);var s="",t=a(a.trim(q));t.filter("script").each(function(b,c){var d=a(c);d.data("nl-dce-oldType",d.attr("type")).attr("type","text/plain")}),t.filter("title").length>0?t.filter("title").text(g):s+="\n<title>"+SO.XSS.escapeXMLString(g)+"</title>",t.filter('meta[name="keywords"]').length>0?t.filter('meta[name="keywords"]').attr("content",h):s+='\n<meta name="keywords" content="'+SO.XSS.escapeXMLAttribute(h)+'" />',t.filter('meta[name="description"]').length>0?t.filter('meta[name="description"]').attr("content",i):s+='\n<meta name="description" content="'+SO.XSS.escapeXMLAttribute(i)+'" />';var u="";t.each(function(b,c){var d=a(c),e=a("<div></div>").append(d);e.find("script").attr("type",d.data("nl-dce-oldType")),u+=e.html()}),this.setContent(k+l+n+o+s+"\n"+u+"\n"+r+e)}else{var v=d.indexOf("<html");if(v>-1){var w=c.substr(0,v);e=c.substr(v);var x=e.substr(0,5);e=e.substr(5);var y=e.substr(0,e.indexOf(">"));e=e.substr(e.indexOf(">"));var z=e.substr(0,1);e=e.substr(1);var A="\n<head>\n  <title>"+SO.XSS.escapeXMLString(g)+"</title>"+"\n"+'  <meta name="keywords" content="'+SO.XSS.escapeXMLAttribute(h)+'" />'+"\n"+'  <meta name="description" content="'+SO.XSS.escapeXMLAttribute(i)+'" />'+"\n"+"</head>";this.setContent(w+x+y+z+A+e)}}},openPageProperties:function(a){this._$pageEdition.nlPageEdition("openPageProperties",a)},setTitleProperties:function(b){var c=this.getContent(),d=c.toLowerCase(),e="",f=c.substr(0,d.indexOf("<head"));e=c.substr(d.indexOf("<head"));var g=e.substr(0,5);e=e.substr(5);var h=e.substr(0,e.indexOf(">"));e=e.substr(e.indexOf(">"));var i=e.substr(0,1);e=e.substr(1);var j=e.substr(0,e.indexOf("</head>"));e=e.substr(e.indexOf("</head>"));var k=e.substr(0,7);e=e.substr(7);var l=j.indexOf("<title"),m=j.indexOf("</title>")+8;if(l>-1){var n=j.substr(0,l),o=j.substr(l,m-l),p=j.substr(m),q=a(o).attr(b);j=n+a("<div></div>").append(q).html()+p}else{var r="";SO.Utils.each(b,function(a,b){r+=" "+a+'="'+b+'"'}),j+="<title "+r+"></title>"}this.setContent(f+g+h+i+j+k+e)},getContentType:function(){return this.options.contentType}})})(jQuery),function(a){a.widget("NL.nlPageEdition",a.NL.nlWidget,{options:{dceWidget:null,displayProperties:!1,displaySource:!0,displaySaveTemplate:!1,displayChangeContent:!1,displayUpload:!1,pageEditionExtension:[],leftContainer:null,rightContainer:null},_create:function(){var b=this;SO.assert(b.options.rightContainer&&b.options.leftContainer,"Left and right containers are mandatory."),this._$rightContainer,b.options.rightContainer&&(this._$rightContainer=a("<div></div>"),b.options.rightContainer.append(this._$rightContainer)),this._$leftContainer,b.options.leftContainer&&(this._$leftContainer=a("<div></div>"),b.options.leftContainer.append(this._$leftContainer)),this._$uploadNewContentLink=a("<div></div>"),b.options.dceWidget||SO.log.error("A reference on the DCE widget must be defined.");var c=function(){var a;if(b._$uploadNewContentLink.is(":nl-nlListInDialog")&&(a=b._$uploadNewContentLink.nlListInDialog("selection")),a){var c=a.getItem(),d=c.name;"dceUploadFile"===d?(b.options.dceWidget.launchZIPUpload(),b.options.dceWidget.element.nlInterceptor("close")):(b.options.dceWidget.loadFromTemplate(c.PKey),b.options.dceWidget.element.is(":nl-nlInterceptor")&&b.options.dceWidget.element.nlInterceptor("close"))}b._$uploadNewContentLink.is(":nl-nlListInDialog")&&b._$uploadNewContentLink.nlListInDialog("closeDialog")},d=a.extend({},b.options.dceWidget.getConfManager().getConfig("list","contentModel"),{onDblClick:c}),e={title:nms_contentEditor.template_title(),autoOpen:!1,modal:!0,mode:"maximize",noPrimaryFirstButton:!0,dialogClass:"nl-dce-dialog",buttons:[{label:xtk_core.dialog_cancel(),cancels:!0},{label:xtk_core.dialog_ok(),click:c,mode:"primary"}]},f=function f(a){a.$el.addClass("nlui-list-dce-templates")};this._messagesController=new SO.MVC.Controller({metamodel:{messages:{type:"list",elements:{type:{type:"string"},message:{type:"string"}},keys:["message"]}},model:{messages:[]}}),this._$messagesList=a("<div></div>").soList({controller:this._messagesController,configManager:this.options.configManager,jpath:"messages",selectionMode:"none",renderingMethods:{"default":{family:"line",label:"",icon:"",renderer:function(a,b,c){var d="";return"info"===a.type&&(d="nlui-icon-alert nlui-icon-info"),"warning"===a.type&&(d="nlui-icon-alert nlui-icon-warning"),"error"===a.type&&(d="nlui-icon-alert nlui-icon-error"),NL.RenderFunctions.iconLabel({label:a.message,icon:d},b,c)}}},defaultRendering:"default",confId:"DCEMessages",fitToParentHeight:!0}),this._$messagesDialog=a("<div></div>").soDialog({title:nms_contentEditor.tools_infoMessages(),content:this._$messagesList,mode:"fullPage",padding:!0,autoOpen:!1,modal:!1,height:500,minHeight:500,width:600,minWidth:600,buttons:[]}),this._$cmdBarLeft=a('<div class="nlui-dce-pageEditionBarContainer"></div>'),this._cmdBarConfLeft={mode:"transparent",commandConfigs:{},iconSize:24,separators:!1,commands:[]},this._cmdBarConfLeft.commandConfigs.undo={help:nms_contentEditor.undo(),icon:"undo",isPushed:!1,command:function(){b.options.dceWidget.undo()}},this._cmdBarConfLeft.commands.push("undo"),this._cmdBarConfLeft.commandConfigs.redo={help:nms_contentEditor.redo(),icon:"redo",isPushed:!1,command:function(){b.options.dceWidget.redo()}},this._cmdBarConfLeft.commands.push("redo"),this._cmdBarConfLeft.commandConfigs.pageEditionChangeContent={help:nms_contentEditor.uploadNewContent(),icon:"coral-upload",command:function(){b.options.dceWidget._emptyContent?b.options.dceWidget.setCurrentState("template"):b._$uploadNewContentLink.is(":nl-nlListInDialog")&&b._$uploadNewContentLink.nlListInDialog("openDialog")}},b.options.dceWidget.setDialogTemplateList(b._$uploadNewContentLink.hide().nlListInDialog({listOptions:d,dialogOptions:e,onDialogOpen:f})),this.options.displayChangeContent&&this._cmdBarConfLeft.commands.push("pageEditionChangeContent"),this._cmdBarConfLeft.commandConfigs.pageEditionUpload={help:nms_contentEditor.uploadContent(),icon:"coral-download",command:function(){b.options.dceWidget.launchZIPUpload()}},this.options.displayUpload&&this._cmdBarConfLeft.commands.push("pageEditionUpload"),this._cmdBarConfLeft.commandConfigs.pageEditionSaveTemplate={help:nms_contentEditor.template_saveContentAsTemplate(),icon:"save-as",command:function(){b.options.dceWidget.launchSaveAsTemplate()}},this.options.displaySaveTemplate&&this._cmdBarConfLeft.commands.push("pageEditionSaveTemplate"),this._cmdBarConfLeft.commandConfigs.pageEditionPageProperties={help:nms_contentEditor.pageProperties(),icon:"content-page-properties",command:function(){b.openPageProperties()}},(this.options.displayProperties||this.options.pageEditionExtension&&this.options.pageEditionExtension.length>0)&&(this._cmdBarConfLeft.commands.push("pageEditionPageProperties"),this._cmdBarConfLeft.commands.push(null)),b._$cmdBarLeft.soCmdBar(this._cmdBarConfLeft),b._$leftContainer&&b._$leftContainer.append(b._$cmdBarLeft),this._$cmdBarMessages=a('<div class="nlui-dce-pageEditionBarContainer"></div>'),this._cmdBarConfMessages={mode:"default",flat:!0,commandConfigs:{},iconSize:24,separators:!1,commands:[]},this._cmdBarConfMessages.commandConfigs.pageEditionMessages={help:nms_contentEditor.tools_toggleMessageBox(),mode:"transparent",icon:"contentAlerts",iconSize:24,hidden:!0,command:function(){b._$messagesDialog.soDialog("open"),b._$messagesList.soList("refresh")}},this._cmdBarConfMessages.commands.push("pageEditionMessages"),this._$cmdBarMessages.soCmdBar(this._cmdBarConfMessages),b._$rightContainer&&b._$rightContainer.append(this._$cmdBarMessages),this._$cmdBarRight=a('<div class="nlui-dce-pageEditionBarContainer nlui-dce-pageEditionRightBar"></div>'),this._cmdBarConfRight={mode:"transparent",commandConfigs:{},iconSize:24,separators:!1,commands:[]},this._cmdBarConfRight.commandConfigs.pageEditionMarking={help:nms_contentEditor.toggleMarking_on(),icon:"coral-form",isPushed:!1,command:function(a){a.getCommandAttribute("pageEditionMarking","isPushed")?(b.options.dceWidget.toggleMarkingCallback("default"),a.setCommandAttribute("pageEditionMarking","isPushed",!1)):(b.options.dceWidget.toggleMarkingCallback("active"),a.setCommandAttribute("pageEditionMarking","isPushed",!0))}},this._cmdBarConfRight.commands.push("pageEditionMarking"),this._cmdBarConfRight.commandConfigs.pageEditionSource={help:nms_contentEditor.toggleSource_on(),icon:"coral-code",command:function(a){a.getCommandAttribute("pageEditionSource","isPushed")?(a.setCommandAttribute("pageEditionSource","isPushed",!1),b.options.dceWidget.startWaitDialog(nms_contentEditor.loadingContent(),function(){b.options.dceWidget.setCurrentState("edition"),b.options.dceWidget.updateFullHTMLEditorTab(),b.options.dceWidget.stopWaitDialog()})):(b.stopHighlight(),a.setCommandAttribute("pageEditionSource","isPushed",!0),b.options.dceWidget.preSaveContent(),b.options.dceWidget.updateSourceHTMLEditorTab(),b.options.dceWidget.setCurrentState("source"),b.options.dceWidget.sourceFrameResize())}},this.options.displaySource&&this._cmdBarConfRight.commands.push("pageEditionSource"),b._$cmdBarRight.soCmdBar(this._cmdBarConfRight),this._$rightContainer&&b._$rightContainer.append(b._$cmdBarRight)},destroy:function(){this._$messagesDialog&&this._$messagesDialog.is(":so-soDialog")&&(this._$messagesDialog.soDialog("destroy"),this._$messagesDialog.remove()),this._$uploadNewContentLink&&this._$uploadNewContentLink.is(":nl-nlListInDialog")&&(this._$uploadNewContentLink.nlListInDialog("destroy"),this._$uploadNewContentLink.remove()),this._$leftContainer&&this._$cmdBarLeft&&(this._$cmdBarLeft.is(":so-soCmdBar")&&this._$cmdBarLeft.soCmdBar("destroy"),this._$cmdBarLeft.remove()),this._$rightContainer&&(this._$cmdBarMessages&&(this._$cmdBarMessages.is(":so-soCmdBar")&&this._$cmdBarMessages.soCmdBar("destroy"),this._$cmdBarMessages.remove()),this._$cmdBarRight&&(this._$cmdBarRight.is("so-soCmdBar")&&this._$cmdBarRight.soCmdBar("destroy"),this._$cmdBarRight.remove()))},setMessages:function(a){this._messagesController.setValue("messages",a),this._$cmdBarMessages.soCmdBar("setCommandAttribute","pageEditionMessages","hidden",0===a.length)},startHighlight:function(){this.options.dceWidget.toggleMarkingCallback("active"),this.options.dceWidget.displayFlagToolbar(),this._$cmdBarRight.soCmdBar("setCommandAttribute","pageEditionMarking","isPushed",!0)},stopHighlight:function(){this.options.dceWidget.toggleMarkingCallback("default"),this.options.dceWidget.hideFlagToolbar(),this._$cmdBarRight.soCmdBar("setCommandAttribute","pageEditionMarking","isPushed",!1)},openPageProperties:function(b){var c=this,d=c.options.dceWidget.getPageProperties(),e=[],f=[];if(c.options.displayProperties&&(e.push(d),e[0]._$markupError=a('<div class="nl-error-message"></div>'),e[0].markup.before(e[0]._$markupError),f.push({id:"dceItem0",caption:e[0].label,selector:e[0].markup.nlForm(e[0].formConfig)}),d.formConfig.controller.startTransaction()),c.options.pageEditionExtension&&c.options.pageEditionExtension.length>0){var g;for(g=0;c.options.pageEditionExtension.length>g;g++){var h=c.options.pageEditionExtension[g];e.push(h),f.push({id:"extensionItem"+g,caption:h.label,selector:h.markup.nlForm(h.formConfig),selected:b&&b===h.id}),h.formConfig.controller.startTransaction()}}var i=a("<div></div>");e.length>1?i.nlNotebook({layout:"horizontal",tabs:f}):i.append(f[0].selector),SO.Utils.each(e,function(b,c){c._$markupError=a('<div class="nl-error-message"></div>'),c.markup.before(c._$markupError),c._$markupError.soActionMessage({title:"",message:[],state:"error"}).hide()}),a("<div></div>").append(i).soDialog({title:nms_contentEditor.pageProperties(),modal:!0,width:600,height:450,destroyOnClose:!0,removeOnClose:!0,noPrimaryFirstButton:!0,cancel:function(){SO.Utils.each(e,function(a,b){b.formConfig&&b.formConfig.controller.rollback()})},buttons:[{label:nms_contentEditor.dialog_cancel(),cancels:!0},{label:nms_contentEditor.dialog_ok(),mode:"primary",click:function(){var b=this;c.options.dceWidget.startWaitDialog(nms_contentEditor.applyChange(),function(){var d,g=0;if(SO.Utils.each(e,function(a,b){b.formConfig&&(b._$markupError.soActionMessage("option",{message:""}).hide(),b.formConfig.controller.check().valid?f[a].leftIcon="":(g++,d||(d=f[a].id),f[a].leftIcon="nlui-icon-alert nlui-icon-error"))}),0===g){var h,j=0,k=0,l=function(){k===e.length&&(c.options.dceWidget.stopWaitDialog(),0===j?a(b).soDialog("close"):(j=0,k=0,e.length>1&&h&&(i.nlNotebook("refresh"),i.nlNotebook("switchTab",h))))};c.options.dceWidget.startWaitDialog(nms_contentEditor.applyChange(),function(){SO.Utils.each(e,function(a,b){b.formConfig&&(b.formConfig.controller.isDirty()?(f[a].leftIcon="",b._$markupError.hide(),b.formConfig.controller.save(function(c){k++,c?f[a].leftIcon="":(j++,h||(h=f[a].id),f[a].leftIcon="nlui-icon-alert nlui-icon-error",b._$markupError.soActionMessage("option",{message:nms_contentEditor.landingPageProperties_save_failed()}).show()),b.formConfig.controller.startTransaction(),l()})):(k++,f[a].leftIcon="",l()))})})}else e.length>1&&d&&(i.nlNotebook("refresh"),i.nlNotebook("switchTab",d),c.options.dceWidget.stopWaitDialog())})}}]})},updateCommandState:function(a){var b=this,c=!1,d=!1,e=!1;SO.Utils.each(a,function(a,f){SO.Utils.each(f,function(f,g){b._cmdBarConfLeft.commandConfigs.hasOwnProperty(a)?(b._$cmdBarLeft.soCmdBar("setCommandAttribute",a,f,g,!0),c=!0):b._cmdBarConfMessages.commandConfigs.hasOwnProperty(a)?(b._$cmdBarMessages.soCmdBar("setCommandAttribute",a,f,g,!0),d=!0):b._cmdBarConfRight.commandConfigs.hasOwnProperty(a)&&(b._$cmdBarRight.soCmdBar("setCommandAttribute",a,f,g,!0),e=!0)})}),c&&b._$cmdBarLeft.soCmdBar("refresh"),d&&b._$cmdBarMessages.soCmdBar("refresh"),e&&b._$cmdBarRight.soCmdBar("refresh")}})}(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";function HtmlUploader(a,b){FileUploader.call(this,a,b)}SO.ns("NL.DCEUpload"),NL.DCEUpload.registered={},NL.DCEUpload.currentUpload=null,NL.DCEUpload.setCurrentUpload=function(a){this.currentUpload=this.registered.hasOwnProperty(a)?a:null},NL.DCEUpload.registerUploadConfig=function(a,b){this.registered[a]=b},NL.DCEUpload.getRegisteredUploadConfig=function(a){return this.registered.hasOwnProperty(a)?this.registered[a]:null};var Uploader=function(a,b,c,d,e,f,g,h,i){this.files=a,this.iFilesCount=a?a.length:1,this.iFilesProcessed=0,this.aImgSrcVsMd5={},this.$element=b,this.serverUrl=window.location.protocol+"//"+window.location.host,this.mode=c,this.manualRendering=d,this.startCallback=e,this.completeCallback=f,this.errorCallback=g,this.progressCallback=h,this.logList=null,this.saveAsFileRes=SO.isBoolean(i)?i:!0,this.spinnerOpts={lines:12,length:7,width:5,radius:10,color:"#FFF",speed:1,trail:100,shadow:!0},this.htmlType=new RegExp("text/html"),this._$jsSpinner=$('<div class="jsSpinner" style="display:none;position:fixed; top: 200px; left: 50%; width: 50px;"></div>'),$("body").append(this._$jsSpinner)};Uploader.prototype.stopSpinner=function(){this._$jsSpinner.is(":so-soSpinner")&&this._$jsSpinner.soSpinner("destroy")},Uploader.prototype.setSpinnerPosition=function(a,b){this._$jsSpinner&&this._$jsSpinner.css({position:"absolute",top:a,left:b})},Uploader.prototype.resetSpinnerPosition=function(){this._$jsSpinner&&this._$jsSpinner.css({position:"fixed",top:"200px",left:"50%"})},Uploader.prototype.Start=function(){if("monoImage"==this.mode&&this._$jsSpinner.soSpinner({params:this.spinnerOpts}).show(),this.iFilesCount>0){var a;for(a=0;this.iFilesCount>a;a++){var b,c=this.files[a];c.type.match(this.htmlType)?(b=new HtmlUploader(c,this),b.Upload()):(b=new FileUploader(c,this),b.Upload())}SO.isFunction(this.startCallback)&&this.startCallback(this)}else this._$jsSpinner.soSpinner("destroy"),$("<div></div>").soMessageBox({type:"error",message:nms_contentEditor.upload_noFileToUpload()})},Uploader.prototype.AddImage=function(a,b,c,d){"monoImage"==this.mode?(this.strOriginalImageSrc=a,this.strImageMd5=b,this.strFileName=d,this.newUrl=c+a.substr(a.lastIndexOf(".")+1)):this.aImgSrcVsMd5[a]=b},Uploader.prototype.AddFile=function(a,b,c,d){this.strOriginalFileName=a,this.strFileMd5=b,this.strFileName=d,this.newUrl=c+a.substr(a.lastIndexOf(".")+1)},Uploader.prototype.SetHtmlUrl=function(a,b){this.htmlUrl=b+a.substr(a.lastIndexOf("."))},Uploader.prototype.FileProcessed=function(){this.iFilesProcessed++,this.iFilesProcessed===this.iFilesCount&&SO.isFunction(this.completeCallback)&&this.completeCallback(this)},Uploader.prototype.UploadError=function(a,b){var c=(b?b.getMethodName()+" ":"")+(a?a.details:nms_contentEditor.upload_noErrorDetails());this.logList?this.logList.push({status:NL.JobInterface.JOBSTATUS_ERROR,logType:NL.JobInterface.JOBLOGTYPE_ERROR,message:c}):("monoImage"===this.mode&&this._$jsSpinner.soSpinner("destroy"),$("<div></div>").soMessageBox({type:"error",message:nms_contentEditor.upload_failed(),details:c})),SO.isFunction(this.errorCallback)&&this.errorCallback(a,b)};var FileUploader=function(a,b){"undefined"!=typeof a&&("string"==typeof a?this.fileName=a:(this.file=a,this.fileName=a.name),this.uploader=b,this.serverUrl=window.location.protocol+"//"+window.location.host)};FileUploader.prototype.onSoapRequestCompleted=function(a,b){var c=this;if(c.uploader.saveAsFileRes)if(null===b)if("IncreaseValue"==a.getMethodName()){var d=a.getNextInt();this.ndFileRes=parseXMLString('<fileRes name="RES'+d+'"'+' md5="'+this.md5+'"'+' label="'+this.fileName+'"'+' fileName="'+this.fileName+'"'+' originalName="'+this.fileName+'"'+' useMd5AsFilename="1"'+' storageType="5"'+' xtkschema="xtk:fileRes"'+"/>"),a.checkNoMoreArgs();var e=new NL.transport.SOAP({urn:"xtk:persist",method:"Write"});e.writeDocument("doc",this.ndFileRes),e.start({onSuccess:function(a){c.onSoapRequestCompleted(a,null)},onError:function(a){c.onSoapRequestCompleted(null,a)}})}else if("Write"==a.getMethodName()){var a=new NL.transport.SOAP({urn:"xtk:fileRes",method:"WebPostUpload"});a.writeDocument("entity",this.ndFileRes),a.writeDocument("params",new NL.XML.Node("params")),a.start({onSuccess:function(a){c.onSoapRequestCompleted(a,null)},onError:function(a){c.onSoapRequestCompleted(null,a)}})}else if("WebPostUpload"==a.getMethodName()){var a=new NL.transport.SOAP({urn:"xtk:fileRes",method:"PublishIfNeeded"});a.writeDocument("entity",this.ndFileRes),a.start({onSuccess:function(a){c.onSoapRequestCompleted(a,null)},onError:function(a){c.onSoapRequestCompleted(null,a)}})}else if("PublishIfNeeded"==a.getMethodName()){var a=new NL.transport.SOAP({urn:"xtk:fileRes",method:"GetURL"});a.writeDocument("entity",this.ndFileRes),a.start({onSuccess:function(a){c.onSoapRequestCompleted(a,null)},onError:function(a){c.onSoapRequestCompleted(null,a)}})}else{a.skip();var f=a.getNextString();a.checkNoMoreArgs(),this.FileProcessed(f)}else this.uploader.UploadError(b,a)},FileUploader.prototype.PostUpload=function(a,b){var c=this;if(this.md5=a,this.newFileName=b,c.uploader.saveAsFileRes){var d=new NL.transport.SOAP({urn:"xtk:counter",method:"IncreaseValue"});d.writeString("name","xtkResource"),d.start({onSuccess:function(a){c.onSoapRequestCompleted(a,null)},onError:function(a){c.onSoapRequestCompleted(null,a)}})}else c.FileProcessed()},FileUploader.prototype.Upload=function(){var a,b,c,d=new FormData,e=this;d.append("file_noMd5",this.file),b=jQuery.ajaxSettings.xhr(),b.upload&&b.upload.addEventListener("progress",function(a){SO.isFunction(e.uploader.progressCallback)&&e.uploader.progressCallback(a)},!1),c=function(){return b},a=new NL.transport.AJAX({url:"/nl/jsp/uploadFile.jsp",data:d,cache:!1,contentType:!1,processData:!1,type:"POST",xhr:c}),a.start({onSuccess:function(a){var b=a.match(/md5 : "([0-9a-f]*)"/),c=a.match(/newFileName : "(.*)"/);e.PostUpload(b?b[1]:"",c?c[1]:"")},onError:function(a){e.uploader.UploadError(a)}})},FileUploader.prototype.FileProcessed=function(a){"monoImage"===this.uploader.mode?this.uploader.AddImage(this.fileName,this.md5,a,this.newFileName):this.uploader.AddFile(this.fileName,this.md5,a,this.newFileName),this.uploader.FileProcessed()},HtmlUploader.prototype=new FileUploader,HtmlUploader.prototype.Upload=function(){var a,b,c,d=new FormData,e=this;d.append("file_noMd5",this.file),b=jQuery.ajaxSettings.xhr(),b.upload&&b.upload.addEventListener("progress",function(a){SO.isFunction(e.uploader.progressCallback)&&e.uploader.progressCallback(a)},!1),c=function(){return b},a=new NL.transport.AJAX({url:"/nl/jsp/uploadFile.jsp",data:d,cache:!1,contentType:!1,processData:!1,type:"POST",xhr:c}),a.start({onSuccess:function(a){var b=a.match(/md5 : "([0-9a-f]*)"/),c=a.match(/newFileName : "(.*)"/);e.PostUpload(b?b[1]:"",c?c[1]:"")},onError:function(a){e.uploader.UploadError(a)}})},HtmlUploader.prototype.FileProcessed=function(){this.uploader.SetHtmlUrl(this.fileName,this.md5),this.uploader.FileProcessed()},document.controller={uploadFileCallBack:function(a){var b=NL.DCEUpload.getRegisteredUploadConfig(NL.DCEUpload.currentUpload);if(b){var c=new Uploader(b.files,b.element,b.type,b.manual,b.startCallback,b.completeCallback,b.errorCallback,b.progressCallback,b.saveAsFileRes);if("monoImage"==c.mode&&c._$jsSpinner.soSpinner({params:c.spinnerOpts}).show(),a){var d;for(d=0;a.length>d;d++)b.fileType.match(c.htmlType)?(fileUploader=new HtmlUploader(a[d].newFileName,c),fileUploader.PostUpload(a[d].md5,a[d].newFileName)):(SO.isFunction(c.startCallback)&&c.startCallback(c),fileUploader=new FileUploader(a[d].newFileName,c),fileUploader.PostUpload(a[d].md5,a[d].newFileName))}}}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlMediaLibrary",a.NL.nlWidget,{options:{sections:{}},_create:function(){var b=this,c=!0,d=a("<div></div>");a.each(this.options.sections,function(b,e){var f=a("<div></div>").appendTo(d);f.nlCollapsableSection({collapsed:!c,legend:e.title});var g=a("<div></div>");e.treeList?g.soTreeList(a.extend({},e.list,{draggable:{dragZoneId:b},maxHeight:300,title:null,renderingMethods:{defaultTreeRender:{renderer:NL.RenderFunctions.defaultTree,label:"",icon:"",family:"treeNode"}}})):g.soList(a.extend({},e.list,{draggable:{dragZoneId:b},maxHeight:300,title:null})),f.nlCollapsableSection("append",g),c=!1}),d.appendTo(b.element)}})})(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";function NL_DCEController_getContent(){return NL.DCEController.getContent()}function NL_DCEController_isDirty(){return NL.DCEController.isDirty()}SO.ns("NL.DCEController"),function(){NL.DCEController.register=function(a){this.$dceElement?SO.log.error("You cannot register more thant one DCE widget."):this.$dceElement=a},NL.DCEController.toggleTransitions=function(a){if(this.$dceElement){var b=NL.XTK.parseBoolean(a,!1),c=this.$dceElement.nlDCE("option","hyperlinks");c.navigationActions=b,this.$dceElement.nlDCE("option","hyperlinks",c);var d=this.$dceElement.nlDCE("option","form");d.button.navigationActions=b,this.$dceElement.nlDCE("option","form",d)}},NL.DCEController.setOption=function(a,b){this.$dceElement&&this.$dceElement.nlDCE("option",a,b)},NL.DCEController.setContentFragmentContentType=function(a){if(this.$dceElement){var b=NL.XTK.toString(a);"0"===b||"2"===b?this.$dceElement.nlDCE("option","hyperlinks",{linkTarget:!0,landingPage:!0,navigationActions:!0}):this.$dceElement.nlDCE("option","hyperlinks",{linkTarget:!1,landingPage:!0,navigationActions:!1})}},NL.DCEController.setCurrentState=function(a){this.$dceElement&&this.$dceElement.nlDCE("setCurrentState",a)},NL.DCEController.preSaveContent=function(){this.$dceElement&&this.$dceElement.nlDCE("preSaveContent")},NL.DCEController.isDirty=function(){return this.$dceElement?this.$dceElement.nlDCE("isDirty"):!1},NL.DCEController.getContent=function(){return this.$dceElement?this.$dceElement.nlDCE("getContent",!0):""},NL.DCEController.onConsoleEditorTabHide=function(){SO.PopableManager.collapseAll(),$(".nlui-uiDialog").soDialog("cancel"),this.$dceElement&&this.$dceElement.nlDCE("deselectAll")},NL.DCEController.setContentFragmentContentType=function(a){var b="0"===NL.XTK.toString(a)||"2"===NL.XTK.toString(a);if(this.$dceElement){this.$dceElement.nlDCE("deselectAll",!0),this.$dceElement.nlDCE("option","pageProperties",b);var c=this.$dceElement.nlDCE("option","hyperlinks");c.linkTarget=b,c.navigationActions=b,this.$dceElement.nlDCE("option","hyperlinks",c),this.$dceElement.nlDCE("option","form",{button:{navigationActions:b},bindingStorage:{xpath:b}});var d=this.$dceElement.nlDCE("option","localization");d.enabled=b,this.$dceElement.nlDCE("option","localization",d)}}}();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Shell",{DEFAULT_OPTIONS:{session:null,logOutUrl:null,helpURL:null,navigationRail:{title:null,collapsed:!1,rootPath:null,selection:null},breadcrumb:{collapsed:!0,content:[]},rail:{padding:!1,position:"left",collapsed:!0,content:null,tabs:[]},actionBar:{railTabs:!1,globalActions:!1,localActions:!1,viewConfig:!1,viewSwitcher:!1,reports:!1},canvas:{content:null,padding:!1,background:!0},context:{icon:null,label:null,url:null},solution:{icon:null,label:null,url:null},footer:!0,blackBar:{title:null,toggleButton:!0,rightContent:[],help:!1,badger:null},titleBar:null,badger:null,onRailViewSelect:function(){}},_create:function(){return this.$el.addClass("nlui-shell"),this._options.params&&(this._options=SO.Utils.extend(this._options,this._options.params),SO.assert(!this._options.params,"Shell _options.params is deprecated, use _options instead.")),this._$page=null,this._$navigationRail=null,this._navRailVisible=!0,this._$blackBar=null,this._$title=null,this._$breadcrumb=null,this._$perl=null,this._grayBar=null,this._grayBarAlreadyAdded=!1,this._$innerRail=null,this._$actionBarContainer=null,this._$actionBars={railTabs:null,globalActions:null,localActions:null,viewConfig:null,viewSwitcher:null,reports:null},this._$canvas=null,this._$canvasWrapper=null,this._$footer=null,this._footerVisible=!0,this._animated=!0,this._breadCrumbVisible=this._options.breadcrumb&&!this._options.breadcrumb.collapsed,this._navRailVisible=this._options.navigationRail&&!this._options.navigationRail.collapsed,this._railVisible=this._options.rail&&!this._options.rail.collapsed,this._currentTabId=void 0,this._idToName={},this._views=[],this.$el.parent().addClass("nlui-shell-parent"),this._buildBreadcrumb(),this._$page=$('<div class="nlui-shell-page"></div>').appendTo(this.$el),this._$perl=$('<div class="nlui-shell-perl clui-light"></div>'),this._options.navigationRail?(this._$navigationRail=$('<div class="nlui-shell-navrail"></div>'),this._$page.append(this._$navigationRail),this._$page.append(this._$perl),this._buildNavigationRail()):this._$page.append(this._$perl),this._options.layoutManager.registerWidget(this),SO.assert(!this._options.titleBar,"The titleBar option is deprecated. Use blackBar option instead"),this._options.titleBar&&(this._options.blackBar=SO.Utils.extend(this._options.blackBar,this._options.titleBar)),SO.assert(!this._options.badger,"The badger option is deprecated. Use blackBar.badger option instead"),this._options.badger&&this._options.blackBar&&(this._options.blackBar.badger=this._options.badger),this._options.blackBar!==!1&&this._buildBlackBar(),this._buildRail(),this._buildCanvas(),this._breadCrumbVisible?this.showBreadcrumb():this.hideBreadcrumb(),this._railVisible&&(this._options.rail.tabs||this._options.rail.content)&&0!==this._options.rail.tabs.length||this.hideRail(),this._animated&&this._enableAnimation(),this._options.layoutManager.rebuildLayout(this._$canvasWrapper),this},_enableAnimation:function(){var a=this;return setTimeout(function(){a.$el.addClass("nlui-shell-animated")}),this._animated=!0,this},_disableAnimation:function(){return this.$el.removeClass("nlui-shell-animated"),this._animated=!1,this},_buildBlackBar:function(){var a,b,c,d,e;if(b=this,c=this._options.blackBar,this._$blackBar=$('<header class="nlui-shell-blackbar"></header>'),c.toggleButton&&(this._$toggleNavIcon=SO.IMG.genIcon("rail-collapse-white",18).addClass("nlui-shell-togglenav-button").appendTo(this._$blackBar),SO.Event.bind(this._$toggleNavIcon.get(0),"vclick",function(){b.toggleNavigationRail()})),this._lastLink&&(this._$backIcon=$('<a class="nlui-shell-back-button" href="'+this._lastLink.url+'" />').append(SO.IMG.genIcon("shell-back-white",18).addClass("nlui-shell-back-button-icon")).appendTo(this._$blackBar),this._$backIcon.soTooltip({title:this._lastLink?this._lastLink.label:this._options.solution?this._options.solution.label:""})),this.setTitle(c.title),this._$info=$('<div class="nlui-shell-info"></div>'),c.rightContent)for(e=c.rightContent.length,a=0;e>a;a+=1)this._$info.append(c.rightContent[a]);return this._options.helpURL&&(this._helpLink=SO.LinkBuilder.genDomObject(this._options.helpURL,xtk_sirocco.shell_helpLabel(),null,"_blank"),this._helpLink.classList.add("nlui-shell-info-help"),this._$info.append(this._helpLink)),this._$blackBar.append(this._$info),this._options.session&&this._options.session.user&&(d=SO.IMG.genIcon("user-white",24),this._$operator=$('<div class="nlui-shell-info-operator"></div>').append(d).appendTo(this._$info),this._buildOperatorConfig()),null!==c.badger&&void 0!==c.badger&&this.setBadger(c.badger),this._$blackBar.appendTo(this._$perl),this._$title&&this._$title.css("margin-right",this._$info.outerWidth(!0)),this},_buildOperatorConfig:function(){var a,b;return a=this,this._$operator&&(b=new SO.Widgets.SimpleButton($("<div></div>"),{label:xtk_core.shell_signout(),mode:"primary",onClick:function(){window.location.replace(a._options.logOutUrl)}}),new SO.Widgets.popover(this._$operator,{params:{classNames:"nlui-shell-popover",displayOn:"click",content:[$('<div class="nlui-content-padding nlui-shell-operator-name"></div>').append(SO.IMG.genIcon("user",24),$('<span class="nlui-shell-info-operator-label">'+this._options.session.user.login+"</span>")),$('<div class="nlui-content-padding nlui-shell-operator-actions"></div>').append(b.$el)]}})),this},showOperator:function(){return this._helpLink&&$(this._helpLink).show(),this._$operator?this._$operator.show():SO.assert(!1,"There is no operator container to show"),this},hideOperator:function(){return this._helpLink&&$(this._helpLink).hide(),this._$operator?this._$operator.hide():SO.assert(!1,"There is no operator container to hide"),this},setTitle:function(a){var b=this;return this._$title||(this._$title=$('<div class="nlui-shell-blackbar-title"></div>').appendTo(this._$blackBar),this._$title.get(0)&&SO.Event.bind(this._$title.get(0),"vclick",function(){b.toggleBreadcrumb()})),this._$title.text(null===a||void 0===a?"":a),this},setBadger:function(a){return this._$badger||(this._$badger=$('<div class="nlui-shell-info-badger"></div>'),this._$info.append(this._$badger)),"0"===a||0===a?this._$badger.addClass("nlui-shell-info-badger-empty"):this._$badger.removeClass("nlui-shell-info-badger-empty"),this._$badger.text(a),this},_buildBreadcrumb:function(){var a,b,c,d,e,f,g,h,i;for(b=this,d=[],h=this._options.context.label,e=this._options.breadcrumb.content,f=e.length,this._$breadcrumb=$('<nav class="nlui-shell-breadcrumb"></nav>'),this._$breadcrumbOther=$('<div class="nlui-shell-breadcrumb-other"></div>'),g=SO.IMG.genIcon("unfold-element-white",18).addClass("nlui-shell-breadcrumb-collapse"),SO.Event.bind(g.get(0),"vclick",function(){b.hideBreadcrumb()}),this._options.context.icon&&this._$breadcrumb.append($('<div class="nlui-shell-breadcrumb-logo"></div>').append(SO.IMG.genIcon(this._options.context.icon,24).addClass("nlui-shell-logo")).on("click",function(){window.open(b._options.context.url)})),h&&(this._contextLink=SO.LinkBuilder.genDomObject(this._options.context.url,h,null,"_blank"),this._contextLink.classList.add("nlui-breadcrumb-element"),this._addBreadcrumbNode(this._contextLink,f>0)),a=0;f>a;a+=1)c=e[a],i=SO.LinkBuilder.genDomObject(c.url,c.label,c.help),i.classList.add("nlui-breadcrumb-element"),this._addBreadcrumbNode(i,!0),c.url&&(this._lastLink=c);return this._$breadcrumb.append(this._$breadcrumbOther,g).appendTo(this.$el),this},_addBreadcrumbNode:function(a,b,c){var d;return d=[a],c=c||this._$breadcrumbOther,b&&d.push($('<span class="nlui-breadcrumb-separator">/</span>')),c.append(d),this},toggleBreadcrumb:function(){return this._breadCrumbVisible?this.hideBreadcrumb():this.showBreadcrumb(),this},showBreadcrumb:function(){var a=this;return this._breadCrumbVisible=!0,this._$breadcrumb.css("transform","translateY(0px)"),this._$perl.Y=this._$breadcrumb[0].offsetHeight,this._$perl.css("transform","translate3d("+(this._$perl.X||0)+"px, "+this._$perl.Y+"px, 0)"),setTimeout(function(){a._$perl.css("bottom",a._$breadcrumb.outerHeight(!0)+"px"),a._options.navigationRail&&(a._navList.allowScroll(),a._options.layoutManager.rebuildLayout(a._$navigationRail))},250),this},hideBreadcrumb:function(){var a=this;return this._breadCrumbVisible=!1,this._$perl.css("bottom",0),a._$perl.Y=0,a._$breadcrumb.css("transform","translateY("+(-a._$breadcrumb[0].offsetHeight||-44)+"px)"),a._$perl.css("transform","translate3d("+(a._$perl.X||0)+"px, 0px, 0)"),this},toggleNavigationRail:function(){return this._navRailVisible?this.hideNavigationRail():this.showNavigationRail(),this},showNavigationRail:function(){return this._toggleAnimation("show",this._$navigationRail,this._$perl),this._navRailVisible=!0,this._$toggleNavIcon&&this._$toggleNavIcon.removeClass("nlui-shell-togglenav-button-closed"),this._showContextLabel(),this},hideNavigationRail:function(){return this._toggleAnimation("hide",this._$navigationRail,this._$perl),this._navRailVisible=!1,this._$toggleNavIcon&&this._$toggleNavIcon.addClass("nlui-shell-togglenav-button-closed"),this._hideContextLabel(),this},toggleRail:function(){return this._railVisible?this.hideRail():this.showRail(),this._options.layoutManager.rebuildLayout(this._$canvasWrapper),this},_getRailView:function(){var a=this._viewBar.getCurrentView()||this._oldCurrentRailView||this._views[0];return a},showRail:function(){return this._isRailDisabled||(this._toggleAnimation("show",this._$innerRail,this._$canvasWrapper),this._railVisible=!0,this._viewBar&&this._viewBar.switchView(this._getRailView())),this},hideRail:function(){return this._toggleAnimation("hide",this._$innerRail,this._$canvasWrapper),this._railVisible=!1,this._currentTabId=void 0,this._viewBar&&(this._oldCurrentRailView=this._getRailView(),this._viewBar.switchView(null)),this},disableRail:function(){this._isRailDisabled=!0,this._wasRailVisible=this._railVisible,this._disableAnimation(),this.hideRail(),this._$viewBar&&(this._$viewBar.hide(),this._$viewBarSeparator.hide()),this._enableAnimation()},enableRail:function(){this._isRailDisabled=!1,this._wasRailVisible&&this.showRail(),this._$viewBar&&(this._$viewBar.show(),this._$viewBarSeparator.show())},_toggleAnimation:function(a,b,c){var d,e,f,g;return d=this,g=!1,b&&c&&(e=b.outerWidth(!0),g=e>0?!0:!1,f=250,"hide"===a?(setTimeout(function(){d._options.layoutManager.rebuildLayout(d._$canvasWrapper),d._checkFooter()},f),c.X=-e,c.css({right:-e+"px",transform:"translate3d("+c.X+"px, "+(c.Y||0)+"px, 0)"})):(setTimeout(function(){c.css("right","0"),d._options.layoutManager.rebuildLayout(d._$canvasWrapper),d._checkFooter()},f),c.X=0,c.css("transform","translate3d(0px, "+(c.Y||0)+"px, 0)"))),g},_hideContextLabel:function(){if(this._contextLink){var a=this._contextLink.offsetWidth+10;a>170&&(a=158),this._$breadcrumbOther.css("transform","translateX(-"+a+"px)")}return this},_showContextLabel:function(){return this._$breadcrumbOther.css("transform","translateX(0px)"),this},_buildNavigationRail:function(){var a,b,c,d,e,f,g,h,i,j;return a=this,b=this._options,d=this._options.navigationRail.title,c=this._options.context.label,j=b.solution,h=$('<div class="nlui-rail-context"></div>'),this._options.context.icon&&h.append(SO.IMG.genIcon(this._options.context.icon,24).addClass("nlui-shell-logo")),d?h.append($("<span>"+d+"</span>")):c&&h.append($("<span>"+c+"</span>")),this._options.context.url&&h.on("click",function(){window.open(a._options.context.url)}),this._$navigationRail.append(h),j&&(j.label||j.icon)&&(j.url=j.url||"#",i=$('<a href="'+j.url+'" class="nlui-rail-solution"></a>'),j.icon&&i.append(SO.IMG.genIcon(j.icon,24).addClass("nlui-shell-logo")),j.label&&i.append($("<span>"+j.label+"</span>")),this._$navigationRail.append(i)),f=this._options.navigationRail,g={data:f.data,rootPath:f.rootPath,selection:f.selection,scrollOnInit:!1,localStorage:{selection:!1,settings:!1}},e=$("<div></div>"),this._$navigationRail.nlRail({theme:"dark",position:"left",collapsed:f.collapsed,content:e}),this._navList=new SO.Widgets.navigationList(e,g),this},_buildRail:function(){var a,b;return a=this._options.rail,a&&(a.content&&(SO.assert(!a.content,"Shell rail.content option is deprecated. Use rail.tabs option instead."),b=SO.isFunction(a.content)?a.content():a.content,this._options.rail.tabs.push({content:b})),this._$perl.addClass("left"===a.position?"nlui-shell-perl-leftrail":"nlui-shell-perl-rightrail"),this._$innerRail=$('<div class="nlui-shell-rail"></div>'),this._innerRail=new SO.Widgets.rail(this._$innerRail,{position:a.position,collapsed:a.collapsed}),this._$innerRail.appendTo(this._$perl),this._buildRailView()),this},_buildRailView:function(){var a,b,c,d,e,f,g,h;if(b=this,c=this._options.rail.tabs,d=c.length,d>0){for(a=0;d>a;a+=1)e=c[a],f="railView"+a,h=e.icon,e.selected&&(g=f,h=e.icon),b.addRailView({icon:h,id:e.id,caption:e.caption,label:e.label,padding:e.padding,visible:e.visible,content:SO.isFunction(e.content)?e.content():e.content},e.selected,!0);!g&&this._viewBar&&this._railVisible&&(this._viewBar.switchView(this._views[0]),this._currentTabId=c[0].id)}return this},addRailView:function(a,b,c){var d,e,f,g,h,i,e,j;return d=this,g=a.icon||a.caption,h=a.id,!this._viewBar&&g&&(this._$viewBar=$('<div class="nlui-shell-viewbar"></div>'),this._viewBar=new SO.Widgets.viewBar(this._$viewBar,{mode:"transparent",controller:new SO.MVC.Controller({metamodel:{}}),iconSize:24,onSwitchView:function(a,b){d._options.onRailViewSelect(a,b)}}),this._$viewBarSeparator=$('<div class="nlui-shell-viewbar-separator"></div>'),c?(this._options.actionBar.railTabs=this._options.actionBar.railTabs||[],this._options.actionBar.railTabs.unshift(this._$viewBar,this._$viewBarSeparator)):(this.addActionBarContent("railTabs",this._$viewBar),this.addActionBarContent("railTabs",this._$viewBarSeparator))),f=$('<div class="nlui-shell-railview"></div>'),a.label&&f.append($('<div class="nlui-shell-railview-header nlui-text-regularmedium nlui-text-bold"><div class="nlui-shell-railview-header-content">'+a.label+"</div></div>")),i=$('<div class="nlui-shell-railview-body"></div>').append(SO.isFunction(a.content)?a.content():a.content),a.padding&&i.addClass("nlui-content-padding"),f.append(i),this._innerRail.addContent(f),g&&(f.hide(),e="railView"+this._views.length,this._views.push(e),void 0!==h&&(this._idToName[h]=e),j=SO.Utils.extend({type:"block",onBeforeExecuteCommand:function(){d._viewBar.getCurrentView()===e&&d._railVisible?(d.hideRail(),d._currentTabId=void 0):(d.showRail(),d._currentTabId=h)},onDisplay:function(){$("input:text",f).first().focus()}},{iconSize:24,icon:a.icon,visible:a.visible,blocks:[f],help:a.caption}),d._viewBar.addView(e,j),j.visible===!1?d.toggleRailTab(h,j.visible):(b||b!==!1&&void 0===this._currentTabId)&&(d._viewBar.triggerView(e),d._currentTabId=h)),this},clearRailViews:function(){return this._innerRail&&this._viewBar&&(this._viewBar.destroy(),this._$viewBar.remove(),this._$viewBarSeparator.remove(),this._views=[],this._viewBar=null,this.hideRail(),this._innerRail.clearContent()),this},selectRailView:function(a){var b,c;return c=a-1,b=this._views[c],SO.assert(b,"View "+c+" doesn't exists"),b&&b===this._viewBar.getCurrentView()?this._options.onRailViewSelect(b,c):b&&this._viewBar.triggerView(b),this},_buildCanvas:function(){var a,b;return b=this._options.canvas,a=this._options.actionBar,SO.assert(b&&b.content,"Cannot instantiate a shell with no canvas"),this._$canvasWrapper=$('<div class="nlui-shell-canvas"></div>'),b.background||this._$canvasWrapper.css("background","none"),(a.railTabs||a.globalActions||a.localActions||a.viewConfig||a.viewSwitcher||a.reports)&&this._buildActionBar(),this._$canvas=$('<div class="nlui-shell-canvas-container"></div>').appendTo(this._$canvasWrapper),this._$canvasWrapper.appendTo(this._$perl),this._$canvas.append(b.content),this._options.footer!==!1&&this._buildFooter(),this.setCanvasPadding(b.padding),this},setCanvasPadding:function(a){return!this._canvasPadding&&a?(this._$canvas.addClass("nlui-content-padding"),this._canvasPadding=!0):this._canvasPadding&&(this._$canvas.removeClass("nlui-content-padding"),this._canvasPadding=!1),this},_buildActionBar:function(){var a=this._$actionBarContainer=$('<nav class="nlui-shell-graybar" />');return this._grayBar=new SO.Widgets.GrayBar(a,{zones:this._options.actionBar}),this},addActionBarContent:function(a,b){return this._grayBar||this._buildActionBar(),this._grayBarAlreadyAdded||(this._$canvasWrapper.prepend(this._$actionBarContainer),this._grayBarAlreadyAdded=!0),this._grayBar.addActionBarContent(a,b)},getActionBar:function(a){return this._grayBar||this._buildActionBar(),this._grayBar.getActionBar(a)},_buildFooter:function(){var a="nlui-shell-footer";return this._$footer=$('<footer class="'+a+'"></footer>').append($('<div class="nlui-shell-footer-legal">'+xtk_sirocco.shell_footerCopyrightLabel((new Date).getFullYear())+"</div>"),$('<a href="https://marketing.adobe.com/resources/help/en_US/home/">'+xtk_sirocco.shell_helpLabel()+"</a>"),$('<a href="http://www.adobe.com/go/gffooter_terms_of_use">'+xtk_sirocco.shell_footerTermOfUseLabel()+"</a>"),$('<a href="http://www.adobe.com/go/marketingcloud_privacy">'+xtk_sirocco.shell_footerPrivacyLabel()+"</a>")),this._$canvasWrapper.append(this._$footer),this._footerVisible?this.showFooter():this.hideFooter(),this._checkFooter(),this},toggleFooter:function(){return this._footerVisible?this.hideFooter():this.showFooter(),this},showFooter:function(){return this._footerVisible=!0,this._$footer.show(),this},hideFooter:function(){return this._footerVisible=!1,this._$canvas.css("bottom",0),this._$footer.hide(),this},setRailContent:function(a){return this._innerRail.setContent(a),this.showRail(),this},toggleRailTab:function(a,b){return b||this._currentTabId!==a||this.hideRail(),void 0!==this._idToName[a]&&this._viewBar.setViewAttribute(this._idToName[a],"hidden",!b,!1),this},rebuildLayout:function(){var a=!1;return this._options.navigationRail&&!this._navRailVisible&&this._$navigationRail[0].offsetWidth>0&&(this._disableAnimation(),this.hideNavigationRail(),a=!0),!this._railVisible&&this._$innerRail&&this._$innerRail[0].offsetWidth>0&&(a||this._disableAnimation(),this.hideRail(),a=!0),a&&this._enableAnimation(),this._checkFooter(),this},_checkFooter:function(){var a,b,c;this._$footer&&(a=document.documentElement,b=document.body,c=this._$canvas[0].offsetWidth,c>=481&&767>=c?(this._$footer.removeClass("nlui-shell-footer-mobile").addClass("nlui-shell-footer-tablet"),this._tmpMobileFooter=!0):c>=260&&480>=c?(this._$footer.removeClass("nlui-shell-footer-tablet").addClass("nlui-shell-footer-mobile"),this._tmpMobileFooter=!0):this._tmpMobileFooter&&(this._$footer.removeClass("nlui-shell-footer-tablet nlui-shell-footer-mobile"),this._tmpMobileFooter=!1),this._$canvas.css("bottom",this._$footer.outerHeight(!0)))},hideActionbar:function(){return this._grayBar&&this._grayBar.hide(),this},showActionbar:function(){return this._grayBar&&this._grayBar.show(),this},getCanvas:function(){return this._$canvas},destroy:function(){return this._$blackBar.remove(),this._options.navigationRail&&this._$navigationRail.remove(),this._$innerRail.remove(),this._$canvasWrapper.remove(),this.$el.removeClass("nlui-shell"),$.NL.nlWidget.prototype.destroy.call(this),this}}),$.widget("SO.soShell",{_create:function(){this._widget=new SO.Widgets.Shell(this.element,this.options)},setBadger:function(a){this._widget.setBadger(a)},toggleBreadcrumb:function(){this._widget.toggleBreadcrumb()},showBreadcrumb:function(){this._widget.showBreadcrumb()},hideBreadcrumb:function(){this._widget.hideBreadcrumb()},toggleNavigationRail:function(){this._widget.toggleNavigationRail()},showNavigationRail:function(){this._widget.showNavigationRail()},hideNavigationRail:function(){this._widget.hideNavigationRail()},toggleRail:function(){this._widget.toggleRail()},showRail:function(){this._widget.showRail()},hideRail:function(){this._widget.hideRail()},addActionBarContent:function(a,b){this._widget.addActionBarContent(a,b)},toggleFooter:function(){this._widget.toggleFooter()},showFooter:function(){this._widget.showFooter()},hideFooter:function(){this._widget.hideFooter()},setRailContent:function(a){this._widget.setRailContent(a)},hideActionbar:function(){this._widget.hideActionbar()},showActionbar:function(){this._widget.showActionbar()},disableRail:function(){this._widget.disableRail()},enableRail:function(){this._widget.enableRail()},getCanvas:function(){return this._widget.getCanvas()},destroy:function(){this._widget.destroy()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("rail",{DEFAULT_OPTIONS:{position:"left",collapsed:!1,content:null},_create:function(){this.$el.addClass("nlui-rail"),this._collapsed=void 0,this._hasContent=!1,this.toggle(!this._options.collapsed),this._$railContentWrapper=$('<div class="nlui-rail-wrap"></div>').appendTo(this.$el),this._options.content&&this.setContent(this._options.content)},destroy:function(){},toggle:function(a){void 0===a&&(a=this._collapsed),this._collapsed=!a},setContent:function(a){return this._$railContentWrapper.children().remove(),this.addContent(a),this},addContent:function(a){return this._$railContentWrapper.append(a),this._hasContent||(this._hasContent=!0),this},clearContent:function(){return this._$railContentWrapper.empty(),this}}),$.widget("NL.nlRail",$.NL.nlWidget,{_create:function(){this._widget=new SO.Widgets.rail(this.element,this.options)},_destroy:function(){this._widget.destroy()},toggle:function(a){this._widget.toggle(a)},setContent:function(a){this._widget.setContent(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.LinkBuilder"),SO.LinkBuilder.genDomObject=function(a,b,c,d){var e;return a?(e=document.createElement("a"),e.setAttribute("href",new SO.Structure.URL(a).toString()),e.setAttribute("target",d||"_self"),c&&(e.setAttribute("title",c),$(e).soTooltip())):e=document.createElement("span"),e.textContent=b,e};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("NL.Collection"),NL.Collection.Item=function(a,b){this.source=a,this.element=b,this.children=[]},SO.Widgets.define("navigationList","Collection",{DEFAULT_OPTIONS:{title:null,headless:!0,search:!1,layoutType:"default",layoutSize:"small",maxHeight:0,defaultRendering:"defaultNavigationListRenderer",renderingMethods:{defaultNavigationListRenderer:{label:"",icon:"",family:"treeNode",renderer:function(a){var b="";if(a.icon&&(b=$("<img>",{src:SO.route(a.icon,"reverse_img")}).css({"vertical-align":"middle","margin-right":"8px","margin-bottom":"6px"})),a.url){var c=$("<a/>",{href:a.url,title:a.help}).text(a.label).prepend(b);return c}return $("<span></span>").text(a.label).prepend(b)}}},emptyText:xtk_core.noData(),additionalItems:[],data:[],autoLoad:!0,onCancel:function(){},localStorage:{selection:!1,settings:!0},selection:null,fitToParentHeight:!1,onDataLoadCallback:void 0,beforeAsyncLoad:void 0,afterAsyncLoad:void 0,mode:"default",subElementClosedClass:"",subElementOpenedClass:"",toggleEffect:"blind",expandAll:!1,hideExpandIcon:!1,theme:"dark",displayBackToParent:!0,scrollOnInit:!0},_create:function(){this._controller=new SO.MVC.Controller({model:{_navigation:this._options.data},metamodel:{_navigation:{type:"tree",keys:["name"],elements:{label:{type:"string"},name:{type:"string"},url:{type:"string"},icon:{type:"string"},help:{type:"string"},isRoot:{type:"boolean"},isCollapsible:{type:"boolean"},isStatic:{type:"boolean"}}}},statemodel:{}}),this._jpath="_navigation",this._super();var a=this;this._previousClickElementRef=void 0,this._initRenderingMethod(),this._options.layoutManager.registerWidget(this);var a=this;this._previousClickElementRef=void 0,this._lastGroupValue=null,this._currentItems=[],SO.isArray(this._options.selection)||(this._options.selection=[this._options.selection]),this._preSelection=[],this._options.selection.length>0?(this._currentSelection=this._options.selection[this._options.selection.length-1],this._preSelection=this._options.selection):this._currentSelection=null,this._$selectedItems=[],this._currentSelectionTreePath=[];var b=this._getListSettingsFromLocalStorage("listLayout");if(!SO.isNundef(b)){var c=b.split("-");this._options.layoutType=c[0],this._options.layoutSize=c[1]}switch(this.$el.addClass("nlui-list-container").addClass("nlui-list-layout-"+this._options.layoutType).addClass("nlui-list-layout-"+this._options.layoutSize),this._buildBody(),this.$el.on("click",function(){a.$el.focus()}),this._options.fitToParentHeight&&this._$body.css("min-height","0"),this._options.scrollOnInit||this.preventScroll(),this._options.layoutManager.rebuildLayout(this.$el),this._itemExpandState={},this._oldItemExpandState={},this._currentSearchItems=[],this._needToScrollAt=void 0,this._openIconClass="nlui-navigation-list-open-icon",this._closeIconClass="nlui-navigation-list-close-icon",this._options.mode){case"default":""===this._options.subElementClosedClass&&(this._options.subElementClosedClass="nlui-icon-navigation-list-more-arrow"),""===this._options.subElementOpenedClass&&(this._options.subElementOpenedClass="nlui-icon-navigation-list-less-arrow");break;case"tree":""===this._options.subElementClosedClass&&(this._options.subElementClosedClass="nlui-icon-plus"),""===this._options.subElementOpenedClass&&(this._options.subElementOpenedClass="nlui-icon-minus")}this._rootPath=[],this._refreshEffect={hide:"",show:""},a=this,this.$el.addClass("nlui-navigation-list"),this._options.autoLoad!==!1&&a._fetchData({preSelection:a._options.selection,parentPath:""})},_buildBody:function(){this._$list=$("<ol></ol>").addClass("nlui-list-transition"),this._$body=$("<div></div>").addClass("nlui-list-body").append(this._$list).appendTo(this.$el),this._$body.addClass("nlui-list-selectable")},_isParentOfPreSelection:function(a,b){var c,d=!1;return b+=this._rootPath.length,this._preSelection.length>b-1&&(c=this._preSelection[b-1],d=this._controller.areKeysEqual(this._jpath,c,a)),d},_fetchData:function(a){var b,c,d,e;return c=this._jpath,a||(a={}),this._rootPath.length>0&&(a.treePath=a.treePath?this._rootPath.join(",")+","+a.treePath:this._rootPath.join(",")),a.treePath&&(c+="["+a.treePath+"]"),this._currentJob&&this._cancel(),b=this,a.callbacks=a.customCallbacks?a.customCallbacks:{onSuccess:function(c){c={records:c.length,data:c},b._handleSuccess(c,a)},onError:function(a){b._handleError(a)},onComplete:function(){b._handleComplete()}},d=SO.Utils.getValueFromObj(a,"parentPath",""),e=this._controller.getChildren(c,a.callbacks,a.refresh,d,a.currentNode)},_handleSuccess:function(a,b){var c;this._$list.find(".nlui-list-info").remove(),b.count||(a.data||"string"!=typeof a?(SO.isNundef(a.data)&&(a.data=[]),c=this._getPreSelectionParentIndexFromData(a.data),null!==c&&this._preSelection.length>this._rootPath.length+1?(this._rootPath.push(c),this._fetchData({preSelection:this._options.selection,parentPath:""})):(this._refreshWithData(a.data),void 0!==this._options.onDataLoadCallback&&this._options.onDataLoadCallback(this))):SO.log.error(a))},_getPreSelectionParentIndexFromData:function(a){for(var b,c=0,d=null;null===d&&a.length>c;)b=a[c],this._isParentOfPreSelection(b,1)&&(d=c),c++;return d},_handleError:function(a){this._$list.find(".nlui-list-info").remove(),this._$list.find(".nlui-list-item-error").remove();var b=$("<a class='nlui-anchor-entity nlui-list-item-error' href='#'></a>").text(xtk_core.list_errorLink());b.click(function(b){$("<div></div>").soMessageBox({error:a}),b.preventDefault()}),this._$list.prepend($("<div></div>").addClass("nlui-list-item-error").append($("<strong>"+xtk_core.list_errorLoadingMsg()+"</strong>")).append(b).append($("<div style='margin-top: 4px'></div>").text(SO.String.ellipsis(a.message,120))))},_handleComplete:function(){this._setLoading(!1),this._currentJob=null},_setLoading:function(a){void 0!==this._$listBusy&&this._$listBusy.toggle(a)},_getCurrentFullJPath:function(){var a=this._jpath;return this._currentSelectionTreePath.length>0&&(a+="["+this._currentSelectionTreePath.join(",")+"]"),a},_updateRenderingObject:function(a){var b=this._options.renderingMethods[a];b||(SO.log.warn("Unable to find the rendering method to use ("+a+"). Will default to the first one."),SO.Utils.each(this._options.renderingMethods,function(c,d){return b=d,a=c,!1})),this._renderingMethod=b,this._renderingMethod.key=a,this._saveListSettingsToLocalStorage("listLayout",a)},_refreshWithData:function(a){var b;if(this._currentItems.length=0,""!==this._refreshEffect.hide&&(b=this._$list.outerWidth(!0),"slideLeftToRight"===this._refreshEffect.hide?(this._swypeAnimate(0,b),this._$list.hide()):"slideRightToLeft"===this._refreshEffect.hide&&(this._swypeAnimate(0,-1*b),this._$list.hide()),this._refreshEffect.hide=""),this._$list.empty(),0===a.length&&(!SO.isArray(this._options.additionalItems)||SO.isArray(this._options.additionalItems)&&0===this._options.additionalItems.length)){var c=$("<p class='nlui-list-item-content'></p>").append($("<span></span>").text(this._options.emptyText)),d=$('<li class="nlui-list-item-rail"></li>').append($("<div></div>").append(c));this._$list.append($('<ol class="nlui-list-info"></ol>').append(d))}else this._render(a);""!==this._refreshEffect.show&&(b=this._$list.outerWidth(!0),"slideLeftToRight"===this._refreshEffect.show?(this._$list.show(),this._swypeAnimate(-1*b,0)):"slideRightToLeft"===this._refreshEffect.show&&(this._$list.show(),this._swypeAnimate(b,0)),this._refreshEffect.show=""),this._options.layoutManager.rebuildLayout(this.$el)},_swypeAnimate:function(a,b){this._$list.parent().css("overflow","hidden"),this._$list.removeClass("nlui-list-transition"),this._$list.css("transform","translateX("+a+"px)"),this._$list.addClass("nlui-list-transition"),this._$list.css("transform","translateX("+b+"px)"),this._$list.parent().css("overflow","initial")},_switchLayoutTo:function(a){var b,c,d;for(c=[],b=0;this._currentItems.length>b;b++)c.push($.extend(!0,{},this._currentItems[b].source));this._updateRenderingObject(a),this._refreshWithData(c,!0),this._options.pagination&&null!==this._$paginationContainer&&(d=this._$paginationContainer.children().css("display"),this._$paginationContainer.remove(),this._$paginationContainer=null,this._addPagination(),"none"!==d&&this._setLoading(!1))},_addRefreshButton:function(){var a=this;return this._refreshButton=$("<div></div>").soButton({mode:"default",icon:"nlui-icon-list-refresh",onClick:function(){a.refresh()},help:xtk_core.list_refresh_button_help,helpGravity:"autoNS"}),this._insertHeaderBlock(this._refreshButton,{zone:"tr",size:28,isLong:!1}),this},_insertHeaderBlock:function(a,b){var c=!0,d=SO.Utils.extend({},{zone:"tr",size:0},b);if(b)switch(d.zone){case"tl":SO.Utils.extend(d,{position:"left"});break;case"tr":SO.Utils.extend(d,{position:"right"});break;case"bl":SO.Utils.extend(d,{position:"left"}),c=!1;break;case"br":SO.Utils.extend(d,{position:"right"}),c=!1}else c=void 0===this._$bottomHeader;var e=this._$topHeader;c||(e=this._getBottomHeaderLine()),e.nlLinearLayout("addWidget",a,d)},_visualUnselect:function(){for(var a=0;this._$selectedItems.length>a;a++)this._$selectedItems[a].removeClass("nlui-list-active");this._$selectedItems=[]},_visualSelect:function(a){a.addClass("nlui-list-active"),this._$selectedItems.push(a)},_findAndSelect:function(a,b){if(!SO.isNundef(a)){for(var c=void 0,d=0;!c&&this._currentItems.length>d;d++){var e=this._currentItems[d],f=this._controller.areKeysEqual(this._jpath,a,e.source);f&&(c=e)}SO.isNundef(c)||(this._currentSelection=c.source,this._visualSelect(c.element),this._setSelectionTreePath(c.element),b&&this._scrollTo(c))}},_scrollTo:function(a){var b,c,d,e;return b=a.element.parents("div.nlui-list-body"),c=a.element.position(),e=c.top,d=b.height(),e>d?(b.scrollTop(e),!0):!1},_onItemClick:function(a,b){var c,d;d=this._getFullTreePathWithParentItemReference(b.nlData("item-reference-index")),c=this._jpath,""!==d&&(c+="["+d+"]"),this._controller.hasChildren(c,a)&&a.isRoot===!0?(this.askedToExpand=!0,this.toggleSubElement(b,!0)):(this.resetSelection(),this._setSelectedItem(a),this._selectItem(a,b))},_renderItem:function(a,b,c,d){var e,f,g,h,i,j,k,l,m=this,g=$("<li></li>").addClass("nlui-navigation-list-item");if(c&&SO.isFunction(b)){var n=b(m,a,g);SO.isFunction(n.click)&&g.click(n.click);var o=n.item;g.append(o),d.append(g)}else{var p,q=a+1;p=this._renderingMethod.renderer(b,q,g,this),"string"==typeof p?g.text(p):g.append(p);var r=new NL.Collection.Item(b,g);m._currentItems.push(r),this._controller.areKeysEqual(this._jpath,this._currentSelection,b)&&(this._visualSelect(g),this._tmpSelectedItem=r,this._options.scrollOnInit&&this.allowScroll()),b.isStatic!==!0&&g.click(function(a){var c;(void 0===m._previousClickElementRef||m._eventNotSrcEqual(a))&&(c=$(a.srcElement).nlData("clicked-list-item-ref"),SO.isNundef(c)&&(c="clicked-list-item-ref-"+SO.Utils.sequence().nextVal(),$(a.srcElement).nlData("clicked-list-item-ref",c)),m._previousClickElementRef=c,m.stopPropagation(a),m._onItemClick(b,g),setTimeout(function(){m._previousClickElementRef=void 0},1e3))}),d.append(g)}if("grid"!==this._options.layoutType){k=d.parent().nlData("item-reference-index"),SO.isNundef(k)&&(k=""),""!==k?(h=this._currentItems.pop(),l=this._getCurrentCollectionItemByItemReference(k,this._currentItems),SO.isArray(l.children)||(l.children=[]),l.children.push(h),h.searchReference=this._addCurrentElementToSearch(h,l.searchReference),k+="_"):(h=this._currentItems[this._currentItems.length-1],h.searchReference=this._addCurrentElementToSearch(h)),g.nlData("item-reference-index",k+a),g.nlData("item-search-index",h.searchReference),g.addClass("nlui-navigation-list-item"),e=g.contents(),g.children().remove();var s=$('<div class="nlui-navigation-list-item-container"></div>');g.append(s),i=$("<ol></ol>"),s.append(i),j=$("<li></li>").addClass("nlui-navigation-list-item-contents").appendTo(i),b.isStatic===!0&&j.addClass("nlui-navigation-list-item-static"),j.append(e),j=this._iconRender(b,j),f=$("<span class='nlui-navigation-icon-next'></span>").prependTo(g),this._displayCurrentChildren(k,a,b,g,f)}},_displayCurrentChildren:function(a,b,c,d,e){var f,g;g=this._getFullTreePathWithParentItemReference(a+b),f=this._jpath,""!==g&&(f+="["+g+"]"),!this._controller.hasChildren(f,c)||c.isCollapsible===!1&&c.isStatic!==!0&&c.isRoot!==!0?$("<span>&nbsp;</span>").addClass("empty-icon").appendTo(e):this._renderItemChildren(d,e,c,b,a)},_renderItemChildren:function(a,b,c,d,e){var f,g,h,i=this;(this._options.expandAll===!0&&this._options.hideExpandIcon===!0||c.isCollapsible===!1||c.isStatic===!0)&&a.addClass("nlui-navigation-list-hide-icon"),g=this._needToExpandThisElement(c,d,e,a),g?(SO.IMG.genImage(this._options.subElementOpenedClass,16).appendTo(b),this._loadSubElement(a,!1),this._setExpandedState(a.nlData("item-search-index"),g)):(h=this._getFullTreePathWithParentItemReference(e+d),f=this._jpath,""!==h&&(f+="["+h+"]"),c.isRoot?SO.IMG.genIcon("rail-next-white",18).appendTo(b):SO.IMG.genImage(this._options.subElementClosedClass,16).appendTo(b)),b.on("click",function(a){return i.askedToExpand=!0,i.toggleSubElement($(a.currentTarget).parent(),!0),a.stopPropagation(),!1})},_render:function(a){this._oldItemExpandState=SO.Utils.extend(!0,{},this._itemExpandState);var b,c=this;b=0,$.each(this._options.additionalItems,function(a,d){b++,c._renderItem(a,d,!0,c._$list)}),$.each(a,function(a,d){c._renderItem(a+b,d,!1,c._$list)}),this._options.displayBackToParent===!0&&this._renderGoToParent(),this._options.layoutManager.rebuildLayout(this.$el)},_renderGoToParent:function(){var a,b=this;this._rootPath.length>0&&0===this._$list.children(".nlui-navigation-list-item.nlui-navigation-list-parent-item").length&&(a=this._controller.getValue(this._jpath+"["+this._getFullTreePathWithParentItemReference("")+"]"),this._$list.prepend($("<li></li>").addClass("nlui-navigation-list-item nlui-navigation-list-parent-item").append(SO.IMG.genIcon("rail-back-white",18).addClass("nlui-navigation-icon-back"),$('<div class="nlui-navigation-list-item-container"><div class="nlui-navigation-list-item-contents">'+a.label+"</div></div>")).on("click",function(a){b._handleGoToParent(),b.stopPropagation(a)})))},_handleGoToParent:function(){this._rootPath.splice(this._rootPath.length-1,1),this._refreshEffect.show="slideRightToLeft",this._refreshEffect.hide="slideRightToLeft",this._preSelection=[],this.refresh()},_eventNotSrcEqual:function(a){var b=$(a.srcElement).nlData("clicked-list-item-ref");return this._previousClickElementRef!==b},destroy:function(){this._options.layoutManager.unRegisterWidget(this)},_setSelectedItem:function(a){this._currentSelection=a},_selectItem:function(a,b){SO.isNundef(a)||this._visualSelect(b),this._currentSelection=a,this._setSelectionTreePath(b)},_refreshNodeFromTreePath:function(a){var b,c,d,e,f=this;1===a.length&&""===a[0]?this.refresh():(d=this._getCurrentCollectionItemByItemReference(a.join("_"),this._currentItems),e=this._getCurrentCollectionItemByItemReference(a.join("_"),this._currentSearchItems),d.element.children("span.nlui-navigation-icon-next").remove(),d.element.children("ol.nlui-navigation-list-sub-element").remove(),b=$("<span></span>").addClass("nlui-navigation-icon-next").prependTo(d.element),d.children=[],e.children=[],c={customCallbacks:{},treePath:a.join(","),parentPath:SO.Utils.getValueFromObj(d,["source","nodePath"],""),setBusy:!1},c.customCallbacks.onSuccess=function(c){c.length>0?(void 0===d.source.children&&(d.source.children={}),d.source.children.data=c,f._setExpandedState(a.join("_"),!0),f._oldItemExpandState=SO.Utils.extend(!0,{},f._itemExpandState),f._renderItemChildren(d.element,b,d.source,a[a.length-1],a.join("_"))):(d.source.children&&(d.source.children={}),$("<span>&nbsp;</span>").addClass("empty-icon").appendTo(b))},c.customCallbacks.onError=function(){},c.customCallbacks.onComplete=function(){},this._fetchData(c))},_initRenderingMethod:function(){this._renderingMethod=null;var a=this._options.defaultRendering,b=this._getListSettingsFromLocalStorage("listLayout");if(b&&(a=b),a)this._updateRenderingObject(a);else{SO.log.warn("No default rendering has been provided");var c="";this._options.layoutType&&this._options.layoutSize&&(c=this._options.layoutType+"-"+this._options.layoutSize),this._updateRenderingObject(c)}},_setSelectionTreePath:function(a){this._currentSelectionTreePath=a.nlData("item-search-index").split("_")},_addCurrentElementToSearch:function(a,b){var c,d,e,f,g,h;for(g=SO.Utils.extend(!0,{},a),void 0===b?(e=this._currentSearchItems,g.searchReference=""):(h=this._getCurrentCollectionItemByItemReference(b,this._currentSearchItems),SO.isArray(h.children)||(h.children=[]),e=h.children,g.searchReference=b+"_"),d=!1,f=e.length,c=0;!d&&f>c;)SO.Utils.isEqual(g.source,e[c].source)&&(d=!0,g.searchReference=e[c].searchReference),c++;return d===!1&&(e.push(g),g.searchReference+=e.length-1),g.searchReference},_needToExpandThisElement:function(a,b,c,d){var e=!1;return this._options.expandAll||a.isStatic===!0?e=!0:(e=this._getOldExpandedState(d.nlData("item-search-index")),e===!1&&(e=this._isParentOfPreSelection(a,(c+b).split("_").length))),e},_getCurrentCollectionItemByItemReference:function(a,b){var c,d,e;for(void 0===b&&(b=this._currentItems),e=SO.isNumber(a)?[a]:a.split("_"),d=b[e[0]],c=1;e.length>c&&SO.isArray(d.children)&&d.children.length>0;)d=d.children[e[c]],c++;return d},_getCurrentElementSourceByItemReference:function(a){var b,c,d;for(d=SO.isNumber(a)?[a]:a.split("_"),c=this._currentItems[d[0]].source,b=1;d.length>b&&SO.isArray(c.children.data)&&c.children.data.length>0;)c=c.children.data[d[b]],b++;return SO.isNundef(c.children)&&(c.children={}),c.children},_getAllElementsSourceByItemReference:function(a){var b,c,d,e;for(c=[],e=SO.isNumber(a)?[a]:a.split("_"),d=this._currentSearchItems[e[0]],c.push(d.source),b=1;e.length>b&&!SO.isNundef(d.children)&&SO.isArray(d.children)&&d.children.length>0;)d=d.children[e[b]],c.push(d.source),b++;return c},_searchExpandedStateObject:function(a,b){var c,d,e,f;for(d=this._getAllElementsSourceByItemReference(a),f=b,c=0;d.length>c;c++){if(e=this._getInteranalStateHash(d[c]),SO.isNundef(f)||SO.isNundef(e)){f=void 0;break}SO.isNundef(f[e])&&(f[e]={expanded:!1}),f=f[e]}return f},_getOldExpandedState:function(a){var b,c;return b=!1,c=this._searchExpandedStateObject(a,this._oldItemExpandState),SO.isNundef(c)||(b=c.expanded),b},_setExpandedState:function(a,b){var c=this._searchExpandedStateObject(a,this._itemExpandState);SO.isNundef(c)||b===!1?c=void 0:c.expanded=b},_getInteranalStateHash:function(a){var b,c,d;if(void 0!==a){b="";for(c in a)a.hasOwnProperty(c)&&"children"!==c&&"_children_"!==c&&(d=a[c],SO.isString(d)||SO.isNumber(d)||SO.isNundef(d)?(SO.isString(d)&&a[c].replace("_","|underscore|"),b+=a[c]+"_"):b+=SO.isBoolean(d)?(a[c]?1:0)+"_":$(a[c]).serialize().replace("_","|underscore|")+"_")}return b},_alignListIcon:function(a){a.next().hasClass("nlui-navigation-list-sub-element")||a.css("padding-top",(a.next().height()-16)/2+"px")},_createSubElements:function(a,b,c){var d,e,f;e="nlui-navigation-list-sub-element","link"===this._options.layoutType&&(e+=" nlui-navigation-list-link"),f=$("<ol></ol>").addClass(e),c!==!0&&f.hide(),f.appendTo(b),d=this,!SO.isNundef(a.data)&&a.data.length>0&&$.each(a.data,function(a,b){d._renderItem(a,b,!1,f)})},_getFullTreePathWithParentItemReference:function(a){var b=this._rootPath.join(",");return this._rootPath.length>0&&""!==a&&(b+=","),b+=a.split("_").join(",")},_loadSubElement:function(a,b){var c,d;c=a.nlData("item-reference-index"),this._setItemIconTo("loading",a.children("span.nlui-navigation-icon-next").children("span.nlui-icon")),d=this._getCurrentElementSourceByItemReference(c),SO.isArray(d.data)?this._loadDataCallBack(d,{$container:a,animated:b}):this._loadChildren(d,a,b)},_loadChildren:function(a,b,c){function d(a){e._controller.cancelGetCollection(e._jpath,a.data.currentJob),b.children("span.nlui-navigation-icon-next").off("click",d)}var e,f,g,h,i,j;h=b.nlData("item-reference-index"),i=h.split("_"),j=this._getCurrentCollectionItemByItemReference(h),e=this,g={customCallbacks:{},treePath:i.join(","),parentPath:SO.Utils.getValueFromObj(j,["source","nodePath"],""),setBusy:!1},g.customCallbacks.onSuccess=function(d){a.data=d,e._loadDataCallBack(a,{$container:b,animated:c})},g.customCallbacks.onError=function(a){$("<div></div>").soMessageBox({type:"error",message:a}),e._setItemIconTo("close",b.children("span.nlui-navigation-icon-next").children("span.nlui-icon"))},g.customCallbacks.onComplete=function(){b.children("span.nlui-navigation-icon-next").off("click",d)},g.currentNode=a,f=this._fetchData(g),b.children("span.nlui-navigation-icon-next").on("click",{currentJob:f},d)},_loadDataCallBack:function(a,b){this._createSubElements(a,b.$container,!1),this._setItemIconTo("close",b.$container.children("span.nlui-navigation-icon-next").children("span.nlui-icon")),this.toggleSubElement(b.$container,b.animated),this._scrollIfNeeded()},preventScroll:function(){return this._needToScrollAt=void 0,this},allowScroll:function(){return this._needToScrollAt=this._tmpSelectedItem,this},_scrollIfNeeded:function(){void 0!==this._needToScrollAt&&this._scrollTo(this._needToScrollAt)&&(this._needToScrollAt=void 0)},_setItemIconTo:function(a,b){switch(a){case"open":b.removeClass(this._options.subElementClosedClass+" nlui-navigation-list-loading-element "+this._closeIconClass).addClass(this._options.subElementOpenedClass+" "+this._openIconClass);break;case"close":b.removeClass(this._options.subElementOpenedClass+" nlui-navigation-list-loading-element "+this._openIconClass).addClass(this._options.subElementClosedClass+" "+this._closeIconClass);break;case"loading":b.removeClass(this._options.subElementOpenedClass+" "+this._options.subElementClosedClass+" "+this._openIconClass+" "+this._closeIconClass).addClass("nlui-navigation-list-loading-element")}},_iconRender:function(a,b){return a.img&&SO.IMG.genImage(a.img,16).prependTo(b),b},_formatSearchData:function(a){var b,c,d,e=[];for(b=0;a.length>b;b++)c=$.extend(!0,{},a[b].source),d=$.extend(!0,[],a[b].children),SO.Utils.count(d)>0&&(c.children=c.children||{},c.children.data=this._formatSearchData(d)),e.push(c);return e},setRenderingMethod:function(a){""!==a&&this._updateRenderingObject(a)},empty:function(){this._currentItems.length=0,this.resetSelection(),this._$list.empty()},rebuildLayout:function(){if(null!==this._$body){if(0!==this._options.maxHeight){var a=this._$body.outerHeight(!0)-this._$body.height();this._$body.css({overflow:"auto",height:this._options.maxHeight-a+"px"})}if(this._options.fitToParentHeight){var b=this.$el.css("overflow-y");this.$el.css("overflow-y","hidden");var c,d;c=this._$body.outerHeight(!0)-this._$body.height(),d=this.$el.height(),this._$body.css("overflow-y","auto").height(d-c),this.$el.css("overflow-y",b)}}this._scrollIfNeeded()},setFocus:function(){},refresh:function(){this._currentSearchItems=[],this._itemExpandState={},this._oldItemExpandState={},this._fetchData({refresh:!0,parentKey:null,parentPath:""})},setValue:function(a,b){null===a&&(this._currentSelectionTreePath=[]),this._super(a,b)},check:function(a,b){return this._options.strict&&b||!b?this._options.mandatory&&null===this._currentSelection?{message:xtk_core.inputs_mandatoryErr()}:null:null},onFilterNotify:function(){this.refresh()},onCollectionNotify:function(a,b){var c;switch(a){case"add":c=b.substring(b.indexOf("[")+1,b.indexOf("]")).split(","),this._refreshNodeFromTreePath(c);break;case"cancelAdd":break;case"remove":c=b.substring(b.indexOf("[")+1,b.indexOf("]")).split(","),c=1===c.length?[""]:c.slice(0,-1),this.setValue(null),this._refreshNodeFromTreePath(c);break;case"cancelRemove":break;case"move":break;case"duplicate":break;case"cancelDuplicate":break;default:throw"Unknown type in method onCollectionNotify: "+a}},toggleSubElement:function(a,b){var c,d,e,f,g,h,i,j;c=this,h=a.children("span.nlui-navigation-icon-next").children("span.nlui-icon"),f=a.children("ol.nlui-navigation-list-sub-element"),j=a.nlData("item-reference-index"),e=this._getFullTreePathWithParentItemReference(j),d=this._jpath,""!==e&&(d+="["+e+"]"),i=this._controller.getValue(d),i.isRoot&&(this._isParentOfPreSelection(i,j.split("_").length)||this.askedToExpand===!0)?(this._rootPath=e.split(","),this._refreshEffect.show="slideLeftToRight",this._refreshEffect.hide="slideLeftToRight",this.askedToExpand=!1,this.refresh()):(h.hasClass(this._options.subElementClosedClass)||h.hasClass(this._options.subElementOpenedClass))&&(0===f.length?this._loadSubElement(a,b):(b===!1?f.toggle():f.toggle({effect:this._options.toggleEffect,duration:300}),g=a.nlData("item-search-index"),h.hasClass(this._closeIconClass)?(this._setItemIconTo("open",h),this._setExpandedState(g,!0)):(this._setItemIconTo("close",h),this._setExpandedState(g,!1))))},toggleAdvancedField:function(){this._options.displaySchemaAdvancedFields=!this._options.displaySchemaAdvancedFields,this._refreshWithData(this._formatSearchData(this._currentSearchItems))}}),$.widget("NL.nlNavigationList",{_create:function(){this._widget=new SO.Widgets.navigationList(this.element,this.options)},_destroy:function(){this._widget.destroy()},setRenderingMethod:function(a){this._widget.setRenderingMethod(a)},empty:function(){this._widget.empty()},rebuildLayout:function(){this._widget.rebuildLayout()},refresh:function(){this._widget.refresh()},setValue:function(a,b){this._widget.setValue(a,b)},check:function(a,b){this._widget.check(a,b)},onFilterNotify:function(a,b){this._widget.onFilterNotify(a,b)},onCollectionNotify:function(a,b,c){this._widget.onCollectionNotify(a,b,c)},toggleSubElement:function(a,b){this._widget.toggleSubElement(a,b)},toggleAdvancedField:function(){this._widget.toggleAdvancedField()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){NL.JobInterface=function(b){this.settings=a.extend({},{delay:1e3},b),this.catchedProperties={},this.restartable=!0,this.restartAfterError=!0},NL.JobInterface.prototype.execute=function(){throw"Must be implemented"},NL.JobInterface.prototype.cancel=function(){throw"Must be implemented"},NL.JobInterface.prototype.completed=function(b){a.isFunction(b)&&b(this)},NL.JobInterface.prototype.getStatus=function(){throw"Must be implemented"},NL.JobInterface.prototype.isDone=function(){return this.status===NL.JobInterface.JOBSTATUS_IDLE||this.status===NL.JobInterface.JOBSTATUS_CANCELED||this.status===NL.JobInterface.JOBSTATUS_FINISHED||this.status===NL.JobInterface.JOBSTATUS_PAUSE||this.status===NL.JobInterface.JOBSTATUS_ERROR},NL.JobInterface.JOBSTATUS_IDLE=0,NL.JobInterface.JOBSTATUS_RUNNING=2,NL.JobInterface.JOBSTATUS_CANCELING=3,NL.JobInterface.JOBSTATUS_CANCELED=4,NL.JobInterface.JOBSTATUS_FINISHED=5,NL.JobInterface.JOBSTATUS_ERROR=6,NL.JobInterface.JOBSTATUS_PAUSEPENDING=7,NL.JobInterface.JOBSTATUS_PAUSE=8,NL.JobInterface.JOBSTATUS_PURGEPENDING=9,NL.JobInterface.JOBSTATUS_NONE=999,NL.JobInterface.JOBLOGTYPE_ERROR=0,NL.JobInterface.JOBLOGTYPE_WARNING=1,NL.JobInterface.JOBLOGTYPE_INFO=2,NL.JobInterface.JOBLOGTYPE_STATUS=3,NL.JobInterface.JOBLOGTYPE_VERBOSE=4,NL.JobInterface.JOBLOGTYPE_CATEGORY=999})(jQuery,window),function(a){NL.XtkJob=function(b){NL.JobInterface.apply(this,arguments);var c=this,d={id:0,methodName:null,urn:null,doNotPersist:!0,useWhere:!1,jobParameters:{},maxLogsByStep:10,propertiesToCatch:[]};this.lastLogId=-2147483647,this.status=NL.JobInterface.JOBSTATUS_IDLE,this.securitytoken=document.__securitytoken,this.settings=a.extend({},d,b),this.asyncTargets={execute:{},status:{},cancel:{}},this.asyncTargets.execute.onSoapRequestCompleted=function(b,d){d?SO.log.debug(d):c._jobId=b.getNextString(),a.isFunction(this.customCallback)&&this.customCallback(c,d)},this.asyncTargets.status.onSoapRequestCompleted=function(b,d){var e;if(d)SO.log.debug(d);else{var f=parseInt(b.getNextShort(),10),g=b.getNextElement(),h=b.getNextElement(),i=parseFloat(getXPathValue(h,"progress/@current"),10),j=parseFloat(getXPathValue(h,"progress/@max"),10),k=findNodes(g,"log",!0);SO.isArray(c.settings.propertiesToCatch)&&SO.Utils.each(c.settings.propertiesToCatch,function(a,b){SO.assert(SO.isPlainObject(b)&&!SO.isEmpty(b.id)&&!SO.isEmpty(b.xpath),"Given property is not valid.");var d=b.xpath,e=b.id;c.catchedProperties[e]=getXPathValue(h,d)}),c.status=f;var l=[];a.each(k,function(a,b){var d=convertToPOJsO(b);l.push(d),parseInt(d.id,10)>parseInt(c.lastLogId,10)&&(c.lastLogId=d.id)}),e={status:f,current:i,max:j,logs:l}}a.isFunction(this.customCallback)&&this.customCallback(e,d)},this.asyncTargets.cancel.onSoapRequestCompleted=function(b,d){a.isFunction(this.customCallback)&&this.customCallback(c,d)}},NL.XtkJob.prototype.execute=function(a){function b(a,b,c,d,e){var f='<soapCall name="'+SO.XSS.escapeXMLAttribute(a)+'" service="'+SO.XSS.escapeXMLAttribute(b)+'">';e&&!isNaN(c)&&c?f+='<param type="DOMElement"><where><condition expr="@id='+c+'" /></where></param>':!isNaN(c)&&c&&(f+='<param type="string" value="'+c+'"></param>');for(var g=0;d.length>g;g++)f+='<param type="'+SO.XSS.escapeXMLAttribute(d[g].type)+'"',f+="DOMElement"===d[g].type?">"+d[g].value:' value="'+SO.XSS.escapeXMLAttribute(d[g].value)+'">',f+="</param>";return f+="</soapCall>"}var c="xtk:jobInterface|"+this.settings.urn,d=new NL.transport.SOAP({urn:c,method:"SubmitSoapCall",nsEncoding:"UTF-8"}),e=this.settings.jobParameters.params?this.settings.jobParameters.params:{},f=NL.XTK.parseBoolean(this.settings.useWhere),g=Number(this.settings.id);this.asyncTargets.execute.customCallback=a;var h='<job doNotPersist="'+this.settings.doNotPersist+'" xtkschema="'+this.settings.urn;!isNaN(g)&&g&&(h+='" id="'+g),h+='"><properties warning="false"><progress/></properties></job>',d.writeElement("urn",h),d.writeElement("elemSoapCall",b(this.settings.methodName,this.settings.urn,g,e,f));var i=this;d.start({onSuccess:function(a){i.asyncTargets.execute.onSoapRequestCompleted(a,null)},onError:function(a){i.asyncTargets.execute.onSoapRequestCompleted(null,a)},loaderOff:!0})},NL.XtkJob.prototype.setJobParameters=function(a){this.settings.jobParameters=a},NL.XtkJob.prototype.isDone=NL.JobInterface.prototype.isDone,NL.XtkJob.prototype.completed=NL.JobInterface.prototype.completed,NL.XtkJob.prototype.getStatus=function(a,b){var c=new NL.transport.SOAP({urn:"xtk:jobInterface",method:"GetStatus",nsEncoding:"UTF-8"}),d=this.settings.maxLogsByStep;b&&(d=0),this.asyncTargets.status.customCallback=a,c.writeString("id",this._jobId),c.writeInt("lastLogId",this.lastLogId),c.writeInt("maxLogCount",d);var e=this;c.start({onSuccess:function(a){e.asyncTargets.status.onSoapRequestCompleted(a,null)},onError:function(a){e.asyncTargets.status.onSoapRequestCompleted(null,a)},loaderOff:!0})},NL.XtkJob.prototype.cancel=function(a){var b=new NL.transport.SOAP({urn:"xtk:jobInterface",method:"Cancel",nsEncoding:"UTF-8"});this.asyncTargets.cancel.customCallback=a,b.writeString("id",this._jobId);var c=this;b.start({onSuccess:function(a){c.asyncTargets.cancel.onSoapRequestCompleted(a,null)},onError:function(a){c.asyncTargets.cancel.onSoapRequestCompleted(null,a)},loaderOff:!0})}}(jQuery,window),function(a){NL.MockupJob=function(b){NL.JobInterface.prototype&&NL.JobInterface.apply(this,arguments);var c={maxStep:10,delay:1e3,step:1};this.currentStep=0,this.status=NL.JobInterface.JOBSTATUS_IDLE,this.settings=a.extend({},c,b)},NL.MockupJob.prototype.execute=function(b){this.status=NL.JobInterface.JOBSTATUS_RUNNING,this.currentStep=0;var c=this;this.runTimer=setInterval(function(){c.currentStep+=c.settings.step},1e3),a.isFunction(b)&&b(this)},NL.MockupJob.prototype.cancel=function(b){this.status=NL.JobInterface.JOBSTATUS_CANCELED,clearInterval(this.runTimer),a.isFunction(b)&&b(this)},NL.MockupJob.prototype.completed=function(b){this.currentStep>=this.settings.maxStep&&(this.status=NL.JobInterface.JOBSTATUS_FINISHED),clearInterval(this.runTimer),a.isFunction(b)&&b(this)},NL.MockupJob.prototype.getStatus=function(b,c){var d=Math.floor(Math.random()*4*this.settings.maxStep),e=Math.floor(Math.random()*this.settings.maxStep),f=[];if(!c&&this.currentStep>d){var g={logType:NL.JobInterface.JOBLOGTYPE_WARNING,message:"Fake warning at step "+this.currentStep};f.push(g)}if(!c&&this.settings.generateError!==!1&&this.currentStep===e){this.status=NL.JobInterface.JOBSTATUS_ERROR;var h={logType:NL.JobInterface.JOBLOGTYPE_ERROR,message:"Fake error at step "+this.currentStep};f.push(h)}var i={status:this.status,current:this.currentStep,max:this.settings.maxStep,logs:f};a.isFunction(b)&&b(i)},NL.MockupJob.prototype.isDone=function(){return this.currentStep>=this.settings.maxStep||NL.JobInterface.prototype.isDone.call(this)}}(jQuery,window),function(a){NL.LocalJob=function(b){NL.JobInterface.prototype&&NL.JobInterface.apply(this,arguments);var c={maxStep:10,delay:1e3,step:1};this.currentStep=0,this.status=NL.JobInterface.JOBSTATUS_IDLE,this.settings=a.extend({},c,b),this.settings.simulateProgression&&(this.settings.step=1)},NL.LocalJob.prototype.execute=function(b){this.status=NL.JobInterface.JOBSTATUS_RUNNING,this.currentStep=0;var c=this;setTimeout(function(){c.currentStep+=c.settings.step},this.settings.delay),SO.isFunction(this.settings.execute)&&this.settings.execute.call(this),a.isFunction(b)&&b(this)},NL.LocalJob.prototype.cancel=function(b){this.status=NL.JobInterface.JOBSTATUS_CANCELED,SO.isFunction(this.settings.cancel)&&this.settings.cancel.call(this),a.isFunction(b)&&b(this)},NL.LocalJob.prototype.completed=function(b){this.currentStep>=this.settings.maxStep&&(this.status=NL.JobInterface.JOBSTATUS_FINISHED),SO.isFunction(this.settings.completed)&&this.settings.completed.call(this),a.isFunction(b)&&b(this)},NL.LocalJob.prototype.getStatus=function(b){var c,d,e=this;SO.isFunction(this.settings.getStatus)&&(d=this.settings.getStatus.call(this)),SO.isArray(d)||(d=[]);var f={status:e.status,current:e.currentStep,max:e.settings.maxStep,logs:d};e.settings.simulateProgression&&(c=1e3*Math.exp(Math.log(3600)*e.currentStep/e.settings.maxStep),setTimeout(function(){e.currentStep=Math.min(e.currentStep+e.settings.step,e.settings.maxStep-1)},c),e.settings.delay=e.currentStep<e.settings.maxStep?c:0),a.isFunction(b)&&b(f)},NL.LocalJob.prototype.isDone=function(){return this.currentStep>=this.settings.maxStep||NL.JobInterface.prototype.isDone.call(this)}}(jQuery,window),function(a){var b={_logData:[],_hasWarnings:!1,_hasErrors:!1,_lastHasErrors:!1,_currentJobIdx:0,_currentlyRunning:!1,_restartable:!0,_restartAfterError:!0,_multipleJobs:!1,_noProgression:0,_oldCurrentStep:0,$_progressContainer:null,$_message:null,$_logList:null,$_progressBar:null,$_startButton:null,$_closeButton:null,$_cancelButton:null,options:{job:{},autoStart:!1,maxLog:100,maxWarningInLog:10,maxErrorInLog:10,stopOnJobError:!0,beforeStart:null,started:null,done:null,canceled:null,error:null,onClose:null,listEmptyTextLabel:xtk_core.jobProgressIndicator_listEmptyTextLabel(),titleLabel:xtk_core.jobProgressIndicator_titleLabel(),startLabel:xtk_core.jobProgressIndicator_startLabel(),stopLabel:xtk_core.jobProgressIndicator_stopLabel(),resumeLabel:xtk_core.jobProgressIndicator_resumeLabel(),closeLabel:xtk_core.jobProgressIndicator_closeLabel(),displayLogLabel:xtk_core.jobProgressIndicator_displayLogLabel(),hideLogLabel:xtk_core.jobProgressIndicator_hideLogLabel(),initMsgLabel:xtk_core.jobProgressIndicator_initMsgLabel(),inProgressLabel:xtk_core.jobProgressIndicator_inProgressLabel(),doneLabel:xtk_core.jobProgressIndicator_doneLabel(),doneWarningLabel:xtk_core.jobProgressIndicator_doneWarningLabel(),doneErrorLabel:xtk_core.jobProgressIndicator_doneErrorLabel(),errorLabel:xtk_core.jobProgressIndicator_errorLabel(),cancelLabel:xtk_core.jobProgressIndicator_cancelLabel(),execErrorLabel:xtk_core.jobProgressIndicator_execErrorLabel(),cancelErrorLabel:xtk_core.jobProgressIndicator_cancelErrorLabel(),getStatusErrorLabel:xtk_core.jobProgressIndicator_getStatusErrorLabel()},_create:function(){var b=this;this._multipleJobs=SO.isArray(this.options.job),this._multipleJobs?SO.Utils.each(this.options.job,function(a,c){b._restartable=b._restartable&&c.settings.restartable,b._restartAfterError=b._restartAfterError&&c.settings.restartAfterError}):(this._restartable=this.options.job.settings.restartable,this._restartAfterError=this.options.job.settings.restartAfterError),this.$_message=a("<div></div>").soActionMessage({message:this.options.initMsgLabel,state:"info",displayIcon:"none"}).appendTo(this.element),this.$_logList=a("<div></div>").addClass("nlui-jobProgressIndicator-logList ui-corner-all").appendTo(this.element),this.$_progressBar=a('<div class="nlui-jobProgressIndicator"></div>').progressbar({roundedCorners:!0,width:"100%",textPosition:"center",color:"blue"}).hide(),this._logData=[];var c,d={},e={},f="jobProgress_list_"+SO.Utils.sequence().nextVal();e[f]={type:"list",elements:{id:{type:"string",label:"id"},iRc:{type:"string",label:"iRc"},logDate:{type:"string",label:"logDate"},logType:{type:"string",label:"logType"},message:{type:"string",label:"message"},object:{type:"string",label:"object"}}},d[f]=this._logData,c=new SO.MVC.Controller({model:d,metamodel:e}),this.$_logList.soList({controller:c,jpath:f,layoutSize:"large",localStorage:{plugins:!1},title:xtk_core.jobProgressIndicator_jobLogLabel(),renderingMethods:{jopProgressIndicatorRenderer:{family:"line",label:"",icon:"",renderer:function(a,c,d){return b._defaultLogListRender(a,c,d)}}},defaultRendering:"jopProgressIndicatorRenderer",search:!0,postFilter:function(a,b){var c,d,e,f=!1;for(c=0;b.length>c;c++)if(e=b[c],"$1"===e.wildcard){d=e.value;break}return f=d&&a.logType!==NL.JobInterface.JOBLOGTYPE_CATEGORY?SO.String.contains(a.message,d)?!0:!1:!0}}),this.$_dialog=this.element.soDialog({title:this.options.titleLabel,modal:!0,autoOpen:!1,width:550,height:490,dialogClass:"nlui-jobProgressIndicator",buttons:[{text:this.options.startLabel,id:"start",click:function(){b.start()}},{text:b.options.stopLabel,id:"cancel",click:function(){b.cancel()}},{text:b.options.closeLabel,id:"close",click:function(){b.$_dialog.soDialog("close")}}],open:function(){b.options.autoStart&&b.start(),b.option("init")&&SO.isFunction(b.option("init"))&&b.option.init.call(b),b._refreshLogListHeight()},beforeClose:function(){return b._currentlyRunning?(a("<div></div>").soMessageBox({type:"confirm",message:xtk_core.jobProgressIndicator_warningRunningJobConfirmClose(),onConfirm:function(){b.cancel(),b.$_dialog.soDialog("close")}}),!1):(b.options.onClose&&b.options.onClose(),!0)},resize:function(){b._refreshLogListHeight()}}),this.$_startButton=this.$_dialog.soDialog("getButton","start"),this.$_closeButton=this.$_dialog.soDialog("getButton","close"),this.$_cancelButton=this.$_dialog.soDialog("getButton","cancel").hide(),this.$_dialog.soDialog("open"),this.$_progressContainer=a('<div class="nlui-jobprogressindicator-progresscontainer"></div>').css({position:"absolute",left:10,right:this.$_dialog.soDialog("getCommandBar").outerWidth(!0)+50,top:17}).append(this.$_progressBar).appendTo(this.$_dialog.soDialog("getFooter"))},_setOption:function(){},destroy:function(){this.element.remove()},start:function(){var b;this._reset(),b=this._getCurrentJob(),this.$_message.soActionMessage("setMessage",this.options.inProgressLabel),this.$_message.soActionMessage("setState","info"),this._refreshLogListHeight(),a.isFunction(this.options.beforeStart)&&this.options.beforeStart.call(this),this._executeJob(b),this._restartable?this.$_startButton.button("disable"):this.$_startButton.hide()},cancel:function(){var a=this,b=a._getCurrentJob();a._currentlyRunning=!1,b.cancel(function(b,c){c?a._processError(c,a.options.cancelErrorLabel,"CancelError"):a.getStatusAndLogs(b,c,!1)})},getStatusAndLogs:function(a,b,c){var d=this,e=!SO.isArray(d.options.job)||d._currentJobIdx===d.options.job.length-1;if(b)d._processError(b,d.options.getStatusErrorLabel,"GetStatusError"),d.options.stopOnJobError||d._startNextJob();else{var f=0,g=[],h=0,i=0;a.getStatus(function(b,j){if(j)d._processError(j,d.options.getStatusErrorLabel,"GetStatusError");else{if(b.current>d._oldCurrentStep?(d._oldCurrentStep=b.current,d._noProgression=0):d._noProgression++,f=b.status,g=b.logs,h=b.current,i=b.max,g.length){for(var k=0;g.length>k;k++)d._logData.push(g[k]),Number(g[k].logType)===NL.JobInterface.JOBLOGTYPE_WARNING&&(d._hasWarnings=!0),Number(g[k].logType)===NL.JobInterface.JOBLOGTYPE_ERROR&&(d._hasErrors=!0,e&&(d._lastHasErrors=!0));d.$_logList.soList("refresh")}if(a.isDone())c||a.completed(function(a,b){switch(Number(f)){case NL.JobInterface.JOBSTATUS_CANCELED:d._canceled(a,b);break;case NL.JobInterface.JOBSTATUS_ERROR:d._error(a,b);break;default:!d._hasErrors||e&&!d._lastHasErrors?d._done(a,b):d._error(a,b)}});else{isNaN(h/i)||(SO.isArray(d.options.job)?d.$_progressBar.progressbar({value:100*(1*(h/i)/d.options.job.length)+100*(d._currentJobIdx/d.options.job.length)}):d.$_progressBar.progressbar({value:100*(h/i)}));var l=Math.round(a.settings.delay+Math.min(Math.max(0,2e3*(d._noProgression-2)),36e5));d.statusTimer=setTimeout(function(){d.getStatusAndLogs(a,j,!1)},l)}}},c)}},_reset:function(){var a=this;a._currentJobIdx=0,a._hasErrors=!1,a._lastHasErrors=!1,a._hasWarnings=!1,a._currentlyRunning=!1,a.$_startButton.button("disable"),a.$_closeButton.hide(),a.$_cancelButton.show(),a.$_message.soActionMessage("setMessage",a.options.initMsgLabel),a.$_message.soActionMessage("setState","info"),a._refreshLogListHeight(),a.$_progressBar.progressbar({value:0}).show()},_getCurrentJob:function(){var a=this;return SO.isArray(a.options.job)?a.options.job[a._currentJobIdx]:a.options.job},_startNextJob:function(){var a=this;SO.isArray(a.options.job)&&a._currentJobIdx<a.options.job.length-1&&(a._currentJobIdx++,a.$_progressBar.progressbar({value:Math.round(100*a._currentJobIdx/a.options.job.length)}),a._executeJob(a._getCurrentJob()))},_executeJob:function(a){var b=this;SO.isArray(b.options.job)&&(b._logData.push({status:NL.JobInterface.JOBSTATUS_NONE,logType:NL.JobInterface.JOBLOGTYPE_CATEGORY,message:a.settings.title?xtk_core.jobProgressIndicator_currentSectionTitle_S(a.settings.title):xtk_core.jobProgressIndicator_currentSectionNoTitle_I(b._currentJobIdx+1)}),b.$_logList.soList("refresh")),b._currentlyRunning=!0,a.execute(function(a,c){c?b._processError(c,b.options.execErrorLabel,"ExecuteError"):b.getStatusAndLogs(a,c,!1)})},_done:function(b,c){var d=this,e=!0;SO.isArray(d.options.job)&&(e=d._currentJobIdx===d.options.job.length-1),e&&(d._currentlyRunning=!1,d._toggleButtons()),c?d._processError(c,d.options.getStatusErrorLabel,"GetStatusError"):(d.getStatusAndLogs(b,c,!0),e?(d.$_progressBar.progressbar({value:100}),d._hasErrors?(d.$_message.soActionMessage("setMessage",d.options.doneErrorLabel),d.$_message.soActionMessage("setState","error")):d._hasWarnings?(d.$_message.soActionMessage("setMessage",d.options.doneWarningLabel),d.$_message.soActionMessage("setState","warning")):(d.$_message.soActionMessage("setMessage",d.options.doneLabel),d.$_message.soActionMessage("setState","success")),d._refreshLogListHeight()):d.$_progressBar.progressbar({value:Math.round(100*(d._currentJobIdx+1)/d.options.job.length)}),d._refreshLogListHeight(),e&&a.isFunction(d.options.done)&&d.options.done.call(d,b,c)),e||c&&d.options.stopOnJobError||d._startNextJob()},_canceled:function(b,c){var d=this;d._currentlyRunning=!1,d._toggleButtons(),c?d._processError(c,d.options.getStatusErrorLabel,"GetStatusError"):(d.getStatusAndLogs(b,c,!0),d.$_message.soActionMessage("setMessage",d.options.errorLabel),d.$_message.soActionMessage("setState","error"),d._refreshLogListHeight(),a.isFunction(d.options.canceled)&&d.options.canceled.call(d,b,c))},_error:function(b,c){var d=this,e=!SO.isArray(d.options.job)||d.options.job.length-1===d._currentJobIdx;(d.options.stopOnJobError||e)&&(d._currentlyRunning=!1,d._toggleButtons()),c?d._processError(c,d.options.getStatusErrorLabel,"GetStatusError"):(d.getStatusAndLogs(b,c,!0),(d.options.stopOnJobError||e)&&(d.$_message.soActionMessage("setMessage",d.options.errorLabel),d.$_message.soActionMessage("setState","error"),d._refreshLogListHeight()),a.isFunction(d.options.error)&&d.options.error.call(d,b,c)),d.options.stopOnJobError||d._startNextJob()},_defaultLogListRender:function(b,c,d){var e=a("<div></div>").addClass("nlui-jobProgressIndicator-log-line"),f="",g="";switch(NL.XTK.parseInt(b.logType,0)){case NL.JobInterface.JOBLOGTYPE_ERROR:f="alert",g="error";break;case NL.JobInterface.JOBLOGTYPE_WARNING:f="notice",g="warning";break;default:f="info",g="info"}if(NL.XTK.parseInt(b.logType,0)===NL.JobInterface.JOBLOGTYPE_CATEGORY){var h=a("<div></div>").text(b.message);d.addClass("nlui-list-categoryitem"),e.append(h)}else{var i=a("<div></div>").addClass("nlui-jobProgressIndicator-log-date").text(NL.View.dateTime(b.logDate,null,"time")||"").prepend(NL.View.genImage("ui-icon-"+f).addClass("nlui-icon-"+g)),j=a("<div></div>").addClass("nlui-jobProgressIndicator-log-message");b.message&&b.message.match(/---(.*)---/)&&j.addClass("nlui-jobProgressIndicator-log-message-bold"),j.text(b.message),e.append(i),e.append(j)}return e},_processError:function(b,c){var d=this,e=!SO.isArray(d.options.job)||d.options.job.length-1===d._currentJobIdx;(d.options.stopOnJobError||e)&&(d.$_message.soActionMessage("setMessage",c),d.$_message.soActionMessage("setState","error"),d._refreshLogListHeight());var f=b;SO.isObject(b)&&(f=b.message),d._logData.push({status:NL.JobInterface.JOBSTATUS_ERROR,logType:NL.JobInterface.JOBLOGTYPE_ERROR,message:f}),d.$_logList.soList("refresh"),(d.options.stopOnJobError||e)&&(d._toggleButtons(),d._currentlyRunning=!1,a("<div></div>").soMessageBox({type:"error",message:f}))},_refreshLogListHeight:function(){var a=this.element.soDialog("getBody"),b=a.height(),c=this.$_message.outerHeight(!0),d=this.$_logList.find(".nlui-list-header").outerHeight(!0);this.$_logList.height(b-c);var e=this.$_logList.find(".nlui-list-body"),f=b-c-d;e.height(f).css("maxHeight",f),this.$_logList.soList("rebuildLayout")},_toggleButtons:function(){this._restartable?this.$_startButton.button("enable"):this.$_startButton.hide(),this.$_closeButton.show(),this.$_cancelButton.hide()}};a.widget("NL.nlJobProgressIndicatorInDialog",a.NL.nlWidget,b)}(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
(function(a){var b={_logData:[],_hasWarnings:!1,_hasErrors:!1,_lastHasErrors:!1,_currentJobIdx:0,_currentlyRunning:!1,_restartable:!0,_restartAfterError:!0,_multipleJobs:!1,_noProgression:0,_oldCurrentStep:0,$_progressContainer:null,$_message:null,$_logList:null,$_progressBar:null,$_startButton:null,$_closeButton:null,$_cancelButton:null,options:{job:{},autoStart:!1,maxLog:100,maxWarningInLog:10,maxErrorInLog:10,stopOnJobError:!0,onBeforeStart:function(){},beforeStart:null,onStart:function(){},onSuccess:function(){},done:null,onCancel:function(){},canceled:null,onError:function(){},error:null,onWarning:function(){},listEmptyTextLabel:xtk_core.jobProgressIndicator_listEmptyTextLabel(),titleLabel:xtk_core.jobProgressIndicator_titleLabel(),startLabel:xtk_core.jobProgressIndicator_startLabel(),stopLabel:xtk_core.jobProgressIndicator_stopLabel(),resumeLabel:xtk_core.jobProgressIndicator_resumeLabel(),closeLabel:xtk_core.jobProgressIndicator_closeLabel(),displayLogLabel:xtk_core.jobProgressIndicator_displayLogLabel(),hideLogLabel:xtk_core.jobProgressIndicator_hideLogLabel(),initMsgLabel:xtk_core.jobProgressIndicator_initMsgLabel(),inProgressLabel:xtk_core.jobProgressIndicator_inProgressLabel(),doneLabel:xtk_core.jobProgressIndicator_doneLabel(),doneWarningLabel:xtk_core.jobProgressIndicator_doneWarningLabel(),doneErrorLabel:xtk_core.jobProgressIndicator_doneErrorLabel(),errorLabel:xtk_core.jobProgressIndicator_errorLabel(),cancelLabel:xtk_core.jobProgressIndicator_cancelLabel(),execErrorLabel:xtk_core.jobProgressIndicator_execErrorLabel(),cancelErrorLabel:xtk_core.jobProgressIndicator_cancelErrorLabel(),getStatusErrorLabel:xtk_core.jobProgressIndicator_getStatusErrorLabel(),listSearcheable:!1,listTitle:null},_create:function(){var b=this;this.element.addClass("nlui-jobprogressindicator"),this._$mainContainer=a("<div></div>").addClass("nl-job-progress-container-main").appendTo(this.element),this._multipleJobs=SO.isArray(this.options.job),this._multipleJobs?SO.Utils.each(this.options.job,function(a,c){b._restartable=b._restartable&&c.settings.restartable,b._restartAfterError=b._restartAfterError&&c.settings.restartAfterError}):(this._restartable=this.options.job.settings.restartable,this._restartAfterError=this.options.job.settings.restartAfterError),this.$_logList=a("<div></div>").addClass("nlui-jobprogressindicator-loglist ui-corner-all").appendTo(this._$mainContainer),this.$_progressBar=a('<div class="nlui-jobprogressindicator" ></div>').progressbar({roundedCorners:!0,width:"100%",textPosition:"center",color:"blue"}).hide(),this._logData=[];var c,d={},e={},f="jobProgress_list_"+SO.Utils.sequence().nextVal();e[f]={type:"list",elements:{id:{type:"string",label:"id"},iRc:{type:"string",label:"iRc"},logDate:{type:"string",label:"logDate"},logType:{type:"string",label:"logType"},message:{type:"string",label:"message"},object:{type:"string",label:"object"}}},d[f]=this._logData,c=new SO.MVC.Controller({model:d,metamodel:e}),this.$_logList.soList({controller:c,jpath:f,layoutSize:"large",autoLoad:!1,localStorage:{plugins:!1},title:this.options.listTitle,renderingMethods:{jopProgressIndicatorRenderer:{family:"line",label:"",icon:"",renderer:function(a,c,d){return b._defaultLogListRender(a,c,d)}}},defaultRendering:"jopProgressIndicatorRenderer",search:this.options.listSearcheable,headless:!this.options.listSearcheable&&null===this.options.listTitle,fitToParentHeight:!0,postFilter:function(a,b){var c,d,e,f=!1;for(c=0;b.length>c;c++)if(e=b[c],"$1"===e.wildcard){d=e.value;break}return f=d&&a.logType!==NL.JobInterface.JOBLOGTYPE_CATEGORY?SO.String.contains(a.message,d)?!0:!1:!0}}),this.$_progressContainer=a('<div class="nlui-jobprogressindicator-progresscontainer"></div>').css({position:"absolute",left:10,right:10,bottom:0,height:35}).append(this.$_progressBar).appendTo(this._$mainContainer),this.options.autoStart&&this.start()},_setOption:function(){a.NL.nlWidget.prototype._setOption.apply(this,arguments)},destroy:function(){this.element.remove()},start:function(){var b;this._reset(),b=this._getCurrentJob(),this.rebuildLayout(),this.options.onBeforeStart(),a.isFunction(this.options.beforeStart)&&this.options.beforeStart.call(this),this._executeJob(b)},cancel:function(){var a=this,b=this._getCurrentJob();this._currentlyRunning=!1,b.cancel(function(b,c){c?a._processError(c,a.options.cancelErrorLabel,"CancelError"):a.getStatusAndLogs(b,c,!1)})},getStatusAndLogs:function(a,b,c){var d,e=this,f=!SO.isArray(this.options.job)||this._currentJobIdx===this.options.job.length-1,g=0,h=[],i=0,j=0;b?(this._processError(b,this.options.getStatusErrorLabel,"GetStatusError"),this.options.stopOnJobError||this._startNextJob()):a.getStatus(function(b,k){if(k)e._processError(k,e.options.getStatusErrorLabel,"GetStatusError");else{if(b.current>e._oldCurrentStep?(e._oldCurrentStep=b.current,e._noProgression=0):e._noProgression++,g=b.status,h=b.logs,i=b.current,j=b.max,h.length){for(d=0;h.length>d;d++)e._logData.push(h[d]),Number(h[d].logType)===NL.JobInterface.JOBLOGTYPE_WARNING&&(e._hasWarnings=!0),Number(h[d].logType)===NL.JobInterface.JOBLOGTYPE_ERROR&&(e._hasErrors=!0,f&&(e._lastHasErrors=!0));e.$_logList.soList("refresh")}if(a.isDone())c||a.completed(function(a,b){switch(Number(g)){case NL.JobInterface.JOBSTATUS_CANCELED:e.$_progressBar.progressbar({color:"darkgrey"}),e._canceled(a,b);break;case NL.JobInterface.JOBSTATUS_ERROR:e.$_progressBar.progressbar({color:"red"}),e._error(a,b);break;default:!e._hasErrors||f&&!e._lastHasErrors?(e.$_progressBar.progressbar({color:"green"}),e._done(a,b)):(e.$_progressBar.progressbar({color:"red"}),e._error(a,b))}});else{isNaN(i/j)||(SO.isArray(e.options.job)?e.$_progressBar.progressbar({value:100*(1*(i/j)/e.options.job.length)+100*(e._currentJobIdx/e.options.job.length)}):e.$_progressBar.progressbar({value:100*(i/j)}));var l=Math.round(a.settings.delay+Math.min(Math.max(0,2e3*(e._noProgression-2)),36e5));e.statusTimer=setTimeout(function(){e.getStatusAndLogs(a,k,!1)},l)}}},c)},_reset:function(){this._currentJobIdx=0,this._hasErrors=!1,this._lastHasErrors=!1,this._hasWarnings=!1,this._currentlyRunning=!1,this._logData.length=0,this.$_logList.soList("refresh"),this.rebuildLayout(),this.$_progressBar.progressbar({value:0}).show()},_getCurrentJob:function(){return SO.isArray(this.options.job)?this.options.job[this._currentJobIdx]:this.options.job},_startNextJob:function(){SO.isArray(this.options.job)&&this._currentJobIdx<this.options.job.length-1&&(this._currentJobIdx++,this.$_progressBar.progressbar({value:Math.round(100*this._currentJobIdx/this.options.job.length)}),this._executeJob(this._getCurrentJob()))},_executeJob:function(a){var b=this;SO.isArray(this.options.job)&&(this._logData.push({status:NL.JobInterface.JOBSTATUS_NONE,logType:NL.JobInterface.JOBLOGTYPE_CATEGORY,message:a.settings.title?xtk_core.jobProgressIndicator_currentSectionTitle_S(a.settings.title):xtk_core.jobProgressIndicator_currentSectionNoTitle_I(this._currentJobIdx+1)}),this.$_logList.soList("refresh")),this._currentlyRunning=!0,a.execute(function(a,c){c?b._processError(c,b.options.execErrorLabel,"ExecuteError"):b.getStatusAndLogs(a,c,!1)}),this.options.onStart(a)},_done:function(b,c){var d=!0;SO.isArray(this.options.job)&&(d=this._currentJobIdx===this.options.job.length-1),d&&(this._currentlyRunning=!1),c?this._processError(c,this.options.getStatusErrorLabel,"GetStatusError"):(this.getStatusAndLogs(b,c,!0),d?(this.$_progressBar.progressbar({value:100}),this._hasErrors?this.$_progressBar.progressbar({color:"red"}):this._hasWarnings?this.$_progressBar.progressbar({color:"orange"}):this.$_progressBar.progressbar({color:"green"}),this.rebuildLayout()):this.$_progressBar.progressbar({value:Math.round(100*(this._currentJobIdx+1)/this.options.job.length)}),this._hasWarnings&&this.options.onWarning(b,c),this.rebuildLayout(),d&&(this.options.onSuccess(b,c),a.isFunction(this.options.done)&&this.options.done.call(this,b,c))),d||c&&this.options.stopOnJobError||this._startNextJob()},_canceled:function(b,c){this._currentlyRunning=!1,c?this._processError(c,this.options.getStatusErrorLabel,"GetStatusError"):(this.getStatusAndLogs(b,c,!0),this.rebuildLayout(),this.options.onCancel(b,c),a.isFunction(this.options.canceled)&&this.options.canceled.call(this,b,c))},_error:function(b,c){var d=!SO.isArray(this.options.job)||this.options.job.length-1===this._currentJobIdx;(this.options.stopOnJobError||d)&&(this._currentlyRunning=!1),c?this._processError(c,this.options.getStatusErrorLabel,"GetStatusError"):(this.getStatusAndLogs(b,c,!0),(this.options.stopOnJobError||d)&&this.rebuildLayout(),this.options.onError(b,c),a.isFunction(this.options.error)&&this.options.error.call(this,b,c)),this.options.stopOnJobError||this._startNextJob()},_defaultLogListRender:function(b,c,d){var e,f,g,h=a("<div></div>").addClass("nlui-jobprogressindicator-log-line"),i="",j="";switch(NL.XTK.parseInt(b.logType,0)){case NL.JobInterface.JOBLOGTYPE_ERROR:i="alert",j="error";break;case NL.JobInterface.JOBLOGTYPE_WARNING:i="notice",j="warning";break;default:i="info",j="info"}return NL.XTK.parseInt(b.logType,0)===NL.JobInterface.JOBLOGTYPE_CATEGORY?(g=a("<div></div>").text(b.message),d.addClass("nlui-list-categoryitem"),h.append(g)):(e=a("<div></div>").addClass("nlui-jobprogressindicator-log-date").text(NL.View.dateTime(b.logDate,null,"time")||"").prepend(NL.View.genImage("ui-icon-"+i).addClass("nlui-icon-"+j)),f=a("<div></div>").addClass("nlui-jobprogressindicator-log-message"),b.message&&b.message.match(/---(.*)---/)&&f.addClass("nlui-jobprogressindicator-log-message-bold"),f.text(b.message),h.append(e),h.append(f)),h},_processError:function(b){var c,d=!SO.isArray(this.options.job)||this.options.job.length-1===this._currentJobIdx;(this.options.stopOnJobError||d)&&this.rebuildLayout(),c=b,SO.isObject(b)&&(c=b.message),this._logData.push({status:NL.JobInterface.JOBSTATUS_ERROR,logType:NL.JobInterface.JOBLOGTYPE_ERROR,message:c}),this.$_logList.soList("refresh"),this.options.onError(d,b),(this.options.stopOnJobError||d)&&(this._currentlyRunning=!1,a("<div></div>").soMessageBox({type:"error",message:c}))},rebuildLayout:function(){var a=this.element.height();this._$mainContainer.height(a),this.$_logList.height(a-this.$_progressContainer.outerHeight()),this.$_logList.soList("rebuildLayout")}};a.widget("NL.nlJobProgressIndicator",a.NL.nlWidget,b)})(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";function progressBarHtml(a,b){var c=function(a,b){var c=a.innerHTML,d=c.match(/<\/?\w+((\s+\w+(\s*=\s*(?:".*?"|'.*?'|[^'">\s]+))?)+\s*|\s*)\/?>/g);if(d)for(var e=0;d.length>e;e++){var f,g=d[e],h=/\=[a-zA-Z\.\:\[\]_\(\)\&\$\%#\@\!0-9]+[?\s+|?>]/g;if(d[e]=d[e].replace(/(<?\w+)|(<\/?\w+)\s/,function(a){return a.toLowerCase()}),f=d[e].match(h))for(var i=0,j=f.length;j>i;){var k=/(\=)([a-zA-Z\.\:\[\]_\(\)\&\$\%#\@\!0-9]+)?([\s+|?>])/g,l=function(){var a=Array.prototype.slice.call(arguments);return'="'+(b?a[2].toLowerCase():a[2])+'"'+a[3]};d[e]=d[e].replace(f[i],f[i].replace(k,l)),i++}c=c.replace(g,d[e])}return c},d=jQuery("<span></span>").appendTo("body").progressbar({value:Number(a),color:b,labelSetToMaxWidth:!0});return d.children().removeAttr("aria-valuemax aria-valuemin aria-valuenow"),d.removeAttr("aria-valuemax").detach(),c(d.wrap("<div></div>").parent()[0])}(function(a,b){a.widget("NL.progressbar",a.ui.progressbar,{options:{color:"blue",min:0,roundedCorners:!1,width:null,height:null,textPosition:"center",labelSetToMaxWidth:!1,labelMaxSize:13,labelMinSize:11,labelText:function(){return this.percentageString()}},_knownColors:["blue","Blue","brown","Brown","red","Red","green","Green","darkgrey","DarkGrey","orange"],_DEFAULT_VALUE_DIV_CLASS:"nlui-progressbar-block",_paint:function(){this.valueDiv.removeClass(this.valueDivClass),this.valueDivClass=this._DEFAULT_VALUE_DIV_CLASS,a.inArray(this.options.color,this._knownColors)&&(this.valueDivClass+="-"+this.options.color.toLowerCase()),this.valueDiv.addClass(this.valueDivClass+" nlui-progressbar-progress")},_setLabelText:function(b){this._labelText=a.isFunction(b)?b:function(){return b}},_getLabelText:function(){return this._labelText()},_create:function(){this._$widget=this.element.addClass("nlui-progressbar"),this.element=a("<div></div>").appendTo(this._$widget).addClass("nlui-progressbar-container");var b=!1;if(0===this._$widget.parent().length&&(this._$widget.appendTo("body"),b=!0),"center"==this.options.textPosition?this.label=a("<label></label>").appendTo(this.element).addClass("nlui-progressbar-center-label"):"left"==this.options.textPosition&&(this.label=a("<label></label>").prependTo(this._$widget).addClass("nlui-progressbar-side-label"),this.element.css("float","left")),this._setLabelText(this.options.labelText),a.ui.progressbar.prototype._create.call(this),this.element.removeClass("ui-corner-all"),this._paint(),"center"==this.options.textPosition){var c=parseInt(this.valueDiv.css("z-index"),10);isNaN(c)?this.label.css("z-index",2):this.label.css("z-index",c+1)}this._refreshSize(),b&&this._$widget.detach()},_setOption:function(b,c){"color"===b?(this.options.color=c,this._paint()):"width"===b?(this.options.width=c,this._refreshSize()):"height"===b?(this.options.height=c,this._refreshSize()):"labelText"===b?(this._setLabelText(c),this._refreshValue()):"value"===b?this.options.min>c?a.ui.progressbar.prototype._setOption.call(this,b,this.options.min):c>this.options.max?a.ui.progressbar.prototype._setOption.call(this,b,this.options.max):a.ui.progressbar.prototype._setOption.call(this,b,c):a.ui.progressbar.prototype._setOption.call(this,b,c),a.Widget.prototype._setOption.apply(this,arguments)},_refreshValue:function(){a.ui.progressbar.prototype._refreshValue.call(this),this.valueDiv.removeClass("ui-corner-left ui-corner-right"),this.label.text(this._labelText())},_computeLabelPosition:function(){var a=this.options;if(this.label!==b){var c;if(c="center"==this.options.textPosition?this.element.height()-3:this.element.height()-4,this.label.css("font-size",Math.min(Math.max(c,a.labelMinSize),a.labelMaxSize)+"px"),this.options.labelSetToMaxWidth===!0){var d=this.value();this.value(100),this.label.width(this.label.width()),this.value(d)}}},_refreshSize:function(){var b=this;a.each(["height","width"],function(a,c){var d=b.options[c];null!==d&&(isNaN(d)?(b._$widget.css(c,d),"width"===c&&"auto"===d&&b._$widget.css("display","block"),"height"===c&&b.element.css(c,d)):(b._$widget.css(c,d+"px"),"height"===c&&b.element.css(c,d+"px")))}),this._computeLabelPosition(),"left"==this.options.textPosition&&(this.label.width(this.label.width()),this._$widget.width(this._$widget.width()),this.element.outerWidth(this._$widget.width()-this.label.outerWidth({margin:!0})))},percentageString:function(){return Math.round(this.value())+"%"},labelText:function(a){return a===b?this._getLabelText():(this._setLabelText(a),void 0)},value:function(c){return c===b?a.ui.progressbar.prototype.value.call(this):(this._setOption("value",c),void 0)},destroy:function(){this.element.removeClass("nlui-progressbar"),this.label.remove(),a.ui.progressbar.prototype.destroy.call(this)}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("SimpleMessage",{DEFAULT_OPTIONS:{displayIcon:!0,title:void 0,message:void 0,state:"normal"},_classFromState:{normal:"nlui-message-normal",success:"nlui-message-success",info:"nlui-message-info",warning:"nlui-message-warning",error:"nlui-message-error"},_iconClassFromState:{normal:"coral-share",success:"coral-checkCircle",info:"coral-helpCircle",warning:"coral-alert",error:"coral-alert"},_titleLabelFromState:{normal:xtk_sirocco.dialog_info(),success:xtk_sirocco.dialog_success(),info:xtk_sirocco.dialog_info(),warning:xtk_sirocco.dialog_warning(),error:xtk_sirocco.dialog_error()},_create:function(){this.$el.addClass("nlui-simple-message"),this.$el.html(this._buildHTML({title:this._options.title,message:this._options.message,state:this._options.state,displayIcon:this._options.displayIcon}))},_buildHTML:function(a){var b=$("<div>"),c=$("<div>",{"class":"nlui-message-wrapper "+this._getClass(this._classFromState,a.state)}),d=$("<span>",{"class":"nlui-message-title-text",text:a.title}),e=$("<div>",{"class":"nlui-message-title-container"}),f=$("<div>",{"class":"nlui-message-container",html:a.message});return a.displayIcon?e.prepend(this._buildIcon(a.state)):e.addClass("iconless"),e.append(d),c.append(e,f),b.append(c),b.html()},_buildIcon:function(a){var b=SO.IMG.genIcon(this._getClass(this._iconClassFromState,a),18).el;return b.classList.add("nlui-message-icon"),b},_getClass:function(a,b){return a[b]||a.normal},destroy:function(){this.$el.removeClass("nlui-simple-message"),this.$el.empty()}}),$.widget("SO.soSimpleMessage",{_create:function(){this._widget=new SO.Widgets.SimpleMessage(this.element,this.options)},_destroy:function(){this._widget.destroy()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("ActionMessage","SimpleMessage",{DEFAULT_OPTIONS:{displayIcon:"none",cmdBar:void 0,viewBar:void 0,closable:!1,keepClosed:!1,autoVanish:!1,autoVanishDelay:1500,destroyOnClose:!0,header:!0},_create:function(){this._options.message&&"string"==typeof this._options.message&&(this._options.message=[this._options.message]),this._options.title&&this._options.header?this._options.displayIcon="title":(this._options.header=!1,this._options.displayIcon="message"),this._options.confId=this._getElementHash(),this.$el.addClass("nlui-action-message"),this._buildHTML(),this._options.autoVanish&&this._autoVanish(this._options.autoVanishDelay,this._options.destroyOnClose)},_buildHTML:function(){this.getConf().hidden||this.$el.html(this._buildActionMessageContent(this._options))},_buildActionMessageContent:function(a){var b,c,d,e=$("<div>",{"class":this._getClass(this._classFromState,a.state)+" nlui-message-wrapper"});return a.title&&a.header&&(c=this._buildTitle({title:a.title,message:a.message,state:a.state})),a.message&&a.message.length&&(b=this._buildMessage({message:a.message,state:a.state,header:a.header,title:a.title||this._titleLabelFromState[a.state]})),d=a.title&&a.header?c:b,a.cmdBar||a.viewBar?a.cmdBar&&a.cmdBar.commands&&a.cmdBar.commands.length>0?d.append(this._buildCmdBar(a.cmdBar)):a.viewBar&&a.viewBar.views&&a.viewBar.views.length>0&&d.append(this._buildViewBar(a.viewBar)):a.closable&&d.append(this._buildClose()),c&&e.append(c),b&&e.append(b),e},_buildTitle:function(a){var b=$("<div>",{"class":"nlui-message-title-container"});if(a.title){b.append(this._buildIcon(a.state));var c=$("<div>",{"class":"nlui-message-title"});c.append($("<span>",{text:a.title,"class":"nlui-message-title-text"})),b.append(c)}return b},_buildMessage:function(a){var b=$("<div>",{"class":a.header?"nlui-message-container":"nlui-message-description-container"}),c=$("<div>");if(a.message.length)if(SO.Utils.each(a.message,function(b,d){var e=$("<div>",{"class":"nlui-message-text",text:d});0!==b||a.header||e.prepend($("<span>",{"class":"nlui-message-title-description-header",text:a.title})),c.append(e)}),a.header)b.append(c.html());else{var d=this._buildIcon(a.state),e=$("<div>",{"class":"nlui-message-title-description",html:c.html()});b.append(d,e)}return b},_buildCmdBar:function(a){return this._$cmdBar?this._$cmdBar:(this._$cmdBar=$("<div>",{"class":"nlui-message-optional-container nlui-message-content-cell"}),this._$cmdBar.soCmdBar(a),this._$cmdBar)},_buildViewBar:function(a){return this._$viewBar?this._$viewBar:(this._$viewBar=$("<div>",{"class":"nlui-message-optional-container nlui-message-content-cell"}),this._$viewBar.soViewBar(a),this._$viewBar)},_buildClose:function(){var a=this,b=document.createElement("div"),c=SO.IMG.genIcon("coral-close",12).el;return b.setAttribute("tabindex",0),b.classList.add("nlui-message-close"),c.classList.add("nlui-message-close-icon"),b.appendChild(c),SO.Event.bind(b,"vclick",function(){a.$el.slideUp(function(){a._options.keepClosed&&a.saveConf({hidden:!0}),a._options.destroyOnClose&&a.destroy()})}),b},_autoVanish:function(a,b){var c=this;setTimeout(function(){c.$el.slideUp(function(){b&&c.destroy()})},a)},_getElementHash:function(){return["nlui-action-message",this.$el.prop("nodeName"),this.$el.attr("id"),this.$el.attr("class"),this.$el.prop("baseURI"),this._options.title,this._options.message].join("-").toLowerCase().replace(/ /g,"")},getMessage:function(){return 1===this._options.message.length?this._options.message[0]:this._options.message},getTitle:function(){return this._options.title},getState:function(){return this._options.state},setMessage:function(a){this._options.message=a&&"string"==typeof a?[a]:a,this._buildHTML()},setTitle:function(a){this._options.title=a,this._buildHTML()},setState:function(a){this._options.state=a,this._buildHTML()},destroy:function(){this.$el.removeClass("nlui-action-message"),this.$el.empty()},vanish:function(){this._autoVanish(this._options.autoVanishDelay,this._options.destroyOnClose)},show:function(){this.$el.show()}}),$.widget("SO.soActionMessage",{_create:function(){this._widget=new SO.Widgets.ActionMessage(this.element,this.options)},_destroy:function(){this._widget.destroy()},vanish:function(){this._widget.vanish()},show:function(){this._widget.show()},getMessage:function(){return this._widget.getMessage()},getTitle:function(){return this._widget.getTitle()},getState:function(){return this._widget.getState()},setMessage:function(){this._widget.setMessage.apply(this._widget,arguments)},setTitle:function(){this._widget.setTitle.apply(this._widget,arguments)},setState:function(){this._widget.setState.apply(this._widget,arguments)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("viewBar",{DEFAULT_OPTIONS:{controller:null,onRefreshVisibility:void 0,viewConfigs:{},views:[],currentView:void 0,defaultView:void 0,rendering:"bar",mode:void 0,separators:void 0,rightSeparator:void 0,leftSeparator:void 0,maxButtons:null,overflowMode:void 0,overflowClass:void 0,overflowLeftIcon:void 0,overflowRightIcon:void 0,overflowLabel:void 0,minButtonWidth:void 0,onSwitchView:function(){}},_create:function(){var a,b,c;for(b=this,this._currentView=null,this._$buttonContainer=null,this._views=[],this.$el.addClass("nlui-viewbar"),SO.Utils.each(this._options.viewConfigs,function(a,c){b._options.controller.registerView(a,c)}),a=0;this._options.views.length>a;a++)this.addView(this._options.views[a],null,!0);return this._options.controller.registerObserver("views",this,this._options.onRefreshVisibility),this._$buttonContainer=$("<div></div>").appendTo(this.$el).addClass("nlui-viewbar-nav"),"bar"===this._options.rendering?this._$buttonContainer.soButtonBar({mode:this._options.mode,separators:this._options.separators,rightSeparator:this._options.rightSeparator,leftSeparator:this._options.leftSeparator,maxButtons:this._options.maxButtons,overflowMode:this._options.overflowMode,overflowClass:this._options.overflowClass,overflowLeftIcon:this._options.overflowLeftIcon,overflowRightIcon:this._options.overflowRightIcon,overflowLabel:this._options.overflowLabel}):"modeSwitcher"===this._options.rendering&&this._$buttonContainer.soModeSwitcher(),c=this._options.currentView,void 0===c&&(c=this._options.defaultView),void 0===c&&(c=this._views[0]),null!==c&&void 0!==c&&SO.isString(c)?(this._hideAllViews(),this.switchView(c)):this.refresh(),this._options.controller.observerReady(this),this},_extendConfiguration:function(a){var b,c,d,e,f;for(d=[],b=0;a.length>b;b++)if(c=a[b],SO.isString(c)){if(e=this._options.controller.getViewConfiguration(c),e.hidden)continue;e.name=c,f=this._generateButtonConfig(e),d.push(f)}else if(c){if(e={},c.name&&(e=$.extend(e,this._options.controller.getViewConfiguration(c.name))),e=$.extend(e,c.config,{name:c.name,menuPosition:c.menuPosition,subViews:c.subViews}),e.hidden)continue;f=this._generateButtonConfig(e),c.subViews&&(f.subButtons=this._extendConfiguration(c.subViews),f.menuPosition=e.menuPosition,f.label&&void 0===f.rightIcon&&(f.rightIcon="ui-icon-triangle-1-s")),d.push(f)}else d.push(null);return d},_generateButtonConfig:function(a){var b,c,d;return b=this,c="","navigation"===a.type&&(c=SO.isEmpty(a.url)?this._buildViewUrl(a.view,a.params):a.url),a.subViews||(d=function(c,d){b._triggerView(a.name,d)}),{id:a.id,icon:a.icon,iconSize:a.iconSize,label:a.label,mode:a.mode,tooltip:a.help,pushed:a.name===this._currentView,isLink:"navigation"===a.type,href:c,newWindow:a.newWindow,onClick:d}},setViewIcon:function(a,b,c){var d=this._options.controller.getViewConfiguration(a);return d.icon=b,c&&this.refresh(),this},_buildViewUrl:function(a,b){var c=new SO.Structure.URL("/view/"+a);return b&&c.query(b),SO.isEmpty(document.__securitytoken)||c.query("__securitytoken",document.__securitytoken),c.toString()},_triggerView:function(a,b){var c,d,e,f,g,h;return c=this,d=this._options.controller.getViewConfiguration(a),SO.isFunction(d.onBeforeExecuteCommand)&&d.onBeforeExecuteCommand(this._options.controller),(null!==this._currentView&&this._currentView!==a||"navigation"===d.type)&&(e=function(){c.switchView(a),b()},f=SO.isString(this._currentView)?this._options.controller.getViewConfiguration(this._currentView):{checkSave:!1,confirmSave:!1,checkSaveTargets:[],confirmSaveTargets:[]},g=f.checkSave,h=f.confirmSave,"navigation"===d.type&&void 0===g&&void 0===h&&(g=!0),g&&!SO.isNundef(f.checkSaveTargets)&&-1===f.checkSaveTargets.indexOf(a)&&(g=!1),h&&!SO.isNundef(f.confirmSaveTargets)&&-1===f.confirmSaveTargets.indexOf(a)&&(h=!1),h?this._options.controller.confirmSave(function(a){a&&e.call()}):g?this._options.controller.checkSave(function(a){a&&e.call()}):e.call()),this},_hideAllViews:function(){var a,b;for(a=0;this._views.length>a;a++)b=this._views[a],SO.isString(b)&&(b=this._options.controller.getViewConfiguration(b)),b&&("block"===b.type?this._hideBlockView(b):"code"===b.type?this._hideCodeView(b):"embedded"===b.type&&this._hideEmbeddedView(b))},switchView:function(a){var b,c;return b=a?this._options.controller.getViewConfiguration(a):{},(this._currentView!==a||"navigation"===b.type)&&(null!==this._currentView&&void 0!==this._currentView&&(c=this._options.controller.getViewConfiguration(this._currentView),"block"===c.type?this._hideBlockView(c):"code"===c.type?this._hideCodeView(c):"embedded"===c.type&&this._hideEmbeddedView(c),"navigation"!==b.type||b.newWindow||this._displayNavigationMessage()),this._currentView=a,this._options.onSwitchView(a,this._views.indexOf(a),this),this.refresh(),"block"===b.type?this._showBlockView(b):"code"===b.type?this._showCodeView(b):"embedded"===b.type&&this._showEmbeddedView(b)),this},getCurrentView:function(){return this._currentView},getViews:function(){return this._$buttonContainer.soButtonBar("getButtons")},_showBlockView:function(a){var b,c;for(b=0;a.blocks.length>b;b++)c=$(a.blocks[b]),c.show();return a.onDisplay&&a.onDisplay(),this},_hideBlockView:function(a){var b,c;for(b=0;a.blocks.length>b;b++)c=$(a.blocks[b]),c.hide();return a.onHide&&a.onHide(),this},_showCodeView:function(a){return a.onDisplay&&a.onDisplay(),this},_hideCodeView:function(a){return a.onHide&&a.onHide(),this},_showEmbeddedView:function(){return this},_hideEmbeddedView:function(){return this},_displayNavigationMessage:function(){return $("<div></div>").soNavigationBox(),this},_setLocalAttribute:function(a,b,c,d){var e,f;for(e=0;a.length>e;e++)f=a[e],f&&!SO.isString(f)&&(f.name===b&&void 0!==f.config&&void 0!==f.config[c]&&(f.config[c]=d),f.subViews&&this._setLocalAttribute(f.subViews,b,c,d));return this},refresh:function(){var a=this._extendConfiguration(this._views);return"bar"===this._options.rendering?this._$buttonContainer.soButtonBar("setButtons",a):"modeSwitcher"===this._options.rendering&&this._$buttonContainer.soModeSwitcher("setButtons",a),this},onViewNotify:function(){this.refresh()},addView:function(a,b,c){return this._views.push(a),b&&this._options.controller.registerView(a,b),c||this.refresh(),this},triggerView:function(a){var b,c,d;return c=this._options.controller.getViewConfiguration(a),d=function(){},b="","navigation"===c.type&&(b=SO.isEmpty(c.url)?this._buildViewUrl(c.view,c.params):c.url,d=function(){window.location=b}),this._triggerView(a,d),this},getViewAttribute:function(a,b){return this._options.controller.getViewAttribute(a,b)},setViewAttribute:function(a,b,c,d){var e=this._options.controller.getViewAttribute(a,b);return e!==c&&(this._options.controller.setViewAttribute(a,b,c),this._setLocalAttribute(this._views,a,b,c),d||this.refresh()),this},destroy:function(){return this._options.controller.unregisterObserver("views",this,this._options.onRefreshVisibility),this._$buttonContainer.remove(),this}}),$.widget("SO.soViewBar",{_create:function(){this._widget=new SO.Widgets.viewBar(this.element,this.options)},_destroy:function(){this._widget.destroy()},refresh:function(){this._widget.setViewAttribute()},onViewNotify:function(a,b){this._widget.onViewNotify(a,b)},addView:function(a,b,c){this._widget.addView(a,b,c)},triggerView:function(a,b){this._widget.triggerView(a,b)},getViewAttribute:function(a,b){return this._widget.getViewAttribute(a,b)},setViewAttribute:function(a,b,c,d){this._widget.setViewAttribute(a,b,c,d)},setViewIcon:function(a,b,c){this._widget.setViewIcon(a,b,c)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("ModeSwitcher",{DEFAULT_OPTIONS:{buttons:[],mode:"transparent",iconSize:24},_create:function(){this._buttonsConfig=[],this._buttons=[],this._currentMode=0,this._initialized=!1,this._$currentEl=$(),this._isCollapsed=!0,this.$el.addClass("nlui-modeswitcher"),this._$listWrapper=$("<div></div>").addClass("nlui-modeswitcher-icons-wrapper").appendTo(this.$el),this._$list=$("<ul></ul>").addClass("nlui-modeswitcher-icons").appendTo(this._$listWrapper),this._$labelWrapper=$("<div></div>").addClass("nlui-modeswitcher-label-wrapper").appendTo(this.$el),this._$label=$("<p></p>").addClass("nlui-modeswitcher-label").appendTo(this._$labelWrapper);for(var a=0;this._options.buttons.length>a;a++)this.addButton(this._options.buttons[a],!0);this.refresh()},addButton:function(a,b){return this._buttonsConfig.push(a),b||this.refresh(),this},setButtons:function(a){return this._buttonsConfig=a,this.refresh(),this},empty:function(){return this._buttonsConfig=[],this._button=[],this.refresh(),this},_getCompiledConfig:function(){var a,b,c=this;return a=SO.Utils.map(this._buttonsConfig,function(a,d){return b=null,null!==d&&(b=$.extend({current:a===c._currentMode,isPushed:a===c._currentMode,iconSize:c._options.iconSize,mode:c._options.mode,help:d.label,flat:!0},d),b.onClick=function(){if(a===c._currentMode)c._isCollapsed?c.expand():c.collapse();else{var b=this,e=Array.prototype.slice.call(arguments);c.setCurrent(a),c.collapse(),setTimeout(function(){c.refresh(),SO.isFunction(d.onClick)&&d.onClick.apply(b,e),c._$currentEl.soSimpleButton("setPushed",!1),c._buttonsConfig[c._currentMode].pushed=!1},300)}},delete b.label),b})},refresh:function(a){var b,c,d,e,f,g,h,i=this._getCompiledConfig(),j=this._buttons=[],k=i[this._currentMode];if(0===i.length)return this;this._$currentEl=$('[data-index="'+this._currentMode+'"]',this._$list),this.collapse(),this._initialized||(e=$("<div></div>").addClass("nlui-modeswitcher-root").appendTo($(document.body)),this.$el.parent().length>0&&(f=this.$el.parent()),this.$el.detach().appendTo(e),k.isPushed=!1),this._$list.children().remove(),this._$currentEl.detach().removeClass("light");for(var l=0;i.length>l;l++)d=$("<li></li>").attr("data-index",l),b=i[l],c=this._drawButton(b,d),l===this._currentMode?(this._$currentEl=d,d.addClass("nlui-modeswitcher-icon-current")):this._$list.append(d),j.push(d);return this._$list.prepend(this._$currentEl),g=this._$list[0].clientHeight,h=this._$list[0].clientWidth,this.$el.css({height:g+"px"}),this._$label.text(k.help),this._initialized||(this._initialized=!0,this.$el.detach(),f&&this.$el.appendTo(f),e.detach()),SO.isFunction(a)&&a.call(this),this},_drawButton:function(a,b){var c=!1;return b.is(":so-soSimpleButton")&&b.soSimpleButton("destroy"),b.children().remove(),b.empty(),b.addClass("nlui-modeswitcher-icon"),a.hidden||(b.soSimpleButton(a),c=!0),c},expand:function(a){var b,c,d,e,f=this,g=this._$list.children(),h=g.filter(function(){return parseInt($(this).attr("data-index"),10)<f._currentMode});return this.$el.one("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){c=f._$list[0].clientHeight,b=f._$list[0].clientWidth,d=f._$currentEl[0].clientWidth,g.each(function(a,b){$(b).css({top:0,left:d*a+"px",position:"absolute"})}),f._$list.css({width:b,height:c}),f.$el.addClass("expanded"),h.length>0&&(e=h.last()[0].offsetLeft,h.each(function(a,b){$(b).css({left:b.offsetLeft-d+"px"})}),f._$currentEl.css("left",e+"px")),SO.isFunction(a)&&a.call(f)}),g.each(function(a,b){a!==f._currentModec&&$(b).addClass("light")}),this.$el.removeClass("collapsed"),this._isCollapsed=!1,this},collapse:function(a){var b=this,c=this._$list.children(),d=c.filter(function(){return parseInt($(this).attr("data-index"),10)<b._currentMode});c.filter(function(){return parseInt($(this).attr("data-index"),10)>b._currentMode});var e,f=function(){c.each(function(a,b){$(b).css({top:"",left:"",position:""})}),b._$list.css({width:"",height:""}),b.$el.addClass("collapsed").removeClass("expanded"),SO.isFunction(a)&&a.call(b)};return d.length>0?(e=this._$currentEl[0].clientWidth,d.each(function(a,b){$(b).css({left:b.offsetLeft+e+"px"})}),this._$currentEl.css("left","0"),setTimeout(f,300)):f(),this._isCollapsed=!0,this},destroy:function(){return this},getButtons:function(){return this._buttons},setCurrent:function(a,b){this._buttons;var c=this._currentMode,d=this._$currentEl;return this._currentMode=a,this._$currentEl=$('[data-index="'+a+'"]',this._$list),this._$currentEl.addClass("nlui-modeswitcher-icon-current").siblings().removeClass("nlui-modeswitcher-icon-current"),d.soSimpleButton("setPushed",!1),this._$currentEl.soSimpleButton("setPushed",!0),this._buttonsConfig[c].isPushed=!1,this._buttonsConfig[a].isPushed=!0,b===!0&&this.refresh(),this}}),$.widget("SO.soModeSwitcher",{_create:function(){this._widget=new SO.Widgets.ModeSwitcher(this.element,this.options)},_destroy:function(){this._widget.destroy()},addButton:function(a,b){this._widget.addButton(a,b)},setButtons:function(a){this._widget.setButtons(a)},empty:function(){this._widget.empty()},refresh:function(){this._widget.refresh()},getButtons:function(){return this._widget.getButtons()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.Widgets"),$(function(){SO.Widgets.NavigationManager=function(){this._currentBox=null},SO.Widgets.NavigationManager.prototype={setCurrentBox:function(a){this._currentBox&&this.closeCurrentBox(),this._currentBox=a},closeCurrentBox:function(){this._currentBox&&this._currentBox.destroy(),this._currentBox=null}};var a=null;SO.Widgets.getGlobalNavigationManager=function(){return null===a&&(a=new SO.Widgets.NavigationManager),a}}()),SO.Widgets.define("NavigationBox",{DEFAULT_OPTIONS:{message:xtk_sirocco.dialog_navigatingLabel()},_create:function(){var a={closeButton:!1,dialogClass:"nlui-navigation-box",draggable:!1,header:!1,resizable:!1,width:240};this.$el.soDialog(a),this._setContent(this._options.message),SO.Widgets.getGlobalNavigationManager().setCurrentBox(this)},_setContent:function(a){var b=$("<div></div>",{"class":"nlui-navigation-box-wrapper"}),c=$("<span></span>",{"class":"nlui-navigation-box-text",text:a}),d=$("<div></div>",{"class":"clui-wait-indicator"});b.append(d,c),this.$el.soDialog("setContent",b)},setMessage:function(a){return"string"==typeof a&&(this._options.message=a,this._setContent(a)),this},destroy:function(){this.$el.soDialog("destroy")}}),$.widget("SO.soNavigationBox",{_create:function(){this._widget=new SO.Widgets.NavigationBox(this.element,this.options)},_destroy:function(){this._widget.destroy()},setMessage:function(a){this._widget.setMessage(a)}});
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b,c=/^\s*|\s*$/g,d="$1"==="B".replace(/A(.)|B/,"$1"),e={majorVersion:"@@tinymce_major_version@@",minorVersion:"@@tinymce_minor_version@@",releaseDate:"@@tinymce_release_date@@",_init:function(){function b(a){return a.src&&/tiny_mce(|_gzip|_jquery|_prototype|_full)(_dev|_src)?.js/.test(a.src)?(/_(src|dev)\.js/g.test(a.src)&&(i.suffix="_src"),-1!=(g=a.src.indexOf("?"))&&(i.query=a.src.substring(g+1)),i.baseURL=a.src.substring(0,a.src.lastIndexOf("/")),f&&-1==i.baseURL.indexOf("://")&&0!==i.baseURL.indexOf("/")&&(i.baseURL=f+i.baseURL),i.baseURL):null}var c,d,e,f,g,h,i=this,j=document,k=navigator,l=k.userAgent;if(i.isOpera=a.opera&&opera.buildNumber,i.isWebKit=/WebKit/.test(l),i.isIE=!i.isWebKit&&!i.isOpera&&/MSIE/gi.test(l)&&/Explorer/gi.test(k.appName),i.isIE6=i.isIE&&/MSIE [56]/.test(l),i.isIE7=i.isIE&&/MSIE [7]/.test(l),i.isIE8=i.isIE&&/MSIE [8]/.test(l),i.isIE9=i.isIE&&/MSIE [9]/.test(l),i.isGecko=!i.isWebKit&&/Gecko/.test(l),i.isMac=-1!=l.indexOf("Mac"),i.isAir=/adobeair/i.test(l),i.isIDevice=/(iPad|iPhone)/.test(l),i.isIOS5=i.isIDevice&&l.match(/AppleWebKit\/(\d*)/)[1]>=534,a.tinyMCEPreInit)return i.suffix=tinyMCEPreInit.suffix,i.baseURL=tinyMCEPreInit.base,i.query=tinyMCEPreInit.query,void 0;for(i.suffix="",d=j.getElementsByTagName("base"),c=0;d.length>c;c++)h=d[c].href,h&&(/^https?:\/\/[^\/]+$/.test(h)&&(h+="/"),f=h?h.match(/.*\//)[0]:"");for(d=j.getElementsByTagName("script"),c=0;d.length>c;c++)if(b(d[c]))return;if(e=j.getElementsByTagName("head")[0])for(d=e.getElementsByTagName("script"),c=0;d.length>c;c++)if(b(d[c]))return},is:function(a,c){return c?"array"==c&&e.isArray(a)?!0:typeof a==c:a!==b},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},makeMap:function(a,b,c){var d;for(a=a||[],b=b||",","string"==typeof a&&(a=a.split(b)),c=c||{},d=a.length;d--;)c[a[d]]={};return c},each:function(a,c,d){var e,f;if(!a)return 0;if(d=d||a,a.length!==b){for(e=0,f=a.length;f>e;e++)if(c.call(d,a[e],e,a)===!1)return 0}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return 0;return 1},map:function(a,b){var c=[];return e.each(a,function(a){c.push(b(a))}),c},grep:function(a,b){var c=[];return e.each(a,function(a){(!b||b(a))&&c.push(a)}),c},inArray:function(a,b){var c,d;if(a)for(c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},extend:function(a,c){var d,e,f,g,h=arguments;for(d=1,e=h.length;e>d;d++){c=h[d];for(f in c)c.hasOwnProperty(f)&&(g=c[f],g!==b&&(a[f]=g))}return a},trim:function(a){return(a?""+a:"").replace(c,"")},create:function(a,b,c){var d,e,f,g,h,i=this,j=0;if(a=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(a),f=a[3].match(/(^|\.)(\w+)$/i)[2],e=i.createNS(a[3].replace(/\.\w+$/,""),c),!e[f]){if("static"==a[2])return e[f]=b,this.onCreate&&this.onCreate(a[2],a[3],e[f]),void 0;b[f]||(b[f]=function(){},j=1),e[f]=b[f],i.extend(e[f].prototype,b),a[5]&&(d=i.resolve(a[5]).prototype,g=a[5].match(/\.(\w+)$/i)[1],h=e[f],e[f]=j?function(){return d[g].apply(this,arguments)}:function(){return this.parent=d[g],h.apply(this,arguments)},e[f].prototype[f]=e[f],i.each(d,function(a,b){e[f].prototype[b]=d[b]}),i.each(b,function(a,b){d[b]?e[f].prototype[b]=function(){return this.parent=d[b],a.apply(this,arguments)}:b!=f&&(e[f].prototype[b]=a)})),i.each(b["static"],function(a,b){e[f][b]=a}),this.onCreate&&this.onCreate(a[2],a[3],e[f].prototype)}},walk:function(a,b,c,d){d=d||this,a&&(c&&(a=a[c]),e.each(a,function(a,f){return b.call(d,a,f,c)===!1?!1:(e.walk(a,b,c,d),void 0)}))},createNS:function(b,c){var d,e;for(c=c||a,b=b.split("."),d=0;b.length>d;d++)e=b[d],c[e]||(c[e]={}),c=c[e];return c},resolve:function(b,c){var d,e;for(c=c||a,b=b.split("."),d=0,e=b.length;e>d&&(c=c[b[d]],c);d++);return c},addUnload:function(b,c){function d(){function b(){c.detachEvent("onstop",b),e&&e(),c=0}var c=document;"interactive"==c.readyState&&(c&&c.attachEvent("onstop",b),a.setTimeout(function(){c&&c.detachEvent("onstop",b)},0))}var e,f=this;return e=function(){var b,c,g=f.unloads;if(g){for(c in g)b=g[c],b&&b.func&&b.func.call(b.scope,1);a.detachEvent?(a.detachEvent("onbeforeunload",d),a.detachEvent("onunload",e)):a.removeEventListener&&a.removeEventListener("unload",e,!1),f.unloads=b=g=w=e=0,a.CollectGarbage&&CollectGarbage()}},b={func:b,scope:c||this},f.unloads?f.unloads.push(b):(a.attachEvent?(a.attachEvent("onunload",e),a.attachEvent("onbeforeunload",d)):a.addEventListener&&a.addEventListener("unload",e,!1),f.unloads=[b]),b},removeUnload:function(a){var b=this.unloads,c=null;return e.each(b,function(d,e){return d&&d.func==a?(b.splice(e,1),c=a,!1):void 0}),c},explode:function(a,b){return!a||e.is(a,"array")?a:e.map(a.split(b||","),e.trim)},_addVer:function(a){var b;return this.query?(b=(-1==a.indexOf("?")?"?":"&")+this.query,-1==a.indexOf("#")?a+b:a.replace("#",b+"#")):a},_replace:function(a,c,e){return d?e.replace(a,function(){var a,d=c,e=arguments;for(a=0;e.length-2>a;a++)d=e[a]===b?d.replace(new RegExp("\\$"+a,"g"),""):d.replace(new RegExp("\\$"+a,"g"),e[a]);return d}):e.replace(a,c)}};e._init(),a.tinymce=a.tinyMCE=e})(window);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a,b){var c,d=(b.is,/^(href|src|style)$/i);if(!a&&window.console)return console.log("Load jQuery first!");b.$=a,b.adapter={patchEditor:function(b){function e(a,b){var c=this;return b&&c.removeAttr("data-mce-style"),h.css.apply(c,arguments)}function f(a,e){var f=this;return d.test(a)?e!==c?(f.each(function(c,d){b.dom.setAttrib(d,a,e)}),f):f.attr("data-mce-"+a):h.attr.apply(f,arguments)}function g(a){return a.css!==e&&(a.css=e,a.attr=f,a.tinymce=b,a.pushStack=function(){return g(h.pushStack.apply(this,arguments))}),a}var h=a.fn;b.$=function(c,d){var e=b.getDoc();return g(a(c||e,e||d))}}},b.extend=a.extend,b.extend(b,{map:a.map,grep:function(b,c){return a.grep(b,c||function(){return 1})},inArray:function(b,c){return a.inArray(c,b||[])}});var e={"tinymce.dom.DOMUtils":{select:function(b,c){var d=this;return a.find(b,d.get(c)||d.get(d.settings.root_element)||d.doc,[])},is:function(b,c){return a(this.get(b)).is(c)}}};b.onCreate=function(a,c,d){b.extend(d,e[c])}})(window.jQuery,tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.create("tinymce.util.Dispatcher",{scope:null,listeners:null,inDispatch:!1,Dispatcher:function(a){this.scope=a||this,this.listeners=[]},add:function(a,b){return this.listeners.push({cb:a,scope:b||this.scope}),a},addToTop:function(a,b){var c=this,d={cb:a,scope:b||c.scope};return c.inDispatch?c.listeners=[d].concat(c.listeners):c.listeners.unshift(d),a},remove:function(a){var b=this.listeners,c=null;return tinymce.each(b,function(d,e){return a==d.cb?(c=d,b.splice(e,1),!1):void 0}),c},dispatch:function(){var a,b,c,d=this,e=arguments,f=d.listeners;for(d.inDispatch=!0,b=0;f.length>b&&(c=f[b],a=c.cb.apply(c.scope,e.length>0?e:[c.scope]),a!==!1);b++);return d.inDispatch=!1,a}});
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(){var a=tinymce.each;tinymce.create("tinymce.util.URI",{URI:function(b,c){var d,e,f=this;return b=tinymce.trim(b),c=f.settings=c||{},/^([\w\-]+):([^\/]{2})/i.test(b)||/^\s*#/.test(b)?(f.source=b,void 0):(0===b.indexOf("/")&&0!==b.indexOf("//")&&(b=(c.base_uri?c.base_uri.protocol||"http":"http")+"://mce_host"+b),/^[\w\-]*:?\/\//.test(b)||(e=c.base_uri?c.base_uri.path:new tinymce.util.URI(location.href).directory,b=(c.base_uri&&c.base_uri.protocol||"http")+"://mce_host"+f.toAbsPath(e,b)),b=b.replace(/@@/g,"(mce_at)"),b=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(b),a(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(a,c){var d=b[c];d&&(d=d.replace(/\(mce_at\)/g,"@@")),f[a]=d}),d=c.base_uri,d&&(f.protocol||(f.protocol=d.protocol),f.userInfo||(f.userInfo=d.userInfo),f.port||"mce_host"!==f.host||(f.port=d.port),f.host&&"mce_host"!==f.host||(f.host=d.host),f.source=""),void 0)},setPath:function(a){var b=this;a=/^(.*?)\/?(\w+)?$/.exec(a),b.path=a[0],b.directory=a[1],b.file=a[2],b.source="",b.getURI()},toRelative:function(a){var b,c=this;if("./"===a)return a;if(a=new tinymce.util.URI(a,{base_uri:c}),"mce_host"!=a.host&&c.host!=a.host&&a.host||c.port!=a.port||c.protocol!=a.protocol)return a.getURI();var d=c.getURI(),e=a.getURI();return d==e||"/"==d.charAt(d.length-1)&&d.substr(0,d.length-1)==e?d:(b=c.toRelPath(c.path,a.path),a.query&&(b+="?"+a.query),a.anchor&&(b+="#"+a.anchor),b)},toAbsolute:function(a,b){return a=new tinymce.util.URI(a,{base_uri:this}),a.getURI(this.host==a.host&&this.protocol==a.protocol?b:0)},toRelPath:function(a,b){var c,d,e,f=0,g="";if(a=a.substring(0,a.lastIndexOf("/")),a=a.split("/"),c=b.split("/"),a.length>=c.length)for(d=0,e=a.length;e>d;d++)if(d>=c.length||a[d]!=c[d]){f=d+1;break}if(a.length<c.length)for(d=0,e=c.length;e>d;d++)if(d>=a.length||a[d]!=c[d]){f=d+1;break}if(1===f)return b;for(d=0,e=a.length-(f-1);e>d;d++)g+="../";for(d=f-1,e=c.length;e>d;d++)g+=d!=f-1?"/"+c[d]:c[d];return g},toAbsPath:function(b,c){var d,e,f,g=0,h=[];for(e=/\/$/.test(c)?"/":"",b=b.split("/"),c=c.split("/"),a(b,function(a){a&&h.push(a)}),b=h,d=c.length-1,h=[];d>=0;d--)0!==c[d].length&&"."!==c[d]&&(".."!==c[d]?g>0?g--:h.push(c[d]):g++);return d=b.length-g,f=0>=d?h.reverse().join("/"):b.slice(0,d).join("/")+"/"+h.reverse().join("/"),0!==f.indexOf("/")&&(f="/"+f),e&&f.lastIndexOf("/")!==f.length-1&&(f+=e),f},getURI:function(a){var b,c=this;return(!c.source||a)&&(b="",a||(c.protocol&&(b+=c.protocol+"://"),c.userInfo&&(b+=c.userInfo+"@"),c.host&&(b+=c.host),c.port&&(b+=":"+c.port)),c.path&&(b+=c.path),c.query&&(b+="?"+c.query),c.anchor&&(b+="#"+c.anchor),c.source=b),c.source}})})();
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(){var a=tinymce.each;tinymce.create("static tinymce.util.Cookie",{getHash:function(b){var c,d=this.get(b);return d&&a(d.split("&"),function(a){a=a.split("="),c=c||{},c[unescape(a[0])]=unescape(a[1])}),c},setHash:function(b,c,d,e,f,g){var h="";a(c,function(a,b){h+=(h?"&":"")+escape(b)+"="+escape(a)}),this.set(b,h,d,e,f,g)},get:function(a){var b,c,d=document.cookie,e=a+"=";if(d){if(c=d.indexOf("; "+e),-1==c){if(c=d.indexOf(e),0!==c)return null}else c+=2;return b=d.indexOf(";",c),-1==b&&(b=d.length),unescape(d.substring(c+e.length,b))}},set:function(a,b,c,d,e,f){document.cookie=a+"="+escape(b)+(c?"; expires="+c.toGMTString():"")+(d?"; path="+escape(d):"")+(e?"; domain="+e:"")+(f?"; secure":"")},remove:function(a,b,c){var d=new Date;d.setTime(d.getTime()-1e3),this.set(a,"",d,b,c)}})})();
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(){function serialize(a,b){var c,d,e,f;if(b=b||'"',null==a)return"null";if(e=typeof a,"string"==e)return d="\bb	t\nn\ff\rr\"\"''\\\\",b+a.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(a,e){return'"'===b&&"'"===a?a:(c=d.indexOf(e),c+1?"\\"+d.charAt(c+1):(a=e.charCodeAt().toString(16),"\\u"+"0000".substring(a.length)+a))})+b;if("object"==e){if(a.hasOwnProperty&&"[object Array]"===Object.prototype.toString.call(a)){for(c=0,d="[";a.length>c;c++)d+=(c>0?",":"")+serialize(a[c],b);return d+"]"}d="{";for(f in a)a.hasOwnProperty(f)&&(d+="function"!=typeof a[f]?(d.length>1?","+b:b)+f+b+":"+serialize(a[f],b):"");return d+"}"}return""+a}tinymce.util.JSON={serialize:serialize,parse:function(s){try{return eval("("+s+")")}catch(ex){}}}})();
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.create("static tinymce.util.JSONP",{callbacks:{},count:0,send:function(a){var b=this,c=tinymce.DOM,d=void 0!==a.count?a.count:b.count,e="tinymce_jsonp_"+d;b.callbacks[d]=function(f){c.remove(e),delete b.callbacks[d],a.callback(f)},c.add(c.doc.body,"script",{id:e,src:a.url,type:"text/javascript"}),b.count++}});
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.create("static tinymce.util.XHR",{send:function(a){function b(){!a.async||4==d.readyState||g++>1e4?(a.success&&1e4>g&&200==d.status?a.success.call(a.success_scope,""+d.responseText,d,a):a.error&&a.error.call(a.error_scope,g>1e4?"TIMED_OUT":"GENERAL",d,a),d=null):f.setTimeout(b,10)}function c(a){d=0;try{d=new ActiveXObject(a)}catch(b){}return d}var d,e,f=window,g=0;if(a.scope=a.scope||this,a.success_scope=a.success_scope||a.scope,a.error_scope=a.error_scope||a.scope,a.async=a.async===!1?!1:!0,a.data=a.data||"",d=f.XMLHttpRequest?new XMLHttpRequest:c("Microsoft.XMLHTTP")||c("Msxml2.XMLHTTP")){if(d.overrideMimeType&&d.overrideMimeType(a.content_type),d.open(a.type||(a.data?"POST":"GET"),a.url,a.async),a.content_type&&d.setRequestHeader("Content-Type",a.content_type),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.send(a.data),!a.async)return b();e=f.setTimeout(b,10)}}});
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(){var a=tinymce.extend,b=tinymce.util.JSON,c=tinymce.util.XHR;tinymce.create("tinymce.util.JSONRequest",{JSONRequest:function(b){this.settings=a({},b),this.count=0},send:function(d){var e=d.error,f=d.success;d=a(this.settings,d),d.success=function(a,c){a=b.parse(a),"undefined"==typeof a&&(a={error:"JSON Parse error."}),a.error?e.call(d.error_scope||d.scope,a.error,c):f.call(d.success_scope||d.scope,a.result)},d.error=function(a,b){e&&e.call(d.error_scope||d.scope,a,b)},d.data=b.serialize({id:d.id||"c"+this.count++,method:d.method,params:d.params}),d.content_type="application/json",c.send(d)},"static":{sendRPC:function(a){return(new tinymce.util.JSONRequest).send(a)}}})})();
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){a.VK={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,modifierPressed:function(a){return a.shiftKey||a.ctrlKey||a.altKey},metaKeyPressed:function(b){return a.isMac?b.metaKey:b.ctrlKey&&!b.altKey}}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.util.Quirks=function(a){function b(b,c){try{a.getDoc().execCommand(b,!1,c)}catch(d){}}function c(){var b=a.getDoc().documentMode;return b?b:6}function d(a){return a.isDefaultPrevented()}function e(){function b(b){var c,d,e,f;if(c=F.getRng(),d=E.getParent(c.startContainer,E.isBlock),b&&(d=E.getNext(d,E.isBlock)),d){for(e=d.firstChild;e&&3==e.nodeType&&0===e.nodeValue.length;)e=e.nextSibling;e&&"SPAN"===e.nodeName&&(f=e.cloneNode(!1))}J(E.select("span",d),function(a){a.setAttribute("data-mce-mark","1")}),a.getDoc().execCommand(b?"ForwardDelete":"Delete",!1,null),d=E.getParent(c.startContainer,E.isBlock),J(E.select("span",d),function(a){var b=F.getBookmark();f?E.replace(f.cloneNode(!1),a,!0):a.getAttribute("data-mce-mark")?a.removeAttribute("data-mce-mark"):E.remove(a,!0),F.moveToBookmark(b)})}a.onKeyDown.add(function(a,c){var e;e=c.keyCode==D,d(c)||!e&&c.keyCode!=C||B.modifierPressed(c)||(c.preventDefault(),b(e))}),a.addCommand("Delete",function(){b()})}function f(){function b(a){var b=E.create("body"),c=a.cloneContents();return b.appendChild(c),F.serializer.serialize(b,{format:"html"})}function c(c){var d=b(c),e=E.createRng();e.selectNode(a.getBody());var f=b(e);return d===f}a.onKeyDown.add(function(a,b){var e,f=b.keyCode;if(!d(b)&&(f==D||f==C)){if(e=a.selection.isCollapsed(),e&&!E.isEmpty(a.getBody()))return;if(tinymce.isIE&&!e)return;if(!e&&!c(a.selection.getRng()))return;a.setContent(""),a.selection.setCursorLocation(a.getBody(),0),a.nodeChanged()}})}function g(){a.onKeyDown.add(function(a,b){!d(b)&&65==b.keyCode&&B.metaKeyPressed(b)&&(b.preventDefault(),a.execCommand("SelectAll"))})}function h(){a.settings.content_editable||(E.bind(a.getDoc(),"focusin",function(){F.setRng(F.getRng())}),E.bind(a.getDoc(),"mousedown",function(b){b.target==a.getDoc().documentElement&&(a.getWin().focus(),F.setRng(F.getRng()))}))}function i(){a.onKeyDown.add(function(a,b){if(!d(b)&&b.keyCode===C&&F.isCollapsed()&&0===F.getRng(!0).startOffset){var c=F.getNode(),e=c.previousSibling;e&&e.nodeName&&"hr"===e.nodeName.toLowerCase()&&(E.remove(e),tinymce.dom.Event.cancel(b))}})}function j(){Range.prototype.getClientRects||a.onMouseDown.add(function(a,b){if(!d(b)&&"HTML"===b.target.nodeName){var c=a.getBody();c.blur(),setTimeout(function(){c.focus()},0)}})}function k(){a.onClick.add(function(a,b){b=b.target,/^(IMG|HR)$/.test(b.nodeName)&&F.getSel().setBaseAndExtent(b,0,b,1),"A"==b.nodeName&&E.hasClass(b,"mceItemAnchor")&&F.select(b),a.nodeChanged()})}function l(){function b(){var b=E.getAttribs(F.getStart().cloneNode(!1));return function(){var c=F.getStart();c!==a.getBody()&&(E.setAttrib(c,"style",null),J(b,function(a){c.setAttributeNode(a.cloneNode(!0))}))}}function c(){return!F.isCollapsed()&&E.getParent(F.getStart(),E.isBlock)!=E.getParent(F.getEnd(),E.isBlock)}function e(a,b){return b.preventDefault(),!1}a.onKeyPress.add(function(a,e){var f;return d(e)||8!=e.keyCode&&46!=e.keyCode||!c()?void 0:(f=b(),a.getDoc().execCommand("delete",!1,null),f(),e.preventDefault(),!1)}),E.bind(a.getDoc(),"cut",function(f){var g;!d(f)&&c()&&(g=b(),a.onKeyUp.addToTop(e),setTimeout(function(){g(),a.onKeyUp.remove(e)},0))})}function m(){var b,c;E.bind(a.getDoc(),"selectionchange",function(){c&&(clearTimeout(c),c=0),c=window.setTimeout(function(){var c=F.getRng();b&&tinymce.dom.RangeUtils.compareRanges(c,b)||(a.nodeChanged(),b=c)},50)})}function n(){document.body.setAttribute("role","application")}function o(){a.onKeyDown.add(function(a,b){if(!d(b)&&b.keyCode===C&&F.isCollapsed()&&0===F.getRng(!0).startOffset){var c=F.getNode().previousSibling;if(c&&c.nodeName&&"table"===c.nodeName.toLowerCase())return tinymce.dom.Event.cancel(b)}})}function p(){c()>7||(b("RespectVisibilityInDesign",!0),a.contentStyles.push(".mceHideBrInPre pre br {display: none}"),E.addClass(a.getBody(),"mceHideBrInPre"),H.addNodeFilter("pre",function(a){for(var b,c,d,e,f=a.length;f--;)for(b=a[f].getAll("br"),c=b.length;c--;)d=b[c],e=d.prev,e&&3===e.type&&"\n"!=e.value.charAt(e.value-1)?e.value+="\n":d.parent.insert(new tinymce.html.Node("#text",3),d,!0).value="\n"}),I.addNodeFilter("pre",function(a){for(var b,c,d,e,f=a.length;f--;)for(b=a[f].getAll("br"),c=b.length;c--;)d=b[c],e=d.prev,e&&3==e.type&&(e.value=e.value.replace(/\r?\n$/,""))}))}function q(){E.bind(a.getBody(),"mouseup",function(){var a,b=F.getNode();"IMG"==b.nodeName&&((a=E.getStyle(b,"width"))&&(E.setAttrib(b,"width",a.replace(/[^0-9%]+/g,"")),E.setStyle(b,"width","")),(a=E.getStyle(b,"height"))&&(E.setAttrib(b,"height",a.replace(/[^0-9%]+/g,"")),E.setStyle(b,"height","")))})}function r(){a.onKeyDown.add(function(a,b){var c,e,f,g,h,i,j;c=b.keyCode==D,d(b)||!c&&b.keyCode!=C||B.modifierPressed(b)||(e=F.getRng(),f=e.startContainer,g=e.startOffset,j=e.collapsed,3==f.nodeType&&f.nodeValue.length>0&&(0===g&&!j||j&&g===(c?0:1))&&(nonEmptyElements=a.schema.getNonEmptyElements(),b.preventDefault(),h=E.create("br",{id:"__tmp"}),f.parentNode.insertBefore(h,f),a.getDoc().execCommand(c?"ForwardDelete":"Delete",!1,null),f=F.getRng().startContainer,i=f.previousSibling,i&&1==i.nodeType&&!E.isBlock(i)&&E.isEmpty(i)&&!nonEmptyElements[i.nodeName.toLowerCase()]&&E.remove(i),E.remove("__tmp")))})}function s(){a.onKeyDown.add(function(a,b){var c,e,f,g,h;if(!d(b)&&b.keyCode==B.BACKSPACE&&(c=F.getRng(),e=c.startContainer,f=c.startOffset,g=E.getRoot(),h=e,c.collapsed&&0===f)){for(;h&&h.parentNode&&h.parentNode.firstChild==h&&h.parentNode!=g;)h=h.parentNode;"BLOCKQUOTE"===h.tagName&&(a.formatter.toggle("blockquote",null,h),c=E.createRng(),c.setStart(e,0),c.setEnd(e,0),F.setRng(c))}})}function t(){function c(){a._refreshContentEditable(),b("StyleWithCSS",!1),b("enableInlineTableEditing",!1),G.object_resizing||b("enableObjectResizing",!1)}G.readonly||(a.onBeforeExecCommand.add(c),a.onMouseDown.add(c))}function u(){function b(){J(E.select("a"),function(a){var b=a.parentNode,c=E.getRoot();if(b.lastChild===a){for(;b&&!E.isBlock(b);){if(b.parentNode.lastChild!==b||b===c)return;b=b.parentNode}E.add(b,"br",{"data-mce-bogus":1})}})}a.onExecCommand.add(function(a,c){"CreateLink"===c&&b(a)}),a.onSetContent.add(F.onSetContent.add(b))}function v(){G.forced_root_block&&a.onInit.add(function(){b("DefaultParagraphSeparator",G.forced_root_block)})}function w(){function b(b,c){b&&c.initial||a.execCommand("mceRepaint")}a.onUndo.add(b),a.onRedo.add(b),a.onSetContent.add(b)}function x(){a.onKeyDown.add(function(a,b){var c;d(b)||b.keyCode!=C||(c=a.getDoc().selection.createRange(),c&&c.item&&(b.preventDefault(),a.undoManager.beforeChange(),E.remove(c.item(0)),a.undoManager.add()))})}function y(){var b;c()>=10&&(b="",J("p div h1 h2 h3 h4 h5 h6".split(" "),function(a,c){b+=(c>0?",":"")+a+":empty"}),a.contentStyles.push(b+"{padding-right: 1px !important}"))}function z(){function c(a){var b,c;b=a.screenX-m,c=a.screenY-n,s=b*l[2]+o,t=c*l[3]+p,s=5>s?5:s,t=5>t?5:t,(B.modifierPressed(a)||"IMG"==j.nodeName&&0!==l[2]*l[3])&&(s=Math.round(t/q),t=Math.round(s*q)),E.setStyles(k,{width:s,height:t}),0>l[2]&&s>=k.clientWidth&&E.setStyle(k,"left",h+(o-s)),0>l[3]&&t>=k.clientHeight&&E.setStyle(k,"top",i+(p-t))}function d(){function b(b,c){c&&(j.style[b]||!a.schema.isValid(j.nodeName.toLowerCase(),b)?E.setStyle(j,b,c):E.setAttrib(j,b,c))}b("width",s),b("height",t),E.unbind(v,"mousemove",c),E.unbind(v,"mouseup",d),u!=v&&(E.unbind(u,"mousemove",c),E.unbind(u,"mouseup",d)),E.remove(k),e(j)}function e(a){var b,e,g;f(),b=E.getPos(a),h=b.x,i=b.y,e=a.offsetWidth,g=a.offsetHeight,j!=a&&(j=a,s=t=0),J(r,function(a,b){var f;f=E.get("mceResizeHandle"+b),f?E.show(f):(f=E.add(v.documentElement,"div",{id:"mceResizeHandle"+b,"class":"mceResizeHandle",style:"cursor:"+b+"-resize; margin:0; padding:0"}),E.bind(f,"mousedown",function(b){b.preventDefault(),d(),m=b.screenX,n=b.screenY,o=j.clientWidth,p=j.clientHeight,q=p/o,l=a,k=j.cloneNode(!0),E.addClass(k,"mceClonedResizable"),E.setStyles(k,{left:h,top:i,margin:0}),v.documentElement.appendChild(k),E.bind(v,"mousemove",c),E.bind(v,"mouseup",d),u!=v&&(E.bind(u,"mousemove",c),E.bind(u,"mouseup",d))})),E.setStyles(f,{left:e*a[0]+h-f.offsetWidth/2,top:g*a[1]+i-f.offsetHeight/2})}),tinymce.isOpera||"IMG"!=j.nodeName||j.setAttribute("data-mce-selected","1")}function f(){j&&j.removeAttribute("data-mce-selected");for(var a in r)E.hide("mceResizeHandle"+a)}function g(){var a=E.getParent(F.getNode(),"table,img");J(E.select("img[data-mce-selected]"),function(a){a.removeAttribute("data-mce-selected")}),a?e(a):f()}var h,i,j,k,l,m,n,o,p,q,r,s,t,u=document,v=a.getDoc();G.object_resizing&&G.webkit_fake_resize!==!1&&(b("enableObjectResizing",!1),r={n:[.5,0,0,-1],e:[1,.5,1,0],s:[.5,1,0,1],w:[0,.5,-1,0],nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]},a.contentStyles.push(".mceResizeHandle {position: absolute;border: 1px solid black;background: #FFF;width: 5px;height: 5px;z-index: 10000}.mceResizeHandle:hover {background: #000}img[data-mce-selected] {outline: 1px solid black}img.mceClonedResizable, table.mceClonedResizable {position: absolute;outline: 1px dashed black;opacity: .5;z-index: 10000}"),a.onNodeChange.add(g),E.bind(v,"selectionchange",g),a.serializer.addAttributeFilter("data-mce-selected",function(a,b){for(var c=a.length;c--;)a[c].attr(b,null)}))}function A(){9>c()&&(H.addNodeFilter("noscript",function(a){for(var b,c,d=a.length;d--;)b=a[d],c=b.firstChild,c&&b.attr("data-mce-innertext",c.value)}),I.addNodeFilter("noscript",function(a){for(var b,c,d,e=a.length;e--;)b=a[e],c=a[e].firstChild,c?c.value=tinymce.html.Entities.decode(c.value):(d=b.attributes.map["data-mce-innertext"],d&&(b.attr("data-mce-innertext",null),c=new tinymce.html.Node("#text",3),c.value=d,c.raw=!0,b.append(c)))}))}var B=tinymce.VK,C=B.BACKSPACE,D=B.DELETE,E=a.dom,F=a.selection,G=a.settings,H=a.parser,I=a.serializer,J=tinymce.each;o(),s(),f(),tinymce.isWebKit&&(r(),e(),h(),k(),v(),tinymce.isIDevice?m():(z(),g())),tinymce.isIE&&(i(),n(),p(),q(),x(),y(),A()),tinymce.isGecko&&(i(),j(),l(),t(),u(),w()),tinymce.isOpera&&z()};
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){function b(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.textContent||b.innerText||a}function c(a,b){var c,d,f,g={};if(a){for(a=a.split(","),b=b||10,c=0;a.length>c;c+=2)d=String.fromCharCode(parseInt(a[c],b)),e[d]||(f="&"+a[c+1]+";",g[d]=f,g[f]=d);return g}}var d,e,f,g=/[&<>\"\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,h=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,i=/[<>&\"\']/g,j=/&(#x|#)?([\w]+);/g,k={128:"\u20ac",130:"\u201a",131:"\u0192",132:"\u201e",133:"\u2026",134:"\u2020",135:"\u2021",136:"\u02c6",137:"\u2030",138:"\u0160",139:"\u2039",140:"\u0152",142:"\u017d",145:"\u2018",146:"\u2019",147:"\u201c",148:"\u201d",149:"\u2022",150:"\u2013",151:"\u2014",152:"\u02dc",153:"\u2122",154:"\u0161",155:"\u203a",156:"\u0153",158:"\u017e",159:"\u0178"};e={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;"},f={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},d=c("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),a.html=a.html||{},a.html.Entities={encodeRaw:function(a,b){return a.replace(b?g:h,function(a){return e[a]||a})},encodeAllRaw:function(a){return(""+a).replace(i,function(a){return e[a]||a})},encodeNumeric:function(a,b){return a.replace(b?g:h,function(a){return a.length>1?"&#"+(1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320)+65536)+";":e[a]||"&#"+a.charCodeAt(0)+";"})},encodeNamed:function(a,b,c){return c=c||d,a.replace(b?g:h,function(a){return e[a]||c[a]||a})},getEncodeFunc:function(b,f){function i(a,b){return a.replace(b?g:h,function(a){return e[a]||f[a]||"&#"+a.charCodeAt(0)+";"||a})}function j(a,b){return k.encodeNamed(a,b,f)}var k=a.html.Entities;return f=c(f)||d,b=a.makeMap(b.replace(/\+/g,",")),b.named&&b.numeric?i:b.named?f?j:k.encodeNamed:b.numeric?k.encodeNumeric:k.encodeRaw},decode:function(a){return a.replace(j,function(a,c,e){return c?(e=parseInt(e,2===c.length?16:10),e>65535?(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e))):k[e]||String.fromCharCode(e)):f[a]||d[a]||b(a)})}}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.html.Styles=function(a,b){function c(a,b,c,d){function e(a){return a=parseInt(a).toString(16),a.length>1?a:"0"+a}return"#"+e(b)+e(c)+e(d)}var d,e,f,g=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,h=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,i=/\s*([^:]+):\s*([^;]+);?/g,j=/\s+$/,k={};for(a=a||{},f="\\\" \\' \\; \\: ; : \ufeff".split(" "),e=0;f.length>e;e++)k[f[e]]="\ufeff"+e,k["\ufeff"+e]=f[e];return{toHex:function(a){return a.replace(g,c)},parse:function(b){function d(a,b){var c,d,e,f;c=s[a+"-top"+b],c&&(d=s[a+"-right"+b],c==d&&(e=s[a+"-bottom"+b],d==e&&(f=s[a+"-left"+b],e==f&&(s[a+b]=f,delete s[a+"-top"+b],delete s[a+"-right"+b],delete s[a+"-bottom"+b],delete s[a+"-left"+b]))))}function e(a){var b,c=s[a];if(c&&!(0>c.indexOf(" "))){for(c=c.split(" "),b=c.length;b--;)if(c[b]!==c[0])return!1;return s[a]=c[0],!0}}function f(a,b,c,d){e(b)&&e(c)&&e(d)&&(s[a]=s[b]+" "+s[c]+" "+s[d],delete s[b],delete s[c],delete s[d])}function l(a){return r=!0,k[a]}function m(a,b){return r&&(a=a.replace(/\uFEFF[0-9]/g,function(a){return k[a]})),b||(a=a.replace(/\\([\'\";:])/g,"$1")),a}function n(a,b,c,d,e,f){return(e=e||f)?(e=m(e),"'"+e.replace(/\'/g,"\\'")+"'"):(b=m(b||c||d),t&&(b=t.call(u,b,"style")),"url('"+b.replace(/\'/g,"\\'")+"')")}var o,p,q,r,s={},t=a.url_converter,u=a.url_converter_scope||this;if(b){for(b=b.replace(/\\[\"\';:\uFEFF]/g,l).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(a){return a.replace(/[;:]/g,l)});o=i.exec(b);)p=o[1].replace(j,"").toLowerCase(),q=o[2].replace(j,""),p&&q.length>0&&("font-weight"===p&&"700"===q?q="bold":("color"===p||"background-color"===p)&&(q=q.toLowerCase()),q=q.replace(g,c),q=q.replace(h,n),s[p]=r?m(q,!0):q),i.lastIndex=o.index+o[0].length;d("border",""),d("border","-width"),d("border","-color"),d("border","-style"),d("padding",""),d("margin",""),f("border","border-width","border-style","border-color"),"medium none"===s.border&&delete s.border}return s},serialize:function(a,c){function e(c){var e,f,g,i;if(e=b.styles[c])for(f=0,g=e.length;g>f;f++)c=e[f],i=a[c],i!==d&&i.length>0&&(h+=(h.length>0?" ":"")+c+": "+i+";")}var f,g,h="";if(c&&b&&b.styles)e("*"),e(c);else for(f in a)g=a[f],g!==d&&g.length>0&&(h+=(h.length>0?" ":"")+f+": "+g+";");return h}}};
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){function b(a,b){return a.split(b||",")}function c(a,c){function d(b){return b.replace(/[A-Z]+/g,function(b){return d(a[b])})}var e,f={};for(e in a)a.hasOwnProperty(e)&&(a[e]=d(a[e]));return d(c).replace(/#/g,"#text").replace(/(\w+)\[([^\]]+)\]\[([^\]]*)\]/g,function(a,c,d,e){d=b(d,"|"),f[c]={attributes:g(d),attributesOrder:d,children:g(e,"|",{"#comment":{}})}}),f}function d(){var a=f.html5;return a||(a=f.html5=c({A:"id|accesskey|class|dir|draggable|item|hidden|itemprop|role|spellcheck|style|subject|title|onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup",B:"#|a|abbr|area|audio|b|bdo|br|button|canvas|cite|code|command|datalist|del|dfn|em|embed|i|iframe|img|input|ins|kbd|keygen|label|link|map|mark|meta|meter|noscript|object|output|progress|q|ruby|samp|script|select|small|span|strong|sub|sup|svg|textarea|time|var|video|wbr",C:"#|a|abbr|area|address|article|aside|audio|b|bdo|blockquote|br|button|canvas|cite|code|command|datalist|del|details|dfn|dialog|div|dl|em|embed|fieldset|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|i|iframe|img|input|ins|kbd|keygen|label|link|map|mark|menu|meta|meter|nav|noscript|ol|object|output|p|pre|progress|q|ruby|samp|script|section|select|small|span|strong|style|sub|sup|svg|table|textarea|time|ul|var|video"},"html[A|manifest][body|head]head[A][base|command|link|meta|noscript|script|style|title]title[A][#]base[A|href|target][]link[A|href|rel|media|type|sizes][]meta[A|http-equiv|name|content|charset][]style[A|type|media|scoped][#]script[A|charset|type|src|defer|async][#]noscript[A][C]body[A][C]section[A][C]nav[A][C]article[A][C]aside[A][C]h1[A][B]h2[A][B]h3[A][B]h4[A][B]h5[A][B]h6[A][B]hgroup[A][h1|h2|h3|h4|h5|h6]header[A][C]footer[A][C]address[A][C]p[A][B]br[A][]pre[A][B]dialog[A][dd|dt]blockquote[A|cite][C]ol[A|start|reversed][li]ul[A][li]li[A|value][C]dl[A][dd|dt]dt[A][B]dd[A][C]a[A|href|target|ping|rel|media|type][B]em[A][B]strong[A][B]small[A][B]cite[A][B]q[A|cite][B]dfn[A][B]abbr[A][B]code[A][B]var[A][B]samp[A][B]kbd[A][B]sub[A][B]sup[A][B]i[A][B]b[A][B]mark[A][B]progress[A|value|max][B]meter[A|value|min|max|low|high|optimum][B]time[A|datetime][B]ruby[A][B|rt|rp]rt[A][B]rp[A][B]bdo[A][B]span[A][B]ins[A|cite|datetime][B]del[A|cite|datetime][B]figure[A][C|legend|figcaption]figcaption[A][C]img[A|alt|src|height|width|usemap|ismap][]iframe[A|name|src|height|width|sandbox|seamless][]embed[A|src|height|width|type][]object[A|data|type|height|width|usemap|name|form|classid][param]param[A|name|value][]details[A|open][C|legend]command[A|type|label|icon|disabled|checked|radiogroup][]menu[A|type|label][C|li]legend[A][C|B]div[A][C]source[A|src|type|media][]audio[A|src|autobuffer|autoplay|loop|controls][source]video[A|src|autobuffer|autoplay|loop|controls|width|height|poster][source]hr[A][]form[A|accept-charset|action|autocomplete|enctype|method|name|novalidate|target][C]fieldset[A|disabled|form|name][C|legend]label[A|form|for][B]input[A|type|accept|alt|autocomplete|autofocus|checked|disabled|form|formaction|formenctype|formmethod|formnovalidate|formtarget|height|list|max|maxlength|min|multiple|pattern|placeholder|readonly|required|size|src|step|width|files|value|name][]button[A|autofocus|disabled|form|formaction|formenctype|formmethod|formnovalidate|formtarget|name|value|type][B]select[A|autofocus|disabled|form|multiple|name|size][option|optgroup]datalist[A][B|option]optgroup[A|disabled|label][option]option[A|disabled|selected|label|value][]textarea[A|autofocus|disabled|form|maxlength|name|placeholder|readonly|required|rows|cols|wrap][]keygen[A|autofocus|challenge|disabled|form|keytype|name][]output[A|for|form|name][B]canvas[A|width|height][]map[A|name][B|C]area[A|shape|coords|href|alt|target|media|rel|ping|type][]mathml[A][]svg[A][]table[A|border][caption|colgroup|thead|tfoot|tbody|tr]caption[A][C]colgroup[A|span][col]col[A|span][]thead[A][tr]tfoot[A][tr]tbody[A][tr]tr[A][th|td]th[A|headers|rowspan|colspan|scope][B]td[A|headers|rowspan|colspan][C]wbr[A][]")),a}function e(){var a=f.html4;return a||(a=f.html4=c({Z:"H|K|N|O|P",Y:"X|form|R|Q",ZG:"E|span|width|align|char|charoff|valign",X:"p|T|div|U|W|isindex|fieldset|table",ZF:"E|align|char|charoff|valign",W:"pre|hr|blockquote|address|center|noframes",ZE:"abbr|axis|headers|scope|rowspan|colspan|align|char|charoff|valign|nowrap|bgcolor|width|height",ZD:"[E][S]",U:"ul|ol|dl|menu|dir",ZC:"p|Y|div|U|W|table|br|span|bdo|object|applet|img|map|K|N|Q",T:"h1|h2|h3|h4|h5|h6",ZB:"X|S|Q",S:"R|P",ZA:"a|G|J|M|O|P",R:"a|H|K|N|O",Q:"noscript|P",P:"ins|del|script",O:"input|select|textarea|label|button",N:"M|L",M:"em|strong|dfn|code|q|samp|kbd|var|cite|abbr|acronym",L:"sub|sup",K:"J|I",J:"tt|i|b|u|s|strike",I:"big|small|font|basefont",H:"G|F",G:"br|span|bdo",F:"object|applet|img|map|iframe",E:"A|B|C",D:"accesskey|tabindex|onfocus|onblur",C:"onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup",B:"lang|xml:lang|dir",A:"id|class|style|title"},"script[id|charset|type|language|src|defer|xml:space][]style[B|id|type|media|title|xml:space][]object[E|declare|classid|codebase|data|type|codetype|archive|standby|width|height|usemap|name|tabindex|align|border|hspace|vspace][#|param|Y]param[id|name|value|valuetype|type][]p[E|align][#|S]a[E|D|charset|type|name|href|hreflang|rel|rev|shape|coords|target][#|Z]br[A|clear][]span[E][#|S]bdo[A|C|B][#|S]applet[A|codebase|archive|code|object|alt|name|width|height|align|hspace|vspace][#|param|Y]h1[E|align][#|S]img[E|src|alt|name|longdesc|width|height|usemap|ismap|align|border|hspace|vspace][]map[B|C|A|name][X|form|Q|area]h2[E|align][#|S]iframe[A|longdesc|name|src|frameborder|marginwidth|marginheight|scrolling|align|width|height][#|Y]h3[E|align][#|S]tt[E][#|S]i[E][#|S]b[E][#|S]u[E][#|S]s[E][#|S]strike[E][#|S]big[E][#|S]small[E][#|S]font[A|B|size|color|face][#|S]basefont[id|size|color|face][]em[E][#|S]strong[E][#|S]dfn[E][#|S]code[E][#|S]q[E|cite][#|S]samp[E][#|S]kbd[E][#|S]var[E][#|S]cite[E][#|S]abbr[E][#|S]acronym[E][#|S]sub[E][#|S]sup[E][#|S]input[E|D|type|name|value|checked|disabled|readonly|size|maxlength|src|alt|usemap|onselect|onchange|accept|align][]select[E|name|size|multiple|disabled|tabindex|onfocus|onblur|onchange][optgroup|option]optgroup[E|disabled|label][option]option[E|selected|disabled|label|value][]textarea[E|D|name|rows|cols|disabled|readonly|onselect|onchange][]label[E|for|accesskey|onfocus|onblur][#|S]button[E|D|name|value|type|disabled][#|p|T|div|U|W|table|G|object|applet|img|map|K|N|Q]h4[E|align][#|S]ins[E|cite|datetime][#|Y]h5[E|align][#|S]del[E|cite|datetime][#|Y]h6[E|align][#|S]div[E|align][#|Y]ul[E|type|compact][li]li[E|type|value][#|Y]ol[E|type|compact|start][li]dl[E|compact][dt|dd]dt[E][#|S]dd[E][#|Y]menu[E|compact][li]dir[E|compact][li]pre[E|width|xml:space][#|ZA]hr[E|align|noshade|size|width][]blockquote[E|cite][#|Y]address[E][#|S|p]center[E][#|Y]noframes[E][#|Y]isindex[A|B|prompt][]fieldset[E][#|legend|Y]legend[E|accesskey|align][#|S]table[E|summary|width|border|frame|rules|cellspacing|cellpadding|align|bgcolor][caption|col|colgroup|thead|tfoot|tbody|tr]caption[E|align][#|S]col[ZG][]colgroup[ZG][col]thead[ZF][tr]tr[ZF|bgcolor][th|td]th[E|ZE][#|Y]form[E|action|method|name|enctype|onsubmit|onreset|accept|accept-charset|target][#|X|R|Q]noscript[E][#|Y]td[E|ZE][#|Y]tfoot[ZF][tr]tbody[ZF][tr]area[E|D|shape|coords|href|nohref|alt|target][]base[id|href|target][]body[E|onload|onunload|background|bgcolor|text|link|vlink|alink][#|Y]")),a}var f={},g=a.makeMap,h=a.each;a.html.Schema=function(c){function i(b,d,e){var h=c[b];return h?h=g(h,",",g(h.toUpperCase()," ")):(h=f[b],h||(h=g(d," ",g(d.toUpperCase()," ")),h=a.extend(h,e),f[b]=h)),h}function j(a){return new RegExp("^"+a.replace(/([?+*])/g,".$1")+"$")}function k(c){var d,e,f,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,z=/^([#+\-])?([^\[\/]+)(?:\/([^\[]+))?(?:\[([^\]]+)\])?$/,B=/^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/,C=/[*?+]/;if(c)for(c=b(c),y["@"]&&(u=y["@"].attributes,v=y["@"].attributesOrder),d=0,e=c.length;e>d;d++)if(i=z.exec(c[d])){if(s=i[1],n=i[2],t=i[3],m=i[4],q={},r=[],k={attributes:q,attributesOrder:r},"#"===s&&(k.paddEmpty=!0),"-"===s&&(k.removeEmpty=!0),u){for(w in u)q[w]=u[w];r.push.apply(r,v)}if(m)for(m=b(m,"|"),f=0,h=m.length;h>f;f++)if(i=B.exec(m[f])){if(l={},p=i[1],o=i[2].replace(/::/g,":"),s=i[3],x=i[4],"!"===p&&(k.attributesRequired=k.attributesRequired||[],k.attributesRequired.push(o),l.required=!0),"-"===p){delete q[o],r.splice(a.inArray(r,o),1);continue}s&&("="===s&&(k.attributesDefault=k.attributesDefault||[],k.attributesDefault.push({name:o,value:x}),l.defaultValue=x),":"===s&&(k.attributesForced=k.attributesForced||[],k.attributesForced.push({name:o,value:x}),l.forcedValue=x),"<"===s&&(l.validValues=g(x,"?"))),C.test(o)?(k.attributePatterns=k.attributePatterns||[],l.pattern=j(o),k.attributePatterns.push(l)):(q[o]||r.push(o),q[o]=l)}u||"@"!=n||(u=q,v=r),t&&(k.outputName=n,y[t]=k),C.test(n)?(k.pattern=j(n),A.push(k)):y[n]=k}}function l(a){y={},A=[],k(a),h(q,function(a,b){z[b]=a.children})}function m(a){var c=/^(~)?(.+)$/;a&&h(b(a),function(a){var b=c.exec(a),d="~"===b[1],e=d?"span":"div",f=b[2];z[f]=z[e],B[f]=e,d||(v[f.toUpperCase()]={},v[f]={}),y[f]||(y[f]=y[e]),h(z,function(a){a[e]&&(a[f]=a[e])})})}function n(a){var c=/^([+\-]?)(\w+)\[([^\]]+)\]$/;a&&h(b(a),function(a){var d,e,f=c.exec(a);f&&(e=f[1],d=e?z[f[2]]:z[f[2]]={"#comment":{}},d=z[f[2]],h(b(f[3],"|"),function(a){"-"===e?delete d[a]:d[a]={}}))})}function o(a){var b,c=y[a];if(c)return c;for(b=A.length;b--;)if(c=A[b],c.pattern.test(a))return c}var p,q,r,s,t,u,v,w,x=this,y={},z={},A=[],B={};c=c||{},q="html5"==c.schema?d():e(),c.verify_html===!1&&(c.valid_elements="*[*]"),c.valid_styles&&(p={},h(c.valid_styles,function(b,c){p[c]=a.explode(b)})),r=i("whitespace_elements","pre script noscript style textarea"),s=i("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),t=i("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr"),u=i("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),w=i("non_empty_elements","td th iframe video audio object",t),textBlockElementsMap=i("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure"),v=i("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex samp option datalist select optgroup",textBlockElementsMap),c.valid_elements?l(c.valid_elements):(h(q,function(a,b){y[b]={attributes:a.attributes,attributesOrder:a.attributesOrder},z[b]=a.children}),"html5"!=c.schema&&h(b("strong/b,em/i"),function(a){a=b(a,"/"),y[a[1]].outputName=a[0]}),y.img.attributesDefault=[{name:"alt",value:""}],h(b("ol,ul,sub,sup,blockquote,span,font,a,table,tbody,tr,strong,em,b,i"),function(a){y[a]&&(y[a].removeEmpty=!0)}),h(b("p,h1,h2,h3,h4,h5,h6,th,td,pre,div,address,caption"),function(a){y[a].paddEmpty=!0})),m(c.custom_elements),n(c.valid_children),k(c.extended_valid_elements),n("+ol[ul|ol],+ul[ul|ol]"),c.invalid_elements&&a.each(a.explode(c.invalid_elements),function(a){y[a]&&delete y[a]}),o("span")||k("span[!data-mce-type|*]"),x.children=z,x.styles=p,x.getBoolAttrs=function(){return u},x.getBlockElements=function(){return v},x.getTextBlockElements=function(){return textBlockElementsMap},x.getShortEndedElements=function(){return t},x.getSelfClosingElements=function(){return s},x.getNonEmptyElements=function(){return w},x.getWhiteSpaceElements=function(){return r},x.isValidChild=function(a,b){var c=z[a];return!(!c||!c[b])},x.isValid=function(a,b){var c,d,e=o(a);if(e){if(!b)return!0;if(e.attributes[b])return!0;if(c=e.attributePatterns)for(d=c.length;d--;)if(c[d].pattern.test(a))return!0}return!1},x.getElementRule=o,x.getCustomElements=function(){return B},x.addValidElements=k,x.setValidElements=l,x.addCustomElements=m,x.addValidChildren=n,x.elements=y}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){a.html.SaxParser=function(b,c){var d=this,e=function(){};b=b||{},d.schema=c=c||new a.html.Schema,b.fix_self_closing!==!1&&(b.fix_self_closing=!0),a.each("comment cdata text start end pi doctype".split(" "),function(a){a&&(d[a]=b[a]||e)}),d.parse=function(d){function e(a){var b,c;for(b=M.length;b--&&M[b].name!==a;);if(b>=0){for(c=M.length-1;c>=b;c--)a=M[c],a.valid&&K.end(a.name);M.length=b}}function f(a,b,c,d,e){var f,g;if(b=b.toLowerCase(),c=b in q?b:O(c||d||e||""),s&&!n&&0!==b.indexOf("data-")){if(f=y[b],!f&&z){for(g=z.length;g--&&(f=z[g],!f.pattern.test(b)););-1===g&&(f=null)}if(!f)return;if(f.validValues&&!(c in f.validValues))return}j.map[b]=c,j.push({name:b,value:c})}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=this,L=0,M=[],N=0,O=a.html.Entities.decode;for(E=new RegExp("<(?:(?:!--([\\w\\W]*?)-->)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([^>]+)>)|(?:([A-Za-z0-9\\-\\:\\.]+)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))","g"),F=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,G={script:/<\/script[^>]*>/gi,style:/<\/style[^>]*>/gi,noscript:/<\/noscript[^>]*>/gi},p=c.getShortEndedElements(),D=b.self_closing_elements||c.getSelfClosingElements(),q=c.getBoolAttrs(),s=b.validate,o=b.remove_internals,I=b.fix_self_closing,J=a.isIE,x=/^:/;g=E.exec(d);){if(g.index>L&&K.text(O(d.substr(L,g.index-L))),h=g[6])h=h.toLowerCase(),J&&x.test(h)&&(h=h.substr(1)),e(h);else if(h=g[7]){if(h=h.toLowerCase(),J&&x.test(h)&&(h=h.substr(1)),r=h in p,I&&D[h]&&M.length>0&&M[M.length-1].name===h&&e(h),!s||(t=c.getElementRule(h))){if(u=!0,s&&(y=t.attributes,z=t.attributePatterns),(w=g[8])?(n=-1!==w.indexOf("data-mce-type"),n&&o&&(u=!1),j=[],j.map={},w.replace(F,f)):(j=[],j.map={}),s&&!n){if(A=t.attributesRequired,B=t.attributesDefault,C=t.attributesForced)for(k=C.length;k--;)v=C[k],m=v.name,H=v.value,"{$uid}"===H&&(H="mce_"+N++),j.map[m]=H,j.push({name:m,value:H});if(B)for(k=B.length;k--;)v=B[k],m=v.name,m in j.map||(H=v.value,"{$uid}"===H&&(H="mce_"+N++),j.map[m]=H,j.push({name:m,value:H}));if(A){for(k=A.length;k--&&!(A[k]in j.map););-1===k&&(u=!1)}j.map["data-mce-bogus"]&&(u=!1)}u&&K.start(h,j,r)}else u=!1;if(i=G[h]){i.lastIndex=L=g.index+g[0].length,(g=i.exec(d))?(u&&(l=d.substr(L,g.index-L)),L=g.index+g[0].length):(l=d.substr(L),L=d.length),u&&l.length>0&&K.text(l,!0),u&&K.end(h),E.lastIndex=L;continue}r||(w&&w.indexOf("/")==w.length-1?u&&K.end(h):M.push({name:h,valid:u}))}else(h=g[1])?K.comment(h):(h=g[2])?K.cdata(h):(h=g[3])?K.doctype(h):(h=g[4])&&K.pi(h,g[5]);L=g.index+g[0].length}for(d.length>L&&K.text(O(d.substr(L))),k=M.length-1;k>=0;k--)h=M[k],h.valid&&K.end(h.name)}}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){function b(a,b,c){var d,e,f=c?"lastChild":"firstChild",g=c?"prev":"next";if(a[f])return a[f];if(a!==b){if(d=a[g])return d;for(e=a.parent;e&&e!==b;e=e.parent)if(d=e[g])return d}}function c(a,b){this.name=a,this.type=b,1===b&&(this.attributes=[],this.attributes.map={})}var d=/^[ \t\r\n]*$/,e={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11};a.extend(c.prototype,{replace:function(a){var b=this;return a.parent&&a.remove(),b.insert(a,b),b.remove(),b},attr:function(a,b){var c,d,e,f=this;if("string"!=typeof a){for(d in a)f.attr(d,a[d]);return f}if(c=f.attributes){if(b!==e){if(null===b){if(a in c.map)for(delete c.map[a],d=c.length;d--;)if(c[d].name===a)return c=c.splice(d,1),f;return f}if(a in c.map){for(d=c.length;d--;)if(c[d].name===a){c[d].value=b;break}}else c.push({name:a,value:b});return c.map[a]=b,f}return c.map[a]}},clone:function(){var a,b,d,e,f,g=this,h=new c(g.name,g.type);if(d=g.attributes){for(f=[],f.map={},a=0,b=d.length;b>a;a++)e=d[a],"id"!==e.name&&(f[f.length]={name:e.name,value:e.value},f.map[e.name]=e.value);h.attributes=f}return h.value=g.value,h.shortEnded=g.shortEnded,h},wrap:function(a){var b=this;return b.parent.insert(a,b),a.append(b),b},unwrap:function(){var a,b,c=this;for(a=c.firstChild;a;)b=a.next,c.insert(a,c,!0),a=b;c.remove()},remove:function(){var a=this,b=a.parent,c=a.next,d=a.prev;return b&&(b.firstChild===a?(b.firstChild=c,c&&(c.prev=null)):d.next=c,b.lastChild===a?(b.lastChild=d,d&&(d.next=null)):c.prev=d,a.parent=a.next=a.prev=null),a},append:function(a){var b,c=this;return a.parent&&a.remove(),b=c.lastChild,b?(b.next=a,a.prev=b,c.lastChild=a):c.lastChild=c.firstChild=a,a.parent=c,a},insert:function(a,b,c){var d;return a.parent&&a.remove(),d=b.parent||this,c?(b===d.firstChild?d.firstChild=a:b.prev.next=a,a.prev=b.prev,a.next=b,b.prev=a):(b===d.lastChild?d.lastChild=a:b.next.prev=a,a.next=b.next,a.prev=b,b.next=a),a.parent=d,a},getAll:function(a){var c,d=this,e=[];for(c=d.firstChild;c;c=b(c,d))c.name===a&&e.push(c);return e},empty:function(){var a,c,d,e=this;if(e.firstChild){for(a=[],d=e.firstChild;d;d=b(d,e))a.push(d);for(c=a.length;c--;)d=a[c],d.parent=d.firstChild=d.lastChild=d.next=d.prev=null}return e.firstChild=e.lastChild=null,e},isEmpty:function(a){var c,e,f=this,g=f.firstChild;if(g)do{if(1===g.type){if(g.attributes.map["data-mce-bogus"])continue;if(a[g.name])return!1;for(c=g.attributes.length;c--;)if(e=g.attributes[c].name,"name"===e||0===e.indexOf("data-mce-"))return!1}if(8===g.type)return!1;if(3===g.type&&!d.test(g.value))return!1}while(g=b(g,f));return!0},walk:function(a){return b(this,null,a)}}),a.extend(c,{create:function(a,b){var d,f;if(d=new c(a,e[a]||1),b)for(f in b)d.attr(f,b[f]);return d}}),a.html.Node=c})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.html.Node;a.html.DomParser=function(c,d){function e(c){var e,g,h,i,j,k,l,m,n,o,p,q,r,s;for(p=a.makeMap("tr,td,th,tbody,thead,tfoot,table"),o=d.getNonEmptyElements(),q=d.getTextBlockElements(),e=0;c.length>e;e++)if(g=c[e],g.parent&&!g.fixed)if(q[g.name]&&"li"==g.parent.name){for(r=g.next;r&&q[r.name];)r.name="li",r.fixed=!0,g.parent.insert(r,g.parent),r=r.next;g.unwrap(g)}else{for(i=[g],h=g.parent;h&&!d.isValidChild(h.name,g.name)&&!p[h.name];h=h.parent)i.push(h);if(h&&i.length>1){for(i.reverse(),j=k=f.filterNode(i[0].clone()),n=0;i.length-1>n;n++){for(d.isValidChild(k.name,i[n].name)?(l=f.filterNode(i[n].clone()),k.append(l)):l=k,m=i[n].firstChild;m&&m!=i[n+1];)s=m.next,l.append(m),m=s;k=l}j.isEmpty(o)?h.insert(g,i[0],!0):(h.insert(j,i[0],!0),h.insert(g,j)),h=i[0],(h.isEmpty(o)||h.firstChild===h.lastChild&&"br"===h.firstChild.name)&&h.empty().remove()}else if(g.parent){if("li"===g.name){if(r=g.prev,r&&("ul"===r.name||"ul"===r.name)){r.append(g);continue}if(r=g.next,r&&("ul"===r.name||"ul"===r.name)){r.insert(g,r.firstChild,!0);continue}g.wrap(f.filterNode(new b("ul",1)));continue}d.isValidChild(g.parent.name,"div")&&d.isValidChild("div",g.name)?g.wrap(f.filterNode(new b("div",1))):"style"===g.name||"script"===g.name?g.empty().remove():g.unwrap()}}}var f=this,g={},h=[],i={},j={};c=c||{},c.validate="validate"in c?c.validate:!0,c.root_name=c.root_name||"body",f.schema=d=d||new a.html.Schema,f.filterNode=function(a){var b,c,d;c in g&&(d=i[c],d?d.push(a):i[c]=[a]),b=h.length;for(;b--;)c=h[b].name,c in a.attributes.map&&(d=j[c],d?d.push(a):j[c]=[a]);return a},f.addNodeFilter=function(b,c){a.each(a.explode(b),function(a){var b=g[a];b||(g[a]=b=[]),b.push(c)})},f.addAttributeFilter=function(b,c){a.each(a.explode(b),function(a){var b;for(b=0;h.length>b;b++)if(h[b].name===a)return h[b].callbacks.push(c),void 0;h.push({name:a,callbacks:[c]})})},f.parse=function(f,k){function l(){for(var a,b,c=q.firstChild;c;)a=c.next,3==c.type||1==c.type&&"p"!==c.name&&!A[c.name]&&!c.attr("data-mce-type")?b?b.append(c):(b=m(J,1),q.insert(b,c),b.append(c)):b=null,c=a}function m(a,c){var d,e=new b(a,c);return a in g&&(d=i[a],d?d.push(e):i[a]=[e]),e}function n(a){var b,c,d;for(b=a.prev;b&&3===b.type;)c=b.value.replace(D,""),c.length>0?(b.value=c,b=b.prev):(d=b.prev,b.remove(),b=d)}function o(a){var b,c={};for(b in a)"li"!==b&&"p"!=b&&(c[b]=a[b]);return c}var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=[];if(k=k||{},i={},j={},A=a.extend(a.makeMap("script,style,head,html,body,title,meta,param"),d.getBlockElements()),I=d.getNonEmptyElements(),H=d.children,z=c.validate,J="forced_root_block"in k?k.forced_root_block:c.forced_root_block,G=d.getWhiteSpaceElements(),B=/^[ \t\r\n]+/,D=/[ \t\r\n]+$/,E=/[ \t\r\n]+/g,F=/^[ \t\r\n]+$/,p=new a.html.SaxParser({validate:z,self_closing_elements:o(d.getSelfClosingElements()),cdata:function(a){r.append(m("#cdata",4)).value=a},text:function(a,b){var c;C||(a=a.replace(E," "),r.lastChild&&A[r.lastChild.name]&&(a=a.replace(B,""))),0!==a.length&&(c=m("#text",3),c.raw=!!b,r.append(c).value=a)},comment:function(a){r.append(m("#comment",8)).value=a},pi:function(a,b){r.append(m(a,7)).value=b,n(r)},doctype:function(a){var b;b=r.append(m("#doctype",10)),b.value=a,n(r)},start:function(a,b,c){var e,f,g,i,k;if(g=z?d.getElementRule(a):{}){for(e=m(g.outputName||a,1),e.attributes=b,e.shortEnded=c,r.append(e),k=H[r.name],k&&H[e.name]&&!k[e.name]&&K.push(e),f=h.length;f--;)i=h[f].name,i in b.map&&(x=j[i],x?x.push(e):j[i]=[e]);A[a]&&n(e),c||(r=e),!C&&G[a]&&(C=!0)}},end:function(a){var c,e,f,g,h;if(e=z?d.getElementRule(a):{}){if(A[a]&&!C){if(c=r.firstChild,c&&3===c.type)for(f=c.value.replace(B,""),f.length>0?(c.value=f,c=c.next):(g=c.next,c.remove(),c=g);c&&3===c.type;)f=c.value,g=c.next,(0===f.length||F.test(f))&&(c.remove(),c=g),c=g;if(c=r.lastChild,c&&3===c.type)for(f=c.value.replace(D,""),f.length>0?(c.value=f,c=c.prev):(g=c.prev,c.remove(),c=g);c&&3===c.type;)f=c.value,g=c.prev,(0===f.length||F.test(f))&&(c.remove(),c=g),c=g}if(C&&G[a]&&(C=!1),(e.removeEmpty||e.paddEmpty)&&r.isEmpty(I))if(e.paddEmpty)r.empty().append(new b("#text","3")).value="\u00a0";else if(!r.attributes.map.name&&!r.attributes.map.id)return h=r.parent,r.empty().remove(),r=h,void 0;r=r.parent}}},d),q=r=new b(k.context||c.root_name,11),p.parse(f),z&&K.length&&(k.context?k.invalid=!0:e(K)),J&&"body"==q.name&&l(),!k.invalid){for(y in i){for(x=g[y],s=i[y],v=s.length;v--;)s[v].parent||s.splice(v,1);for(t=0,u=x.length;u>t;t++)x[t](s,y,k)}for(t=0,u=h.length;u>t;t++)if(x=h[t],x.name in j){for(s=j[x.name],v=s.length;v--;)s[v].parent||s.splice(v,1);for(v=0,w=x.callbacks.length;w>v;v++)x.callbacks[v](s,x.name,k)}}return q},c.remove_trailing_brs&&f.addNodeFilter("br",function(b){var c,e,f,g,h,i,j=b.length,k=a.extend({},d.getBlockElements()),l=d.getNonEmptyElements();for(k.body=1,c=0;j>c;c++)if(e=b[c],f=e.parent,k[e.parent.name]&&e===f.lastChild){for(h=e.prev;h;){if(i=h.name,"span"!==i||"bookmark"!==h.attr("data-mce-type")){if("br"!==i)break;if("br"===i){e=null;break}}h=h.prev}e&&(e.remove(),f.isEmpty(l)&&(elementRule=d.getElementRule(f.name),elementRule&&(elementRule.removeEmpty?f.remove():elementRule.paddEmpty&&(f.empty().append(new a.html.Node("#text",3)).value="\u00a0"))))}else{for(g=e;f.firstChild===g&&f.lastChild===g&&(g=f,!k[f.name]);)f=f.parent;g===f&&(textNode=new a.html.Node("#text",3),textNode.value="\u00a0",e.replace(textNode))}}),c.allow_html_in_named_anchor||f.addAttributeFilter("id,name",function(a){for(var b,c,d,e,f=a.length;f--;)if(e=a[f],"a"===e.name&&e.firstChild&&!e.attr("href")){d=e.parent,b=e.lastChild;do c=b.prev,d.insert(b,e),b=c;while(b)}})}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){a.html.Serializer=function(b,c){var d=this,e=new a.html.Writer(b);b=b||{},b.validate="validate"in b?b.validate:!0,d.schema=c=c||new a.html.Schema,d.writer=e,d.serialize=function(a){function d(a){var b,h,i,j,k,l,m,n,o,p=f[a.type];if(p)p(a);else{if(b=a.name,h=a.shortEnded,i=a.attributes,g&&i&&i.length>1){for(l=[],l.map={},o=c.getElementRule(a.name),m=0,n=o.attributesOrder.length;n>m;m++)j=o.attributesOrder[m],j in i.map&&(k=i.map[j],l.map[j]=k,l.push({name:j,value:k}));for(m=0,n=i.length;n>m;m++)j=i[m].name,j in l.map||(k=i.map[j],l.map[j]=k,l.push({name:j,value:k}));i=l}if(e.start(a.name,i,h),!h){if(a=a.firstChild)do d(a);while(a=a.next);e.end(b)}}}var f,g;return g=b.validate,f={3:function(a){e.text(a.value,a.raw)},8:function(a){e.comment(a.value)},7:function(a){e.pi(a.name,a.value)},10:function(a){e.doctype(a.value)},4:function(a){e.cdata(a.value)},11:function(a){if(a=a.firstChild)do d(a);while(a=a.next)}},e.reset(),1!=a.type||b.inner?f[11](a):d(a),e.getContent()}}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.html.Writer=function(a){var b,c,d,e,f,g=[];return a=a||{},b=a.indent,c=tinymce.makeMap(a.indent_before||""),d=tinymce.makeMap(a.indent_after||""),e=tinymce.html.Entities.getEncodeFunc(a.entity_encoding||"raw",a.entities),f="html"==a.element_format,{start:function(a,h,i){var j,k,l,m;if(b&&c[a]&&g.length>0&&(m=g[g.length-1],m.length>0&&"\n"!==m&&g.push("\n")),g.push("<",a),h)for(j=0,k=h.length;k>j;j++)l=h[j],g.push(" ",l.name,'="',e(l.value,!0),'"');g[g.length]=!i||f?">":" />",i&&b&&d[a]&&g.length>0&&(m=g[g.length-1],m.length>0&&"\n"!==m&&g.push("\n"))},end:function(a){var c;g.push("</",a,">"),b&&d[a]&&g.length>0&&(c=g[g.length-1],c.length>0&&"\n"!==c&&g.push("\n"))},text:function(a,b){a.length>0&&(g[g.length]=b?a:e(a))},cdata:function(a){g.push("<![CDATA[",a,"]]>")},comment:function(a){g.push("<!--",a,"-->")},pi:function(a,c){c?g.push("<?",a," ",c,"?>"):g.push("<?",a,"?>"),b&&g.push("\n")},doctype:function(a){g.push("<!DOCTYPE",a,">",b?"\n":"")},reset:function(){g.length=0},getContent:function(){return g.join("").replace(/\n$/,"")}}};
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.dom={},function(a,b){function c(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&&a.attachEvent("on"+b,c)}function d(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d||!1):a.detachEvent&&a.detachEvent("on"+b,c)}function e(a,b){function c(){return!1}function d(){return!0}var e,f=b||{};for(e in a)"layerX"!==e&&"layerY"!==e&&(f[e]=a[e]);return f.target||(f.target=f.srcElement||document),f.preventDefault=function(){f.isDefaultPrevented=d,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},f.stopPropagation=function(){f.isPropagationStopped=d,a&&(a.stopPropagation?a.stopPropagation():a.cancelBubble=!0)},f.stopImmediatePropagation=function(){f.isImmediatePropagationStopped=d,f.stopPropagation()},f.isDefaultPrevented||(f.isDefaultPrevented=c,f.isPropagationStopped=c,f.isImmediatePropagationStopped=c),f}function f(a,b,e){function f(){e.domLoaded||(e.domLoaded=!0,b(i))}var g=a.document,i={type:"ready"};return"complete"==g.readyState?(f(),void 0):(h?c(a,"DOMContentLoaded",f):(c(g,"readystatechange",function(){"complete"===g.readyState&&(d(g,"readystatechange",arguments.callee),f())}),g.documentElement.doScroll&&a===a.top&&function(){try{g.documentElement.doScroll("left")}catch(a){return setTimeout(arguments.callee,0),void 0}f()}()),c(a,"load",f),void 0)}function g(a){function g(a,b){var c,d,e,f;if(c=n[b][a.type])for(d=0,e=c.length;e>d;d++)if(f=c[d],f&&f.func.call(f.scope,a)===!1&&a.preventDefault(),a.isImmediatePropagationStopped())return}var i,j,k,l,m=this,n={};k="onmouseenter"in document.documentElement,j="onfocusin"in document.documentElement,l={mouseenter:"mouseover",mouseleave:"mouseout"},i=1,m.domLoaded=!1,m.events=n,m.bind=function(d,o,p,q){function r(a){g(e(a||z.event),s)}var s,t,u,v,w,x,y,z=window;if(d&&3!==d.nodeType&&8!==d.nodeType){for(d[b]?(s=d[b],n[s]||(n[s]={})):(s=i++,d[b]=s,n[s]={}),q=q||d,o=o.split(" "),u=o.length;u--;)v=o[u],x=r,w=y=!1,"DOMContentLoaded"===v&&(v="ready"),!m.domLoaded&&"complete"!=d.readyState||"ready"!==v?(k||(w=l[v],w&&(x=function(a){var b,c;if(b=a.currentTarget,c=a.relatedTarget,c&&b.contains)c=b.contains(c);else for(;c&&c!==b;)c=c.parentNode;c||(a=e(a||z.event),a.type="mouseout"===a.type?"mouseleave":"mouseenter",a.target=b,g(a,s))})),j||"focusin"!==v&&"focusout"!==v||(y=!0,w="focusin"===v?"focus":"blur",x=function(a){a=e(a||z.event),a.type="focus"===a.type?"focusin":"focusout",g(a,s)}),t=n[s][v],t?t.push({func:p,scope:q}):(n[s][v]=t=[{func:p,scope:q}],t.fakeName=w,t.capture=y,t.nativeHandler=x,h||(t.proxyHandler=a(s)),"ready"===v?f(d,x,m):c(d,w||v,h?x:t.proxyHandler,y))):(m.domLoaded=!0,p.call(q,e({type:v})));return d=t=0,p}},m.unbind=function(a,c,e){var f,g,i,j,k,l;if(!a||3===a.nodeType||8===a.nodeType)return m;if(f=a[b]){if(l=n[f],c){for(c=c.split(" "),i=c.length;i--;)if(k=c[i],g=l[k]){if(e)for(j=g.length;j--;)g[j].func===e&&g.splice(j,1);e&&0!==g.length||(delete l[k],d(a,g.fakeName||k,h?g.nativeHandler:g.proxyHandler,g.capture))}}else{for(k in l)g=l[k],d(a,g.fakeName||k,h?g.nativeHandler:g.proxyHandler,g.capture);l={}}for(k in l)return m;delete n[f];try{delete a[b]}catch(o){a[b]=null}}return m},m.fire=function(a,c,d){var f,h;if(!a||3===a.nodeType||8===a.nodeType)return m;h=e(null,d),h.type=c;do f=a[b],f&&g(h,f),a=a.parentNode||a.ownerDocument||a.defaultView||a.parentWindow;while(a&&!h.isPropagationStopped());return m},m.clean=function(a){var c,d,e=m.unbind;if(!a||3===a.nodeType||8===a.nodeType)return m;if(a[b]&&e(a),a.getElementsByTagName||(a=a.document),a&&a.getElementsByTagName)for(e(a),d=a.getElementsByTagName("*"),c=d.length;c--;)a=d[c],a[b]&&e(a);return m},m.callNativeHandler=function(a,b){n&&n[a][b.type].nativeHandler(b)},m.destory=function(){n={}},m.add=function(a,b,c,d){"string"==typeof a&&(a=document.getElementById(a));{if(!(a&&a instanceof Array))return"init"===b&&(b="ready"),m.bind(a,b instanceof Array?b.join(" "):b,c,d);for(var e=a.length;e--;)m.add(a[e],b,c,d)}},m.remove=function(a,b,c,d){if(!a)return m;if("string"==typeof a&&(a=document.getElementById(a)),a instanceof Array){for(var e=a.length;e--;)m.remove(a[e],b,c,d);return m}return m.unbind(a,b instanceof Array?b.join(" "):b,c)},m.clear=function(a){return"string"==typeof a&&(a=document.getElementById(a)),m.clean(a)},m.cancel=function(a){return a&&(m.prevent(a),m.stop(a)),!1},m.prevent=function(a){return a.preventDefault||(a=e(a)),a.preventDefault(),!1},m.stop=function(a){return a.stopPropagation||(a=e(a)),a.stopPropagation(),!1}}var h=!!document.addEventListener;a.EventUtils=g,a.Event=new g(function(a){return function(b){tinymce.dom.Event.callNativeHandler(a,b)}}),a.Event.bind(window,"ready",function(){}),a=0}(tinymce.dom,"data-mce-expando");
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.dom.TreeWalker=function(a,b){function c(a,c,d,e){var f,g;if(a){if(!e&&a[c])return a[c];if(a!=b){if(f=a[d])return f;for(g=a.parentNode;g&&g!=b;g=g.parentNode)if(f=g[d])return f}}}var d=a;this.current=function(){return d},this.next=function(a){return d=c(d,"firstChild","nextSibling",a)},this.prev=function(a){return d=c(d,"lastChild","previousSibling",a)}};
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.each,c=a.is,d=a.isWebKit,e=a.isIE,f=a.html.Entities,g=/^([a-z0-9],?)+$/i,h=/^[ \t\r\n]*$/;a.create("tinymce.dom.DOMUtils",{doc:null,root:null,files:null,pixelStyles:/^(top|left|bottom|right|width|height|borderWidth)$/,props:{"for":"htmlFor","class":"className",className:"className",checked:"checked",disabled:"disabled",maxlength:"maxLength",readonly:"readOnly",selected:"selected",value:"value",id:"id",name:"name",type:"type"},DOMUtils:function(b,c){var d,e=this;if(e.doc=b,e.win=window,e.files={},e.cssFlicker=!1,e.counter=0,e.stdMode=!a.isIE||b.documentMode>=8,e.boxModel=!a.isIE||"CSS1Compat"==b.compatMode||e.stdMode,e.hasOuterHTML="outerHTML"in b.createElement("a"),e.settings=c=a.extend({keep_values:!1,hex_colors:1},c),e.schema=c.schema,e.styles=new a.html.Styles({url_converter:c.url_converter,url_converter_scope:c.url_converter_scope},c.schema),a.isIE6)try{b.execCommand("BackgroundImageCache",!1,!0)}catch(f){e.cssFlicker=!0}e.fixDoc(b),e.events=c.ownEvents?new a.dom.EventUtils(c.proxy):a.dom.Event,a.addUnload(e.destroy,e),d=c.schema?c.schema.getBlockElements():{},e.isBlock=function(a){if(!a)return!1;var b=a.nodeType;return b?!(1!==b||!d[a.nodeName]):!!d[a]}},fixDoc:function(a){var b,c=this.settings;if(e&&c.schema){"abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video".replace(/\w+/g,function(b){a.createElement(b)});for(b in c.schema.getCustomElements())a.createElement(b)}},clone:function(a,c){var d,f,g=this;return!e||1!==a.nodeType||c?a.cloneNode(c):(f=g.doc,c?d.firstChild:(d=f.createElement(a.nodeName),b(g.getAttribs(a),function(b){g.setAttrib(d,b.nodeName,g.getAttrib(a,b.nodeName))}),d))},getRoot:function(){var a=this,b=a.settings;return b&&a.get(b.root_element)||a.doc.body},getViewPort:function(a){var b,c;return a=a?a:this.win,b=a.document,c=this.boxModel?b.documentElement:b.body,{x:a.pageXOffset||c.scrollLeft,y:a.pageYOffset||c.scrollTop,w:a.innerWidth||c.clientWidth,h:a.innerHeight||c.clientHeight}},getRect:function(a){var b,c,d=this;return a=d.get(a),b=d.getPos(a),c=d.getSize(a),{x:b.x,y:b.y,w:c.w,h:c.h}},getSize:function(a){var b,c,d=this;return a=d.get(a),b=d.getStyle(a,"width"),c=d.getStyle(a,"height"),-1===b.indexOf("px")&&(b=0),-1===c.indexOf("px")&&(c=0),{w:parseInt(b,10)||a.offsetWidth||a.clientWidth,h:parseInt(c,10)||a.offsetHeight||a.clientHeight}},getParent:function(a,b,c){return this.getParents(a,b,c,!1)},getParents:function(a,b,d,e){var f,g=this,h=g.settings,i=[];for(a=g.get(a),e=void 0===e,h.strict_root&&(d=d||g.getRoot()),c(b,"string")&&(f=b,b="*"===b?function(a){return 1==a.nodeType}:function(a){return g.is(a,f)});a&&a!=d&&a.nodeType&&9!==a.nodeType;){if(!b||b(a)){if(!e)return a;i.push(a)}a=a.parentNode}return e?i:null},get:function(a){var b;return a&&this.doc&&"string"==typeof a&&(b=a,a=this.doc.getElementById(a),a&&a.id!==b)?this.doc.getElementsByName(b)[1]:a},getNext:function(a,b){return this._findSib(a,b,"nextSibling")},getPrev:function(a,b){return this._findSib(a,b,"previousSibling")},select:function(b,c){var d=this;return a.dom.Sizzle(b,d.get(c)||d.get(d.settings.root_element)||d.doc,[])},is:function(b,c){var d;if(void 0===b.length){if("*"===c)return 1==b.nodeType;if(g.test(c)){for(c=c.toLowerCase().split(/,/),b=b.nodeName.toLowerCase(),d=c.length-1;d>=0;d--)if(c[d]==b)return!0;return!1}}return a.dom.Sizzle.matches(c,b.nodeType?[b]:b).length>0},add:function(a,b,d,e,f){var g=this;return this.run(a,function(a){var h;return h=c(b,"string")?g.doc.createElement(b):b,g.setAttribs(h,d),e&&(e.nodeType?h.appendChild(e):g.setHTML(h,e)),f?h:a.appendChild(h)})},create:function(a,b,c){return this.add(this.doc.createElement(a),a,b,c,1)},createHTML:function(a,b,c){var d,e="",f=this;e+="<"+a;for(d in b)b.hasOwnProperty(d)&&(e+=" "+d+'="'+f.encode(b[d])+'"');return"undefined"!=typeof c?e+">"+c+"</"+a+">":e+" />"},remove:function(b,c){return this.run(b,function(b){var d,e=b.parentNode;if(!e)return null;if(c)for(;d=b.firstChild;)!a.isIE||3!==d.nodeType||d.nodeValue?e.insertBefore(d,b):b.removeChild(d);return e.removeChild(b)})},setStyle:function(b,c,d){var f=this;return f.run(b,function(g){var h;switch(h=g.style,c=c.replace(/-(\D)/g,function(a,b){return b.toUpperCase()}),f.pixelStyles.test(c)&&(a.is(d,"number")||/^[\-0-9\.]+$/.test(d))&&(d+="px"),c){case"opacity":e&&(h.filter=""===d?"":"alpha(opacity="+100*d+")",b.currentStyle&&b.currentStyle.hasLayout||(h.display="inline-block")),h[c]=h["-moz-opacity"]=h["-khtml-opacity"]=d||"";break;case"float":e?h.styleFloat=d:h.cssFloat=d;break;default:h[c]=d||""}f.settings.update_styles&&f.setAttrib(g,"data-mce-style")})},getStyle:function(a,b,c){if(a=this.get(a)){if(this.doc.defaultView&&c){b=b.replace(/[A-Z]/g,function(a){return"-"+a});try{return this.doc.defaultView.getComputedStyle(a,null).getPropertyValue(b)}catch(d){return null}}return b=b.replace(/-(\D)/g,function(a,b){return b.toUpperCase()}),"float"==b&&(b=e?"styleFloat":"cssFloat"),a.currentStyle&&c?a.currentStyle[b]:a.style?a.style[b]:void 0}},setStyles:function(a,c){var d,e=this,f=e.settings;d=f.update_styles,f.update_styles=0,b(c,function(b,c){e.setStyle(a,c,b)}),f.update_styles=d,f.update_styles&&e.setAttrib(a,f.cssText)},removeAllAttribs:function(a){return this.run(a,function(a){var b,c=a.attributes;for(b=c.length-1;b>=0;b--)a.removeAttributeNode(c.item(b))})},setAttrib:function(a,d,e){var f=this;if(a&&d)return f.settings.strict&&(d=d.toLowerCase()),this.run(a,function(a){var g=f.settings,h=a.getAttribute(d);if(null!==e)switch(d){case"style":if(!c(e,"string"))return b(e,function(b,c){f.setStyle(a,c,b)}),void 0;g.keep_values&&(e&&!f._isRes(e)?a.setAttribute("data-mce-style",e,2):a.removeAttribute("data-mce-style",2)),a.style.cssText=e;break;case"class":a.className=e||"";break;case"src":case"href":g.keep_values&&(g.url_converter&&(e=g.url_converter.call(g.url_converter_scope||f,e,d,a)),f.setAttrib(a,"data-mce-"+d,e,2));break;case"shape":a.setAttribute("data-mce-style",e)}if(c(e)&&null!==e&&0!==e.length?a.setAttribute(d,""+e,2):a.removeAttribute(d,2),tinyMCE.activeEditor&&h!=e){var i=tinyMCE.activeEditor;i.onSetAttrib.dispatch(i,a,d,e)}})},setAttribs:function(a,c){var d=this;return this.run(a,function(a){b(c,function(b,c){d.setAttrib(a,c,b)})})},getAttrib:function(b,f,g){var h,i,j=this;if(b=j.get(b),!b||1!==b.nodeType)return g===i?!1:g;if(c(g)||(g=""),/^(src|href|style|coords|shape)$/.test(f)&&(h=b.getAttribute("data-mce-"+f)))return h;if(e&&j.props[f]&&(h=b[j.props[f]],h=h&&h.nodeValue?h.nodeValue:h),h||(h=b.getAttribute(f,2)),/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/.test(f))return b[j.props[f]]===!0&&""===h?f:h?f:"";if("FORM"===b.nodeName&&b.getAttributeNode(f))return b.getAttributeNode(f).nodeValue;if("style"===f&&(h=h||b.style.cssText,h&&(h=j.serializeStyle(j.parseStyle(h),b.nodeName),j.settings.keep_values&&!j._isRes(h)&&b.setAttribute("data-mce-style",h))),d&&"class"===f&&h&&(h=h.replace(/(apple|webkit)\-[a-z\-]+/gi,"")),e)switch(f){case"rowspan":case"colspan":1===h&&(h="");break;case"size":("+0"===h||20===h||0===h)&&(h="");break;case"width":case"height":case"vspace":case"checked":case"disabled":case"readonly":0===h&&(h="");break;case"hspace":-1===h&&(h="");break;case"maxlength":case"tabindex":(32768===h||2147483647===h||"32768"===h)&&(h="");break;case"multiple":case"compact":case"noshade":case"nowrap":return 65535===h?f:g;case"shape":h=h.toLowerCase();break;default:0===f.indexOf("on")&&h&&(h=a._replace(/^function\s+\w+\(\)\s+\{\s+(.*)\s+\}$/,"$1",""+h))}return h!==i&&null!==h&&""!==h?""+h:g},getPos:function(a,b){var c,d,e=this,f=0,g=0,h=e.doc;if(a=e.get(a),b=b||h.body,a){if(a.getBoundingClientRect)return a=a.getBoundingClientRect(),c=e.boxModel?h.documentElement:h.body,f=a.left+(h.documentElement.scrollLeft||h.body.scrollLeft)-c.clientTop,g=a.top+(h.documentElement.scrollTop||h.body.scrollTop)-c.clientLeft,{x:f,y:g};for(d=a;d&&d!=b&&d.nodeType;)f+=d.offsetLeft||0,g+=d.offsetTop||0,d=d.offsetParent;for(d=a.parentNode;d&&d!=b&&d.nodeType;)f-=d.scrollLeft||0,g-=d.scrollTop||0,d=d.parentNode}return{x:f,y:g}},parseStyle:function(a){return this.styles.parse(a)},serializeStyle:function(a,b){return this.styles.serialize(a,b)},addStyle:function(a){var b,c=this.doc;styleElm=c.getElementById("mceDefaultStyles"),styleElm||(styleElm=c.createElement("style"),styleElm.id="mceDefaultStyles",styleElm.type="text/css",b=c.getElementsByTagName("head")[0],b.firstChild?b.insertBefore(styleElm,b.firstChild):b.appendChild(styleElm)),styleElm.styleSheet?styleElm.styleSheet.cssText+=a:styleElm.appendChild(c.createTextNode(a))},loadCSS:function(c){var d,f=this,g=f.doc;c||(c=""),d=g.getElementsByTagName("head")[0],b(c.split(","),function(b){var c;f.files[b]||(f.files[b]=!0,c=f.create("link",{rel:"stylesheet",href:a._addVer(b)}),e&&g.documentMode&&g.recalc&&(c.onload=function(){g.recalc&&g.recalc(),c.onload=null}),d.appendChild(c))})},addClass:function(a,b){return this.run(a,function(a){var c;return b?this.hasClass(a,b)?a.className:(c=this.removeClass(a,b),a.className=(""!=c?c+" ":"")+b):0})},removeClass:function(b,c){var d,e=this;return e.run(b,function(b){var f;return e.hasClass(b,c)?(d||(d=new RegExp("(^|\\s+)"+c+"(\\s+|$)","g")),f=b.className.replace(d," "),f=a.trim(" "!=f?f:""),b.className=f,f||(b.removeAttribute("class"),b.removeAttribute("className")),f):b.className})},hasClass:function(a,b){return a=this.get(a),a&&b?-1!==(" "+a.className+" ").indexOf(" "+b+" "):!1},show:function(a){return this.setStyle(a,"display","block")},hide:function(a){return this.setStyle(a,"display","none")},isHidden:function(a){return a=this.get(a),!a||"none"==a.style.display||"none"==this.getStyle(a,"display")},uniqueId:function(a){return(a?a:"mce_")+this.counter++},setHTML:function(c,d){var f=this;return f.run(c,function(c){if(e){for(;c.firstChild;)c.removeChild(c.firstChild);try{c.innerHTML="<br />"+d,c.removeChild(c.firstChild)}catch(g){var h=f.create("div");h.innerHTML="<br />"+d,b(a.grep(h.childNodes),function(a,b){b&&c.canHaveHTML&&c.appendChild(a)})}}else c.innerHTML=d;return d})},getOuterHTML:function(a){var b,c=this;return(a=c.get(a))?1===a.nodeType&&c.hasOuterHTML?a.outerHTML:(b=(a.ownerDocument||c.doc).createElement("body"),b.appendChild(a.cloneNode(!0)),b.innerHTML):null},setOuterHTML:function(a,b,c){function d(a,b,c){var d,e;for(e=c.createElement("body"),e.innerHTML=b,d=e.lastChild;d;)f.insertAfter(d.cloneNode(!0),a),d=d.previousSibling;f.remove(a)}var f=this;return this.run(a,function(a){if(a=f.get(a),1==a.nodeType)if(c=c||a.ownerDocument||f.doc,e)try{e&&1==a.nodeType?a.outerHTML=b:d(a,b,c)}catch(g){d(a,b,c)}else d(a,b,c)})},decode:f.decode,encode:f.encodeAllRaw,insertAfter:function(a,b){return b=this.get(b),this.run(a,function(a){var c,d;return c=b.parentNode,d=b.nextSibling,d?c.insertBefore(a,d):c.appendChild(a),a})},replace:function(d,e,f){var g=this;return c(e,"array")&&(d=d.cloneNode(!0)),g.run(e,function(c){return f&&b(a.grep(c.childNodes),function(a){d.appendChild(a)}),c.parentNode.replaceChild(d,c)})},rename:function(a,c){var d,e=this;return a.nodeName!=c.toUpperCase()&&(d=e.create(c),b(e.getAttribs(a),function(b){e.setAttrib(d,b.nodeName,e.getAttrib(a,b.nodeName))}),e.replace(d,a,1)),d||a},findCommonAncestor:function(a,b){for(var c,d=a;d;){for(c=b;c&&d!=c;)c=c.parentNode;if(d==c)break;d=d.parentNode}return!d&&a.ownerDocument?a.ownerDocument.documentElement:d},toHex:function(a){function b(a){return a=parseInt(a,10).toString(16),a.length>1?a:"0"+a}var c=/^\s*rgb\s*?\(\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?\)\s*$/i.exec(a);return c?a="#"+b(c[1])+b(c[2])+b(c[3]):a},getClasses:function(){function c(e){b(e.imports,function(a){c(a)}),b(e.cssRules||e.rules,function(e){switch(e.type||1){case 1:e.selectorText&&b(e.selectorText.split(","),function(b){b=b.replace(/^\s*|\s*$|^\s\./g,""),!/\.mce/.test(b)&&/\.[\w\-]+$/.test(b)&&(d=b,b=a._replace(/.*\.([a-z0-9_\-]+).*/i,"$1",b),(!h||(b=h(b,d)))&&(g[b]||(f.push({"class":b}),g[b]=1)))});break;case 3:c(e.styleSheet)}})}var d,e=this,f=[],g={},h=e.settings.class_filter;if(e.classes)return e.classes;try{b(e.doc.styleSheets,c)}catch(i){}return f.length>0&&(e.classes=f),f},run:function(a,c,d){var e,f=this;return f.doc&&"string"==typeof a&&(a=f.get(a)),a?(d=d||this,a.nodeType||!a.length&&0!==a.length?c.call(d,a):(e=[],b(a,function(a,b){a&&("string"==typeof a&&(a=f.doc.getElementById(a)),e.push(c.call(d,a,b)))}),e)):!1},getAttribs:function(a){var b;return a=this.get(a),a?e?(b=[],"OBJECT"==a.nodeName?a.attributes:("OPTION"===a.nodeName&&this.getAttrib(a,"selected")&&b.push({specified:1,nodeName:"selected"}),a.cloneNode(!1).outerHTML.replace(/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi,"").replace(/[\w:\-]+/gi,function(a){b.push({specified:1,nodeName:a})}),b)):a.attributes:[]},isEmpty:function(b,c){var d,e,f,g,i,j=this,k=0;if(b=b.firstChild){g=new a.dom.TreeWalker(b,b.parentNode),c=c||j.schema?j.schema.getNonEmptyElements():null;do{if(f=b.nodeType,1===f){if(b.getAttribute("data-mce-bogus"))continue;if(i=b.nodeName.toLowerCase(),c&&c[i]){if("br"===i){k++;continue}return!1}for(e=j.getAttribs(b),d=b.attributes.length;d--;)if(i=b.attributes[d].nodeName,"name"===i||"data-mce-bookmark"===i)return!1}if(8==f)return!1;if(3===f&&!h.test(b.nodeValue))return!1}while(b=g.next())}return 1>=k},destroy:function(b){var c=this;c.win=c.doc=c.root=c.events=c.frag=null,b||a.removeUnload(c.destroy)},createRng:function(){var b=this.doc;return b.createRange?b.createRange():new a.dom.Range(this)},nodeIndex:function(a,b){var c,d,e,f=0;if(a)for(c=a.nodeType,a=a.previousSibling,d=a;a;a=a.previousSibling)e=a.nodeType,(!b||3!=e||e!=c&&a.nodeValue.length)&&(f++,c=e);return f},split:function(b,c,d){function e(b){function c(a){var b=a.previousSibling&&"SPAN"==a.previousSibling.nodeName,c=a.nextSibling&&"SPAN"==a.nextSibling.nodeName;return b&&c}var d,f=b.childNodes,g=b.nodeType;if(1!=g||"bookmark"!=b.getAttribute("data-mce-type")){for(d=f.length-1;d>=0;d--)e(f[d]);if(9!=g){if(3==g&&b.nodeValue.length>0){var h=a.trim(b.nodeValue).length;if(!i.isBlock(b.parentNode)||h>0||0===h&&c(b))return}else if(1==g&&(f=b.childNodes,1==f.length&&f[0]&&1==f[0].nodeType&&"bookmark"==f[0].getAttribute("data-mce-type")&&b.parentNode.insertBefore(f[0],b),f.length||/^(br|hr|input|img)$/i.test(b.nodeName)))return;i.remove(b)}return b}}var f,g,h,i=this,j=i.createRng();return b&&c?(j.setStart(b.parentNode,i.nodeIndex(b)),j.setEnd(c.parentNode,i.nodeIndex(c)),f=j.extractContents(),j=i.createRng(),j.setStart(c.parentNode,i.nodeIndex(c)+1),j.setEnd(b.parentNode,i.nodeIndex(b)+1),g=j.extractContents(),h=b.parentNode,h.insertBefore(e(f),b),d?h.replaceChild(d,c):h.insertBefore(c,b),h.insertBefore(e(g),b),i.remove(b),d||c):void 0},bind:function(a,b,c,d){return this.events.add(a,b,c,d||this)},unbind:function(a,b,c){return this.events.remove(a,b,c)},fire:function(a,b,c){return this.events.fire(a,b,c)},getContentEditable:function(a){var b;return 1!=a.nodeType?null:(b=a.getAttribute("data-mce-contenteditable"),b&&"inherit"!==b?b:"inherit"!==a.contentEditable?a.contentEditable:null)},dumpRng:function(a){return"startContainer: "+a.startContainer.nodeName+", startOffset: "+a.startOffset+", endContainer: "+a.endContainer.nodeName+", endOffset: "+a.endOffset},_findSib:function(a,b,d){var e=this,f=b;if(a)for(c(f,"string")&&(f=function(a){return e.is(a,b)}),a=a[d];a;a=a[d])if(f(a))return a;return null},_isRes:function(a){return/^(top|left|bottom|right|width|height)/i.test(a)||/;\s*(top|left|bottom|right|width|height)/i.test(a)}}),a.DOM=new a.dom.DOMUtils(document,{process_html:0})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){function b(a){function c(){return I.createDocumentFragment()}function d(a,b){w(M,a,b)}function e(a,b){w(N,a,b)}function f(a){d(a.parentNode,T(a))}function g(a){d(a.parentNode,T(a)+1)}function h(a){e(a.parentNode,T(a))}function i(a){e(a.parentNode,T(a)+1)}function j(a){a?(H[Q]=H[P],H[R]=H[O]):(H[P]=H[Q],H[O]=H[R]),H.collapsed=M}function k(a){f(a),i(a)}function l(a){d(a,0),e(a,1===a.nodeType?a.childNodes.length:a.nodeValue.length)}function m(a,b){var c=H[P],d=H[O],e=H[Q],f=H[R],g=b.startContainer,h=b.startOffset,i=b.endContainer,j=b.endOffset;return 0===a?v(c,d,g,h):1===a?v(e,f,g,h):2===a?v(e,f,i,j):3===a?v(c,d,i,j):void 0}function n(){x(L)}function o(){return x(J)}function p(){return x(K)}function q(b){var c,d,e=this[P],f=this[O];3!==e.nodeType&&4!==e.nodeType||!e.nodeValue?(e.childNodes.length>0&&(d=e.childNodes[f]),d?e.insertBefore(b,d):e.appendChild(b)):f?f>=e.nodeValue.length?a.insertAfter(b,e):(c=e.splitText(f),e.parentNode.insertBefore(b,c)):e.parentNode.insertBefore(b,e)}function r(a){var b=H.extractContents();H.insertNode(a),a.appendChild(b),H.selectNode(a)}function s(){return S(new b(a),{startContainer:H[P],startOffset:H[O],endContainer:H[Q],endOffset:H[R],collapsed:H.collapsed,commonAncestorContainer:H.commonAncestorContainer})}function t(a,b){var c;if(3==a.nodeType)return a;if(0>b)return a;for(c=a.firstChild;c&&b>0;)--b,c=c.nextSibling;return c?c:a}function u(){return H[P]==H[Q]&&H[O]==H[R]}function v(b,c,d,e){var f,g,h,i,j,k;if(b==d)return c==e?0:e>c?-1:1;for(f=d;f&&f.parentNode!=b;)f=f.parentNode;if(f){for(g=0,h=b.firstChild;h!=f&&c>g;)g++,h=h.nextSibling;return g>=c?-1:1}for(f=b;f&&f.parentNode!=d;)f=f.parentNode;if(f){for(g=0,h=d.firstChild;h!=f&&e>g;)g++,h=h.nextSibling;return e>g?-1:1}for(i=a.findCommonAncestor(b,d),j=b;j&&j.parentNode!=i;)j=j.parentNode;for(j||(j=i),k=d;k&&k.parentNode!=i;)k=k.parentNode;if(k||(k=i),j==k)return 0;for(h=i.firstChild;h;){if(h==j)return-1;if(h==k)return 1;h=h.nextSibling}}function w(b,c,d){var e,f;for(b?(H[P]=c,H[O]=d):(H[Q]=c,H[R]=d),e=H[Q];e.parentNode;)e=e.parentNode;for(f=H[P];f.parentNode;)f=f.parentNode;f==e?v(H[P],H[O],H[Q],H[R])>0&&H.collapse(b):H.collapse(b),H.collapsed=u(),H.commonAncestorContainer=a.findCommonAncestor(H[P],H[Q])}function x(a){var b,c,d,e,f,g,h,i=0,j=0;if(H[P]==H[Q])return y(a);for(b=H[Q],c=b.parentNode;c;b=c,c=c.parentNode){if(c==H[P])return z(b,a);++i}for(b=H[P],c=b.parentNode;c;b=c,c=c.parentNode){if(c==H[Q])return A(b,a);++j}for(d=j-i,e=H[P];d>0;)e=e.parentNode,d--;for(f=H[Q];0>d;)f=f.parentNode,d++;for(g=e.parentNode,h=f.parentNode;g!=h;g=g.parentNode,h=h.parentNode)e=g,f=h;return B(e,f,a)}function y(a){var b,d,e,f,g,h,i,j,k;if(a!=L&&(b=c()),H[O]==H[R])return b;if(3==H[P].nodeType){if(d=H[P].nodeValue,e=d.substring(H[O],H[R]),a!=K&&(f=H[P],j=H[O],k=H[R]-H[O],0===j&&k>=f.nodeValue.length-1?f.parentNode.removeChild(f):f.deleteData(j,k),H.collapse(M)),a==L)return;return e.length>0&&b.appendChild(I.createTextNode(e)),b}for(f=t(H[P],H[O]),g=H[R]-H[O];f&&g>0;)h=f.nextSibling,i=F(f,a),b&&b.appendChild(i),--g,f=h;return a!=K&&H.collapse(M),b}function z(a,b){var d,e,f,g,h,i;if(b!=L&&(d=c()),e=C(a,b),d&&d.appendChild(e),f=T(a),g=f-H[O],0>=g)return b!=K&&(H.setEndBefore(a),H.collapse(N)),d;for(e=a.previousSibling;g>0;)h=e.previousSibling,i=F(e,b),d&&d.insertBefore(i,d.firstChild),--g,e=h;return b!=K&&(H.setEndBefore(a),H.collapse(N)),d}function A(a,b){var d,e,f,g,h,i;for(b!=L&&(d=c()),f=D(a,b),d&&d.appendChild(f),e=T(a),++e,g=H[R]-e,f=a.nextSibling;f&&g>0;)h=f.nextSibling,i=F(f,b),d&&d.appendChild(i),--g,f=h;return b!=K&&(H.setStartAfter(a),H.collapse(M)),d}function B(a,b,d){var e,f,g,h,i,j,k,l;for(d!=L&&(f=c()),e=D(a,d),f&&f.appendChild(e),g=a.parentNode,h=T(a),i=T(b),++h,j=i-h,k=a.nextSibling;j>0;)l=k.nextSibling,e=F(k,d),f&&f.appendChild(e),k=l,--j;return e=C(b,d),f&&f.appendChild(e),d!=K&&(H.setStartAfter(a),H.collapse(M)),f}function C(a,b){var c,d,e,f,g,h=t(H[Q],H[R]-1),i=h!=H[Q];if(h==a)return E(h,i,N,b);for(c=h.parentNode,d=E(c,N,N,b);c;){for(;h;)e=h.previousSibling,f=E(h,i,N,b),b!=L&&d.insertBefore(f,d.firstChild),i=M,h=e;if(c==a)return d;h=c.previousSibling,c=c.parentNode,g=E(c,N,N,b),b!=L&&g.appendChild(d),d=g}}function D(a,b){var c,d,e,f,g,h=t(H[P],H[O]),i=h!=H[P];if(h==a)return E(h,i,M,b);for(c=h.parentNode,d=E(c,N,M,b);c;){for(;h;)e=h.nextSibling,f=E(h,i,M,b),b!=L&&d.appendChild(f),i=M,h=e;if(c==a)return d;h=c.nextSibling,c=c.parentNode,g=E(c,N,M,b),b!=L&&g.appendChild(d),d=g}}function E(b,c,d,e){var f,g,h,i,j;if(c)return F(b,e);if(3==b.nodeType){if(f=b.nodeValue,d?(i=H[O],g=f.substring(i),h=f.substring(0,i)):(i=H[R],g=f.substring(0,i),h=f.substring(i)),e!=K&&(b.nodeValue=h),e==L)return;return j=a.clone(b,N),j.nodeValue=g,j}if(e!=L)return a.clone(b,N)}function F(b,c){return c!=L?c==K?a.clone(b,M):b:(b.parentNode.removeChild(b),void 0)}function G(){return a.create("body",null,p()).outerText}var H=this,I=a.doc,J=0,K=1,L=2,M=!0,N=!1,O="startOffset",P="startContainer",Q="endContainer",R="endOffset",S=tinymce.extend,T=a.nodeIndex;return S(H,{startContainer:I,startOffset:0,endContainer:I,endOffset:0,collapsed:M,commonAncestorContainer:I,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:d,setEnd:e,setStartBefore:f,setStartAfter:g,setEndBefore:h,setEndAfter:i,collapse:j,selectNode:k,selectNodeContents:l,compareBoundaryPoints:m,deleteContents:n,extractContents:o,cloneContents:p,insertNode:q,surroundContents:r,cloneRange:s,toStringIE:G}),H}a.Range=b,b.prototype.toString=function(){return this.toStringIE()}})(tinymce.dom);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(){function a(a){function b(b,c){var d,e,f,g,h,i,j,k,l=0,m=-1;if(d=b.duplicate(),d.collapse(c),k=d.parentElement(),k.ownerDocument===a.dom.doc){for(;"false"===k.contentEditable;)k=k.parentNode;if(!k.hasChildNodes())return{node:k,inside:1};for(g=k.children,e=g.length-1;e>=l;)if(j=Math.floor((l+e)/2),h=g[j],d.moveToElementText(h),m=d.compareEndPoints(c?"StartToStart":"EndToEnd",b),m>0)e=j-1;else{if(!(0>m))return{node:h};l=j+1}if(0>m)for(h?d.collapse(!1):(d.moveToElementText(k),d.collapse(!0),h=k,f=!0),i=0;0!==d.compareEndPoints(c?"StartToStart":"StartToEnd",b)&&0!==d.move("character",1)&&k==d.parentElement();)i++;else for(d.collapse(!0),i=0;0!==d.compareEndPoints(c?"StartToStart":"StartToEnd",b)&&0!==d.move("character",-1)&&k==d.parentElement();)i++;return{node:h,position:m,offset:i,inside:f}}}function c(){function c(a){var c,d,e,f,g,h=b(k,a),i=0;if(c=h.node,d=h.offset,h.inside&&!c.hasChildNodes())return l[a?"setStart":"setEnd"](c,0),void 0;if(d===f)return l[a?"setStartBefore":"setEndAfter"](c),void 0;if(0>h.position){if(e=h.inside?c.firstChild:c.nextSibling,!e)return l[a?"setStartAfter":"setEndAfter"](c),void 0;if(!d)return 3==e.nodeType?l[a?"setStart":"setEnd"](e,0):l[a?"setStartBefore":"setEndBefore"](e),void 0;for(;e;){if(g=e.nodeValue,i+=g.length,i>=d){c=e,i-=d,i=g.length-i;break}e=e.nextSibling}}else{if(e=c.previousSibling,!e)return l[a?"setStartBefore":"setEndBefore"](c);if(!d)return 3==c.nodeType?l[a?"setStart":"setEnd"](e,c.nodeValue.length):l[a?"setStartAfter":"setEndAfter"](e),void 0;for(;e;){if(i+=e.nodeValue.length,i>=d){c=e,i-=d;break}e=e.previousSibling}}l[a?"setStart":"setEnd"](c,i)}var f,g,h,i,j,k=a.getRng(),l=e.createRng();if(f=k.item?k.item(0):k.parentElement(),f.ownerDocument!=e.doc)return l;if(g=a.isCollapsed(),k.item)return l.setStart(f.parentNode,e.nodeIndex(f)),l.setEnd(l.startContainer,l.startOffset+1),l;try{c(!0),g||c()}catch(m){if(-2147024809!=m.number)throw m;j=d.getBookmark(2),h=k.duplicate(),h.collapse(!0),f=h.parentElement(),g||(h=k.duplicate(),h.collapse(!1),i=h.parentElement(),i.innerHTML=i.innerHTML),f.innerHTML=f.innerHTML,d.moveToBookmark(j),k=a.getRng(),c(!0),g||c()}return l}var d=this,e=a.dom,f=!1;this.getBookmark=function(c){function d(a){var b,c,d,f,g=[];for(b=a.parentNode,c=e.getRoot().parentNode;b!=c&&9!==b.nodeType;){for(d=b.children,f=d.length;f--;)if(a===d[f]){g.push(f);break}a=b,b=b.parentNode}return g}function f(a){var c;return c=b(g,a),c?{position:c.position,offset:c.offset,indexes:d(c.node),inside:c.inside}:void 0}var g=a.getRng(),h={};return 2===c&&(g.item?h.start={ctrl:!0,indexes:d(g.item(0))}:(h.start=f(!0),a.isCollapsed()||(h.end=f()))),h},this.moveToBookmark=function(a){function b(a){var b,c,d,f;for(b=e.getRoot(),c=a.length-1;c>=0;c--)f=b.children,d=a[c],f.length-1>=d&&(b=f[d]);return b}function c(c){var e,g,h,i=a[c?"start":"end"];i&&(e=i.position>0,g=f.createTextRange(),g.moveToElementText(b(i.indexes)),offset=i.offset,offset!==h?(g.collapse(i.inside||e),g.moveStart("character",e?-offset:offset)):g.collapse(c),d.setEndPoint(c?"StartToStart":"EndToStart",g),c&&d.collapse(!0))}var d,f=e.doc.body;a.start&&(a.start.ctrl?(d=f.createControlRange(),d.addElement(b(a.start.indexes)),d.select()):(d=f.createTextRange(),c(!0),c(),d.select()))},this.addRange=function(b){function c(a){var b,c,g,l,m;g=e.create("a"),b=a?h:j,c=a?i:k,l=d.duplicate(),(b==o||b==o.documentElement)&&(b=p,c=0),3==b.nodeType?(b.parentNode.insertBefore(g,b),l.moveToElementText(g),l.moveStart("character",c),e.remove(g),d.setEndPoint(a?"StartToStart":"EndToEnd",l)):(m=b.childNodes,m.length?(c>=m.length?e.insertAfter(g,m[m.length-1]):b.insertBefore(g,m[c]),l.moveToElementText(g)):b.canHaveHTML&&(b.innerHTML="<span>\ufeff</span>",g=b.firstChild,l.moveToElementText(g),l.collapse(f)),d.setEndPoint(a?"StartToStart":"EndToEnd",l),e.remove(g))}var d,g,h,i,j,k,l,m,n,o=a.dom.doc,p=o.body;if(h=b.startContainer,i=b.startOffset,j=b.endContainer,k=b.endOffset,d=p.createTextRange(),h==j&&1==h.nodeType){if(i==k&&!h.hasChildNodes()){if(h.canHaveHTML)return l=h.previousSibling,l&&!l.hasChildNodes()&&e.isBlock(l)?l.innerHTML="\ufeff":l=null,h.innerHTML="<span>\ufeff</span><span>\ufeff</span>",d.moveToElementText(h.lastChild),d.select(),e.doc.selection.clear(),h.innerHTML="",l&&(l.innerHTML=""),void 0;i=e.nodeIndex(h),h=h.parentNode}if(i==k-1)try{if(n=h.childNodes[i],g=p.createControlRange(),g.addElement(n),g.select(),m=a.getRng(),m.item&&n===m.item(0))return}catch(q){}}c(!0),c(),d.select()},this.getRangeAt=c}tinymce.dom.TridentSelection=a})();
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){a.dom.Element=function(b,c){var d,e,f=this;f.settings=c=c||{},f.id=b,f.dom=d=c.dom||a.DOM,a.isIE||(e=d.get(f.id)),a.each("getPos,getRect,getParent,add,setStyle,getStyle,setStyles,setAttrib,setAttribs,getAttrib,addClass,removeClass,hasClass,getOuterHTML,setOuterHTML,remove,show,hide,isHidden,setHTML,get".split(/,/),function(a){f[a]=function(){var c,e=[b];for(c=0;arguments.length>c;c++)e.push(arguments[c]);return e=d[a].apply(d,e),f.update(a),e}}),a.extend(f,{on:function(b,c,d){return a.dom.Event.add(f.id,b,c,d)},getXY:function(){return{x:parseInt(f.getStyle("left")),y:parseInt(f.getStyle("top"))}},getSize:function(){var a=d.get(f.id);return{w:parseInt(f.getStyle("width")||a.clientWidth),h:parseInt(f.getStyle("height")||a.clientHeight)}},moveTo:function(a,b){f.setStyles({left:a,top:b})},moveBy:function(a,b){var c=f.getXY();f.moveTo(c.x+a,c.y+b)},resizeTo:function(a,b){f.setStyles({width:a,height:b})},resizeBy:function(a,b){var c=f.getSize();f.resizeTo(c.w+a,c.h+b)},update:function(b){var e;if(a.isIE6&&c.blocker){if(b=b||"",0===b.indexOf("get")||0===b.indexOf("has")||0===b.indexOf("is"))return;if("remove"==b)return d.remove(f.blocker),void 0;f.blocker?e=d.get(f.blocker):(f.blocker=d.uniqueId(),e=d.add(c.container||d.getRoot(),"iframe",{id:f.blocker,style:"position:absolute;",frameBorder:0,src:'javascript:""'}),d.setStyle(e,"opacity",0)),d.setStyles(e,{left:f.getStyle("left",1),top:f.getStyle("top",1),width:f.getStyle("width",1),height:f.getStyle("height",1),display:f.getStyle("display",1),zIndex:parseInt(f.getStyle("zIndex",1)||0)-1})}}})}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.is,c=a.isIE,d=a.each,e=a.dom.TreeWalker;a.create("tinymce.dom.Selection",{Selection:function(b,c,e,f){var g=this;g.dom=b,g.win=c,g.serializer=e,g.editor=f,d(["onBeforeSetContent","onBeforeGetContent","onSetContent","onGetContent"],function(b){g[b]=new a.util.Dispatcher(g)}),g.win.getSelection||(g.tridentSel=new a.dom.TridentSelection(g)),a.isIE&&b.boxModel&&this._fixIESelection(),a.addUnload(g.destroy,g)},setCursorLocation:function(a,b){var c=this,d=c.dom.createRng();d.setStart(a,b),d.setEnd(a,b),c.setRng(d),c.collapse(!1)},getContent:function(a){var c,d,e,f=this,g=f.getRng(),h=f.dom.create("body"),i=f.getSel();return a=a||{},c=d="",a.get=!0,a.format=a.format||"html",a.forced_root_block="",f.onBeforeGetContent.dispatch(f,a),"text"==a.format?f.isCollapsed()?"":g.text||(i.toString?i.toString():""):(g.cloneContents?(e=g.cloneContents(),e&&h.appendChild(e)):b(g.item)||b(g.htmlText)?(h.innerHTML="<br>"+(g.item?g.item(0).outerHTML:g.htmlText),h.removeChild(h.firstChild)):h.innerHTML=g.toString(),/^\s/.test(h.innerHTML)&&(c=" "),/\s+$/.test(h.innerHTML)&&(d=" "),a.getInner=!0,a.content=f.isCollapsed()?"":c+f.serializer.serialize(h,a)+d,f.onGetContent.dispatch(f,a),a.content)},setContent:function(a,b){var c,d,e,f=this,g=f.getRng(),h=f.win.document;if(b=b||{format:"html"},b.set=!0,a=b.content=a,b.no_events||f.onBeforeSetContent.dispatch(f,b),a=b.content,g.insertNode){a+='<span id="__caret">_</span>',g.startContainer==h&&g.endContainer==h?h.body.innerHTML=a:(g.deleteContents(),0===h.body.childNodes.length?h.body.innerHTML=a:g.createContextualFragment?g.insertNode(g.createContextualFragment(a)):(d=h.createDocumentFragment(),e=h.createElement("div"),d.appendChild(e),e.outerHTML=a,g.insertNode(d))),c=f.dom.get("__caret"),g=h.createRange(),g.setStartBefore(c),g.setEndBefore(c),f.setRng(g),f.dom.remove("__caret");try{f.setRng(g)}catch(i){}}else g.item&&(h.execCommand("Delete",!1,null),g=f.getRng()),/^\s+/.test(a)?(g.pasteHTML('<span id="__mce_tmp">_</span>'+a),f.dom.remove("__mce_tmp")):g.pasteHTML(a);b.no_events||f.onSetContent.dispatch(f,b)},getStart:function(){var a,b,c,d,e=this,f=e.getRng();if(f.duplicate||f.item){if(f.item)return f.item(0);for(c=f.duplicate(),c.collapse(1),a=c.parentElement(),a.ownerDocument!==e.dom.doc&&(a=e.dom.getRoot()),b=d=f.parentElement();d=d.parentNode;)if(d==a){a=b;break}return a}return a=f.startContainer,1==a.nodeType&&a.hasChildNodes()&&(a=a.childNodes[Math.min(a.childNodes.length-1,f.startOffset)]),a&&3==a.nodeType?a.parentNode:a},getEnd:function(){var a,b,c=this,d=c.getRng();return d.duplicate||d.item?d.item?d.item(0):(d=d.duplicate(),d.collapse(0),a=d.parentElement(),a.ownerDocument!==c.dom.doc&&(a=c.dom.getRoot()),a&&"BODY"==a.nodeName?a.lastChild||a:a):(a=d.endContainer,b=d.endOffset,1==a.nodeType&&a.hasChildNodes()&&(a=a.childNodes[b>0?b-1:b]),a&&3==a.nodeType?a.parentNode:a)},getBookmark:function(a,b){function c(a,b){var c=0;return d(o.select(a),function(a,d){a==b&&(c=d)}),c}function e(a){function b(b){var c,d,e,f=b?"start":"end";c=a[f+"Container"],d=a[f+"Offset"],1==c.nodeType&&"TR"==c.nodeName&&(e=c.childNodes,c=e[Math.min(b?d:d-1,e.length-1)],c&&(d=b?0:c.childNodes.length,a["set"+(b?"Start":"End")](c,d)))}return b(!0),b(),a}function f(){function a(a,c){var e,f,g=a[c?"startContainer":"endContainer"],h=a[c?"startOffset":"endOffset"],i=[],j=0;if(3==g.nodeType){if(b)for(e=g.previousSibling;e&&3==e.nodeType;e=e.previousSibling)h+=e.nodeValue.length;i.push(h)}else f=g.childNodes,h>=f.length&&f.length&&(j=1,h=Math.max(0,f.length-1)),i.push(n.dom.nodeIndex(f[h],b)+j);for(;g&&g!=d;g=g.parentNode)i.push(n.dom.nodeIndex(g,b));return i}var c=n.getRng(!0),d=o.getRoot(),e={};return e.start=a(c,!0),n.isCollapsed()||(e.end=a(c)),e}var g,h,i,j,k,l,m,n=this,o=n.dom,p="\ufeff";if(2==a)return n.tridentSel?n.tridentSel.getBookmark(a):f();if(a)return{rng:n.getRng()};if(g=n.getRng(),i=o.uniqueId(),j=tinyMCE.activeEditor.selection.isCollapsed(),m="overflow:hidden;line-height:0px",g.duplicate||g.item){if(g.item)return l=g.item(0),k=l.nodeName,{name:k,index:c(k,l)};h=g.duplicate();try{g.collapse(),g.pasteHTML('<span data-mce-type="bookmark" id="'+i+'_start" style="'+m+'">'+p+"</span>"),j||(h.collapse(!1),g.moveToElementText(h.parentElement()),0===g.compareEndPoints("StartToEnd",h)&&h.move("character",-1),h.pasteHTML('<span data-mce-type="bookmark" id="'+i+'_end" style="'+m+'">'+p+"</span>"))}catch(q){return null}}else{if(l=n.getNode(),k=l.nodeName,"IMG"==k)return{name:k,index:c(k,l)};h=e(g.cloneRange()),j||(h.collapse(!1),h.insertNode(o.create("span",{"data-mce-type":"bookmark",id:i+"_end",style:m},p))),g=e(g),g.collapse(!0),g.insertNode(o.create("span",{"data-mce-type":"bookmark",id:i+"_start",style:m},p))}return n.moveToBookmark({id:i,keep:1}),{id:i}},moveToBookmark:function(b){function e(a){var c,d,e,f,g=b[a?"start":"end"];if(g){for(e=g[0],d=i,c=g.length-1;c>=1;c--){if(f=d.childNodes,g[c]>f.length-1)return;d=f[g[c]]}3===d.nodeType&&(e=Math.min(g[0],d.nodeValue.length)),1===d.nodeType&&(e=Math.min(g[0],d.childNodes.length)),a?h.setStart(d,e):h.setEnd(d,e)}return!0}function f(c){var e,f,g,h,i=o.get(b.id+"_"+c),n=b.keep;if(i&&(e=i.parentNode,"start"==c?(n?(e=i.firstChild,f=1):f=o.nodeIndex(i),j=k=e,l=m=f):(n?(e=i.firstChild,f=1):f=o.nodeIndex(i),k=e,m=f),!n)){for(h=i.previousSibling,g=i.nextSibling,d(a.grep(i.childNodes),function(a){3==a.nodeType&&(a.nodeValue=a.nodeValue.replace(/\uFEFF/g,""))});i=o.get(b.id+"_"+c);)o.remove(i,1);h&&g&&h.nodeType==g.nodeType&&3==h.nodeType&&!a.isOpera&&(f=h.nodeValue.length,h.appendData(g.nodeValue),o.remove(g),"start"==c?(j=k=h,l=m=f):(k=h,m=f))}}function g(a){return!o.isBlock(a)||a.innerHTML||c||(a.innerHTML='<br data-mce-bogus="1" />'),a}var h,i,j,k,l,m,n=this,o=n.dom;if(b)if(b.start){if(h=o.createRng(),i=o.getRoot(),n.tridentSel)return n.tridentSel.moveToBookmark(b);e(!0)&&e()&&n.setRng(h)}else b.id?(f("start"),f("end"),j&&(h=o.createRng(),h.setStart(g(j),l),h.setEnd(g(k),m),n.setRng(h))):b.name?n.select(o.select(b.name)[b.index]):b.rng&&n.setRng(b.rng)},select:function(b,c){function d(b,c){var d=new e(b,b);do{if(3==b.nodeType&&0!==a.trim(b.nodeValue).length)return c?i.setStart(b,0):i.setEnd(b,b.nodeValue.length),void 0;if("BR"==b.nodeName)return c?i.setStartBefore(b):i.setEndBefore(b),void 0}while(b=c?d.next():d.prev())}var f,g=this,h=g.dom,i=h.createRng();return b&&(f=h.nodeIndex(b),i.setStart(b.parentNode,f),i.setEnd(b.parentNode,f+1),c&&(d(b,1),d(b)),g.setRng(i)),b},isCollapsed:function(){var a=this,b=a.getRng(),c=a.getSel();return!b||b.item?!1:b.compareEndPoints?0===b.compareEndPoints("StartToEnd",b):!c||b.collapsed},collapse:function(a){var b,c=this,d=c.getRng();d.item&&(b=d.item(0),d=c.win.document.body.createTextRange(),d.moveToElementText(b)),d.collapse(!!a),c.setRng(d)},getSel:function(){var a=this.win;return a.getSelection?a.getSelection():a.document.selection},getRng:function(b){var c,d,e,f=this,g=f.win.document;if(b&&f.tridentSel)return f.tridentSel.getRangeAt(0);try{(c=f.getSel())&&(d=c.rangeCount>0?c.getRangeAt(0):c.createRange?c.createRange():g.createRange())}catch(h){}return a.isIE&&d&&d.setStart&&g.selection.createRange().item&&(e=g.selection.createRange().item(0),d=g.createRange(),d.setStartBefore(e),d.setEndAfter(e)),d||(d=g.createRange?g.createRange():g.body.createTextRange()),d.setStart&&9===d.startContainer.nodeType&&d.collapsed&&(e=f.dom.getRoot(),d.setStart(e,0),d.setEnd(e,0)),f.selectedRange&&f.explicitRange&&(0===d.compareBoundaryPoints(d.START_TO_START,f.selectedRange)&&0===d.compareBoundaryPoints(d.END_TO_END,f.selectedRange)?d=f.explicitRange:(f.selectedRange=null,f.explicitRange=null)),d},setRng:function(a,b){var c,d=this;if(d.tridentSel){if(a.cloneRange)try{return d.tridentSel.addRange(a),void 0}catch(e){}try{a.select()}catch(e){}}else if(c=d.getSel()){d.explicitRange=a;try{c.removeAllRanges()}catch(e){}c.addRange(a),b===!1&&c.extend&&(c.collapse(a.endContainer,a.endOffset),c.extend(a.startContainer,a.startOffset)),d.selectedRange=c.rangeCount>0?c.getRangeAt(0):null}},setNode:function(a){var b=this;return b.setContent(b.dom.getOuterHTML(a)),a},getNode:function(){function a(a,b){for(var c=a;a&&3===a.nodeType&&0===a.length;)a=b?a.nextSibling:a.previousSibling;return a||c}var b,c=this,d=c.getRng(),e=(c.getSel(),d.startContainer),f=d.endContainer;return d?d.setStart?(b=d.commonAncestorContainer,!d.collapsed&&(d.startContainer==d.endContainer&&2>d.endOffset-d.startOffset&&d.startContainer.hasChildNodes()&&(b=d.startContainer.childNodes[d.startOffset]),3===e.nodeType&&3===f.nodeType&&(e=e.length===d.startOffset?a(e.nextSibling,!0):e.parentNode,f=0===d.endOffset?a(f.previousSibling,!1):f.parentNode,e&&e===f))?e:b&&3==b.nodeType?b.parentNode:b):d.item?d.item(0):d.parentElement():c.dom.getRoot()},getSelectedBlocks:function(a,b){var c,d,f,g=this,h=g.dom,i=[];if(c=h.getParent(a||g.getStart(),h.isBlock),d=h.getParent(b||g.getEnd(),h.isBlock),c&&i.push(c),c&&d&&c!=d){f=c;for(var j=new e(c,h.getRoot());(f=j.next())&&f!=d;)h.isBlock(f)&&i.push(f)}return d&&c!=d&&i.push(d),i},isForward:function(){var a,b,c=this.dom,d=this.getSel();return d&&null!=d.anchorNode&&null!=d.focusNode?(a=c.createRng(),a.setStart(d.anchorNode,d.anchorOffset),a.collapse(!0),b=c.createRng(),b.setStart(d.focusNode,d.focusOffset),b.collapse(!0),0>=a.compareBoundaryPoints(a.START_TO_START,b)):!0},normalize:function(){function b(a){function b(a,b){for(var c=new e(a,o.getParent(a.parentNode,o.isBlock)||p);a=c[b?"prev":"next"]();)if("BR"===a.nodeName)return!0}function h(a,b){var c,g;for(b=b||i,c=new e(b,o.getParent(b.parentNode,o.isBlock)||p);l=c[a?"prev":"next"]();){if(3===l.nodeType&&l.nodeValue.length>0)return i=l,j=a?l.nodeValue.length:0,d=!0,void 0;if(o.isBlock(l)||m[l.nodeName.toLowerCase()])return;g=l}f&&g&&(i=g,d=!0,j=0)}var i,j,k,l,m,n,o=g.dom,p=o.getRoot();if(i=c[(a?"start":"end")+"Container"],j=c[(a?"start":"end")+"Offset"],m=o.schema.getNonEmptyElements(),9===i.nodeType&&(i=o.getRoot(),j=0),i===p){if(a&&(l=i.childNodes[j>0?j-1:0],l&&(n=l.nodeName.toLowerCase(),m[l.nodeName]||"TABLE"==l.nodeName)))return;if(i.hasChildNodes()&&(i=i.childNodes[Math.min(!a&&j>0?j-1:j,i.childNodes.length-1)],j=0,i.hasChildNodes()&&!/TABLE/.test(i.nodeName))){l=i,k=new e(i,p);do{if(3===l.nodeType&&l.nodeValue.length>0){j=a?0:l.nodeValue.length,i=l,d=!0;break}if(m[l.nodeName.toLowerCase()]){j=o.nodeIndex(l),i=l.parentNode,"IMG"!=l.nodeName||a||j++,d=!0;break}}while(l=a?k.next():k.prev())}}f&&(3===i.nodeType&&0===j&&h(!0),1===i.nodeType&&(l=i.childNodes[j],!l||"BR"!==l.nodeName||b(l)||b(l,!0)||h(!0,i.childNodes[j]))),a&&!f&&3===i.nodeType&&j===i.nodeValue.length&&h(!1),d&&c["set"+(a?"Start":"End")](i,j)}var c,d,f,g=this;a.isIE||(c=g.getRng(),f=c.collapsed,b(!0),f||b(),d&&(f&&c.collapse(!0),g.setRng(c,g.isForward())))},selectorChanged:function(a,b){var c,e=this;return e.selectorChangedData||(e.selectorChangedData={},c={},e.editor.onNodeChange.addToTop(function(a,b,f){var g=e.dom,h=g.getParents(f,null,g.getRoot()),i={};d(e.selectorChangedData,function(a,b){d(h,function(e){return g.is(e,b)?(c[b]||(d(a,function(a){a(!0,{node:e,selector:b,parents:h})}),c[b]=a),i[b]=a,!1):void 0})}),d(c,function(a,b){i[b]||(delete c[b],d(a,function(a){a(!1,{node:f,selector:b,parents:h})}))})})),e.selectorChangedData[a]||(e.selectorChangedData[a]=[]),e.selectorChangedData[a].push(b),e},scrollIntoView:function(a){var b,c,d=this,e=d.dom;c=e.getViewPort(d.editor.getWin()),b=e.getPos(a).y,(c.y>b||b+25>c.y+c.h)&&d.editor.getWin().scrollTo(0,c.y>b?b:b-c.h+25)},destroy:function(b){var c=this;c.win=null,b||a.removeUnload(c.destroy)},_fixIESelection:function(){function a(a,b){var c=i.createTextRange();try{c.moveToPoint(a,b)}catch(d){c=null}return c}function b(b){var d;b.button?(d=a(b.x,b.y),d&&(d.compareEndPoints("StartToStart",e)>0?d.setEndPoint("StartToStart",e):d.setEndPoint("EndToEnd",e),d.select())):c()}function c(){var a=h.selection.createRange();e&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&e.select(),g.unbind(h,"mouseup",c),g.unbind(h,"mousemove",b),e=d=0}var d,e,f,g=this.dom,h=g.doc,i=h.body;h.documentElement.unselectable=!0,g.bind(h,["mousedown","contextmenu"],function(i){if("HTML"===i.target.nodeName){if(d&&c(),f=h.documentElement,f.scrollHeight>f.clientHeight)return;d=1,e=a(i.x,i.y),e&&(g.bind(h,"mouseup",c),g.bind(h,"mousemove",b),g.win.focus(),e.select())}})}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){a.dom.Serializer=function(b,c,d){var e,f,g,h=a.isIE,i=a.each;return b.apply_source_formatting||(b.indent=!1),c=c||a.DOM,d=d||new a.html.Schema(b),b.entity_encoding=b.entity_encoding||"named",b.remove_trailing_brs="remove_trailing_brs"in b?b.remove_trailing_brs:!0,e=new a.util.Dispatcher(self),f=new a.util.Dispatcher(self),g=new a.html.DomParser(b,d),g.addAttributeFilter("src,href,style",function(a,d){for(var e,f,g,h=a.length,i="data-mce-"+d,j=b.url_converter,k=b.url_converter_scope;h--;)e=a[h],f=e.attributes.map[i],f!==g?(e.attr(d,f.length>0?f:null),e.attr(i,null)):(f=e.attributes.map[d],"style"===d?f=c.serializeStyle(c.parseStyle(f),e.name):j&&(f=j.call(k,f,d,e.name)),e.attr(d,f.length>0?f:null))}),g.addAttributeFilter("class",function(a){for(var b,c,d=a.length;d--;)b=a[d],c=b.attr("class").replace(/(?:^|\s)mce(Item\w+|Selected)(?!\S)/g,""),b.attr("class",c.length>0?c:null)}),g.addAttributeFilter("data-mce-type",function(a,b,c){for(var d,e=a.length;e--;)d=a[e],"bookmark"!==d.attributes.map["data-mce-type"]||c.cleanup||d.remove()}),g.addAttributeFilter("data-mce-expando",function(a,b){for(var c=a.length;c--;)a[c].attr(b,null)}),g.addNodeFilter("noscript",function(b){for(var c,d=b.length;d--;)c=b[d].firstChild,c&&(c.value=a.html.Entities.decode(c.value))}),g.addNodeFilter("script,style",function(a,b){function c(a){return a.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}for(var d,e,f=a.length;f--;)d=a[f],e=d.firstChild?d.firstChild.value:"","script"===b?(d.attr("type",(d.attr("type")||"text/javascript").replace(/^mce\-/,"")),e.length>0&&(d.firstChild.value="// <![CDATA[\n"+c(e)+"\n// ]]>")):e.length>0&&(d.firstChild.value="<!--\n"+c(e)+"\n-->")}),g.addNodeFilter("#comment",function(a){for(var b,c=a.length;c--;)b=a[c],0===b.value.indexOf("[CDATA[")?(b.name="#cdata",b.type=4,b.value=b.value.replace(/^\[CDATA\[|\]\]$/g,"")):0===b.value.indexOf("mce:protected ")&&(b.name="#text",b.type=3,b.raw=!0,b.value=unescape(b.value).substr(14))}),g.addNodeFilter("xml:namespace,input",function(a,b){for(var c,d=a.length;d--;)c=a[d],7===c.type?c.remove():1===c.type&&("input"!==b||"type"in c.attributes.map||c.attr("type","text"))}),b.fix_list_elements&&g.addNodeFilter("ul,ol",function(a){for(var b,c,d=a.length;d--;)b=a[d],c=b.parent,("ul"===c.name||"ol"===c.name)&&b.prev&&"li"===b.prev.name&&b.prev.append(b)}),g.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style",function(a,b){for(var c=a.length;c--;)a[c].attr(b,null)}),{schema:d,addNodeFilter:g.addNodeFilter,addAttributeFilter:g.addAttributeFilter,onPreProcess:e,onPostProcess:f,serialize:function(j,k){var l,m,n,o,p;return h&&c.select("script,style,select,map").length>0?(p=j.innerHTML,j=j.cloneNode(!1),c.setHTML(j,p)):j=j.cloneNode(!0),l=j.ownerDocument.implementation,l.createHTMLDocument&&(m=l.createHTMLDocument(""),i("BODY"==j.nodeName?j.childNodes:[j],function(a){m.body.appendChild(m.importNode(a,!0))}),j="BODY"!=j.nodeName?m.body.firstChild:m.body,n=c.doc,c.doc=m),k=k||{},k.format=k.format||"html",k.no_events||(k.node=j,e.dispatch(self,k)),o=new a.html.Serializer(b,d),k.content=o.serialize(g.parse(a.trim(k.getInner?j.innerHTML:c.getOuterHTML(j)),k)),k.cleanup||(k.content=k.content.replace(/\uFEFF/g,"")),k.no_events||f.dispatch(self,k),n&&(c.doc=n),k.node=null,k.content},addRules:function(a){d.addValidElements(a)},setRules:function(a){d.setValidElements(a)}}}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){a.dom.ScriptLoader=function(){function b(b,c){function d(){j.remove(i),f&&(f.onreadystatechange=f.onload=f=null),c()}function e(){"undefined"!=typeof console&&console.log&&console.log("Failed to load: "+b)}var f,g,h,i,j=a.DOM;return i=j.uniqueId(),a.isIE6&&(g=new a.util.URI(b),h=location,g.host==h.hostname&&g.port==h.port&&g.protocol+":"==h.protocol&&"file"!=g.protocol.toLowerCase())?(a.util.XHR.send({url:a._addVer(g.getURI()),success:function(a){var b=j.create("script",{type:"text/javascript"});b.text=a,document.getElementsByTagName("head")[0].appendChild(b),j.remove(b),d()},error:e}),void 0):(f=document.createElement("script"),f.id=i,f.type="text/javascript",f.src=a._addVer(b),a.isIE||(f.onload=d),f.onerror=e,a.isOpera||(f.onreadystatechange=function(){var a=f.readyState;("complete"==a||"loaded"==a)&&d()}),(document.getElementsByTagName("head")[0]||document.body).appendChild(f),void 0)}var c,d=0,e=1,f=2,g={},h=[],i={},j=[],k=0;this.isDone=function(a){return g[a]==f},this.markDone=function(a){g[a]=f},this.add=this.load=function(a,b,e){var f=g[a];f==c&&(h.push(a),g[a]=d),b&&(i[a]||(i[a]=[]),i[a].push({func:b,scope:e||this}))},this.loadQueue=function(a,b){this.loadScripts(h,a,b)},this.loadScripts=function(d,h,l){function m(b){a.each(i[b],function(a){a.func.call(a.scope)}),i[b]=c}var n;j.push({func:h,scope:l||this}),n=function(){var c=a.grep(d);d.length=0,a.each(c,function(a){return g[a]==f?(m(a),void 0):(g[a]!=e&&(g[a]=e,k++,b(a,function(){g[a]=f,k--,m(a),n()})),void 0)}),k||(a.each(j,function(a){a.func.call(a.scope)}),j.length=0)},n()}},a.ScriptLoader=new a.dom.ScriptLoader})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){a.dom.RangeUtils=function(b){this.walk=function(c,d){function e(a){var b;return b=a[0],3===b.nodeType&&b===p&&q>=b.nodeValue.length&&a.splice(0,1),b=a[a.length-1],0===s&&a.length>0&&b===r&&3===b.nodeType&&a.splice(a.length-1,1),a}function f(a,b,c){for(var d=[];a&&a!=c;a=a[b])d.push(a);return d}function g(a,b){do{if(a.parentNode==b)return a;a=a.parentNode}while(a)}function h(a,b,c){var g=c?"nextSibling":"previousSibling";for(l=a,m=l.parentNode;l&&l!=b;l=m)m=l.parentNode,n=f(l==a?l:l[g],g),n.length&&(c||n.reverse(),d(e(n)))}var i,j,k,l,m,n,o,p=c.startContainer,q=c.startOffset,r=c.endContainer,s=c.endOffset;if(o=b.select("td.mceSelected,th.mceSelected"),o.length>0)return a.each(o,function(a){d([a])}),void 0;if(1==p.nodeType&&p.hasChildNodes()&&(p=p.childNodes[q]),1==r.nodeType&&r.hasChildNodes()&&(r=r.childNodes[Math.min(s-1,r.childNodes.length-1)]),p==r)return d(e([p]));for(i=b.findCommonAncestor(p,r),l=p;l;l=l.parentNode){if(l===r)return h(p,i,!0);if(l===i)break}for(l=r;l;l=l.parentNode){if(l===p)return h(r,i);if(l===i)break}j=g(p,i)||p,k=g(r,i)||r,h(p,j,!0),n=f(j==p?j:j.nextSibling,"nextSibling",k==r?k.nextSibling:k),n.length&&d(e(n)),h(r,k)},this.split=function(a){function b(a,b){return a.splitText(b)}var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset;return c==e&&3==c.nodeType?d>0&&c.nodeValue.length>d&&(e=b(c,d),c=e.previousSibling,f>d?(f-=d,c=e=b(e,f).previousSibling,f=e.nodeValue.length,d=0):f=0):(3==c.nodeType&&d>0&&c.nodeValue.length>d&&(c=b(c,d),d=0),3==e.nodeType&&f>0&&e.nodeValue.length>f&&(e=b(e,f).previousSibling,f=e.nodeValue.length)),{startContainer:c,startOffset:d,endContainer:e,endOffset:f}}},a.dom.RangeUtils.compareRanges=function(a,b){if(a&&b){if(!a.item&&!a.duplicate)return a.startContainer==b.startContainer&&a.startOffset==b.startOffset;if(a.item&&b.item&&a.item(0)===b.item(0))return!0;if(a.isEqual&&b.isEqual&&b.isEqual(a))return!0}return!1}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.dom.Event,c=a.each;a.create("tinymce.ui.KeyboardNavigation",{KeyboardNavigation:function(d,e){var f,g,h,i,j,k=this,l=d.root,m=d.items,n=d.enableUpDown,o=d.enableLeftRight||!d.enableUpDown,p=d.excludeFromTabOrder;e=e||a.DOM,f=function(a){j=a.target.id},g=function(a){e.setAttrib(a.target.id,"tabindex","-1")},i=function(){var a=e.get(j);e.setAttrib(a,"tabindex","0"),a.focus()},k.focus=function(){e.get(j).focus()},k.destroy=function(){c(m,function(a){var b=e.get(a.id);e.unbind(b,"focus",f),e.unbind(b,"blur",g)});var a=e.get(l);e.unbind(a,"focus",i),e.unbind(a,"keydown",h),m=e=l=k.focus=f=g=h=i=null,k.destroy=function(){}},k.moveFocus=function(a,f){var g,h=-1;k.controls,j&&(c(m,function(a,b){return a.id===j?(h=b,!1):void 0}),h+=a,0>h?h=m.length-1:h>=m.length&&(h=0),g=m[h],e.setAttrib(j,"tabindex","-1"),e.setAttrib(g.id,"tabindex","0"),e.get(g.id).focus(),d.actOnFocus&&d.onAction(g.id),f&&b.cancel(f))},h=function(a){var c=37,e=39,f=38,g=40,h=27,i=14,l=13,m=32;switch(a.keyCode){case c:o&&k.moveFocus(-1);break;case e:o&&k.moveFocus(1);break;case f:n&&k.moveFocus(-1);break;case g:n&&k.moveFocus(1);break;case h:d.onCancel&&(d.onCancel(),b.cancel(a));break;case i:case l:case m:d.onAction&&(d.onAction(j),b.cancel(a))}},c(m,function(a,b){var c,d;a.id||(a.id=e.uniqueId("_mce_item_")),d=e.get(a.id),p?(e.bind(d,"blur",g),c="-1"):c=0===b?"0":"-1",d.setAttribute("tabindex",c),e.bind(d,"focus",f)}),m[0]&&(j=m[0].id),e.setAttrib(l,"tabindex","-1");var q=e.get(l);e.bind(q,"focus",i),e.bind(q,"keydown",h)}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.DOM,c=a.is;a.create("tinymce.ui.Control",{Control:function(b,c,d){this.id=b,this.settings=c=c||{},this.rendered=!1,this.onRender=new a.util.Dispatcher(this),this.classPrefix="",this.scope=c.scope||this,this.disabled=0,this.active=0,this.editor=d},setAriaProperty:function(a,c){var d=b.get(this.id+"_aria")||b.get(this.id);d&&b.setAttrib(d,"aria-"+a,!!c)},focus:function(){b.get(this.id).focus()},setDisabled:function(a){a!=this.disabled&&(this.setAriaProperty("disabled",a),this.setState("Disabled",a),this.setState("Enabled",!a),this.disabled=a)},isDisabled:function(){return this.disabled},setActive:function(a){a!=this.active&&(this.setState("Active",a),this.active=a,this.setAriaProperty("pressed",a))},isActive:function(){return this.active},setState:function(a,c){var d=b.get(this.id);a=this.classPrefix+a,c?b.addClass(d,a):b.removeClass(d,a)},isRendered:function(){return this.rendered},renderHTML:function(){},renderTo:function(a){b.setHTML(a,this.renderHTML())},postRender:function(){var a,b=this;c(b.disabled)&&(a=b.disabled,b.disabled=-1,b.setDisabled(a)),c(b.active)&&(a=b.active,b.active=-1,b.setActive(a))},remove:function(){b.remove(this.id),this.destroy()},destroy:function(){a.dom.Event.clear(this.id)}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.create("tinymce.ui.Container:tinymce.ui.Control",{Container:function(a,b,c){this.parent(a,b,c),this.controls=[],this.lookup={}},add:function(a){return this.lookup[a.id]=a,this.controls.push(a),a},get:function(a){return this.lookup[a]}});
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.create("tinymce.ui.Separator:tinymce.ui.Control",{Separator:function(a,b){this.parent(a,b),this.classPrefix="mceSeparator",this.setDisabled(!0)},renderHTML:function(){return tinymce.DOM.createHTML("span",{"class":this.classPrefix,role:"separator","aria-orientation":"vertical",tabindex:"-1"})}});
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.is;a.DOM,a.each,a.walk,a.create("tinymce.ui.MenuItem:tinymce.ui.Control",{MenuItem:function(a,b){this.parent(a,b),this.classPrefix="mceMenuItem"},setSelected:function(a){this.setState("Selected",a),this.setAriaProperty("checked",!!a),this.selected=a},isSelected:function(){return this.selected},postRender:function(){var a=this;a.parent(),b(a.selected)&&a.setSelected(a.selected)}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=(a.is,a.DOM),c=(a.each,a.walk);a.create("tinymce.ui.Menu:tinymce.ui.MenuItem",{Menu:function(b,c){var d=this;d.parent(b,c),d.items={},d.collapsed=!1,d.menuCount=0,d.onAddItem=new a.util.Dispatcher(this)},expand:function(a){var b=this;a&&c(b,function(a){a.expand&&a.expand()},"items",b),b.collapsed=!1},collapse:function(a){var b=this;a&&c(b,function(a){a.collapse&&a.collapse()},"items",b),b.collapsed=!0},isCollapsed:function(){return this.collapsed},add:function(c){return c.settings||(c=new a.ui.MenuItem(c.id||b.uniqueId(),c)),this.onAddItem.dispatch(this,c),this.items[c.id]=c},addSeparator:function(){return this.add({separator:!0})},addMenu:function(a){return a.collapse||(a=this.createMenu(a)),this.menuCount++,this.add(a)},hasMenus:function(){return 0!==this.menuCount},remove:function(a){delete this.items[a.id]},removeAll:function(){var a=this;c(a,function(a){a.removeAll?a.removeAll():a.remove(),a.destroy()},"items",a),a.items={}},createMenu:function(c){var d=new a.ui.Menu(c.id||b.uniqueId(),c);return d.onAddItem.add(this.onAddItem.dispatch,this.onAddItem),d}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.is,c=a.DOM,d=a.each,e=a.dom.Event,f=a.dom.Element;a.create("tinymce.ui.DropMenu:tinymce.ui.Menu",{DropMenu:function(d,e){e=e||{},e.container=e.container||c.doc.body,e.offset_x=e.offset_x||0,e.offset_y=e.offset_y||0,e.vp_offset_x=e.vp_offset_x||0,e.vp_offset_y=e.vp_offset_y||0,b(e.icons)&&!e.icons&&(e["class"]+=" mceNoIcons"),this.parent(d,e),this.onShowMenu=new a.util.Dispatcher(this),this.onHideMenu=new a.util.Dispatcher(this),this.classPrefix="mceMenu"},createMenu:function(b){var d,e=this,f=e.settings;return b.container=b.container||f.container,b.parent=e,b.constrain=b.constrain||f.constrain,b["class"]=b["class"]||f["class"],b.vp_offset_x=b.vp_offset_x||f.vp_offset_x,b.vp_offset_y=b.vp_offset_y||f.vp_offset_y,b.keyboard_focus=f.keyboard_focus,d=new a.ui.DropMenu(b.id||c.uniqueId(),b),d.onAddItem.add(e.onAddItem.dispatch,e.onAddItem),d},focus:function(){var a=this;a.keyboardNav&&a.keyboardNav.focus()},update:function(){var a,b,d=this,e=d.settings,f=c.get("menu_"+d.id+"_tbl"),g=c.get("menu_"+d.id+"_co");a=e.max_width?Math.min(f.offsetWidth,e.max_width):f.offsetWidth,b=e.max_height?Math.min(f.offsetHeight,e.max_height):f.offsetHeight,c.boxModel?d.element.setStyles({width:a,height:b}):d.element.setStyles({width:a+2,height:b+2}),e.max_width&&c.setStyle(g,"width",a),e.max_height&&(c.setStyle(g,"height",b),f.clientHeight<e.max_height&&c.setStyle(g,"overflow","hidden"))},showMenu:function(b,g,h){var i,j,k,l,m,n,o=this,p=o.settings,q=c.getViewPort(),r=2,s=o.classPrefix;o.collapse(1),o.isMenuVisible||(o.rendered?i=c.get("menu_"+o.id):(i=c.add(o.settings.container,o.renderNode()),d(o.items,function(a){a.postRender()}),o.element=new f("menu_"+o.id,{blocker:1,container:p.container})),a.isOpera||c.setStyles(i,{left:-65535,top:-65535}),c.show(i),o.update(),b+=p.offset_x||0,g+=p.offset_y||0,q.w-=4,q.h-=4,p.constrain&&(j=i.clientWidth-r,k=i.clientHeight-r,l=q.x+q.w,m=q.y+q.h,b+p.vp_offset_x+j>l&&(b=h?h-j:Math.max(0,l-p.vp_offset_x-j)),g+p.vp_offset_y+k>m&&(g=Math.max(0,m-p.vp_offset_y-k))),c.setStyles(i,{left:b,top:g}),o.element.update(),o.isMenuVisible=1,o.mouseClickFunc=e.add(i,"click",function(a){var b;if(a=a.target,a&&(a=c.getParent(a,"tr"))&&!c.hasClass(a,s+"ItemSub")){if(b=o.items[a.id],b.isDisabled())return;for(n=o;n;)n.hideMenu&&n.hideMenu(),n=n.settings.parent;return b.settings.onclick&&b.settings.onclick(a),!1}}),o.hasMenus()&&(o.mouseOverFunc=e.add(i,"mouseover",function(a){var b,d;if(a=a.target,a&&(a=c.getParent(a,"tr"))){if(b=o.items[a.id],o.lastMenu&&o.lastMenu.collapse(1),b.isDisabled())return;a&&c.hasClass(a,s+"ItemSub")&&(d=c.getRect(a),b.showMenu(d.x+d.w-r,d.y-r,d.x),o.lastMenu=b,c.addClass(c.get(b.id).firstChild,s+"ItemActive"))}})),e.add(i,"keydown",o._keyHandler,o),o.onShowMenu.dispatch(o),p.keyboard_focus&&o._setupKeyboardNav())},hideMenu:function(a){var b,d=this,f=c.get("menu_"+d.id);d.isMenuVisible&&(d.keyboardNav&&d.keyboardNav.destroy(),e.remove(f,"mouseover",d.mouseOverFunc),e.remove(f,"click",d.mouseClickFunc),e.remove(f,"keydown",d._keyHandler),c.hide(f),d.isMenuVisible=0,a||d.collapse(1),d.element&&d.element.hide(),(b=c.get(d.id))&&c.removeClass(b.firstChild,d.classPrefix+"ItemActive"),d.onHideMenu.dispatch(d))},add:function(a){var b,d=this;return a=d.parent(a),d.isRendered&&(b=c.get("menu_"+d.id))&&d._add(c.select("tbody",b)[0],a),a},collapse:function(a){this.parent(a),this.hideMenu(1)},remove:function(a){return c.remove(a.id),this.destroy(),this.parent(a)},destroy:function(){var a=this,b=c.get("menu_"+a.id);a.keyboardNav&&a.keyboardNav.destroy(),e.remove(b,"mouseover",a.mouseOverFunc),e.remove(c.select("a",b),"focus",a.mouseOverFunc),e.remove(b,"click",a.mouseClickFunc),e.remove(b,"keydown",a._keyHandler),a.element&&a.element.remove(),c.remove(b)},renderNode:function(){var a,b,e,g,h=this,i=h.settings;return g=c.create("div",{role:"listbox",id:"menu_"+h.id,"class":i["class"],style:"position:absolute;left:0;top:0;z-index:200000;outline:0"}),h.settings.parent&&c.setAttrib(g,"aria-parent","menu_"+h.settings.parent.id),e=c.add(g,"div",{role:"presentation",id:"menu_"+h.id+"_co","class":h.classPrefix+(i["class"]?" "+i["class"]:"")}),h.element=new f("menu_"+h.id,{blocker:1,container:i.container}),i.menu_line&&c.add(e,"span",{"class":h.classPrefix+"Line"}),a=c.add(e,"table",{role:"presentation",id:"menu_"+h.id+"_tbl",border:0,cellPadding:0,cellSpacing:0}),b=c.add(a,"tbody"),d(h.items,function(a){h._add(b,a)}),h.rendered=!0,g},_setupKeyboardNav:function(){var b,d,e=this;b=c.get("menu_"+e.id),d=c.select("a[role=option]","menu_"+e.id),d.splice(0,0,b),e.keyboardNav=new a.ui.KeyboardNavigation({root:"menu_"+e.id,items:d,onCancel:function(){e.hideMenu()},enableUpDown:!0}),b.focus()},_keyHandler:function(a){var b=this;switch(a.keyCode){case 37:b.settings.parent&&(b.hideMenu(),b.settings.parent.focus(),e.cancel(a));break;case 39:b.mouseOverFunc&&b.mouseOverFunc(a)}},_add:function(a,b){var d,e,f,g,h,i=b.settings,j=this.classPrefix;return i.separator?(f=c.add(a,"tr",{id:b.id,"class":j+"ItemSeparator"}),c.add(f,"td",{"class":j+"ItemSeparator"}),(d=f.previousSibling)&&c.addClass(d,"mceLast"),void 0):(d=f=c.add(a,"tr",{id:b.id,"class":j+"Item "+j+"ItemEnabled"}),d=g=c.add(d,i.titleItem?"th":"td"),d=e=c.add(d,"a",{id:b.id+"_aria",role:i.titleItem?"presentation":"option",href:"javascript:;",onclick:"return false;",onmousedown:"return false;"}),i.parent&&(c.setAttrib(e,"aria-haspopup","true"),c.setAttrib(e,"aria-owns","menu_"+b.id)),c.addClass(g,i["class"]),h=c.add(d,"span",{"class":"mceIcon"+(i.icon?" mce_"+i.icon:"")}),i.icon_src&&c.add(h,"img",{src:i.icon_src}),d=c.add(d,i.element||"span",{"class":"mceText",title:b.settings.title},b.settings.title),b.settings.style&&("function"==typeof b.settings.style&&(b.settings.style=b.settings.style()),c.setAttrib(d,"style",b.settings.style)),1==a.childNodes.length&&c.addClass(f,"mceFirst"),(d=f.previousSibling)&&c.hasClass(d,j+"ItemSeparator")&&c.addClass(f,"mceFirst"),b.collapse&&c.addClass(f,j+"ItemSub"),(d=f.previousSibling)&&c.removeClass(d,"mceLast"),c.addClass(f,"mceLast"),void 0)}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.DOM;a.create("tinymce.ui.Button:tinymce.ui.Control",{Button:function(a,b,c){this.parent(a,b,c),this.classPrefix="mceButton"},renderHTML:function(){var a,c,d=this.classPrefix,e=this.settings;return c=b.encode(e.label||""),a='<a role="button" id="'+this.id+'" href="javascript:;" class="'+d+" "+d+"Enabled "+e["class"]+(c?" "+d+"Labeled":"")+'" onmousedown="return false;" onclick="return false;" aria-labelledby="'+this.id+'_voice" title="'+b.encode(e.title)+'">',a+=!e.image||this.editor&&this.editor.forcedHighContrastMode?'<span class="mceIcon '+e["class"]+'"></span>'+(c?'<span class="'+d+'Label">'+c+"</span>":""):'<span class="mceIcon '+e["class"]+'"><img class="mceIcon" src="'+e.image+'" alt="'+b.encode(e.title)+'" /></span>'+(c?'<span class="'+d+'Label">'+c+"</span>":""),a+='<span class="mceVoiceLabel mceIconOnly" style="display: none;" id="'+this.id+'_voice">'+e.title+"</span>",a+="</a>"},postRender:function(){var b,c=this,d=c.settings;a.isIE&&c.editor&&a.dom.Event.add(c.id,"mousedown",function(){var a=c.editor.selection.getNode().nodeName;b="IMG"===a?c.editor.selection.getBookmark():null}),a.dom.Event.add(c.id,"click",function(e){return c.isDisabled()?void 0:(a.isIE&&c.editor&&null!==b&&c.editor.selection.moveToBookmark(b),d.onclick.call(d.scope,e))}),a.dom.Event.add(c.id,"keyup",function(b){return c.isDisabled()||b.keyCode!=a.VK.SPACEBAR?void 0:d.onclick.call(d.scope,b)})}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b,c=a.DOM,d=a.dom.Event,e=a.each,f=a.util.Dispatcher;a.create("tinymce.ui.ListBox:tinymce.ui.Control",{ListBox:function(b,c,d){var e=this;e.parent(b,c,d),e.items=[],e.onChange=new f(e),e.onPostRender=new f(e),e.onAdd=new f(e),e.onRenderMenu=new a.util.Dispatcher(this),e.classPrefix="mceListBox",e.marked={}},select:function(a){var c,d,f=this;return f.marked={},a==b?f.selectByIndex(-1):(d=a&&"function"==typeof a?a:function(b){return b==a},a!=f.selectedValue&&(e(f.items,function(a,b){return d(a.value)?(c=1,f.selectByIndex(b),!1):void 0}),c||f.selectByIndex(-1)),void 0)},selectByIndex:function(a){var b,d,e,f=this;f.marked={},a!=f.selectedIndex&&(b=c.get(f.id+"_text"),e=c.get(f.id+"_voiceDesc"),d=f.items[a],d?(f.selectedValue=d.value,f.selectedIndex=a,c.setHTML(b,c.encode(d.title)),c.setHTML(e,f.settings.title+" - "+d.title),c.removeClass(b,"mceTitle"),c.setAttrib(f.id,"aria-valuenow",d.title)):(c.setHTML(b,c.encode(f.settings.title)),c.setHTML(e,c.encode(f.settings.title)),c.addClass(b,"mceTitle"),f.selectedValue=f.selectedIndex=null,c.setAttrib(f.id,"aria-valuenow",f.settings.title)),b=0)},mark:function(a){this.marked[a]=!0},add:function(b,c,d){var e=this;d=d||{},d=a.extend(d,{title:b,value:c}),e.items.push(d),e.onAdd.dispatch(e,d)},getLength:function(){return this.items.length},renderHTML:function(){var a="",b=this,d=b.settings,e=b.classPrefix;return a='<span role="listbox" aria-haspopup="true" aria-labelledby="'+b.id+'_voiceDesc" aria-describedby="'+b.id+'_voiceDesc"><table role="presentation" tabindex="0" id="'+b.id+'" cellpadding="0" cellspacing="0" class="'+e+" "+e+"Enabled"+(d["class"]?" "+d["class"]:"")+'"><tbody><tr>',a+="<td>"+c.createHTML("span",{id:b.id+"_voiceDesc","class":"voiceLabel",style:"display:none;"},b.settings.title),a+=c.createHTML("a",{id:b.id+"_text",tabindex:-1,href:"javascript:;","class":"mceText",onclick:"return false;",onmousedown:"return false;"},c.encode(b.settings.title))+"</td>",a+="<td>"+c.createHTML("a",{id:b.id+"_open",tabindex:-1,href:"javascript:;","class":"mceOpen",onclick:"return false;",onmousedown:"return false;"},'<span><span style="display:none;" class="mceIconOnly" aria-hidden="true">\u25bc</span></span>')+"</td>",a+="</tr></tbody></table></span>"},showMenu:function(){var b,f,g=this,h=c.get(this.id);if(!g.isDisabled()&&0!==g.items.length){if(g.menu&&g.menu.isMenuVisible)return g.hideMenu();g.isMenuRendered||(g.renderMenu(),g.isMenuRendered=!0),b=c.getPos(h),f=g.menu,f.settings.offset_x=b.x,f.settings.offset_y=b.y,f.settings.keyboard_focus=!a.isOpera,e(g.items,function(a){f.items[a.id]&&f.items[a.id].setSelected(0)}),e(g.items,function(a){f.items[a.id]&&g.marked[a.value]&&f.items[a.id].setSelected(1),a.value===g.selectedValue&&f.items[a.id].setSelected(1)}),f.showMenu(0,h.clientHeight),d.add(c.doc,"mousedown",g.hideMenu,g),c.addClass(g.id,g.classPrefix+"Selected")}},hideMenu:function(a){var b=this;if(b.menu&&b.menu.isMenuVisible){if(c.removeClass(b.id,b.classPrefix+"Selected"),a&&"mousedown"==a.type&&(a.target.id==b.id+"_text"||a.target.id==b.id+"_open"))return;a&&c.getParent(a.target,".mceMenu")||(c.removeClass(b.id,b.classPrefix+"Selected"),d.remove(c.doc,"mousedown",b.hideMenu,b),b.menu.hideMenu())}},renderMenu:function(){var a,d=this;a=d.settings.control_manager.createDropMenu(d.id+"_menu",{menu_line:1,"class":d.classPrefix+"Menu mceNoIcons",max_width:250,max_height:150}),a.onHideMenu.add(function(){d.hideMenu(),d.focus()}),a.add({title:d.settings.title,"class":"mceMenuItemTitle",onclick:function(){d.settings.onselect("")!==!1&&d.select("")}}),e(d.items,function(e){e.value===b?a.add({title:e.title,role:"option","class":"mceMenuItemTitle",onclick:function(){d.settings.onselect("")!==!1&&d.select("")}}):(e.id=c.uniqueId(),e.role="option",e.onclick=function(){d.settings.onselect(e.value)!==!1&&d.select(e.value)},a.add(e))}),d.onRenderMenu.dispatch(d,a),d.menu=a},postRender:function(){var b=this,e=b.classPrefix;d.add(b.id,"click",b.showMenu,b),d.add(b.id,"keydown",function(a){32==a.keyCode&&(b.showMenu(a),d.cancel(a))}),d.add(b.id,"focus",function(){b._focused||(b.keyDownHandler=d.add(b.id,"keydown",function(a){40==a.keyCode&&(b.showMenu(),d.cancel(a))}),b.keyPressHandler=d.add(b.id,"keypress",function(a){var c;13==a.keyCode&&(c=b.selectedValue,b.selectedValue=null,d.cancel(a),b.settings.onselect(c))})),b._focused=1}),d.add(b.id,"blur",function(){d.remove(b.id,"keydown",b.keyDownHandler),d.remove(b.id,"keypress",b.keyPressHandler),b._focused=0}),(a.isIE6||!c.boxModel)&&(d.add(b.id,"mouseover",function(){c.hasClass(b.id,e+"Disabled")||c.addClass(b.id,e+"Hover")}),d.add(b.id,"mouseout",function(){c.hasClass(b.id,e+"Disabled")||c.removeClass(b.id,e+"Hover")})),b.onPostRender.dispatch(b,c.get(b.id))},destroy:function(){this.parent(),d.clear(this.id+"_text"),d.clear(this.id+"_open")}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b,c=a.DOM,d=a.dom.Event,e=a.each;a.util.Dispatcher,a.create("tinymce.ui.NativeListBox:tinymce.ui.ListBox",{NativeListBox:function(a,b){this.parent(a,b),this.classPrefix="mceNativeListBox"},setDisabled:function(a){c.get(this.id).disabled=a,this.setAriaProperty("disabled",a)},isDisabled:function(){return c.get(this.id).disabled},select:function(a){var c,d,f=this;return a==b?f.selectByIndex(-1):(d=a&&"function"==typeof a?a:function(b){return b==a},a!=f.selectedValue&&(e(f.items,function(a,b){return d(a.value)?(c=1,f.selectByIndex(b),!1):void 0}),c||f.selectByIndex(-1)),void 0)},selectByIndex:function(a){c.get(this.id).selectedIndex=a+1,this.selectedValue=this.items[a]?this.items[a].value:null},add:function(a,b,d){var e,f=this;d=d||{},d.value=b,f.isRendered()&&c.add(c.get(this.id),"option",d,a),e={title:a,value:b,attribs:d},f.items.push(e),f.onAdd.dispatch(f,e)},getLength:function(){return this.items.length},renderHTML:function(){var a,b=this;return a=c.createHTML("option",{value:""},"-- "+b.settings.title+" --"),e(b.items,function(b){a+=c.createHTML("option",{value:b.value},b.title)}),a=c.createHTML("select",{id:b.id,"class":"mceNativeListBox","aria-labelledby":b.id+"_aria"},a),a+=c.createHTML("span",{id:b.id+"_aria",style:"display: none"},b.settings.title)},postRender:function(){function b(a){var b=f.items[a.target.selectedIndex-1];b&&(b=b.value)&&(f.onChange.dispatch(f,b),f.settings.onselect&&f.settings.onselect(b))}var e,f=this,g=!0;f.rendered=!0,d.add(f.id,"change",b),d.add(f.id,"keydown",function(c){var h;return d.remove(f.id,"change",e),g=!1,h=d.add(f.id,"blur",function(){g||(g=!0,d.add(f.id,"change",b),d.remove(f.id,"blur",h))}),!a.isWebKit||37!=c.keyCode&&39!=c.keyCode?13==c.keyCode||32==c.keyCode?(b(c),d.cancel(c)):void 0:d.prevent(c)}),f.onPostRender.dispatch(f,c.get(f.id))}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.DOM,c=a.dom.Event;a.each,a.create("tinymce.ui.MenuButton:tinymce.ui.Button",{MenuButton:function(c,d,e){this.parent(c,d,e),this.onRenderMenu=new a.util.Dispatcher(this),d.menu_container=d.menu_container||b.doc.body},showMenu:function(){var a,d,e,f=this,g=b.get(f.id);if(!f.isDisabled()){if(f.isMenuRendered||(f.renderMenu(),f.isMenuRendered=!0),f.isMenuVisible)return f.hideMenu();a=b.getPos(f.settings.menu_container),d=b.getPos(g),e=f.menu,e.settings.offset_x=d.x,e.settings.offset_y=d.y,e.settings.vp_offset_x=d.x,e.settings.vp_offset_y=d.y,e.settings.keyboard_focus=f._focused,e.showMenu(0,g.firstChild.clientHeight),c.add(b.doc,"mousedown",f.hideMenu,f),f.setState("Selected",1),f.isMenuVisible=1}},renderMenu:function(){var a,b=this;a=b.settings.control_manager.createDropMenu(b.id+"_menu",{menu_line:1,"class":this.classPrefix+"Menu",icons:b.settings.icons}),a.onHideMenu.add(function(){b.hideMenu(),b.focus()}),b.onRenderMenu.dispatch(b,a),b.menu=a},hideMenu:function(a){var d=this;a&&"mousedown"==a.type&&b.getParent(a.target,function(a){return a.id===d.id||a.id===d.id+"_open"})||(a&&b.getParent(a.target,".mceMenu")||(d.setState("Selected",0),c.remove(b.doc,"mousedown",d.hideMenu,d),d.menu&&d.menu.hideMenu()),d.isMenuVisible=0)},postRender:function(){var a=this,b=a.settings;c.add(a.id,"click",function(){a.isDisabled()||(b.onclick&&b.onclick(a.value),a.showMenu())})}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.DOM,c=a.dom.Event;a.each,a.create("tinymce.ui.SplitButton:tinymce.ui.MenuButton",{SplitButton:function(a,b,c){this.parent(a,b,c),this.classPrefix="mceSplitButton"},renderHTML:function(){var a,c,d=this,e=d.settings;return a="<tbody><tr>",c=e.image?b.createHTML("img ",{src:e.image,role:"presentation","class":"mceAction "+e["class"]}):b.createHTML("span",{"class":"mceAction "+e["class"]},""),c+=b.createHTML("span",{"class":"mceVoiceLabel mceIconOnly",id:d.id+"_voice",style:"display:none;"},e.title),a+="<td >"+b.createHTML("a",{role:"button",id:d.id+"_action",tabindex:"-1",href:"javascript:;","class":"mceAction "+e["class"],onclick:"return false;",onmousedown:"return false;",title:e.title},c)+"</td>",c=b.createHTML("span",{"class":"mceOpen "+e["class"]},'<span style="display:none;" class="mceIconOnly" aria-hidden="true">\u25bc</span>'),a+="<td >"+b.createHTML("a",{role:"button",id:d.id+"_open",tabindex:"-1",href:"javascript:;","class":"mceOpen "+e["class"],onclick:"return false;",onmousedown:"return false;",title:e.title},c)+"</td>",a+="</tr></tbody>",a=b.createHTML("table",{role:"presentation","class":"mceSplitButton mceSplitButtonEnabled "+e["class"],cellpadding:"0",cellspacing:"0",title:e.title},a),b.createHTML("div",{id:d.id,role:"button",tabindex:"0","aria-labelledby":d.id+"_voice","aria-haspopup":"true"},a)},postRender:function(){var d,e=this,f=e.settings;f.onclick&&(d=function(a){e.isDisabled()||(f.onclick(e.value),c.cancel(a))},c.add(e.id+"_action","click",d),c.add(e.id,["click","keydown"],function(a){var b=40;32!==a.keyCode&&13!==a.keyCode&&14!==a.keyCode||a.altKey||a.ctrlKey||a.metaKey?("click"===a.type||a.keyCode===b)&&(e.showMenu(),c.cancel(a)):(d(),c.cancel(a))})),c.add(e.id+"_open","click",function(a){e.showMenu(),c.cancel(a)}),c.add([e.id,e.id+"_open"],"focus",function(){e._focused=1}),c.add([e.id,e.id+"_open"],"blur",function(){e._focused=0}),(a.isIE6||!b.boxModel)&&(c.add(e.id,"mouseover",function(){b.hasClass(e.id,"mceSplitButtonDisabled")||b.addClass(e.id,"mceSplitButtonHover")}),c.add(e.id,"mouseout",function(){b.hasClass(e.id,"mceSplitButtonDisabled")||b.removeClass(e.id,"mceSplitButtonHover")}))},destroy:function(){this.parent(),c.clear(this.id+"_action"),c.clear(this.id+"_open"),c.clear(this.id)}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.DOM,c=a.dom.Event,d=a.is,e=a.each;a.create("tinymce.ui.ColorSplitButton:tinymce.ui.SplitButton",{ColorSplitButton:function(b,c,d){var e=this;e.parent(b,c,d),e.settings=c=a.extend({colors:"000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF",grid_width:8,default_color:"#888888"},e.settings),e.onShowMenu=new a.util.Dispatcher(e),e.onHideMenu=new a.util.Dispatcher(e),e.value=c.default_color},showMenu:function(){var d,e,f=this;if(!f.isDisabled()){if(f.isMenuRendered||(f.renderMenu(),f.isMenuRendered=!0),f.isMenuVisible)return f.hideMenu();d=b.get(f.id),b.show(f.id+"_menu"),b.addClass(d,"mceSplitButtonSelected"),e=b.getPos(d),b.setStyles(f.id+"_menu",{left:e.x,top:e.y+d.firstChild.clientHeight,zIndex:2e5}),d=0,c.add(b.doc,"mousedown",f.hideMenu,f),f.onShowMenu.dispatch(f),f._focused&&(f._keyHandler=c.add(f.id+"_menu","keydown",function(a){27==a.keyCode&&f.hideMenu()}),b.select("a",f.id+"_menu")[0].focus()),f.keyboardNav=new a.ui.KeyboardNavigation({root:f.id+"_menu",items:b.select("a",f.id+"_menu"),onCancel:function(){f.hideMenu(),f.focus()}}),f.keyboardNav.focus(),f.isMenuVisible=1}},hideMenu:function(a){var d=this;if(d.isMenuVisible){if(a&&"mousedown"==a.type&&b.getParent(a.target,function(a){return a.id===d.id+"_open"}))return;a&&b.getParent(a.target,".mceSplitButtonMenu")||(b.removeClass(d.id,"mceSplitButtonSelected"),c.remove(b.doc,"mousedown",d.hideMenu,d),c.remove(d.id+"_menu","keydown",d._keyHandler),b.hide(d.id+"_menu")),d.isMenuVisible=0,d.onHideMenu.dispatch(),d.keyboardNav.destroy()}},renderMenu:function(){var f,g,h,i,j,k,l=this,m=0,n=l.settings;return j=b.add(n.menu_container,"div",{role:"listbox",id:l.id+"_menu","class":n.menu_class+" "+n["class"],style:"position:absolute;left:0;top:-1000px;"}),f=b.add(j,"div",{"class":n["class"]+" mceSplitButtonMenu"}),b.add(f,"span",{"class":"mceMenuLine"}),g=b.add(f,"table",{role:"presentation","class":"mceColorSplitMenu"}),h=b.add(g,"tbody"),m=0,e(d(n.colors,"array")?n.colors:n.colors.split(","),function(c){c=c.replace(/^#/,""),m--||(i=b.add(h,"tr"),m=n.grid_width-1),g=b.add(i,"td");var d={href:"javascript:;",style:{backgroundColor:"#"+c},title:l.editor.getLang("colors."+c,c),"data-mce-color":"#"+c};a.isIE||(d.role="option"),g=b.add(g,"a",d),l.editor.forcedHighContrastMode&&(g=b.add(g,"canvas",{width:16,height:16,"aria-hidden":"true"}),g.getContext&&(k=g.getContext("2d"))?(k.fillStyle="#"+c,k.fillRect(0,0,16,16)):b.remove(g))}),n.more_colors_func&&(g=b.add(h,"tr"),g=b.add(g,"td",{colspan:n.grid_width,"class":"mceMoreColors"}),g=b.add(g,"a",{role:"option",id:l.id+"_more",href:"javascript:;",onclick:"return false;","class":"mceMoreColors"},n.more_colors_title),c.add(g,"click",function(a){return n.more_colors_func.call(n.more_colors_scope||this),c.cancel(a)})),b.addClass(f,"mceColorSplitMenu"),c.add(l.id+"_menu","mousedown",function(a){return c.cancel(a)}),c.add(l.id+"_menu","click",function(a){var c;return a=b.getParent(a.target,"a",h),a&&"a"==a.nodeName.toLowerCase()&&(c=a.getAttribute("data-mce-color"))&&l.setColor(c),!1}),j},setColor:function(a){this.displayColor(a),this.hideMenu(),this.settings.onselect(a)},displayColor:function(a){var c=this;b.setStyle(c.id+"_preview","backgroundColor",a),c.value=a},postRender:function(){var a=this,c=a.id;a.parent(),b.add(c+"_action","div",{id:c+"_preview","class":"mceColorPreview"}),b.setStyle(a.id+"_preview","backgroundColor",a.value)},destroy:function(){var a=this;a.parent(),c.clear(a.id+"_menu"),c.clear(a.id+"_more"),b.remove(a.id+"_menu"),a.keyboardNav&&a.keyboardNav.destroy()}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.DOM,c=a.each,d=a.dom.Event;a.create("tinymce.ui.ToolbarGroup:tinymce.ui.Container",{renderHTML:function(){var c=this,d=[],e=c.controls,f=a.each,g=c.settings;return d.push('<div id="'+c.id+'" role="group" aria-labelledby="'+c.id+'_voice">'),d.push("<span role='application'>"),d.push('<span id="'+c.id+'_voice" class="mceVoiceLabel" style="display:none;">'+b.encode(g.name)+"</span>"),f(e,function(a){d.push(a.renderHTML())}),d.push("</span>"),d.push("</div>"),d.join("")},focus:function(){var a=this;b.get(a.id).focus()},postRender:function(){var d=this,e=[];c(d.controls,function(a){c(a.controls,function(a){a.id&&e.push(a)})}),d.keyNav=new a.ui.KeyboardNavigation({root:d.id,items:e,onCancel:function(){a.isWebKit&&b.get(d.editor.id+"_ifr").focus(),d.editor.focus()},excludeFromTabOrder:!d.settings.tab_focus_toolbar})},destroy:function(){var a=this;a.parent(),a.keyNav.destroy(),d.clear(a.id)}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.DOM;a.each,a.create("tinymce.ui.Toolbar:tinymce.ui.Container",{renderHTML:function(){var a,c,d,e,f,g,h=this,i="",j=h.settings;for(g=h.controls,d=0;g.length>d;d++)c=g[d],e=g[d-1],f=g[d+1],0===d&&(a="mceToolbarStart",c.Button?a+=" mceToolbarStartButton":c.SplitButton?a+=" mceToolbarStartSplitButton":c.ListBox&&(a+=" mceToolbarStartListBox"),i+=b.createHTML("td",{"class":a},b.createHTML("span",null,"<!-- IE -->"))),e&&c.ListBox&&(e.Button||e.SplitButton)&&(i+=b.createHTML("td",{"class":"mceToolbarEnd"},b.createHTML("span",null,"<!-- IE -->"))),i+=b.stdMode?'<td style="position: relative">'+c.renderHTML()+"</td>":"<td>"+c.renderHTML()+"</td>",f&&c.ListBox&&(f.Button||f.SplitButton)&&(i+=b.createHTML("td",{"class":"mceToolbarStart"},b.createHTML("span",null,"<!-- IE -->")));return a="mceToolbarEnd",c.Button?a+=" mceToolbarEndButton":c.SplitButton?a+=" mceToolbarEndSplitButton":c.ListBox&&(a+=" mceToolbarEndListBox"),i+=b.createHTML("td",{"class":a},b.createHTML("span",null,"<!-- IE -->")),b.createHTML("table",{id:h.id,"class":"mceToolbar"+(j["class"]?" "+j["class"]:""),cellpadding:"0",cellspacing:"0",align:h.settings.align||"",role:"presentation",tabindex:"-1"},"<tbody><tr>"+i+"</tr></tbody>")}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.util.Dispatcher;a.each,a.create("tinymce.AddOnManager",{AddOnManager:function(){var a=this;a.items=[],a.urls={},a.lookup={},a.onAdd=new b(a)},get:function(a){return this.lookup[a]?this.lookup[a].instance:void 0},dependencies:function(a){var b;return this.lookup[a]&&(b=this.lookup[a].dependencies),b||[]},requireLangPack:function(b){var c=a.settings;c&&c.language&&c.language_load!==!1&&a.ScriptLoader.add(this.urls[b]+"/langs/"+c.language+".js")},add:function(a,b,c){return this.items.push(b),this.lookup[a]={instance:b,dependencies:c},this.onAdd.dispatch(this,a,b),b},createUrl:function(a,b){return"object"==typeof b?b:{prefix:a.prefix,resource:b,suffix:a.suffix}},addComponents:function(b,c){var d=this.urls[b];a.each(c,function(b){a.ScriptLoader.add(d+"/"+b)})},load:function(b,c,d,e){function f(){var f=g.dependencies(b);a.each(f,function(a){var b=g.createUrl(c,a);g.load(b.resource,b,void 0,void 0)}),d&&(e?d.call(e):d.call(a.ScriptLoader))}var g=this,h=c;g.urls[b]||("object"==typeof c&&(h=c.prefix+c.resource+c.suffix),0!==h.indexOf("/")&&-1==h.indexOf("://")&&(h=a.baseURL+"/"+h),g.urls[b]=h.substring(0,h.lastIndexOf("/")),g.lookup[b]?f():a.ScriptLoader.add(h,f,e))}}),a.PluginManager=new a.AddOnManager,a.ThemeManager=new a.AddOnManager})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b,c=a.each,d=a.extend,e=a.DOM,f=a.dom.Event,g=(a.ThemeManager,a.PluginManager,a.explode),h=a.util.Dispatcher,i=0;a.documentBaseURL=window.location.href.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(a.documentBaseURL)||(a.documentBaseURL+="/"),a.baseURL=new a.util.URI(a.documentBaseURL).toAbsolute(a.baseURL),a.baseURI=new a.util.URI(a.baseURL),a.onBeforeUnload=new h(a),f.add(window,"beforeunload",function(b){a.onBeforeUnload.dispatch(a,b)}),a.onAddEditor=new h(a),a.onRemoveEditor=new h(a),a.EditorManager=d(a,{editors:[],i18n:{},activeEditor:null,init:function(b){function d(a){var b=a.id;return b||(b=a.name,b=b&&!e.get(b)?a.name:e.uniqueId(),a.setAttribute("id",b)),b}function h(b,c,d){var e=b[c];if(e)return a.is(e,"string")&&(d=e.replace(/\.\w+$/,""),d=d?a.resolve(d):0,e=a.resolve(e)),e.apply(d||this,Array.prototype.slice.call(arguments,2))}function j(a,b){return b.constructor===RegExp?b.test(a.className):e.hasClass(a,b)}var k,l=this,m=(a.ScriptLoader,[]);l.settings=b,f.bind(window,"ready",function(){var f,l;switch(h(b,"onpageload"),b.mode){case"exact":f=b.elements||"",f.length>0&&c(g(f),function(d){e.get(d)?(k=new a.Editor(d,b),m.push(k),k.render(1)):c(document.forms,function(f){c(f.elements,function(c){c.name===d&&(d="mce_editor_"+i++,e.setAttrib(c,"id",d),k=new a.Editor(d,b),m.push(k),k.render(1))})})});break;case"textareas":case"specific_textareas":c(e.select("textarea"),function(c){b.editor_deselector&&j(c,b.editor_deselector)||(!b.editor_selector||j(c,b.editor_selector))&&(k=new a.Editor(d(c),b),m.push(k),k.render(1))});break;default:b.types?c(b.types,function(f){c(e.select(f.selector),function(c){var e=new a.Editor(d(c),a.extend({},b,f));m.push(e),e.render(1)})}):b.selector&&c(e.select(b.selector),function(c){var e=new a.Editor(d(c),b);m.push(e),e.render(1)})}b.oninit&&(f=l=0,c(m,function(a){l++,a.initialized?f++:a.onInit.add(function(){f++,f==l&&h(b,"oninit")}),f==l&&h(b,"oninit")}))})},get:function(a){return a===b?this.editors:this.editors.hasOwnProperty(a)?this.editors[a]:b},getInstanceById:function(a){return this.get(a)},add:function(b){var c=this,d=c.editors;return d[b.id]=b,d.push(b),c._setActive(b),c.onAddEditor.dispatch(c,b),a.adapter&&a.adapter.patchEditor(b),b},remove:function(a){var b,c=this,d=c.editors;if(!d[a.id])return null;for(delete d[a.id],b=0;d.length>b;b++)if(d[b]==a){d.splice(b,1);break}return c.activeEditor==a&&c._setActive(d[0]),a.destroy(),c.onRemoveEditor.dispatch(c,a),a},execCommand:function(b,c,d){function e(){h.destroy(),f.detachEvent("onunload",e),f=f.tinyMCE=f.tinymce=null}var f,g=this,h=g.get(d);switch(b){case"mceFocus":return h.focus(),!0;case"mceAddEditor":case"mceAddControl":return g.get(d)||new a.Editor(d,g.settings).render(),!0;case"mceAddFrameControl":return f=d.window,f.tinyMCE=tinyMCE,f.tinymce=a,a.DOM.doc=f.document,a.DOM.win=f,h=new a.Editor(d.element_id,d),h.render(),a.isIE&&f.attachEvent("onunload",e),d.page_window=null,!0;case"mceRemoveEditor":case"mceRemoveControl":return h&&h.remove(),!0;case"mceToggleEditor":return h?(h.isHidden()?h.show():h.hide(),!0):(g.execCommand("mceAddControl",0,d),!0)}return g.activeEditor?g.activeEditor.execCommand(b,c,d):!1},execInstanceCommand:function(a,b,c,d){var e=this.get(a);return e?e.execCommand(b,c,d):!1},triggerSave:function(){c(this.editors,function(a){a.save()})},addI18n:function(b,d){var e=this.i18n;a.is(b,"string")?c(d,function(a,c){e[b+"."+c]=a}):c(b,function(a,b){c(a,function(a,d){c(a,function(a,c){"common"===d?e[b+"."+c]=a:e[b+"."+d+"."+c]=a})})})},_setActive:function(a){this.selectedInstance=this.activeEditor=a}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.DOM,c=a.dom.Event,d=a.extend,e=a.each,f=a.isGecko,g=a.isIE,h=(a.isWebKit,a.is),i=a.ThemeManager,j=a.PluginManager,k=a.explode;a.create("tinymce.Editor",{Editor:function(b,c){var e=this,f=!0;e.settings=c=d({id:b,language:"en",theme:"advanced",skin:"default",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:a.documentBaseURL,add_form_submit_trigger:f,submit_patch:f,add_unload_trigger:f,convert_urls:f,relative_urls:f,remove_script_host:f,table_inline_editing:!1,object_resizing:f,accessibility_focus:f,doctype:a.isIE6?'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">':"<!DOCTYPE>",visual:f,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",apply_source_formatting:f,directionality:"ltr",forced_root_block:"p",hidden_input:f,padd_empty_editor:f,render_ui:f,indentation:"30px",fix_table_elements:f,inline_styles:f,convert_fonts_to_spans:f,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist",validate:f,entity_encoding:"named",url_converter:e.convertURL,url_converter_scope:e,ie7_compat:f},c),e.id=e.editorId=b,e.isNotDirty=!1,e.plugins={},e.documentBaseURI=new a.util.URI(c.document_base_url||a.documentBaseURL,{base_uri:tinyMCE.baseURI}),e.baseURI=a.baseURI,e.contentCSS=[],e.contentStyles=[],e.setupEvents(),e.execCommands={},e.queryStateCommands={},e.queryValueCommands={},e.execCallback("setup",e)},render:function(){function d(){g.language&&g.language_load!==!1&&l.add(a.baseURL+"/langs/"+g.language+".js"),g.theme&&"function"!=typeof g.theme&&"-"!=g.theme.charAt(0)&&!i.urls[g.theme]&&i.load(g.theme,"themes/"+g.theme+"/editor_template"+a.suffix+".js"),e(k(g.plugins),function(b){if(b&&!j.urls[b])if("-"==b.charAt(0)){b=b.substr(1,b.length);var c=j.dependencies(b);e(c,function(b){var c={prefix:"plugins/",resource:b,suffix:"/editor_plugin"+a.suffix+".js"};b=j.createUrl(c,b),j.load(b.resource,b)})}else{if("safari"==b)return;j.load(b,{prefix:"plugins/",resource:b,suffix:"/editor_plugin"+a.suffix+".js"})}}),l.loadQueue(function(){f.removed||f.init()})}var f=this,g=f.settings,h=f.id,l=a.ScriptLoader;return c.domLoaded?(tinyMCE.settings=g,f.getElement()&&(!a.isIDevice||a.isIOS5)&&(!/TEXTAREA|INPUT/i.test(f.getElement().nodeName)&&g.hidden_input&&b.getParent(h,"form")&&b.insertAfter(b.create("input",{type:"hidden",name:h}),h),g.content_editable||(f.orgVisibility=f.getElement().style.visibility,f.getElement().style.visibility="hidden"),a.WindowManager&&(f.windowManager=new a.WindowManager(f)),"xml"==g.encoding&&f.onGetContent.add(function(a,c){c.save&&(c.content=b.encode(c.content))}),g.add_form_submit_trigger&&f.onSubmit.addToTop(function(){f.initialized&&(f.save(),f.isNotDirty=1)}),g.add_unload_trigger&&(f._beforeUnload=tinyMCE.onBeforeUnload.add(function(){!f.initialized||f.destroyed||f.isHidden()||f.save({format:"raw",no_events:!0})})),a.addUnload(f.destroy,f),g.submit_patch&&f.onBeforeRenderUI.add(function(){var b=f.getElement().form;b&&(b._mceOldSubmit||(b.submit.nodeType||b.submit.length||(f.formElement=b,b._mceOldSubmit=b.submit,b.submit=function(){return a.triggerSave(),f.isNotDirty=1,f.formElement._mceOldSubmit(f.formElement)}),b=null))}),d()),void 0):(c.add(window,"ready",function(){f.render()}),void 0)},init:function(){function c(b){var d,f=j.get(b),g=j.urls[b]||a.documentBaseURL.replace(/\/$/,"");f&&-1===a.inArray(v,b)&&(e(j.dependencies(b),function(a){c(a)}),d=new f(s,g),s.plugins[b]=d,d.init&&(d.init(s,g),v.push(b)))}var d,f,h,l,m,n,o,p,q,r,s=this,t=s.settings,u=s.getElement(),v=[];if(a.add(s),t.aria_label=t.aria_label||b.getAttrib(u,"aria-label",s.getLang("aria.rich_text_area")),t.theme&&("function"!=typeof t.theme?(t.theme=t.theme.replace(/-/,""),m=i.get(t.theme),s.theme=new m,s.theme.init&&s.theme.init(s,i.urls[t.theme]||a.documentBaseURL.replace(/\/$/,""))):s.theme=t.theme),e(k(t.plugins.replace(/\-/g,"")),c),t.popup_css!==!1&&(t.popup_css=t.popup_css?s.documentBaseURI.toAbsolute(t.popup_css):s.baseURI.toAbsolute("themes/"+t.theme+"/skins/"+t.skin+"/dialog.css")),t.popup_css_add&&(t.popup_css+=","+s.documentBaseURI.toAbsolute(t.popup_css_add)),s.controlManager=new a.ControlManager(s),s.onBeforeRenderUI.dispatch(s,s.controlManager),t.render_ui&&s.theme&&(s.orgDisplay=u.style.display,"function"!=typeof t.theme?(f=t.width||u.style.width||u.offsetWidth,h=t.height||u.style.height||u.offsetHeight,l=t.min_height||100,q=/^[0-9\.]+(|px)$/i,q.test(""+f)&&(f=Math.max(parseInt(f,10)+(m.deltaWidth||0),100)),q.test(""+h)&&(h=Math.max(parseInt(h,10)+(m.deltaHeight||0),l)),m=s.theme.renderUI({targetNode:u,width:f,height:h,deltaWidth:t.delta_width,deltaHeight:t.delta_height}),b.setStyles(m.sizeContainer||m.editorContainer,{width:f,height:h}),h=(m.iframeHeight||h)+("number"==typeof h?m.deltaHeight||0:""),l>h&&(h=l)):(m=t.theme(s,u),m.editorContainer.nodeType&&(m.editorContainer=m.editorContainer.id=m.editorContainer.id||s.id+"_parent"),m.iframeContainer.nodeType&&(m.iframeContainer=m.iframeContainer.id=m.iframeContainer.id||s.id+"_iframecontainer"),h=m.iframeHeight||u.offsetHeight,g&&s.onInit.add(function(a){a.dom.bind(a.getBody(),"beforedeactivate keydown",function(){a.lastIERng=a.selection.getRng()})})),s.editorContainer=m.editorContainer),t.content_css&&e(k(t.content_css),function(a){s.contentCSS.push(s.documentBaseURI.toAbsolute(a))}),t.content_style&&s.contentStyles.push(t.content_style),t.content_editable)return u=d=m=null,s.initContentBody();for(document.domain&&location.hostname!=document.domain&&(a.relaxedDomain=document.domain),s.iframeHTML=t.doctype+'<html><head xmlns="http://www.w3.org/1999/xhtml">',t.document_base_url!=a.documentBaseURL&&(s.iframeHTML+='<base href="'+s.documentBaseURI.getURI()+'" />'),a.isIE8&&(s.iframeHTML+=t.ie7_compat?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':'<meta http-equiv="X-UA-Compatible" content="IE=edge" />'),s.iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',r=0;s.contentCSS.length>r;r++)s.iframeHTML+='<link type="text/css" rel="stylesheet" href="'+s.contentCSS[r]+'" />';s.contentCSS=[],o=t.body_id||"tinymce",-1!=o.indexOf("=")&&(o=s.getParam("body_id","","hash"),o=o[s.id]||o),p=t.body_class||"",-1!=p.indexOf("=")&&(p=s.getParam("body_class","","hash"),p=p[s.id]||""),s.iframeHTML+='</head><body id="'+o+'" class="mceContentBody '+p+'" onload="window.parent.tinyMCE.get(\''+s.id+"').onLoad.dispatch();\"><br></body></html>",a.relaxedDomain&&(g||a.isOpera&&11>parseFloat(opera.version()))&&(n='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinyMCE.get("'+s.id+'");document.write(ed.iframeHTML);document.close();ed.initContentBody();})()'),d=b.add(m.iframeContainer,"iframe",{id:s.id+"_ifr",src:n||'javascript:""',frameBorder:"0",allowTransparency:"true",title:t.aria_label,style:{width:"100%",height:h,display:"block"}}),s.contentAreaContainer=m.iframeContainer,m.editorContainer&&(b.get(m.editorContainer).style.display=s.orgDisplay),u.style.visibility=s.orgVisibility,b.get(s.id).style.display="none",b.setAttrib(s.id,"aria-hidden",!0),a.relaxedDomain&&n||s.initContentBody(),u=d=m=null},initContentBody:function(){var c,d,f=this,h=f.settings,i=b.get(f.id),j=f.getDoc();g&&a.relaxedDomain||h.content_editable||(j.open(),j.write(f.iframeHTML),j.close(),a.relaxedDomain&&(j.domain=a.relaxedDomain)),h.content_editable&&(b.addClass(i,"mceContentBody"),f.contentDocument=j=h.content_document||document,f.contentWindow=h.content_window||window,f.bodyElement=i,h.content_document=h.content_window=null),c=f.getBody(),c.disabled=!0,h.readonly||(c.contentEditable=f.getParam("content_editable_state",!0)),c.disabled=!1,f.schema=new a.html.Schema(h),f.dom=new a.dom.DOMUtils(j,{keep_values:!0,url_converter:f.convertURL,url_converter_scope:f,hex_colors:h.force_hex_style_colors,class_filter:h.class_filter,update_styles:!0,root_element:h.content_editable?f.id:null,schema:f.schema}),f.parser=new a.html.DomParser(h,f.schema),f.parser.addAttributeFilter("src,href,style",function(a,b){for(var c,d,e,g=a.length,h=f.dom;g--;)c=a[g],d=c.attr(b),e="data-mce-"+b,c.attributes.map[e]||("style"===b?c.attr(e,h.serializeStyle(h.parseStyle(d),c.name)):c.attr(e,f.convertURL(d,b,c.name)))}),f.parser.addNodeFilter("script",function(a){for(var b,c=a.length;c--;)b=a[c],b.attr("type","mce-"+(b.attr("type")||"text/javascript"))}),f.parser.addNodeFilter("#cdata",function(a){for(var b,c=a.length;c--;)b=a[c],b.type=8,b.name="#comment",b.value="[CDATA["+b.value+"]]"}),f.parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(b){for(var c,d=b.length,e=f.schema.getNonEmptyElements();d--;)c=b[d],c.isEmpty(e)&&(c.empty().append(new a.html.Node("br",1)).shortEnded=!0)}),f.serializer=new a.dom.Serializer(h,f.dom,f.schema),f.selection=new a.dom.Selection(f.dom,f.getWin(),f.serializer,f),f.formatter=new a.Formatter(f),f.undoManager=new a.UndoManager(f),f.forceBlocks=new a.ForceBlocks(f),f.enterKey=new a.EnterKey(f),f.editorCommands=new a.EditorCommands(f),f.onExecCommand.add(function(a,b){/^(FontName|FontSize)$/.test(b)||f.nodeChanged()}),f.serializer.onPreProcess.add(function(a,b){return f.onPreProcess.dispatch(f,b,a)}),f.serializer.onPostProcess.add(function(a,b){return f.onPostProcess.dispatch(f,b,a)}),f.onPreInit.dispatch(f),h.browser_spellcheck||h.gecko_spellcheck||(j.body.spellcheck=!1),f.bindNativeEvents(),f.controlManager.onPostRender.dispatch(f,f.controlManager),f.onPostRender.dispatch(f),f.quirks=a.util.Quirks(f),h.directionality&&(c.dir=h.directionality),h.nowrap&&(c.style.whiteSpace="nowrap"),h.protect&&f.onBeforeSetContent.add(function(a,b){e(h.protect,function(a){b.content=b.content.replace(a,function(a){return"<!--mce:protected "+escape(a)+"-->"})})}),f.onSetContent.add(function(){f.addVisual(f.getBody())}),h.padd_empty_editor&&f.onPostProcess.add(function(a,b){b.content=b.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")}),f.load({initial:!0,format:"html"}),f.startContent=f.getContent({format:"raw"}),f.initialized=!0,f.onInit.dispatch(f),f.execCallback("setupcontent_callback",f.id,c,j),f.execCallback("init_instance_callback",f),f.focus(!0),f.nodeChanged({initial:!0}),f.contentStyles.length>0&&(d="",e(f.contentStyles,function(a){d+=a+"\r\n"}),f.dom.addStyle(d)),e(f.contentCSS,function(a){f.dom.loadCSS(a)}),h.auto_focus&&setTimeout(function(){var b=a.get(h.auto_focus);b.selection.select(b.getBody(),1),b.selection.collapse(1),b.getBody().focus(),b.getWin().focus()},100),i=j=c=null},focus:function(b){var c,d,e,f,g=this,h=g.selection,i=g.settings.content_editable,j=g.getDoc();b||(g.lastIERng&&h.setRng(g.lastIERng),d=h.getRng(),d.item&&(e=d.item(0)),g._refreshContentEditable(),i||g.getWin().focus(),(a.isGecko||i)&&(f=g.getBody(),f.setActive?f.setActive():f.focus(),i&&h.normalize()),e&&e.ownerDocument==j&&(d=j.body.createControlRange(),d.addElement(e),d.select())),a.activeEditor!=g&&(null!=(c=a.activeEditor)&&c.onDeactivate.dispatch(c,g),g.onActivate.dispatch(g,c)),a._setActive(g)},execCallback:function(b){var c,d=this,e=d.settings[b];if(e)return d.callbackLookup&&(c=d.callbackLookup[b])&&(e=c.func,c=c.scope),h(e,"string")&&(c=e.replace(/\.\w+$/,""),c=c?a.resolve(c):0,e=a.resolve(e),d.callbackLookup=d.callbackLookup||{},d.callbackLookup[b]={func:e,scope:c}),e.apply(c||d,Array.prototype.slice.call(arguments,1))},translate:function(b){var c=this.settings.language||"en",d=a.i18n;return b?d[c+"."+b]||b.replace(/\{\#([^\}]+)\}/g,function(a,b){return d[c+"."+b]||"{#"+b+"}"}):""},getLang:function(b,c){return a.i18n[(this.settings.language||"en")+"."+b]||(h(c)?c:"{#"+b+"}")},getParam:function(b,c,d){var f,g=a.trim,i=h(this.settings[b])?this.settings[b]:c;return"hash"===d?(f={},h(i,"string")?e(i.indexOf("=")>0?i.split(/[;,](?![^=;,]*(?:[;,]|$))/):i.split(","),function(a){a=a.split("="),f[g(a[0])]=a.length>1?g(a[1]):g(a)}):f=i,f):i},nodeChanged:function(a){var b,c=this,d=c.selection;c.initialized&&(a=a||{},b=d.getStart()||c.getBody(),b=g&&b.ownerDocument!=c.getDoc()?c.getBody():b,a.parents=[],c.dom.getParent(b,function(b){return"BODY"==b.nodeName?!0:(a.parents.push(b),void 0)}),c.onNodeChange.dispatch(c,a?a.controlManager||c.controlManager:c.controlManager,b,d.isCollapsed(),a))},addButton:function(a,b){var c=this;c.buttons=c.buttons||{},c.buttons[a]=b},addCommand:function(a,b,c){this.execCommands[a]={func:b,scope:c||this}},addQueryStateHandler:function(a,b,c){this.queryStateCommands[a]={func:b,scope:c||this}},addQueryValueHandler:function(a,b,c){this.queryValueCommands[a]={func:b,scope:c||this}},addShortcut:function(a,b,c,d){var f,g=this;return g.settings.custom_shortcuts===!1?!1:(g.shortcuts=g.shortcuts||{},h(c,"string")&&(f=c,c=function(){g.execCommand(f,!1,null)}),h(c,"object")&&(f=c,c=function(){g.execCommand(f[0],f[1],f[2])}),e(k(a),function(a){var f={func:c,scope:d||this,desc:g.translate(b),alt:!1,ctrl:!1,shift:!1};e(k(a,"+"),function(a){switch(a){case"alt":case"ctrl":case"shift":f[a]=!0;break;default:f.charCode=a.charCodeAt(0),f.keyCode=a.toUpperCase().charCodeAt(0)}}),g.shortcuts[(f.ctrl?"ctrl":"")+","+(f.alt?"alt":"")+","+(f.shift?"shift":"")+","+f.keyCode]=f}),!0)},execCommand:function(a,b,c,f){var g,h,i=this,j=0;return/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint|SelectAll)$/.test(a)||f&&f.skip_focus||i.focus(),f=d({},f),i.onBeforeExecCommand.dispatch(i,a,b,c,f),f.terminate?!1:i.execCallback("execcommand_callback",i.id,i.selection.getNode(),a,b,c)?(i.onExecCommand.dispatch(i,a,b,c,f),!0):(g=i.execCommands[a])&&(h=g.func.call(g.scope,b,c),h!==!0)?(i.onExecCommand.dispatch(i,a,b,c,f),h):(e(i.plugins,function(d){return d.execCommand&&d.execCommand(a,b,c)?(i.onExecCommand.dispatch(i,a,b,c,f),j=1,!1):void 0}),j?!0:i.theme&&i.theme.execCommand&&i.theme.execCommand(a,b,c)?(i.onExecCommand.dispatch(i,a,b,c,f),!0):i.editorCommands.execCommand(a,b,c)?(i.onExecCommand.dispatch(i,a,b,c,f),!0):(i.getDoc().execCommand(a,b,c),i.onExecCommand.dispatch(i,a,b,c,f),void 0))},queryCommandState:function(a){var b,c,d=this;if(!d._isHidden()){if((b=d.queryStateCommands[a])&&(c=b.func.call(b.scope),c!==!0))return c;if(b=d.editorCommands.queryCommandState(a),-1!==b)return b;try{return this.getDoc().queryCommandState(a)}catch(e){}}},queryCommandValue:function(a){var b,c,d=this;if(!d._isHidden()){if((b=d.queryValueCommands[a])&&(c=b.func.call(b.scope),c!==!0))return c;if(b=d.editorCommands.queryCommandValue(a),h(b))return b;try{return this.getDoc().queryCommandValue(a)}catch(e){}}},show:function(){var a=this;b.show(a.getContainer()),b.hide(a.id),a.load()},hide:function(){var a=this,c=a.getDoc();g&&c&&c.execCommand("SelectAll"),a.save(),b.hide(a.getContainer()),b.setStyle(a.id,"display",a.orgDisplay)},isHidden:function(){return!b.isHidden(this.id)},setProgressState:function(a,b,c){return this.onSetProgressState.dispatch(this,a,b,c),a},load:function(a){var b,c=this,d=c.getElement();return d?(a=a||{},a.load=!0,b=c.setContent(h(d.value)?d.value:d.innerHTML,a),a.element=d,a.no_events||c.onLoadContent.dispatch(c,a),a.element=d=null,b):void 0},save:function(a){var c,d,f=this,g=f.getElement();if(g&&f.initialized)return a=a||{},a.save=!0,a.element=g,c=a.content=f.getContent(a),a.no_events||f.onSaveContent.dispatch(f,a),c=a.content,/TEXTAREA|INPUT/i.test(g.nodeName)?g.value=c:(g.innerHTML=c,(d=b.getParent(f.id,"form"))&&e(d.elements,function(a){return a.name==f.id?(a.value=c,!1):void 0})),a.element=g=null,c},setContent:function(b,c){var d,e=this,f=e.getBody();return c=c||{},c.format=c.format||"html",c.set=!0,c.content=b,c.no_events||e.onBeforeSetContent.dispatch(e,c),b=c.content,a.isIE||0!==b.length&&!/^\s+$/.test(b)?("raw"!==c.format&&(b=new a.html.Serializer({},e.schema).serialize(e.parser.parse(b))),c.content=a.trim(b),e.dom.setHTML(f,c.content),c.no_events||e.onSetContent.dispatch(e,c),e.settings.content_editable&&document.activeElement!==e.getBody()||e.selection.normalize(),c.content):(d=e.settings.forced_root_block,b=d?"<"+d+'><br data-mce-bogus="1"></'+d+">":'<br data-mce-bogus="1">',f.innerHTML=b,e.selection.select(f,!0),e.selection.collapse(!0),void 0)},getContent:function(b){var c,d=this,e=d.getBody();return b=b||{},b.format=b.format||"html",b.get=!0,b.getInner=!0,b.no_events||d.onBeforeGetContent.dispatch(d,b),c="raw"==b.format?e.innerHTML:"text"==b.format?e.innerText||e.textContent:d.serializer.serialize(e,b),b.content="text"!=b.format?a.trim(c):c,b.no_events||d.onGetContent.dispatch(d,b),b.content},isDirty:function(){var b=this;return a.trim(b.startContent)!=a.trim(b.getContent({format:"raw",no_events:1}))&&!b.isNotDirty},clearDirty:function(){this.startContent=this.getContent({format:"raw",no_events:1})},getContainer:function(){var a=this;return a.container||(a.container=b.get(a.editorContainer||a.id+"_parent")),a.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return b.get(this.settings.content_element||this.id)},getWin:function(){var a,c=this;return c.contentWindow||(a=b.get(c.id+"_ifr"),a&&(c.contentWindow=a.contentWindow)),c.contentWindow},getDoc:function(){var a,b=this;return b.contentDocument||(a=b.getWin(),a&&(b.contentDocument=a.document)),b.contentDocument},getBody:function(){return this.bodyElement||this.getDoc().body},convertURL:function(a,b,c){var d=this,e=d.settings;return e.urlconverter_callback?d.execCallback("urlconverter_callback",a,c,!0,b):!e.convert_urls||c&&"LINK"==c.nodeName||0===a.indexOf("file:")?a:e.relative_urls?d.documentBaseURI.toRelative(a):a=d.documentBaseURI.toAbsolute(a,e.remove_script_host)},addVisual:function(a){var b,c=this,d=c.settings,f=c.dom;a=a||c.getBody(),h(c.hasVisual)||(c.hasVisual=d.visual),e(f.select("table,a",a),function(a){var e;switch(a.nodeName){case"TABLE":return b=d.visual_table_class||"mceItemTable",e=f.getAttrib(a,"border"),e&&"0"!=e||(c.hasVisual?f.addClass(a,b):f.removeClass(a,b)),void 0;case"A":return f.getAttrib(a,"href",!1)||(e=f.getAttrib(a,"name")||a.id,b="mceItemAnchor",e&&(c.hasVisual?f.addClass(a,b):f.removeClass(a,b))),void 0}}),c.onVisualAid.dispatch(c,a,c.hasVisual)},remove:function(){var d=this,e=d.getContainer(),f=d.getDoc();d.removed||(d.removed=1,g&&f&&f.execCommand("SelectAll"),d.save(),b.setStyle(d.id,"display",d.orgDisplay),d.settings.content_editable||(c.unbind(d.getWin()),c.unbind(d.getDoc())),c.unbind(d.getBody()),c.clear(e),d.execCallback("remove_instance_callback",d),d.onRemove.dispatch(d),d.onExecCommand.listeners=[],a.remove(d),b.remove(e))},destroy:function(b){var d=this;d.destroyed||(f&&(c.unbind(d.getDoc()),c.unbind(d.getWin()),c.unbind(d.getBody())),b||(a.removeUnload(d.destroy),tinyMCE.onBeforeUnload.remove(d._beforeUnload),d.theme&&d.theme.destroy&&d.theme.destroy(),d.controlManager.destroy(),d.selection.destroy(),d.dom.destroy()),d.formElement&&(d.formElement.submit=d.formElement._mceOldSubmit,d.formElement._mceOldSubmit=null),d.contentAreaContainer=d.formElement=d.container=d.settings.content_element=d.bodyElement=d.contentDocument=d.contentWindow=null,d.selection&&(d.selection=d.selection.win=d.selection.dom=d.selection.dom.doc=null),d.destroyed=1)},_refreshContentEditable:function(){var a,b,c=this;c._isHidden()&&(a=c.getBody(),b=a.parentNode,b.removeChild(a),b.appendChild(a),a.focus())},_isHidden:function(){var a;return f?(a=this.selection.getSel(),!a||!a.rangeCount||0===a.rangeCount):0}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.each;a.Editor.prototype.setupEvents=function(){var c=this,d=c.settings;b(["onPreInit","onBeforeRenderUI","onPostRender","onLoad","onInit","onRemove","onActivate","onDeactivate","onClick","onEvent","onMouseUp","onMouseDown","onDblClick","onKeyDown","onKeyUp","onKeyPress","onContextMenu","onSubmit","onReset","onPaste","onPreProcess","onPostProcess","onBeforeSetContent","onBeforeGetContent","onSetContent","onGetContent","onLoadContent","onSaveContent","onNodeChange","onChange","onBeforeExecCommand","onExecCommand","onUndo","onRedo","onVisualAid","onSetProgressState","onSetAttrib"],function(b){c[b]=new a.util.Dispatcher(c)}),d.cleanup_callback&&(c.onBeforeSetContent.add(function(a,b){b.content=a.execCallback("cleanup_callback","insert_to_editor",b.content,b)}),c.onPreProcess.add(function(a,b){b.set&&a.execCallback("cleanup_callback","insert_to_editor_dom",b.node,b),b.get&&a.execCallback("cleanup_callback","get_from_editor_dom",b.node,b)}),c.onPostProcess.add(function(a,b){b.set&&(b.content=a.execCallback("cleanup_callback","insert_to_editor",b.content,b)),b.get&&(b.content=a.execCallback("cleanup_callback","get_from_editor",b.content,b))})),d.save_callback&&c.onGetContent.add(function(a,b){b.save&&(b.content=a.execCallback("save_callback",a.id,b.content,a.getBody()))}),d.handle_event_callback&&c.onEvent.add(function(a,b,d){c.execCallback("handle_event_callback",b,a,d)===!1&&(b.preventDefault(),b.stopPropagation())}),d.handle_node_change_callback&&c.onNodeChange.add(function(a,b,c){a.execCallback("handle_node_change_callback",a.id,c,-1,-1,!0,a.selection.isCollapsed())}),d.save_callback&&c.onSaveContent.add(function(a,b){var c=a.execCallback("save_callback",a.id,b.content,a.getBody());c&&(b.content=c)}),d.onchange_callback&&c.onChange.add(function(a,b){a.execCallback("onchange_callback",a,b)})},a.Editor.prototype.bindNativeEvents=function(){function c(a,b){a.type,h.removed||h.onEvent.dispatch(h,a,b)!==!1&&h[g[a.fakeType||a.type]].dispatch(h,a,b)}function d(){h.focus(!0)}function e(b,c){65==c.keyCode&&a.VK.metaKeyPressed(c)||h.selection.normalize(),h.nodeChanged()}function f(c,d){(c.altKey||c.ctrlKey||c.metaKey)&&b(h.shortcuts,function(b){var e=a.isMac?c.metaKey:c.ctrlKey;if(b.ctrl==e&&b.alt==c.altKey&&b.shift==c.shiftKey)return c.keyCode==b.keyCode||c.charCode&&c.charCode==b.charCode?(c.preventDefault(),d&&b.func.call(b.scope),!0):void 0})}var g,h=this,i=h.settings,j=h.dom;g={mouseup:"onMouseUp",mousedown:"onMouseDown",click:"onClick",keyup:"onKeyUp",keydown:"onKeyDown",keypress:"onKeyPress",submit:"onSubmit",reset:"onReset",contextmenu:"onContextMenu",dblclick:"onDblClick",paste:"onPaste"},b(g,function(b,d){var e=i.content_editable?h.getBody():h.getDoc();switch(d){case"contextmenu":j.bind(e,d,c);break;case"paste":j.bind(h.getBody(),d,c);break;case"submit":case"reset":j.bind(h.getElement().form||a.DOM.getParent(h.id,"form"),d,c);break;default:j.bind(e,d,c)}}),j.bind(i.content_editable?h.getBody():a.isGecko?h.getDoc():h.getWin(),"focus",function(){h.focus(!0)}),i.content_editable&&a.isOpera&&(j.bind(h.getBody(),"click",d),j.bind(h.getBody(),"keydown",d)),h.onMouseUp.add(e),h.onKeyUp.add(function(b,c){var d=c.keyCode;(d>=33&&36>=d||d>=37&&40>=d||13==d||45==d||46==d||8==d||a.isMac&&(91==d||93==d)||c.ctrlKey)&&e(b,c)}),h.onReset.add(function(){h.setContent(h.startContent,{format:"raw"})}),h.onKeyUp.add(function(a,b){f(b)}),h.onKeyPress.add(function(a,b){f(b)}),h.onKeyDown.add(function(a,b){f(b,!0)}),a.isOpera&&h.onClick.add(function(a,b){b.preventDefault()})}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b,c=a.each,d=!0,e=!1;a.EditorCommands=function(f){function g(a,b,c){var f;return a=a.toLowerCase(),(f=s.exec[a])?(f(a,b,c),d):e}function h(a){var b;return a=a.toLowerCase(),(b=s.state[a])?b(a):-1}function i(a){var b;return a=a.toLowerCase(),(b=s.value[a])?b(a):e}function j(a,b){b=b||"exec",c(a,function(a,d){c(d.toLowerCase().split(","),function(c){s[b][c]=a})})}function k(a,c,d){return c===b&&(c=e),d===b&&(d=null),f.getDoc().execCommand(a,c,d)}function l(a){return u.match(a)}function m(a,c){u.toggle(a,c?{value:c}:b)}function n(a){p=r.getBookmark(a)}function o(){r.moveToBookmark(p)}var p,q=f.dom,r=f.selection,s={state:{},exec:{},value:{}},t=f.settings,u=f.formatter;a.extend(this,{execCommand:g,queryCommandState:h,queryCommandValue:i,addCommands:j}),j({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){f.undoManager.add()},"Cut,Copy,Paste":function(b){var c,e=f.getDoc();try{k(b)}catch(g){c=d}(c||!e.queryCommandSupported(b))&&(a.isGecko?f.windowManager.confirm(f.getLang("clipboard_msg"),function(a){a&&open("http://www.mozilla.org/editor/midasdemo/securityprefs.html","_blank")}):f.windowManager.alert(f.getLang("clipboard_no_support")))},unlink:function(a){r.isCollapsed()&&r.select(r.getNode()),k(a),r.collapse(e)},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(a){var b=a.substring(7);c("left,center,right,full".split(","),function(a){b!=a&&u.remove("align"+a)}),m("align"+b),g("mceRepaint")},"InsertUnorderedList,InsertOrderedList":function(a){var b,c;k(a),b=q.getParent(r.getNode(),"ol,ul"),b&&(c=b.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(c.nodeName)&&(n(),q.split(c,b),o()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(a){m(a)},"ForeColor,HiliteColor,FontName":function(a,b,c){m(a,c)},FontSize:function(b,c,d){var e,f;d>=1&&7>=d&&(f=a.explode(t.font_size_style_values),e=a.explode(t.font_size_classes),d=e?e[d-1]||d:f[d-1]||d),m(b,d)},RemoveFormat:function(a){u.remove(a)},mceBlockQuote:function(){m("blockquote")},FormatBlock:function(a,b,c){return m(c||"p")},mceCleanup:function(){var a=r.getBookmark();f.setContent(f.getContent({cleanup:d}),{cleanup:d}),r.moveToBookmark(a)},mceRemoveNode:function(a,b,c){var e=c||r.getNode();e!=f.getBody()&&(n(),f.dom.remove(e,d),o())},mceSelectNodeDepth:function(a,b,c){var d=0;q.getParent(r.getNode(),function(a){return 1==a.nodeType&&d++==c?(r.select(a),e):void 0},f.getBody())},mceSelectNode:function(a,b,c){r.select(c)},mceInsertContent:function(b,c,d){var e,g,h,i,j,k,l,m,n,o,p,s,t,u;if(e=f.parser,g=new a.html.Serializer({},f.schema),t='<span id="mce_marker" data-mce-type="bookmark">\ufeff</span>',k={content:d,format:"html"},r.onBeforeSetContent.dispatch(r,k),d=k.content,-1==d.indexOf("{$caret}")&&(d+="{$caret}"),d=d.replace(/\{\$caret\}/,t),r.isCollapsed()||f.getDoc().execCommand("Delete",!1,null),h=r.getNode(),k={context:h.nodeName.toLowerCase()},j=e.parse(d,k),p=j.lastChild,"mce_marker"==p.attr("id"))for(l=p,p=p.prev;p;p=p.walk(!0))if(3==p.type||!q.isBlock(p.name)){p.parent.insert(l,p,"br"===p.name);break}if(k.invalid){for(r.setContent(t),h=r.getNode(),i=f.getBody(),9==h.nodeType?h=p=i:p=h;p!==i;)h=p,p=p.parentNode;d=h==i?i.innerHTML:q.getOuterHTML(h),d=g.serialize(e.parse(d.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return g.serialize(j)}))),h==i?q.setHTML(i,d):q.setOuterHTML(h,d)}else d=g.serialize(j),p=h.firstChild,s=h.lastChild,!p||p===s&&"BR"===p.nodeName?q.setHTML(h,d):r.setContent(d);l=q.get("mce_marker"),m=q.getRect(l),n=q.getViewPort(f.getWin()),(m.y+m.h>n.y+n.h||m.y<n.y||m.x>n.x+n.w||m.x<n.x)&&(u=a.isIE?f.getDoc().documentElement:f.getBody(),u.scrollLeft=m.x,u.scrollTop=m.y-n.h+25),o=q.createRng(),p=l.previousSibling,p&&3==p.nodeType?o.setStart(p,p.nodeValue.length):(o.setStartBefore(l),o.setEndBefore(l)),q.remove(l),r.setRng(o),r.onSetContent.dispatch(r,k),f.addVisual()},mceInsertRawHTML:function(a,b,c){r.setContent("tiny_mce_marker"),f.setContent(f.getContent().replace(/tiny_mce_marker/g,function(){return c}))},mceToggleFormat:function(a,b,c){m(c)},mceSetContent:function(a,b,c){f.setContent(c)},"Indent,Outdent":function(a){var b,d,e;b=t.indentation,d=/[a-z%]+$/i.exec(b),b=parseInt(b),h("InsertUnorderedList")||h("InsertOrderedList")?k(a):(t.forced_root_block||q.getParent(r.getNode(),q.isBlock)||u.apply("div"),c(r.getSelectedBlocks(),function(c){"outdent"==a?(e=Math.max(0,parseInt(c.style.paddingLeft||0)-b),q.setStyle(c,"paddingLeft",e?e+d:"")):q.setStyle(c,"paddingLeft",parseInt(c.style.paddingLeft||0)+b+d)}))},mceRepaint:function(){if(a.isGecko)try{n(d),r.getSel()&&r.getSel().selectAllChildren(f.getBody()),r.collapse(d),o()}catch(b){}},mceToggleFormat:function(a,b,c){u.toggle(c)},InsertHorizontalRule:function(){f.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){f.hasVisual=!f.hasVisual,f.addVisual()},mceReplaceContent:function(a,b,c){f.execCommand("mceInsertContent",!1,c.replace(/\{\$selection\}/g,r.getContent({format:"text"})))},mceInsertLink:function(a,b,c){var d;"string"==typeof c&&(c={href:c}),d=q.getParent(r.getNode(),"a"),c.href=c.href.replace(" ","%20"),d&&c.href||u.remove("link"),c.href&&u.apply("link",c,d)},selectAll:function(){var a=q.getRoot(),b=q.createRng();r.getRng().setStart?(b.setStart(a,0),b.setEnd(a,a.childNodes.length),r.setRng(b)):k("SelectAll")}}),j({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(b){var c="align"+b.substring(7),e=r.isCollapsed()?[q.getParent(r.getNode(),q.isBlock)]:r.getSelectedBlocks(),f=a.map(e,function(a){return!!u.matchNode(a,c)});return-1!==a.inArray(f,d)},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(a){return l(a)},mceBlockQuote:function(){return l("blockquote")},Outdent:function(){var a;if(t.inline_styles){if((a=q.getParent(r.getStart(),q.isBlock))&&parseInt(a.style.paddingLeft)>0)return d;if((a=q.getParent(r.getEnd(),q.isBlock))&&parseInt(a.style.paddingLeft)>0)return d}return h("InsertUnorderedList")||h("InsertOrderedList")||!t.inline_styles&&!!q.getParent(r.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(a){var b=q.getParent(r.getNode(),"ul,ol");return b&&("insertunorderedlist"===a&&"UL"===b.tagName||"insertorderedlist"===a&&"OL"===b.tagName)}},"state"),j({"FontSize,FontName":function(a){var b,c=0;return(b=q.getParent(r.getNode(),"span"))&&(c="fontsize"==a?b.style.fontSize:b.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()),c}},"value"),j({Undo:function(){f.undoManager.undo()},Redo:function(){f.undoManager.redo()}})}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.util.Dispatcher;a.UndoManager=function(c){function d(){return a.trim(c.getContent({format:"raw",no_events:1}).replace(/<span[^>]+data-mce-bogus[^>]+>[\u200B\uFEFF]+<\/span>/g,""))}function e(){f.typing=!1,f.add()}var f,g,h,i,j,k=0,l=[];return onBeforeAdd=new b(f),h=new b(f),i=new b(f),j=new b(f),h.add(function(a,b){return a.hasUndo()?c.onChange.dispatch(c,b,a):void 0}),i.add(function(a,b){return c.onUndo.dispatch(c,b,a)}),j.add(function(a,b){return c.onRedo.dispatch(c,b,a)}),c.onInit.add(function(){f.add()}),c.onBeforeExecCommand.add(function(a,b,c,d,e){"Undo"==b||"Redo"==b||"mceRepaint"==b||e&&e.skip_undo||f.beforeChange()}),c.onExecCommand.add(function(a,b,c,d,e){"Undo"==b||"Redo"==b||"mceRepaint"==b||e&&e.skip_undo||f.add()}),c.onSaveContent.add(e),c.dom.bind(c.dom.getRoot(),"dragend",e),c.dom.bind(c.getBody(),"focusout",function(){!c.removed&&f.typing&&e()}),c.onKeyUp.add(function(a,b){var c=b.keyCode;(c>=33&&36>=c||c>=37&&40>=c||45==c||13==c||b.ctrlKey)&&e()}),c.onKeyDown.add(function(a,b){var c=b.keyCode;return c>=33&&36>=c||c>=37&&40>=c||45==c?(f.typing&&e(),void 0):((16>c||c>20)&&224!=c&&91!=c&&!f.typing&&(f.beforeChange(),f.typing=!0,f.add()),void 0)}),c.onMouseDown.add(function(){f.typing&&e()}),c.addShortcut("ctrl+z","undo_desc","Undo"),c.addShortcut("ctrl+y","redo_desc","Redo"),f={data:l,typing:!1,onBeforeAdd:onBeforeAdd,onAdd:h,onUndo:i,onRedo:j,beforeChange:function(){g=c.selection.getBookmark(2,!0)},add:function(a){var b,e,h=c.settings;if(a=a||{},a.content=d(),f.onBeforeAdd.dispatch(f,a),e=l[k],e&&e.content==a.content)return null;if(l[k]&&(l[k].beforeBookmark=g),h.custom_undo_redo_levels&&l.length>h.custom_undo_redo_levels){for(b=0;l.length-1>b;b++)l[b]=l[b+1];l.length--,k=l.length}return a.bookmark=c.selection.getBookmark(2,!0),l.length-1>k&&(l.length=k+1),l.push(a),k=l.length-1,f.onAdd.dispatch(f,a),c.isNotDirty=0,a},undo:function(){var a;return f.typing&&(f.add(),f.typing=!1),k>0&&(a=l[--k],c.setContent(a.content,{format:"raw"}),c.selection.moveToBookmark(a.beforeBookmark),f.onUndo.dispatch(f,a)),a},redo:function(){var a;return l.length-1>k&&(a=l[++k],c.setContent(a.content,{format:"raw"}),c.selection.moveToBookmark(a.bookmark),f.onRedo.dispatch(f,a)),a},clear:function(){l=[],k=0,f.typing=!1},hasUndo:function(){return k>0||this.typing},hasRedo:function(){return l.length-1>k&&!this.typing}}}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.ForceBlocks=function(a){function b(){var b,g,h,i,j,k,l,m,n,o=e.getStart(),p=a.getBody(),q=-16777215;if(o&&1===o.nodeType&&c.forced_root_block){for(;o&&o!=p;){if(f[o.nodeName])return;o=o.parentNode}for(b=e.getRng(),b.setStart?(g=b.startContainer,h=b.startOffset,i=b.endContainer,j=b.endOffset):(b.item&&(o=b.item(0),b=a.getDoc().body.createTextRange(),b.moveToElementText(o)),n=b.parentElement().ownerDocument===a.getDoc(),tmpRng=b.duplicate(),tmpRng.collapse(!0),h=-1*tmpRng.move("character",q),tmpRng.collapsed||(tmpRng=b.duplicate(),tmpRng.collapse(!1),j=-1*tmpRng.move("character",q)-h)),o=p.firstChild;o;)if(3===o.nodeType||1==o.nodeType&&!f[o.nodeName]){if(3===o.nodeType&&0==o.nodeValue.length){l=o,o=o.nextSibling,d.remove(l);continue}k||(k=d.create(c.forced_root_block),o.parentNode.insertBefore(k,o),m=!0),l=o,o=o.nextSibling,k.appendChild(l)}else k=null,o=o.nextSibling;if(m){if(b.setStart)b.setStart(g,h),b.setEnd(i,j),e.setRng(b);else if(n)try{b=a.getDoc().body.createTextRange(),b.moveToElementText(p),b.collapse(!0),b.moveStart("character",h),j>0&&b.moveEnd("character",j),b.select()}catch(r){}a.nodeChanged()}}}var c=a.settings,d=a.dom,e=a.selection,f=a.schema.getBlockElements();c.forced_root_block&&(a.onKeyUp.add(b),a.onNodeChange.add(b))};
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=(a.DOM,a.dom.Event),c=a.each,d=a.extend;a.create("tinymce.ControlManager",{ControlManager:function(b,d){var e=this;d=d||{},e.editor=b,e.controls={},e.onAdd=new a.util.Dispatcher(e),e.onPostRender=new a.util.Dispatcher(e),e.prefix=d.prefix||b.id+"_",e._cls={},e.onPostRender.add(function(){c(e.controls,function(a){a.postRender()})})},get:function(a){return this.controls[this.prefix+a]||this.controls[a]},setActive:function(a,b){var c=null;return(c=this.get(a))&&c.setActive(b),c},setDisabled:function(a,b){var c=null;return(c=this.get(a))&&c.setDisabled(b),c},add:function(a){var b=this;return a&&(b.controls[a.id]=a,b.onAdd.dispatch(a,b)),a},createControl:function(a){var b,d,e,f,g=this,h=g.editor;for(g.controlFactories||(g.controlFactories=[],c(h.plugins,function(a){a.createControl&&g.controlFactories.push(a)})),f=g.controlFactories,d=0,e=f.length;e>d;d++)if(b=f[d].createControl(a,g))return g.add(b);return"|"===a||"separator"===a?g.createSeparator():h.buttons&&(b=h.buttons[a])?g.createButton(a,b):g.add(b)},createDropMenu:function(b,c,e){var f,g,h,i,j=this,k=j.editor;return c=d({"class":"mceDropDown",constrain:k.settings.constrain_menus},c),c["class"]=c["class"]+" "+k.getParam("skin")+"Skin",(h=k.getParam("skin_variant"))&&(c["class"]+=" "+k.getParam("skin")+"Skin"+h.substring(0,1).toUpperCase()+h.substring(1)),c["class"]+="rtl"==k.settings.directionality?" mceRtl":"",b=j.prefix+b,i=e||j._cls.dropmenu||a.ui.DropMenu,f=j.controls[b]=new i(b,c),f.onAddItem.add(function(a,b){var c=b.settings;c.title=k.getLang(c.title,c.title),c.onclick||(c.onclick=function(){c.cmd&&k.execCommand(c.cmd,c.ui||!1,c.value)})}),k.onRemove.add(function(){f.destroy()}),a.isIE&&(f.onShowMenu.add(function(){k.focus(),g=k.selection.getBookmark(1)}),f.onHideMenu.add(function(){g&&(k.selection.moveToBookmark(g),g=0)})),j.add(f)},createListBox:function(c,e,f){function g(b){return b.settings.use_accessible_selects&&!a.isGecko}var h,i,j=this,k=j.editor;return j.get(c)?null:(e.title=k.translate(e.title),e.scope=e.scope||k,e.onselect||(e.onselect=function(a){k.execCommand(e.cmd,e.ui||!1,a||e.value)}),e=d({title:e.title,"class":"mce_"+c,scope:e.scope,control_manager:j},e),c=j.prefix+c,k.settings.use_native_selects||g(k)?h=new a.ui.NativeListBox(c,e):(i=f||j._cls.listbox||a.ui.ListBox,h=new i(c,e,k)),j.controls[c]=h,a.isWebKit&&h.onPostRender.add(function(a,c){b.add(c,"mousedown",function(){k.bookmark=k.selection.getBookmark(1)}),b.add(c,"focus",function(){k.selection.moveToBookmark(k.bookmark),k.bookmark=null})}),h.hideMenu&&k.onMouseDown.add(h.hideMenu,h),j.add(h))},createButton:function(b,c,e){var f,g,h=this,i=h.editor;return h.get(b)?null:(c.title=i.translate(c.title),c.label=i.translate(c.label),c.scope=c.scope||i,c.onclick||c.menu_button||(c.onclick=function(){i.execCommand(c.cmd,c.ui||!1,c.value)}),c=d({title:c.title,"class":"mce_"+b,unavailable_prefix:i.getLang("unavailable",""),scope:c.scope,control_manager:h},c),b=h.prefix+b,c.menu_button?(g=e||h._cls.menubutton||a.ui.MenuButton,f=new g(b,c,i),i.onMouseDown.add(f.hideMenu,f)):(g=h._cls.button||a.ui.Button,f=new g(b,c,i)),h.add(f))},createMenuButton:function(a,b,c){return b=b||{},b.menu_button=1,this.createButton(a,b,c)},createSplitButton:function(b,c,e){var f,g,h=this,i=h.editor;return h.get(b)?null:(c.title=i.translate(c.title),c.scope=c.scope||i,c.onclick||(c.onclick=function(a){i.execCommand(c.cmd,c.ui||!1,a||c.value)}),c.onselect||(c.onselect=function(a){i.execCommand(c.cmd,c.ui||!1,a||c.value)}),c=d({title:c.title,"class":"mce_"+b,scope:c.scope,control_manager:h},c),b=h.prefix+b,g=e||h._cls.splitbutton||a.ui.SplitButton,f=h.add(new g(b,c,i)),i.onMouseDown.add(f.hideMenu,f),f)},createColorSplitButton:function(b,c,e){var f,g,h,i=this,j=i.editor;return i.get(b)?null:(c.title=j.translate(c.title),c.scope=c.scope||j,c.onclick||(c.onclick=function(b){a.isIE&&(h=j.selection.getBookmark(1)),j.execCommand(c.cmd,c.ui||!1,b||c.value)}),c.onselect||(c.onselect=function(a){j.execCommand(c.cmd,c.ui||!1,a||c.value)}),c=d({title:c.title,"class":"mce_"+b,menu_class:j.getParam("skin")+"Skin",scope:c.scope,more_colors_title:j.getLang("more_colors")},c),b=i.prefix+b,g=e||i._cls.colorsplitbutton||a.ui.ColorSplitButton,f=new g(b,c,j),j.onMouseDown.add(f.hideMenu,f),j.onRemove.add(function(){f.destroy()}),a.isIE&&(f.onShowMenu.add(function(){j.focus(),h=j.selection.getBookmark(1)}),f.onHideMenu.add(function(){h&&(j.selection.moveToBookmark(h),h=0)})),i.add(f))},createToolbar:function(b,c,d){var e,f,g=this;return b=g.prefix+b,f=d||g._cls.toolbar||a.ui.Toolbar,e=new f(b,c,g.editor),g.get(b)?null:g.add(e)},createToolbarGroup:function(b,c,d){var e,f,g=this;return b=g.prefix+b,f=d||this._cls.toolbarGroup||a.ui.ToolbarGroup,e=new f(b,c,g.editor),g.get(b)?null:g.add(e)},createSeparator:function(b){var c=b||this._cls.separator||a.ui.Separator;return new c},setControlType:function(a,b){return this._cls[a.toLowerCase()]=b},destroy:function(){c(this.controls,function(a){a.destroy()}),this.controls=null}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.util.Dispatcher,c=a.each,d=a.isIE,e=a.isOpera;a.create("tinymce.WindowManager",{WindowManager:function(a){var c=this;c.editor=a,c.onOpen=new b(c),c.onClose=new b(c),c.params={},c.features={}},open:function(b,f){var g,h,i,j,k=this,l="",m="modal"==k.editor.settings.dialog_type,n=a.DOM.getViewPort();b=b||{},f=f||{},h=e?n.w:screen.width,i=e?n.h:screen.height,b.name=b.name||"mc_"+(new Date).getTime(),b.width=parseInt(b.width||320),b.height=parseInt(b.height||240),b.resizable=!0,b.left=b.left||parseInt(h/2)-b.width/2,b.top=b.top||parseInt(i/2)-b.height/2,f.inline=!1,f.mce_width=b.width,f.mce_height=b.height,f.mce_auto_focus=b.auto_focus,m&&d&&(b.center=!0,b.help=!1,b.dialogWidth=b.width+"px",b.dialogHeight=b.height+"px",b.scroll=b.scrollbars||!1),c(b,function(b,c){a.is(b,"boolean")&&(b=b?"yes":"no"),/^(name|url)$/.test(c)||(l+=d&&m?(l?";":"")+c+":"+b:(l?",":"")+c+"="+b)}),k.features=b,k.params=f,k.onOpen.dispatch(k,b,f),j=b.url||b.file,j=a._addVer(j);try{d&&m?(g=1,window.showModalDialog(j,window,l)):g=window.open(j,b.name,l)}catch(o){}g||alert(k.editor.getLang("popup_blocked"))},close:function(a){a.close(),this.onClose.dispatch(this)},createInstance:function(b,c,d,e,f,g){var h=a.resolve(b);return new h(c,d,e,f,g)},confirm:function(a,b,c,d){d=d||window,b.call(c||this,d.confirm(this._decode(this.editor.getLang(a,a))))},alert:function(a,b,c,d){var e=this;d=d||window,d.alert(e._decode(e.editor.getLang(a,a))),b&&b.call(c||e)},resizeBy:function(a,b,c){c.resizeBy(a,b)},_decode:function(b){return a.DOM.decode(b).replace(/\\n/g,"\n")}})})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){a.Formatter=function(b){function c(a){return!!b.schema.getTextBlocks()[a.toLowerCase()]}function d(a,b){return K.getParents(a,b,K.getRoot())}function e(a){return 1===a.nodeType&&"_mce_caret"===a.id}function f(){i({alignleft:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"},defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{"float":"left"}}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"},defaultBlock:"div"},{selector:"img",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"}},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"}}],alignright:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"},defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{"float":"right"}}],alignfull:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"justify"},defaultBlock:"div"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},wrap_links:!1},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},wrap_links:!1},fontname:{inline:"span",styles:{fontFamily:"%value"}},fontsize:{inline:"span",styles:{fontSize:"%value"}},fontsize_class:{inline:"span",attributes:{"class":"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(){return!0},onformat:function(a,b,c){J(c,function(b,c){K.setAttrib(a,c,b)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]}),J("p h1 h2 h3 h4 h5 h6 div address pre div code dt dd samp".split(/\s/),function(a){i(a,{block:a,remove:"all"})}),i(b.settings.formats)}function g(){b.addShortcut("ctrl+b","bold_desc","Bold"),b.addShortcut("ctrl+i","italic_desc","Italic"),b.addShortcut("ctrl+u","underline_desc","Underline");for(var a=1;6>=a;a++)b.addShortcut("ctrl+"+a,"",["FormatBlock",!1,"h"+a]);b.addShortcut("ctrl+7","",["FormatBlock",!1,"p"]),b.addShortcut("ctrl+8","",["FormatBlock",!1,"div"]),b.addShortcut("ctrl+9","",["FormatBlock",!1,"address"])}function h(a){return a?I[a]:I}function i(a,b){a&&("string"!=typeof a?J(a,function(a,b){i(b,a)}):(b=b.length?b:[b],J(b,function(a){a.deep===H&&(a.deep=!a.selector),a.split===H&&(a.split=!a.selector||a.inline),a.remove===H&&a.selector&&!a.inline&&(a.remove="none"),a.selector&&a.inline&&(a.mixed=!0,a.block_expand=!0),"string"==typeof a.classes&&(a.classes=a.classes.split(/\s+/))}),I[a]=b))}function j(d,f,g){function i(a,b){b=b||t,a&&(b.onformat&&b.onformat(a,b,f,g),J(b.styles,function(b,c){K.setStyle(a,c,u(b,f))}),J(b.attributes,function(b,c){K.setAttrib(a,c,u(b,f))}),J(b.classes,function(b){b=u(b,f),K.hasClass(a,b)||K.addClass(a,b)}))}function k(){function a(a,b){var c=new M(b);for(g=c.current();g;g=c.prev())if(g.childNodes.length>1||g==a||"BR"==g.tagName)return g}var c=b.selection.getRng(),d=c.startContainer,e=c.endContainer;if(d!=e&&0===c.endOffset){var f=a(d,e),h=3==f.nodeType?f.length:f.childNodes.length;c.setEnd(f,h)}return c}function l(b,c,d,e,f){var g,h,i=[],j=-1,k=-1,l=-1;return J(b.childNodes,function(a,b){return"UL"===a.nodeName||"OL"===a.nodeName?(j=b,g=a,!1):void 0}),J(b.childNodes,function(a,b){"SPAN"===a.nodeName&&"bookmark"==K.getAttrib(a,"data-mce-type")&&(a.id==c.id+"_start"?k=b:a.id==c.id+"_end"&&(l=b))}),0>=j||j>k&&l>j?(J(a.grep(b.childNodes),f),0):(h=K.clone(d,U),J(a.grep(b.childNodes),function(a,b){(j>k&&j>b||k>j&&b>j)&&(i.push(a),a.parentNode.removeChild(a))}),j>k?b.insertBefore(h,g):k>j&&b.insertBefore(h,g.nextSibling),e.push(h),J(i,function(a){h.appendChild(a)}),h)}function n(b,g,h){var j,k,n=[],o=!0;j=t.inline||t.block,k=K.create(j),i(k),N.walk(b,function(b){function p(b){var u,v,x,y,z;return z=o,u=b.nodeName.toLowerCase(),v=b.parentNode.nodeName.toLowerCase(),1===b.nodeType&&W(b)&&(z=o,o="true"===W(b),y=!0),s(u,"br")?(r=0,t.block&&K.remove(b),void 0):t.wrapper&&m(b,d,f)?(r=0,void 0):o&&!y&&t.block&&!t.wrapper&&c(u)?(b=K.rename(b,j),i(b),n.push(b),r=0,void 0):t.selector&&(J(q,function(a){"collapsed"in a&&a.collapsed!==w||K.is(b,a.selector)&&!e(b)&&(i(b,a),x=!0)}),!t.inline||x)?(r=0,void 0):(o&&!y&&O(j,u)&&O(v,j)&&(h||3!==b.nodeType||1!==b.nodeValue.length||65279!==b.nodeValue.charCodeAt(0))&&!e(b)?(r||(r=K.clone(k,U),b.parentNode.insertBefore(r,b),n.push(r)),r.appendChild(b)):"li"==u&&g?r=l(b,g,k,n,p):(r=0,J(a.grep(b.childNodes),p),y&&(o=z),r=0),void 0)}var r;J(b,p)}),t.wrap_links===!1&&J(n,function(b){function c(b){var d,e,f;if("A"===b.nodeName){for(e=K.clone(k,U),n.push(e),f=a.grep(b.childNodes),d=0;f.length>d;d++)e.appendChild(f[d]);b.appendChild(e)}J(a.grep(b.childNodes),c)}c(b)}),J(n,function(a){function b(a){var b=0;return J(a.childNodes,function(a){v(a)||B(a)||b++}),b}function c(a){var b,c;return J(a.childNodes,function(a){return 1!=a.nodeType||B(a)||e(a)?void 0:(b=a,U)}),b&&r(b,t)&&(c=K.clone(b,U),i(c),K.replace(c,a,V),K.remove(b,1)),c||a}var g;if(g=b(a),(n.length>1||!P(a))&&0===g)return K.remove(a,1),void 0;if(t.inline||t.wrapper){if(t.exact||1!==g||(a=c(a)),J(q,function(b){J(K.select(b.inline,a),function(a){var c;if(b.wrap_links===!1){c=a.parentNode;do if("A"===c.nodeName)return;while(c=c.parentNode)}y(b,f,a,b.exact?a:null)})}),m(a.parentNode,d,f))return K.remove(a,1),a=0,V;t.merge_with_parents&&K.getParent(a.parentNode,function(b){return m(b,d,f)?(K.remove(a,1),a=0,V):void 0}),a&&t.merge_siblings!==!1&&(a=C(A(a),a),a=C(a,A(a,V)))}})}var o,p,q=h(d),t=q[0],w=L.isCollapsed();if(t)if(g)g.nodeType?(p=K.createRng(),p.setStartBefore(g),p.setEndAfter(g),n(x(p,q),null,!0)):n(g,null,!0);else if(w&&t.inline&&!K.select("td.mceSelected,th.mceSelected").length)E("apply",d,f);else{var z=b.selection.getNode();Q||!q[0].defaultBlock||K.getParent(z,K.isBlock)||j(q[0].defaultBlock),b.selection.setRng(k()),o=L.getBookmark(),n(x(L.getRng(V),q),o),t.styles&&(t.styles.color||t.styles.textDecoration)&&(a.walk(z,Y,"childNodes"),Y(z)),L.moveToBookmark(o),F(L.getRng(V)),b.nodeChanged()}}function k(c,e,f){function g(b){var c,d,f,h,i;if(3!==b.nodeType){if(1===b.nodeType&&W(b)&&(h=t,t="true"===W(b),i=!0),c=a.grep(b.childNodes),t&&!i)for(d=0,f=r.length;f>d&&!y(r[d],e,b,b);d++);if(s.deep&&c.length){for(d=0,f=c.length;f>d;d++)g(c[d]);i&&(t=h)}}}function i(a){var b;return J(d(a.parentNode).reverse(),function(a){var d;b||"_start"==a.id||"_end"==a.id||(d=m(a,c,e),d&&d.split!==!1&&(b=a))}),b}function j(a,b,c,d){var f,g,h,i,j,k;if(a){for(k=a.parentNode,f=b.parentNode;f&&f!=k;f=f.parentNode){for(g=K.clone(f,U),j=0;r.length>j;j++)if(y(r[j],e,g,g)){g=0;break}g&&(h&&g.appendChild(h),i||(i=g),h=g)}!d||s.mixed&&P(a)||(b=K.split(a,b)),h&&(c.parentNode.insertBefore(h,c),i.appendChild(c))}return b}function k(a){return j(i(a),a,a,!0)}function l(a){var b=K.get(a?"_start":"_end"),c=b[a?"firstChild":"lastChild"];return B(c)&&(c=c[a?"firstChild":"lastChild"]),K.remove(b,!0),c}function o(a){var c,d;a=x(a,r,V),s.split&&(c=D(a,V),d=D(a),c!=d?(/^(TR|TD)$/.test(c.nodeName)&&c.firstChild&&(c=("TD"==c.nodeName?c.firstChild:c.firstChild.firstChild)||c),c=w(c,"span",{id:"_start","data-mce-type":"bookmark"}),d=w(d,"span",{id:"_end","data-mce-type":"bookmark"}),k(c),k(d),c=l(V),d=l()):c=d=k(c),a.startContainer=c.parentNode,a.startOffset=R(c),a.endContainer=d.parentNode,a.endOffset=R(d)+1),N.walk(a,function(a){J(a,function(a){g(a),1===a.nodeType&&"underline"===b.dom.getStyle(a,"text-decoration")&&a.parentNode&&"underline"===X(a.parentNode)&&y({deep:!1,exact:!0,inline:"span",styles:{textDecoration:"underline"}},null,a)})})}var p,q,r=h(c),s=r[0],t=!0;return f?(f.nodeType?(q=K.createRng(),q.setStartBefore(f),q.setEndAfter(f),o(q)):o(f),void 0):(L.isCollapsed()&&s.inline&&!K.select("td.mceSelected,th.mceSelected").length?E("remove",c,e):(p=L.getBookmark(),o(L.getRng(V)),L.moveToBookmark(p),s.inline&&n(c,e,L.getStart())&&F(L.getRng(!0)),b.nodeChanged()),void 0)}function l(a,b,c){var d=h(a);!n(a,b,c)||"toggle"in d[0]&&!d[0].toggle?j(a,b,c):k(a,b,c)}function m(a,b,c,d){function e(a,b,e){var f,g,h,i=b[e];if(b.onmatch)return b.onmatch(a,b,e);if(i)if(i.length===H){for(f in i)if(i.hasOwnProperty(f)){if(g="attributes"===e?K.getAttrib(a,f):t(a,f),d&&!g&&!b.exact)return;if((!d||b.exact)&&!s(g,u(i[f],c)))return}}else for(h=0;i.length>h;h++)if("attributes"===e?K.getAttrib(a,i[h]):t(a,i[h]))return b;return b}var f,g,i,j=h(b);if(j&&a)for(g=0;j.length>g;g++)if(f=j[g],r(a,f)&&e(a,f,"attributes")&&e(a,f,"styles")){if(i=f.classes)for(g=0;i.length>g;g++)if(!K.hasClass(a,i[g]))return;return f}}function n(a,b,c){function d(c){return c=K.getParent(c,function(c){return!!m(c,a,b,!0)}),m(c,a,b)}var e;return c?d(c):(c=L.getNode(),d(c)?V:(e=L.getStart(),e!=c&&d(e)?V:U))}function o(a,b){var c,d=[],e={};return c=L.getStart(),K.getParent(c,function(c){var f,g;for(f=0;a.length>f;f++)g=a[f],!e[g]&&m(c,g,b)&&(e[g]=!0,d.push(g))},K.getRoot()),d}function p(a){var b,c,e,f,g,i=h(a);if(i)for(b=L.getStart(),c=d(b),f=i.length-1;f>=0;f--){if(g=i[f].selector,!g)return V;for(e=c.length-1;e>=0;e--)if(K.is(c[e],g))return V}return U}function q(a,c,e){var f;return G||(G={},f={},b.onNodeChange.addToTop(function(a,b,c){var e=d(c),g={};J(G,function(a,b){J(e,function(c){return m(c,b,{},a.similar)?(f[b]||(J(a,function(a){a(!0,{node:c,format:b,parents:e})}),f[b]=a),g[b]=a,!1):void 0})}),J(f,function(a,b){g[b]||(delete f[b],J(a,function(a){a(!1,{node:c,format:b,parents:e})}))})})),J(a.split(","),function(a){G[a]||(G[a]=[],G[a].similar=e),G[a].push(c)}),this}function r(a,b){return s(a,b.inline)?V:s(a,b.block)?V:b.selector?K.is(a,b.selector):void 0}function s(a,b){return a=a||"",b=b||"",a=""+(a.nodeName||a),b=""+(b.nodeName||b),a.toLowerCase()==b.toLowerCase()}function t(a,b){var c=K.getStyle(a,b);return("color"==b||"backgroundColor"==b)&&(c=K.toHex(c)),"fontWeight"==b&&700==c&&(c="bold"),""+c}function u(a,b){return"string"!=typeof a?a=a(b):b&&(a=a.replace(/%(\w+)/g,function(a,c){return b[c]||a})),a}function v(a){return a&&3===a.nodeType&&/^([\t \r\n]+|)$/.test(a.nodeValue)}function w(a,b,c){var d=K.create(b,c);return a.parentNode.insertBefore(d,a),d.appendChild(a),d}function x(a,e,f){function g(a){function b(a){return"BR"==a.nodeName&&a.getAttribute("data-mce-bogus")&&!a.nextSibling}var c,d,f,g,h;if(c=d=a?p:r,g=a?"previousSibling":"nextSibling",h=K.getRoot(),3==c.nodeType&&!v(c)&&(a?q>0:c.nodeValue.length>t))return c;for(;;){if(!e[0].block_expand&&P(d))return d;for(f=d[g];f;f=f[g])if(!B(f)&&!v(f)&&!b(f))return d;if(d.parentNode==h){c=d;break}d=d.parentNode}return c}function h(a,b){for(b===H&&(b=3===a.nodeType?a.length:a.childNodes.length);a&&a.hasChildNodes();)a=a.childNodes[b],a&&(b=3===a.nodeType?a.length:a.childNodes.length);return{node:a,offset:b}}function i(a){for(var b=a;b;){if(1===b.nodeType&&W(b))return"false"===W(b)?b:a;b=b.parentNode}return a}function j(a,c,d){function e(a,b){var c,e,g=a.nodeValue;return"undefined"==typeof b&&(b=d?g.length:0),d?(c=g.lastIndexOf(" ",b),e=g.lastIndexOf("\u00a0",b),c=c>e?c:e,-1===c||f||c++):(c=g.indexOf(" ",b),e=g.indexOf("\u00a0",b),c=-1!==c&&(-1===e||e>c)?c:e),c}var g,h,i,j;if(3===a.nodeType){if(i=e(a,c),-1!==i)return{container:a,offset:i};j=a}for(g=new M(a,K.getParent(a,P)||b.getBody());h=g[d?"prev":"next"]();)if(3===h.nodeType){if(j=h,i=e(h),-1!==i)return{container:h,offset:i}}else if(P(h))break;return j?(c=d?0:j.length,{container:j,offset:c}):void 0}function k(b,c){var f,g,h,i;for(3==b.nodeType&&0===b.nodeValue.length&&b[c]&&(b=b[c]),f=d(b),g=0;f.length>g;g++)for(h=0;e.length>h;h++)if(i=e[h],!("collapsed"in i&&i.collapsed!==a.collapsed)&&K.is(f[g],i.selector))return f[g];return b}function l(a,b){var f;if(e[0].wrapper||(f=K.getParent(a,e[0].block)),f||(f=K.getParent(3==a.nodeType?a.parentNode:a,c)),f&&e[0].wrapper&&(f=d(f,"ul,ol").reverse()[0]||f),!f)for(f=a;f[b]&&!P(f[b])&&(f=f[b],!s(f,"br")););return f||a}var m,n,o,p=a.startContainer,q=a.startOffset,r=a.endContainer,t=a.endOffset;if(1==p.nodeType&&p.hasChildNodes()&&(m=p.childNodes.length-1,p=p.childNodes[q>m?m:q],3==p.nodeType&&(q=0)),1==r.nodeType&&r.hasChildNodes()&&(m=r.childNodes.length-1,r=r.childNodes[t>m?m:t-1],3==r.nodeType&&(t=r.nodeValue.length)),p=i(p),r=i(r),(B(p.parentNode)||B(p))&&(p=B(p)?p:p.parentNode,p=p.nextSibling||p,3==p.nodeType&&(q=0)),(B(r.parentNode)||B(r))&&(r=B(r)?r:r.parentNode,r=r.previousSibling||r,3==r.nodeType&&(t=r.length)),e[0].inline&&(a.collapsed&&(o=j(p,q,!0),o&&(p=o.container,q=o.offset),o=j(r,t),o&&(r=o.container,t=o.offset)),n=h(r,t),n.node)){for(;n.node&&0===n.offset&&n.node.previousSibling;)n=h(n.node.previousSibling);n.node&&n.offset>0&&3===n.node.nodeType&&" "===n.node.nodeValue.charAt(n.offset-1)&&n.offset>1&&(r=n.node,r.splitText(n.offset-1))}return(e[0].inline||e[0].block_expand)&&(e[0].inline&&3==p.nodeType&&0!==q||(p=g(!0)),e[0].inline&&3==r.nodeType&&t!==r.nodeValue.length||(r=g())),e[0].selector&&e[0].expand!==U&&!e[0].inline&&(p=k(p,"previousSibling"),r=k(r,"nextSibling")),(e[0].block||e[0].selector)&&(p=l(p,"previousSibling"),r=l(r,"nextSibling"),e[0].block&&(P(p)||(p=g(!0)),P(r)||(r=g()))),1==p.nodeType&&(q=R(p),p=p.parentNode),1==r.nodeType&&(t=R(r)+1,r=r.parentNode),{startContainer:p,startOffset:q,endContainer:r,endOffset:t}}function y(a,b,c,d){var e,f,g;if(!r(c,a))return U;if("all"!=a.remove)for(J(a.styles,function(a,e){a=u(a,b),"number"==typeof e&&(e=a,d=0),(!d||s(t(d,e),a))&&K.setStyle(c,e,""),g=1}),g&&""==K.getAttrib(c,"style")&&(c.removeAttribute("style"),c.removeAttribute("data-mce-style")),J(a.attributes,function(a,e){var f;if(a=u(a,b),"number"==typeof e&&(e=a,d=0),!d||s(K.getAttrib(d,e),a)){if("class"==e&&(a=K.getAttrib(c,e),a&&(f="",J(a.split(/\s+/),function(a){/mce\w+/.test(a)&&(f+=(f?" ":"")+a)}),f)))return K.setAttrib(c,e,f),void 0;"class"==e&&c.removeAttribute("className"),T.test(e)&&c.removeAttribute("data-mce-"+e),c.removeAttribute(e)}}),J(a.classes,function(a){a=u(a,b),(!d||K.hasClass(d,a))&&K.removeClass(c,a)}),f=K.getAttribs(c),e=0;f.length>e;e++)if(0!==f[e].nodeName.indexOf("_"))return U;return"none"!=a.remove?(z(c,a),V):void 0}function z(b,c){function d(a,b,c){return a=A(a,b,c),!a||"BR"==a.nodeName||P(a)}var e,f=b.parentNode;c.block&&(Q?f==K.getRoot()&&(c.list_block&&s(b,c.list_block)||J(a.grep(b.childNodes),function(a){O(Q,a.nodeName.toLowerCase())?e?e.appendChild(a):e=w(a,Q):e=0})):P(b)&&!P(f)&&(d(b,U)||d(b.firstChild,V,1)||b.insertBefore(K.create("br"),b.firstChild),d(b,V)||d(b.lastChild,U,1)||b.appendChild(K.create("br")))),c.selector&&c.inline&&!s(c.inline,b)||K.remove(b,1)}function A(a,b,c){if(a)for(b=b?"nextSibling":"previousSibling",a=c?a:a[b];a;a=a[b])if(1==a.nodeType||!v(a))return a}function B(a){return a&&1==a.nodeType&&"bookmark"==a.getAttribute("data-mce-type")}function C(b,c){function d(a,b){function c(a){var b={};return J(K.getAttribs(a),function(c){var d=c.nodeName.toLowerCase();0!==d.indexOf("_")&&"style"!==d&&(b[d]=K.getAttrib(a,d))}),b}function d(a,b){var c,d;for(d in a)if(a.hasOwnProperty(d)){if(c=b[d],c===H)return U;if(a[d]!=c)return U;delete b[d]}for(d in b)if(b.hasOwnProperty(d))return U;return V}return a.nodeName!=b.nodeName?U:d(c(a),c(b))?d(K.parseStyle(K.getAttrib(a,"style")),K.parseStyle(K.getAttrib(b,"style")))?V:U:U}function e(a,b){for(f=a;f;f=f[b]){if(3==f.nodeType&&0!==f.nodeValue.length)return a;if(1==f.nodeType&&!B(f))return f}return a}var f,g;if(b&&c&&(b=e(b,"previousSibling"),c=e(c,"nextSibling"),d(b,c))){for(f=b.nextSibling;f&&f!=c;)g=f,f=f.nextSibling,b.appendChild(g);return K.remove(c),J(a.grep(c.childNodes),function(a){b.appendChild(a)}),b}return c}function c(a){return/^(h[1-6]|p|div|pre|address|dl|dt|dd)$/.test(a)}function D(a,c){var d,e,f;return d=a[c?"startContainer":"endContainer"],e=a[c?"startOffset":"endOffset"],1==d.nodeType&&(f=d.childNodes.length-1,!c&&e&&e--,d=d.childNodes[e>f?f:e]),3===d.nodeType&&c&&e>=d.nodeValue.length&&(d=new M(d,b.getBody()).next()||d),3!==d.nodeType||c||0!==e||(d=new M(d,b.getBody()).prev()||d),d}function E(c,d,e){function f(a){var c=K.create("span",{id:r,"data-mce-bogus":!0,style:s?"color:red":""});return a&&c.appendChild(b.getDoc().createTextNode(S)),c}function g(a,b){for(;a;){if(3===a.nodeType&&a.nodeValue!==S||a.childNodes.length>1)return!1;b&&1===a.nodeType&&b.push(a),a=a.firstChild}return!0}function i(a){for(;a;){if(a.id===r)return a;a=a.parentNode}}function l(a){var b;if(a)for(b=new M(a,a),a=b.current();a;a=b.next())if(3===a.nodeType)return a}function n(a,b){var c,d;if(a)d=L.getRng(!0),g(a)?(b!==!1&&(d.setStartBefore(a),d.setEndBefore(a)),K.remove(a)):(c=l(a),c.nodeValue.charAt(0)===S&&(c=c.deleteData(0,1)),K.remove(a,1)),L.setRng(d);else if(a=i(L.getStart()),!a)for(;a=K.get(r);)n(a,!1)}function o(){var a,b,c,g,k,m,n;a=L.getRng(!0),g=a.startOffset,m=a.startContainer,n=m.nodeValue,b=i(L.getStart()),b&&(c=l(b)),n&&g>0&&n.length>g&&/\w/.test(n.charAt(g))&&/\w/.test(n.charAt(g-1))?(k=L.getBookmark(),a.collapse(!0),a=x(a,h(d)),a=N.split(a),j(d,e,a),L.moveToBookmark(k)):(b&&c.nodeValue===S?j(d,e,b):(b=f(!0),c=b.firstChild,a.insertNode(b),g=1,j(d,e,b)),L.setCursorLocation(c,g))}function p(){var a,b,c,g,i,j,l,n,o=L.getRng(!0),p=[];for(a=o.startContainer,b=o.startOffset,i=a,3==a.nodeType&&((b!=a.nodeValue.length||a.nodeValue===S)&&(g=!0),i=i.parentNode);i;){if(m(i,d,e)){j=i;break}i.nextSibling&&(g=!0),p.push(i),i=i.parentNode}if(j)if(g)c=L.getBookmark(),o.collapse(!0),o=x(o,h(d),!0),o=N.split(o),k(d,e,o),L.moveToBookmark(c);else{for(n=f(),i=n,l=p.length-1;l>=0;l--)i.appendChild(K.clone(p[l],!1)),i=i.firstChild;i.appendChild(K.doc.createTextNode(S)),i=i.firstChild,K.insertAfter(n,j),L.setCursorLocation(i,1)}}function q(){var b;b=i(L.getStart()),b&&!K.isEmpty(b)&&a.walk(b,function(a){1!=a.nodeType||a.id===r||K.isEmpty(a)||K.setAttrib(a,"data-mce-bogus",null)},"childNodes")}var r="_mce_caret",s=b.settings.caret_debug;self._hasCaretEvents||(b.onBeforeGetContent.addToTop(function(){var a,b=[];if(g(i(L.getStart()),b))for(a=b.length;a--;)K.setAttrib(b[a],"data-mce-bogus","1")}),a.each("onMouseUp onKeyUp".split(" "),function(a){b[a].addToTop(function(){n(),q()})}),b.onKeyDown.addToTop(function(a,b){var c=b.keyCode;(8==c||37==c||39==c)&&n(i(L.getStart())),q()}),L.onSetContent.add(q),self._hasCaretEvents=!0),"apply"==c?o():p()}function F(a){var b,c,d,e,f,g=a.startContainer,h=a.startOffset;if(3==g.nodeType&&h>=g.nodeValue.length&&(h=R(g),g=g.parentNode,b=!0),1==g.nodeType)for(e=g.childNodes,g=e[Math.min(h,e.length-1)],c=new M(g,K.getParent(g,K.isBlock)),(h>e.length-1||b)&&c.next(),d=c.current();d;d=c.next())if(3==d.nodeType&&!v(d))return f=K.create("a",null,S),d.parentNode.insertBefore(f,d),a.setStart(d,0),L.setRng(a),K.remove(f),void 0}var G,H,I={},J=a.each,K=b.dom,L=b.selection,M=a.dom.TreeWalker,N=new a.dom.RangeUtils(K),O=b.schema.isValidChild,P=(a.isArray,K.isBlock),Q=b.settings.forced_root_block,R=K.nodeIndex,S="\ufeff",T=/^(src|href|style)$/,U=!1,V=!0,W=K.getContentEditable,X=function(a){var c;return b.dom.getParent(a,function(a){return c=b.dom.getStyle(a,"text-decoration"),c&&"none"!==c}),c},Y=function(a){var c;1===a.nodeType&&a.parentNode&&1===a.parentNode.nodeType&&(c=X(a.parentNode),b.dom.getStyle(a,"color")&&c?b.dom.setStyle(a,"text-decoration",c):b.dom.getStyle(a,"textdecoration")===c&&b.dom.setStyle(a,"text-decoration",null))};a.extend(this,{get:h,register:i,apply:j,remove:k,toggle:l,match:n,matchAll:o,matchNode:m,canApply:p,formatChanged:q}),f(),g()}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
tinymce.onAddEditor.add(function(a,b){function c(b,c){a.each(c,function(a,c){a&&g.setStyle(b,c,a)}),g.rename(b,"span")}function d(c,d){g=c.dom,h.convert_fonts_to_spans&&a.each(g.select("font,u,strike",d.node),function(a){e[a.nodeName.toLowerCase()](b.dom,a)})}var e,f,g,h=b.settings;h.inline_styles&&(f=a.explode(h.font_size_legacy_values),e={font:function(a,b){c(b,{backgroundColor:b.style.backgroundColor,color:b.color,fontFamily:b.face,fontSize:f[parseInt(b.size,10)-1]})},u:function(a,b){c(b,{textDecoration:"underline"})},strike:function(a,b){c(b,{textDecoration:"line-through"})}},b.onPreProcess.add(d),b.onSetContent.add(d),b.onInit.add(function(){b.selection.onSetContent.add(d)}))});
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){var b=a.dom.TreeWalker;a.EnterKey=function(c){function d(d){function j(a){return a&&e.isBlock(a)&&!/^(TD|TH|CAPTION|FORM)$/.test(a.nodeName)&&!/^(fixed|absolute)/i.test(a.style.position)&&"true"!==e.getContentEditable(a)}function k(b){var c;a.isIE&&e.isBlock(b)&&(c=f.getRng(),b.appendChild(e.create("span",null,"\u00a0")),f.select(b),b.lastChild.outerHTML="",f.setRng(c))}function l(a){for(var b,c=a,d=[];c=c.firstChild;){if(e.isBlock(c))return;1!=c.nodeType||i[c.nodeName.toLowerCase()]||d.push(c)}for(b=d.length;b--;)c=d[b],!c.hasChildNodes()||c.firstChild==c.lastChild&&""===c.firstChild.nodeValue?e.remove(c):"A"==c.nodeName&&" "===(c.innerText||c.textContent)&&e.remove(c)}function m(a){var d,g,h,j,k,l,m=a;if(h=e.createRng(),a.hasChildNodes()){for(d=new b(a,a);g=d.current();){if(3==g.nodeType){h.setStart(g,0),h.setEnd(g,0);break}if(i[g.nodeName.toLowerCase()]){h.setStartBefore(g),h.setEndBefore(g);break}m=g,g=d.next()}g||(h.setStart(m,0),h.setEnd(m,0))}else"BR"==a.nodeName?a.nextSibling&&e.isBlock(a.nextSibling)?((!B||9>B)&&(l=e.create("br"),a.parentNode.insertBefore(l,a)),h.setStartBefore(a),h.setEndBefore(a)):(h.setStartAfter(a),h.setEndAfter(a)):(h.setStart(a,0),h.setEnd(a,0));f.setRng(h),e.remove(l),k=e.getViewPort(c.getWin()),j=e.getPos(a).y,(k.y>j||j+25>k.y+k.h)&&c.getWin().scrollTo(0,k.y>j?j:j-k.h+25)}function n(b){var c,d,f,h=y;if(c=b||"TABLE"==G?e.create(b||I):A.cloneNode(!1),f=c,g.keep_styles!==!1)do if(/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(h.nodeName)){if("_mce_caret"==h.id)continue;d=h.cloneNode(!1),e.setAttrib(d,"id",""),c.hasChildNodes()?(d.appendChild(c.firstChild),c.appendChild(d)):(f=d,c.appendChild(d))}while(h=h.parentNode);return a.isIE||(f.innerHTML='<br data-mce-bogus="1">'),c}function o(a){var c,d,e;if(3==y.nodeType&&(a?z>0:y.nodeValue.length>z))return!1;if(y.parentNode==A&&J&&!a)return!0;if(a&&1==y.nodeType&&y==A.firstChild)return!0;if("TABLE"===y.nodeName||y.previousSibling&&"TABLE"==y.previousSibling.nodeName)return J&&!a||!J&&a;for(c=new b(y,A),3==y.nodeType&&(a&&0==z?c.prev():a||z!=y.nodeValue.length||c.next());d=c.current();){if(1===d.nodeType){if(!d.getAttribute("data-mce-bogus")&&(e=d.nodeName.toLowerCase(),i[e]&&"br"!==e))return!1}else if(3===d.nodeType&&!/^[ \t\r\n]*$/.test(d.nodeValue))return!1;a?c.prev():c.next()}return!0}function p(a,b){var c,d,f,g,h,i=I||"P";if(d=e.getParent(a,e.isBlock),!d||!j(d)){if(d=d||x,!d.hasChildNodes())return c=e.create(i),d.appendChild(c),K.setStart(c,0),K.setEnd(c,0),c;for(g=a;g.parentNode!=d;)g=g.parentNode;for(;g&&!e.isBlock(g);)f=g,g=g.previousSibling;if(f){for(c=e.create(i),f.parentNode.insertBefore(c,f),g=f;g&&!e.isBlock(g);)h=g.nextSibling,c.appendChild(g),g=h;K.setStart(a,b),K.setEnd(a,b)}}return a}function q(){function a(a){for(var b=F[a?"firstChild":"lastChild"];b&&1!=b.nodeType;)b=b[a?"nextSibling":"previousSibling"];return b===A}D=I?n(I):e.create("BR"),a(!0)&&a()?e.replace(D,F):a(!0)?F.parentNode.insertBefore(D,F):a()?(e.insertAfter(D,F),k(D)):(w=K.cloneRange(),w.setStartAfter(A),w.setEndAfter(F),E=w.extractContents(),e.insertAfter(E,F),e.insertAfter(D,F)),e.remove(A),m(D),h.add()}function r(){for(var a,c=new b(y,A);a=c.current();){if("BR"==a.nodeName)return!0;a=c.next()}}function s(){var b,c,d;y&&3==y.nodeType&&z>=y.nodeValue.length&&(a.isIE||r()||(b=e.create("br"),K.insertNode(b),K.setStartAfter(b),K.setEndAfter(b),c=!0)),b=e.create("br"),K.insertNode(b),a.isIE&&"PRE"==G&&(!B||8>B)&&b.parentNode.insertBefore(e.doc.createTextNode("\r"),b),d=e.create("span",{},"&nbsp;"),b.parentNode.insertBefore(d,b),f.scrollIntoView(d),e.remove(d),c?(K.setStartBefore(b),K.setEndBefore(b)):(K.setStartAfter(b),K.setEndAfter(b)),f.setRng(K),h.add()}function t(a){do 3===a.nodeType&&(a.nodeValue=a.nodeValue.replace(/^[\r\n]+/,"")),a=a.firstChild;while(a)}function u(a){var b,c,d=e.getRoot();for(b=a;b!==d&&"false"!==e.getContentEditable(b);)"true"===e.getContentEditable(b)&&(c=b),b=b.parentNode;return b!==d?c:d}function v(b){var c;a.isIE||(b.normalize(),c=b.lastChild,(!c||/^(left|right)$/gi.test(e.getStyle(c,"float",!0)))&&e.add(b,"br"))}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=f.getRng(!0);if(!K.collapsed)return c.execCommand("Delete"),void 0;if(!d.isDefaultPrevented()&&(y=K.startContainer,z=K.startOffset,I=(g.force_p_newlines?"p":"")||g.forced_root_block,I=I?I.toUpperCase():"",B=e.doc.documentMode,C=d.shiftKey,1==y.nodeType&&y.hasChildNodes()&&(J=z>y.childNodes.length-1,y=y.childNodes[Math.min(z,y.childNodes.length-1)]||y,z=J&&3==y.nodeType?y.nodeValue.length:0),x=u(y))){if(h.beforeChange(),!e.isBlock(x)&&x!=e.getRoot())return(!I||C)&&s(),void 0;if((I&&!C||!I&&C)&&(y=p(y,z)),A=e.getParent(y,e.isBlock),F=A?e.getParent(A.parentNode,e.isBlock):null,G=A?A.nodeName.toUpperCase():"",H=F?F.nodeName.toUpperCase():"","LI"!=H||d.ctrlKey||(A=F,G=H),"LI"==G){if(!I&&C)return s(),void 0;if(e.isEmpty(A))return/^(UL|OL|LI)$/.test(F.parentNode.nodeName)?!1:(q(),void 0)}if("PRE"==G&&g.br_in_pre!==!1){if(!C)return s(),void 0}else if(!I&&!C&&"LI"!=G||I&&C)return s(),void 0;I=I||"P",o()?(D=/^(H[1-6]|PRE)$/.test(G)&&"HGROUP"!=H?n(I):n(),g.end_container_on_empty_block&&j(F)&&e.isEmpty(A)?D=e.split(F,A):e.insertAfter(D,A),m(D)):o(!0)?(D=A.parentNode.insertBefore(n(),A),k(D)):(w=K.cloneRange(),w.setEndAfter(A),E=w.extractContents(),t(E),D=E.firstChild,e.insertAfter(E,A),l(D),v(A),m(D)),e.setAttrib(D,"id",""),h.add()}}var e=c.dom,f=c.selection,g=c.settings,h=c.undoManager,i=c.schema.getNonEmptyElements();c.onKeyDown.add(function(a,b){13==b.keyCode&&d(b)!==!1&&b.preventDefault()})}})(tinymce);
;// LICENSE TinyMCE 3.5.8 - see licenses.txt §2.8
(function(a){function b(){function b(a){"remove"===a&&this.each(function(a,b){var c=e(b);c&&c.remove()}),this.find("span.mceEditor,div.mceEditor").each(function(a,b){var c=tinyMCE.get(b.id.replace(/_parent$/,""));c&&c.remove()})}function d(a){var d,e=this;if(a!==c)b.call(e),e.each(function(b,c){var d;(d=tinyMCE.get(c.id))&&d.setContent(a)});else if(e.length>0&&(d=tinyMCE.get(e[0].id)))return d.getContent()}function e(a){var b=null;return a&&a.id&&f.tinymce&&(b=tinyMCE.get(a.id)),b}function g(a){return!!(a&&a.length&&f.tinymce&&a.is(":tinymce"))}var h={};a.each(["text","html","val"],function(b,f){var i=h[f]=a.fn[f],j="text"===f;a.fn[f]=function(b){var f=this;if(!g(f))return i.apply(f,arguments);if(b!==c)return d.call(f.filter(":tinymce"),b),i.apply(f.not(":tinymce"),arguments),f;var h="",k=arguments;return(j?f:f.eq(0)).each(function(b,c){var d=e(c);h+=d?j?d.getContent().replace(/<(?:"[^"]*"|'[^']*'|[^'">])*>/g,""):d.getContent({save:!0}):i.apply(a(c),k)}),h}}),a.each(["append","prepend"],function(b,d){var f=h[d]=a.fn[d],i="prepend"===d;a.fn[d]=function(a){var b=this;return g(b)?a!==c?(b.filter(":tinymce").each(function(b,c){var d=e(c);d&&d.setContent(i?a+d.getContent():d.getContent()+a)}),f.apply(b.not(":tinymce"),arguments),b):void 0:f.apply(b,arguments)}}),a.each(["remove","replaceWith","replaceAll","empty"],function(c,d){var e=h[d]=a.fn[d];a.fn[d]=function(){return b.call(this,d),e.apply(this,arguments)}}),h.attr=a.fn.attr,a.fn.attr=function(b,f){var i=this,j=arguments;if(!b||"value"!==b||!g(i))return f!==c?h.attr.apply(i,j):h.attr.apply(i,j);if(f!==c)return d.call(i.filter(":tinymce"),f),h.attr.apply(i.not(":tinymce"),j),i;var k=i[0],l=e(k);return l?l.getContent({save:!0}):h.attr.apply(a(k),j)}}var c,d,e=[],f=window;a.fn.tinymce=function(c){function g(){var d=[],e=0;b&&(b(),b=null),l.each(function(a,b){var f,g=b.id,h=c.oninit;g||(b.id=g=tinymce.DOM.uniqueId()),f=new tinymce.Editor(g,c),d.push(f),f.onInit.add(function(){var a,b=h;l.css("visibility",""),h&&++e==d.length&&(tinymce.is(b,"string")&&(a=-1===b.indexOf(".")?null:tinymce.resolve(b.replace(/\.\w+$/,"")),b=tinymce.resolve(b)),b.apply(a||tinymce,d))})}),a.each(d,function(a,b){b.render()})}var h,i,j,k,l=this,m="",n="";return l.length?c?(l.css("visibility","hidden"),f.tinymce||d||!(h=c.script_url)?1===d?e.push(g):g():(d=1,i=h.substring(0,h.lastIndexOf("/")),/_(src|dev)\.js/g.test(h)&&(n="_src"),j=h.lastIndexOf("?"),-1!=j&&(m=h.substring(j+1)),f.tinyMCEPreInit=f.tinyMCEPreInit||{base:i,suffix:n,query:m},-1!=h.indexOf("gzip")&&(k=c.language||"en",h=h+(/\?/.test(h)?"&":"?")+"js=true&core=true&suffix="+escape(n)+"&themes="+escape(c.theme)+"&plugins="+escape(c.plugins)+"&languages="+k,f.tinyMCE_GZ||(tinyMCE_GZ={start:function(){function b(a){tinymce.ScriptLoader.markDone(tinyMCE.baseURI.toAbsolute(a))}tinymce.suffix=n,b("langs/"+k+".js"),b("themes/"+c.theme+"/editor_template"+n+".js"),b("themes/"+c.theme+"/langs/"+k+".js"),a.each(c.plugins.split(","),function(a,c){c&&(b("plugins/"+c+"/editor_plugin"+n+".js"),b("plugins/"+c+"/langs/"+k+".js"))})},end:function(){}})),a.ajax({type:"GET",url:h,dataType:"script",cache:!0,success:function(){tinymce.dom.Event.domLoaded=1,d=2,c.script_loaded&&c.script_loaded(),g(),a.each(e,function(a,b){b()})}})),l):tinyMCE.get(l[0].id):l},a.extend(a.expr[":"],{tinymce:function(a){return!!(a.id&&"tinyMCE"in window&&tinyMCE.get(a.id))}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.DCE"),NL.DCE.Plugin=function(a,b){var c=this;this.controller=a,this.config=b,this._defaultSideBarFormConfig={labelsPosition:"above",labelsWidth:"short",configManager:b.configManager,showHelpText:!1},Object.defineProperty(this._defaultSideBarFormConfig,"readOnly",{enumerable:!0,get:function(){return c.controller.isReadOnly()}}),this._defaultEditFormConfig={labelsPosition:"left",labelsWidth:"medium",configManager:b.configManager,showHelpText:!0},Object.defineProperty(this._defaultEditFormConfig,"readOnly",{enumerable:!0,get:function(){return c.controller.isReadOnly()}}),this._defaultSideBarSectionConfig=function(a){return SO.Utils.extend({confId:"dce#"+c.getName()+"#sideBar"},a)},this._formControllers=[]},NL.DCE.Plugin.prototype.updateConfig=function(a){this.config=$.extend({},this.config,a);for(var b,c,d,e=this._formControllers,f=e.length,g=0;f>g;g++){b=e[g],c=b.getAllJPaths(),d=c.length;for(var h=0;d>h;h++)b.setReadOnly(c[h],this.config.readOnly)}},NL.DCE.Plugin.prototype.getName=function(){SO.log.error("Must be implemented.")},NL.DCE.Plugin.prototype.getLabel=function(){SO.log.error("Must be implemented.")},NL.DCE.Plugin.prototype.getRegistration=function(){return[]},NL.DCE.Plugin.prototype._applyValuesOnModel=function(a,b){return SO.Utils.each(b,function(b,c){a.model[b]=c}),a},NL.DCE.Plugin.prototype.handleBindingAction=function(){return!1},NL.DCE.Plugin.prototype.handleInlineInsertionAction=function(){return!1},NL.DCE.Plugin.prototype.fillSidebarSection=function(){return!1},NL.DCE.Plugin.prototype.updateSidebarSection=function(){},NL.DCE.Plugin.prototype.onDeselect=function(){},NL.DCE.Plugin.prototype.getMessages=function(){return[]},NL.DCE.Plugin.prototype.getEditionCommands=function(){return[]},NL.DCE.Plugin.prototype.getTextCommandNames=function(){return{names:[],advancedEdition:!1}},NL.DCE.Plugin.prototype.getPropertiesCommandNames=function(){return{names:[],advancedEdition:!1}},NL.DCE.Plugin.prototype.getOverCommands=function(){return[]},NL.DCE.Plugin.prototype.getOverCommandNames=function(){return[]},NL.DCE.Plugin.prototype.getUpdatedCommandStates=function(){return{}},NL.DCE.Plugin.prototype.getAdvancedEditionData=function(){return null},NL.DCE.Plugin.prototype.cleanSubtree=function(){return!1},NL.DCE.Plugin.prototype.onSubtreeInsertion=function(){return!1},NL.DCE.Plugin.prototype.onSubtreeDeletion=function(){return!1},NL.DCE.Plugin.prototype.onTextEditionStart=function(){return!1},NL.DCE.Plugin.prototype.onTextEditionEnd=function(){return!1};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){var a="background",b="border",c="geometry";NL.DCE.BlockStylePlugin=function(){NL.DCE.BlockStylePlugin.baseConstructor.apply(this,arguments),this.name="BlockStylePlugin",this.label=nms_contentEditor.plugin_blockStyle_title(),this._$focus=void 0,this._$sectionContent=void 0,this._sidebarController=void 0,this._sidebarContent={background:void 0,border:void 0,geometry:void 0}},SO.OO.extend(NL.DCE.BlockStylePlugin,NL.DCE.Plugin),NL.DCE.BlockStylePlugin.prototype._newBareModel=function(){return{model:{geometry:"",border:"",background:""},metamodel:{geometry:{label:nms_contentEditor.plugin_blockStyle_Dimensions(),type:"geometry",params:{"_#compactConfig":{flat:!1}}},border:{label:nms_contentEditor.plugin_blockStyle_Border(),type:"border"},background:{label:nms_contentEditor.plugin_blockStyle_Background(),type:"background"}}}},NL.DCE.BlockStylePlugin.prototype._loadElement=function(a){return{geometry:new NL.CSS.Geometry(0,0,a.css("width"),a.css("height")),border:new NL.CSS.Border(a),background:new NL.CSS.Background(a)}},NL.DCE.BlockStylePlugin.prototype._changeElement=function(a,b){switch(a){case"geometry":b.applyAttributesTo(this._$focus);break;case"border":b.applyAttributesTo(this._$focus);break;case"background":b.applyAttributesTo(this._$focus)}},NL.DCE.BlockStylePlugin.prototype._getAllFormContainers=function(a){var b={};"sidebar"===a.source&&(b=this._sidebarContent);var c=[];return SO.Utils.each(b,function(a,b){b&&c.push(b)}),c},NL.DCE.BlockStylePlugin.prototype._genHiddenMarkup=function(d){var e={};return"sidebar"===d.source&&(e=this._sidebarContent),e.geometry=$('<div data-nl-jpath="'+c+'"></div>'),e.border=$('<div data-nl-jpath="'+b+'"></div>'),e.background=$('<div data-nl-jpath="'+a+'"></div>'),this._getAllFormContainers(d)},NL.DCE.BlockStylePlugin.prototype._isAllowedResizing=function(a){return a&&"img"===a.get(0).nodeName.toLowerCase()},NL.DCE.BlockStylePlugin.prototype._onRefreshVisibility=function(a,b){SO.Utils.each(this._getAllFormContainers({source:b}),function(a,b){b.hide()});var c={};"sidebar"===b&&(c=this._sidebarContent),c.background.show(),c.border.show(),this._isAllowedResizing(this._$focus)&&c.geometry.show()},NL.DCE.BlockStylePlugin.prototype.getName=function(){return this.name},NL.DCE.BlockStylePlugin.prototype.getLabel=function(){return this.label},NL.DCE.BlockStylePlugin.prototype.updateSidebarSection=function(a,b){"html"===a.get(0).nodeName.toLowerCase()||a.hasClass("nl-dce-field")||a.hasClass("nl-dce-fragment")?this._$sectionContent.hide():(this._$focus=a,SO.assert(void 0!==this._sidebarController,"BlockStylePlugin.updateSidebarSection called without a controller"),this._sidebarController.setValues(this._loadElement(a),!b),this._$sectionContent.show())},NL.DCE.BlockStylePlugin.prototype.fillSidebarSection=function(a,b){if(this._$focus=a,!a||"html"===a.get(0).nodeName.toLowerCase()||a.hasClass("nl-dce-field")||a.hasClass("nl-dce-fragment"))return this._$sectionContent&&this._$sectionContent.hide(),!1;if(this._$sectionContent)this._$sectionContent.show(),this.updateSidebarSection(a,!0);else{var c=this;this._$sectionContent=$("<div></div>");var d=this._defaultSideBarSectionConfig({legend:nms_contentEditor.plugin_blockStyle_Style()}),e=$("<div></div>").nlCollapsableSection(d),f=$("<div></div>").append(this._genHiddenMarkup({source:"sidebar"})),g=this._applyValuesOnModel(this._newBareModel(),this._loadElement(c._$focus));this._sidebarController=new SO.MVC.Controller({model:g.model,metamodel:g.metamodel,statemodel:g.statemodel,onValueChanged:function(a,b,d,e){c._changeElement(a,e),c.controller.notifyElementChange(c._$focus)},onRefreshVisibility:function(a){c._onRefreshVisibility(a,"sidebar")}}),this._formControllers.push(this._sidebarController);var h=$.extend({},this._defaultSideBarFormConfig,{controller:this._sidebarController});f.nlForm(h),e.nlCollapsableSection("append",f),this._$sectionContent.append(e),b.append(this._$sectionContent)}return!0},NL.DCE.BlockStylePlugin.prototype.getRegistration=function(){return["focusOn"]}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){var b={"default":{className:"nlui-collapsable-default-mode",collapseIcon:"soui-icon-12-section-collapsed",uncollapseIcon:"soui-icon-12-section-collapsed"},streamline:{className:"nlui-collapsable-streamline-mode",collapseIcon:"soui-icon-12-section-collapsed",uncollapseIcon:"soui-icon-12-section-uncollapsed"}};a.widget("NL.nlCollapsableSection",a.NL.nlWidget,{options:{mode:"default",animationDuration:"fast",legend:"",collapsable:!0,collapsed:!1,onConfigure:void 0,configIcon:"settings",open:function(){},close:function(){}},_create:function(){var c=this;this._$container=void 0,this._$header=void 0,this._$collapser=void 0,this._legendText=void 0,this._$contents=void 0,this._$initialContents=void 0,this.mode=void 0,this.restoreConf(),this.options.layoutManager.registerWidget(this),this.mode=b[this.options.mode],void 0===this.mode&&(this.mode=b["default"]),this.element.addClass("nlui-collapsable").addClass(c.mode.className),this._$container=a('<div class="nlui-collapsable-wrapper"></div>'),this._$initialContents=c.element.children().detach(),this._$header=a('<div class="nlui-collapsable-header"></div>').appendTo(this._$container),this._$headerText=a('<span class="nlui-collapsable-header-text">').appendTo(this._$header),c.options.collapsable?(this._$header.addClass("nlui-collapsable-collapsable"),this._$collapser=a('<span class="nlui-collapsable-toggleicon"></span>').addClass(this.mode.collapseIcon),this._$header.prepend(c._$collapser),SO.Event.bind(this._$header.get(0),"vclick",function(){c._refreshCollapsed(!c.options.collapsed)})):this._$header.addClass("nlui-collapsable-uncollapsable"),void 0!==this.options.onConfigure&&null!==this.options.onConfigure&&a('<span class="nlui-collapsable-configure"></span>').soSimpleButton({icon:this.options.configIcon,mode:"transparent",onClick:function(a){c.stopPropagation(a),c.preventDefault(a),c.options.onConfigure()}}).appendTo(this._$header),this._$contents=a('<div class="nlui-collapsable-contents"></div>').appendTo(this._$container),this._$contents.append(this._$initialContents),this._$contents.toggle(!this.options.collapsed),this._$header.toggleClass("nlui-collapsable-collapsed",this.options.collapsed),this._refresh(),this._$container.appendTo(this.element)},destroy:function(){this._$initialContents.detach(),this.element.removeClass("nlui-collapsable").children().remove(),this.element.append(this._$initialContents),this.options.layoutManager.unRegisterWidget(this),a.NL.nlWidget.prototype.destroy.call(this)},_refresh:function(){this._refreshLegend(this.options.legend),this._refreshCollapsed(this.options.collapsed)},_refreshLegend:function(a){SO.isEmpty(a)&&(a=""),this.options.legend=a,this._$headerText.text(a)},_refreshCollapsed:function(a){var b=this;a&&!this.options.collapsable&&(a=!1),this.options.collapsed!==a&&(this.options.collapsed=a,this.updateConf(),a?(this._$collapser&&this._$collapser.removeClass(b.mode.collapseIcon).addClass(b.mode.uncollapseIcon),this._$header.addClass("nlui-collapsable-collapsed"),this._$contents.slideUp(this.options.animationDuration,function(){b.options.close()})):(this._$collapser&&this._$collapser.removeClass(this.mode.uncollapseIcon).addClass(this.mode.collapseIcon),this._$header.removeClass("nlui-collapsable-collapsed"),this._$contents.slideDown(this.options.animationDuration,function(){b.options.layoutManager.rebuildLayout(b.element),b.options.open()})))},_setOption:function(b,c){switch(b){case"legend":this._refreshLegend(c);break;case"collapsed":this._refreshCollapsed(c);break;case"collapsable":case"onConfigure":SO.assert(!1,"Option '"+b+"' cannot be changed dynamically.");break;default:a.NL.nlWidget.prototype._setOption.apply(this,arguments)}},append:function(a){this._$contents.append(a),this.options.layoutManager.rebuildLayout(this.element)},restoreConf:function(){var a=this.getConf();SO.isEmpty(a)||(this.options=SO.Utils.extend(this.options,a))},updateConf:function(){var a={collapsed:this.options.collapsed};this.saveConf(a)}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){var b={options:{params:null,obfuscate:!1,view:null,url:null,label:null,title:null,target:"_self",icon:null,iconMargin:null,withTooltip:!0,cssClass:"",ellipsis:0,ellipsisSymbol:null,html:!1,externalLink:!1,content:null},_create:function(){this.element.addClass("nlui-anchor")},_init:function(){var b,c=this,d=c.element.children();d.length>0&&d.not(".nlui-menu").remove();var e=NL.View.genLinkView(c.options);c.$linkImg=e.img,c.$link=e.link,c.options.withTooltip&&c.$link.soTooltip(),b=c._patchHref.call(c.$link,c),c.$link.click(function(a){return c.options.click?(c.options.click(function(a){a&&(window.location=c.$link.attr("href"))}),a.preventDefault(),!1):void 0});var f=a(".nlui-anchor-content-wrapper",c.$link);c.$linkImg?f.prepend(c.$linkImg):f.addClass("nlui-content-text-only"),c.$link.appendTo(c.element),c.options.content&&(a.isFunction(c.options.content)?c.options.content(c.$link):c.options.content instanceof a?c.$link.append(c.options.content):c.$link.append(SO.XSS.escapeXMLString(c.options.content)))},_patchHref:function(b){var c,d=a(this).attr("href");if(a(this).data("originalHref")?d=a(this).data("originalHref"):a(this).data("originalHref",d),SO.String.startsWith(d,"javascript:"))return a(this).attr("href",d),void 0;if(c=new SO.Structure.URL(d),"#"!==d){b.options.params&&c.query(b.options.params);var e="/xtk/dashboard.jssp"===b.options.url;!e&&!SO.isEmpty(b.options.url)||SO.isEmpty(document.__securitytoken)||c.query("__securitytoken",document.__securitytoken)}return a(this).attr("href",c.toString()),d},_setOption:function(){a.NL.nlWidget.prototype._setOption.apply(this,arguments),this._init()},destroy:function(){delete this.$link,delete this.$linkImg}};a.widget("NL.nlLinkView",a.NL.nlWidget,b)})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){NL.DCE.AdvancedPlugin=function(){NL.DCE.AdvancedPlugin.baseConstructor.apply(this,arguments),this.name="AdvancedPlugin"},SO.OO.extend(NL.DCE.AdvancedPlugin,NL.DCE.Plugin),NL.DCE.AdvancedPlugin.prototype._loadElement=function(a){var b=a.attr("id");SO.isEmpty(b)&&(b="");var c=a.attr("class");SO.isEmpty(c)&&(c="");var d=[],e=[];SO.Utils.each(c.split(" "),function(a,b){SO.String.startsWith(b,"nl_")?d.push(b):e.push(b)});var f=a.attr("style");SO.isEmpty(f)&&(f="");var g={id:{label:nms_contentEditor.plugin_advanced_id_label(),value:b},userClasses:{label:nms_contentEditor.plugin_advanced_class_label(),value:e.join(" ")},style:{label:nms_contentEditor.plugin_advanced_style_label(),value:f},dceClasses:{value:d}};return g},NL.DCE.AdvancedPlugin.prototype._saveElement=function(a,b){var c=a.getValue("id"),d=a.getValue("userClasses"),e=a.getValue("dceClasses"),f=e.split(" ").concat(d.split(" ")).join(" "),g=a.getValue("style"),h=b.attr("id"),i=b.attr("class"),j=b.attr("style");c!==h&&b.attr("id",c),f!==i&&b.attr("class",f),g!==j&&b.attr("style",g),this.controller.notifyElementChange(b)},NL.DCE.AdvancedPlugin.prototype._createController=function(a){var b=this,c=this._loadElement(a),d=new SO.MVC.Controller({model:c,onValueChanged:function(a,c){b._saveElement(c)}});return d},NL.DCE.AdvancedPlugin.prototype._createSidebarForm=function(a){var b=$("<div></div>").soQuickForm({},this._defaultSideBarFormConfig,{controller:a,attributes:["id","userClasses"]}),c=this._defaultSideBarSectionConfig({legend:nms_contentEditor.plugin_advanced_section_legend()}),d=$("<div></div>").nlCollapsableSection(c);return d.nlCollapsableSection("append",b),d},NL.DCE.AdvancedPlugin.prototype.getName=function(){return this.name},NL.DCE.AdvancedPlugin.prototype.fillSidebarSection=function(a,b){if(a.is(".nl-dce-field, .nl-dce-fragment"))return!1;var c=this._createController(a),d=this._createSidebarForm(c);return b.children().remove(),b.append(d),this._formControllers.push(c),!0},NL.DCE.AdvancedPlugin.prototype.getRegistration=function(){return["focusOn"]}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){var a="type",b="label_text",c="editableLabel",d="target",e="targetIFrame",f="externalLink",g="action",h="landingPage",i="landingPage_collection",j="service",k="service_collection",l="associated-link",m="type",n="action",o="landingPageLabel",p="landingPage",q="serviceLabel",r="service";NL.DCE.HyperLinkEditPlugin=function(){NL.DCE.HyperLinkEditPlugin.baseConstructor.apply(this,arguments),this.name="HyperLinkEditPlugin",this.label=nms_contentEditor.plugin_hyperLinkEdit_title(),this._$focus=void 0,this._$link=void 0,this._$sectionContent=void 0,this._sidebarController=void 0,this._advancedEditionController=void 0,this._insertionController=void 0,this._sidebarContent={url:void 0,warningNoPrevious:void 0,warningNoNext:void 0,action:void 0,landingPage:void 0,pUrl:void 0,service:void 0},this._advancedEditionContent={labelText:void 0,type:void 0,url:void 0,warningNoPrevious:void 0,warningNoNext:void 0,action:void 0,landingPage:void 0,service:void 0,pUrl:void 0,target:void 0,targetIFrame:void 0,labelHtml:void 0},this._insertionContent={labelText:void 0,url:void 0,action:void 0,landingPage:void 0,service:void 0,pUrl:void 0,target:void 0,targetIFrame:void 0,labelHtml:void 0}},SO.OO.extend(NL.DCE.HyperLinkEditPlugin,NL.DCE.Plugin),NL.DCE.HyperLinkEditPlugin.prototype._getAllFormContainers=function(a){var b={};"sidebar"===a.source?b=this._sidebarContent:"advancedEdition"===a.source?b=this._advancedEditionContent:"insertion"===a.source&&(b=this._insertionContent);var c=[];return SO.Utils.each(b,function(a,b){b&&c.push(b)}),c},NL.DCE.HyperLinkEditPlugin.prototype._onRefreshVisibility=function(b,e){SO.Utils.each(this._getAllFormContainers({source:e}),function(a,b){b.hide()});var f={};"sidebar"===e?f=this._sidebarContent:"advancedEdition"===e?f=this._advancedEditionContent:"insertion"===e&&(f=this._insertionContent);var h=b.getValue(a);if(("advancedEdition"===e||"insertion"===e)&&(b.getValue(c)?f.labelText.show():f.labelHtml.show(),this.config.hasLinkTarget)){f.target.show();var i=b.getValue(d);"other"===i&&f.targetIFrame.show()}switch("advancedEdition"===e&&f.type.show(),h){case"externalLink":f.url.show();break;case"action":f.action.show();var j=b.getValue(g);"insertion"!==e&&this.config.hasLinkAction&&(this.config.hasPreviousAction||"previous"!==j?this.config.hasNextAction||"next"!==j||f.warningNoNext.show():f.warningNoPrevious.show());break;case"landingPage":f.landingPage.show();break;case"pUrl":f.pUrl.show();break;case"subscription":case"unsubscription":f.service.show();break;default:this._$sectionContent.hide()}},NL.DCE.HyperLinkEditPlugin.prototype._newBareModel=function(){var l={},m={},n={},o=[];l[a]="externalLink",m[a]={label:nms_contentEditor.plugin_hyperLinkEdit_linkType(),type:"enum",params:{items:[{name:"externalLink",label:nms_contentEditor.plugin_hyperLinkEdit_ExternalLink()}]}},this.config.hasLinkAction&&m[a].params.items.push({name:"action",label:nms_contentEditor.plugin_hyperLinkEdit_Action()}),this.config.hasLandingPage&&m[a].params.items.push({name:"landingPage",label:nms_contentEditor.plugin_hyperLinkEdit_LandingPage()}),this.config.hasSubscriptionLink&&m[a].params.items.push({name:"subscription",label:nms_contentEditor.plugin_hyperLinkEdit_Subscription()}),this.config.hasUnsubscriptionLink&&m[a].params.items.push({name:"unsubscription",label:nms_contentEditor.plugin_hyperLinkEdit_Unsubscription()}),l[b]="",m[b]={label:nms_contentEditor.plugin_hyperLinkEdit_label(),type:"string"},o.push({jpath:b,method:function(a){return""===SO.String.trim(NL.XTK.toString(a.getValue(b)))&&a.getValue(c)?{valid:!1,message:nms_contentEditor.plugin_hyperLinkEdit_MandatoryLabel()}:{valid:!0,message:""}}}),l[c]=!0,m[c]={type:"boolean"},l[d]="default",m[d]={label:nms_contentEditor.plugin_hyperLinkEdit_target(),type:"enum",selection:"mono",params:{items:[{name:"default",label:nms_contentEditor.plugin_hyperLinkEdit_target_default()},{name:"_self",label:nms_contentEditor.plugin_hyperLinkEdit_target_self()},{name:"_blank",label:nms_contentEditor.plugin_hyperLinkEdit_target_blank()},{name:"_parent",label:nms_contentEditor.plugin_hyperLinkEdit_target_parent()},{name:"_top",label:nms_contentEditor.plugin_hyperLinkEdit_target_top()},{name:"other",label:nms_contentEditor.plugin_hyperLinkEdit_target_iframe()}]}},l[e]="",m[e]={label:nms_contentEditor.plugin_hyperLinkEdit_targetIFrame(),type:"string"},l[h]=null,l[i]=null;var p=this.controller.getConfManager().getConfig("list","landingPage");m[i]=$.extend(!0,{},p.controller._metamodel._getItem(p.jpath),{params:p}),m[h]={label:nms_contentEditor.plugin_hyperLinkEdit_landingPageChoice(),type:"itempicker",params:{inlineRenderer:function(a){var b=a instanceof SO.Selection?a.getItem():a;return NL.RenderFunctions.iconLabel({label:b.label,icon:b.icon})},source:i,dialogTitle:nms_contentEditor.plugin_landingPageDialog_title()}},o.push({jpath:h,method:function(b){return"landingPage"===b.getValue(a)&&SO.isEmpty(b.getValue(h))?{valid:!1,message:nms_contentEditor.plugin_hyperLinkEdit_MandatoryLandingPage()}:{valid:!0,message:""}}}),l[j]=null,l[k]=null;var q=this.controller.getConfManager().getConfig("list","subscription");return m[k]=$.extend(!0,{},q.controller._metamodel._getItem(q.jpath),{params:q}),m[j]={label:nms_contentEditor.plugin_hyperLinkEdit_serviceChoice(),type:"itempicker",params:{inlineRenderer:function(a){var b=a instanceof SO.Selection?a.getItem():a;return NL.RenderFunctions.iconLabel({label:b.label,icon:b.icon})},source:k,dialogTitle:nms_contentEditor.plugin_serviceDialog_title()}},o.push({jpath:j,method:function(b){return"subscription"!==b.getValue(a)&&"unsubscription"!==b.getValue(a)||!SO.isEmpty(b.getValue(j))?{valid:!0,message:""}:{valid:!1,message:nms_contentEditor.plugin_hyperLinkEdit_MandatoryService()}}}),l[f]="",m[f]={label:nms_contentEditor.plugin_hyperLinkEdit_externalLinkChoice(),type:"memo",params:{rows:2}},o.push({jpath:f,method:function(b){return"externalLink"===b.getValue(a)&&SO.isEmpty(b.getValue(f))?{valid:!1,message:nms_contentEditor.plugin_hyperLinkEdit_MandatoryExternalLink()}:{valid:!0,message:""}}}),l[g]="",m[g]={label:nms_contentEditor.plugin_hyperLinkEdit_Action(),type:"enum",selection:"mono",params:{items:[{name:"",label:nms_contentEditor.pageAction_empty_action()},{name:"none",label:nms_contentEditor.pageAction_noAction()},{name:"refresh",label:nms_contentEditor.pageAction_Refresh()}]}},o.push({jpath:g,method:function(b){return"action"===b.getValue(a)&&SO.isEmpty(b.getValue(g))?{valid:!1,message:nms_contentEditor.plugin_hyperLinkEdit_MandatoryAction()}:{valid:!0,message:""}}}),this.config.hasLinkAction&&this.config.hasPreviousAction&&m[g].params.items.push({name:"previous",label:nms_contentEditor.pageAction_PreviousPage()}),this.config.hasLinkAction&&this.config.hasNextAction&&m[g].params.items.push({name:"next",label:nms_contentEditor.pageAction_NextPage()}),{model:l,metamodel:m,statemodel:n,checks:o}},NL.DCE.HyperLinkEditPlugin.prototype._loadElement=function(i){var k={},l=i;l&&0!==l.length||(l=$());var s=!this._isLinkContentComplex(l.html()),t=l.nlData(m);t?k[a]=NL.XTK.toString(t):(k[a]="externalLink",t=k[a]),k[c]=s,s&&(k[b]=l.text());var u=NL.XTK.toString(l.attr("target")),v="";switch(SO.isEmpty(u)?u="default":(u=u.toLowerCase(),"_self"!==u&&"_blank"!==u&&"_parent"!==u&&"_top"!==u&&(u="other",v=u)),k[d]=u,k[e]=v,t){case"landingPage":var w=l.nlData(p);if(w){var x=l.nlData(o);SO.isEmpty(x)&&(x=w),k[h]=new SO.Selection({selectionMode:"mono",items:[{name:w,label:x}]})}break;case"subscription":case"unsubscription":var w=l.nlData(r);if(w){var x=l.nlData(q);SO.isEmpty(x)&&(x=w),k[j]=new SO.Selection({selectionMode:"mono",items:[{name:w,label:x}]})}break;case"action":k[g]=NL.XTK.toString(l.nlData(n));break;case"externalLink":l.length>0&&(k[f]=NL.XTK.toString(l[0].getAttribute("href")))}return k},NL.DCE.HyperLinkEditPlugin.prototype._resetElement=function(){this._$link.attr("href","#"),this._$link.nlData(p,null),this._$link.nlData(o,null),this._$link.nlData(r,null),this._$link.nlData(q,null),this._$link.nlData(n,null)},NL.DCE.HyperLinkEditPlugin.prototype._resetChangeInCollector=function(a){a.unsetChange(g,"value"),a.unsetChange(f,"value"),a.unsetChange(h,"value"),a.unsetChange(j,"value")},NL.DCE.HyperLinkEditPlugin.prototype._resetValues=function(a){var b={};b[g]="",b[f]="",b[h]=null,b[j]=null,a.setValues(b,!0)},NL.DCE.HyperLinkEditPlugin.prototype._changeElement=function(i,k,l,s){var t=[];switch(i){case h:var u=k.getItem();s||(this._resetElement(),this._$link.nlData(p,u.name),this._$link.nlData(o,u.label));var v={};v[p]=u.name,v[o]=u.label,t.push({type:"data",value:v});break;case j:var u=k.getItem();s||(this._resetElement(),this._$link.nlData(r,u.name),this._$link.nlData(q,u.label));var v={};v[r]=u.name,v[q]=u.label,t.push({type:"data",value:v});break;case g:s||(this._resetElement(),this._$link.nlData(n,k));var v={};v[n]=k,t.push({type:"data",value:v});break;case d:case e:var w=l.getValue(d),x=l.getValue(e);s||("default"===w?this._$link.removeAttr("target"):"other"===w?this._$link.attr("target",x):this._$link.attr("target",w)),"other"===w?t.push({type:"attribute",value:{target:x}}):"default"!==w&&t.push({type:"attribute",value:{target:w}});break;case f:var y="";k&&(y=k.replace(/\r\n|\r|\n/gm,""),y.match(/^www/)&&(y="http://"+y)),!s&&k&&(this._resetElement(),this._$link.attr("href",y)),k&&t.push({type:"attribute",value:{href:y}});break;case b:var z=l.getValue(c),A=SO.HTMLUtils.htmlEncode(k);!s&&z&&this._$link.html(A),z&&t.push({type:"content",value:A})}var B=l.getValue(a);s||this._$link.nlData(m,B);var C={};return C[m]=B,t.push({type:"data",value:C}),t},NL.DCE.HyperLinkEditPlugin.prototype._saveElement=function(a,b,c){var d=this;if(c){var e={tag:"a",content:"",attributes:{href:"#"},data:{}};return SO.Utils.each(b,function(b,c){var f=d._changeElement(c.jpath,c.value,a,!0);SO.Utils.each(f,function(a,b){"content"===b.type?e.content=b.value:"attribute"===b.type?e.attributes=$.extend({},e.attributes,b.value):"data"===b.type&&(e.data=$.extend({},e.data,b.value))})}),e}return SO.Utils.each(b,function(b,c){d._changeElement(c.jpath,c.value,a)}),null},NL.DCE.HyperLinkEditPlugin.prototype._genHiddenMarkup=function(c){var i={};return"sidebar"===c.source?i=this._sidebarContent:"advancedEdition"===c.source?i=this._advancedEditionContent:"insertion"===c.source&&(i=this._insertionContent),("advancedEdition"===c.source||"insertion"===c.source)&&(i.labelText=$('<div data-nl-jpath="'+b+'"></div>'),i.labelHtml=$('<div class="nlui-dceplugin-hyperlinkedit-notEditableLabel"></div>').append(nms_contentEditor.plugin_hyperLinkEdit_LabelTooComplex())),"advancedEdition"===c.source&&(i.type=$('<div data-nl-jpath="'+a+'"></div>')),i.url=$('<div data-nl-jpath="'+f+'"></div>'),i.action=$('<div data-nl-jpath="'+g+'"></div>'),i.warningNoPrevious=$("<div></div>").soActionMessage({message:nms_contentEditor.plugin_hyperLinkEdit_WarnNoPrevious(),state:"warning",displayIcon:"message"}),i.warningNoNext=$("<div></div>").soActionMessage({message:nms_contentEditor.plugin_hyperLinkEdit_WarnNoNext(),state:"warning",displayIcon:"message"}),i.landingPage=$('<div data-nl-jpath="'+h+'"></div>'),("advancedEdition"===c.source||"insertion"===c.source)&&(i.target=$('<div data-nl-jpath="'+d+'"></div>'),i.targetIFrame=$('<div data-nl-jpath="'+e+'"></div>')),i.service=$('<div data-nl-jpath="'+j+'"></div>'),this._getAllFormContainers(c)},NL.DCE.HyperLinkEditPlugin.prototype._showHyperlinkInsertionEditor=function(){var a=this,b=$("<div></div>").addClass("nl-dce-dialog").append(a._genHiddenMarkup({source:"insertion"})),c=[{text:xtk_core.dialog_cancel(),cancels:!0},{text:xtk_core.dialog_ok(),mode:"primary",click:function(){var b=this;a._insertionController.save(function(a){a&&$(b).soDialog("close")})}}],d=$.extend({},this._defaultEditFormConfig,{controller:a._insertionController,onRefreshVisibility:function(b){a._onRefreshVisibility(b,"insertion")}});b.nlForm(d),b.soDialog({modal:!0,width:600,height:"auto",mode:"auto",resizable:!1,title:nms_contentEditor.plugin_hyperLinkEdit_dialogTitle_insertion(),noPrimaryFirstButton:!0,open:function(){b.nlForm("rebuildLayout"),setTimeout(function(){b.soDialog("getButton","cancel").focus()},0)},close:function(){b.nlForm("destroy"),b.soDialog("destroy"),b.remove()},cancel:function(){a.controller.getContentEditor().restoreBookmark()},buttons:c,dialogClass:"nl-dce-dialog"})},NL.DCE.HyperLinkEditPlugin.prototype._isLinkContentComplex=function(a){var b,c=!1,d=$("<span></span>").append(a)[0].childNodes;for(b=0;d.length>b;b++)if(3!==d[b].nodeType){c=!0;break}return c},NL.DCE.HyperLinkEditPlugin.prototype._insertLink=function(d){var e=this,f=this.controller.getContentEditor().getSelectionContent(!0),g=this._loadElement(null);g[c]=!e._isLinkContentComplex(f);var h=new NL.DCE.ChangeCollector,i=this._applyValuesOnModel(this._newBareModel(),g);e._insertionController=new SO.MVC.Controller({model:i.model,metamodel:i.metamodel,statemodel:i.statemodel,onCheck:i.checks,onSave:function(a){h.stop();var b=h.getChanges(),c=e._saveElement(a.controller,b,!0);return e._$link=e.controller.insertNodeAtSelection(c.tag,c.content,c.attributes,c.data),e._$focus=e._$link,e.controller.notifyInsertion(e._$link,!0),e.controller.forceSelectBlock(e._$link,!1,"start"),a.success(),a.complete(),null}}),h.reset(),h.start(e._insertionController),this._formControllers.push(this._insertionController),e._insertionController.setValue(a,d,!0),g[c]&&e._insertionController.setValue(b,SO.HTMLUtils.htmlDecode(f),!0),this._showHyperlinkInsertionEditor()},NL.DCE.HyperLinkEditPlugin.prototype._insertParentLink=function(b,d){var e=this;e._$focus=b;var f=this._loadElement(null);f[c]=!1;var g=new NL.DCE.ChangeCollector,h=this._applyValuesOnModel(this._newBareModel(),f);e._insertionController=new SO.MVC.Controller({model:h.model,metamodel:h.metamodel,statemodel:h.statemodel,onCheck:h.checks,onSave:function(a){g.stop();var b=g.getChanges();return e._$link=e.controller.conservativeWrap(e._$focus,"a"),e._$link.attr("href","#"),e._saveElement(a.controller,b),e._$focus.nlData(l,e._$link.attr("id")),e.controller.notifyElementChange(e._$focus),a.success(),a.complete(),null},onRefreshVisibility:function(a){e._onRefreshVisibility(a,"insertion")}}),g.reset(),g.start(e._insertionController),this._formControllers.push(this._insertionController),e._insertionController.setValue(a,d,!0),this._showHyperlinkInsertionEditor()},NL.DCE.HyperLinkEditPlugin.prototype._breakLink=function(){var a=this._$link,b=a.html(),c=a.parent();a.replaceWith(b),this.controller.forceSelectBlock(c,!1,"start")},NL.DCE.HyperLinkEditPlugin.prototype._breakParentLink=function(a){this._$link=this._getParentLink(a),this._$focus=a;var b=this._$link,c=a.attr("id"),d=!1;c||(c=this.controller.getContentEditor().getNewId("focus"),a.attr("id",c),d=!0);var e=b.html();b.replaceWith(e);var f=this.controller.getContentElement("#"+c);this.controller.forceSelectBlock(f,!1,"start"),d&&f.attr("id","")},NL.DCE.HyperLinkEditPlugin.prototype._canHaveParentLink=function(a){return"img"===a.get(0).nodeName.toLowerCase()},NL.DCE.HyperLinkEditPlugin.prototype._getParentLink=function(a){var b=a.nlData(l),c=a.closest("a#"+b);if(0===c.length){var d=a.parent();this._isLinkNode(d)&&1===d.children().length&&(c=d)}return c},NL.DCE.HyperLinkEditPlugin.prototype._isLinkNode=function(a){return"a"===a.get(0).nodeName.toLowerCase()},NL.DCE.HyperLinkEditPlugin.prototype._isButtonNode=function(a){return"button"===a.get(0).nodeName.toLowerCase()},NL.DCE.HyperLinkEditPlugin.prototype.getName=function(){return this.name},NL.DCE.HyperLinkEditPlugin.prototype.getLabel=function(){return this.label},NL.DCE.HyperLinkEditPlugin.prototype.getRegistration=function(){return["insertion","message","over","focusOn","advancedEdition"]},NL.DCE.HyperLinkEditPlugin.prototype.onSubtreeInsertion=function(a){a.find("a").each(function(a,b){$(b).unbind("click"),b.onclick=function(){}})},NL.DCE.HyperLinkEditPlugin.prototype.updateSidebarSection=function(a,b){var c=a&&this._canHaveParentLink(a);if(0!==a.closest("button").length||this._isButtonNode(a))this._$sectionContent.hide();else{SO.assert(void 0!==this._sidebarController,"HyperLinkEditPlugin.updateSidebarSection called without a controller"),this._$focus=a;var d=!1;if(c){var e=this._getParentLink(a);e.length>0&&(this._$link=e,d=!0)}else this._isLinkNode(a)&&(this._$link=a,d=!0);d?(this._sidebarController.setValues(this._loadElement(this._$link),!b),this._$sectionContent.show()):this._$sectionContent.hide()}},NL.DCE.HyperLinkEditPlugin.prototype.fillSidebarSection=function(a,b){this._$focus=a;var c=this,d=!1,e=a&&this._canHaveParentLink(a);if(e){var f=this._getParentLink(a);f.length>0&&(this._$link=f,d=!0)}else a&&this._isLinkNode(a)&&(this._$link=a,d=!0);if(a&&d&&0===a.closest("button").length&&!this._isButtonNode(a)){if(this._$sectionContent)this._$sectionContent.show(),this.updateSidebarSection(a,!0);else{var g=this._applyValuesOnModel(this._newBareModel(),this._loadElement(this._$link)),h=nms_contentEditor.plugin_hyperLinkEdit_title();"landingPage"===g.model.type&&(h=nms_contentEditor.plugin_hyperLinkEdit_title_landingPage()),"pUrl"===g.model.type&&(h=nms_contentEditor.plugin_hyperLinkEdit_title_pUrl()),"subscription"===g.model.type&&(h=nms_contentEditor.plugin_hyperLinkEdit_title_subscription()),"unsubscription"===g.model.type&&(h=nms_contentEditor.plugin_hyperLinkEdit_title_unsubscription());var i=this._defaultSideBarSectionConfig({legend:h,configIcon:"coral-more",onConfigure:function(){c.controller.notifyAdvancedEdition(c._$focus,"sidebar",c.getName())}});this._$sectionContent=$('<div class="nlui-dceplugin-hyperlinkedit"></div>').nlCollapsableSection(i);var j=$("<div></div>").append(this._genHiddenMarkup({source:"sidebar"}));this._sidebarController=new SO.MVC.Controller({model:g.model,metamodel:g.metamodel,statemodel:g.statemodel,onCheck:g.checks,onValueChanged:function(a,b,d,e){c._changeElement(a,e,b),c.controller.notifyElementChange(c._$focus)},onRefreshVisibility:function(a){c._onRefreshVisibility(a,"sidebar")}}),this._formControllers.push(this._sidebarController),this._$sectionContent.nlCollapsableSection("append",j);var k=$.extend({},this._defaultSideBarFormConfig,{controller:this._sidebarController});j.nlForm(k),b.append(this._$sectionContent)}return!0}return this._$sectionContent&&this._$sectionContent.hide(),!1},NL.DCE.HyperLinkEditPlugin.prototype.getAdvancedEditionData=function(b){if(this._isLinkNode(b)||this._canHaveParentLink(b)&&this._getParentLink(b).length>0){var c=this;if(this._$focus=b,this._canHaveParentLink(b)){var d=this._getParentLink(this._$focus);d.length>0&&(this._$link=d)}else this._isLinkNode(this._$focus)&&(this._$link=this._$focus);this._genHiddenMarkup({source:"advancedEdition"});var e=new NL.DCE.ChangeCollector({onChange:function(b,d,e,f){b===a&&(c._resetValues(e),c._resetChangeInCollector(f))}}),f=this._applyValuesOnModel(this._newBareModel(),this._loadElement(this._$link));this._advancedEditionController=new SO.MVC.Controller({model:f.model,metamodel:f.metamodel,statemodel:f.statemodel,onCheck:f.checks,onSave:function(a){e.stop();var b=e.getChanges();return c._saveElement(a.controller,b),a.success(),a.complete(),null},onRefreshVisibility:function(a){c._onRefreshVisibility(a,"advancedEdition")}}),this._formControllers.push(this._advancedEditionController),e.reset(),e.start(this._advancedEditionController);var g=$.extend({},this._defaultEditFormConfig,{controller:this._advancedEditionController});return{content:this._getAllFormContainers({source:"advancedEdition"}),formConfig:g}}return null},NL.DCE.HyperLinkEditPlugin.prototype.getOverCommandNames=function(a){if(this._isLinkNode(a)||this._canHaveParentLink(a)&&this._isLinkNode(a.parent())){var b,c=[];if(this._canHaveParentLink(a)){var d=this._getParentLink(a);d.length>0&&(b=d)}else this._isLinkNode(a)&&(b=a);return c}return[]},NL.DCE.HyperLinkEditPlugin.prototype.getOverCommands=function(){return[]},NL.DCE.HyperLinkEditPlugin.prototype.getEditionCommands=function(){var a=this,b=[{where:"insertSection",command:{name:"hyperLink_link",icon:"coral-link",help:nms_contentEditor.plugin_hyperLinkEdit_EditLink(),action:function(b){a.controller.notifyAdvancedEdition(b,"sidebar",a.getName())}}},{where:"insertSection",command:{name:"hyperLink_breakLink",icon:"coral-linkOff",help:nms_contentEditor.plugin_hyperLinkEdit_breakLink(),action:function(b){var c=b.parent();$("<div></div>").soMessageBox({type:"confirm",message:nms_contentEditor.plugin_hyperLinkEdit_confirmBreakingLink(),onConfirm:function(){a._$focus=b,a._isLinkNode(b)?(a._$link=b,a._breakLink(b)):a._canHaveParentLink(b)&&a._breakParentLink(b),a.controller.notifyDeletion(c,b)}})}}},{where:"linkMenu",command:{name:"hyperLink_externalLink",icon:"coral-link",iconSize:18,label:nms_contentEditor.plugin_hyperLinkEdit_externalLink(),action:function(b){a._$focus=b,a._canHaveParentLink(b)?a._insertParentLink(b,"externalLink"):a._insertLink("externalLink")}}},{where:"linkMenu",command:{name:"hyperLink_actionLink",icon:"coral-linkNav",iconSize:18,label:nms_contentEditor.plugin_hyperLinkEdit_actionLink(),action:function(b){a._$focus=b,a._canHaveParentLink(b)?a._insertParentLink(b,"action"):a._insertLink("action")}}},{where:"linkMenu",command:{name:"hyperLink_landingPageLink",icon:"coral-linkLandingPage",iconSize:18,label:nms_contentEditor.plugin_hyperLinkEdit_landingPageLink(),action:function(b){a._$focus=b,a._canHaveParentLink(b)?a._insertParentLink(b,"landingPage"):a._insertLink("landingPage")}}},{where:"linkMenu",command:{name:"hyperLink_assetPicker",icon:"link-purl",iconSize:18,label:"Insert from Asset Selector",action:function(b){function c(a){if("CloseDCEMacDlg"==a.data&&!d){var b=g.contents().get(0).getElementById("aemSelectedContent").value;e.attr("href",b),e.append(b),f.soDialog("close")}}var d=!1;a._$focus=b;var e=b,f=$('<div class="aemSelectDialog" style="display:none;"></div>'),g=$('<iframe src ="'+NL.session.serverURL+'/nms/assetpicker.jssp?action=asset" height="100%" width="100%" ></iframe>');f.append(g),window.addEventListener?window.addEventListener("message",c,!1):window.attachEvent&&window.attachEvent("onmessage",c,!1),f.soDialog({width:1200,height:1200,autoOpen:!0,title:"Adobe Marketing Cloud Asset Selector",modal:!0,buttons:[{label:nms_contentEditor.dialog_cancel(),cancels:!0,click:function(){d=!0}}],open:function(){},cancel:function(){this.close()}})}}},{where:"linkMenu",command:{name:"hyperLink_pUrlLink",icon:"link-purl",iconSize:18,label:nms_contentEditor.plugin_hyperLinkEdit_pUrlLink(),action:function(b){a._$focus=b,a._canHaveParentLink(b)?a._insertParentLink(b,"pUrl"):a._insertLink("pUrl")}}},{where:"linkMenu",command:{name:"hyperLink_subscriptionLink",icon:"coral-linkSubscribe",iconSize:18,label:nms_contentEditor.plugin_hyperLinkEdit_subscriptionLink(),action:function(b){a._$focus=b,a._canHaveParentLink(b)?a._insertParentLink(b,"subscription"):a._insertLink("subscription")}}},{where:"linkMenu",command:{name:"hyperLink_unsubscriptionLink",icon:"coral-linkUnsubscribe",iconSize:18,label:nms_contentEditor.plugin_hyperLinkEdit_unsubscriptionLink(),action:function(b){a._$focus=b,a._canHaveParentLink(b)?a._insertParentLink(b,"unsubscription"):a._insertLink("unsubscription")}}}];return b},NL.DCE.HyperLinkEditPlugin.prototype.getTextCommandNames=function(a){if(!this.controller.isEditableElement(a)&&!this._canHaveParentLink(a)||0!==a.closest("button").length||this._isButtonNode(a))return{names:[],advancedEdition:!1};var b=this._getParentLink(a);if(this.controller.isEditableElement(a)||this._canHaveParentLink(a)||0!==b.length){var c=this._isLinkNode(a)||this._canHaveParentLink(a)&&b.length>0,d=a.closest("a, button").length>0,e=[];return c&&e.push("hyperLink_breakLink"),c||d||(e.push("hyperLink_externalLink"),this.config.hasLinkAction&&e.push("hyperLink_actionLink"),this.config.hasLandingPage&&e.push("hyperLink_landingPageLink"),this.config.hasSubscriptionLink&&e.push("hyperLink_subscriptionLink"),this.config.hasUnsubscriptionLink&&e.push("hyperLink_unsubscriptionLink"),e.push("hyperLink_assetPicker")),{names:e,advancedEdition:!1}}return{names:[],advancedEdition:!1}},NL.DCE.HyperLinkEditPlugin.prototype.getPropertiesCommandNames=function(a){if(this._canHaveParentLink(a)&&0===a.closest("button").length&&!this._isButtonNode(a)){var b=this._getParentLink(a),c=this._isLinkNode(a)||b.length>0,d=a.closest("a, button").length>0,e=[];return c&&(e.push("hyperLink_link"),e.push("hyperLink_breakLink")),c||d||(e.push("hyperLink_externalLink"),this.config.hasLinkAction&&e.push("hyperLink_actionLink"),this.config.hasLandingPage&&e.push("hyperLink_landingPageLink"),this.config.hasSubscriptionLink&&e.push("hyperLink_subscriptionLink"),this.config.hasUnsubscriptionLink&&e.push("hyperLink_unsubscriptionLink")),{names:e,advancedEdition:!1}}return{names:[],advancedEdition:!1}},NL.DCE.HyperLinkEditPlugin.prototype.getMessages=function(){var a=[];return a}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlNotebook",a.NL.nlWidget,{options:{tabs:[],height:null,defaultSelected:null,layout:"vertical",sortable:!1,checkbox:!1,removable:!1,leftIcon:void 0,rightIcon:void 0,className:"",defaultContent:null,onSelect:function(){},onCheck:function(){},onRemove:function(){},onMoved:function(){}},_create:function(){var b=this;this._maxChars="vertical"===this.options.layout?15:25,this._tabs=[],this._extraTabs=[],this.$ul=void 0,this.$contents=void 0,this.$defaultContent=void 0,this._selectedTab=void 0,this._dragPosition=-1,this.draggableClass="nlui-notebook-drag",this.element.addClass("nlui-notebook"),"vertical"===this.options.layout?this.element.addClass("nlui-vertical-notebook"):this.element.addClass("nlui-horizontal-notebook"),this.$ul=a('<ul class="nlui-notebook-nav"></ul>').appendTo(this.element),this.$contents=a("<div class='nlui-notebook-content'></div>").appendTo(this.element),SO.isEmpty(b.options.defaultContent)||(this.$defaultContent=a('<div class="default-content"></div>').append(b.options.defaultContent).appendTo(this.$contents));for(var c=0;b.options.tabs.length>c;c++){if(void 0===b.options.tabs[c].id)throw new Error("id mandatory");b.options.tabs[c].extra?b.addExtraTab(b.options.tabs[c],!0,!1):b.addTab(b.options.tabs[c],!0,!1)}this.options.sortable&&("vertical"===this.options.layout?(this.element.addClass("nlui-notebook-sortable"),this.$ul.sortable({axis:"y",items:"> .nlui-notebook-tab",zIndex:10002,placeholder:"nlui-notebook-tab-dropzone",handle:".nlui-notebook-tab-grip",start:function(a,c){var d=c.item.data("tabId");b._select(b._getTab(d)),b._dragPosition=b._getTab(d).index,c.helper.height("").width("")},stop:function(a,c){var d=c.item.index();-1!==b._dragPosition&&(b._moveTab(b._dragPosition,d),SO.isFunction(b.options.onMoved)&&b.options.onMoved(b._selectedTab.id,b._dragPosition,d),b._dragPosition=-1)}})):b.$ul.nlDroppable({type:"listOfDraggables",draggableSelector:"."+b.draggableClass,onMove:function(a,c){-1!==b._dragPosition&&(b._moveTab(b._dragPosition,c),SO.isFunction(b.options.onMoved)&&b.options.onMoved(b._selectedTab.id,b._dragPosition,c),b._dragPosition=-1)}})),b.refresh()},addTab:function(a,b,c){void 0===a.display&&(a.display=!0),void 0===a.leftIcon&&(a.leftIcon=this.options.leftIcon),void 0===a.rightIcon&&(a.rightIcon=this.options.rightIcon),void 0===a.className&&(a.className=this.options.className),SO.assert(!SO.isEmpty(a.caption),"Tab captions should be defined for the notebook widget, instead seen :"+a.caption),a.fullCaption=SO.isString(a.caption)?a.caption:"",this._tabs.push(a),c&&(this._selectedTab=a),b||this.refresh()},showTab:function(a){var b=this._getTab(a);b.display=!0,this.refresh()},hideTab:function(a){var b=this._getTab(a);b.display=!1,this.refresh()},addExtraTab:function(a,b){this._extraTabs.push(a),b||this.refresh()},setTabOption:function(a,b,c,d,e){var f={};e=void 0===e?!1:e,f[b]=c,this.setTabOptions(a,f,d,e)},setTabOptions:function(b,c,d,e){var f,g,h;e=void 0===e?!1:e,e?(g=this._extraTabs,h="_getExtraTab"):(g=this._tabs,h="_getTab"),f="string"==typeof b?this[h](b):g[b],f&&(a.each(c,function(a,b){f[a]=b}),d!==!0&&this.refresh())},setExtraTabOption:function(a,b,c,d){this.setTabOption(a,b,c,d,!0)},setExtraTabOptions:function(a,b,c){this.setTabOption(a,b,c,!0)},_getExtraTab:function(b){var c,d;return c=this,d={index:-1},a.each(c._extraTabs,function(a,c){return b===c.id?(d=SO.Utils.extend(c,{index:a}),!1):void 0}),d},_drawTab:function(b){var c=this,d=a('<li class="nlui-notebook-tab"></li>').data("tabId",b.id).addClass(b.className).appendTo(this.$ul),e=a('<div class="nlui-notebook-tab-content"></div>').appendTo(d);if(this.options.sortable){d.addClass(c.draggableClass);var f=a('<span class="nlui-notebook-tab-grip"></span>').appendTo(e);NL.View.genImage("nlui-icon-notebook-grip",null,!1,0).appendTo(f)}if(this.options.checkbox){var g=a('<input class="nlui-notebook-tab-checkbox" type="checkbox">').appendTo(e);g.on("click",function(){var a=g.prop("checked");c._toggleChecked(b,a)}),b.checked===!0&&g.prop("checked",!0)}var h=b.leftIcon;if(h){var i=a('<span class="nlui-notebook-tab-lefticon"></span>').appendTo(e);NL.View.genImage(h,null,!1,0).appendTo(i)}var j,k;(b.removable||void 0===b.removable&&this.options.removable)&&(b.$li=d,k=a('<span class="icon-wrapper nlui-notebook-tab-removebt"></span>').appendTo(e),j=a("<span>&nbsp;</span>").addClass("ui-icon nlui-icon ui-icon-closethick close").appendTo(k));var l=b.rightIcon;if(l){var m=a('<span class="nlui-notebook-tab-righticon"></span>').appendTo(e);NL.View.genImage(l,null,!1,0).appendTo(m)}var n=a('<span class="nlui-notebook-tab-label"></span>').appendTo(e);SO.isEmpty(b.caption)||n.text(b.caption),b.fullCaption.length>this._maxChars&&c._setTooltip(d,b.fullCaption),b.sortable||void 0===b.sortable&&this.options.sortable?"horizontal"===this.options.layout&&(d.nlDraggable({clone:!1,draggableOptions:{cursor:"none"},onStart:function(a,d,e){e.helper.addClass("nlui-state-selected"),c._select(b),c._dragPosition=c._getTab(b.id).index}}),c.$ul.nlDroppable("makeInsertion")):d.find(".grip").remove(),void 0!==j&&j.click(function(a){c._removeTab(b.id),a.stopPropagation()}),d.on("click",function(){c._tabClicked(b.id)}),b.$li=d,b.$labelWrapper=n},_drawExtraTab:function(b,c){var d=this,e={},f=a('<li class="nlui-notebook-extratab"></li>');c&&f.addClass("nlui-notebook-extratab-first"),f.appendTo(d.$ul),SO.isEmpty(b.leftIcon)||(e.icon=b.leftIcon),SO.isEmpty(b.rightIcon)||(e.rightIcon=b.rightIcon),SO.isEmpty(b.caption)||(e.label=b.caption),b.mode&&(e.mode=b.mode),SO.isNundef(b.disabled)||(e.disabled=b.disabled),a.isFunction(b.onClick)&&(e.onClick=b.onClick),f.soButton(e)},_tabClicked:function(a){this._select(this._getTab(a))},switchTab:function(a){SO.isEmpty(a)||this._select(this._getTab(a))},_select:function(a){SO.assert(a&&a.id,"In Notebook widget, tried to select a tab with an unexisting ID or index.");var b=null;if(this._selectedTab&&(b=this._selectedTab.id,this._selectedTab.$li.removeClass("nlui-state-selected"),this._selectedTab.$li.is(":so-soTooltip")&&this._selectedTab.$li.soTooltip("enable"),SO.isEmpty(this._selectedTab.caption)||this._selectedTab.$labelWrapper.text(this._selectedTab.caption),this._selectedTab.$target&&this._selectedTab.$target.hide(),this._selectedTab=null),this.$defaultContent&&this.$defaultContent.hide(),this._selectedTab=a,a.$li.addClass("nlui-state-selected"),!a.$target){var c;c=a.selector?a.selector:a.content(),this.$contents.append(c),a.$target=c}a.$target.show(),this.options.layoutManager.rebuildLayout(a.$target),a.fullCaption.length<this._maxChars?(this._selectedTab.$li.is(":so-soTooltip")&&a.$li.soTooltip("disable"),a.$labelWrapper.text(a.fullCaption)):SO.isEmpty(a.caption)||a.$labelWrapper.text(a.caption),this.options.onSelect(this._selectedTab.id,a.$target,b)},_toggleChecked:function(a,b){a.checked=b,this.options.onCheck(a.id,a.checked)},_removeTab:function(b){var c,d,e,f=this;c=f._getTab(b),d=c.$li,e=c.$target,d.soTooltip("hide"),d.slideUp(250,function(){d.remove();var g=-1;a.each(f._tabs,function(a,b){return c.id===b.id?(g=a,!1):void 0}),e.remove(),f._tabs.splice(g,1),c.id===f._selectedTab.id&&f._tabs.length>0&&(g>=f._tabs.length&&g--,f._select(f._tabs[g])),!f._tabs.length&&f.$defaultContent&&(f.$defaultContent.show(),f.refresh()),f.options.onRemove(b)})},refresh:function(){var b,c=this;c.$ul.empty();for(var d=0;c._tabs.length>d;d++)c._tabs[d].display&&(c._drawTab(c._tabs[d]),c._tabs[d].selected===!0&&(c._selectedTab=c._tabs[d]));if(c._extraTabs.length>0)for(d=0;c._extraTabs.length>d;d++)b=!1,0===d&&c._tabs.length>0&&(b=!0),c._drawExtraTab(c._extraTabs[d],b);if(c._tabs.length>0)if(c._selectedTab)c._select(c._selectedTab);else if(SO.isNundef(this.options.defaultSelected))c._select(c._tabs[0]);else if(SO.isNumber(this.options.defaultSelected))c._select(c._tabs[this.options.defaultSelected]);else{var e=this._getTab(this.options.defaultSelected).index;c._select(c._tabs[e])}else c.$defaultContent&&c.$defaultContent.show();if("vertical"===this.options.layout){var f=0;this.$ul.children(".nlui-notebook-tab").each(function(){f+=a(this).outerHeight(),f+=5}),this.$ul.children(".nlui-notebook-extraTab").each(function(){f+=a(this).outerHeight(),f+=5}),SO.isNundef(this.options.height)?this.$contents.css("min-height",f+10):this.$contents.css("min-height",NL.XTK.parseNumber(this.options.height,null))}else{var b=this.$ul.children(".nlui-notebook-tab:first");b.addClass("firstTab"),SO.isNundef(this.options.height)||this.$contents.css("min-height",NL.XTK.parseNumber(this.options.height,null))}},_setTooltip:function(a,b){var c="e";c="vertical"===this.options.layout?"e":"s",SO.assert(-1===b.indexOf("[object")),a.attr("original-title",b).soTooltip({gravity:c})},_getTab:function(b){var c=this,d={index:0};return a.each(c._tabs,function(a,c){return b===c.id?(d=SO.Utils.extend(c,{index:a}),!1):void 0}),d},_moveTab:function(a,b){if(0>a||0>b)throw new Error("trying to switch array value with a negative numeric index");if(a>this._tabs.length||b>this._tabs.length)throw new Error("trying to switch array values with an unexisting index value ");this._tabs.splice(b,0,this._tabs.splice(a,1)[0])}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.MVC"),NL.DCE.ChangeCollector=function(a){this.options=$.extend({},a),this._controller=void 0,this._observer=void 0,this._changes=new SO.Structure.Set([],function(a,b){return a.jpath===b.jpath&&a.action===b.action})},NL.DCE.ChangeCollector.prototype.start=function(a){this._controller=a;var b=this;this._observer=function(a,c,d,e){b.setChange(a,"value",e),b.options.onChange&&b.options.onChange.call(this._controller,a,d,e)},this._controller.registerOnValueChanged(this._observer)},NL.DCE.ChangeCollector.prototype.stop=function(){void 0!==this._observer&&(this._controller.unregisterOnValueChanged(this._observer),this._observer=void 0)},NL.DCE.ChangeCollector.prototype.setChange=function(a,b,c){0===this._changes.size()&&this.options.onDirty&&this.options.onDirty.call(this._controller,a,!1,!0),this._changes.update({jpath:a,action:b,value:c})},NL.DCE.ChangeCollector.prototype.unsetChange=function(a,b){this._changes.remove({jpath:a,action:b})},NL.DCE.ChangeCollector.prototype.reset=function(){if(this._changes.size()>0&&this.options.onDirty)for(var a=this.getChanges(),b=0;a.length>b;b++){var c=a[b].jpath;this.options.onDirty.call(this._controller,c,!0,!1)}this._changes.clear()},NL.DCE.ChangeCollector.prototype.getChanges=function(){return this._changes.toArray()};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){var a="nl-dce-translate",b="nl-dce-translate-highlight",c="localizable";NL.DCE.LocalizablePlugin=function(){NL.DCE.LocalizablePlugin.baseConstructor.apply(this,arguments),this.name="LocalizablePlugin",this.label=nms_contentEditor.plugin_localizable_title(),this._$focus=void 0,this._$localizedParent=void 0,this._$sectionContent=void 0,this._sidebarController=void 0,this._$localizationFlag=void 0,this._$specialMessage=void 0},SO.OO.extend(NL.DCE.LocalizablePlugin,NL.DCE.Plugin),NL.DCE.LocalizablePlugin.prototype._newBareModel=function(){var a={},b={},c={};return a.translate=!1,b.translate={type:"boolean",label:nms_contentEditor.plugin_localizable_ToTranslate()},{model:a,metamodel:b,statemodel:c}},NL.DCE.LocalizablePlugin.prototype._loadElement=function(a){var b=!1;if(this._$localizedParent=void 0,a&&(b=NL.XTK.parseBoolean(a.nlData(c)),!b)){var d=this._$focus.parents("[data-nl-"+c+'="true"]');d.length>0&&(b=!0,this._$localizedParent=d)}return{translate:b}},NL.DCE.LocalizablePlugin.prototype._markAsLocalizable=function(b){var d=this._$focus;b&&(d=$(b)),d.nlData(c,!0),d.addClass(a),SO.isEmpty(d.attr("id"))&&d.attr("id",this.controller.getContentEditor().getNewId("str"))},NL.DCE.LocalizablePlugin.prototype._unmarkAsLocalizable=function(b){var d=this._$focus;b&&(d=$(b)),d.nlData(c,null),d.removeClass(a)},NL.DCE.LocalizablePlugin.prototype._changeElement=function(a,b){var d=this;if("translate"===a)if(b){var e=this._$focus.find("[data-nl-"+c+'="true"]');if(e.length>0){var f=nms_contentEditor.plugin_localizable_UnmarkChild(),g=nms_contentEditor.plugin_localizable_propagateToChild(),h=nms_contentEditor.plugin_localizable_propagateGroup(),i=nms_contentEditor.plugin_localizable_propagateToMarked();e.length>1&&(g=nms_contentEditor.plugin_localizable_propagateToChildren(e.length),f=nms_contentEditor.plugin_localizable_UnmarkChildren(e.length));var j=this.controller.getContentEditor().createBookmark(),k="",l=[];e.each(function(a,b){d.controller.getContentEditor().selectAllText(b),k=d.controller.getContentEditor().getSelectionContent(),l.push($('<pre class="nlui-dceplugin-localizable-extract">'+SO.XSS.escapeXMLString(k)+"</pre>"))});var m=$('<div style="height: 150px;"</div>').nlCarousel({title:g,data:l,pagination:{hideIfOneItem:!0,itemSelector:!0,position:"top"}});this.controller.getContentEditor().selectAllText(this._$focus);var n=this.controller.getContentEditor().getSelectionContent(),o=$('<div style="height: 250px;margin-top:10px;"></div>').nlCarousel({title:h,data:['<pre class="nlui-dceplugin-localizable-extract">'+SO.XSS.escapeXMLString(n)+"</pre>"],pagination:{itemSelector:!1}});this.controller.getContentEditor().moveToBookmark(j);var p=$("<div></div>"),q=$("<div></div>").append(m).append(o),r=$("<div></div>").append("<div>"+i+"</div>").append($('<div style="margin-top: 10px;"></div>').soActionMessage({state:"warning",message:f,displayIcon:"message"})).append(q.nlCollapsableSection({confManager:null,collapsed:!0,mode:"streamline",animationDuration:0,legend:nms_contentEditor.plugin_localizable_UnmarkDetails(),open:function(){p.soDialog("setHeight","auto")},close:function(){p.soDialog("setHeight","auto")}}));p.append(r).soDialog({title:nms_contentEditor.plugin_localizable_ConfirmUnmarkChildren(),width:700,height:"auto",modal:!0,destroyOnClose:!0,removeOnClose:!0,resizable:!1,noPrimaryFirstButton:!0,buttons:[{label:nms_contentEditor.dialog_cancel(),cancels:!0},{label:nms_contentEditor.dialog_confirm(),mode:"primary",onClick:function(){e.each(function(a,b){d._unmarkAsLocalizable(b)}),d._markAsLocalizable()},preset:"ok"}],cancel:function(){d._sidebarController.setValue("translate",!1,!0)}})}this._markAsLocalizable()}else this._unmarkAsLocalizable()},NL.DCE.LocalizablePlugin.prototype._onRefreshVisibility=function(){if(this._$specialMessage.hide(),this._$localizedParent&&this._$localizedParent.length>0)this._specialMessageController.setCommandAttribute("highlightParent","hidden",!1),this._specialMessageController.setCommandAttribute("goToParent","hidden",!1),this._$specialMessage.soActionMessage("setMessage",nms_contentEditor.plugin_localizable_localizationInParent()),this._$specialMessage.soActionMessage("setState","warning"),this._$specialMessage.show(),this._sidebarController.setDisabled("translate",!0);else{var a=this._$focus.contents();a.filter(function(){return 3!=this.nodeType}).length>0&&(this._specialMessageController.setCommandAttribute("highlightParent","hidden",!0),this._specialMessageController.setCommandAttribute("goToParent","hidden",!0),this._$specialMessage.soActionMessage("setMessage",nms_contentEditor.plugin_localizable_childrenNotOnlyText()),this._$specialMessage.soActionMessage("setState","info"),this._$specialMessage.show()),this._sidebarController.setDisabled("translate",!1)}},NL.DCE.LocalizablePlugin.prototype._goToLocalizableParent=function(){this.controller.forceSelectBlock(this._$localizedParent)},NL.DCE.LocalizablePlugin.prototype._toggleHighlightLocalizableParent=function(){this._$localizedParent&&this._$localizedParent.hasClass(b)?(this._$localizedParent.removeClass(b),this._specialMessageController.setCommandAttribute("highlightParent","isPushed",!1)):(this._$localizedParent.addClass(b),this._specialMessageController.setCommandAttribute("highlightParent","isPushed",!0))},NL.DCE.LocalizablePlugin.prototype.getOverCommands=function(){return[{where:"root",command:{name:"localizable_translate",icon:"nlui-icon-translate nlui-icon-inverse",title:nms_contentEditor.plugin_localizable_translatable(),action:function(){return!1}}}]},NL.DCE.LocalizablePlugin.prototype.getOverCommandNames=function(a){return NL.XTK.parseBoolean(a.nlData(c))?["localizable_translate"]:[]},NL.DCE.LocalizablePlugin.prototype.getName=function(){return this.name},NL.DCE.LocalizablePlugin.prototype.getLabel=function(){return this.label},NL.DCE.LocalizablePlugin.prototype.getRegistration=function(){return["over","focusOn","insertion","deselect"]},NL.DCE.LocalizablePlugin.prototype.updateSidebarSection=function(a,b){!this.controller.isEditableElement(a)||a[0]&&"img"===a[0].nodeName.toLowerCase()?this._$sectionContent.hide():(SO.assert(void 0!==this._sidebarController,"LocalizablePlugin.updateSidebarSection called without a controller"),this._sidebarController.setValues(this._loadElement(a),!b),this._$sectionContent.show())},NL.DCE.LocalizablePlugin.prototype.fillSidebarSection=function(a,b){if(this._$focus=a,!a||!this.controller.isEditableElement(a)||a[0]&&"img"===a[0].nodeName.toLowerCase())return this._$sectionContent&&this._$sectionContent.hide(),!1;if(this._$sectionContent)this._$sectionContent.show(),this.updateSidebarSection(a,!0);else{var c=this,d=this._applyValuesOnModel(this._newBareModel(),this._loadElement(a));this._sidebarController=new SO.MVC.Controller({model:d.model,metamodel:d.metamodel,statemodel:d.statemodel,onValueChanged:function(a,b,d,e){c._changeElement(a,e,b),c.controller.notifyElementChange(c._$focus)},onRefreshVisibility:function(a){c._onRefreshVisibility(a,"sidebar")}}),this._formControllers.push(this._sidebarController),this._$localizationFlag=$('<div data-nl-jpath="translate"></div>'),this._specialMessageController=new SO.MVC.Controller,this._$specialMessage=$("<div></div>").soActionMessage({cmdBar:{controller:this._specialMessageController,commandConfigs:{highlightParent:{hidden:!0,icon:"nlui-icon-preview",command:function(){c._toggleHighlightLocalizableParent()},help:nms_contentEditor.plugin_localizable_highlightParent()},goToParent:{hidden:!0,icon:"ui-icon-pencil",command:function(){c._goToLocalizableParent()},help:nms_contentEditor.plugin_localizable_goToParent()}},commands:["highlightParent","goToParent"]}}).hide();var e=$("<div></div>").append(this._$localizationFlag).append(this._$specialMessage).nlForm($.extend({},this._defaultSideBarFormConfig,{controller:this._sidebarController,labelsPosition:"left"})),f=this._defaultSideBarSectionConfig({legend:nms_contentEditor.plugin_localizable_title(),collapsed:!1});this._$sectionContent=$("<div></div>").nlCollapsableSection(f),this._$sectionContent.nlCollapsableSection("append",e),b.append(this._$sectionContent)}return!0},NL.DCE.LocalizablePlugin.prototype.onDeselect=function(){this._$localizedParent&&this._$localizedParent.removeClass(b)},NL.DCE.LocalizablePlugin.prototype.onSubtreeInsertion=function(b){var d,e=this;d=NL.XTK.parseBoolean(b.nlData(c))?b:b.find("[data-nl-"+c+'="true"]'),d.each(function(b,c){var d=$(c);SO.isEmpty(d.attr("id"))?e._markAsLocalizable(c):d.hasClass(a)||d.addClass(a)}),"page"===this.config.contentType&&("body"!==b[0].nodeName.toLowerCase()||NL.XTK.parseBoolean(this.controller.getTitleProperty("data-nl-"+c),!1)||this.controller.startWaitDialog(nms_contentEditor.plugin_localizable_PatchingPagetitle(),function(){var a={};a["data-nl-"+c]="true",e.controller.getTitleProperty("id")||(a.id=e.controller.getContentEditor().getNewId("str")),e.controller.setTitleProperties(a),e.controller.stopWaitDialog()}))}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlCarousel",a.NL.nlWidget,{options:{minContentHeight:100,minContentWidth:100,title:"",data:[],pagination:{hideIfOneItem:!0,itemSelector:!1,defaultItem:0,position:"top"}},_create:function(){this._$paginationContainer=a('<div class="nlui-carousel-paginationContainer"></div>').css({minWidth:this.options.minContentWidth}),this._$itemContainer=a('<div class="nlui-carousel-itemContainer""></div>').css({minWidth:this.options.minContentWidth,minHeight:this.options.minContentHeight}),this.element.addClass("nlui-carousel").css("min-width",this.options.minContentWidth).append(this._$paginationContainer,this._$itemContainer),this._currentItem=0,this._$currentlyDisplayed=void 0,this._dataLength=0,this._$title=void 0,this._$pagination=void 0,this._$itemSelector=void 0,this._$previous=void 0,this._$next=void 0,this._buildTitle(),this._buildNavigation(),this._fetchDataLength(),this._fetchData(!0),this.setItem(this.options.pagination.defaultItem)},_destroy:function(){this.element.empty(),this.element.removeClass("nlui-carousel"),a.NL.nlWidget.prototype.destroy.call(this)},_buildTitle:function(){this._$title?this._$title.html(this.options.title):(this._$title=a('<div class="nlui-carousel-title">'+this.options.title+"</div>"),this._$paginationContainer.prepend(this._$title)),this.options.title&&this._$paginationContainer.show()},_buildNavigation:function(){var b=this;"top"===this.options.pagination.position&&(this.options.pagination.itemSelector&&(this._$itemSelector=a('<div class="nlui-carousel-itemSelectorInput nlui-carousel-paginationItem"></div>').soNumberInput({value:b.options.pagination.defaultItem+1,strict:!1,onInternalChange:function(a){b.setItem(a-1)},errorDisplay:function(){b.setItem(b.options.pagination.defaultItem)},params:{type:"integer",range:{min:1}}})),this._$previous=a('<div class="nlui-carousel-paginationItem nlui-carousel-paginationPrevious"></div>').soSimpleButton({tooltip:xtk_core.navigation_paginationPreviousItemLabel(),icon:"ui-icon-triangle-1-w",onClick:function(){b._previousItem()}}),this._$next=a('<div class="nlui-carousel-paginationItem nlui-carousel-paginationNext"></div>').soSimpleButton({tooltip:xtk_core.navigation_paginationNextItemLabel(),icon:"ui-icon-triangle-1-e",onClick:function(){b._nextItem()}}),this._$pagination=a('<div class="nlui-carousel-pagination"></div>').append(this._$previous).append(this._$itemSelector).append(this._$next),this._$paginationContainer.append(this._$pagination))},_fetchDataLength:function(){this._handleDataLength(this.options.data.length)},_handleDataLength:function(a){this._dataLength=a,1===a&&this.options.pagination.hideIfOneItem&&this._$pagination.hide()},_fetchData:function(a){this._handleSuccess(this.options.data,a)},_handleSuccess:function(b,c){var d=this;c&&(this._$itemContainer.empty(),this._itemList=[],SO.Utils.each(b,function(b,c){var e=a('<div class="nlui-carousel-item"></div>').append(c);d._itemList.push(e),d._$itemContainer.append(e)}),this.setItem(this.options.pagination.defaultItem))},_previousItem:function(){this._currentItem>0?(this._currentItem--,this.setItem(this._currentItem)):this._dataLength&&0===this._currentItem&&(this._currentItem=this._dataLength-1,this.setItem(this._currentItem))},_nextItem:function(){!this._dataLength||this._currentItem<this._dataLength-1?(this._currentItem++,this.setItem(this._currentItem)):this._dataLength&&this._currentItem===this._dataLength-1&&(this._currentItem=0,this.setItem(this._currentItem))},setItem:function(a){a>=0&&(!this._dataLength||this._dataLength>a)?(this._$currentlyDisplayed&&this._$currentlyDisplayed.hide(),this._itemList.length>0&&(this._$currentlyDisplayed=this._itemList[a],this._currentItem=a,this.options.pagination.itemSelector&&this._$itemSelector.soNumberInput("setValue",a+1),this._$currentlyDisplayed.show(),this.options.layoutManager.rebuildLayout(this._$currentlyDisplayed))):this._dataLength&&a>=this._dataLength&&this.setItem(this._dataLength-1)}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){NL.DCE.BarcodePlugin=function(){NL.DCE.BarcodePlugin.baseConstructor.apply(this,arguments),this.name="BarcodePlugin",this.label=nms_contentEditor.plugin_barcode_title()},SO.OO.extend(NL.DCE.BarcodePlugin,NL.DCE.Plugin),NL.DCE.BarcodePlugin.prototype.getName=function(){return this.name},NL.DCE.BarcodePlugin.prototype.getLabel=function(){return this.label},NL.DCE.BarcodePlugin.prototype.getEditionCommands=function(){return[{where:"insertMenu",command:{name:"barcode_barcode",id:"barcode",label:nms_contentEditor.media_barcode(),activationState:"disabled",icon:"nlui-icon-barcode",action:function(){}}}]},NL.DCE.BarcodePlugin.prototype.getTextCommandNames=function(){return{names:["barcode_barcode"],advancedEdition:!0}}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){var a="nl-dce-if";NL.DCE.ConditionalPlugin=function(){NL.DCE.ConditionalPlugin.baseConstructor.apply(this,arguments),this.name="ConditionalPlugin",this.label=nms_contentEditor.plugin_conditional_title(),this._$focus=void 0,this._$sectionContent=void 0,this._sidebarController=void 0},SO.OO.extend(NL.DCE.ConditionalPlugin,NL.DCE.Plugin),NL.DCE.ConditionalPlugin.prototype._isValidBlock=function(a){if(a.length>0){var b=a[0].nodeName.toUpperCase();return"ADDRESS"===b||"BLOCKQUOTE"===b||"CENTER"===b||"DIR"===b||"DIV"===b||"DL"===b||"FIELDSET"===b||"FORM"===b||"H1"===b||"H2"===b||"H3"===b||"H4"===b||"H5"===b||"H6"===b||"NOSCRIPT"===b||"HR"===b||"OL"===b||"P"===b||"PRE"===b||"TR"===b||"UL"===b}return!1},NL.DCE.ConditionalPlugin.prototype._newBareModel=function(){return{model:{expression:""},metamodel:{expression:{type:"exprEdit",label:nms_contentEditor.plugin_conditional_Visibility(),params:{displayPickerButton:!1,defaultRenderingValue:nms_contentEditor.plugin_conditional_AlwaysVisible(),targetResource:this.config.target,mode:"js",help:nms_contentEditor.plugin_conditional_Help()}}}}},NL.DCE.ConditionalPlugin.prototype._loadElement=function(a){var b="";return a&&(b=NL.XTK.toString(a.nlData("expr"))),{expression:b}},NL.DCE.ConditionalPlugin.prototype._changeElement=function(b,c,d){if("expression"===b){var c=d.getValue(b);this._$focus.nlData("expr",c),SO.isEmpty(c)?this._$focus.removeClass(a):this._$focus.addClass(a)}},NL.DCE.ConditionalPlugin.prototype.getName=function(){return this.name},NL.DCE.ConditionalPlugin.prototype.getLabel=function(){return this.label},NL.DCE.ConditionalPlugin.prototype.getRegistration=function(){return["over","focusOn"]},NL.DCE.ConditionalPlugin.prototype.getOverCommands=function(){return[{where:"root",command:{name:"conditional_content",icon:"nlui-icon-conditional-content nlui-icon-inverse",title:nms_contentEditor.plugin_conditional_conditional(),action:function(){return!1}}}]},NL.DCE.ConditionalPlugin.prototype.getOverCommandNames=function(b){return b.hasClass(a)?["conditional_content"]:[]},NL.DCE.ConditionalPlugin.prototype.updateSidebarSection=function(a,b){!this._isValidBlock(a)||a.hasClass("nl-dce-field")||a.hasClass("nl-dce-fragment")?(this._$focus=null,this._$sectionContent.hide()):(SO.assert(void 0!==this._sidebarController,"ConditionalPlugin.updateSidebarSection called without a controller"),this._$focus=a,this._sidebarController.setValues(this._loadElement(a),!b),this._$sectionContent.show())},NL.DCE.ConditionalPlugin.prototype.fillSidebarSection=function(a,b){if(this._$focus=a,a&&this._isValidBlock(a)&&!a.hasClass("nl-dce-field")&&!a.hasClass("nl-dce-fragment")){if(this._$sectionContent)this._$sectionContent.show(),this.updateSidebarSection(a,!0);else{var c=this,d=this._applyValuesOnModel(this._newBareModel(),this._loadElement(c._$focus));this._sidebarController=new SO.MVC.Controller({model:d.model,metamodel:d.metamodel,statemodel:d.statemodel,onValueChanged:function(a,b,d,e){c._changeElement(a,e,b),c.controller.notifyElementChange(c._$focus)}}),this._formControllers.push(this._sidebarController);var e=$("<div></div>").soQuickForm({},this._defaultSideBarFormConfig,{controller:this._sidebarController,attributes:["expression"],labelsPosition:"none"}),f=this._defaultSideBarSectionConfig({legend:nms_contentEditor.plugin_conditional_title(),collapsed:!0});this._$sectionContent=$("<div></div>").nlCollapsableSection(f),this._$sectionContent.nlCollapsableSection("append",e),b.append(this._$sectionContent)}return!0}return this._$sectionContent&&this._$sectionContent.hide(),!1}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){NL.DCE.FontStylePlugin=function(){NL.DCE.FontStylePlugin.baseConstructor.apply(this,arguments),this.name="FontStylePlugin",this.label=nms_contentEditor.plugin_fontStyle_title()},SO.OO.extend(NL.DCE.FontStylePlugin,NL.DCE.Plugin),NL.DCE.FontStylePlugin.prototype._onJustifyChange=function(a){this.controller.getContentEditor().toggleTextAlign(a)},NL.DCE.FontStylePlugin.prototype._onBackgroundColorChange=function(a){var b=this,c=new SO.Color(a.css("background-color")),d=new SO.Widgets.Dialog($("<div></div>"),{modal:!0,dialogClass:"nl-dce-dialog",title:nms_contentEditor.plugin_fontStyle_bgcolor_title(),noPrimaryFirstButton:!0,buttons:[{text:xtk_core.dialog_cancel(),click:function(){d.close()}},{text:xtk_core.dialog_ok(),mode:"primary",click:function(){var c=e.getValue();a.css("background-color",c.toString("rgb")),b.controller.notifyElementChange(a),d.close()}}]}),e=new SO.Widgets.ColorInput(d.getBody(),{configManager:this.config.configManager,value:c})},NL.DCE.FontStylePlugin.prototype._onTextColorChange=function(a){var b=this,c=new SO.Color(a.css("color")),d=new SO.Widgets.Dialog($("<div></div>"),{modal:!0,dialogClass:"nl-dce-dialog",title:nms_contentEditor.plugin_fontStyle_fontcolor_title(),noPrimaryFirstButton:!0,buttons:[{text:xtk_core.dialog_cancel(),click:function(){d.close()}},{text:xtk_core.dialog_ok(),mode:"primary",click:function(){var c=e.getValue(),f=b.controller.getContentEditor();c.alpha||(f.isSelectionEmpty(!0)?f.setNodeTextColor(c.toString("hex"),a):f.setTextColor(c.toString("hex"))),b.controller.notifyElementChange(a),b.controller._isInhibited("focus")||f.focus(),d.close()}}]}),e=new SO.Widgets.ColorInput(d.getBody(),{value:c,configManager:this.config.configManager,params:{cards:["palette","details"]}})},NL.DCE.FontStylePlugin.prototype.getName=function(){return this.name},NL.DCE.FontStylePlugin.prototype.getLabel=function(){return this.label},NL.DCE.FontStylePlugin.prototype.getRegistration=function(){return["focusOn","bookmarkChange","textEdition"]},NL.DCE.FontStylePlugin.prototype.getEditionCommands=function(){var a=this;return[{where:"root",command:{name:"fontStyle_increaseFontSize",icon:"coral-textIncrease",help:nms_contentEditor.plugin_fontStyle_increasefontsize(),id:"increasefontsize",action:function(b){var c=a.controller.getContentEditor();a.controller._isInhibited("focus")||c.focus(),c.increaseFontSize(),a.controller.notifyElementChange(b)}}},{where:"root",command:{name:"fontStyle_decreaseFont",icon:"coral-textDecrease",help:nms_contentEditor.plugin_fontStyle_decreasefontsize(),id:"decreasefontsize",action:function(b){var c=a.controller.getContentEditor();a.controller._isInhibited("focus")||c.focus(),c.decreaseFontSize(),a.controller.notifyElementChange(b)}}},{where:"root",command:{name:"fontStyle_bold",icon:"coral-textBold",help:nms_contentEditor.plugin_fontStyle_bold(),id:"bold",action:function(b){var c=a.controller.getContentEditor();a.controller._isInhibited("focus")||c.focus(),c.toggleBold(),a.controller.notifyBookmarkChangeAction(),a.controller.notifyElementChange(b)}}},{where:"root",command:{name:"fontStyle_italic",icon:"coral-textItalic",help:nms_contentEditor.plugin_fontStyle_italic(),id:"italic",action:function(b){var c=a.controller.getContentEditor();a.controller._isInhibited("focus")||c.focus(),c.toggleItalic(),a.controller.notifyBookmarkChangeAction(),a.controller.notifyElementChange(b)}}},{where:"root",command:{name:"fontStyle_underline",icon:"coral-textUnderline",help:nms_contentEditor.plugin_fontStyle_underline(),id:"underline",action:function(b){var c=a.controller.getContentEditor();a.controller._isInhibited("focus")||c.focus(),c.toggleUnderline(),a.controller.notifyBookmarkChangeAction(),a.controller.notifyElementChange(b)}}},{where:"root",command:{name:"fontStyle_bgColor",icon:"coral-eyedropper",help:nms_contentEditor.plugin_fontStyle_bgcolor(),id:"bgcolor",action:function(b){a._onBackgroundColorChange(b)}}},{where:"root",command:{name:"fontStyle_fontColor",icon:"coral-textColor",help:nms_contentEditor.plugin_fontStyle_fontcolor(),id:"textcolor",action:function(b){a._onTextColorChange(b)}}}]},NL.DCE.FontStylePlugin.prototype.getTextCommandNames=function(a){return this.controller.isEditableElement(a)?{names:["fontStyle_increaseFontSize","fontStyle_decreaseFont","fontStyle_bold","fontStyle_italic","fontStyle_underline","fontStyle_bgColor","fontStyle_fontColor"],advancedEdition:!1}:{names:[],advancedEdition:!1}},NL.DCE.FontStylePlugin.prototype.getUpdatedCommandStates=function(){var a=this.controller.getContentEditor();return{fontStyle_bold:{isPushed:a.isSelectionFormatted(!1,"bold")},fontStyle_italic:{isPushed:a.isSelectionFormatted(!1,"italic")},fontStyle_underline:{isPushed:a.isSelectionFormatted(!1,"underline")}}},NL.DCE.FontStylePlugin.prototype.updateSidebarSection=function(){var a=this.controller.getContentEditor(),b=this.controller.getCurrentSelection();this.config.readOnly?this._$sectionContent.hide():this._$sectionContent.show(),this._$justifyCmdBar.soCmdBar("setCommandAttribute","fontStyle_justifyLeft","isPushed",b&&"left"===b.css("text-align")||a.isSelectionFormatted(!1,"alignleft"),!1),this._$justifyCmdBar.soCmdBar("setCommandAttribute","fontStyle_justifyCenter","isPushed",b&&"center"===b.css("text-align")||a.isSelectionFormatted(!1,"aligncenter"),!1),this._$justifyCmdBar.soCmdBar("setCommandAttribute","fontStyle_justifyRight","isPushed",b&&"right"===b.css("text-align")||a.isSelectionFormatted(!1,"alignright"),!1)},NL.DCE.FontStylePlugin.prototype.onTextEditionStart=function(){this._$sectionContent&&!this.config.readOnly&&this._$sectionContent.show()},NL.DCE.FontStylePlugin.prototype.onTextEditionEnd=function(){this._$sectionContent&&this._$sectionContent.hide()},NL.DCE.FontStylePlugin.prototype.fillSidebarSection=function(a,b){if(this._$focus=a,a&&"html"!==a.get(0).nodeName.toLowerCase()){if(this._$sectionContent)this.updateSidebarSection(a);else{var c=this,d=this.controller.getContentEditor(),e=this.controller.getCurrentSelection(),f=this._defaultSideBarSectionConfig({legend:nms_contentEditor.plugin_fontStyle_title()});this._$sectionContent=$('<div class="nlui-dceplugin-fontStyle"></div>').hide().nlCollapsableSection(f),this._$justifyCmdBar=$("<div></div>"),this._$justifyCmdBar.soCmdBar({iconSize:18,mode:"flatToolbar",separators:!1,commandConfigs:{fontStyle_justifyLeft:{icon:"coral-textLeft",help:nms_contentEditor.plugin_fontStyle_justifyleft(),id:"justifyleft",command:function(){c.controller._isInhibited("focus")||c.controller.getContentEditor().focus(),c._onJustifyChange("left"),c.controller.notifyElementChange(c._$focus)},isPushed:e&&"left"===e.css("text-align")||d.isSelectionFormatted(!1,"alignleft")},fontStyle_justifyCenter:{icon:"coral-textCenter",help:nms_contentEditor.plugin_fontStyle_justifycenter(),id:"justifycenter",command:function(){c.controller._isInhibited("focus")||c.controller.getContentEditor().focus(),c._onJustifyChange("center"),c.controller.notifyElementChange(c._$focus)},isPushed:e&&"center"===e.css("text-align")||d.isSelectionFormatted(!1,"aligncenter")},fontStyle_justifyRight:{icon:"coral-textRight",help:nms_contentEditor.plugin_fontStyle_justifyright(),id:"justifyright",command:function(){c.controller._isInhibited("focus")||c.controller.getContentEditor().focus(),c._onJustifyChange("right"),c.controller.notifyElementChange(c._$focus)},isPushed:e&&"right"===e.css("text-align")||d.isSelectionFormatted(!1,"alignright")}},commands:["fontStyle_justifyLeft","fontStyle_justifyCenter","fontStyle_justifyRight"]}),this._$sectionContent.nlCollapsableSection("append",this._$justifyCmdBar),b.append(this._$sectionContent)}return!0}return this._$sectionContent&&this._$sectionContent.hide(),!1}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){var a="isMandatory",b="inputType",c="formConfiguration",d="formConfigurationSelection",e="checkboxBehavior",f="value",g="labelValue",h="customLabelValue",i="action",j="service",k="service_collection",l="nlfield_link",m="nlfield_link_storage",n="nlfield_enumValue",o="nlfield_enumUncheckedValue",p="nlfield_boolValue",q="nlfield_boolUncheckedValue",r="datepart_date",s="datepart_datetime",t="min",u="max",v="uncheckedValue",w="bindTo",x="checkboxBehavior",y="isMandatory",z="action",A="servicename",B="servicelabel",C="xpath",D="type",E="label",F="datePart",G="min",H="max",I="uncheckedValue",J="_readonly_backup",K="_none_",L="xpath",M="service",N="action",O="subscription",P="unsubscription",Q=["byte","short","long","int64","date","datetime","timespan","time","float","double","string","boolean","any","cdata","link","blob","htm","memo"],R=[{name:"text",label:nms_contentEditor.plugin_formbinding_htmlinput_text()},{name:"password",label:nms_contentEditor.plugin_formbinding_htmlinput_password()},{name:"number",label:nms_contentEditor.plugin_formbinding_htmlinput_number()},{name:"datetime",label:nms_contentEditor.plugin_formbinding_htmlinput_datetime()},{name:"datetime-local",label:nms_contentEditor.plugin_formbinding_htmlinput_datetime_local()},{name:"date",label:nms_contentEditor.plugin_formbinding_htmlinput_date()},{name:"month",label:nms_contentEditor.plugin_formbinding_htmlinput_month()},{name:"week",label:nms_contentEditor.plugin_formbinding_htmlinput_week()},{name:"time",label:nms_contentEditor.plugin_formbinding_htmlinput_time()},{name:"email",label:nms_contentEditor.plugin_formbinding_htmlinput_email()},{name:"tel",label:nms_contentEditor.plugin_formbinding_htmlinput_tel()},{name:"url",label:nms_contentEditor.plugin_formbinding_htmlinput_url()},{name:"color",label:nms_contentEditor.plugin_formbinding_htmlinput_color()},{name:"search",label:nms_contentEditor.plugin_formbinding_htmlinput_search()},{name:"range",label:nms_contentEditor.plugin_formbinding_htmlinput_range()},{name:"file",label:nms_contentEditor.plugin_formbinding_htmlinput_file()},{name:"checkbox",label:nms_contentEditor.plugin_formbinding_htmlinput_checkbox()},{name:"radio",label:nms_contentEditor.plugin_formbinding_htmlinput_radio()}],S={color:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:2,"float":2,"double":2,string:0,"boolean":2,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},checkbox:{"byte":0,"short":0,"long":0,int64:0,date:0,datetime:0,timespan:0,time:0,"float":0,"double":0,string:0,"boolean":0,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},date:{"byte":2,"short":2,"long":2,int64:2,date:0,datetime:2,timespan:2,time:2,"float":2,"double":2,string:1,"boolean":2,any:1,cdata:1,link:2,blob:1,htm:1,memo:1},datetime:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:2,"float":2,"double":2,string:2,"boolean":2,any:2,cdata:2,link:2,blob:2,htm:2,memo:2},"datetime-local":{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:0,timespan:2,time:2,"float":2,"double":2,string:1,"boolean":2,any:1,cdata:1,link:2,blob:1,htm:1,memo:1},email:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:2,"float":2,"double":2,string:0,"boolean":2,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},file:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:2,"float":2,"double":2,string:2,"boolean":2,any:2,cdata:2,link:2,blob:2,htm:2,memo:2},hidden:{"byte":0,"short":0,"long":0,int64:0,date:0,datetime:0,timespan:0,time:0,"float":0,"double":0,string:0,"boolean":0,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},month:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:2,"float":2,"double":2,string:0,"boolean":2,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},number:{"byte":0,"short":0,"long":0,int64:0,date:2,datetime:2,timespan:0,time:2,"float":0,"double":0,string:1,"boolean":2,any:1,cdata:1,link:2,blob:1,htm:1,memo:1},password:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:2,"float":2,"double":2,string:0,"boolean":2,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},radio:{"byte":0,"short":0,"long":0,int64:0,date:0,datetime:0,timespan:0,time:0,"float":0,"double":0,string:0,"boolean":0,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},range:{"byte":0,"short":0,"long":0,int64:0,date:2,datetime:2,timespan:2,time:2,"float":0,"double":0,string:1,"boolean":2,any:1,cdata:1,link:2,blob:1,htm:1,memo:1},search:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:2,"float":2,"double":2,string:0,"boolean":2,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},tel:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:2,"float":2,"double":2,string:0,"boolean":2,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},text:{"byte":1,"short":1,"long":1,int64:1,date:1,datetime:1,timespan:1,time:1,"float":1,"double":1,string:0,"boolean":1,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},time:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:0,"float":2,"double":2,string:1,"boolean":2,any:1,cdata:1,link:2,blob:1,htm:1,memo:1},url:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:2,"float":2,"double":2,string:0,"boolean":2,any:0,cdata:0,link:2,blob:0,htm:0,memo:0},week:{"byte":2,"short":2,"long":2,int64:2,date:2,datetime:2,timespan:2,time:2,"float":2,"double":2,string:2,"boolean":2,any:2,cdata:2,link:2,blob:2,htm:2,memo:2}};NL.DCE.FormBindingPlugin=function(){NL.DCE.FormBindingPlugin.baseConstructor.apply(this,arguments),this.name="FormBindingPlugin",this.label=nms_contentEditor.plugin_formbinding_title(),this._$focus=void 0,this._$sectionContent=void 0,this._sidebarController=void 0,this._advancedEditionFormController=void 0,this._advancedEditionCheckConditions={},this._sidebarContent={formConfiguration:{container:void 0,jpath:void 0},serviceConfiguration:{container:void 0,jpath:void 0},service:{container:void 0,jpath:void 0},customValueLabel:{container:void 0,jpath:void 0},valueLabel:{container:void 0,jpath:void 0},warningNoPrevious:{container:void 0,jpath:void 0},warningNoNext:{container:void 0,jpath:void 0},action:{container:void 0,jpath:void 0},field:{container:void 0,jpath:void 0},fieldEnumValue:{container:void 0,jpath:void 0},fieldEnumUncheckedValue:{container:void 0,jpath:void 0},fieldBoolValue:{container:void 0,jpath:void 0},fieldBoolUncheckedValue:{container:void 0,jpath:void 0},fillSelectValues:{container:void 0,jpath:void 0},datepartDate:{container:void 0,jpath:void 0},datepartDateTime:{container:void 0,jpath:void 0},min:{container:void 0,jpath:void 0},max:{container:void 0,jpath:void 0},value:{container:void 0,jpath:void 0},uncheckedValue:{container:void 0,jpath:void 0},compatibilityWarning:{container:void 0,jpath:void 0},mandatory:{container:void 0,jpath:void 0}},this._advancedEditionContent={formConfiguration:{container:void 0,jpath:void 0},serviceConfiguration:{container:void 0,jpath:void 0},service:{container:void 0,jpath:void 0},customValueLabel:{container:void 0,jpath:void 0},valueLabel:{container:void 0,jpath:void 0},warningNoPrevious:{container:void 0,jpath:void 0},warningNoNext:{container:void 0,jpath:void 0},action:{container:void 0,jpath:void 0},field:{container:void 0,jpath:void 0},fieldEnumValue:{container:void 0,jpath:void 0},fieldEnumUncheckedValue:{container:void 0,jpath:void 0},fieldBoolValue:{container:void 0,jpath:void 0},fieldBoolUncheckedValue:{container:void 0,jpath:void 0},fillSelectValues:{container:void 0,jpath:void 0},datepartDate:{container:void 0,jpath:void 0},datepartDateTime:{container:void 0,jpath:void 0},min:{container:void 0,jpath:void 0},max:{container:void 0,jpath:void 0},value:{container:void 0,jpath:void 0},uncheckedValue:{container:void 0,jpath:void 0},compatibilityWarning:{container:void 0,jpath:void 0},mandatory:{container:void 0,jpath:void 0}};for(var a=0;Q.length>a;a++){var c=b+"_"+Q[a];this._sidebarContent[c]={container:void 0,jpath:void 0},this._advancedEditionContent[c]={container:void 0,jpath:void 0}}},SO.OO.extend(NL.DCE.FormBindingPlugin,NL.DCE.Plugin),NL.DCE.FormBindingPlugin.prototype._fillSelectValues=function(a){var b,c=this;if("sidebar"===a?b=this._sidebarController.getValue(l):"advancedEdition"===a&&(b=this._advancedEditionFormController.getValue(l)),b.hasEnumeration&&b.enumeration&&this._$focus&&"select"===this._$focus[0].nodeName.toLowerCase()){this._$focus.children().remove();var d=b.enumeration.defaultValue,e=b.defaultValue,f="",g="";SO.Utils.each(b.enumeration.values,function(a,c){f="",(d&&c.value===b.enumeration.defaultValue||!d&&e&&c.value===e)&&(f='selected="selected"'),g+='<option value="'+SO.HTMLUtils.htmlEncode(c.value)+'" '+f+">"+SO.HTMLUtils.htmlEncode(c.label)+"</option>"}),c._$focus.append(g)}},NL.DCE.FormBindingPlugin.prototype._saveElement=function(a,b){var c=this;SO.Utils.each(b,function(b,d){c._changeElement(d.jpath,a,null,d.value)})},NL.DCE.FormBindingPlugin.prototype._propagateFieldChange=function(a,b){var c=a instanceof SO.Selection?a.getItem():a;if(c&&c.hasEnumeration){var d=[];SO.Utils.each(c.enumeration.values,function(a,b){d.push({name:b.value,label:b.label})}),b.setParamSubtree(n,"items",d),b.setParamSubtree(o,"items",d)}},NL.DCE.FormBindingPlugin.prototype._changeElement=function(k,m,y,C){var D,E={};switch(k){case d:m.setValue(c,C);break;case a:E[k]=C.toString(),this.controller.storeDataInElement(this._$focus,E);break;case g:m.getValue(h)&&this._$focus.val(C);break;case h:C?this._$focus.is("[value]")||this._$focus.val(""):this._$focus.removeAttr("value");break;case f:case n:case p:this._$focus.val(C);break;case i:this._resetBinding(),this._$focus.nlData(z,C);break;case j:D=C instanceof SO.Selection?C.getItem():C,this._resetBinding(),this._$focus.nlData(A,D.name),this._$focus.nlData(B,D.label),this._$focus.nlData(x,m.getValue(e));break;case e:this._$focus.nlData(x,C);break;case l:this._resetBinding(),null!==C?(D=C instanceof SO.Selection?C.getItem():C,this._bindFormElementToSchemaNode(this._$focus,C),y&&!m.areKeysEqual(k,y,C)&&NL.XTK.parseBoolean(D.hasEnumeration)&&(m.setValue(n,NL.XTK.toString(D.enumeration.defaultValue),!0),m.setValue(o,NL.XTK.toString(D.enumeration.defaultValue),!0)),this._propagateFieldChange(C,m)):(m.setValue(n,""),m.setValue(o,""));break;case r:case s:E[F]=C,this.controller.storeDataInElement(this._$focus,E);break;case t:E[G]=C,this.controller.storeDataInElement(this._$focus,E);break;case u:E[H]=C,this.controller.storeDataInElement(this._$focus,E);break;case v:case o:case q:E[I]=C,this.controller.storeDataInElement(this._$focus,E)}0===k.indexOf(b)&&this._$focus.attr("type",C.toString()),this._$focus.nlData(w,m.getValue(c))},NL.DCE.FormBindingPlugin.prototype._resetBinding=function(){var a={};a[B]=null,a[A]=null,a[C]=null,a[E]=null,a[D]=null,a[G]=null,a[H]=null,a[F]=null,this.controller.storeDataInElement(this._$focus,a)},NL.DCE.FormBindingPlugin.prototype._resetValues=function(a){var b={};b[j]=null,b[l]=null,b[n]="",b[o]="",b[p]=null,b[q]=null,b[t]=0,b[u]=0,b[r]="",b[s]="",a.setValues(b,!0)},NL.DCE.FormBindingPlugin.prototype._resetChangeInCollector=function(a){a.unsetChange(j,"value"),a.unsetChange(l,"value"),a.unsetChange(n,"value"),a.unsetChange(o,"value"),a.unsetChange(p,"value"),a.unsetChange(q,"value"),a.unsetChange(t,"value"),a.unsetChange(u,"value"),a.unsetChange(r,"value"),a.unsetChange(s,"value")},NL.DCE.FormBindingPlugin.prototype._getAllFormItems=function(a){var b={};"sidebar"===a.source?b=this._sidebarContent:"advancedEdition"===a.source&&(b=this._advancedEditionContent);var c=[];return SO.Utils.each(b,function(a,b){b&&c.push(b)}),c},NL.DCE.FormBindingPlugin.prototype._getAllFormContainers=function(a){var b={};"sidebar"===a.source?b=this._sidebarContent:"advancedEdition"===a.source&&(b=this._advancedEditionContent);var c=[];return SO.Utils.each(b,function(a,b){b&&c.push(b.container)}),c},NL.DCE.FormBindingPlugin.prototype._genHiddenMarkup=function(c){var k=this,m={};"sidebar"===c.source?m=this._sidebarContent:"advancedEdition"===c.source&&(m=this._advancedEditionContent),m.formConfiguration={container:$('<div data-nl-jpath="'+d+'"></div>'),jpath:d},m.serviceConfiguration={container:$('<div data-nl-jpath="'+e+'"></div>'),jpath:e},("sidebar"===c.source||"advancedEdition"===c.source)&&(m.field={container:$('<div data-nl-jpath="'+l+'"></div>'),jpath:l},m.fieldEnumValue={container:$('<div data-nl-jpath="'+n+'"></div>'),jpath:n},m.fieldEnumUncheckedValue={container:$('<div data-nl-jpath="'+o+'"></div>'),jpath:o},m.fieldBoolValue={container:$('<div data-nl-jpath="'+p+'"></div>'),jpath:p},m.fieldBoolUncheckedValue={container:$('<div data-nl-jpath="'+q+'"></div>'),jpath:q},m.fillSelectValues={container:$('<div style="width: 100%;"></div>').soButton({label:nms_contentEditor.plugin_formBinding_FillSelectValues_short(),help:nms_contentEditor.plugin_formBinding_FillSelectValues(),onClick:function(){k._fillSelectValues(c.source)}})},m.compatibilityWarning={container:$("<div></div>").soActionMessage({message:nms_contentEditor.plugin_formBinding_CompatibilityWarning(),state:"warning"})}),m.service={container:$('<div data-nl-jpath="'+j+'"></div>'),jpath:j},m.value={container:$('<div data-nl-jpath="'+f+'"></div>'),jpath:f},m.valueLabel={container:$('<div data-nl-jpath="'+g+'"></div>'),jpath:g},m.customValueLabel={container:$('<div data-nl-jpath="'+h+'"></div>'),jpath:h},m.action={container:$('<div data-nl-jpath="'+i+'"></div>'),jpath:i},m.warningNoPrevious={container:$("<div></div>").soActionMessage({message:nms_contentEditor.plugin_hyperLinkEdit_WarnNoPrevious(),state:"warning",displayIcon:"message"})},m.warningNoNext={container:$("<div></div>").soActionMessage({message:nms_contentEditor.plugin_hyperLinkEdit_WarnNoNext(),state:"warning",displayIcon:"message"})},m.datepartDate={container:$('<div data-nl-jpath="'+r+'"></div>'),jpath:r},m.datepartDateTime={container:$('<div data-nl-jpath="'+s+'"></div>'),jpath:s},m.min={container:$('<div data-nl-jpath="'+t+'"></div>'),jpath:t},m.max={container:$('<div data-nl-jpath="'+u+'"></div>'),jpath:u},m.uncheckedValue={container:$('<div data-nl-jpath="'+v+'"></div>'),jpath:v},m.mandatory={container:$('<div data-nl-jpath="'+a+'"></div>'),jpath:a};for(var w=0;Q.length>w;w++){var x=b+"_"+Q[w];m[x]={container:$('<div data-nl-jpath="'+x+'"></div>'),jpath:x}}return this._getAllFormContainers(c)},NL.DCE.FormBindingPlugin.prototype._needCompatibilityWarning=function(a,b){return a&&b&&S[a]&&(1===S[a][b]||2===S[a][b])},NL.DCE.FormBindingPlugin.prototype._onRefreshVisibility=function(d,e){var f=this;SO.Utils.each(this._getAllFormItems({source:e}),function(a,b){b.container.hide(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[b.jpath]=function(){return!1})});var g={};"sidebar"===e?g=this._sidebarContent:"advancedEdition"===e&&(g=this._advancedEditionContent);var j=d.getValue(c),k=d.getValue(a),m=this._$focus[0].nodeName.toLowerCase(),n=NL.XTK.toString(this._$focus.attr("type")).toLowerCase();switch(j){case L:g.mandatory.container.show(),g.field.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.mandatory.jpath]=function(){return!0},f._advancedEditionCheckConditions[g.field.jpath]=function(){return!0});var o=d.getValue(l),p="";if(o&&(p=NL.XTK.toString(o.type).toLowerCase()),"input"===m&&"button"!==n&&"submit"!==n&&"reset"!==n){var q=this._$focus.nlData(D),r=b+"_"+q;g.hasOwnProperty(r)&&g[r].container.show()}"input"!==m||"radio"!==n&&"checkbox"!==n||"advancedEdition"===e&&(o&&o.hasEnumeration&&(g.fieldEnumValue.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.fieldEnumValue.jpath]=function(){return!0}),"checkbox"!==n||k||(g.fieldEnumUncheckedValue.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.fieldEnumUncheckedValue.jpath]=function(){return!0}))),p&&"boolean"===p&&(g.fieldBoolValue.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.fieldBoolValue.jpath]=function(){return!0}),"checkbox"!==n||k||(g.fieldBoolUncheckedValue.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.fieldBoolUncheckedValue.jpath]=function(){return!0}))),(!o||!o.hasEnumeration&&"boolean"!=p)&&(g.value.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.value.jpath]=function(){return!0}),"checkbox"!==n||k||(g.uncheckedValue.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.uncheckedValue.jpath]=function(){return!0})))),"input"===m&&this._needCompatibilityWarning(n,p)&&g.compatibilityWarning.container.show(),this._isNumberField(this._$focus)&&-1!==["int","double","long","float","byte","short"].indexOf(p)&&(g.min.container.show(),g.max.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.min.jpath]=function(){return!0},f._advancedEditionCheckConditions[g.max.jpath]=function(){return!0})),"select"===m&&("date"===p&&(g.datepartDate.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.datepartDate.jpath]=function(){return!0})),"datetime"===p&&(g.datepartDateTime.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.datepartDateTime.jpath]=function(){return!0})),o&&o.hasEnumeration&&g.fillSelectValues.container.show()),"checkbox"===n&&this.config.hasSubscription&&(g.formConfiguration.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.formConfiguration.jpath]=function(){return!0})),this._$sectionContent.show();break;case M:"checkbox"===n&&(g.formConfiguration.container.show(),g.service.container.show(),g.serviceConfiguration.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.formConfiguration.jpath]=function(){return!0},f._advancedEditionCheckConditions[g.service.jpath]=function(){return!0},f._advancedEditionCheckConditions[g.serviceConfiguration.jpath]=function(){return!0})),g.mandatory.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.mandatory.jpath]=function(){return!0}),this._$sectionContent.show();break;case N:this._$focus.is('input[type="button"], input[type="submit"]')&&(isIE()||(g.customValueLabel.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.customValueLabel.jpath]=function(){return!0})),(isIE()||d.getValue(h))&&(g.valueLabel.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.valueLabel.jpath]=function(){return!0}))),g.action.container.show(),"advancedEdition"===e&&(f._advancedEditionCheckConditions[g.action.jpath]=function(){return!0});var s=d.getValue(i);this.config.hasButtonAction&&"previous"===s&&!this.config.hasPreviousAction&&g.warningNoPrevious.container.show(),this.config.hasButtonAction&&"next"===s&&!this.config.hasNextAction&&g.warningNoNext.container.show(),this._$sectionContent.show();break;default:this._$sectionContent.hide()}},NL.DCE.FormBindingPlugin.prototype._isNumberField=function(a){var b=a.attr("type");return"text"===b||"number"===b||a.is("textarea")},NL.DCE.FormBindingPlugin.prototype._loadElement=function(k,m){var E={},J=k.nlData(w),K=k.nlData(D);SO.isEmpty(J)&&(J=k.is('input[type="button"], input[type="submit"], input[type="image"], button[type="submit"], button[type="button"], button:not([type])')?N:k.nlData(A)?M:k.nlData(C)?L:L);var P=k.attr("type");if(J===M)if("checkbox"===P&&this.config.hasSubscription){E[d]=J,E[e]=k.nlData(x),SO.isEmpty(E[e])&&(E[e]=O);var R=NL.XTK.toString(k.nlData(A));if(R){var S=NL.XTK.toString(k.nlData(B));SO.isEmpty(S)&&(S=R),E[j]=new SO.Selection({selectionMode:"mono",items:[{name:R,label:S}]})}}else J=L;else J===N&&(k.is('input[type="button"], input[type="submit"], input[type="image"], button[type="submit"], button[type="button"], button:not([type])')?(k.is('input[type="button"], input[type="submit"]')&&(E[g]=k.val(),E[h]=k.is("[value]")),E[i]=NL.XTK.toString(k.nlData(z))):J=L);if(("radio"===P||"checkbox"===P)&&(k[0].hasAttribute("value")?(E[f]=k.attr("value"),E[n]=k.attr("value")):E[f]="","checkbox"===P&&(E[v]=NL.XTK.toString(k.nlData(I)),E[o]=NL.XTK.toString(k.nlData(I)))),J===L){E[d]=J;var T;if(T=m&&m.schemaNode?m.schemaNode:this._getSchemaNodeFromField(k),T&&T.nodePath){var U=T.nodePath;0!==T.nodePath.indexOf("/")&&(U="/"+T.nodePath);var V=new SO.Selection({selectionMode:"mono",items:[{nodePath:U,label:T.label}]});if(E[l]=V,"boolean"===T.type&&(k[0].hasAttribute("value")&&(E[p]=NL.XTK.parseBoolean(k.attr("value"))),E[q]=NL.XTK.parseBoolean(k.data(I))),"select"===k[0].nodeName.toLowerCase()&&("date"===T.type||"datetime"===T.type)){var W=NL.XTK.toString(k.nlData(F));W?(E[r]=W,E[s]=W):(E[r]="",E[s]="")}this._isNumberField(k)&&-1!==["int","double","long","float","byte","short"].indexOf(T.type)&&(E[t]=NL.Locale.parseInt(k.nlData(G),0),E[u]=NL.Locale.parseInt(k.nlData(H),0))}else E[l]=null}for(var X=0;Q.length>X;X++){var Y=b+"_"+Q[X];E[Y]=Q[X]===K?P:""}return E[a]=NL.XTK.parseBoolean(k.nlData(y)),E[c]=J,E},NL.DCE.FormBindingPlugin.prototype._newBareModel=function(){var w={},x={},y={};w[c]=L,x[c]={type:"enum",label:nms_contentEditor.plugin_formbinding_nlBindingConfiguration(),params:{items:[{name:M,label:""},{name:L,label:""},{name:N,label:""}]}},w[d]=L,x[d]={type:"enum",label:nms_contentEditor.plugin_formbinding_nlBindingConfiguration(),params:{items:[{name:L,label:nms_contentEditor.plugin_formbinding_nlField()},{name:M,label:nms_contentEditor.plugin_formbinding_nlService()}]}},w[c]=O,w[e]=null,x[e]={type:"enum",label:nms_contentEditor.plugin_formbinding_nlServiceConfiguration(),params:{items:[{name:O,label:nms_contentEditor.plugin_formbinding_nlServiceSubscription()},{name:P,label:nms_contentEditor.plugin_formbinding_nlServiceUnsubscription()}]}},w[k]=[],w[j]=null;var z=this.controller.getConfManager().getConfig("list","subscription");x[k]=z.controller._metamodel._getItem(z.jpath),x[k].params=z,x[j]={label:nms_contentEditor.plugin_formbinding_Service(),type:"itempicker",params:{dialogTitle:nms_contentEditor.plugin_serviceDialog_title(),dialogClass:"nl-dce-dialog",inlineRenderer:function(a){var b=a instanceof SO.Selection?a.getItem():a;return NL.RenderFunctions.iconLabel({label:b.label,icon:b.icon})},source:k}},w[f]="",x[f]={type:"string",label:nms_contentEditor.plugin_formBinding_Value()},w[g]="",x[g]={type:"string",label:nms_contentEditor.plugin_formBinding_Label()},isIE()||(x[g].labelsPosition="none"),w[h]=!1,x[h]={label:nms_contentEditor.plugin_formBinding_CustomValueAsLabel(),type:"boolean"},w[v]="",x[v]={type:"string",label:nms_contentEditor.plugin_formBinding_UncheckedValue(),help:nms_contentEditor.plugin_formBinding_UncheckedValueHelp()},w[i]="",x[i]={label:nms_contentEditor.plugin_hyperLinkEdit_Action(),type:"enum",params:{selection:"mono",items:[{name:"",label:nms_contentEditor.pageAction_empty_action()},{name:"none",label:nms_contentEditor.pageAction_noAction()},{name:"refresh",label:nms_contentEditor.pageAction_Refresh()}]}},this.config.hasButtonAction&&this.config.hasPreviousAction&&x[i].params.items.push({name:"previous",label:nms_contentEditor.pageAction_PreviousPage()}),this.config.hasButtonAction&&this.config.hasNextAction&&x[i].params.items.push({name:"next",label:nms_contentEditor.pageAction_NextPage()}),w[l]=null,w[m]=[];var A=$.extend(this.controller.getConfManager().getConfig("list","fieldWithoutCalculated"),{schemaWalkerTypeFilter:{calculated:!0}});x[m]=A.controller._metamodel._getItem(A.jpath),x[m].params=A,x[l]={label:nms_contentEditor.plugin_formbinding_nlField(),type:"itempicker",params:{dialogTitle:nms_contentEditor.plugin_formBinding_fieldDialog_title(),dialogClass:"nl-dce-dialog",inlineRenderer:function(a){var b=a instanceof SO.Selection?a.getItem():a;return NL.RenderFunctions.iconLabel({label:b.label,icon:b.icon})},source:m},keys:["nodePath"]},w[n]="",x[n]={label:nms_contentEditor.plugin_formBinding_EnumValue(),type:"enum",params:{items:[]}},w[o]="",x[o]={label:nms_contentEditor.plugin_formBinding_UncheckedValue(),type:"enum",help:nms_contentEditor.plugin_formBinding_UncheckedValueHelp(),params:{items:[]}},w[p]=null,x[p]={label:nms_contentEditor.plugin_formBinding_BoolValue(),type:"boolean",labelsPosition:"left"},w[q]=null,x[q]={label:nms_contentEditor.plugin_formBinding_UncheckedValue(),type:"boolean",help:nms_contentEditor.plugin_formBinding_UncheckedValueHelp(),labelsPosition:"left"},w[r]="",x[r]={label:nms_contentEditor.plugin_formbinding_whichDatePart(),type:"enum",params:{items:[{name:"",label:nms_contentEditor.plugin_formbinding_noDatePart()},{name:"Y4",label:nms_contentEditor.plugin_formbinding_yearOn4()},{name:"Y2",label:nms_contentEditor.plugin_formbinding_yearOn2()},{name:"MM",label:nms_contentEditor.plugin_formbinding_month()},{name:"DD",label:nms_contentEditor.plugin_formbinding_day()}]}},w[s]="",x[s]={label:nms_contentEditor.plugin_formbinding_whichDateTimePart(),type:"enum",params:{items:[{name:"",label:nms_contentEditor.plugin_formbinding_noDatePart()},{name:"Y4",label:nms_contentEditor.plugin_formbinding_yearOn4()},{name:"Y2",label:nms_contentEditor.plugin_formbinding_yearOn2()},{name:"MM",label:nms_contentEditor.plugin_formbinding_month()},{name:"DD",label:nms_contentEditor.plugin_formbinding_day()},{name:"H4",label:nms_contentEditor.plugin_formbinding_hoursOn24()},{name:"H2",label:nms_contentEditor.plugin_formbinding_hoursOn12()},{name:"MI",label:nms_contentEditor.plugin_formbinding_minutes()}]}},w[t]=0,x[t]={label:nms_contentEditor.plugin_formbinding_minValue(),type:"number"},w[u]=0,x[u]={label:nms_contentEditor.plugin_formbinding_maxValue(),type:"number"};for(var B=0;Q.length>B;B++){for(var C=Q[B],D=[],E=0;R.length>E;E++){var F=R[E].name;S.hasOwnProperty(F)&&S[F].hasOwnProperty(C)&&2>S[F][C]&&D.push(R[E])}var G=b+"_"+C;w[G]="text",x[G]={label:nms_contentEditor.plugin_formBinding_inputType(),type:"enum",params:{items:D}}}return w[a]=!1,x[a]={type:"boolean",label:nms_contentEditor.plugin_formBinding_isMandatory()},{model:w,metamodel:x,statemodel:y}},NL.DCE.FormBindingPlugin.prototype._computeSchemaNodeLabel=function(a){return a.label},NL.DCE.FormBindingPlugin.prototype._getSchemaNodeFromField=function(a){return{nodePath:NL.XTK.toString(a.nlData(C)),label:NL.XTK.toString(a.nlData(E)),type:NL.XTK.toString(a.nlData(D))}},NL.DCE.FormBindingPlugin.prototype._bindFormElementToSchemaNode=function(a,b){var c={},d=b instanceof SO.Selection?b.getItem():b;c[C]=d.nodePath,c[E]=d.label,c[D]=d.resType,this.controller.storeDataInElement(a,c)},NL.DCE.FormBindingPlugin.prototype._elementIsFormBindingCandidate=function(a){var b=a.get(0).nodeName.toLowerCase();return("input"===b||"select"===b||"textarea"===b||"button"===b)&&!a.is('[type="hidden"], [type="reset"]')},NL.DCE.FormBindingPlugin.prototype.getName=function(){return this.name},NL.DCE.FormBindingPlugin.prototype.getLabel=function(){return this.label},NL.DCE.FormBindingPlugin.prototype.getRegistration=function(){return["message","binding","focusOn","advancedEdition","insertion","clean"]},NL.DCE.FormBindingPlugin.prototype.getAdvancedEditionData=function(b){var e=this;if(!this._elementIsFormBindingCandidate(b))return null;this._$focus=b,this._genHiddenMarkup({source:"advancedEdition"});var g=new NL.DCE.ChangeCollector({onChange:function(a,b,d,f){a===c&&(e._resetValues(d),e._resetChangeInCollector(f))}}),h=this._applyValuesOnModel(this._newBareModel(),this._loadElement(this._$focus,{fieldSelectionRendering:"link"}));this._advancedEditionFormController=new SO.MVC.Controller({model:h.model,metamodel:h.metamodel,statemodel:h.statemodel,onValueChanged:function(a,b,h,i){if(a===d&&b.setValue(c,i),a===l){if(i&&(!i||h&&b.areKeysEqual(a,h,i))||(i&&h&&(b.areKeysEqual(a,h,i)||i.hasEnumeration===h.hasEnumeration&&i.type===h.type)||(b.setValue(n,""),b.setValue(o,""),b.setValue(p,null),b.setValue(q,null),b.setValue(f,""),b.setValue(v,""),g.unsetChange(n,"value"),g.unsetChange(o,"value"),g.unsetChange(p,"value"),g.unsetChange(q,"value"),g.unsetChange(f,"value"),g.unsetChange(v,"value")),i&&(NL.XTK.parseBoolean(i.hasEnumeration)&&(b.setValue(n,NL.XTK.toString(i.enumeration.defaultValue),!0),b.setValue(o,NL.XTK.toString(i.enumeration.defaultValue),!0)),"boolean"===i.type&&(b.setValue(p,NL.XTK.parseBoolean(i.defaultValue,!0),!0),b.setValue(q,!NL.XTK.parseBoolean(i.defaultValue,!0),!0)))),i&&h&&b.areKeysEqual(a,h,i)){var j=e._loadElement(e._$focus,{schemaNode:i});NL.XTK.parseBoolean(i.hasEnumeration)&&(b.setValue(n,NL.XTK.toString(j[n]),!0),b.setValue(o,NL.XTK.toString(j[o]),!0)),"boolean"===i.type&&(b.setValue(p,NL.XTK.parseBoolean(j[p],!0),!0),b.setValue(q,NL.XTK.parseBoolean(j[q],!1),!0))}e._propagateFieldChange(i,b)}},onSave:function(a){g.stop();var b=g.getChanges();return e._saveElement(a.controller,b),a.success(),a.complete(),null},onRefreshVisibility:function(a){e._onRefreshVisibility(a,"advancedEdition")}}),this._formControllers.push(this._advancedEditionFormController);var i=this._$focus[0].nodeName.toLowerCase(),j=NL.XTK.toString(this._$focus.attr("type")).toLowerCase();"input"===i&&"checkbox"===j&&(this._advancedEditionFormController.setLabel(f,nms_contentEditor.plugin_formBinding_CheckboxValue()),this._advancedEditionFormController.setLabel(p,nms_contentEditor.plugin_formBinding_CheckboxBoolValue()),this._advancedEditionFormController.setLabel(n,nms_contentEditor.plugin_formBinding_CheckboxEnumValue()),this._advancedEditionFormController.setHelp(f,nms_contentEditor.plugin_formBinding_CheckboxValueHelp()),this._advancedEditionFormController.setHelp(p,nms_contentEditor.plugin_formBinding_CheckboxBoolValueHelp()),this._advancedEditionFormController.setHelp(n,nms_contentEditor.plugin_formBinding_CheckboxEnumValueHelp()),this._advancedEditionFormController.setHelp(a,nms_contentEditor.plugin_formBinding_CheckboxMandatoryHelp())),"input"===i&&"radio"===j&&(this._advancedEditionFormController.setMandatory(f,!0),this._advancedEditionFormController.setMandatory(p,!0),this._advancedEditionFormController.setMandatory(n,!0),this._advancedEditionFormController.setHelp(a,nms_contentEditor.plugin_formBinding_RadioMandatoryHelp())),g.reset(),g.start(this._advancedEditionFormController);var k=$.extend({},this._defaultEditFormConfig,{controller:this._advancedEditionFormController});return{content:this._getAllFormContainers({source:"advancedEdition"}),formConfig:k,checkConditions:e._advancedEditionCheckConditions}},NL.DCE.FormBindingPlugin.prototype.handleBindingAction=function(a,b,c,d){if(this._elementIsFormBindingCandidate(d))switch(a){case"field":this._bindFormElementToSchemaNode(d,c)}},NL.DCE.FormBindingPlugin.prototype.updateSidebarSection=function(a,b){if(this._elementIsFormBindingCandidate(a)){SO.assert(void 0!==this._sidebarController,"FormBindingPlugin.updateSidebarSection called without a controller");var c=this._loadElement(a),d=this._sidebarController.getValue(l);c.hasOwnProperty(l)&&d&&this._sidebarController.areKeysEqual(l,c[l],d)&&delete c[l],this._sidebarController.setValues(c,!b),this._$sectionContent.show()}else this._$sectionContent.hide()},NL.DCE.FormBindingPlugin.prototype.fillSidebarSection=function(a,b){if(this._$focus=a,a&&this._elementIsFormBindingCandidate(a)){if(this._$sectionContent)this._$sectionContent.show(),this.updateSidebarSection(a,!0);else{var c=this,e=this._defaultSideBarSectionConfig({legend:nms_contentEditor.plugin_formbinding_title(),configIcon:"coral-more",onConfigure:function(){c.controller.notifyAdvancedEdition(c._$focus,"sidebar",c.getName())}});this._$sectionContent=$("<div></div>").nlCollapsableSection(e);var f=$("<div></div>").append(this._genHiddenMarkup({source:"sidebar"})),g=this._applyValuesOnModel(this._newBareModel(),this._loadElement(a,{fieldSelectionRendering:"link"}));this._sidebarController=new SO.MVC.Controller({model:g.model,metamodel:g.metamodel,statemodel:g.statemodel,onValueChanged:function(a,b,e,f){var g=e instanceof SO.Selection?e.getItem():e,h=f instanceof SO.Selection?f.getItem():f;c._changeElement(a,b,e,f),a===d||a===l&&(!g&&g===h||g&&h&&g.nodePath===h.nodePath)||c.controller.notifyElementChange(c._$focus)},onRefreshVisibility:function(a){c._onRefreshVisibility(a,"sidebar")}}),this._formControllers.push(this._sidebarController),this._$sectionContent.nlCollapsableSection("append",f);
var h=$.extend({},this._defaultSideBarFormConfig,{controller:this._sidebarController,labelsWidth:"medium"});f.nlForm(h),b.append(this._$sectionContent)}return!0}return this._$sectionContent&&this._$sectionContent.hide(),!1},NL.DCE.FormBindingPlugin.prototype.onSubtreeInsertion=function(a){return a.find("input, textarea, select").each(function(a,b){var c=$(b);c.nlData(J)||(c.is("[readonly]")?c.nlData(J,c.attr("readonly")):c.is("[readOnly]")?c.nlData(J,c.attr("readOnly")):c.nlData(J,K),c.attr("readonly","readonly")),c.is('[type="submit"], [type="button"], [type="image"], [type="reset"], [type="radio"], [type="checkbox"]')||c.on("focus",function(a){a.stopPropagation(),a.preventDefault(),c.blur()}),"select"===b.nodeName.toLowerCase()&&c.on("focus",function(a){a.stopPropagation(),a.preventDefault(),c.delay(500).blur()})}),!0},NL.DCE.FormBindingPlugin.prototype.cleanSubtree=function(a){a.find("input, textarea, select").each(function(a,b){var c=$(b),d=c.nlData(J);d&&(d===K?c.removeAttr("readonly"):c.attr("readonly",d),c.nlData(J,null))})},NL.DCE.FormBindingPlugin.prototype.getPropertiesCommandNames=function(){return{names:[],advancedEdition:!1}},NL.DCE.FormBindingPlugin.prototype.getMessages=function(){var a=this,b=!1,c=0,d=0,e=!1;b=this.controller.getContentElement("form").length>0,this.controller.getContentElement("input, select, textarea").not("input[type='button'], input[type='image'], input[type='submit'], [type='hidden'], [type='reset']").each(function(b,e){var f=$(e);c++,f.nlData(C)||f.nlData(A)||f.nlData(z)?a.controller.highlightDone(f):(d++,a.controller.highlightToDo(f))}),this.controller.getContentElement("a, input[type='button'], input[type='image'], input[type='submit'], button[type='submit'], button[type='button']").each(function(b,f){var g=$(f);if(c++,g.is("a")){if(!e){var h=g.nlData(D);"action"===h&&"next"===g.nlData(z)&&(e=!0)}}else{var i=g.nlData(z);i?("next"===i&&(e=!0),a.controller.highlightDone(g)):(d++,a.controller.highlightToDo(g))}return!0});var f=[];return d>0&&(1===d?f.push({message:nms_contentEditor.plugin_formBinding_messages_oneFieldToMap(),type:"info"}):f.push({message:nms_contentEditor.plugin_formBinding_messages_fieldsToMap(d),type:"info"})),b||f.push({message:nms_contentEditor.plugin_formBinding_messages_noForm(),type:"warning"}),!e&&(this.config.hasLinkAction||this.config.hasButtonAction)&&this.config.hasNextAction&&f.push({message:nms_contentEditor.plugin_formBinding_messages_noNextPageaction(),type:"warning"}),f}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){NL.DCE.ElementTitlePlugin=function(){NL.DCE.ElementTitlePlugin.baseConstructor.apply(this,arguments),this.name="ElementTitlePlugin",this.label=nms_contentEditor.plugin_elementTitle_title(),this._$sectionContent=null},SO.OO.extend(NL.DCE.ElementTitlePlugin,NL.DCE.Plugin),NL.DCE.ElementTitlePlugin.prototype.getName=function(){return this.name},NL.DCE.ElementTitlePlugin.prototype.getLabel=function(){return this.label},NL.DCE.ElementTitlePlugin.prototype.getRegistration=function(){return["focusOn"]},NL.DCE.ElementTitlePlugin.prototype.fillSidebarSection=function(a,b){if(!a||"html"===a.get(0).nodeName.toLowerCase())return this._$sectionContent&&this._$sectionContent.hide(),!1;var c="";switch(a.get(0).nodeName.toUpperCase()){case"A":c=nms_contentEditor.plugin_elementTitle_e_a();break;case"ADDRESS":c=nms_contentEditor.plugin_elementTitle_e_address();break;case"BLOCKQUOTE":c=nms_contentEditor.plugin_elementTitle_e_blockquote();break;case"BODY":c=nms_contentEditor.plugin_elementTitle_e_body();break;case"BUTTON":c=nms_contentEditor.plugin_elementTitle_e_button();break;case"CENTER":c=nms_contentEditor.plugin_elementTitle_e_center();break;case"DD":c=nms_contentEditor.plugin_elementTitle_e_dd();break;case"DEL":c=nms_contentEditor.plugin_elementTitle_e_del();break;case"DIR":c=nms_contentEditor.plugin_elementTitle_e_dir();break;case"DIV":c=nms_contentEditor.plugin_elementTitle_e_div();break;case"DL":c=nms_contentEditor.plugin_elementTitle_e_dl();break;case"DT":c=nms_contentEditor.plugin_elementTitle_e_dt();break;case"FIELDSET":c=nms_contentEditor.plugin_elementTitle_e_fieldset();break;case"FORM":c=nms_contentEditor.plugin_elementTitle_e_form();break;case"H1":c=nms_contentEditor.plugin_elementTitle_e_h1();break;case"H2":c=nms_contentEditor.plugin_elementTitle_e_h2();break;case"H3":c=nms_contentEditor.plugin_elementTitle_e_h3();break;case"H4":c=nms_contentEditor.plugin_elementTitle_e_h4();break;case"H5":c=nms_contentEditor.plugin_elementTitle_e_h5();break;case"H6":c=nms_contentEditor.plugin_elementTitle_e_h6();break;case"HR":c=nms_contentEditor.plugin_elementTitle_e_hr();break;case"IMG":c=nms_contentEditor.plugin_elementTitle_e_img();break;case"INPUT":switch(a.attr("type")){case"button":c=nms_contentEditor.plugin_elementTitle_e_input_t_button();break;case"checkbox":c=nms_contentEditor.plugin_elementTitle_e_input_t_checkbox();break;case"color":c=nms_contentEditor.plugin_elementTitle_e_input_t_color();break;case"date":c=nms_contentEditor.plugin_elementTitle_e_input_t_date();break;case"datetime":c=nms_contentEditor.plugin_elementTitle_e_input_t_datetime();break;case"datetime-local":c=nms_contentEditor.plugin_elementTitle_e_input_t_datetimeLocal();break;case"email":c=nms_contentEditor.plugin_elementTitle_e_input_t_email();break;case"file":c=nms_contentEditor.plugin_elementTitle_e_input_t_file();break;case"hidden":c=nms_contentEditor.plugin_elementTitle_e_input_t_hidden();break;case"image":c=nms_contentEditor.plugin_elementTitle_e_input_t_image();break;case"month":c=nms_contentEditor.plugin_elementTitle_e_input_t_month();break;case"number":c=nms_contentEditor.plugin_elementTitle_e_input_t_number();break;case"password":c=nms_contentEditor.plugin_elementTitle_e_input_t_password();break;case"radio":c=nms_contentEditor.plugin_elementTitle_e_input_t_radio();break;case"range":c=nms_contentEditor.plugin_elementTitle_e_input_t_range();break;case"reset":c=nms_contentEditor.plugin_elementTitle_e_input_t_reset();break;case"search":c=nms_contentEditor.plugin_elementTitle_e_input_t_search();break;case"submit":c=nms_contentEditor.plugin_elementTitle_e_input_t_submit();break;case"tel":c=nms_contentEditor.plugin_elementTitle_e_input_t_tel();break;case"text":c=nms_contentEditor.plugin_elementTitle_e_input_t_text();break;case"time":c=nms_contentEditor.plugin_elementTitle_e_input_t_time();break;case"url":c=nms_contentEditor.plugin_elementTitle_e_input_t_url();break;case"week":c=nms_contentEditor.plugin_elementTitle_e_input_t_week();break;default:c=nms_contentEditor.plugin_elementTitle_e_input()}break;case"INS":c=nms_contentEditor.plugin_elementTitle_e_ins();break;case"LABEL":c=nms_contentEditor.plugin_elementTitle_e_label();break;case"LI":c=nms_contentEditor.plugin_elementTitle_e_li();break;case"MAP":c=nms_contentEditor.plugin_elementTitle_e_map();break;case"MENU":c=nms_contentEditor.plugin_elementTitle_e_menu();break;case"OBJECT":c=nms_contentEditor.plugin_elementTitle_e_object();break;case"OL":c=nms_contentEditor.plugin_elementTitle_e_ol();break;case"P":c=nms_contentEditor.plugin_elementTitle_e_p();break;case"PRE":c=nms_contentEditor.plugin_elementTitle_e_pre();break;case"SELECT":c=nms_contentEditor.plugin_elementTitle_e_select();break;case"SPAN":a.hasClass("nl-dce-field")?c=nms_contentEditor.plugin_elementTitle_e_span_c_nlDceField():a.hasClass("nl-dce-fragment")&&(c=nms_contentEditor.plugin_elementTitle_e_span_c_nlDceFragment());break;case"TABLE":c=nms_contentEditor.plugin_elementTitle_e_title();break;case"TBODY":c=nms_contentEditor.plugin_elementTitle_e_tbody();break;case"TD":c=nms_contentEditor.plugin_elementTitle_e_td();break;case"TEXTAREA":c=nms_contentEditor.plugin_elementTitle_e_textarea();break;case"TFOOT":c=nms_contentEditor.plugin_elementTitle_e_tfoot();break;case"TH":c=nms_contentEditor.plugin_elementTitle_e_th();break;case"THEAD":c=nms_contentEditor.plugin_elementTitle_e_thead();break;case"TR":c=nms_contentEditor.plugin_elementTitle_e_tr();break;case"UL":c=nms_contentEditor.plugin_elementTitle_e_ul()}return""!==c&&(this._$sectionContent?this._$sectionContent.text(c):(this._$sectionContent=$('<div class="nlui-dceplugin-elementTitle"></div>').text(c),b.append(this._$sectionContent)),this._$sectionContent.show()),!0}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){NL.DCE.ImagePlugin=function(){NL.DCE.ImagePlugin.baseConstructor.apply(this,arguments),this.name="ImagePlugin",this.label=nms_contentEditor.plugin_image_title(),this._$focusedElement=void 0,this._sidebarController=void 0,this._$sectionContent=void 0,this._$imageForm=void 0,this._uploadInProgress=!1},SO.OO.extend(NL.DCE.ImagePlugin,NL.DCE.Plugin),NL.DCE.ImagePlugin.prototype._newBareModel=function(){var a={alt:""},b={alt:{type:"string",label:nms_contentEditor.plugin_image_alt()}};return{model:a,metamodel:b}},NL.DCE.ImagePlugin.prototype._changeElement=function(a,b){switch(a){case"alt":this._$focusedElement.attr("alt",b);break;default:SO.assert(!1,"ImagePlugin: trying to call _changeElement on jpath ["+a+"]")}},NL.DCE.ImagePlugin.prototype._loadElement=function(a){return{alt:NL.XTK.toString(a.attr("alt"),"")}},NL.DCE.ImagePlugin.prototype._saveElement=function(a,b){var c=this;SO.Utils.each(b,function(a,b){c._changeElement(b.jpath,b.value)})},NL.DCE.ImagePlugin.prototype._startUpload=function(){var a=this;a._storeImageSize();var b=new SO.Widgets.Dialog($("<div></div>"),{width:402,height:146,autoOpen:!0,padding:!1,title:nms_contentEditor.plugin_image_titleImageUpload(),modal:!0,dialogClass:"nl-dce-dialog"}),c=new SO.Widgets.MonoFileDropZone($("<div></div>"),{uploader:new NL.Uploader({isPublicFile:!0}),onUploadComplete:function(c,d){a._onImageUploadComplete({$element:a._$focusedElement,newUrl:d.url}),b.destroy()}});b.setContent(c.el)},NL.DCE.ImagePlugin.prototype._isImage=function(a){return"img"===a.get(0).nodeName.toLowerCase()},NL.DCE.ImagePlugin.prototype.getName=function(){return this.name},NL.DCE.ImagePlugin.prototype.getLabel=function(){return this.label},NL.DCE.ImagePlugin.prototype.getRegistration=function(){return["focusOn","insertion"]},NL.DCE.ImagePlugin.prototype.fillSidebarSection=function(a,b){if(this._$focusedElement=a,a&&this._isImage(a)){if(this._$sectionContent)this._$sectionContent.show(),this.updateSidebarSection(a,!0);else{var c=this;void 0!==this._sidebarController&&SO.log.warn("ImagePlugin.fillSidebarSection called twice");var d=this._applyValuesOnModel(this._newBareModel(),this._loadElement(a));this._sidebarController=new SO.MVC.Controller({model:d.model,metamodel:d.metamodel,onValueChanged:function(a,b,d,e){c._changeElement(a,e),c.controller.notifyElementChange(c._$focusedElement)}}),this._formControllers.push(this._sidebarController),this._$imageForm=$("<div></div>").soQuickForm({},this._defaultSideBarFormConfig,{controller:this._sidebarController,attributes:["alt"]});var e=this._defaultSideBarSectionConfig({legend:nms_contentEditor.plugin_image_title()});this._$sectionContent=$("<div></div>").nlCollapsableSection(e),this._$sectionContent.nlCollapsableSection("append",this._$imageForm),b.append(this._$sectionContent)}return!0}return this._$sectionContent&&this._$sectionContent.hide(),!1},NL.DCE.ImagePlugin.prototype.updateSidebarSection=function(a,b){this._isImage(a)?(SO.assert(void 0!==this._sidebarController,"ImagePlugin.updateSidebarSection called without a controller"),this._sidebarController.setValues(this._loadElement(a),!b),this._$sectionContent.show()):this._$sectionContent.hide()},NL.DCE.ImagePlugin.prototype.getAdvancedEditionData=function(a){if(this._isImage(a)){var b=this,c=new NL.DCE.ChangeCollector,d=this._newBareModel(),e=new SO.MVC.Controller({model:d.model,metamodel:d.metamodel,onSave:function(a){c.stop();var d=c.getChanges();return b._saveElement(b._$focusedElement,d),a.success(),a.complete(),null}});e.setValues(b._loadElement(a),!0),c.start(e),this._formControllers.push(this.controller);var f=$("<div></div>").soSimpleButton({label:nms_contentEditor.plugin_image_image(),icon:"ui-icon-image",onClick:function(){b._startUpload()}}),g=$('<div><div data-nl-jpath="alt"></div></div>').prepend(f);return{content:g,formConfig:$.extend(!0,this._defaultEditFormConfig,{controller:e})}}return null},NL.DCE.ImagePlugin.prototype.getEditionCommands=function(){var a=this;return[{where:"root",command:{name:"image_image",icon:"coral-image",help:"Adobe Marketing Cloud Shared Assets",action:function(b){function c(b){if(console.log(b),b.data){var c=JSON.parse(b.data);if(c&&c.data&&c.data.length&&c.data.length>0){var d=c.data[0].url;console.log(c.data[0]),console.log(d),a._onImageUploadComplete({$element:a._$focusedElement,newUrl:d})}}e.soDialog("close")}var d=!1;a._$focus=b;var e=$('<div class="aemSelectDialog" style="display:none;"></div>'),f=$('<iframe src ="/view/assetpicker?type=image&mode=single&typeFilters=disable" height="100%" width="100%" ></iframe>');e.append(f),window.addEventListener?window.addEventListener("message",c,!1):window.attachEvent&&window.attachEvent("onmessage",c,!1),e.soDialog({width:1200,height:1200,autoOpen:!0,title:"Adobe Marketing Cloud Asset Selector",modal:!0,buttons:[{label:nms_contentEditor.dialog_cancel(),cancels:!0,click:function(){d=!0}}],open:function(){},cancel:function(){this.close()}})}}}]},NL.DCE.ImagePlugin.prototype.getPropertiesCommandNames=function(a){return this._isImage(a)?{names:["image_image"],advancedEdition:!1}:{names:[],advancedEdition:!1}},NL.DCE.ImagePlugin.prototype._storeImageSize=function(){this._oldWidth=this._$focusedElement.width(),this._oldHeight=this._$focusedElement.height()},NL.DCE.ImagePlugin.prototype._restoreImageSize=function(){this._$focusedElement.css({width:this._oldWidth+"px",height:this._oldHeight+"px"})},NL.DCE.ImagePlugin.prototype._onImageUploadComplete=function(a){var b=this;if("img"===a.$element.get(0).nodeName.toLowerCase()){var c=a.$element.attr("src"),d=function(){b.controller.notifyElementChange(a.$element),b.controller.forceSelectBlock(a.$element),b.controller.activeInteractions()};a.$element.one("load",function(){d()}).on("readystatechange",function(){(this.complete||"loaded"===this.readyState||"complete"===this.readyState)&&d()}).on("error",function(){d()}).attr("src",a.newUrl),c===a.newUrl&&d(),this._restoreImageSize()}else a.$element.append($("<img />").one("load",function(){b.controller.activeInteractions()}).attr("src",a.newUrl)),b.controller.deselectAll(!1)},NL.DCE.ImagePlugin.prototype._getImageVisibleCenter=function(){var a=this.controller._contentEditor.getIFrame(),b=this._$focusedElement.offset(),c=this._$focusedElement.get(0);if(c.ownerDocument&&c.ownerDocument.defaultView&&!SO.isNundef(c.ownerDocument.defaultView.pageYOffset))b.top-=c.ownerDocument.defaultView.pageYOffset,b.left-=c.ownerDocument.defaultView.pageXOffset;else if(c.ownerDocument&&c.ownerDocument.parentWindow&&!SO.isNundef(c.ownerDocument.parentWindow.pageYOffset))b.top-=c.ownerDocument.parentWindow.pageYOffset,b.left-=c.ownerDocument.parentWindow.pageXOffset;else{var d=this._$focusedElement.closest("body"),e=d.parent().get(0);b.top-=d.scrollTop()||e&&e.document&&e.document.documentElement.scrollTop||0,b.left-=d.scrollLeft()||e&&e.document&&e.document.documentElement.scrollLeft||0}var f=a.offset(),g=this._$focusedElement.width(),h=this._$focusedElement.height(),i=Math.max(f.left+b.left,f.left),j=Math.max(f.top+b.top,f.top),k=Math.min(f.left+b.left+g,f.left+a.width()),l=Math.min(f.top+b.top+h,f.top+a.height());return{top:j+(l-j)/2,left:i+(k-i)/2}},NL.DCE.ImagePlugin.prototype.onSubtreeInsertion=function(a){var b=this,c=a.find("div.nl_img, img");a.is("div.nl_img, img")&&(c=c.add(a)),c.each(function(a,c){$(c).find("img").length>0&&$(c).addClass("nl_img_filled"),isIE()&&b._isImage($(c))&&$(c)[0].setAttribute("unselectable","on")})}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){var a="nl-dce-field",b="nl-dce-fragment",c="expr",d="type",e="format",f="name",g="label",h={date:{jpath:"dateFormat",label:nms_contentEditor.plugin_format_date_label(),defaultFormat:"date",formats:[{name:"date",label:nms_contentEditor.plugin_format_date_date()},{name:"longdate",label:nms_contentEditor.plugin_format_date_longdate()},{name:"%2D/%2M/%2Y",label:nms_contentEditor.plugin_format_date_2Ds2Ms2Y()},{name:"%2D/%2M/%4Y",label:nms_contentEditor.plugin_format_date_2Ds2Ms4Y()},{name:"%2Y/%2M/%2D",label:nms_contentEditor.plugin_format_date_2Ys2Ms2D()},{name:"%4Y/%2M/%2D",label:nms_contentEditor.plugin_format_date_4Ys2Ms2D()},{name:"%2M/%2D/%2Y",label:nms_contentEditor.plugin_format_date_2Ms2Ds2Y()},{name:"%2M/%2D/%4Y",label:nms_contentEditor.plugin_format_date_2Ms2Ds4Y()},{name:"%2Y-%2M-%2D",label:nms_contentEditor.plugin_format_date_2Ym2Mm2D()},{name:"%4Y-%2M-%2D",label:nms_contentEditor.plugin_format_date_4Ym2Mm2D()},{name:"%2D.%2M.%2Y",label:nms_contentEditor.plugin_format_date_2Dd2Md2Y()},{name:"%2D.%2M.%4Y",label:nms_contentEditor.plugin_format_date_2Dd2Md4Y()},{name:"%2Y.%2M.%2D",label:nms_contentEditor.plugin_format_date_2Yd2Md2D()},{name:"%4Y.%2M.%2D",label:nms_contentEditor.plugin_format_date_4Yd2Md2D()}]},datetime:{jpath:"datetimeFormat",label:nms_contentEditor.plugin_format_datetime_label(),defaultFormat:"datetime",formats:[{name:"datetime",label:nms_contentEditor.plugin_format_datetime_datetime()},{name:"longdatetime",label:nms_contentEditor.plugin_format_datetime_longdatetime()},{name:"date",label:nms_contentEditor.plugin_format_datetime_date()},{name:"longdate",label:nms_contentEditor.plugin_format_datetime_longdate()},{name:"time",label:nms_contentEditor.plugin_format_datetime_time()},{name:"%2D/%2M/%2Y %2H:%2N",label:nms_contentEditor.plugin_format_datetime_2Ds2Ms2Y_2H_2N()},{name:"%2D/%2M/%4Y %2H:%2N",label:nms_contentEditor.plugin_format_datetime_2Ds2Ms4Y_2H_2N()},{name:"%2Y/%2M/%2D %2H:%2N",label:nms_contentEditor.plugin_format_datetime_2Ys2Ms2D_2H_2N()},{name:"%4Y/%2M/%2D %2H:%2N",label:nms_contentEditor.plugin_format_datetime_4Ys2Ms2D_2H_2N()},{name:"%2M/%2D/%2Y %I:%2N %P",label:nms_contentEditor.plugin_format_datetime_2Ms2Ds2Y_I_2N_P()},{name:"%2M/%2D/%4Y %I:%2N %P",label:nms_contentEditor.plugin_format_datetime_2Ms2Ds4Y_I_2N_P()},{name:"%2Y-%2M-%2D %2H:%2N",label:nms_contentEditor.plugin_format_datetime_2Ym2Mm2D_2H_2N()},{name:"%4Y-%2M-%2D %2H:%2N",label:nms_contentEditor.plugin_format_datetime_4Ym2Mm2D_2H_2N()},{name:"%2D.%2M.%2Y %2H:%2N",label:nms_contentEditor.plugin_format_datetime_2Dd2Md2Y_2H_2N()},{name:"%2D.%2M.%4Y %2H:%2N",label:nms_contentEditor.plugin_format_datetime_2Dd2Md4Y_2H_2N()},{name:"%2Y.%2M.%2D %2H:%2N",label:nms_contentEditor.plugin_format_datetime_2Yd2Md2D_2H_2N()},{name:"%4Y.%2M.%2D %2H:%2N",label:nms_contentEditor.plugin_format_datetime_4Yd2Md2D_2H_2N()},{name:"%2D/%2M/%2Y",label:nms_contentEditor.plugin_format_date_2Ds2Ms2Y()},{name:"%2D/%2M/%4Y",label:nms_contentEditor.plugin_format_date_2Ds2Ms4Y()},{name:"%2Y/%2M/%2D",label:nms_contentEditor.plugin_format_date_2Ys2Ms2D()},{name:"%4Y/%2M/%2D",label:nms_contentEditor.plugin_format_date_4Ys2Ms2D()},{name:"%2M/%2D/%2Y",label:nms_contentEditor.plugin_format_date_2Ms2Ds2Y()},{name:"%2M/%2D/%4Y",label:nms_contentEditor.plugin_format_date_2Ms2Ds4Y()},{name:"%2Y-%2M-%2D",label:nms_contentEditor.plugin_format_date_2Ym2Mm2D()},{name:"%4Y-%2M-%2D",label:nms_contentEditor.plugin_format_date_4Ym2Mm2D()},{name:"%2D.%2M.%2Y",label:nms_contentEditor.plugin_format_date_2Dd2Md2Y()},{name:"%2D.%2M.%4Y",label:nms_contentEditor.plugin_format_date_2Dd2Md4Y()},{name:"%2Y.%2M.%2D",label:nms_contentEditor.plugin_format_date_2Yd2Md2D()},{name:"%4Y.%2M.%2D",label:nms_contentEditor.plugin_format_date_4Yd2Md2D()},{name:"%2Y.%2M.%2D",label:nms_contentEditor.plugin_format_date_2Yd2Md2D()},{name:"%2H:%2N",label:nms_contentEditor.plugin_format_datetime_2H_2N()},{name:"%I:%2N %P",label:nms_contentEditor.plugin_format_datetime_I_2N_P()}]}};NL.DCE.InlineInsertionPlugin=function(){NL.DCE.InlineInsertionPlugin.baseConstructor.apply(this,arguments),this.name="InlineInsertionPlugin",this.label=nms_contentEditor.plugin_inlineInsertion_title(),this._$currentlyDisplayedList=void 0,this._$focus=void 0,this._sidebarControllerField=void 0,this._sidebarControllerContentFragment=void 0,this._$sectionContent=void 0},SO.OO.extend(NL.DCE.InlineInsertionPlugin,NL.DCE.Plugin),NL.DCE.InlineInsertionPlugin.prototype._disableContentEditable=function(){var a=this.controller.getContentEditor();this._$focus&&(this._$focus.get(0).contentEditable?a.setContentEditable(this._$focus):a.stopContentEditable(this._$focus))},NL.DCE.InlineInsertionPlugin.prototype._newBareModel=function(a){var b={},c={},d={},e=this.controller.getConfManager().getConfig("list","fieldWithCalculated"),f=this.controller.getConfManager().getConfig("list","contentFragment");if(b={fieldStorage:[],field:null,contentFragmentStorage:[],contentFragment:null},c={fieldStorage:$.extend(!0,{},e.controller._metamodel._getItem(e.jpath),{params:e}),field:{label:nms_contentEditor.plugin_label_Field(),labelsPosition:"none",type:"itempicker",params:{dialogTitle:nms_contentEditor.plugin_dialogTitle_Field(),inlineRenderer:function(a){var b=a instanceof SO.Selection?a.getItem():a;return NL.RenderFunctions.iconLabel({label:b.label,icon:b.thumbnail})},source:"fieldStorage"}},contentFragmentStorage:$.extend(!0,{},f.controller._metamodel._getItem(f.jpath),{params:f}),contentFragment:{label:nms_contentEditor.plugin_label_ContentFragment(),labelsPosition:"none",type:"itempicker",displayColumnsHeader:f.displayColumnsHeader,params:{dialogTitle:nms_contentEditor.plugin_dialogTitle_ContentFragment(),inlineRenderer:function(a){var b=a instanceof SO.Selection?a.getItem():a;return NL.RenderFunctions.iconLabel({label:b.label,icon:b.thumbnail})},source:"contentFragmentStorage"}}},"field"===a)for(var g in h){var i=h[g];c[i.jpath]={type:"enum",label:i.label,params:{items:i.formats}},b[i.jpath]=null}return{model:b,metamodel:c,statemodel:d}},NL.DCE.InlineInsertionPlugin.prototype._loadElement=function(a,b){var i,b,j;if("field"===b){var i=a.nlData(c);if(SO.isNundef(i))return{field:null};var b=a.nlData(d),j=a.nlData(e),k=a.text(),l={field:new SO.Selection({selectionMode:"mono",items:[{nodePath:i,type:b,label:k}]})};return h.hasOwnProperty(b)&&(l[h[b].jpath]=j),l}if("contentFragment"===b){var m=a.nlData(f);if(SO.isNundef(m))return{contentFragment:null};var n=a.nlData(g);SO.isEmpty(n)&&(n=m);var k=a.text();return{contentFragment:new SO.Selection({selectionMode:"mono",items:[{name:m,label:k}]})}}},NL.DCE.InlineInsertionPlugin.prototype._insertField=function(b){var c=b instanceof SO.Selection?b.getItem():b,d=this.controller.insertInclusionAtSelection(this._getFieldLabel(c),{"class":a},this._getFieldData(c));return this._disableContentEditable(),this.controller.notifyInsertion(d.parent()),this.controller._isInhibited("focus")||this.controller.getContentEditor().focus(),d},NL.DCE.InlineInsertionPlugin.prototype._getFieldData=function(a){var b={},f=this._getFieldType(a);return b[c]=this._getFieldExpr(a),b[d]=f,h.hasOwnProperty(f)&&(b[e]=h[f].defaultFormat),b},NL.DCE.InlineInsertionPlugin.prototype._getFieldExpr=function(a){return a.nodePath},NL.DCE.InlineInsertionPlugin.prototype._getFieldType=function(a){return a.resType},NL.DCE.InlineInsertionPlugin.prototype._getFieldLabel=function(a,b){var c=a.label;return c||(c=b?b:this._getFieldExpr(a)),c},NL.DCE.InlineInsertionPlugin.prototype._storeField=function(a,b){var c=b instanceof SO.Selection?b.getItem():b,d=this._getFieldExpr(c),e=this._getFieldLabel(c,d);e!==a.text()&&a.text(e),this.controller.storeDataInElement(a,this._getFieldData(c))},NL.DCE.InlineInsertionPlugin.prototype._storeFormat=function(a,b){var c={};c[e]=b,this.controller.storeDataInElement(a,c)},NL.DCE.InlineInsertionPlugin.prototype._storeFieldSource=function(){},NL.DCE.InlineInsertionPlugin.prototype._showFieldSelection=function(a,b){var c=this.controller.getConfManager().getConfig("list","fieldWithCalculated"),d={},e=this;d.fields=SO.Utils.extend(!0,{},c.controller._metamodel._getItem(c.jpath)),d.fields.params=SO.Utils.extend(!0,{},c);var f=new SO.MVC.Controller({model:{fields:[]},metamodel:d});this._$currentlyDisplayedList=new SO.Widgets.ItemPicker($("<div></div>"),{onInternalChange:b,configManager:this.config.configManager,params:{dialogTitle:nms_contentEditor.plugin_dialogTitle_Field(),autoOpen:!0,controller:f,sourcePath:"fields",dialogClass:"nl-dce-dialog",onClose:function(){setTimeout(function(){e.controller._isInhibited("focus")||e.controller.getContentEditor().focus()},100)}}})},NL.DCE.InlineInsertionPlugin.prototype._appendFieldForm=function(a){var b=this,c=$('<div><div data-nl-jpath="field"></div></div>');this._formatForms={};for(var d in h){var e=$("<div></div>");e.attr("data-nl-jpath",h[d].jpath),c.append(e),this._formatForms[d]=e}var f=this._defaultSideBarSectionConfig({legend:nms_contentEditor.plugin_legend_Data()}),g=$("<div></div>").append(c).nlCollapsableSection(f),i=this._applyValuesOnModel(this._newBareModel("field"),this._loadElement(a,"field"));this._sidebarControllerField=new SO.MVC.Controller({model:i.model,metamodel:i.metamodel,statemodel:i.statemodel,onValueChanged:function(a,c,d,e){if("field"===a)e?(b._storeField(b._$focus,e),b.controller.notifyElementChange(b._$focus)):b._removeInclusion(b._$focus);else for(var f in h){var g=h[f].jpath;if(g===a){b._storeFormat(b._$focus,e),b.controller.notifyElementChange(b._$focus);break}}},onRefreshVisibility:function(a){b._onRefreshVisibility(a)}}),this._formControllers.push(this._sidebarControllerField);var j=$.extend({},this._defaultSideBarFormConfig,{controller:this._sidebarControllerField});return c.nlForm(j),g},NL.DCE.InlineInsertionPlugin.prototype._onRefreshVisibility=function(a){var b=a.getValue("field");b=b instanceof SO.Selection?b.getItem():b;for(var c in h)b&&b.type===c?this._formatForms[c].show():this._formatForms[c].hide()},NL.DCE.InlineInsertionPlugin.prototype._getContentFragmentData=function(a){var b=this._getContentFragmentLabel(a),c=b+" ("+a.name+")",d={};return d[f]=a.name,d[g]=c,d},NL.DCE.InlineInsertionPlugin.prototype._getContentFragmentLabel=function(a){var b=a.name,c=a.label;return SO.isEmpty(c)&&(c=b),c},NL.DCE.InlineInsertionPlugin.prototype._insertContentFragment=function(a){var c=a instanceof SO.Selection?a.getItem():a,d=this.controller.insertInclusionAtSelection(this._getContentFragmentLabel(c),{"class":b},this._getContentFragmentData(c));return this._disableContentEditable(),this.controller.notifyInsertion(d.parent()),this.controller._isInhibited("focus")||this.controller.getContentEditor().focus(),d},NL.DCE.InlineInsertionPlugin.prototype._storeContentFragment=function(a,b){var c=b instanceof SO.Selection?b.getItem():b,d=this._getContentFragmentLabel(c);d!==a.text()&&a.text(d),this.controller.storeDataInElement(a,this._getContentFragmentData(c))},NL.DCE.InlineInsertionPlugin.prototype._storeContentFragmentSource=function(){},NL.DCE.InlineInsertionPlugin.prototype._showContentFragmentSelection=function(a,b){var c=this.controller.getConfManager().getConfig("list","contentFragment"),d={},e=this;d.contentFragment=SO.Utils.extend(!0,{},c.controller._metamodel._getItem(c.jpath)),d.contentFragment.params=SO.Utils.extend(!0,{},c);var f=new SO.MVC.Controller({model:{contentFragment:null},metamodel:d});this._$currentlyDisplayedList=new SO.Widgets.ItemPicker($("<div></div>"),{onInternalChange:b,displayColumnsHeader:c.displayColumnsHeader,configManager:this.config.configManager,params:{dialogTitle:nms_contentEditor.plugin_dialogTitle_ContentFragment(),autoOpen:!0,controller:f,sourcePath:"contentFragment",dialogClass:"nl-dce-dialog",onClose:function(){setTimeout(function(){e.controller._isInhibited("focus")||e.controller.getContentEditor().focus()},100)}}})},NL.DCE.InlineInsertionPlugin.prototype._appendContentFragmentForm=function(a){var b=this,c=$("<div></div>").append('<div data-nl-jpath="contentFragment"></div>'),d=this._defaultSideBarSectionConfig({legend:nms_contentEditor.plugin_legend_Data()}),e=$("<div></div>").append(c).nlCollapsableSection(d),f=this._applyValuesOnModel(this._newBareModel("contentFragment"),this._loadElement(a,"contentFragment"));this._sidebarControllerContentFragment=new SO.MVC.Controller({model:f.model,metamodel:f.metamodel,statemodel:f.statemodel,onValueChanged:function(a,c,d,e){if(e){var f;f=e instanceof SO.Selection?e:new SO.Selection({selectionMode:"mono",items:[e]}),b._storeContentFragment(b._$focus,f),b.controller.notifyElementChange(b._$focus)}else b._removeInclusion(b._$focus)}}),this._formControllers.push(this._sidebarControllerContentFragment);var g=$.extend({},this._defaultSideBarFormConfig,{controller:this._sidebarControllerContentFragment});return c.nlForm(g),e},NL.DCE.InlineInsertionPlugin.prototype._removeInclusion=function(a){this.controller.deselectAll(!0);var b=a.parent();this.controller.getLayoutManager().deleteBlock(a),this.controller.notifyDeletion(b,a),this.controller._isInhibited("focus")||this.controller.getContentEditor().focus()},NL.DCE.InlineInsertionPlugin.prototype._isInclusion=function(c){return c.hasClass(a)||c.hasClass(b)},NL.DCE.InlineInsertionPlugin.prototype.getName=function(){return this.name},NL.DCE.InlineInsertionPlugin.prototype.getLabel=function(){return this.label},NL.DCE.InlineInsertionPlugin.prototype.getRegistration=function(){return["inlineInsertion","focusOn","message"]},NL.DCE.InlineInsertionPlugin.prototype.handleInlineInsertionAction=function(a,b,c){switch(a){case"field":return this._insertField(c),!0;case"contentFragment":return this._insertContentFragment(c),!0}return!1},NL.DCE.InlineInsertionPlugin.prototype.getEditionCommands=function(){var a=this,b={where:"insertSection",command:{name:"inlineInsertion_mediaField",icon:"coral-persoField",help:nms_contentEditor.media_field_help(),iconSize:18,action:function(b){a._$focus=b,a._showFieldSelection(b,function(b){b&&a._insertField(b)},function(){a.controller.getContentEditor().restoreBookmark()})}}},c={where:"insertSection",command:{name:"inlineInsertion_mediaBlock",icon:"coral-personalizationBlock",help:nms_contentEditor.media_personalizationBloc_help(),iconSize:18,action:function(b){a._$focus=b,a._showContentFragmentSelection(b,function(b){b&&a._insertContentFragment(b)},function(){a.controller.getContentEditor().restoreBookmark()})}}};return[b,c]},NL.DCE.InlineInsertionPlugin.prototype.getTextCommandNames=function(a){if(this._isInclusion(a)||this.controller.isEditableElement(a)){if(this._isInclusion(a))return{names:[],advancedEdition:!1};var b=[];return this.config.persoFieldInsertion&&b.push("inlineInsertion_mediaField"),this.config.persoBlockInsertion&&b.push("inlineInsertion_mediaBlock"),{names:b,advancedEdition:!1}}return{names:[],advancedEdition:!1}},NL.DCE.InlineInsertionPlugin.prototype.updateSidebarSection=function(c,d){this._isInclusion(c)||this.controller.isEditableElement(c)?c.hasClass(a)?(SO.assert(void 0!==this._sidebarControllerField,"InlineInsertionPlugin.updateSidebarSection called without a controller"),this._sidebarControllerField.setValues(this._loadElement(c,"field"),!d),this._$fieldForm.show(),this._$contentFragmentForm.hide()):c.hasClass(b)?(SO.assert(void 0!==this._sidebarControllerContentFragment,"InlineInsertionPlugin.updateSidebarSection called without a controller"),this._sidebarControllerContentFragment.setValues(this._loadElement(c,"contentFragment"),!d),this._$contentFragmentForm.show(),this._$fieldForm.hide()):(this._$contentFragmentForm.hide(),this._$fieldForm.hide()):this._$sectionContent.hide()},NL.DCE.InlineInsertionPlugin.prototype.fillSidebarSection=function(c,d){return this._$focus=c,c&&(this._isInclusion(c)||this.controller.isEditableElement(c))?(this._$sectionContent?(this._$sectionContent.show(),this.updateSidebarSection(c,!0)):(this._$sectionContent=$("<div></div>"),this._$fieldForm=this._appendFieldForm(c),this._$sectionContent.append(this._$fieldForm),c.hasClass(a)?this._$fieldForm.show():this._$fieldForm.hide(),this._$contentFragmentForm=this._appendContentFragmentForm(c),this._$sectionContent.append(this._$contentFragmentForm),c.hasClass(b)?this._$contentFragmentForm.show():this._$contentFragmentForm.hide(),d.append(this._$sectionContent),this.controller.clearBrowserSelection()),!0):(this._$sectionContent&&this._$sectionContent.hide(),!1)},NL.DCE.InlineInsertionPlugin.prototype.getMessages=function(){var d=this,e=0,g=0;this.controller.getContentElement("span."+a+", span."+b).each(function(a,b){e++;var h=$(b);h.nlData(c)||h.nlData(f)?d.controller.highlightDone(h):(g++,d.controller.highlightToDo(h))});var h=[];return g>0&&(1===g?h.push({message:nms_contentEditor.plugin_inlineInsertion_messages_onePersoToMap(),type:"warning"}):h.push({message:nms_contentEditor.plugin_inlineInsertion_messages_xPersoToMap(g),type:"warning"})),h}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){NL.DCE.LayoutPlugin=function(){NL.DCE.LayoutPlugin.baseConstructor.apply(this,arguments),this.name="LayoutPlugin",this.label=nms_contentEditor.plugin_layout_title()},SO.OO.extend(NL.DCE.LayoutPlugin,NL.DCE.Plugin),NL.DCE.LayoutPlugin.prototype.getName=function(){return this.name},NL.DCE.LayoutPlugin.prototype.getLabel=function(){return this.label},NL.DCE.LayoutPlugin.prototype.getRegistration=function(){return["focusOn"]},NL.DCE.LayoutPlugin.prototype.getEditionCommands=function(){var a=this;return[{where:"root",command:{name:"layout_delete",icon:"coral-delete",help:nms_contentEditor.tools_delete(),action:function(b){$("<div></div>").append(nms_contentEditor.tools_validateBlocDeletion()).soDialog({title:nms_contentEditor.tools_confirmDeletion(),modal:!0,dialogClass:"nl-dce-dialog",destroyOnClose:!0,removeOnClose:!0,noPrimaryFirstButton:!0,resizable:!1,buttons:[{text:nms_contentEditor.dialog_cancel(),click:function(){$(this).soDialog("close")}},{text:nms_contentEditor.dialog_ok(),mode:"primary",click:function(){a.controller.deselectAll(!0);var c=b.parent();a.controller.getLayoutManager().deleteBlock(b),a.controller.notifyDeletion(c,b),$(this).soDialog("close"),a.controller.forceSelectBlock(c,!1,"end"),a.controller._isInhibited("focus")||a.controller.getContentEditor().focus()}}]})}}},{where:"root",command:{name:"layout_duplicate",icon:"coral-copy",help:nms_contentEditor.tools_duplicate(),action:function(b){a.controller.deselectAll(!1),a.controller.getLayoutManager().duplicateBlock(b),a.controller.notifyInsertion(b.parent()),a.controller.forceSelectBlock(b,!1,"end"),a.controller._isInhibited("focus")||a.controller.getContentEditor().focus()}}}]},NL.DCE.LayoutPlugin.prototype.getPropertiesCommandNames=function(a){if(a.is("td, body"))return{names:[],advancedEdition:!1};var b=[],c=!1,d=!1;return"*"===this.config.deletableBlocks?c=""!==this.config.notDeletableBlocks?!a.is(this.config.notDeletableBlocks):!0:"*"===this.config.notDeletableBlocks&&(c=""!==this.config.deletableBlocks?a.is(this.config.deletableBlocks):!1),c&&b.push("layout_delete"),"*"===this.config.duplicableBlocks?d=""!==this.config.notDuplicableBlocks?!a.is(this.config.notDuplicableBlocks):!0:"*"===this.config.notDuplicableBlocks&&(d=""!==this.config.duplicableBlocks?a.is(this.config.duplicableBlocks):!1),d&&b.push("layout_duplicate"),{names:b,advancedEdition:!1}}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(){NL.DCE.OfferPlugin=function(){NL.DCE.OfferPlugin.baseConstructor.apply(this,arguments),this.name="OfferPlugin"},SO.OO.extend(NL.DCE.OfferPlugin,NL.DCE.Plugin),NL.DCE.OfferPlugin.prototype._saveElement=function(){},NL.DCE.OfferPlugin.prototype.getName=function(){return this.name},NL.DCE.OfferPlugin.prototype.getEditionCommands=function(){return[{where:"insertMenu",command:{name:"offer_mediaOffer",id:"offer",label:nms_contentEditor.media_offer(),icon:"ui-icon-star",action:function(){},activationState:"disabled"}}]},NL.DCE.OfferPlugin.prototype.getEditionCommands=function(){return[{where:"insertMenu",command:{name:"offer_mediaOffer",id:"offer",label:nms_contentEditor.media_offer(),icon:"ui-icon-star",action:function(){},activationState:"disabled"}}]},NL.DCE.OfferPlugin.prototype.getPropertiesCommandNames=function(){return{names:["offer_mediaOffer"],advancedEdition:!0}}})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlEditBox",a.NL.nlWidget,{options:{contentEditor:null,toolbarOptions:null,controller:null,outlineWidth:3},over:function(a,b){var c=[];SO.Utils.each(b,function(a,b){c.push(b)}),this.$overToolbar.nlFloatToolbar("setOnlyVisibleCommands",c,!0),this._$overTarget=a,this.stateOver=!0,this.refresh("over")},edit:function(a,b){this.$overToolbar.hide();var c=[];SO.Utils.each(b,function(a,b){c.push(b)}),this.$editToolbar.nlFloatToolbar("setOnlyVisibleCommands",c,!0),this._$editTarget=a,this.stateEdit=!0,this.refresh("edit")},repositionToolbar:function(a){a=a||"all";var b="over"===a||"all"===a,c="edit"===a||"all"===a;if(b&&this.stateOver){var d=this.$overToolbar,e=this._$overTarget;d.nlFloatToolbar("reposition",e)}if(c&&this.stateEdit&&SO.isNundef(this.options.toolbarContainer)){var d=this.$editToolbar,e=this._$editTarget;d.nlFloatToolbar("reposition",e)}},refresh:function(a){a=a||"all";var b="over"===a||"all"===a,c="edit"===a||"all"===a,d=!SO.isNundef(this.options.toolbarContainer);if(b&&this.stateOver){var e=this.$overToolbar,f=this._$overTarget;e.nlFloatToolbar("refresh"),e.nlFloatToolbar("show",f)}if(c&&this.stateEdit){var e=this.$editToolbar,f=this._$editTarget;e.nlFloatToolbar("refresh"),e.nlFloatToolbar("show",f,d)}},changeCommandStates:function(a){this.$editToolbar.nlFloatToolbar("changeCommandStates",a)},hide:function(){this.$editToolbar&&this.$editToolbar.nlFloatToolbar("hide"),this.$overToolbar&&this.$overToolbar.nlFloatToolbar("hide")},stop:function(){this.stateEdit=!1,this.stateOver=!1,this.hide()},stopHover:function(){this.$overToolbar&&this.$overToolbar.hide(),this.stateOver=!1},destroy:function(){this.$editToolbar.is(":nl-nlFloatToolbar")&&this.$editToolbar.nlFloatToolbar("destroy"),this.$editToolbar.remove(),this.$overToolbar.is(":nl-nlFloatToolbar")&&this.$overToolbar.nlFloatToolbar("destroy"),this.$overToolbar.remove()},_create:function(){this.stateEdit=!1,this.stateOver=!1,this.element.css("position","relative"),this.$editToolbar=this._createToolbar(this.options.editionCommands),this.$overToolbar=this._createOverToolbar(this.options.overCommands)},_editorAction:function(a,b){var c=this;if("newline"===a){var d=c.options.contentEditor.getSelectionNode();"LI"!==d.nodeName&&"DT"!==d.nodeName&&"DD"!==d.nodeName&&(c.options.contentEditor.setSelectionContent("<br/>"),b.event.stopPropagation(),b.event.preventDefault())}},_createOverToolbar:function(b){var c=this,d={},e=[],f=a('<div class="nlToolBar_editBox_hovered"></div>');return this.element.append(f),SO.Utils.each(b,function(b,f){SO.Utils.each(f,function(b,f){f.command.name&&(f.command.command=function(){f.command.action(c._$overTarget)},d[f.command.name]=a.extend(f.command,{hidden:!0}),e.push(f.command.name))})}),f.nlFloatToolbar(a.extend({commandConfigs:d,commands:e,outer:{top:!1,bottom:!1,left:!0,right:!1},outlineWidth:{top:this.options.outlineWidth,right:this.options.outlineWidth,bottom:this.options.outlineWidth,left:this.options.outlineWidth}},this.options.toolbarOptions)),f},_createToolbar:function(b){var c=this,d={},e={config:{icon:"coral-user",rightIcon:"unfold-element",help:xtk_core.editBox_toolbar_addOptions()},subCommands:[]},f={config:{icon:"coral-link",rightIcon:"unfold-element",help:xtk_core.editBox_toolbar_addLink()},subCommands:[]},g=[],h=[],i=a("<div></div>");if(this.options.toolbarContainer?this.options.toolbarContainer.append(i):this.element.append(i),SO.Utils.each(b,function(b,i){SO.Utils.each(i,function(b,i){i.separator===!0?h.push(null):i.command.name&&(i.command.command=function(){i.command.action(c._$editTarget)},d[i.command.name]=a.extend(i.command,{hidden:!0}),"insertMenu"===i.where?e.subCommands.push(i.command.name):"linkMenu"===i.where?f.subCommands.push(i.command.name):"insertSection"===i.where?g.push(i.command.name):h.push(i.command.name))}),e.subCommands.length>0&&e.subCommands.push(null),f.subCommands.length>0&&f.subCommands.push(null)}),g.length>0)for(g.push(null);g.length>0;)h.unshift(g.pop());return h.unshift(f),h.unshift(e),i.nlFloatToolbar(a.extend({style:this.options.toolbarContainer?"transparent":"flatToolbar",commandConfigs:d,commands:h,outlineWidth:{top:this.options.outlineWidth,right:this.options.outlineWidth,bottom:this.options.outlineWidth,left:this.options.outlineWidth}},this.options.toolbarOptions)),i}})})(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a,b,d){a.widget("NL.nlFloatToolbar",a.NL.nlWidget,{options:{iframe:null,container:null,outer:{top:!0,bottom:!1,left:!1,right:!1},position:"top-left",action:null,style:"flatToolbar",commandConfigs:{},commands:[],iconSize:18,separators:!1,outlineWidth:{top:0,right:0,bottom:0,left:0},margins:{top:0,right:0,bottom:0,left:0}},add:function(b){a(this.element).soCmdBar("setCommandAttribute",b,"hidden",!1,!0)},changeCommandStates:function(b){var c=this,e=!1;SO.Utils.each(b,function(b,f){c.cachedStates[b]===d&&(c.cachedStates[b]={});var g=c.cachedStates[b];SO.Utils.each(f,function(d,f){("isPushed"===d||"hidden"===d)&&(f=!!f);var h=g[d];h!==f&&(g[d]=f,a(c.element).soCmdBar("setCommandAttribute",b,d,f,!0),e=!0)})}),e&&a(c.element).soCmdBar("refresh")},_buildCommandMap:function(a,b){if(!SO.isEmpty(a))for(var c=0;a.length>c;c++){var d=a[c];null===d||SO.isString(d)||(this._buildCommandMap(d.subCommands,b),d=d.name),SO.isEmpty(d)||(b[d]=!1)}},setOnlyVisibleCommands:function(b,c){var e=this,f=!1,g={};this._buildCommandMap(this.options.commands,g);for(var h=0;b.length>h;h++){var i=b[h];g[i]=!0}SO.Utils.each(g,function(b,c){e.cachedStates[b]===d&&(e.cachedStates[b]={});var g=e.cachedStates[b],h=!c,i=g.hidden;i!==h&&(g.hidden=h,a(e.element).soCmdBar("setCommandAttribute",b,"hidden",h,!0),f=!0)}),!c&&f&&a(e.element).soCmdBar("refresh")},refresh:function(){a(this.element).soCmdBar("refresh")},reset:function(){a(this.element).soCmdBar("hideAllCommands")},commandBar:function(){return a(this.element)},hide:function(){this.element.hide(),this._hidden=!0},show:function(a,b){this._hidden=!1,this.element.show(),b||(this.element.css("position","fixed"),this.reposition(a))},reposition:function(a){this.positionElement=a?a:this.element;var b,c={top:0,left:0},d=this.options.position,e=SO.Utils.extend({},this.options.outer),f=this.positionElement.offset(),g=this.options.container.scrollTop(),h=this.options.container.scrollLeft(),b=this.options.container.offset();c.top=c.top-g-b.top+f.top,c.left=c.left-h-b.left+f.left,this.element.css({position:"absolute",top:c.top,left:c.left});var i={};if(this.options.iframe){i=this.options.iframe.offset(),c.top=c.top-(i.top-b.top),c.left=c.left-(i.left-b.left);var j=this.positionElement.get(0);if(j.ownerDocument&&j.ownerDocument.defaultView&&!SO.isNundef(j.ownerDocument.defaultView.pageYOffset))c.top-=j.ownerDocument.defaultView.pageYOffset,c.left-=j.ownerDocument.defaultView.pageXOffset;else if(j.ownerDocument&&j.ownerDocument.parentWindow&&!SO.isNundef(j.ownerDocument.parentWindow.pageYOffset))c.top-=j.ownerDocument.parentWindow.pageYOffset,c.left-=j.ownerDocument.parentWindow.pageXOffset;else{var k=this.positionElement.closest("body"),l=k.parent().get(0);c.top-=k.scrollTop()||l&&l.document&&l.document.documentElement.scrollTop||0,c.left-=k.scrollLeft()||l&&l.document&&l.document.documentElement.scrollLeft||0}c.top+=i.top,c.left+=i.left}this.element.css({position:"absolute",top:c.top,left:c.left});var m=this.element.outerHeight(),n=this.element.outerWidth(),o=this.positionElement.outerHeight(),p=this.positionElement.outerWidth(),q=this.options.container.height(),r=this.options.container.width(),s=this.options.container,t=0,u=this.options.container,v=0;if(this.options.iframe){var w=this.options.iframe.height(),x=this.options.iframe.width();q>w&&(s=this.options.iframe,t=i.top-b.top),r>x&&(u=this.options.iframe,v=i.left-b.left)}t>c.top+o+m||c.top>t+q||v>c.left+p+n||c.left>v+r?this.element.hide():(this.hidden||this.element.show(),d.indexOf("top")>-1&&e.top&&t+m>c.top?t+q>c.top+o+m&&(d=d.replace("top","bottom"),e.bottom=!0,e.top=!1):d.indexOf("bottom")>-1&&e.bottom&&c.top+o+m>t+q?c.top>t+m&&(d=d.replace("bottom","top"),e.bottom=!1,e.top=!0):d.indexOf("right")>-1&&e.right&&c.left+p+n>v+r?c.left>v+n&&(d=d.replace("right","left"),e.right=!1,e.left=!0):d.indexOf("left")>-1&&e.left&&v+n>c.left&&v+r>c.left+p+n&&(d=d.replace("left","right"),e.right=!0,e.left=!1)),d.indexOf("top")>-1&&(e.top?(c.top-=m,c.top-=this.options.outlineWidth.top):c.top+=this.options.margins.top),d.indexOf("right")>-1&&(c.left+=p,c.left+=this.options.outlineWidth.right,e.right||(c.left-=n,c.left-=this.options.margins.right)),d.indexOf("left")>-1&&(e.left?c.left-=n:c.left+=this.options.margins.left,c.left-=this.options.outlineWidth.left),d.indexOf("bottom")>-1&&(c.top+=o,c.top+=this.options.outlineWidth.bottom,c.top-=e.bottom?this.options.margins.bottom:m),0>c.top&&(c.top=0),0>c.left&&(c.left=0),this.element.css({position:"absolute",top:c.top,left:c.left})},setCommands:function(a){var b=this;b.element.soCmdBar("reset",!0),SO.Utils.each(a,function(){b.element.soCmdBar("addCommand",c,!0)}),b.element.soCmdBar("refresh")},destroy:function(){this.element.removeClass("nlui-floattoolbar")},_create:function(){SO.assert(this.options.container,"The container handling the relativity of positioning is mandatory");var a=this;a.element.hide(),a.buttonOptions={},this._hidden=!1,a.cachedStates={},a.element.soCmdBar({mode:a.options.style,iconSize:a.options.iconSize,separators:a.options.separators,rightSeparator:!1,leftSeparator:!1,commandConfigs:a.options.commandConfigs,commands:a.options.commands}),a.element.addClass("nlui-floattoolbar"),a.actionMap={}}})})(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){var b="soGridEditor_toolbar",c="#"+b;a.widget("NL.soGridEditor",a.NL.nlWidget,{options:{mode:"table",editor:null,rowCount:2,colCount:2,toolbarOptions:null},_selectCell:function(a){var b=this;b.$toolbar.nlFloatToolbar("show",b.element),b.element.find(".ui-state-active").removeClass("ui-state-active"),a.addClass("ui-state-active"),b.$selectedCell=a},_bindOneCell:function(b){var c=this;b.nlFileDroppable({onDrop:function(a,d){if(b.find("*").length>0)c._showOverrideDialog(function(){b.empty();var a=new Uploader(d,b.get(0),"monoImage");a.Start()});else{var e=new Uploader(d,b.get(0),"monoImage");e.Start()}}}),b.bind("click",function(){a(this).parents(".nl-dce-grid").addClass("ui-state-active"),c._selectCell(b)})},_bindCells:function(){var b=this;b.element.find(".nl-dce-cell").each(function(){b._bindOneCell(a(this))})},_showOverrideDialog:function(b){var c={};c[xtk_core.dialog_ok()]=function(){b(),a(this).soDialog("close")},c[xtk_core.dialog_cancel()]=function(){a(this).soDialog("close")},a("<div title='"+xtk_core.gridEditor_confirmationTitle()+"'>"+xtk_core.gridEditor_confirmationContent()+"</div>").soDialog({modal:!0,buttons:c})},_create:function(){var a=this;if(a.$toolbar=a.element.parents(c),0==a.$toolbar.length&&a._createToolbar(),a.element.hasClass("nl-dce-grid")){var b=a.element.data("rowCount"),d=a.element.data("colCount");isNaN(b)||(a.options.rowCount=NL.XTK.parseInt(b,0)),isNaN(d)||(a.options.colCount=NL.XTK.parseInt(d,0)),a._bindCells()}else a._createGrid.call(a)},_createToolbar:function(){var c=this;c.$toolbar=a("<div></div>").attr("id",b),c.element.parents("body").append(c.$toolbar),c.$toolbar.nlFloatToolbar(c.options.toolbarOptions),c.$toolbar.nlFloatToolbar("add",{icon:"nlui-icon-grid-above",title:xtk_core.gridEditor_addAbove(),id:"addAbove",action:function(){c._editorAddCells("above")}}),c.$toolbar.nlFloatToolbar("add",{icon:"nlui-icon-grid-below",title:xtk_core.gridEditor_addBelow(),id:"addBelow",action:function(){c._editorAddCells("below")}}),c.$toolbar.nlFloatToolbar("add",{icon:"nlui-icon-grid-left",title:xtk_core.gridEditor_addLeft(),id:"addLeft",action:function(){c._editorAddCells("left")}}),c.$toolbar.nlFloatToolbar("add",{icon:"nlui-icon-grid-right",title:xtk_core.gridEditor_addRight(),id:"addRight",action:function(){c._editorAddCells("right")}}),c.$toolbar.nlFloatToolbar("addSeparator"),c.$toolbar.nlFloatToolbar("add",{icon:"nlui-icon-grid-merge",title:xtk_core.gridEditor_merge(),id:"merge",action:function(){c.$selectedCell.addClass("mceSelected"),c.$selectedCell.next().addClass("mceSelected"),c.options.editor.execCommand("mceTableMergeCells"),c.$selectedCell.removeClass("mceSelected")}}),c.$toolbar.nlFloatToolbar("add",{icon:"nlui-icon-grid-split",title:xtk_core.gridEditor_split(),id:"split",action:function(){c._executeMceCommand("mceTableSplitCells")}}),c.$toolbar.nlFloatToolbar("addSeparator"),c.$toolbar.nlFloatToolbar("add",{icon:"nlui-icon-grid-deleteRow",title:xtk_core.gridEditor_deleteRow(),id:"deleteRow",action:function(){c._executeMceCommand("mceTableDeleteRow")}}),c.$toolbar.nlFloatToolbar("add",{icon:"nlui-icon-grid-deleteCol",title:xtk_core.gridEditor_deleteCol(),id:"deleteCol",action:function(){c._executeMceCommand("mceTableDeleteCol")}}),c.$toolbar.nlFloatToolbar("addSeparator"),c.$toolbar.nlFloatToolbar("add",{icon:"ui-icon-check",title:xtk_core.gridEditor_check(),id:"close",action:function(){c.stop()}})},_executeMceCommand:function(a){var b=this;b.options.editor.selection.select(b.$selectedCell.get(0)),b.options.editor.execCommand(a),b.options.editor.selection.collapse()},_editorAddCells:function(a){var b=this;b.$selectedCell.removeClass("ui-state-active");var c=null;"above"===a?(c="mceTableInsertRowBefore",b.options.rowCount++):"below"===a?(c="mceTableInsertRowAfter",b.options.rowCount++):"left"===a?(c="mceTableInsertColBefore",b.options.colCount++):"right"===a?(c="mceTableInsertColAfter",b.options.colCount++):SO.log.warn(a+" not supported yet"),c&&b._executeMceCommand(c),b._bindCells(),b.$selectedCell.addClass("ui-state-active")},_addCells:function(b,c,d){var e=this;if("table"==e.options.mode){0==e.element.find("> table").length&&e.element.append("<table style='width: 100%; height: 100%;' class='nl-dce-grid-table'/>");var f=e.element.find("> table");if(b>0){for(var g=0;b>g;g++){var h;d&&0!=d.length?d&&(h=a("<tr/>"),d.before(h)):h=f.append("<tr/>");for(var i=0;e.options.colCount>i;i++){var j=a("<td class='nl-dce-cell'/>");h.append(j),e._bindOneCell(j)}}e.options.rowCount+=b}if(c>0){var k=-1;d&&d.length>0&&(k=d.parent().children().index(d.get(0))),f.find("tr").each(function(){var b;k>-1&&(b=a(a(this).find("td")[k]));for(var d=0;c>d;d++){var f=a("<td class='nl-dce-cell'/>");b?b.before(f):a(this).append(f),e._bindOneCell(f)}}),e.options.colCount+=c}}},_makeGrid1x1:function(){var a=this;a.options.rowCount=0,a.options.colCount=0,a._addCells(1,1),a.element.find("> table.nl-dce-grid-table td").append(a.element.find("> *").not("table.nl-dce-grid-table, .nl_toolbar")),a._selectCell(a.element.find(".nl-dce-cell"))},_createGrid:function(){var b=this,c={};c[xtk_core.dialog_ok()]=function(){switch(b.element.addClass("nl-dce-grid").addClass("ui-state-active"),a(this).find("input:checked").attr("id")){case"one":b._makeGrid1x1();break;case"adapt":b.element.find("> *").addClass("nl-dce-cell");break;case"drop":var c=b.element.css("width"),d=b.element.css("height");b.element.empty(),b.element.css({width:c,height:d}),b.options.rowCount=0,b.options.colCount=0,b._addCells(2,2)}b._bindCells(),a(this).soDialog("close")},c[xtk_core.dialog_cancel()]=function(){a(this).soDialog("close")},b.element.find("> *").not(".nl_toolbar").length>0?1==b.element.find("> *").not(".nl_toolbar").length?(b._makeGrid1x1(),b._bindCells()):a("<div class='nlui_gridEditor_create_dlg' title='"+xtk_core.gridEditor_createGridActionDlg_title()+"'>"+"<label class='radio'><input type='radio' checked='true' name='action' id='one'>"+xtk_core.gridEditor_createGridActionDlg_one()+"</input></label>"+"<label class='radio'><input type='radio' name='action' id='adapt'>"+xtk_core.gridEditor_createGridActionDlg_adapt()+"</input></label>"+"<label class='radio'><input type='radio' name='action' id='drop'>"+xtk_core.gridEditor_createGridActionDlg_drop()+"</input></label>"+"</div>").soDialog({modal:!0,buttons:c,width:"480px"}):b.element.addClass("nl-dce-grid").addClass("ui-state-active")},stop:function(){this.element.find(".ui-state-active").removeClass("ui-state-active"),this.element.removeClass("ui-state-active"),this.$toolbar.hide()},clean:function(){this.stop(),this.$toolbar&&this.element.parents("body").find(c).remove()},destroy:function(){this.stop()}})})(jQuery,window);
;// LICENSE mediatypechecker.js 1.9.1 - see licenses.txt §2.9
function IsMediaType(a){function b(a){var b=null;return b=document.createElementNS?document.createElementNS("http://www.w3.org/1999/xhtml",a):document.createElement(a)}function c(a,c,d,e){var f=b("style");if(f){f.id=a,f.type="text/css",f.rel="stylesheet",e&&(f.media=e),document.getElementsByTagName("head")[0].appendChild(f);var g=null;try{g=document.createTextNode(c+" { "+d+" }"),f.appendChild(g),window.opera&&!window.opera.version&&(f.removeChild(g),f.appendChild(g))}catch(h){if(g&&delete g,document.styleSheets){var i=document.styleSheets[document.styleSheets.length-1];i&&(i.insertRule?i.insertRule(c+" { "+d+" }",i.cssRules.length):i.addRule&&i.addRule(c,d))}}}}function d(a){var b=document.getElementById(a);document.getElementsByTagName("head")[0].removeChild(b),delete b}function e(){try{var a,b=document.getElementsByTagName("link");for(a=0;b.length>a;a++)b[a].orig_disabled=b[a].disabled,b[a].disabled=!0;for(a=0;b.length>a;a++)b[a].disabled=b[a].orig_disabled}catch(c){}}try{if(document.createStyleSheet&&document.styleSheets.length>=30)return-1;c("mediaInspector_rule1","#mediaInspector","visibility: hidden; color: #000000;"),c("mediaInspector_rule2","#mediaInspector","visibility: hidden; color: #FFFFFF;",a);var f=null,g=null,h=!1;if(window.opera&&(h=!0,window.opera.version&&parseFloat(window.opera.version())>=9.5&&(h=!1)),h?(g=document.getElementsByTagName("head")[0],g&&(f=b("link"))):(g=document.getElementsByTagName("body")[0],g&&(f=b("div"))),f&&(f.id="mediaInspector",g.appendChild(f)),f){e();var i=null;try{var j=f;i=j.style.color,i||(j.currentStyle?i=j.currentStyle.color:window.getComputedStyle&&(i=window.getComputedStyle(j,null).getPropertyValue("color")))}catch(k){}g.removeChild(f),delete f}return d("mediaInspector_rule1"),d("mediaInspector_rule2"),i?(i=i.replace(/[\s\t ]/gi,"").toUpperCase(),"#FFFFFF"==i||"RGB(255,255,255)"==i?1:"#000000"==i||"RGB(0,0,0)"==i?0:-1):-1}catch(k){return-1}}
;// LICENSE CodeMirror 4.7.0 - see licenses.txt §2.10
(function(a){if("object"==typeof exports&&"object"==typeof module)module.exports=a();else{if("function"==typeof define&&define.amd)return define([],a);this.CodeMirror=a()}})(function(){"use strict";function a(c,d){if(!(this instanceof a))return new a(c,d);this.options=d=d?rf(d):{},rf(Gg,d,!1),n(d);var e=d.value;"string"==typeof e&&(e=new ch(e,d.mode)),this.doc=e;var f=this.display=new b(c,e);f.wrapper.CodeMirror=this,j(this),h(this),d.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),d.autofocus&&!jg&&yc(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new kf,keySeq:null},$f&&11>_f&&setTimeout(sf(xc,this,!0),20),Bc(this),Ef(),$b(this),this.curOp.forceUpdate=!0,Ee(this,e),d.autofocus&&!jg||Af()==f.input?setTimeout(sf(Zc,this),20):$c(this);for(var g in Hg)Hg.hasOwnProperty(g)&&Hg[g](this,d[g],Ig);t(this);for(var i=0;Mg.length>i;++i)Mg[i](this);ac(this)}function b(a,b){var c=this,d=c.input=wf("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");ag?d.style.width="1000px":d.setAttribute("wrap","off"),ig&&(d.style.border="1px solid black"),d.setAttribute("autocorrect","off"),d.setAttribute("autocapitalize","off"),d.setAttribute("spellcheck","false"),c.inputDiv=wf("div",[d],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),c.scrollbarH=wf("div",[wf("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar"),c.scrollbarV=wf("div",[wf("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),c.scrollbarFiller=wf("div",null,"CodeMirror-scrollbar-filler"),c.gutterFiller=wf("div",null,"CodeMirror-gutter-filler"),c.lineDiv=wf("div",null,"CodeMirror-code"),c.selectionDiv=wf("div",null,null,"position: relative; z-index: 1"),c.cursorDiv=wf("div",null,"CodeMirror-cursors"),c.measure=wf("div",null,"CodeMirror-measure"),c.lineMeasure=wf("div",null,"CodeMirror-measure"),c.lineSpace=wf("div",[c.measure,c.lineMeasure,c.selectionDiv,c.cursorDiv,c.lineDiv],null,"position: relative; outline: none"),c.mover=wf("div",[wf("div",[c.lineSpace],"CodeMirror-lines")],null,"position: relative"),c.sizer=wf("div",[c.mover],"CodeMirror-sizer"),c.heightForcer=wf("div",null,null,"position: absolute; height: "+mh+"px; width: 1px;"),c.gutters=wf("div",null,"CodeMirror-gutters"),c.lineGutter=null,c.scroller=wf("div",[c.sizer,c.heightForcer,c.gutters],"CodeMirror-scroll"),c.scroller.setAttribute("tabIndex","-1"),c.wrapper=wf("div",[c.inputDiv,c.scrollbarH,c.scrollbarV,c.scrollbarFiller,c.gutterFiller,c.scroller],"CodeMirror"),$f&&8>_f&&(c.gutters.style.zIndex=-1,c.scroller.style.paddingRight=0),ig&&(d.style.width="0px"),ag||(c.scroller.draggable=!0),fg&&(c.inputDiv.style.height="1px",c.inputDiv.style.position="absolute"),$f&&8>_f&&(c.scrollbarH.style.minHeight=c.scrollbarV.style.minWidth="18px"),a&&(a.appendChild?a.appendChild(c.wrapper):a(c.wrapper)),c.viewFrom=c.viewTo=b.first,c.view=[],c.externalMeasured=null,c.viewOffset=0,c.lastWrapHeight=c.lastWrapWidth=0,c.updateLineNumbers=null,c.lineNumWidth=c.lineNumInnerWidth=c.lineNumChars=null,c.prevInput="",c.alignWidgets=!1,c.pollingFast=!1,c.poll=new kf,c.cachedCharWidth=c.cachedTextHeight=c.cachedPaddingH=null,c.inaccurateSelection=!1,c.maxLine=null,c.maxLineLength=0,c.maxLineChanged=!1,c.wheelDX=c.wheelDY=c.wheelStartX=c.wheelStartY=null,c.shift=!1,c.selForContextMenu=null}function c(b){b.doc.mode=a.getMode(b.options,b.doc.modeOption),d(b)}function d(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null)}),a.doc.frontier=a.doc.first,vb(a,100),a.state.modeGen++,a.curOp&&nc(a)}function e(a){a.options.lineWrapping?(Ch(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth=""):(Bh(a.display.wrapper,"CodeMirror-wrap"),m(a)),g(a),nc(a),Nb(a),setTimeout(function(){q(a)},100)}function f(a){var b=Yb(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/Zb(a.display)-3);return function(e){if(ce(a.doc,e))return 0;var f=0;if(e.widgets)for(var g=0;e.widgets.length>g;g++)e.widgets[g].height&&(f+=e.widgets[g].height);return c?f+(Math.ceil(e.text.length/d)||1)*b:f+b}}function g(a){var b=a.doc,c=f(a);b.iter(function(a){var b=c(a);b!=a.height&&Ie(a,b)})}function h(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Nb(a)}function i(a){j(a),nc(a),setTimeout(function(){s(a)},20)}function j(a){var b=a.display.gutters,c=a.options.gutters;xf(b);for(var d=0;c.length>d;++d){var e=c[d],f=b.appendChild(wf("div",null,"CodeMirror-gutter "+e));"CodeMirror-linenumbers"==e&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none",k(a)}function k(a){var b=a.display.gutters.offsetWidth;a.display.sizer.style.marginLeft=b+"px",a.display.scrollbarH.style.left=a.options.fixedGutter?b+"px":0}function l(a){if(0==a.height)return 0;for(var b,c=a.text.length,d=a;b=Xd(d);){var e=b.find(0,!0);d=e.from.line,c+=e.from.ch-e.to.ch}for(d=a;b=Yd(d);){var e=b.find(0,!0);c-=d.text.length-e.from.ch,d=e.to.line,c+=d.text.length-e.to.ch}return c}function m(a){var b=a.display,c=a.doc;b.maxLine=Fe(c,c.first),b.maxLineLength=l(b.maxLine),b.maxLineChanged=!0,c.iter(function(a){var c=l(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function n(a){var b=of(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):b>-1&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function o(a){return mh-3>a.display.scroller.clientHeight-a.display.wrapper.clientHeight}function p(a){var b=a.display.scroller;return{clientHeight:b.clientHeight,barHeight:a.display.scrollbarV.clientHeight,scrollWidth:b.scrollWidth,clientWidth:b.clientWidth,hScrollbarTakesSpace:o(a),barWidth:a.display.scrollbarH.clientWidth,docHeight:Math.round(a.doc.height+Ab(a.display))}}function q(a,b){b||(b=p(a));var c=a.display,d=Gf(c.measure),e=b.docHeight+mh,f=b.scrollWidth>b.clientWidth;f&&b.scrollWidth<=b.clientWidth+1&&d>0&&!b.hScrollbarTakesSpace&&(f=!1);var g=e>b.clientHeight;if(g?(c.scrollbarV.style.display="block",c.scrollbarV.style.bottom=f?d+"px":"0",c.scrollbarV.firstChild.style.height=Math.max(0,e-b.clientHeight+(b.barHeight||c.scrollbarV.clientHeight))+"px"):(c.scrollbarV.style.display="",c.scrollbarV.firstChild.style.height="0"),f?(c.scrollbarH.style.display="block",c.scrollbarH.style.right=g?d+"px":"0",c.scrollbarH.firstChild.style.width=b.scrollWidth-b.clientWidth+(b.barWidth||c.scrollbarH.clientWidth)+"px"):(c.scrollbarH.style.display="",c.scrollbarH.firstChild.style.width="0"),f&&g?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=c.scrollbarFiller.style.width=d+"px"):c.scrollbarFiller.style.display="",f&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",c.gutterFiller.style.height=d+"px",c.gutterFiller.style.width=c.gutters.offsetWidth+"px"):c.gutterFiller.style.display="",!a.state.checkedOverlayScrollbar&&b.clientHeight>0){if(0===d){var h=kg&&!gg?"12px":"18px";c.scrollbarV.style.minWidth=c.scrollbarH.style.minHeight=h;var i=function(b){bf(b)!=c.scrollbarV&&bf(b)!=c.scrollbarH&&ic(a,Fc)(b)};ih(c.scrollbarV,"mousedown",i),ih(c.scrollbarH,"mousedown",i)}a.state.checkedOverlayScrollbar=!0}}function r(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop;d=Math.floor(d-zb(a));var e=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight,f=Ke(b,d),g=Ke(b,e);if(c&&c.ensure){var h=c.ensure.from.line,i=c.ensure.to.line;if(f>h)return{from:h,to:Ke(b,Le(Fe(b,h))+a.wrapper.clientHeight)};if(Math.min(i,b.lastLine())>=g)return{from:Ke(b,Le(Fe(b,i))-a.wrapper.clientHeight),to:i}}return{from:f,to:Math.max(g,f+1)}}function s(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=v(b)-b.scroller.scrollLeft+a.doc.scrollLeft,e=b.gutters.offsetWidth,f=d+"px",g=0;c.length>g;g++)if(!c[g].hidden){a.options.fixedGutter&&c[g].gutter&&(c[g].gutter.style.left=f);var h=c[g].alignable;if(h)for(var i=0;h.length>i;i++)h[i].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+e+"px")}}function t(a){if(!a.options.lineNumbers)return!1;var b=a.doc,c=u(a.options,b.first+b.size-1),d=a.display;if(c.length!=d.lineNumChars){var e=d.measure.appendChild(wf("div",[wf("div",c)],"CodeMirror-linenumber CodeMirror-gutter-elt")),f=e.firstChild.offsetWidth,g=e.offsetWidth-f;return d.lineGutter.style.width="",d.lineNumInnerWidth=Math.max(f,d.lineGutter.offsetWidth-g),d.lineNumWidth=d.lineNumInnerWidth+g,d.lineNumChars=d.lineNumInnerWidth?c.length:-1,d.lineGutter.style.width=d.lineNumWidth+"px",k(a),!0}return!1}function u(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function v(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function w(a,b,c){var d=a.display;this.viewport=b,this.visible=r(d,a.doc,b),this.editorIsHidden=!d.wrapper.offsetWidth,this.wrapperHeight=d.wrapper.clientHeight,this.wrapperWidth=d.wrapper.clientWidth,this.oldViewFrom=d.viewFrom,this.oldViewTo=d.viewTo,this.oldScrollerWidth=d.scroller.clientWidth,this.force=c,this.dims=E(a)}function x(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return pc(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&0==tc(a))return!1;t(a)&&(pc(a),b.dims=E(a));var e=d.first+d.size,f=Math.max(b.visible.from-a.options.viewportMargin,d.first),g=Math.min(e,b.visible.to+a.options.viewportMargin);f>c.viewFrom&&20>f-c.viewFrom&&(f=Math.max(d.first,c.viewFrom)),c.viewTo>g&&20>c.viewTo-g&&(g=Math.min(e,c.viewTo)),qg&&(f=ae(a.doc,f),g=be(a.doc,g));var h=f!=c.viewFrom||g!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||c.lastWrapWidth!=b.wrapperWidth;sc(a,f,g),c.viewOffset=Le(Fe(a.doc,c.viewFrom)),a.display.mover.style.top=c.viewOffset+"px";var i=tc(a);if(!h&&0==i&&!b.force&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo))return!1;var j=Af();return i>4&&(c.lineDiv.style.display="none"),F(a,c.updateLineNumbers,b.dims),i>4&&(c.lineDiv.style.display=""),j&&Af()!=j&&j.offsetHeight&&j.focus(),xf(c.cursorDiv),xf(c.selectionDiv),h&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,vb(a,400)),c.updateLineNumbers=null,!0}function y(a,b){for(var c=b.force,d=b.viewport,e=!0;;e=!1){if(e&&a.options.lineWrapping&&b.oldScrollerWidth!=a.display.scroller.clientWidth)c=!0;else if(c=!1,d&&null!=d.top&&(d={top:Math.min(a.doc.height+Ab(a.display)-mh-a.display.scroller.clientHeight,d.top)}),b.visible=r(a.display,a.doc,d),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!x(a,b))break;C(a);var f=p(a);rb(a),A(a,f),q(a,f)}df(a,"update",a),(a.display.viewFrom!=b.oldViewFrom||a.display.viewTo!=b.oldViewTo)&&df(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo)}function z(a,b){var c=new w(a,b);if(x(a,c)){C(a),y(a,c);var d=p(a);rb(a),A(a,d),q(a,d)}}function A(a,b){a.display.sizer.style.minHeight=a.display.heightForcer.style.top=b.docHeight+"px",a.display.gutters.style.height=Math.max(b.docHeight,b.clientHeight-mh)+"px"}function B(a,b){a.display.sizer.offsetWidth+a.display.gutters.offsetWidth<a.display.scroller.clientWidth-1&&(a.display.sizer.style.minHeight=a.display.heightForcer.style.top="0px",a.display.gutters.style.height=b.docHeight+"px")}function C(a){for(var b=a.display,c=b.lineDiv.offsetTop,d=0;b.view.length>d;d++){var e,f=b.view[d];if(!f.hidden){if($f&&8>_f){var g=f.node.offsetTop+f.node.offsetHeight;e=g-c,c=g}else{var h=f.node.getBoundingClientRect();e=h.bottom-h.top}var i=f.line.height-e;if(2>e&&(e=Yb(b)),(i>.001||-.001>i)&&(Ie(f.line,e),D(f.line),f.rest))for(var j=0;f.rest.length>j;j++)D(f.rest[j])}}}function D(a){if(a.widgets)for(var b=0;a.widgets.length>b;++b)a.widgets[b].height=a.widgets[b].node.offsetHeight}function E(a){for(var b=a.display,c={},d={},e=b.gutters.clientLeft,f=b.gutters.firstChild,g=0;f;f=f.nextSibling,++g)c[a.options.gutters[g]]=f.offsetLeft+f.clientLeft+e,d[a.options.gutters[g]]=f.clientWidth;return{fixedPos:v(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function F(a,b,c){function d(b){var c=b.nextSibling;return ag&&kg&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b),c}for(var e=a.display,f=a.options.lineNumbers,g=e.lineDiv,h=g.firstChild,i=e.view,j=e.viewFrom,k=0;i.length>k;k++){var l=i[k];if(l.hidden);else if(l.node){for(;h!=l.node;)h=d(h);var m=f&&null!=b&&j>=b&&l.lineNumber;l.changes&&(of(l.changes,"gutter")>-1&&(m=!1),G(a,l,j,c)),m&&(xf(l.lineNumber),l.lineNumber.appendChild(document.createTextNode(u(a.options,j)))),h=l.node.nextSibling}else{var n=O(a,l,j,c);g.insertBefore(n,h)}j+=l.size}for(;h;)h=d(h)}function G(a,b,c,d){for(var e=0;b.changes.length>e;e++){var f=b.changes[e];"text"==f?K(a,b):"gutter"==f?M(a,b,c,d):"class"==f?L(b):"widget"==f&&N(b,d)}b.changes=null}function H(a){return a.node==a.text&&(a.node=wf("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),$f&&8>_f&&(a.node.style.zIndex=2)),a.node}function I(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;if(b&&(b+=" CodeMirror-linebackground"),a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=H(a);a.background=c.insertBefore(wf("div",null,b),c.firstChild)}}function J(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):se(a,b)}function K(a,b){var c=b.text.className,d=J(a,b);b.text==b.node&&(b.node=d.pre),b.text.parentNode.replaceChild(d.pre,b.text),b.text=d.pre,d.bgClass!=b.bgClass||d.textClass!=b.textClass?(b.bgClass=d.bgClass,b.textClass=d.textClass,L(b)):c&&(b.text.className=c)}function L(a){I(a),a.line.wrapClass?H(a).className=a.line.wrapClass:a.node!=a.text&&(a.node.className="");var b=a.textClass?a.textClass+" "+(a.line.textClass||""):a.line.textClass;a.text.className=b||""}function M(a,b,c,d){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);var e=b.line.gutterMarkers;if(a.options.lineNumbers||e){var f=H(b),g=b.gutter=f.insertBefore(wf("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px; width: "+d.gutterTotalWidth+"px"),b.text);if(b.line.gutterClass&&(g.className+=" "+b.line.gutterClass),!a.options.lineNumbers||e&&e["CodeMirror-linenumbers"]||(b.lineNumber=g.appendChild(wf("div",u(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px"))),e)for(var h=0;a.options.gutters.length>h;++h){var i=a.options.gutters[h],j=e.hasOwnProperty(i)&&e[i];j&&g.appendChild(wf("div",[j],"CodeMirror-gutter-elt","left: "+d.gutterLeft[i]+"px; width: "+d.gutterWidth[i]+"px"))}}}function N(a,b){a.alignable&&(a.alignable=null);for(var c,d=a.node.firstChild;d;d=c){var c=d.nextSibling;"CodeMirror-linewidget"==d.className&&a.node.removeChild(d)}P(a,b)}function O(a,b,c,d){var e=J(a,b);return b.text=b.node=e.pre,e.bgClass&&(b.bgClass=e.bgClass),e.textClass&&(b.textClass=e.textClass),L(b),M(a,b,c,d),P(b,d),b.node}function P(a,b){if(Q(a.line,a,b,!0),a.rest)for(var c=0;a.rest.length>c;c++)Q(a.rest[c],a,b,!1)}function Q(a,b,c,d){if(a.widgets)for(var e=H(b),f=0,g=a.widgets;g.length>f;++f){var h=g[f],i=wf("div",[h.node],"CodeMirror-linewidget");h.handleMouseEvents||(i.ignoreEvents=!0),R(h,i,b,c),d&&h.above?e.insertBefore(i,b.gutter||b.text):e.appendChild(i),df(h,"redraw")}}function R(a,b,c,d){if(a.noHScroll){(c.alignable||(c.alignable=[])).push(b);var e=d.wrapperWidth;b.style.left=d.fixedPos+"px",a.coverGutter||(e-=d.gutterTotalWidth,b.style.paddingLeft=d.gutterTotalWidth+"px"),b.style.width=e+"px"}a.coverGutter&&(b.style.zIndex=5,b.style.position="relative",a.noHScroll||(b.style.marginLeft=-d.gutterTotalWidth+"px"))}function S(a){return rg(a.line,a.ch)}function T(a,b){return 0>sg(a,b)?b:a}function U(a,b){return 0>sg(a,b)?a:b}function V(a,b){this.ranges=a,this.primIndex=b}function W(a,b){this.anchor=a,this.head=b}function X(a,b){var c=a[b];a.sort(function(a,b){return sg(a.from(),b.from())}),b=of(a,c);for(var d=1;a.length>d;d++){var e=a[d],f=a[d-1];if(sg(f.to(),e.from())>=0){var g=U(f.from(),e.from()),h=T(f.to(),e.to()),i=f.empty()?e.from()==e.head:f.from()==f.head;b>=d&&--b,a.splice(--d,2,new W(i?h:g,i?g:h))}}return new V(a,b)}function Y(a,b){return new V([new W(a,b||a)],0)}function Z(a,b){return Math.max(a.first,Math.min(b,a.first+a.size-1))}function $(a,b){if(b.line<a.first)return rg(a.first,0);var c=a.first+a.size-1;return b.line>c?rg(c,Fe(a,c).text.length):_(b,Fe(a,b.line).text.length)}function _(a,b){var c=a.ch;return null==c||c>b?rg(a.line,b):0>c?rg(a.line,0):a}function ab(a,b){return b>=a.first&&a.first+a.size>b}function bb(a,b){for(var c=[],d=0;b.length>d;d++)c[d]=$(a,b[d]);return c}function cb(a,b,c,d){if(a.cm&&a.cm.display.shift||a.extend){var e=b.anchor;if(d){var f=0>sg(c,e);f!=0>sg(d,e)?(e=c,c=d):f!=0>sg(c,d)&&(c=d)}return new W(e,c)}return new W(d||c,c)}function db(a,b,c,d){jb(a,new V([cb(a,a.sel.primary(),b,c)],0),d)}function eb(a,b,c){for(var d=[],e=0;a.sel.ranges.length>e;e++)d[e]=cb(a,a.sel.ranges[e],b[e],null);var f=X(d,a.sel.primIndex);jb(a,f,c)}function fb(a,b,c,d){var e=a.sel.ranges.slice(0);e[b]=c,jb(a,X(e,a.sel.primIndex),d)}function gb(a,b,c,d){jb(a,Y(b,c),d)}function hb(a,b){var c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;b.length>c;c++)this.ranges[c]=new W($(a,b[c].anchor),$(a,b[c].head))}};return kh(a,"beforeSelectionChange",a,c),a.cm&&kh(a.cm,"beforeSelectionChange",a.cm,c),c.ranges!=b.ranges?X(c.ranges,c.ranges.length-1):b}function ib(a,b,c){var d=a.history.done,e=nf(d);e&&e.ranges?(d[d.length-1]=b,kb(a,b,c)):jb(a,b,c)}function jb(a,b,c){kb(a,b,c),Te(a,a.sel,a.cm?a.cm.curOp.id:0/0,c)}function kb(a,b,c){(hf(a,"beforeSelectionChange")||a.cm&&hf(a.cm,"beforeSelectionChange"))&&(b=hb(a,b));var d=c&&c.bias||(0>sg(b.primary().head,a.sel.primary().head)?-1:1);lb(a,nb(a,b,d,!0)),c&&c.scroll===!1||!a.cm||sd(a.cm)}function lb(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,gf(a.cm)),df(a,"cursorActivity",a))}function mb(a){lb(a,nb(a,a.sel,null,!1),oh)}function nb(a,b,c,d){for(var e,f=0;b.ranges.length>f;f++){var g=b.ranges[f],h=ob(a,g.anchor,c,d),i=ob(a,g.head,c,d);(e||h!=g.anchor||i!=g.head)&&(e||(e=b.ranges.slice(0,f)),e[f]=new W(h,i))}return e?X(e,b.primIndex):b}function ob(a,b,c,d){var e=!1,f=b,g=c||1;a.cantEdit=!1;a:for(;;){var h=Fe(a,f.line);if(h.markedSpans)for(var i=0;h.markedSpans.length>i;++i){var j=h.markedSpans[i],k=j.marker;if((null==j.from||(k.inclusiveLeft?j.from<=f.ch:j.from<f.ch))&&(null==j.to||(k.inclusiveRight?j.to>=f.ch:j.to>f.ch))){if(d&&(kh(k,"beforeCursorEnter"),k.explicitlyCleared)){if(h.markedSpans){--i;continue}break}if(!k.atomic)continue;var l=k.find(0>g?-1:1);if(0==sg(l,f)&&(l.ch+=g,0>l.ch?l=l.line>a.first?$(a,rg(l.line-1)):null:l.ch>h.text.length&&(l=l.line<a.first+a.size-1?rg(l.line+1,0):null),!l)){if(e)return d?(a.cantEdit=!0,rg(a.first,0)):ob(a,b,c,!0);e=!0,l=b,g=-g}f=l;continue a}}return f}}function pb(a){for(var b=a.display,c=a.doc,d={},e=d.cursors=document.createDocumentFragment(),f=d.selection=document.createDocumentFragment(),g=0;c.sel.ranges.length>g;g++){var h=c.sel.ranges[g],i=h.empty();(i||a.options.showCursorWhenSelecting)&&sb(a,h,e),i||tb(a,h,f)}if(a.options.moveInputWithCursor){var j=Tb(a,c.sel.primary().head,"div"),k=b.wrapper.getBoundingClientRect(),l=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,j.top+l.top-k.top)),d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,j.left+l.left-k.left))}return d}function qb(a,b){yf(a.display.cursorDiv,b.cursors),yf(a.display.selectionDiv,b.selection),null!=b.teTop&&(a.display.inputDiv.style.top=b.teTop+"px",a.display.inputDiv.style.left=b.teLeft+"px")}function rb(a){qb(a,pb(a))}function sb(a,b,c){var d=Tb(a,b.head,"div",null,null,!a.options.singleCursorHeightPerLine),e=c.appendChild(wf("div","\u00a0","CodeMirror-cursor"));if(e.style.left=d.left+"px",e.style.top=d.top+"px",e.style.height=Math.max(0,d.bottom-d.top)*a.options.cursorHeight+"px",d.other){var f=c.appendChild(wf("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor"));f.style.display="",f.style.left=d.other.left+"px",f.style.top=d.other.top+"px",f.style.height=.85*(d.other.bottom-d.other.top)+"px"}}function tb(a,b,c){function d(a,b,c,d){0>b&&(b=0),b=Math.round(b),d=Math.round(d),h.appendChild(wf("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?k-a:c)+"px; height: "+(d-b)+"px"))}function e(b,c,e){function f(c,d){return Sb(a,rg(b,c),"div",l,d)}var h,i,l=Fe(g,b),m=l.text.length;return Kf(Me(l),c||0,null==e?m:e,function(a,b,g){var l,n,o,p=f(a,"left");if(a==b)l=p,n=o=p.left;else{if(l=f(b-1,"right"),"rtl"==g){var q=p;p=l,l=q}n=p.left,o=l.right}null==c&&0==a&&(n=j),l.top-p.top>3&&(d(n,p.top,null,p.bottom),n=j,p.bottom<l.top&&d(n,p.bottom,null,l.top)),null==e&&b==m&&(o=k),(!h||p.top<h.top||p.top==h.top&&p.left<h.left)&&(h=p),(!i||l.bottom>i.bottom||l.bottom==i.bottom&&l.right>i.right)&&(i=l),j+1>n&&(n=j),d(n,l.top,o-n,l.bottom)}),{start:h,end:i}}var f=a.display,g=a.doc,h=document.createDocumentFragment(),i=Bb(a.display),j=i.left,k=f.lineSpace.offsetWidth-i.right,l=b.from(),m=b.to();if(l.line==m.line)e(l.line,l.ch,m.ch);else{var n=Fe(g,l.line),o=Fe(g,m.line),p=$d(n)==$d(o),q=e(l.line,l.ch,p?n.text.length+1:null).end,r=e(m.line,p?0:null,m.ch).start;p&&(q.top<r.top-2?(d(q.right,q.top,null,q.bottom),d(j,r.top,r.left,r.bottom)):d(q.right,q.top,r.left-q.right,q.bottom)),q.bottom<r.top&&d(j,q.bottom,null,r.top)}c.appendChild(h)}function ub(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="",a.options.cursorBlinkRate>0?b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}function vb(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,sf(wb,a))}function wb(a){var b=a.doc;if(b.frontier<b.first&&(b.frontier=b.first),!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=Og(b.mode,yb(a,b.frontier)),e=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(f){if(b.frontier>=a.display.viewFrom){var g=f.styles,h=oe(a,f,d,!0);f.styles=h.styles;var i=f.styleClasses,j=h.classes;j?f.styleClasses=j:i&&(f.styleClasses=null);for(var k=!g||g.length!=f.styles.length||i!=j&&(!i||!j||i.bgClass!=j.bgClass||i.textClass!=j.textClass),l=0;!k&&g.length>l;++l)k=g[l]!=f.styles[l];k&&e.push(b.frontier),f.stateAfter=Og(b.mode,d)}else qe(a,f.text,d),f.stateAfter=0==b.frontier%5?Og(b.mode,d):null;return++b.frontier,+new Date>c?(vb(a,a.options.workDelay),!0):void 0}),e.length&&hc(a,function(){for(var b=0;e.length>b;b++)oc(a,e[b],"text")})}}function xb(a,b,c){for(var d,e,f=a.doc,g=c?-1:b-(a.doc.mode.innerMode?1e3:100),h=b;h>g;--h){if(f.first>=h)return f.first;var i=Fe(f,h-1);if(i.stateAfter&&(!c||f.frontier>=h))return h;var j=rh(i.text,null,a.options.tabSize);(null==e||d>j)&&(e=h-1,d=j)}return e}function yb(a,b,c){var d=a.doc,e=a.display;if(!d.mode.startState)return!0;var f=xb(a,b,c),g=f>d.first&&Fe(d,f-1).stateAfter;return g=g?Og(d.mode,g):Pg(d.mode),d.iter(f,b,function(c){qe(a,c.text,g);var h=f==b-1||0==f%5||f>=e.viewFrom&&e.viewTo>f;c.stateAfter=h?Og(d.mode,g):null,++f}),c&&(d.frontier=f),g}function zb(a){return a.lineSpace.offsetTop}function Ab(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function Bb(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=yf(a.measure,wf("pre","x")),c=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle,d={left:parseInt(c.paddingLeft),right:parseInt(c.paddingRight)};return isNaN(d.left)||isNaN(d.right)||(a.cachedPaddingH=d),d}function Cb(a,b,c){var d=a.options.lineWrapping,e=d&&a.display.scroller.clientWidth;if(!b.measure.heights||d&&b.measure.width!=e){var f=b.measure.heights=[];if(d){b.measure.width=e;for(var g=b.text.firstChild.getClientRects(),h=0;g.length-1>h;h++){var i=g[h],j=g[h+1];Math.abs(i.bottom-j.bottom)>2&&f.push((i.bottom+j.top)/2-c.top)}}f.push(c.bottom-c.top)}}function Db(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;a.rest.length>d;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(var d=0;a.rest.length>d;d++)if(Je(a.rest[d])>c)return{map:a.measure.maps[d],cache:a.measure.caches[d],before:!0}}function Eb(a,b){b=$d(b);var c=Je(b),d=a.display.externalMeasured=new lc(a.doc,b,c);d.lineN=c;var e=d.built=se(a,d);return d.text=e.pre,yf(a.display.lineMeasure,e.pre),d}function Fb(a,b,c,d){return Ib(a,Hb(a,b),c,d)}function Gb(a,b){if(b>=a.display.viewFrom&&a.display.viewTo>b)return a.display.view[qc(a,b)];var c=a.display.externalMeasured;return c&&b>=c.lineN&&c.lineN+c.size>b?c:void 0}function Hb(a,b){var c=Je(b),d=Gb(a,c);d&&!d.text?d=null:d&&d.changes&&G(a,d,c,E(a)),d||(d=Eb(a,b));var e=Db(d,b,c);return{line:b,view:d,rect:null,map:e.map,cache:e.cache,before:e.before,hasHeights:!1}}function Ib(a,b,c,d,e){b.before&&(c=-1);var f,g=c+(d||"");return b.cache.hasOwnProperty(g)?f=b.cache[g]:(b.rect||(b.rect=b.view.text.getBoundingClientRect()),b.hasHeights||(Cb(a,b.view,b.rect),b.hasHeights=!0),f=Jb(a,b,c,d),f.bogus||(b.cache[g]=f)),{left:f.left,right:f.right,top:e?f.rtop:f.top,bottom:e?f.rbottom:f.bottom}}function Jb(a,b,c,d){for(var e,f,g,h,i=b.map,j=0;i.length>j;j+=3){var k=i[j],l=i[j+1];if(k>c?(f=0,g=1,h="left"):l>c?(f=c-k,g=f+1):(j==i.length-3||c==l&&i[j+3]>c)&&(g=l-k,f=g-1,c>=l&&(h="right")),null!=f){if(e=i[j+2],k==l&&d==(e.insertLeft?"left":"right")&&(h=d),"left"==d&&0==f)for(;j&&i[j-2]==i[j-3]&&i[j-1].insertLeft;)e=i[(j-=3)+2],h="left";if("right"==d&&f==l-k)for(;i.length-3>j&&i[j+3]==i[j+4]&&!i[j+5].insertLeft;)e=i[(j+=3)+2],h="right";break}}var m;if(3==e.nodeType){for(var j=0;4>j;j++){for(;f&&vf(b.line.text.charAt(k+f));)--f;for(;l>k+g&&vf(b.line.text.charAt(k+g));)++g;if($f&&9>_f&&0==f&&g==l-k)m=e.parentNode.getBoundingClientRect();else if($f&&a.options.lineWrapping){var n=uh(e,f,g).getClientRects();m=n.length?n["right"==d?n.length-1:0]:wg}else m=uh(e,f,g).getBoundingClientRect()||wg;if(m.left||m.right||0==f)break;g=f,f-=1,h="right"}$f&&11>_f&&(m=Kb(a.display.measure,m))}else{f>0&&(h=d="right");var n;m=a.options.lineWrapping&&(n=e.getClientRects()).length>1?n["right"==d?n.length-1:0]:e.getBoundingClientRect()}if($f&&9>_f&&!f&&(!m||!m.left&&!m.right)){var o=e.parentNode.getClientRects()[0];m=o?{left:o.left,right:o.left+Zb(a.display),top:o.top,bottom:o.bottom}:wg}for(var p=m.top-b.rect.top,q=m.bottom-b.rect.top,r=(p+q)/2,s=b.view.measure.heights,j=0;s.length-1>j&&!(s[j]>r);j++);var t=j?s[j-1]:0,u=s[j],v={left:("right"==h?m.right:m.left)-b.rect.left,right:("left"==h?m.left:m.right)-b.rect.left,top:t,bottom:u};return m.left||m.right||(v.bogus=!0),a.options.singleCursorHeightPerLine||(v.rtop=p,v.rbottom=q),v}function Kb(a,b){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Jf(a))return b;var c=screen.logicalXDPI/screen.deviceXDPI,d=screen.logicalYDPI/screen.deviceYDPI;return{left:b.left*c,right:b.right*c,top:b.top*d,bottom:b.bottom*d}}function Lb(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;a.rest.length>b;b++)a.measure.caches[b]={}}function Mb(a){a.display.externalMeasure=null,xf(a.display.lineMeasure);for(var b=0;a.display.view.length>b;b++)Lb(a.display.view[b])}function Nb(a){Mb(a),a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null,a.options.lineWrapping||(a.display.maxLineChanged=!0),a.display.lineNumChars=null}function Ob(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Pb(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function Qb(a,b,c,d){if(b.widgets)for(var e=0;b.widgets.length>e;++e)if(b.widgets[e].above){var f=fe(b.widgets[e]);c.top+=f,c.bottom+=f}if("line"==d)return c;d||(d="local");var g=Le(b);if("local"==d?g+=zb(a.display):g-=a.display.viewOffset,"page"==d||"window"==d){var h=a.display.lineSpace.getBoundingClientRect();g+=h.top+("window"==d?0:Pb());var i=h.left+("window"==d?0:Ob());c.left+=i,c.right+=i}return c.top+=g,c.bottom+=g,c}function Rb(a,b,c){if("div"==c)return b;var d=b.left,e=b.top;if("page"==c)d-=Ob(),e-=Pb();else if("local"==c||!c){var f=a.display.sizer.getBoundingClientRect();d+=f.left,e+=f.top}var g=a.display.lineSpace.getBoundingClientRect();return{left:d-g.left,top:e-g.top}}function Sb(a,b,c,d,e){return d||(d=Fe(a.doc,b.line)),Qb(a,d,Fb(a,d,b.ch,e),c)}function Tb(a,b,c,d,e,f){function g(b,g){var h=Ib(a,e,b,g?"right":"left",f);return g?h.left=h.right:h.right=h.left,Qb(a,d,h,c)}function h(a,b){var c=i[b],d=c.level%2;return a==Lf(c)&&b&&c.level<i[b-1].level?(c=i[--b],a=Mf(c)-(c.level%2?0:1),d=!0):a==Mf(c)&&i.length-1>b&&c.level<i[b+1].level&&(c=i[++b],a=Lf(c)-c.level%2,d=!1),d&&a==c.to&&a>c.from?g(a-1):g(a,d)}d=d||Fe(a.doc,b.line),e||(e=Hb(a,d));var i=Me(d),j=b.ch;if(!i)return g(j);var k=Tf(i,j),l=h(j,k);return null!=Kh&&(l.other=h(j,Kh)),l}function Ub(a,b){var c=0,b=$(a.doc,b);a.options.lineWrapping||(c=Zb(a.display)*b.ch);var d=Fe(a.doc,b.line),e=Le(d)+zb(a.display);return{left:c,right:c,top:e,bottom:e+d.height}}function Vb(a,b,c,d){var e=rg(a,b);return e.xRel=d,c&&(e.outside=!0),e}function Wb(a,b,c){var d=a.doc;if(c+=a.display.viewOffset,0>c)return Vb(d.first,0,!0,-1);var e=Ke(d,c),f=d.first+d.size-1;if(e>f)return Vb(d.first+d.size-1,Fe(d,f).text.length,!0,1);0>b&&(b=0);for(var g=Fe(d,e);;){var h=Xb(a,g,e,b,c),i=Yd(g),j=i&&i.find(0,!0);if(!i||!(h.ch>j.from.ch||h.ch==j.from.ch&&h.xRel>0))return h;e=Je(g=j.to.line)}}function Xb(a,b,c,d,e){function f(d){var e=Tb(a,rg(c,d),"line",b,j);return h=!0,g>e.bottom?e.left-i:e.top>g?e.left+i:(h=!1,e.left)}var g=e-Le(b),h=!1,i=2*a.display.wrapper.clientWidth,j=Hb(a,b),k=Me(b),l=b.text.length,m=Nf(b),n=Of(b),o=f(m),p=h,q=f(n),r=h;if(d>q)return Vb(c,n,r,1);for(;;){if(k?n==m||n==Vf(b,m,1):1>=n-m){for(var s=o>d||q-d>=d-o?m:n,t=d-(s==m?o:q);vf(b.text.charAt(s));)++s;var u=Vb(c,s,s==m?p:r,-1>t?-1:t>1?1:0);return u}var v=Math.ceil(l/2),w=m+v;if(k){w=m;for(var x=0;v>x;++x)w=Vf(b,w,1)}var y=f(w);y>d?(n=w,q=y,(r=h)&&(q+=1e3),l=v):(m=w,o=y,p=h,l-=v)}}function Yb(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==tg){tg=wf("pre");for(var b=0;49>b;++b)tg.appendChild(document.createTextNode("x")),tg.appendChild(wf("br"));tg.appendChild(document.createTextNode("x"))}yf(a.measure,tg);var c=tg.offsetHeight/50;return c>3&&(a.cachedTextHeight=c),xf(a.measure),c||1}function Zb(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=wf("span","xxxxxxxxxx"),c=wf("pre",[b]);yf(a.measure,c);var d=b.getBoundingClientRect(),e=(d.right-d.left)/10;return e>2&&(a.cachedCharWidth=e),e||10}function $b(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++yg},xg?xg.ops.push(a.curOp):a.curOp.ownsGroup=xg={ops:[a.curOp],delayedCallbacks:[]}}function _b(a){var b=a.delayedCallbacks,c=0;do{for(;b.length>c;c++)b[c]();for(var d=0;a.ops.length>d;d++){var e=a.ops[d];if(e.cursorActivityHandlers)for(;e.cursorActivityCalled<e.cursorActivityHandlers.length;)e.cursorActivityHandlers[e.cursorActivityCalled++](e.cm)}}while(b.length>c)}function ac(a){var b=a.curOp,c=b.ownsGroup;if(c)try{_b(c)}finally{xg=null;for(var d=0;c.ops.length>d;d++)c.ops[d].cm.curOp=null;bc(c)}}function bc(a){for(var b=a.ops,c=0;b.length>c;c++)cc(b[c]);for(var c=0;b.length>c;c++)dc(b[c]);for(var c=0;b.length>c;c++)ec(b[c]);for(var c=0;b.length>c;c++)fc(b[c]);
for(var c=0;b.length>c;c++)gc(b[c])}function cc(a){var b=a.cm,c=b.display;a.updateMaxLine&&m(b),a.mustUpdate=a.viewChanged||a.forceUpdate||null!=a.scrollTop||a.scrollToPos&&(a.scrollToPos.from.line<c.viewFrom||a.scrollToPos.to.line>=c.viewTo)||c.maxLineChanged&&b.options.lineWrapping,a.update=a.mustUpdate&&new w(b,a.mustUpdate&&{top:a.scrollTop,ensure:a.scrollToPos},a.forceUpdate)}function dc(a){a.updatedDisplay=a.mustUpdate&&x(a.cm,a.update)}function ec(a){var b=a.cm,c=b.display;a.updatedDisplay&&C(b),a.barMeasure=p(b),c.maxLineChanged&&!b.options.lineWrapping&&(a.adjustWidthTo=Fb(b,c.maxLine,c.maxLine.text.length).left+3,a.maxScrollLeft=Math.max(0,c.sizer.offsetLeft+a.adjustWidthTo+mh-c.scroller.clientWidth)),(a.updatedDisplay||a.selectionChanged)&&(a.newSelectionNodes=pb(b))}function fc(a){var b=a.cm;null!=a.adjustWidthTo&&(b.display.sizer.style.minWidth=a.adjustWidthTo+"px",a.maxScrollLeft<b.doc.scrollLeft&&Oc(b,Math.min(b.display.scroller.scrollLeft,a.maxScrollLeft),!0),b.display.maxLineChanged=!1),a.newSelectionNodes&&qb(b,a.newSelectionNodes),a.updatedDisplay&&A(b,a.barMeasure),(a.updatedDisplay||a.startHeight!=b.doc.height)&&q(b,a.barMeasure),a.selectionChanged&&ub(b),b.state.focused&&a.updateInput&&xc(b,a.typing)}function gc(a){var b=a.cm,c=b.display,d=b.doc;if(null!=a.adjustWidthTo&&Math.abs(a.barMeasure.scrollWidth-b.display.scroller.scrollWidth)>1&&q(b),a.updatedDisplay&&y(b,a.update),null==c.wheelStartX||null==a.scrollTop&&null==a.scrollLeft&&!a.scrollToPos||(c.wheelStartX=c.wheelStartY=null),null!=a.scrollTop&&(c.scroller.scrollTop!=a.scrollTop||a.forceScroll)){var e=Math.max(0,Math.min(c.scroller.scrollHeight-c.scroller.clientHeight,a.scrollTop));c.scroller.scrollTop=c.scrollbarV.scrollTop=d.scrollTop=e}if(null!=a.scrollLeft&&(c.scroller.scrollLeft!=a.scrollLeft||a.forceScroll)){var f=Math.max(0,Math.min(c.scroller.scrollWidth-c.scroller.clientWidth,a.scrollLeft));c.scroller.scrollLeft=c.scrollbarH.scrollLeft=d.scrollLeft=f,s(b)}if(a.scrollToPos){var g=od(b,$(d,a.scrollToPos.from),$(d,a.scrollToPos.to),a.scrollToPos.margin);a.scrollToPos.isCursor&&b.state.focused&&nd(b,g)}var h=a.maybeHiddenMarkers,i=a.maybeUnhiddenMarkers;if(h)for(var j=0;h.length>j;++j)h[j].lines.length||kh(h[j],"hide");if(i)for(var j=0;i.length>j;++j)i[j].lines.length&&kh(i[j],"unhide");c.wrapper.offsetHeight&&(d.scrollTop=b.display.scroller.scrollTop),a.updatedDisplay&&ag&&(b.options.lineWrapping&&B(b,a.barMeasure),a.barMeasure.scrollWidth>a.barMeasure.clientWidth&&a.barMeasure.scrollWidth<a.barMeasure.clientWidth+1&&!o(b)&&q(b)),a.changeObjs&&kh(b,"changes",b,a.changeObjs)}function hc(a,b){if(a.curOp)return b();$b(a);try{return b()}finally{ac(a)}}function ic(a,b){return function(){if(a.curOp)return b.apply(a,arguments);$b(a);try{return b.apply(a,arguments)}finally{ac(a)}}}function jc(a){return function(){if(this.curOp)return a.apply(this,arguments);$b(this);try{return a.apply(this,arguments)}finally{ac(this)}}}function kc(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);$b(b);try{return a.apply(this,arguments)}finally{ac(b)}}}function lc(a,b,c){this.line=b,this.rest=_d(b),this.size=this.rest?Je(nf(this.rest))-c+1:1,this.node=this.text=null,this.hidden=ce(a,b)}function mc(a,b,c){for(var d,e=[],f=b;c>f;f=d){var g=new lc(a.doc,Fe(a.doc,f),f);d=f+g.size,e.push(g)}return e}function nc(a,b,c,d){null==b&&(b=a.doc.first),null==c&&(c=a.doc.first+a.doc.size),d||(d=0);var e=a.display;if(d&&e.viewTo>c&&(null==e.updateLineNumbers||e.updateLineNumbers>b)&&(e.updateLineNumbers=b),a.curOp.viewChanged=!0,b>=e.viewTo)qg&&ae(a.doc,b)<e.viewTo&&pc(a);else if(e.viewFrom>=c)qg&&be(a.doc,c+d)>e.viewFrom?pc(a):(e.viewFrom+=d,e.viewTo+=d);else if(e.viewFrom>=b&&c>=e.viewTo)pc(a);else if(e.viewFrom>=b){var f=rc(a,c,c+d,1);f?(e.view=e.view.slice(f.index),e.viewFrom=f.lineN,e.viewTo+=d):pc(a)}else if(c>=e.viewTo){var f=rc(a,b,b,-1);f?(e.view=e.view.slice(0,f.index),e.viewTo=f.lineN):pc(a)}else{var g=rc(a,b,b,-1),h=rc(a,c,c+d,1);g&&h?(e.view=e.view.slice(0,g.index).concat(mc(a,g.lineN,h.lineN)).concat(e.view.slice(h.index)),e.viewTo+=d):pc(a)}var i=e.externalMeasured;i&&(i.lineN>c?i.lineN+=d:i.lineN+i.size>b&&(e.externalMeasured=null))}function oc(a,b,c){a.curOp.viewChanged=!0;var d=a.display,e=a.display.externalMeasured;if(e&&b>=e.lineN&&e.lineN+e.size>b&&(d.externalMeasured=null),!(d.viewFrom>b||b>=d.viewTo)){var f=d.view[qc(a,b)];if(null!=f.node){var g=f.changes||(f.changes=[]);-1==of(g,c)&&g.push(c)}}}function pc(a){a.display.viewFrom=a.display.viewTo=a.doc.first,a.display.view=[],a.display.viewOffset=0}function qc(a,b){if(b>=a.display.viewTo)return null;if(b-=a.display.viewFrom,0>b)return null;for(var c=a.display.view,d=0;c.length>d;d++)if(b-=c[d].size,0>b)return d}function rc(a,b,c,d){var e,f=qc(a,b),g=a.display.view;if(!qg||c==a.doc.first+a.doc.size)return{index:f,lineN:c};for(var h=0,i=a.display.viewFrom;f>h;h++)i+=g[h].size;if(i!=b){if(d>0){if(f==g.length-1)return null;e=i+g[f].size-b,f++}else e=i-b;b+=e,c+=e}for(;ae(a.doc,c)!=c;){if(f==(0>d?0:g.length-1))return null;c+=d*g[f-(0>d?1:0)].size,f+=d}return{index:f,lineN:c}}function sc(a,b,c){var d=a.display,e=d.view;0==e.length||b>=d.viewTo||d.viewFrom>=c?(d.view=mc(a,b,c),d.viewFrom=b):(d.viewFrom>b?d.view=mc(a,b,d.viewFrom).concat(d.view):b>d.viewFrom&&(d.view=d.view.slice(qc(a,b))),d.viewFrom=b,c>d.viewTo?d.view=d.view.concat(mc(a,d.viewTo,c)):d.viewTo>c&&(d.view=d.view.slice(0,qc(a,c)))),d.viewTo=c}function tc(a){for(var b=a.display.view,c=0,d=0;b.length>d;d++){var e=b[d];e.hidden||e.node&&!e.changes||++c}return c}function uc(a){a.display.pollingFast||a.display.poll.set(a.options.pollInterval,function(){wc(a),a.state.focused&&uc(a)})}function vc(a){function b(){var d=wc(a);d||c?(a.display.pollingFast=!1,uc(a)):(c=!0,a.display.poll.set(60,b))}var c=!1;a.display.pollingFast=!0,a.display.poll.set(20,b)}function wc(a){var b=a.display.input,c=a.display.prevInput,d=a.doc;if(!a.state.focused||Gh(b)&&!c||Ac(a)||a.options.disableInput||a.state.keySeq)return!1;a.state.pasteIncoming&&a.state.fakedLastChar&&(b.value=b.value.substring(0,b.value.length-1),a.state.fakedLastChar=!1);var e=b.value;if(e==c&&!a.somethingSelected())return!1;if($f&&_f>=9&&a.display.inputHasSelection===e||kg&&/[\uf700-\uf7ff]/.test(e))return xc(a),!1;var f=!a.curOp;f&&$b(a),a.display.shift=!1,8203!=e.charCodeAt(0)||d.sel!=a.display.selForContextMenu||c||(c="\u200b");for(var g=0,h=Math.min(c.length,e.length);h>g&&c.charCodeAt(g)==e.charCodeAt(g);)++g;var i=e.slice(g),j=Fh(i),k=null;a.state.pasteIncoming&&d.sel.ranges.length>1&&(zg&&zg.join("\n")==i?k=0==d.sel.ranges.length%zg.length&&pf(zg,Fh):j.length==d.sel.ranges.length&&(k=pf(j,function(a){return[a]})));for(var l=d.sel.ranges.length-1;l>=0;l--){var m=d.sel.ranges[l],n=m.from(),o=m.to();c.length>g?n=rg(n.line,n.ch-(c.length-g)):a.state.overwrite&&m.empty()&&!a.state.pasteIncoming&&(o=rg(o.line,Math.min(Fe(d,o.line).text.length,o.ch+nf(j).length)));var p=a.curOp.updateInput,q={from:n,to:o,text:k?k[l%k.length]:j,origin:a.state.pasteIncoming?"paste":a.state.cutIncoming?"cut":"+input"};if(gd(a.doc,q),df(a,"inputRead",a,q),i&&!a.state.pasteIncoming&&a.options.electricChars&&a.options.smartIndent&&100>m.head.ch&&(!l||d.sel.ranges[l-1].head.line!=m.head.line)){var r=a.getModeAt(m.head),s=Fg(q);if(r.electricChars){for(var t=0;r.electricChars.length>t;t++)if(i.indexOf(r.electricChars.charAt(t))>-1){ud(a,s.line,"smart");break}}else r.electricInput&&r.electricInput.test(Fe(d,s.line).text.slice(0,s.ch))&&ud(a,s.line,"smart")}}return sd(a),a.curOp.updateInput=p,a.curOp.typing=!0,e.length>1e3||e.indexOf("\n")>-1?b.value=a.display.prevInput="":a.display.prevInput=e,f&&ac(a),a.state.pasteIncoming=a.state.cutIncoming=!1,!0}function xc(a,b){var c,d,e=a.doc;if(a.somethingSelected()){a.display.prevInput="";var f=e.sel.primary();c=Hh&&(f.to().line-f.from().line>100||(d=a.getSelection()).length>1e3);var g=c?"-":d||a.getSelection();a.display.input.value=g,a.state.focused&&th(a.display.input),$f&&_f>=9&&(a.display.inputHasSelection=g)}else b||(a.display.prevInput=a.display.input.value="",$f&&_f>=9&&(a.display.inputHasSelection=null));a.display.inaccurateSelection=c}function yc(a){"nocursor"==a.options.readOnly||jg&&Af()==a.display.input||a.display.input.focus()}function zc(a){a.state.focused||(yc(a),Zc(a))}function Ac(a){return a.options.readOnly||a.doc.cantEdit}function Bc(a){function b(){a.state.focused&&setTimeout(sf(yc,a),0)}function c(b){ff(a,b)||hh(b)}function d(b){if(a.somethingSelected())zg=a.getSelections(),e.inaccurateSelection&&(e.prevInput="",e.inaccurateSelection=!1,e.input.value=zg.join("\n"),th(e.input));else{for(var c=[],d=[],f=0;a.doc.sel.ranges.length>f;f++){var g=a.doc.sel.ranges[f].head.line,h={anchor:rg(g,0),head:rg(g+1,0)};d.push(h),c.push(a.getRange(h.anchor,h.head))}"cut"==b.type?a.setSelections(d,null,oh):(e.prevInput="",e.input.value=c.join("\n"),th(e.input)),zg=c}"cut"==b.type&&(a.state.cutIncoming=!0)}var e=a.display;ih(e.scroller,"mousedown",ic(a,Fc)),$f&&11>_f?ih(e.scroller,"dblclick",ic(a,function(b){if(!ff(a,b)){var c=Ec(a,b);if(c&&!Kc(a,b)&&!Dc(a.display,b)){fh(b);var d=a.findWordAt(c);db(a.doc,d.anchor,d.head)}}})):ih(e.scroller,"dblclick",function(b){ff(a,b)||fh(b)}),ih(e.lineSpace,"selectstart",function(a){Dc(e,a)||fh(a)}),og||ih(e.scroller,"contextmenu",function(b){_c(a,b)}),ih(e.scroller,"scroll",function(){e.scroller.clientHeight&&(Nc(a,e.scroller.scrollTop),Oc(a,e.scroller.scrollLeft,!0),kh(a,"scroll",a))}),ih(e.scrollbarV,"scroll",function(){e.scroller.clientHeight&&Nc(a,e.scrollbarV.scrollTop)}),ih(e.scrollbarH,"scroll",function(){e.scroller.clientHeight&&Oc(a,e.scrollbarH.scrollLeft)}),ih(e.scroller,"mousewheel",function(b){Pc(a,b)}),ih(e.scroller,"DOMMouseScroll",function(b){Pc(a,b)}),ih(e.scrollbarH,"mousedown",b),ih(e.scrollbarV,"mousedown",b),ih(e.wrapper,"scroll",function(){e.wrapper.scrollTop=e.wrapper.scrollLeft=0}),ih(e.input,"keyup",function(b){Xc.call(a,b)}),ih(e.input,"input",function(){$f&&_f>=9&&a.display.inputHasSelection&&(a.display.inputHasSelection=null),vc(a)}),ih(e.input,"keydown",ic(a,Vc)),ih(e.input,"keypress",ic(a,Yc)),ih(e.input,"focus",sf(Zc,a)),ih(e.input,"blur",sf($c,a)),a.options.dragDrop&&(ih(e.scroller,"dragstart",function(b){Mc(a,b)}),ih(e.scroller,"dragenter",c),ih(e.scroller,"dragover",c),ih(e.scroller,"drop",ic(a,Lc))),ih(e.scroller,"paste",function(b){Dc(e,b)||(a.state.pasteIncoming=!0,yc(a),vc(a))}),ih(e.input,"paste",function(){if(ag&&!a.state.fakedLastChar&&!(200>new Date-a.state.lastMiddleDown)){var b=e.input.selectionStart,c=e.input.selectionEnd;e.input.value+="$",e.input.selectionEnd=c,e.input.selectionStart=b,a.state.fakedLastChar=!0}a.state.pasteIncoming=!0,vc(a)}),ih(e.input,"cut",d),ih(e.input,"copy",d),fg&&ih(e.sizer,"mouseup",function(){Af()==e.input&&e.input.blur(),yc(a)})}function Cc(a){var b=a.display;(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)&&(b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null,a.setSize())}function Dc(a,b){for(var c=bf(b);c!=a.wrapper;c=c.parentNode)if(!c||c.ignoreEvents||c.parentNode==a.sizer&&c!=a.mover)return!0}function Ec(a,b,c,d){var e=a.display;if(!c){var f=bf(b);if(f==e.scrollbarH||f==e.scrollbarV||f==e.scrollbarFiller||f==e.gutterFiller)return null}var g,h,i=e.lineSpace.getBoundingClientRect();try{g=b.clientX-i.left,h=b.clientY-i.top}catch(b){return null}var j,k=Wb(a,g,h);if(d&&1==k.xRel&&(j=Fe(a.doc,k.line).text).length==k.ch){var l=rh(j,j.length,a.options.tabSize)-j.length;k=rg(k.line,Math.max(0,Math.round((g-Bb(a.display).left)/Zb(a.display))-l))}return k}function Fc(a){if(!ff(this,a)){var b=this,c=b.display;if(c.shift=a.shiftKey,Dc(c,a))return ag||(c.scroller.draggable=!1,setTimeout(function(){c.scroller.draggable=!0},100)),void 0;if(!Kc(b,a)){var d=Ec(b,a);switch(window.focus(),cf(a)){case 1:d?Gc(b,a,d):bf(a)==c.scroller&&fh(a);break;case 2:ag&&(b.state.lastMiddleDown=+new Date),d&&db(b.doc,d),setTimeout(sf(yc,b),20),fh(a);break;case 3:og&&_c(b,a)}}}}function Gc(a,b,c){setTimeout(sf(zc,a),0);var d,e=+new Date;vg&&vg.time>e-400&&0==sg(vg.pos,c)?d="triple":ug&&ug.time>e-400&&0==sg(ug.pos,c)?(d="double",vg={time:e,pos:c}):(d="single",ug={time:e,pos:c});var f=a.doc.sel,g=kg?b.metaKey:b.ctrlKey;a.options.dragDrop&&Eh&&!Ac(a)&&"single"==d&&f.contains(c)>-1&&f.somethingSelected()?Hc(a,b,c,g):Ic(a,b,c,d,g)}function Hc(a,b,c,d){var e=a.display,f=ic(a,function(g){ag&&(e.scroller.draggable=!1),a.state.draggingText=!1,jh(document,"mouseup",f),jh(e.scroller,"drop",f),10>Math.abs(b.clientX-g.clientX)+Math.abs(b.clientY-g.clientY)&&(fh(g),d||db(a.doc,c),yc(a),$f&&9==_f&&setTimeout(function(){document.body.focus(),yc(a)},20))});ag&&(e.scroller.draggable=!0),a.state.draggingText=f,e.scroller.dragDrop&&e.scroller.dragDrop(),ih(document,"mouseup",f),ih(e.scroller,"drop",f)}function Ic(a,b,c,d,e){function f(b){if(0!=sg(p,b))if(p=b,"rect"==d){for(var e=[],f=a.options.tabSize,g=rh(Fe(j,c.line).text,c.ch,f),h=rh(Fe(j,b.line).text,b.ch,f),i=Math.min(g,h),n=Math.max(g,h),o=Math.min(c.line,b.line),q=Math.min(a.lastLine(),Math.max(c.line,b.line));q>=o;o++){var r=Fe(j,o).text,s=lf(r,i,f);i==n?e.push(new W(rg(o,s),rg(o,s))):r.length>s&&e.push(new W(rg(o,s),rg(o,lf(r,n,f))))}e.length||e.push(new W(c,c)),jb(j,X(m.ranges.slice(0,l).concat(e),l),{origin:"*mouse",scroll:!1}),a.scrollIntoView(b)}else{var t=k,u=t.anchor,v=b;if("single"!=d){if("double"==d)var w=a.findWordAt(b);else var w=new W(rg(b.line,0),$(j,rg(b.line+1,0)));sg(w.anchor,u)>0?(v=w.head,u=U(t.from(),w.anchor)):(v=w.anchor,u=T(t.to(),w.head))}var e=m.ranges.slice(0);e[l]=new W($(j,u),v),jb(j,X(e,l),ph)}}function g(b){var c=++s,e=Ec(a,b,!0,"rect"==d);if(e)if(0!=sg(e,p)){zc(a),f(e);var h=r(i,j);(e.line>=h.to||e.line<h.from)&&setTimeout(ic(a,function(){s==c&&g(b)}),150)}else{var k=b.clientY<q.top?-20:b.clientY>q.bottom?20:0;k&&setTimeout(ic(a,function(){s==c&&(i.scroller.scrollTop+=k,g(b))}),50)}}function h(b){s=1/0,fh(b),yc(a),jh(document,"mousemove",t),jh(document,"mouseup",u),j.history.lastSelOrigin=null}var i=a.display,j=a.doc;fh(b);var k,l,m=j.sel;if(e&&!b.shiftKey?(l=j.sel.contains(c),k=l>-1?j.sel.ranges[l]:new W(c,c)):k=j.sel.primary(),b.altKey)d="rect",e||(k=new W(c,c)),c=Ec(a,b,!0,!0),l=-1;else if("double"==d){var n=a.findWordAt(c);k=a.display.shift||j.extend?cb(j,k,n.anchor,n.head):n}else if("triple"==d){var o=new W(rg(c.line,0),$(j,rg(c.line+1,0)));k=a.display.shift||j.extend?cb(j,k,o.anchor,o.head):o}else k=cb(j,k,c);e?l>-1?fb(j,l,k,ph):(l=j.sel.ranges.length,jb(j,X(j.sel.ranges.concat([k]),l),{scroll:!1,origin:"*mouse"})):(l=0,jb(j,new V([k],0),ph),m=j.sel);var p=c,q=i.wrapper.getBoundingClientRect(),s=0,t=ic(a,function(a){cf(a)?g(a):h(a)}),u=ic(a,h);ih(document,"mousemove",t),ih(document,"mouseup",u)}function Jc(a,b,c,d,e){try{var f=b.clientX,g=b.clientY}catch(b){return!1}if(f>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&fh(b);var h=a.display,i=h.lineDiv.getBoundingClientRect();if(g>i.bottom||!hf(a,c))return af(b);g-=i.top-h.viewOffset;for(var j=0;a.options.gutters.length>j;++j){var k=h.gutters.childNodes[j];if(k&&k.getBoundingClientRect().right>=f){var l=Ke(a.doc,g),m=a.options.gutters[j];return e(a,c,a,l,m,b),af(b)}}}function Kc(a,b){return Jc(a,b,"gutterClick",!0,df)}function Lc(a){var b=this;if(!ff(b,a)&&!Dc(b.display,a)){fh(a),$f&&(Ag=+new Date);var c=Ec(b,a,!0),d=a.dataTransfer.files;if(c&&!Ac(b))if(d&&d.length&&window.FileReader&&window.File)for(var e=d.length,f=Array(e),g=0,h=function(a,d){var h=new FileReader;h.onload=ic(b,function(){if(f[d]=h.result,++g==e){c=$(b.doc,c);var a={from:c,to:c,text:Fh(f.join("\n")),origin:"paste"};gd(b.doc,a),ib(b.doc,Y(c,Fg(a)))}}),h.readAsText(a)},i=0;e>i;++i)h(d[i],i);else{if(b.state.draggingText&&b.doc.sel.contains(c)>-1)return b.state.draggingText(a),setTimeout(sf(yc,b),20),void 0;try{var f=a.dataTransfer.getData("Text");if(f){if(b.state.draggingText&&!(kg?a.metaKey:a.ctrlKey))var j=b.listSelections();if(kb(b.doc,Y(c,c)),j)for(var i=0;j.length>i;++i)md(b.doc,"",j[i].anchor,j[i].head,"drag");b.replaceSelection(f,"around","paste"),yc(b)}}catch(a){}}}}function Mc(a,b){if($f&&(!a.state.draggingText||100>+new Date-Ag))return hh(b),void 0;if(!ff(a,b)&&!Dc(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.setDragImage&&!eg)){var c=wf("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",dg&&(c.width=c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop),b.dataTransfer.setDragImage(c,0,0),dg&&c.parentNode.removeChild(c)}}function Nc(a,b){2>Math.abs(a.doc.scrollTop-b)||(a.doc.scrollTop=b,Xf||z(a,{top:b}),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbarV.scrollTop!=b&&(a.display.scrollbarV.scrollTop=b),Xf&&z(a),vb(a,100))}function Oc(a,b,c){(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,s(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbarH.scrollLeft!=b&&(a.display.scrollbarH.scrollLeft=b))}function Pc(a,b){var c=b.wheelDeltaX,d=b.wheelDeltaY;null==c&&b.detail&&b.axis==b.HORIZONTAL_AXIS&&(c=b.detail),null==d&&b.detail&&b.axis==b.VERTICAL_AXIS?d=b.detail:null==d&&(d=b.wheelDelta);var e=a.display,f=e.scroller;if(c&&f.scrollWidth>f.clientWidth||d&&f.scrollHeight>f.clientHeight){if(d&&kg&&ag)a:for(var g=b.target,h=e.view;g!=f;g=g.parentNode)for(var i=0;h.length>i;i++)if(h[i].node==g){a.display.currentWheelTarget=g;break a}if(c&&!Xf&&!dg&&null!=Cg)return d&&Nc(a,Math.max(0,Math.min(f.scrollTop+d*Cg,f.scrollHeight-f.clientHeight))),Oc(a,Math.max(0,Math.min(f.scrollLeft+c*Cg,f.scrollWidth-f.clientWidth))),fh(b),e.wheelStartX=null,void 0;if(d&&null!=Cg){var j=d*Cg,k=a.doc.scrollTop,l=k+e.wrapper.clientHeight;0>j?k=Math.max(0,k+j-50):l=Math.min(a.doc.height,l+j+50),z(a,{top:k,bottom:l})}20>Bg&&(null==e.wheelStartX?(e.wheelStartX=f.scrollLeft,e.wheelStartY=f.scrollTop,e.wheelDX=c,e.wheelDY=d,setTimeout(function(){if(null!=e.wheelStartX){var a=f.scrollLeft-e.wheelStartX,b=f.scrollTop-e.wheelStartY,c=b&&e.wheelDY&&b/e.wheelDY||a&&e.wheelDX&&a/e.wheelDX;e.wheelStartX=e.wheelStartY=null,c&&(Cg=(Cg*Bg+c)/(Bg+1),++Bg)}},200)):(e.wheelDX+=c,e.wheelDY+=d))}}function Qc(a,b,c){if("string"==typeof b&&(b=Qg[b],!b))return!1;a.display.pollingFast&&wc(a)&&(a.display.pollingFast=!1);var d=a.display.shift,e=!1;try{Ac(a)&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),e=b(a)!=nh}finally{a.display.shift=d,a.state.suppressEdits=!1}return e}function Rc(a,b,c){for(var d=0;a.state.keyMaps.length>d;d++){var e=Sg(b,a.state.keyMaps[d],c);if(e)return e}return a.options.extraKeys&&Sg(b,a.options.extraKeys,c)||Sg(b,a.options.keyMap,c)}function Sc(a,b,c,d){var e=a.state.keySeq;if(e){if(Tg(b))return"handled";Dg.set(50,function(){a.state.keySeq==e&&(a.state.keySeq=null,xc(a))}),b=e+" "+b}var f=Rc(a,b,d);return"multi"==f&&(a.state.keySeq=b),"handled"==f&&df(a,"keyHandled",a,b,c),("handled"==f||"multi"==f)&&(fh(c),ub(a)),e&&!f&&/\'$/.test(b)?(fh(c),!0):!!f}function Tc(a,b){var c=Ug(b,!0);return c?b.shiftKey&&!a.state.keySeq?Sc(a,"Shift-"+c,b,function(b){return Qc(a,b,!0)})||Sc(a,c,b,function(b){return("string"==typeof b?/^go[A-Z]/.test(b):b.motion)?Qc(a,b):void 0}):Sc(a,c,b,function(b){return Qc(a,b)}):!1}function Uc(a,b,c){return Sc(a,"'"+c+"'",b,function(b){return Qc(a,b,!0)})}function Vc(a){var b=this;if(zc(b),!ff(b,a)){$f&&11>_f&&27==a.keyCode&&(a.returnValue=!1);var c=a.keyCode;b.display.shift=16==c||a.shiftKey;var d=Tc(b,a);dg&&(Eg=d?c:null,!d&&88==c&&!Hh&&(kg?a.metaKey:a.ctrlKey)&&b.replaceSelection("",null,"cut")),18!=c||/\bCodeMirror-crosshair\b/.test(b.display.lineDiv.className)||Wc(b)}}function Wc(a){function b(a){18!=a.keyCode&&a.altKey||(Bh(c,"CodeMirror-crosshair"),jh(document,"keyup",b),jh(document,"mouseover",b))}var c=a.display.lineDiv;Ch(c,"CodeMirror-crosshair"),ih(document,"keyup",b),ih(document,"mouseover",b)}function Xc(a){16==a.keyCode&&(this.doc.sel.shift=!1),ff(this,a)}function Yc(a){var b=this;if(!(ff(b,a)||a.ctrlKey&&!a.altKey||kg&&a.metaKey)){var c=a.keyCode,d=a.charCode;if(dg&&c==Eg)return Eg=null,fh(a),void 0;if(!(dg&&(!a.which||10>a.which)||fg)||!Tc(b,a)){var e=String.fromCharCode(null==d?c:d);Uc(b,a,e)||($f&&_f>=9&&(b.display.inputHasSelection=null),vc(b))}}}function Zc(a){"nocursor"!=a.options.readOnly&&(a.state.focused||(kh(a,"focus",a),a.state.focused=!0,Ch(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(xc(a),ag&&setTimeout(sf(xc,a,!0),0))),uc(a),ub(a))}function $c(a){a.state.focused&&(kh(a,"blur",a),a.state.focused=!1,Bh(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150)}function _c(a,b){function c(){if(null!=e.input.selectionStart){var b=a.somethingSelected(),c=e.input.value="\u200b"+(b?e.input.value:"");e.prevInput=b?"":"\u200b",e.input.selectionStart=1,e.input.selectionEnd=c.length,e.selForContextMenu=a.doc.sel}}function d(){if(e.inputDiv.style.position="relative",e.input.style.cssText=i,$f&&9>_f&&(e.scrollbarV.scrollTop=e.scroller.scrollTop=g),uc(a),null!=e.input.selectionStart){(!$f||$f&&9>_f)&&c();var b=0,d=function(){e.selForContextMenu==a.doc.sel&&0==e.input.selectionStart?ic(a,Qg.selectAll)(a):10>b++?e.detectingSelectAll=setTimeout(d,500):xc(a)};e.detectingSelectAll=setTimeout(d,200)}}if(!ff(a,b,"contextmenu")){var e=a.display;if(!Dc(e,b)&&!ad(a,b)){var f=Ec(a,b),g=e.scroller.scrollTop;if(f&&!dg){var h=a.options.resetSelectionOnContextMenu;h&&-1==a.doc.sel.contains(f)&&ic(a,jb)(a.doc,Y(f),oh);var i=e.input.style.cssText;if(e.inputDiv.style.position="absolute",e.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(b.clientY-5)+"px; left: "+(b.clientX-5)+"px; z-index: 1000; background: "+($f?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",ag)var j=window.scrollY;if(yc(a),ag&&window.scrollTo(null,j),xc(a),a.somethingSelected()||(e.input.value=e.prevInput=" "),e.selForContextMenu=a.doc.sel,clearTimeout(e.detectingSelectAll),$f&&_f>=9&&c(),og){hh(b);var k=function(){jh(window,"mouseup",k),setTimeout(d,20)};ih(window,"mouseup",k)}else setTimeout(d,50)}}}}function ad(a,b){return hf(a,"gutterContextMenu")?Jc(a,b,"gutterContextMenu",!1,kh):!1}function bd(a,b){if(0>sg(a,b.from))return a;if(0>=sg(a,b.to))return Fg(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;return a.line==b.to.line&&(d+=Fg(b).ch-b.to.ch),rg(c,d)}function cd(a,b){for(var c=[],d=0;a.sel.ranges.length>d;d++){var e=a.sel.ranges[d];c.push(new W(bd(e.anchor,b),bd(e.head,b)))}return X(c,a.sel.primIndex)}function dd(a,b,c){return a.line==b.line?rg(c.line,a.ch-b.ch+c.ch):rg(c.line+(a.line-b.line),a.ch)}function ed(a,b,c){for(var d=[],e=rg(a.first,0),f=e,g=0;b.length>g;g++){var h=b[g],i=dd(h.from,e,f),j=dd(Fg(h),e,f);if(e=h.to,f=j,"around"==c){var k=a.sel.ranges[g],l=0>sg(k.head,k.anchor);d[g]=new W(l?j:i,l?i:j)}else d[g]=new W(i,i)}return new V(d,a.sel.primIndex)}function fd(a,b,c){var d={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=!0}};return c&&(d.update=function(b,c,d,e){b&&(this.from=$(a,b)),c&&(this.to=$(a,c)),d&&(this.text=d),void 0!==e&&(this.origin=e)}),kh(a,"beforeChange",a,d),a.cm&&kh(a.cm,"beforeChange",a.cm,d),d.canceled?null:{from:d.from,to:d.to,text:d.text,origin:d.origin}}function gd(a,b,c){if(a.cm){if(!a.cm.curOp)return ic(a.cm,gd)(a,b,c);if(a.cm.state.suppressEdits)return}if(!(hf(a,"beforeChange")||a.cm&&hf(a.cm,"beforeChange"))||(b=fd(a,b,!0))){var d=pg&&!c&&Qd(a,b.from,b.to);if(d)for(var e=d.length-1;e>=0;--e)hd(a,{from:d[e].from,to:d[e].to,text:e?[""]:b.text});else hd(a,b)}}function hd(a,b){if(1!=b.text.length||""!=b.text[0]||0!=sg(b.from,b.to)){var c=cd(a,b);Re(a,b,c,a.cm?a.cm.curOp.id:0/0),kd(a,b,c,Nd(a,b));var d=[];De(a,function(a,c){c||-1!=of(d,a.history)||(_e(a.history,b),d.push(a.history)),kd(a,b,null,Nd(a,b))})}}function id(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var d,e=a.history,f=a.sel,g="undo"==b?e.done:e.undone,h="undo"==b?e.undone:e.done,i=0;g.length>i&&(d=g[i],c?!d.ranges||d.equals(a.sel):d.ranges);i++);if(i!=g.length){for(e.lastOrigin=e.lastSelOrigin=null;d=g.pop(),d.ranges;){if(Ue(d,h),c&&!d.equals(a.sel))return jb(a,d,{clearRedo:!1}),void 0;f=d}var j=[];Ue(f,h),h.push({changes:j,generation:e.generation}),e.generation=d.generation||++e.maxGeneration;for(var k=hf(a,"beforeChange")||a.cm&&hf(a.cm,"beforeChange"),i=d.changes.length-1;i>=0;--i){var l=d.changes[i];if(l.origin=b,k&&!fd(a,l,!1))return g.length=0,void 0;j.push(Oe(a,l));var m=i?cd(a,l):nf(g);kd(a,l,m,Pd(a,l)),!i&&a.cm&&a.cm.scrollIntoView({from:l.from,to:Fg(l)});var n=[];De(a,function(a,b){b||-1!=of(n,a.history)||(_e(a.history,l),n.push(a.history)),kd(a,l,null,Pd(a,l))})}}}}function jd(a,b){if(0!=b&&(a.first+=b,a.sel=new V(pf(a.sel.ranges,function(a){return new W(rg(a.anchor.line+b,a.anchor.ch),rg(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){nc(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;c.viewTo>d;d++)oc(a.cm,d,"gutter")}}function kd(a,b,c,d){if(a.cm&&!a.cm.curOp)return ic(a.cm,kd)(a,b,c,d);if(b.to.line<a.first)return jd(a,b.text.length-1-(b.to.line-b.from.line)),void 0;if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);jd(a,e),b={from:rg(a.first,0),to:rg(b.to.line+e,b.to.ch),text:[nf(b.text)],origin:b.origin}}var f=a.lastLine();b.to.line>f&&(b={from:b.from,to:rg(f,Fe(a,f).text.length),text:[b.text[0]],origin:b.origin}),b.removed=Ge(a,b.from,b.to),c||(c=cd(a,b)),a.cm?ld(a.cm,b,d):Ae(a,b,d),kb(a,c,oh)}}function ld(a,b,c){var d=a.doc,e=a.display,g=b.from,h=b.to,i=!1,j=g.line;a.options.lineWrapping||(j=Je($d(Fe(d,g.line))),d.iter(j,h.line+1,function(a){return a==e.maxLine?(i=!0,!0):void 0})),d.sel.contains(b.from,b.to)>-1&&gf(a),Ae(d,b,c,f(a)),a.options.lineWrapping||(d.iter(j,g.line+b.text.length,function(a){var b=l(a);b>e.maxLineLength&&(e.maxLine=a,e.maxLineLength=b,e.maxLineChanged=!0,i=!1)}),i&&(a.curOp.updateMaxLine=!0)),d.frontier=Math.min(d.frontier,g.line),vb(a,400);var k=b.text.length-(h.line-g.line)-1;g.line!=h.line||1!=b.text.length||ze(a.doc,b)?nc(a,g.line,h.line+1,k):oc(a,g.line,"text");var m=hf(a,"changes"),n=hf(a,"change");if(n||m){var o={from:g,to:h,text:b.text,removed:b.removed,origin:b.origin};n&&df(a,"change",a,o),m&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(o)}a.display.selForContextMenu=null}function md(a,b,c,d,e){if(d||(d=c),0>sg(d,c)){var f=d;d=c,c=f}"string"==typeof b&&(b=Fh(b)),gd(a,{from:c,to:d,text:b,origin:e})}function nd(a,b){if(!ff(a,"scrollCursorIntoView")){var c=a.display,d=c.sizer.getBoundingClientRect(),e=null;if(0>b.top+d.top?e=!0:b.bottom+d.top>(window.innerHeight||document.documentElement.clientHeight)&&(e=!1),null!=e&&!hg){var f=wf("div","\u200b",null,"position: absolute; top: "+(b.top-c.viewOffset-zb(a.display))+"px; height: "+(b.bottom-b.top+mh)+"px; left: "+b.left+"px; width: 2px;");a.display.lineSpace.appendChild(f),f.scrollIntoView(e),a.display.lineSpace.removeChild(f)}}}function od(a,b,c,d){null==d&&(d=0);for(var e=0;5>e;e++){var f=!1,g=Tb(a,b),h=c&&c!=b?Tb(a,c):g,i=qd(a,Math.min(g.left,h.left),Math.min(g.top,h.top)-d,Math.max(g.left,h.left),Math.max(g.bottom,h.bottom)+d),j=a.doc.scrollTop,k=a.doc.scrollLeft;if(null!=i.scrollTop&&(Nc(a,i.scrollTop),Math.abs(a.doc.scrollTop-j)>1&&(f=!0)),null!=i.scrollLeft&&(Oc(a,i.scrollLeft),Math.abs(a.doc.scrollLeft-k)>1&&(f=!0)),!f)return g}}function pd(a,b,c,d,e){var f=qd(a,b,c,d,e);null!=f.scrollTop&&Nc(a,f.scrollTop),null!=f.scrollLeft&&Oc(a,f.scrollLeft)}function qd(a,b,c,d,e){var f=a.display,g=Yb(a.display);0>c&&(c=0);var h=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:f.scroller.scrollTop,i=f.scroller.clientHeight-mh,j={};e-c>i&&(e=c+i);var k=a.doc.height+Ab(f),l=g>c,m=e>k-g;if(h>c)j.scrollTop=l?0:c;else if(e>h+i){var n=Math.min(c,(m?k:e)-i);n!=h&&(j.scrollTop=n)}var o=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:f.scroller.scrollLeft,p=f.scroller.clientWidth-mh-f.gutters.offsetWidth,q=d-b>p;return q&&(d=b+p),10>b?j.scrollLeft=0:o>b?j.scrollLeft=Math.max(0,b-(q?0:10)):d>p+o-3&&(j.scrollLeft=d+(q?0:10)-p),j}function rd(a,b,c){(null!=b||null!=c)&&td(a),null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:a.curOp.scrollLeft)+b),null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function sd(a){td(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?rg(b.line,b.ch-1):b,d=rg(b.line,b.ch+1)),a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function td(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=Ub(a,b.from),d=Ub(a,b.to),e=qd(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(e.scrollLeft,e.scrollTop)}}function ud(a,b,c,d){var e,f=a.doc;null==c&&(c="add"),"smart"==c&&(f.mode.indent?e=yb(a,b):c="prev");var g=a.options.tabSize,h=Fe(f,b),i=rh(h.text,null,g);h.stateAfter&&(h.stateAfter=null);var j,k=h.text.match(/^\s*/)[0];if(d||/\S/.test(h.text)){if("smart"==c&&(j=f.mode.indent(e,h.text.slice(k.length),h.text),j==nh||j>150)){if(!d)return;c="prev"}}else j=0,c="not";"prev"==c?j=b>f.first?rh(Fe(f,b-1).text,null,g):0:"add"==c?j=i+a.options.indentUnit:"subtract"==c?j=i-a.options.indentUnit:"number"==typeof c&&(j=i+c),j=Math.max(0,j);var l="",m=0;if(a.options.indentWithTabs)for(var n=Math.floor(j/g);n;--n)m+=g,l+="	";if(j>m&&(l+=mf(j-m)),l!=k)md(f,l,rg(b,0),rg(b,k.length),"+input");else for(var n=0;f.sel.ranges.length>n;n++){var o=f.sel.ranges[n];if(o.head.line==b&&o.head.ch<k.length){var m=rg(b,k.length);fb(f,n,new W(m,m));break}}h.stateAfter=null}function vd(a,b,c,d){var e=b,f=b;return"number"==typeof b?f=Fe(a,Z(a,b)):e=Je(b),null==e?null:(d(f,e)&&a.cm&&oc(a.cm,e,c),f)}function wd(a,b){for(var c=a.doc.sel.ranges,d=[],e=0;c.length>e;e++){for(var f=b(c[e]);d.length&&0>=sg(f.from,nf(d).to);){var g=d.pop();if(0>sg(g.from,f.from)){f.from=g.from;break}}d.push(f)}hc(a,function(){for(var b=d.length-1;b>=0;b--)md(a.doc,"",d[b].from,d[b].to,"+delete");sd(a)})}function xd(a,b,c,d,e){function f(){var b=h+c;return a.first>b||b>=a.first+a.size?l=!1:(h=b,k=Fe(a,b))}function g(a){var b=(e?Vf:Wf)(k,i,c,!0);if(null==b){if(a||!f())return l=!1;i=e?(0>c?Of:Nf)(k):0>c?k.text.length:0}else i=b;return!0}var h=b.line,i=b.ch,j=c,k=Fe(a,h),l=!0;if("char"==d)g();else if("column"==d)g(!0);else if("word"==d||"group"==d)for(var m=null,n="group"==d,o=a.cm&&a.cm.getHelper(b,"wordChars"),p=!0;!(0>c)||g(!p);p=!1){var q=k.text.charAt(i)||"\n",r=tf(q,o)?"w":n&&"\n"==q?"n":!n||/\s/.test(q)?null:"p";if(!n||p||r||(r="s"),m&&m!=r){0>c&&(c=1,g());break}if(r&&(m=r),c>0&&!g(!p))break}var s=ob(a,rg(h,i),j,!0);return l||(s.hitSide=!0),s}function yd(a,b,c,d){var e,f=a.doc,g=b.left;if("page"==d){var h=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);e=b.top+c*(h-(0>c?1.5:.5)*Yb(a.display))}else"line"==d&&(e=c>0?b.bottom+3:b.top-3);for(;;){var i=Wb(a,g,e);if(!i.outside)break;if(0>c?0>=e:e>=f.height){i.hitSide=!0;break}e+=5*c}return i}function zd(b,c,d,e){a.defaults[b]=c,d&&(Hg[b]=e?function(a,b,c){c!=Ig&&d(a,b,c)}:d)}function Ad(a){for(var b,c,d,e,f=a.split(/-(?!$)/),a=f[f.length-1],g=0;f.length-1>g;g++){var h=f[g];if(/^(cmd|meta|m)$/i.test(h))e=!0;else if(/^a(lt)?$/i.test(h))b=!0;else if(/^(c|ctrl|control)$/i.test(h))c=!0;else{if(!/^s(hift)$/i.test(h))throw new Error("Unrecognized modifier name: "+h);d=!0}}return b&&(a="Alt-"+a),c&&(a="Ctrl-"+a),e&&(a="Cmd-"+a),d&&(a="Shift-"+a),a}function Bd(a){return"string"==typeof a?Rg[a]:a}function Cd(a,b,c,d,e){if(d&&d.shared)return Dd(a,b,c,d,e);if(a.cm&&!a.cm.curOp)return ic(a.cm,Cd)(a,b,c,d,e);var f=new Wg(a,e),g=sg(b,c);if(d&&rf(d,f,!1),g>0||0==g&&f.clearWhenEmpty!==!1)return f;if(f.replacedWith&&(f.collapsed=!0,f.widgetNode=wf("span",[f.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||(f.widgetNode.ignoreEvents=!0),d.insertLeft&&(f.widgetNode.insertLeft=!0)),f.collapsed){if(Zd(a,b.line,b,c,f)||b.line!=c.line&&Zd(a,c.line,b,c,f))throw new Error("Inserting collapsed marker partially overlapping an existing one");
qg=!0}f.addToHistory&&Re(a,{from:b,to:c,origin:"markText"},a.sel,0/0);var h,i=b.line,j=a.cm;if(a.iter(i,c.line+1,function(a){j&&f.collapsed&&!j.options.lineWrapping&&$d(a)==j.display.maxLine&&(h=!0),f.collapsed&&i!=b.line&&Ie(a,0),Kd(a,new Hd(f,i==b.line?b.ch:null,i==c.line?c.ch:null)),++i}),f.collapsed&&a.iter(b.line,c.line+1,function(b){ce(a,b)&&Ie(b,0)}),f.clearOnEnter&&ih(f,"beforeCursorEnter",function(){f.clear()}),f.readOnly&&(pg=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory()),f.collapsed&&(f.id=++Xg,f.atomic=!0),j){if(h&&(j.curOp.updateMaxLine=!0),f.collapsed)nc(j,b.line,c.line+1);else if(f.className||f.title||f.startStyle||f.endStyle)for(var k=b.line;c.line>=k;k++)oc(j,k,"text");f.atomic&&mb(j.doc),df(j,"markerAdded",j,f)}return f}function Dd(a,b,c,d,e){d=rf(d),d.shared=!1;var f=[Cd(a,b,c,d,e)],g=f[0],h=d.widgetNode;return De(a,function(a){h&&(d.widgetNode=h.cloneNode(!0)),f.push(Cd(a,$(a,b),$(a,c),d,e));for(var i=0;a.linked.length>i;++i)if(a.linked[i].isParent)return;g=nf(f)}),new Yg(f,g)}function Ed(a){return a.findMarks(rg(a.first,0),a.clipPos(rg(a.lastLine())),function(a){return a.parent})}function Fd(a,b){for(var c=0;b.length>c;c++){var d=b[c],e=d.find(),f=a.clipPos(e.from),g=a.clipPos(e.to);if(sg(f,g)){var h=Cd(a,f,g,d.primary,d.primary.type);d.markers.push(h),h.parent=d}}}function Gd(a){for(var b=0;a.length>b;b++){var c=a[b],d=[c.primary.doc];De(c.primary.doc,function(a){d.push(a)});for(var e=0;c.markers.length>e;e++){var f=c.markers[e];-1==of(d,f.doc)&&(f.parent=null,c.markers.splice(e--,1))}}}function Hd(a,b,c){this.marker=a,this.from=b,this.to=c}function Id(a,b){if(a)for(var c=0;a.length>c;++c){var d=a[c];if(d.marker==b)return d}}function Jd(a,b){for(var c,d=0;a.length>d;++d)a[d]!=b&&(c||(c=[])).push(a[d]);return c}function Kd(a,b){a.markedSpans=a.markedSpans?a.markedSpans.concat([b]):[b],b.marker.attachLine(a)}function Ld(a,b,c){if(a)for(var d,e=0;a.length>e;++e){var f=a[e],g=f.marker,h=null==f.from||(g.inclusiveLeft?b>=f.from:b>f.from);if(h||f.from==b&&"bookmark"==g.type&&(!c||!f.marker.insertLeft)){var i=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);(d||(d=[])).push(new Hd(g,f.from,i?null:f.to))}}return d}function Md(a,b,c){if(a)for(var d,e=0;a.length>e;++e){var f=a[e],g=f.marker,h=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);if(h||f.from==b&&"bookmark"==g.type&&(!c||f.marker.insertLeft)){var i=null==f.from||(g.inclusiveLeft?b>=f.from:b>f.from);(d||(d=[])).push(new Hd(g,i?null:f.from-b,null==f.to?null:f.to-b))}}return d}function Nd(a,b){var c=ab(a,b.from.line)&&Fe(a,b.from.line).markedSpans,d=ab(a,b.to.line)&&Fe(a,b.to.line).markedSpans;if(!c&&!d)return null;var e=b.from.ch,f=b.to.ch,g=0==sg(b.from,b.to),h=Ld(c,e,g),i=Md(d,f,g),j=1==b.text.length,k=nf(b.text).length+(j?e:0);if(h)for(var l=0;h.length>l;++l){var m=h[l];if(null==m.to){var n=Id(i,m.marker);n?j&&(m.to=null==n.to?null:n.to+k):m.to=e}}if(i)for(var l=0;i.length>l;++l){var m=i[l];if(null!=m.to&&(m.to+=k),null==m.from){var n=Id(h,m.marker);n||(m.from=k,j&&(h||(h=[])).push(m))}else m.from+=k,j&&(h||(h=[])).push(m)}h&&(h=Od(h)),i&&i!=h&&(i=Od(i));var o=[h];if(!j){var p,q=b.text.length-2;if(q>0&&h)for(var l=0;h.length>l;++l)null==h[l].to&&(p||(p=[])).push(new Hd(h[l].marker,null,null));for(var l=0;q>l;++l)o.push(p);o.push(i)}return o}function Od(a){for(var b=0;a.length>b;++b){var c=a[b];null!=c.from&&c.from==c.to&&c.marker.clearWhenEmpty!==!1&&a.splice(b--,1)}return a.length?a:null}function Pd(a,b){var c=Xe(a,b),d=Nd(a,b);if(!c)return d;if(!d)return c;for(var e=0;c.length>e;++e){var f=c[e],g=d[e];if(f&&g)a:for(var h=0;g.length>h;++h){for(var i=g[h],j=0;f.length>j;++j)if(f[j].marker==i.marker)continue a;f.push(i)}else g&&(c[e]=g)}return c}function Qd(a,b,c){var d=null;if(a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;a.markedSpans.length>b;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=of(d,c)||(d||(d=[])).push(c)}}),!d)return null;for(var e=[{from:b,to:c}],f=0;d.length>f;++f)for(var g=d[f],h=g.find(0),i=0;e.length>i;++i){var j=e[i];if(!(0>sg(j.to,h.from)||sg(j.from,h.to)>0)){var k=[i,1],l=sg(j.from,h.from),m=sg(j.to,h.to);(0>l||!g.inclusiveLeft&&!l)&&k.push({from:j.from,to:h.from}),(m>0||!g.inclusiveRight&&!m)&&k.push({from:h.to,to:j.to}),e.splice.apply(e,k),i+=k.length-1}}return e}function Rd(a){var b=a.markedSpans;if(b){for(var c=0;b.length>c;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Sd(a,b){if(b){for(var c=0;b.length>c;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Td(a){return a.inclusiveLeft?-1:0}function Ud(a){return a.inclusiveRight?1:0}function Vd(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;var d=a.find(),e=b.find(),f=sg(d.from,e.from)||Td(a)-Td(b);if(f)return-f;var g=sg(d.to,e.to)||Ud(a)-Ud(b);return g?g:b.id-a.id}function Wd(a,b){var c,d=qg&&a.markedSpans;if(d)for(var e,f=0;d.length>f;++f)e=d[f],e.marker.collapsed&&null==(b?e.from:e.to)&&(!c||0>Vd(c,e.marker))&&(c=e.marker);return c}function Xd(a){return Wd(a,!0)}function Yd(a){return Wd(a,!1)}function Zd(a,b,c,d,e){var f=Fe(a,b),g=qg&&f.markedSpans;if(g)for(var h=0;g.length>h;++h){var i=g[h];if(i.marker.collapsed){var j=i.marker.find(0),k=sg(j.from,c)||Td(i.marker)-Td(e),l=sg(j.to,d)||Ud(i.marker)-Ud(e);if(!(k>=0&&0>=l||0>=k&&l>=0)&&(0>=k&&(sg(j.to,c)>0||i.marker.inclusiveRight&&e.inclusiveLeft)||k>=0&&(0>sg(j.from,d)||i.marker.inclusiveLeft&&e.inclusiveRight)))return!0}}}function $d(a){for(var b;b=Xd(a);)a=b.find(-1,!0).line;return a}function _d(a){for(var b,c;b=Yd(a);)a=b.find(1,!0).line,(c||(c=[])).push(a);return c}function ae(a,b){var c=Fe(a,b),d=$d(c);return c==d?b:Je(d)}function be(a,b){if(b>a.lastLine())return b;var c,d=Fe(a,b);if(!ce(a,d))return b;for(;c=Yd(d);)d=c.find(1,!0).line;return Je(d)+1}function ce(a,b){var c=qg&&b.markedSpans;if(c)for(var d,e=0;c.length>e;++e)if(d=c[e],d.marker.collapsed){if(null==d.from)return!0;if(!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&de(a,b,d))return!0}}function de(a,b,c){if(null==c.to){var d=c.marker.find(1,!0);return de(a,d.line,Id(d.line.markedSpans,c.marker))}if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var e,f=0;b.markedSpans.length>f;++f)if(e=b.markedSpans[f],e.marker.collapsed&&!e.marker.widgetNode&&e.from==c.to&&(null==e.to||e.to!=c.from)&&(e.marker.inclusiveLeft||c.marker.inclusiveRight)&&de(a,b,e))return!0}function ee(a,b,c){Le(b)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&rd(a,null,c)}function fe(a){if(null!=a.height)return a.height;if(!zf(document.body,a.node)){var b="position: relative;";a.coverGutter&&(b+="margin-left: -"+a.cm.getGutterElement().offsetWidth+"px;"),yf(a.cm.display.measure,wf("div",[a.node],null,b))}return a.height=a.node.offsetHeight}function ge(a,b,c,d){var e=new Zg(a,c,d);return e.noHScroll&&(a.display.alignWidgets=!0),vd(a.doc,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);if(null==e.insertAt?c.push(e):c.splice(Math.min(c.length-1,Math.max(0,e.insertAt)),0,e),e.line=b,!ce(a.doc,b)){var d=Le(b)<a.doc.scrollTop;Ie(b,b.height+fe(e)),d&&rd(a,null,e.height),a.curOp.forceUpdate=!0}return!0}),e}function he(a,b,c,d){a.text=b,a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null),null!=a.order&&(a.order=null),Rd(a),Sd(a,c);var e=d?d(a):1;e!=a.height&&Ie(a,e)}function ie(a){a.parent=null,Rd(a)}function je(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:new RegExp("(?:^|s)"+c[2]+"(?:$|s)").test(b[d])||(b[d]+=" "+c[2])}return a}function ke(b,c){if(b.blankLine)return b.blankLine(c);if(b.innerMode){var d=a.innerMode(b,c);return d.mode.blankLine?d.mode.blankLine(d.state):void 0}}function le(b,c,d,e){for(var f=0;10>f;f++){e&&(e[0]=a.innerMode(b,d).mode);var g=b.token(c,d);if(c.pos>c.start)return g}throw new Error("Mode "+b.name+" failed to advance stream.")}function me(a,b,c,d){function e(a){return{start:l.start,end:l.pos,string:l.current(),type:f||null,state:a?Og(g.mode,k):k}}var f,g=a.doc,h=g.mode;b=$(g,b);var i,j=Fe(g,b.line),k=yb(a,b.line,c),l=new Vg(j.text,a.options.tabSize);for(d&&(i=[]);(d||l.pos<b.ch)&&!l.eol();)l.start=l.pos,f=le(h,l,k),d&&i.push(e(!0));return d?i:e()}function ne(a,b,c,d,e,f,g){var h=c.flattenSpans;null==h&&(h=a.options.flattenSpans);var i,j=0,k=null,l=new Vg(b,a.options.tabSize),m=a.options.addModeClass&&[null];for(""==b&&je(ke(c,d),f);!l.eol();){if(l.pos>a.options.maxHighlightLength?(h=!1,g&&qe(a,b,d,l.pos),l.pos=b.length,i=null):i=je(le(c,l,d,m),f),m){var n=m[0].name;n&&(i="m-"+(i?n+" "+i:n))}h&&k==i||(l.start>j&&e(l.start,k),j=l.start,k=i),l.start=l.pos}for(;l.pos>j;){var o=Math.min(l.pos,j+5e4);e(o,k),j=o}}function oe(a,b,c,d){var e=[a.state.modeGen],f={};ne(a,b.text,a.doc.mode,c,function(a,b){e.push(a,b)},f,d);for(var g=0;a.state.overlays.length>g;++g){var h=a.state.overlays[g],i=1,j=0;ne(a,b.text,h.mode,!0,function(a,b){for(var c=i;a>j;){var d=e[i];d>a&&e.splice(i,1,a,e[i+1],d),i+=2,j=Math.min(a,d)}if(b)if(h.opaque)e.splice(c,i-c,a,"cm-overlay "+b),i=c+2;else for(;i>c;c+=2){var f=e[c+1];e[c+1]=(f?f+" ":"")+"cm-overlay "+b}},f)}return{styles:e,classes:f.bgClass||f.textClass?f:null}}function pe(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=oe(a,b,b.stateAfter=yb(a,Je(b)));b.styles=d.styles,d.classes?b.styleClasses=d.classes:b.styleClasses&&(b.styleClasses=null),c===a.doc.frontier&&a.doc.frontier++}return b.styles}function qe(a,b,c,d){var e=a.doc.mode,f=new Vg(b,a.options.tabSize);for(f.start=f.pos=d||0,""==b&&ke(e,c);!f.eol()&&f.pos<=a.options.maxHighlightLength;)le(e,f,c),f.start=f.pos}function re(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?ah:_g;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function se(a,b){var c=wf("span",null,null,ag?"padding-right: .1px":null),d={pre:wf("pre",[c]),content:c,col:0,pos:0,cm:a};b.measure={};for(var e=0;(b.rest?b.rest.length:0)>=e;e++){var f,g=e?b.rest[e-1]:b.line;d.pos=0,d.addToken=ue,($f||ag)&&a.getOption("lineWrapping")&&(d.addToken=ve(d.addToken)),If(a.display.measure)&&(f=Me(g))&&(d.addToken=we(d.addToken,f)),d.map=[];var h=b!=a.display.externalMeasured&&Je(g);ye(g,d,pe(a,g,h)),g.styleClasses&&(g.styleClasses.bgClass&&(d.bgClass=Cf(g.styleClasses.bgClass,d.bgClass||"")),g.styleClasses.textClass&&(d.textClass=Cf(g.styleClasses.textClass,d.textClass||""))),0==d.map.length&&d.map.push(0,0,d.content.appendChild(Hf(a.display.measure))),0==e?(b.measure.map=d.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(d.map),(b.measure.caches||(b.measure.caches=[])).push({}))}return ag&&/\bcm-tab\b/.test(d.content.lastChild.className)&&(d.content.className="cm-tab-wrap-hack"),kh(a,"renderLine",a,b.line,d.pre),d.pre.className&&(d.textClass=Cf(d.pre.className,d.textClass||"")),d}function te(a){var b=wf("span","\u2022","cm-invalidchar");return b.title="\\u"+a.charCodeAt(0).toString(16),b}function ue(a,b,c,d,e,f){if(b){var g=a.cm.options.specialChars,h=!1;if(g.test(b))for(var i=document.createDocumentFragment(),j=0;;){g.lastIndex=j;var k=g.exec(b),l=k?k.index-j:b.length-j;if(l){var m=document.createTextNode(b.slice(j,j+l));$f&&9>_f?i.appendChild(wf("span",[m])):i.appendChild(m),a.map.push(a.pos,a.pos+l,m),a.col+=l,a.pos+=l}if(!k)break;if(j+=l+1,"	"==k[0]){var n=a.cm.options.tabSize,o=n-a.col%n,m=i.appendChild(wf("span",mf(o),"cm-tab"));a.col+=o}else{var m=a.cm.options.specialCharPlaceholder(k[0]);$f&&9>_f?i.appendChild(wf("span",[m])):i.appendChild(m),a.col+=1}a.map.push(a.pos,a.pos+1,m),a.pos++}else{a.col+=b.length;var i=document.createTextNode(b);a.map.push(a.pos,a.pos+b.length,i),$f&&9>_f&&(h=!0),a.pos+=b.length}if(c||d||e||h){var p=c||"";d&&(p+=d),e&&(p+=e);var q=wf("span",[i],p);return f&&(q.title=f),a.content.appendChild(q)}a.content.appendChild(i)}}function ve(a){function b(a){for(var b=" ",c=0;a.length-2>c;++c)b+=c%2?" ":"\u00a0";return b+=" "}return function(c,d,e,f,g,h){a(c,d.replace(/ {3,}/g,b),e,f,g,h)}}function we(a,b){return function(c,d,e,f,g,h){e=e?e+" cm-force-border":"cm-force-border";for(var i=c.pos,j=i+d.length;;){for(var k=0;b.length>k;k++){var l=b[k];if(l.to>i&&i>=l.from)break}if(l.to>=j)return a(c,d,e,f,g,h);a(c,d.slice(0,l.to-i),e,f,null,h),f=null,d=d.slice(l.to-i),i=l.to}}}function xe(a,b,c,d){var e=!d&&c.widgetNode;e&&(a.map.push(a.pos,a.pos+b,e),a.content.appendChild(e)),a.pos+=b}function ye(a,b,c){var d=a.markedSpans,e=a.text,f=0;if(d)for(var g,h,i,j,k,l,m=e.length,n=0,o=1,p="",q=0;;){if(q==n){h=i=j=k="",l=null,q=1/0;for(var r=[],s=0;d.length>s;++s){var t=d[s],u=t.marker;n>=t.from&&(null==t.to||t.to>n)?(null!=t.to&&q>t.to&&(q=t.to,i=""),u.className&&(h+=" "+u.className),u.startStyle&&t.from==n&&(j+=" "+u.startStyle),u.endStyle&&t.to==q&&(i+=" "+u.endStyle),u.title&&!k&&(k=u.title),u.collapsed&&(!l||0>Vd(l.marker,u))&&(l=t)):t.from>n&&q>t.from&&(q=t.from),"bookmark"==u.type&&t.from==n&&u.widgetNode&&r.push(u)}if(l&&(l.from||0)==n&&(xe(b,(null==l.to?m+1:l.to)-n,l.marker,null==l.from),null==l.to))return;if(!l&&r.length)for(var s=0;r.length>s;++s)xe(b,0,r[s])}if(n>=m)break;for(var v=Math.min(m,q);;){if(p){var w=n+p.length;if(!l){var x=w>v?p.slice(0,v-n):p;b.addToken(b,x,g?g+h:h,j,n+x.length==q?i:"",k)}if(w>=v){p=p.slice(v-n),n=v;break}n=w,j=""}p=e.slice(f,f=c[o++]),g=re(c[o++],b.cm.options)}}else for(var o=1;c.length>o;o+=2)b.addToken(b,e.slice(f,f=c[o]),re(c[o+1],b.cm.options))}function ze(a,b){return 0==b.from.ch&&0==b.to.ch&&""==nf(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Ae(a,b,c,d){function e(a){return c?c[a]:null}function f(a,c,e){he(a,c,e,d),df(a,"change",a,b)}var g=b.from,h=b.to,i=b.text,j=Fe(a,g.line),k=Fe(a,h.line),l=nf(i),m=e(i.length-1),n=h.line-g.line;if(ze(a,b)){for(var o=0,p=[];i.length-1>o;++o)p.push(new $g(i[o],e(o),d));f(k,k.text,m),n&&a.remove(g.line,n),p.length&&a.insert(g.line,p)}else if(j==k)if(1==i.length)f(j,j.text.slice(0,g.ch)+l+j.text.slice(h.ch),m);else{for(var p=[],o=1;i.length-1>o;++o)p.push(new $g(i[o],e(o),d));p.push(new $g(l+j.text.slice(h.ch),m,d)),f(j,j.text.slice(0,g.ch)+i[0],e(0)),a.insert(g.line+1,p)}else if(1==i.length)f(j,j.text.slice(0,g.ch)+i[0]+k.text.slice(h.ch),e(0)),a.remove(g.line+1,n);else{f(j,j.text.slice(0,g.ch)+i[0],e(0)),f(k,l+k.text.slice(h.ch),m);for(var o=1,p=[];i.length-1>o;++o)p.push(new $g(i[o],e(o),d));n>1&&a.remove(g.line+1,n-1),a.insert(g.line+1,p)}df(a,"change",a,b)}function Be(a){this.lines=a,this.parent=null;for(var b=0,c=0;a.length>b;++b)a[b].parent=this,c+=a[b].height;this.height=c}function Ce(a){this.children=a;for(var b=0,c=0,d=0;a.length>d;++d){var e=a[d];b+=e.chunkSize(),c+=e.height,e.parent=this}this.size=b,this.height=c,this.parent=null}function De(a,b,c){function d(a,e,f){if(a.linked)for(var g=0;a.linked.length>g;++g){var h=a.linked[g];if(h.doc!=e){var i=f&&h.sharedHist;(!c||i)&&(b(h.doc,i),d(h.doc,a,i))}}}d(a,null,!0)}function Ee(a,b){if(b.cm)throw new Error("This document is already in use.");a.doc=b,b.cm=a,g(a),c(a),a.options.lineWrapping||m(a),a.options.mode=b.modeOption,nc(a)}function Fe(a,b){if(b-=a.first,0>b||b>=a.size)throw new Error("There is no line "+(b+a.first)+" in the document.");for(var c=a;!c.lines;)for(var d=0;;++d){var e=c.children[d],f=e.chunkSize();if(f>b){c=e;break}b-=f}return c.lines[b]}function Ge(a,b,c){var d=[],e=b.line;return a.iter(b.line,c.line+1,function(a){var f=a.text;e==c.line&&(f=f.slice(0,c.ch)),e==b.line&&(f=f.slice(b.ch)),d.push(f),++e}),d}function He(a,b,c){var d=[];return a.iter(b,c,function(a){d.push(a.text)}),d}function Ie(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function Je(a){if(null==a.parent)return null;for(var b=a.parent,c=of(b.lines,a),d=b.parent;d;b=d,d=d.parent)for(var e=0;d.children[e]!=b;++e)c+=d.children[e].chunkSize();return c+b.first}function Ke(a,b){var c=a.first;a:do{for(var d=0;a.children.length>d;++d){var e=a.children[d],f=e.height;if(f>b){a=e;continue a}b-=f,c+=e.chunkSize()}return c}while(!a.lines);for(var d=0;a.lines.length>d;++d){var g=a.lines[d],h=g.height;if(h>b)break;b-=h}return c+d}function Le(a){a=$d(a);for(var b=0,c=a.parent,d=0;c.lines.length>d;++d){var e=c.lines[d];if(e==a)break;b+=e.height}for(var f=c.parent;f;c=f,f=c.parent)for(var d=0;f.children.length>d;++d){var g=f.children[d];if(g==c)break;b+=g.height}return b}function Me(a){var b=a.order;return null==b&&(b=a.order=Lh(a.text)),b}function Ne(a){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=a||1}function Oe(a,b){var c={from:S(b.from),to:Fg(b),text:Ge(a,b.from,b.to)};return Ve(a,c,b.from.line,b.to.line+1),De(a,function(a){Ve(a,c,b.from.line,b.to.line+1)},!0),c}function Pe(a){for(;a.length;){var b=nf(a);if(!b.ranges)break;a.pop()}}function Qe(a,b){return b?(Pe(a.done),nf(a.done)):a.done.length&&!nf(a.done).ranges?nf(a.done):a.done.length>1&&!a.done[a.done.length-2].ranges?(a.done.pop(),nf(a.done)):void 0}function Re(a,b,c,d){var e=a.history;e.undone.length=0;var f,g=+new Date;if((e.lastOp==d||e.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&e.lastModTime>g-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))&&(f=Qe(e,e.lastOp==d))){var h=nf(f.changes);0==sg(b.from,b.to)&&0==sg(b.from,h.to)?h.to=Fg(b):f.changes.push(Oe(a,b))}else{var i=nf(e.done);for(i&&i.ranges||Ue(a.sel,e.done),f={changes:[Oe(a,b)],generation:e.generation},e.done.push(f);e.done.length>e.undoDepth;)e.done.shift(),e.done[0].ranges||e.done.shift()}e.done.push(c),e.generation=++e.maxGeneration,e.lastModTime=e.lastSelTime=g,e.lastOp=e.lastSelOp=d,e.lastOrigin=e.lastSelOrigin=b.origin,h||kh(a,"historyAdded")}function Se(a,b,c,d){var e=b.charAt(0);return"*"==e||"+"==e&&c.ranges.length==d.ranges.length&&c.somethingSelected()==d.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}function Te(a,b,c,d){var e=a.history,f=d&&d.origin;c==e.lastSelOp||f&&e.lastSelOrigin==f&&(e.lastModTime==e.lastSelTime&&e.lastOrigin==f||Se(a,f,nf(e.done),b))?e.done[e.done.length-1]=b:Ue(b,e.done),e.lastSelTime=+new Date,e.lastSelOrigin=f,e.lastSelOp=c,d&&d.clearRedo!==!1&&Pe(e.undone)}function Ue(a,b){var c=nf(b);c&&c.ranges&&c.equals(a)||b.push(a)}function Ve(a,b,c,d){var e=b["spans_"+a.id],f=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[f]=c.markedSpans),++f})}function We(a){if(!a)return null;for(var b,c=0;a.length>c;++c)a[c].marker.explicitlyCleared?b||(b=a.slice(0,c)):b&&b.push(a[c]);return b?b.length?b:null:a}function Xe(a,b){var c=b["spans_"+a.id];if(!c)return null;for(var d=0,e=[];b.text.length>d;++d)e.push(We(c[d]));return e}function Ye(a,b,c){for(var d=0,e=[];a.length>d;++d){var f=a[d];if(f.ranges)e.push(c?V.prototype.deepCopy.call(f):f);else{var g=f.changes,h=[];e.push({changes:h});for(var i=0;g.length>i;++i){var j,k=g[i];if(h.push({from:k.from,to:k.to,text:k.text}),b)for(var l in k)(j=l.match(/^spans_(\d+)$/))&&of(b,Number(j[1]))>-1&&(nf(h)[l]=k[l],delete k[l])}}}return e}function Ze(a,b,c,d){a.line>c?a.line+=d:a.line>b&&(a.line=b,a.ch=0)}function $e(a,b,c,d){for(var e=0;a.length>e;++e){var f=a[e],g=!0;if(f.ranges){f.copied||(f=a[e]=f.deepCopy(),f.copied=!0);for(var h=0;f.ranges.length>h;h++)Ze(f.ranges[h].anchor,b,c,d),Ze(f.ranges[h].head,b,c,d)}else{for(var h=0;f.changes.length>h;++h){var i=f.changes[h];if(i.from.line>c)i.from=rg(i.from.line+d,i.from.ch),i.to=rg(i.to.line+d,i.to.ch);else if(i.to.line>=b){g=!1;break}}g||(a.splice(0,e+1),e=0)}}}function _e(a,b){var c=b.from.line,d=b.to.line,e=b.text.length-(d-c)-1;$e(a.done,c,d,e),$e(a.undone,c,d,e)}function af(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function bf(a){return a.target||a.srcElement}function cf(a){var b=a.which;return null==b&&(1&a.button?b=1:2&a.button?b=3:4&a.button&&(b=2)),kg&&a.ctrlKey&&1==b&&(b=3),b}function df(a,b){function c(a){return function(){a.apply(null,f)}}var d=a._handlers&&a._handlers[b];if(d){var e,f=Array.prototype.slice.call(arguments,2);xg?e=xg.delayedCallbacks:lh?e=lh:(e=lh=[],setTimeout(ef,0));for(var g=0;d.length>g;++g)e.push(c(d[g]))}}function ef(){var a=lh;lh=null;for(var b=0;a.length>b;++b)a[b]()}function ff(a,b,c){return"string"==typeof b&&(b={type:b,preventDefault:function(){this.defaultPrevented=!0}}),kh(a,c||b.type,a,b),af(b)||b.codemirrorIgnore}function gf(a){var b=a._handlers&&a._handlers.cursorActivity;if(b)for(var c=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]),d=0;b.length>d;++d)-1==of(c,b[d])&&c.push(b[d])}function hf(a,b){var c=a._handlers&&a._handlers[b];return c&&c.length>0}function jf(a){a.prototype.on=function(a,b){ih(this,a,b)},a.prototype.off=function(a,b){jh(this,a,b)}}function kf(){this.id=null}function lf(a,b,c){for(var d=0,e=0;;){var f=a.indexOf("	",d);-1==f&&(f=a.length);var g=f-d;if(f==a.length||e+g>=b)return d+Math.min(g,b-e);if(e+=f-d,e+=c-e%c,d=f+1,e>=b)return d}}function mf(a){for(;a>=sh.length;)sh.push(nf(sh)+" ");return sh[a]}function nf(a){return a[a.length-1]}function of(a,b){for(var c=0;a.length>c;++c)if(a[c]==b)return c;return-1}function pf(a,b){for(var c=[],d=0;a.length>d;d++)c[d]=b(a[d],d);return c}function qf(a,b){var c;if(Object.create)c=Object.create(a);else{var d=function(){};d.prototype=a,c=new d}return b&&rf(b,c),c}function rf(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||c===!1&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function sf(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function tf(a,b){return b?b.source.indexOf("\\w")>-1&&wh(a)?!0:b.test(a):wh(a)}function uf(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function vf(a){return a.charCodeAt(0)>=768&&xh.test(a)}function wf(a,b,c,d){var e=document.createElement(a);if(c&&(e.className=c),d&&(e.style.cssText=d),"string"==typeof b)e.appendChild(document.createTextNode(b));else if(b)for(var f=0;b.length>f;++f)e.appendChild(b[f]);return e}function xf(a){for(var b=a.childNodes.length;b>0;--b)a.removeChild(a.firstChild);return a}function yf(a,b){return xf(a).appendChild(b)}function zf(a,b){if(a.contains)return a.contains(b);for(;b=b.parentNode;)if(b==a)return!0}function Af(){return document.activeElement}function Bf(a){return new RegExp("(?:^|\\s)"+a+"(?:$|\\s)\\s*")}function Cf(a,b){for(var c=a.split(" "),d=0;c.length>d;d++)c[d]&&!Bf(c[d]).test(b)&&(b+=" "+c[d]);return b}function Df(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;b.length>c;c++){var d=b[c].CodeMirror;d&&a(d)}}function Ef(){Dh||(Ff(),Dh=!0)}function Ff(){var a;ih(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null,yh=null,Df(Cc)},100))}),ih(window,"blur",function(){Df($c)})}function Gf(a){if(null!=yh)return yh;var b=wf("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return yf(a,b),b.offsetWidth&&(yh=b.offsetHeight-b.clientHeight),yh||0}function Hf(a){if(null==zh){var b=wf("span","\u200b");yf(a,wf("span",[b,document.createTextNode("x")])),0!=a.firstChild.offsetHeight&&(zh=1>=b.offsetWidth&&b.offsetHeight>2&&!($f&&8>_f))}return zh?wf("span","\u200b"):wf("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px")}function If(a){if(null!=Ah)return Ah;var b=yf(a,document.createTextNode("A\u062eA")),c=uh(b,0,1).getBoundingClientRect();if(!c||c.left==c.right)return!1;var d=uh(b,1,2).getBoundingClientRect();return Ah=3>d.right-c.right}function Jf(a){if(null!=Ih)return Ih;var b=yf(a,wf("span","x")),c=b.getBoundingClientRect(),d=uh(b,0,1).getBoundingClientRect();return Ih=Math.abs(c.left-d.left)>1}function Kf(a,b,c,d){if(!a)return d(b,c,"ltr");for(var e=!1,f=0;a.length>f;++f){var g=a[f];(c>g.from&&g.to>b||b==c&&g.to==b)&&(d(Math.max(g.from,b),Math.min(g.to,c),1==g.level?"rtl":"ltr"),e=!0)}e||d(b,c,"ltr")}function Lf(a){return a.level%2?a.to:a.from}function Mf(a){return a.level%2?a.from:a.to}function Nf(a){var b=Me(a);return b?Lf(b[0]):0}function Of(a){var b=Me(a);return b?Mf(nf(b)):a.text.length}function Pf(a,b){var c=Fe(a.doc,b),d=$d(c);d!=c&&(b=Je(d));var e=Me(d),f=e?e[0].level%2?Of(d):Nf(d):0;return rg(b,f)}function Qf(a,b){for(var c,d=Fe(a.doc,b);c=Yd(d);)d=c.find(1,!0).line,b=null;var e=Me(d),f=e?e[0].level%2?Nf(d):Of(d):d.text.length;return rg(null==b?Je(d):b,f)}function Rf(a,b){var c=Pf(a,b.line),d=Fe(a.doc,c.line),e=Me(d);if(!e||0==e[0].level){var f=Math.max(0,d.text.search(/\S/)),g=b.line==c.line&&f>=b.ch&&b.ch;return rg(c.line,g?0:f)}return c}function Sf(a,b,c){var d=a[0].level;return b==d?!0:c==d?!1:c>b}function Tf(a,b){Kh=null;for(var c,d=0;a.length>d;++d){var e=a[d];if(b>e.from&&e.to>b)return d;if(e.from==b||e.to==b){if(null!=c)return Sf(a,e.level,a[c].level)?(e.from!=e.to&&(Kh=c),d):(e.from!=e.to&&(Kh=d),c);c=d}}return c}function Uf(a,b,c,d){if(!d)return b+c;do b+=c;while(b>0&&vf(a.text.charAt(b)));return b}function Vf(a,b,c,d){var e=Me(a);if(!e)return Wf(a,b,c,d);for(var f=Tf(e,b),g=e[f],h=Uf(a,b,g.level%2?-c:c,d);;){if(h>g.from&&g.to>h)return h;if(h==g.from||h==g.to)return Tf(e,h)==f?h:(g=e[f+=c],c>0==g.level%2?g.to:g.from);if(g=e[f+=c],!g)return null;h=c>0==g.level%2?Uf(a,g.to,-1,d):Uf(a,g.from,1,d)}}function Wf(a,b,c,d){var e=b+c;if(d)for(;e>0&&vf(a.text.charAt(e));)e+=c;return 0>e||e>a.text.length?null:e}var Xf=/gecko\/\d/i.test(navigator.userAgent),Yf=/MSIE \d/.test(navigator.userAgent),Zf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),$f=Yf||Zf,_f=$f&&(Yf?document.documentMode||6:Zf[1]),ag=/WebKit\//.test(navigator.userAgent),bg=ag&&/Qt\/\d+\.\d+/.test(navigator.userAgent),cg=/Chrome\//.test(navigator.userAgent),dg=/Opera\//.test(navigator.userAgent),eg=/Apple Computer/.test(navigator.vendor),fg=/KHTML\//.test(navigator.userAgent),gg=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),hg=/PhantomJS/.test(navigator.userAgent),ig=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),jg=ig||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),kg=ig||/Mac/.test(navigator.platform),lg=/win/i.test(navigator.platform),mg=dg&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);mg&&(mg=Number(mg[1])),mg&&mg>=15&&(dg=!1,ag=!0);var ng=kg&&(bg||dg&&(null==mg||12.11>mg)),og=Xf||$f&&_f>=9,pg=!1,qg=!1,rg=a.Pos=function(a,b){return this instanceof rg?(this.line=a,this.ch=b,void 0):new rg(a,b)},sg=a.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch};V.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;this.ranges.length>b;b++){var c=this.ranges[b],d=a.ranges[b];if(0!=sg(c.anchor,d.anchor)||0!=sg(c.head,d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;this.ranges.length>b;b++)a[b]=new W(S(this.ranges[b].anchor),S(this.ranges[b].head));return new V(a,this.primIndex)},somethingSelected:function(){for(var a=0;this.ranges.length>a;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;this.ranges.length>c;c++){var d=this.ranges[c];if(sg(b,d.from())>=0&&0>=sg(a,d.to()))return c}return-1}},W.prototype={from:function(){return U(this.anchor,this.head)},to:function(){return T(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var tg,ug,vg,wg={left:0,right:0,top:0,bottom:0},xg=null,yg=0,zg=null,Ag=0,Bg=0,Cg=null;$f?Cg=-.53:Xf?Cg=15:cg?Cg=-.7:eg&&(Cg=-1/3);var Dg=new kf,Eg=null,Fg=a.changeEnd=function(a){return a.text?rg(a.from.line+a.text.length-1,nf(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};a.prototype={constructor:a,focus:function(){window.focus(),yc(this),vc(this)},setOption:function(a,b){var c=this.options,d=c[a];(c[a]!=b||"mode"==a)&&(c[a]=b,Hg.hasOwnProperty(a)&&ic(this,Hg[a])(this,b,d))},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](Bd(a))},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;b.length>c;++c)if(b[c]==a||b[c].name==a)return b.splice(c,1),!0},addOverlay:jc(function(b,c){var d=b.token?b:a.getMode(this.options,b);if(d.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:d,modeSpec:b,opaque:c&&c.opaque}),this.state.modeGen++,nc(this)}),removeOverlay:jc(function(a){for(var b=this.state.overlays,c=0;b.length>c;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a)return b.splice(c,1),this.state.modeGen++,nc(this),void 0}}),indentLine:jc(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract"),ab(this.doc,a)&&ud(this,a,b,c)}),indentSelection:jc(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;b.length>d;d++){var e=b[d];if(e.empty())e.head.line>c&&(ud(this,e.head.line,a,!0),c=e.head.line,d==this.doc.sel.primIndex&&sd(this));else{var f=e.from(),g=e.to(),h=Math.max(c,f.line);c=Math.min(this.lastLine(),g.line-(g.ch?0:1))+1;for(var i=h;c>i;++i)ud(this,i,a);var j=this.doc.sel.ranges;0==f.ch&&b.length==j.length&&j[d].from().ch>0&&fb(this.doc,d,new W(f,j[d].to()),oh)}}}),getTokenAt:function(a,b){return me(this,a,b)},getLineTokens:function(a,b){return me(this,rg(a),b,!0)},getTokenTypeAt:function(a){a=$(this.doc,a);var b,c=pe(this,Fe(this.doc,a.line)),d=0,e=(c.length-1)/2,f=a.ch;if(0==f)b=c[2];else for(;;){var g=d+e>>1;if((g?c[2*g-1]:0)>=f)e=g;else{if(!(f>c[2*g+1])){b=c[2*g+2];break}d=g+1}}var h=b?b.indexOf("cm-overlay "):-1;return 0>h?b:0==h?null:b.slice(0,h-1)},getModeAt:function(b){var c=this.doc.mode;return c.innerMode?a.innerMode(c,this.getTokenAt(b).state).mode:c},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!Ng.hasOwnProperty(b))return Ng;var d=Ng[b],e=this.getModeAt(a);if("string"==typeof e[b])d[e[b]]&&c.push(d[e[b]]);else if(e[b])for(var f=0;e[b].length>f;f++){var g=d[e[b][f]];g&&c.push(g)}else e.helperType&&d[e.helperType]?c.push(d[e.helperType]):d[e.name]&&c.push(d[e.name]);for(var f=0;d._global.length>f;f++){var h=d._global[f];h.pred(e,this)&&-1==of(c,h.val)&&c.push(h.val)}return c},getStateAfter:function(a,b){var c=this.doc;return a=Z(c,null==a?c.first+c.size-1:a),yb(this,a+1,b)},cursorCoords:function(a,b){var c,d=this.doc.sel.primary();return c=null==a?d.head:"object"==typeof a?$(this.doc,a):a?d.from():d.to(),Tb(this,c,b||"page")},charCoords:function(a,b){return Sb(this,$(this.doc,a),b||"page")},coordsChar:function(a,b){return a=Rb(this,a,b||"page"),Wb(this,a.left,a.top)},lineAtHeight:function(a,b){return a=Rb(this,{top:a,left:0},b||"page").top,Ke(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1,d=this.doc.first+this.doc.size-1;this.doc.first>a?a=this.doc.first:a>d&&(a=d,c=!0);var e=Fe(this.doc,a);return Qb(this,e,{top:0,left:0},b||"page").top+(c?this.doc.height-Le(e):0)},defaultTextHeight:function(){return Yb(this.display)},defaultCharWidth:function(){return Zb(this.display)},setGutterMarker:jc(function(a,b,c){return vd(this.doc,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});return d[b]=c,!c&&uf(d)&&(a.gutterMarkers=null),!0})}),clearGutter:jc(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,oc(b,d,"gutter"),uf(c.gutterMarkers)&&(c.gutterMarkers=null)),++d})}),addLineWidget:jc(function(a,b,c){return ge(this,a,b,c)}),removeLineWidget:function(a){a.clear()},lineInfo:function(a){if("number"==typeof a){if(!ab(this.doc,a))return null;var b=a;if(a=Fe(this.doc,a),!a)return null}else{var b=Je(a);if(null==b)return null}return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,e){var f=this.display;a=Tb(this,$(this.doc,a));var g=a.bottom,h=a.left;if(b.style.position="absolute",f.sizer.appendChild(b),"over"==d)g=a.top;else if("above"==d||"near"==d){var i=Math.max(f.wrapper.clientHeight,this.doc.height),j=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);
("above"==d||a.bottom+b.offsetHeight>i)&&a.top>b.offsetHeight?g=a.top-b.offsetHeight:i>=a.bottom+b.offsetHeight&&(g=a.bottom),h+b.offsetWidth>j&&(h=j-b.offsetWidth)}b.style.top=g+"px",b.style.left=b.style.right="","right"==e?(h=f.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?h=0:"middle"==e&&(h=(f.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px"),c&&pd(this,h,g,h+b.offsetWidth,g+b.offsetHeight)},triggerOnKeyDown:jc(Vc),triggerOnKeyPress:jc(Yc),triggerOnKeyUp:Xc,execCommand:function(a){return Qg.hasOwnProperty(a)?Qg[a](this):void 0},findPosH:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);for(var f=0,g=$(this.doc,a);b>f&&(g=xd(this.doc,g,e,c,d),!g.hitSide);++f);return g},moveH:jc(function(a,b){var c=this;c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?xd(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},qh)}),deleteH:jc(function(a,b){var c=this.doc.sel,d=this.doc;c.somethingSelected()?d.replaceSelection("",null,"+delete"):wd(this,function(c){var e=xd(d,c.head,a,b,!1);return 0>a?{from:e,to:c.head}:{from:c.head,to:e}})}),findPosV:function(a,b,c,d){var e=1,f=d;0>b&&(e=-1,b=-b);for(var g=0,h=$(this.doc,a);b>g;++g){var i=Tb(this,h,"div");if(null==f?f=i.left:i.left=f,h=yd(this,i,e,c),h.hitSide)break}return h},moveV:jc(function(a,b){var c=this,d=this.doc,e=[],f=!c.display.shift&&!d.extend&&d.sel.somethingSelected();if(d.extendSelectionsBy(function(g){if(f)return 0>a?g.from():g.to();var h=Tb(c,g.head,"div");null!=g.goalColumn&&(h.left=g.goalColumn),e.push(h.left);var i=yd(c,h,a,b);return"page"==b&&g==d.sel.primary()&&rd(c,null,Sb(c,i,"div").top-h.top),i},qh),e.length)for(var g=0;d.sel.ranges.length>g;g++)d.sel.ranges[g].goalColumn=e[g]}),findWordAt:function(a){var b=this.doc,c=Fe(b,a.line).text,d=a.ch,e=a.ch;if(c){var f=this.getHelper(a,"wordChars");(0>a.xRel||e==c.length)&&d?--d:++e;for(var g=c.charAt(d),h=tf(g,f)?function(a){return tf(a,f)}:/\s/.test(g)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!tf(a)};d>0&&h(c.charAt(d-1));)--d;for(;c.length>e&&h(c.charAt(e));)++e}return new W(rg(a.line,d),rg(a.line,e))},toggleOverwrite:function(a){(null==a||a!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?Ch(this.display.cursorDiv,"CodeMirror-overwrite"):Bh(this.display.cursorDiv,"CodeMirror-overwrite"),kh(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return Af()==this.display.input},scrollTo:jc(function(a,b){(null!=a||null!=b)&&td(this),null!=a&&(this.curOp.scrollLeft=a),null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller,b=mh;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-b,width:a.scrollWidth-b,clientHeight:a.clientHeight-b,clientWidth:a.clientWidth-b}},scrollIntoView:jc(function(a,b){if(null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:rg(a,0),to:null}:null==a.from&&(a={from:a,to:null}),a.to||(a.to=a.from),a.margin=b||0,null!=a.from.line)td(this),this.curOp.scrollToPos=a;else{var c=qd(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin);this.scrollTo(c.scrollLeft,c.scrollTop)}}),setSize:jc(function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}var d=this;null!=a&&(d.display.wrapper.style.width=c(a)),null!=b&&(d.display.wrapper.style.height=c(b)),d.options.lineWrapping&&Mb(this);var e=d.display.viewFrom;d.doc.iter(e,d.display.viewTo,function(a){if(a.widgets)for(var b=0;a.widgets.length>b;b++)if(a.widgets[b].noHScroll){oc(d,e,"widget");break}++e}),d.curOp.forceUpdate=!0,kh(d,"refresh",this)}),operation:function(a){return hc(this,a)},refresh:jc(function(){var a=this.display.cachedTextHeight;nc(this),this.curOp.forceUpdate=!0,Nb(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),k(this),(null==a||Math.abs(a-Yb(this.display))>.5)&&g(this),kh(this,"refresh",this)}),swapDoc:jc(function(a){var b=this.doc;return b.cm=null,Ee(this,a),Nb(this),xc(this),this.scrollTo(a.scrollLeft,a.scrollTop),this.curOp.forceScroll=!0,df(this,"swapDoc",this,b),b}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},jf(a);var Gg=a.defaults={},Hg=a.optionHandlers={},Ig=a.Init={toString:function(){return"CodeMirror.Init"}};zd("value","",function(a,b){a.setValue(b)},!0),zd("mode",null,function(a,b){a.doc.modeOption=b,c(a)},!0),zd("indentUnit",2,c,!0),zd("indentWithTabs",!1),zd("smartIndent",!0),zd("tabSize",4,function(a){d(a),Nb(a),nc(a)},!0),zd("specialChars",/[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b){a.options.specialChars=new RegExp(b.source+(b.test("	")?"":"|	"),"g"),a.refresh()},!0),zd("specialCharPlaceholder",te,function(a){a.refresh()},!0),zd("electricChars",!0),zd("rtlMoveVisually",!lg),zd("wholeLineUpdateBefore",!0),zd("theme","default",function(a){h(a),i(a)},!0),zd("keyMap","default",function(b,c,d){var e=Bd(c),f=d!=a.Init&&Bd(d);f&&f.detach&&f.detach(b,e),e.attach&&e.attach(b,f||null)}),zd("extraKeys",null),zd("lineWrapping",!1,e,!0),zd("gutters",[],function(a){n(a.options),i(a)},!0),zd("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?v(a.display)+"px":"0",a.refresh()},!0),zd("coverGutterNextToScrollbar",!1,q,!0),zd("lineNumbers",!1,function(a){n(a.options),i(a)},!0),zd("firstLineNumber",1,i,!0),zd("lineNumberFormatter",function(a){return a},i,!0),zd("showCursorWhenSelecting",!1,rb,!0),zd("resetSelectionOnContextMenu",!0),zd("readOnly",!1,function(a,b){"nocursor"==b?($c(a),a.display.input.blur(),a.display.disabled=!0):(a.display.disabled=!1,b||xc(a))}),zd("disableInput",!1,function(a,b){b||xc(a)},!0),zd("dragDrop",!0),zd("cursorBlinkRate",530),zd("cursorScrollMargin",0),zd("cursorHeight",1,rb,!0),zd("singleCursorHeightPerLine",!0,rb,!0),zd("workTime",100),zd("workDelay",100),zd("flattenSpans",!0,d,!0),zd("addModeClass",!1,d,!0),zd("pollInterval",100),zd("undoDepth",200,function(a,b){a.doc.history.undoDepth=b}),zd("historyEventDelay",1250),zd("viewportMargin",10,function(a){a.refresh()},!0),zd("maxHighlightLength",1e4,d,!0),zd("moveInputWithCursor",!0,function(a,b){b||(a.display.inputDiv.style.top=a.display.inputDiv.style.left=0)}),zd("tabindex",null,function(a,b){a.display.input.tabIndex=b||""}),zd("autofocus",null);var Jg=a.modes={},Kg=a.mimeModes={};a.defineMode=function(b,c){a.defaults.mode||"null"==b||(a.defaults.mode=b),arguments.length>2&&(c.dependencies=Array.prototype.slice.call(arguments,2)),Jg[b]=c},a.defineMIME=function(a,b){Kg[a]=b},a.resolveMode=function(b){if("string"==typeof b&&Kg.hasOwnProperty(b))b=Kg[b];else if(b&&"string"==typeof b.name&&Kg.hasOwnProperty(b.name)){var c=Kg[b.name];"string"==typeof c&&(c={name:c}),b=qf(c,b),b.name=c.name}else if("string"==typeof b&&/^[\w\-]+\/[\w\-]+\+xml$/.test(b))return a.resolveMode("application/xml");return"string"==typeof b?{name:b}:b||{name:"null"}},a.getMode=function(b,c){var c=a.resolveMode(c),d=Jg[c.name];if(!d)return a.getMode(b,"text/plain");var e=d(b,c);if(Lg.hasOwnProperty(c.name)){var f=Lg[c.name];for(var g in f)f.hasOwnProperty(g)&&(e.hasOwnProperty(g)&&(e["_"+g]=e[g]),e[g]=f[g])}if(e.name=c.name,c.helperType&&(e.helperType=c.helperType),c.modeProps)for(var g in c.modeProps)e[g]=c.modeProps[g];return e},a.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}}),a.defineMIME("text/plain","null");var Lg=a.modeExtensions={};a.extendMode=function(a,b){var c=Lg.hasOwnProperty(a)?Lg[a]:Lg[a]={};rf(b,c)},a.defineExtension=function(b,c){a.prototype[b]=c},a.defineDocExtension=function(a,b){ch.prototype[a]=b},a.defineOption=zd;var Mg=[];a.defineInitHook=function(a){Mg.push(a)};var Ng=a.helpers={};a.registerHelper=function(b,c,d){Ng.hasOwnProperty(b)||(Ng[b]=a[b]={_global:[]}),Ng[b][c]=d},a.registerGlobalHelper=function(b,c,d,e){a.registerHelper(b,c,e),Ng[b]._global.push({pred:d,val:e})};var Og=a.copyState=function(a,b){if(b===!0)return b;if(a.copyState)return a.copyState(b);var c={};for(var d in b){var e=b[d];e instanceof Array&&(e=e.concat([])),c[d]=e}return c},Pg=a.startState=function(a,b,c){return a.startState?a.startState(b,c):!0};a.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state,a=c.mode}return c||{mode:a,state:b}};var Qg=a.commands={selectAll:function(a){a.setSelection(rg(a.firstLine(),0),rg(a.lastLine()),oh)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),oh)},killLine:function(a){wd(a,function(b){if(b.empty()){var c=Fe(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:rg(b.head.line+1,0)}:{from:b.head,to:rg(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){wd(a,function(b){return{from:rg(b.from().line,0),to:$(a.doc,rg(b.to().line+1,0))}})},delLineLeft:function(a){wd(a,function(a){return{from:rg(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){wd(a,function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:0,top:c},"div");return{from:d,to:b.from()}})},delWrappedLineRight:function(a){wd(a,function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:d}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(rg(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(rg(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return Pf(a,b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return Rf(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){return Qf(a,b.head.line)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div")},qh)},goLineLeft:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:c},"div")},qh)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:0,top:c},"div");return d.ch<a.getLine(d.line).search(/\S/)?Rf(a,b.head):d},qh)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("	")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,e=0;c.length>e;e++){var f=c[e].from(),g=rh(a.getLine(f.line),f.ch,d);b.push(new Array(d-g%d+1).join(" "))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){hc(a,function(){for(var b=a.listSelections(),c=[],d=0;b.length>d;d++){var e=b[d].head,f=Fe(a.doc,e.line).text;if(f)if(e.ch==f.length&&(e=new rg(e.line,e.ch-1)),e.ch>0)e=new rg(e.line,e.ch+1),a.replaceRange(f.charAt(e.ch-1)+f.charAt(e.ch-2),rg(e.line,e.ch-2),e,"+transpose");else if(e.line>a.doc.first){var g=Fe(a.doc,e.line-1).text;g&&a.replaceRange(f.charAt(0)+"\n"+g.charAt(g.length-1),rg(e.line-1,g.length-1),rg(e.line,1),"+transpose")}c.push(new W(e,e))}a.setSelections(c)})},newlineAndIndent:function(a){hc(a,function(){for(var b=a.listSelections().length,c=0;b>c;c++){var d=a.listSelections()[c];a.replaceRange("\n",d.anchor,d.head,"+input"),a.indentLine(d.from().line+1,null,!0),sd(a)}})},toggleOverwrite:function(a){a.toggleOverwrite()}},Rg=a.keyMap={};Rg.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Rg.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Rg.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},Rg.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Rg["default"]=kg?Rg.macDefault:Rg.pcDefault,a.normalizeKeyMap=function(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if(/^(name|fallthrough|(de|at)tach)$/.test(c))continue;if("..."==d){delete a[c];continue}for(var e=pf(c.split(" "),Ad),f=0;e.length>f;f++){var g,h;f==e.length-1?(h=c,g=d):(h=e.slice(0,f+1).join(" "),g="...");var i=b[h];if(i){if(i!=g)throw new Error("Inconsistent bindings for "+h)}else b[h]=g}delete a[c]}for(var j in b)a[j]=b[j];return a};var Sg=a.lookupKey=function(a,b,c){b=Bd(b);var d=b.call?b.call(a):b[a];if(d===!1)return"nothing";if("..."===d)return"multi";if(null!=d&&c(d))return"handled";if(b.fallthrough){if("[object Array]"!=Object.prototype.toString.call(b.fallthrough))return Sg(a,b.fallthrough,c);for(var e=0;b.fallthrough.length>e;e++){var f=Sg(a,b.fallthrough[e],c);if(f)return f}}},Tg=a.isModifierKey=function(a){var b="string"==typeof a?a:Jh[a.keyCode];return"Ctrl"==b||"Alt"==b||"Shift"==b||"Mod"==b},Ug=a.keyName=function(a,b){if(dg&&34==a.keyCode&&a["char"])return!1;var c=Jh[a.keyCode],d=c;return null==d||a.altGraphKey?!1:(a.altKey&&"Alt"!=c&&(d="Alt-"+d),(ng?a.metaKey:a.ctrlKey)&&"Ctrl"!=c&&(d="Ctrl-"+d),(ng?a.ctrlKey:a.metaKey)&&"Cmd"!=c&&(d="Cmd-"+d),!b&&a.shiftKey&&"Shift"!=c&&(d="Shift-"+d),d)};a.fromTextArea=function(b,c){function d(){b.value=j.getValue()}if(c||(c={}),c.value=b.value,!c.tabindex&&b.tabindex&&(c.tabindex=b.tabindex),!c.placeholder&&b.placeholder&&(c.placeholder=b.placeholder),null==c.autofocus){var e=Af();c.autofocus=e==b||null!=b.getAttribute("autofocus")&&e==document.body}if(b.form&&(ih(b.form,"submit",d),!c.leaveSubmitMethodAlone)){var f=b.form,g=f.submit;try{var h=f.submit=function(){d(),f.submit=g,f.submit(),f.submit=h}}catch(i){}}b.style.display="none";var j=a(function(a){b.parentNode.insertBefore(a,b.nextSibling)},c);return j.save=d,j.getTextArea=function(){return b},j.toTextArea=function(){j.toTextArea=isNaN,d(),b.parentNode.removeChild(j.getWrapperElement()),b.style.display="",b.form&&(jh(b.form,"submit",d),"function"==typeof b.form.submit&&(b.form.submit=g))},j};var Vg=a.StringStream=function(a,b){this.pos=this.start=0,this.string=a,this.tabSize=b||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Vg.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(a){var b=this.string.charAt(this.pos);if("string"==typeof a)var c=b==a;else var c=b&&(a.test?a.test(b):a(b));return c?(++this.pos,b):void 0},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){var b=this.string.indexOf(a,this.pos);return b>-1?(this.pos=b,!0):void 0},backUp:function(a){this.pos-=a},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=rh(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?rh(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return rh(this.string,null,this.tabSize)-(this.lineStart?rh(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"!=typeof a){var d=this.string.slice(this.pos).match(a);return d&&d.index>0?null:(d&&b!==!1&&(this.pos+=d[0].length),d)}var e=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,a.length);return e(f)==e(a)?(b!==!1&&(this.pos+=a.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var Wg=a.TextMarker=function(a,b){this.lines=[],this.type=b,this.doc=a};jf(Wg),Wg.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;if(b&&$b(a),hf(this,"clear")){var c=this.find();c&&df(this,"clear",c.from,c.to)}for(var d=null,e=null,f=0;this.lines.length>f;++f){var g=this.lines[f],h=Id(g.markedSpans,this);a&&!this.collapsed?oc(a,Je(g),"text"):a&&(null!=h.to&&(e=Je(g)),null!=h.from&&(d=Je(g))),g.markedSpans=Jd(g.markedSpans,h),null==h.from&&this.collapsed&&!ce(this.doc,g)&&a&&Ie(g,Yb(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(var f=0;this.lines.length>f;++f){var i=$d(this.lines[f]),j=l(i);j>a.display.maxLineLength&&(a.display.maxLine=i,a.display.maxLineLength=j,a.display.maxLineChanged=!0)}null!=d&&a&&this.collapsed&&nc(a,d,e+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&mb(a.doc)),a&&df(a,"markerCleared",a,this),b&&ac(a),this.parent&&this.parent.clear()}},Wg.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,e=0;this.lines.length>e;++e){var f=this.lines[e],g=Id(f.markedSpans,this);if(null!=g.from&&(c=rg(b?f:Je(f),g.from),-1==a))return c;if(null!=g.to&&(d=rg(b?f:Je(f),g.to),1==a))return d}return c&&{from:c,to:d}},Wg.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&hc(c,function(){var d=a.line,e=Je(a.line),f=Gb(c,e);if(f&&(Lb(f),c.curOp.selectionChanged=c.curOp.forceUpdate=!0),c.curOp.updateMaxLine=!0,!ce(b.doc,d)&&null!=b.height){var g=b.height;b.height=null;var h=fe(b)-g;h&&Ie(d,d.height+h)}})},Wg.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=of(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)},Wg.prototype.detachLine=function(a){if(this.lines.splice(of(this.lines,a),1),!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;(b.maybeHiddenMarkers||(b.maybeHiddenMarkers=[])).push(this)}};var Xg=0,Yg=a.SharedTextMarker=function(a,b){this.markers=a,this.primary=b;for(var c=0;a.length>c;++c)a[c].parent=this};jf(Yg),Yg.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;this.markers.length>a;++a)this.markers[a].clear();df(this,"clear")}},Yg.prototype.find=function(a,b){return this.primary.find(a,b)};var Zg=a.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.cm=a,this.node=b};jf(Zg),Zg.prototype.clear=function(){var a=this.cm,b=this.line.widgets,c=this.line,d=Je(c);if(null!=d&&b){for(var e=0;b.length>e;++e)b[e]==this&&b.splice(e--,1);b.length||(c.widgets=null);var f=fe(this);hc(a,function(){ee(a,c,-f),oc(a,d,"widget"),Ie(c,Math.max(0,c.height-f))})}},Zg.prototype.changed=function(){var a=this.height,b=this.cm,c=this.line;this.height=null;var d=fe(this)-a;d&&hc(b,function(){b.curOp.forceUpdate=!0,ee(b,c,d),Ie(c,c.height+d)})};var $g=a.Line=function(a,b,c){this.text=a,Sd(this,b),this.height=c?c(this):1};jf($g),$g.prototype.lineNo=function(){return Je(this)};var _g={},ah={};Be.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;d>c;++c){var e=this.lines[c];this.height-=e.height,ie(e),df(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c,this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(var d=0;b.length>d;++d)b[d].parent=this},iterN:function(a,b,c){for(var d=a+b;d>a;++a)if(c(this.lines[a]))return!0}},Ce.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;this.children.length>c;++c){var d=this.children[c],e=d.chunkSize();if(e>a){var f=Math.min(b,e-a),g=d.height;if(d.removeInner(a,f),this.height-=g-d.height,e==f&&(this.children.splice(c--,1),d.parent=null),0==(b-=f))break;a=0}else a-=e}if(25>this.size-b&&(this.children.length>1||!(this.children[0]instanceof Be))){var h=[];this.collapse(h),this.children=[new Be(h)],this.children[0].parent=this}},collapse:function(a){for(var b=0;this.children.length>b;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length,this.height+=c;for(var d=0;this.children.length>d;++d){var e=this.children[d],f=e.chunkSize();if(f>=a){if(e.insertInner(a,b,c),e.lines&&e.lines.length>50){for(;e.lines.length>50;){var g=e.lines.splice(e.lines.length-25,25),h=new Be(g);e.height-=h.height,this.children.splice(d+1,0,h),h.parent=this}this.maybeSpill()}break}a-=f}},maybeSpill:function(){if(!(10>=this.children.length)){var a=this;do{var b=a.children.splice(a.children.length-5,5),c=new Ce(b);if(a.parent){a.size-=c.size,a.height-=c.height;var d=of(a.parent.children,a);a.parent.children.splice(d+1,0,c)}else{var e=new Ce(a.children);e.parent=a,a.children=[e,c],a=e}c.parent=a.parent}while(a.children.length>10);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0;this.children.length>d;++d){var e=this.children[d],f=e.chunkSize();if(f>a){var g=Math.min(b,f-a);if(e.iterN(a,g,c))return!0;if(0==(b-=g))break;a=0}else a-=f}}};var bh=0,ch=a.Doc=function(a,b,c){if(!(this instanceof ch))return new ch(a,b,c);null==c&&(c=0),Ce.call(this,[new Be([new $g("",null)])]),this.first=c,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=c;var d=rg(c,0);this.sel=Y(d),this.history=new Ne(null),this.id=++bh,this.modeOption=b,"string"==typeof a&&(a=Fh(a)),Ae(this,{from:d,to:d,text:a}),jb(this,Y(d),oh)};ch.prototype=qf(Ce.prototype,{constructor:ch,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;b.length>d;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=He(this,this.first,this.first+this.size);return a===!1?b:b.join(a||"\n")},setValue:kc(function(a){var b=rg(this.first,0),c=this.first+this.size-1;gd(this,{from:b,to:rg(c,Fe(this,c).text.length),text:Fh(a),origin:"setValue"},!0),jb(this,Y(b))}),replaceRange:function(a,b,c,d){b=$(this,b),c=c?$(this,c):b,md(this,a,b,c,d)},getRange:function(a,b,c){var d=Ge(this,$(this,a),$(this,b));return c===!1?d:d.join(c||"\n")},getLine:function(a){var b=this.getLineHandle(a);return b&&b.text},getLineHandle:function(a){return ab(this,a)?Fe(this,a):void 0},getLineNumber:function(a){return Je(a)},getLineHandleVisualStart:function(a){return"number"==typeof a&&(a=Fe(this,a)),$d(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return $(this,a)},getCursor:function(a){var b,c=this.sel.primary();return b=null==a||"head"==a?c.head:"anchor"==a?c.anchor:"end"==a||"to"==a||a===!1?c.to():c.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:kc(function(a,b,c){gb(this,$(this,"number"==typeof a?rg(a,b||0):a),null,c)}),setSelection:kc(function(a,b,c){gb(this,$(this,a),$(this,b||a),c)}),extendSelection:kc(function(a,b,c){db(this,$(this,a),b&&$(this,b),c)}),extendSelections:kc(function(a,b){eb(this,bb(this,a,b))}),extendSelectionsBy:kc(function(a,b){eb(this,pf(this.sel.ranges,a),b)}),setSelections:kc(function(a,b,c){if(a.length){for(var d=0,e=[];a.length>d;d++)e[d]=new W($(this,a[d].anchor),$(this,a[d].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex)),jb(this,X(e,b),c)}}),addSelection:kc(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new W($(this,a),$(this,b||a))),jb(this,X(d,d.length-1),c)}),getSelection:function(a){for(var b,c=this.sel.ranges,d=0;c.length>d;d++){var e=Ge(this,c[d].from(),c[d].to());b=b?b.concat(e):e}return a===!1?b:b.join(a||"\n")},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;c.length>d;d++){var e=Ge(this,c[d].from(),c[d].to());a!==!1&&(e=e.join(a||"\n")),b[d]=e}return b},replaceSelection:function(a,b,c){for(var d=[],e=0;this.sel.ranges.length>e;e++)d[e]=a;this.replaceSelections(d,b,c||"+input")},replaceSelections:kc(function(a,b,c){for(var d=[],e=this.sel,f=0;e.ranges.length>f;f++){var g=e.ranges[f];d[f]={from:g.from(),to:g.to(),text:Fh(a[f]),origin:c}}for(var h=b&&"end"!=b&&ed(this,d,b),f=d.length-1;f>=0;f--)gd(this,d[f]);h?ib(this,h):this.cm&&sd(this.cm)}),undo:kc(function(){id(this,"undo")}),redo:kc(function(){id(this,"redo")}),undoSelection:kc(function(){id(this,"undo",!0)}),redoSelection:kc(function(){id(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;a.done.length>d;d++)a.done[d].ranges||++b;for(var d=0;a.undone.length>d;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new Ne(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){return a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:Ye(this.history.done),undone:Ye(this.history.undone)}},setHistory:function(a){var b=this.history=new Ne(this.history.maxGeneration);b.done=Ye(a.done.slice(0),null,!0),b.undone=Ye(a.undone.slice(0),null,!0)},addLineClass:kc(function(a,b,c){return vd(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[d]){if(Bf(c).test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:kc(function(a,b,c){return vd(this,a,"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",e=a[d];if(!e)return!1;if(null==c)a[d]=null;else{var f=e.match(Bf(c));if(!f)return!1;var g=f.index+f[0].length;a[d]=e.slice(0,f.index)+(f.index&&g!=e.length?" ":"")+e.slice(g)||null}return!0})}),markText:function(a,b,c){return Cd(this,$(this,a),$(this,b),c,"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared};return a=$(this,a),Cd(this,a,a,c,"bookmark")},findMarksAt:function(a){a=$(this,a);var b=[],c=Fe(this,a.line).markedSpans;if(c)for(var d=0;c.length>d;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)}return b},findMarks:function(a,b,c){a=$(this,a),b=$(this,b);var d=[],e=a.line;return this.iter(a.line,b.line+1,function(f){var g=f.markedSpans;if(g)for(var h=0;g.length>h;h++){var i=g[h];e==a.line&&a.ch>i.to||null==i.from&&e!=a.line||e==b.line&&i.from>b.ch||c&&!c(i.marker)||d.push(i.marker.parent||i.marker)}++e}),d},getAllMarks:function(){var a=[];return this.iter(function(b){var c=b.markedSpans;if(c)for(var d=0;c.length>d;++d)null!=c[d].from&&a.push(c[d].marker)}),a},posFromIndex:function(a){var b,c=this.first;return this.iter(function(d){var e=d.text.length+1;return e>a?(b=a,!0):(a-=e,++c,void 0)}),$(this,rg(c,b))},indexFromPos:function(a){a=$(this,a);var b=a.ch;return a.line<this.first||0>a.ch?0:(this.iter(this.first,a.line,function(a){b+=a.text.length+1}),b)},copy:function(a){var b=new ch(He(this,this.first,this.first+this.size),this.modeOption,this.first);return b.scrollTop=this.scrollTop,b.scrollLeft=this.scrollLeft,b.sel=this.sel,b.extend=!1,a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory())),b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from),null!=a.to&&c>a.to&&(c=a.to);var d=new ch(He(this,b,c),a.mode||this.modeOption,b);return a.sharedHist&&(d.history=this.history),(this.linked||(this.linked=[])).push({doc:d,sharedHist:a.sharedHist}),d.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}],Fd(d,Ed(this)),d},unlinkDoc:function(b){if(b instanceof a&&(b=b.doc),this.linked)for(var c=0;this.linked.length>c;++c){var d=this.linked[c];if(d.doc==b){this.linked.splice(c,1),b.unlinkDoc(this),Gd(Ed(this));break}}if(b.history==this.history){var e=[b.id];De(b,function(a){e.push(a.id)},!0),b.history=new Ne(null),b.history.done=Ye(this.history.done,e),b.history.undone=Ye(this.history.undone,e)}},iterLinkedDocs:function(a){De(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),ch.prototype.eachLine=ch.prototype.iter;var dh="iter insert remove copy getEditor".split(" ");for(var eh in ch.prototype)ch.prototype.hasOwnProperty(eh)&&0>of(dh,eh)&&(a.prototype[eh]=function(a){return function(){return a.apply(this.doc,arguments)}}(ch.prototype[eh]));jf(ch);var fh=a.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},gh=a.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},hh=a.e_stop=function(a){fh(a),gh(a)},ih=a.on=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,c);else{var d=a._handlers||(a._handlers={}),e=d[b]||(d[b]=[]);e.push(c)}},jh=a.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else{var d=a._handlers&&a._handlers[b];if(!d)return;for(var e=0;d.length>e;++e)if(d[e]==c){d.splice(e,1);
break}}},kh=a.signal=function(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var d=Array.prototype.slice.call(arguments,2),e=0;c.length>e;++e)c[e].apply(null,d)},lh=null,mh=30,nh=a.Pass={toString:function(){return"CodeMirror.Pass"}},oh={scroll:!1},ph={origin:"*mouse"},qh={origin:"+move"};kf.prototype.set=function(a,b){clearTimeout(this.id),this.id=setTimeout(b,a)};var rh=a.countColumn=function(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));for(var f=d||0,g=e||0;;){var h=a.indexOf("	",f);if(0>h||h>=b)return g+(b-f);g+=h-f,g+=c-g%c,f=h+1}},sh=[""],th=function(a){a.select()};ig?th=function(a){a.selectionStart=0,a.selectionEnd=a.value.length}:$f&&(th=function(a){try{a.select()}catch(b){}}),[].indexOf&&(of=function(a,b){return a.indexOf(b)}),[].map&&(pf=function(a,b){return a.map(b)});var uh,vh=/[\u00df\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,wh=a.isWordChar=function(a){return/\w/.test(a)||a>"\u0080"&&(a.toUpperCase()!=a.toLowerCase()||vh.test(a))},xh=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;uh=document.createRange?function(a,b,c){var d=document.createRange();return d.setEnd(a,c),d.setStart(a,b),d}:function(a,b,c){var d=document.body.createTextRange();return d.moveToElementText(a.parentNode),d.collapse(!0),d.moveEnd("character",c),d.moveStart("character",b),d},$f&&11>_f&&(Af=function(){try{return document.activeElement}catch(a){return document.body}});var yh,zh,Ah,Bh=a.rmClass=function(a,b){var c=Bf(b);c.test(a.className)&&(a.className=a.className.replace(c,""))},Ch=a.addClass=function(a,b){Bf(b).test(a.className)||(a.className+=" "+b)},Dh=!1,Eh=function(){if($f&&9>_f)return!1;var a=wf("div");return"draggable"in a||"dragDrop"in a}(),Fh=a.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;d>=b;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var f=a.slice(b,"\r"==a.charAt(e-1)?e-1:e),g=f.indexOf("\r");-1!=g?(c.push(f.slice(0,g)),b+=g+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)},Gh=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},Hh=function(){var a=wf("div");return"oncopy"in a?!0:(a.setAttribute("oncopy","return;"),"function"==typeof a.oncopy)}(),Ih=null,Jh={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};a.keyNames=Jh,function(){for(var a=0;10>a;a++)Jh[a+48]=Jh[a+96]=String(a);for(var a=65;90>=a;a++)Jh[a]=String.fromCharCode(a);for(var a=1;12>=a;a++)Jh[a+111]=Jh[a+63235]="F"+a}();var Kh,Lh=function(){function a(a){return 247>=a?c.charAt(a):a>=1424&&1524>=a?"R":a>=1536&&1773>=a?d.charAt(a-1536):a>=1774&&2220>=a?"r":a>=8192&&8203>=a?"w":8204==a?"b":"L"}function b(a,b,c){this.level=a,this.from=b,this.to=c}var c="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",d="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",e=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,f=/[stwN]/,g=/[LRr]/,h=/[Lb1n]/,i=/[1n]/,j="L";return function(c){if(!e.test(c))return!1;for(var d,k=c.length,l=[],m=0;k>m;++m)l.push(d=a(c.charCodeAt(m)));for(var m=0,n=j;k>m;++m){var d=l[m];"m"==d?l[m]=n:n=d}for(var m=0,o=j;k>m;++m){var d=l[m];"1"==d&&"r"==o?l[m]="n":g.test(d)&&(o=d,"r"==d&&(l[m]="R"))}for(var m=1,n=l[0];k-1>m;++m){var d=l[m];"+"==d&&"1"==n&&"1"==l[m+1]?l[m]="1":","!=d||n!=l[m+1]||"1"!=n&&"n"!=n||(l[m]=n),n=d}for(var m=0;k>m;++m){var d=l[m];if(","==d)l[m]="N";else if("%"==d){for(var p=m+1;k>p&&"%"==l[p];++p);for(var q=m&&"!"==l[m-1]||k>p&&"1"==l[p]?"1":"N",r=m;p>r;++r)l[r]=q;m=p-1}}for(var m=0,o=j;k>m;++m){var d=l[m];"L"==o&&"1"==d?l[m]="L":g.test(d)&&(o=d)}for(var m=0;k>m;++m)if(f.test(l[m])){for(var p=m+1;k>p&&f.test(l[p]);++p);for(var s="L"==(m?l[m-1]:j),t="L"==(k>p?l[p]:j),q=s||t?"L":"R",r=m;p>r;++r)l[r]=q;m=p-1}for(var u,v=[],m=0;k>m;)if(h.test(l[m])){var w=m;for(++m;k>m&&h.test(l[m]);++m);v.push(new b(0,w,m))}else{var x=m,y=v.length;for(++m;k>m&&"L"!=l[m];++m);for(var r=x;m>r;)if(i.test(l[r])){r>x&&v.splice(y,0,new b(1,x,r));var z=r;for(++r;m>r&&i.test(l[r]);++r);v.splice(y,0,new b(2,z,r)),x=r}else++r;m>x&&v.splice(y,0,new b(1,x,m))}return 1==v[0].level&&(u=c.match(/^\s+/))&&(v[0].from=u[0].length,v.unshift(new b(0,0,u[0].length))),1==nf(v).level&&(u=c.match(/\s+$/))&&(nf(v).to-=u[0].length,v.push(new b(0,k-u[0].length,k))),v[0].level!=nf(v).level&&v.push(new b(v[0].level,k,k)),v}}();return a.version="4.7.1",a});
;// LICENSE CodeMirror 4.7.0 - see licenses.txt §2.10
CodeMirror.modeExtensions||(CodeMirror.modeExtensions={}),CodeMirror.defineExtension("getModeExt",function(){var a=CodeMirror.resolveMode(this.getOption("mode")).name,b=CodeMirror.modeExtensions[a];if(!b)throw new Error("No extensions found for mode "+a);return b}),CodeMirror.defineExtension("getModeExtAtPos",function(a){var b=this.getTokenAt(a);return b&&b.state&&b.state.mode?CodeMirror.modeExtensions["html"==b.state.mode?"htmlmixed":b.state.mode]:this.getModeExt()}),CodeMirror.defineExtension("commentRange",function(a,b,c){var d=this.getModeExtAtPos(this.getCursor());if(a)this.getRange(b,c),this.replaceRange(d.commentStart+this.getRange(b,c)+d.commentEnd,b,c),b.line==c.line&&b.ch==c.ch&&this.setCursor(b.line,b.ch+d.commentStart.length);else{var e=this.getRange(b,c),f=e.indexOf(d.commentStart),g=e.lastIndexOf(d.commentEnd);f>-1&&g>-1&&g>f&&(e=e.substr(0,f)+e.substring(f+d.commentStart.length,g)+e.substr(g+d.commentEnd.length)),this.replaceRange(e,b,c)}}),CodeMirror.defineExtension("autoIndentRange",function(a,b){var c=this;this.operation(function(){for(var d=a.line;b.line>=d;d++)c.indentLine(d,"smart")})}),CodeMirror.defineExtension("autoFormatRange",function(a,b){var c=this.indexFromPos(a),d=this.indexFromPos(b),e=this.getModeExt().autoFormatLineBreaks(this.getValue(),c,d),f=this;this.operation(function(){f.replaceRange(e,a,b);for(var d=f.posFromIndex(c).line,g=f.posFromIndex(c+e.length).line,h=d;g>=h;h++)f.indentLine(h,"smart")})}),CodeMirror.modeExtensions.css={commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],autoFormatLineBreaks:function(a){return a.replace(new RegExp("(;|\\{|\\})([^\r\n])","g"),"$1\n$2")}},CodeMirror.modeExtensions.javascript={commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],getNonBreakableBlocks:function(a){for(var b=[new RegExp("for\\s*?\\(([\\s\\S]*?)\\)"),new RegExp("'([\\s\\S]*?)('|$)"),new RegExp('"([\\s\\S]*?)("|$)'),new RegExp("//.*([\r\n]|$)")],c=new Array,d=0;b.length>d;d++)for(var e=0;a.length>e;){var f=a.substr(e).match(b[d]);if(null==f)break;c.push({start:e+f.index,end:e+f.index+f[0].length}),e+=f.index+Math.max(1,f[0].length)}return c.sort(function(a,b){return a.start-b.start}),c},autoFormatLineBreaks:function(a){var b=0,c=new RegExp("(;|\\{|\\})([^\r\n])","g"),d=this.getNonBreakableBlocks(a);if(null!=d){for(var e="",f=0;d.length>f;f++)d[f].start>b&&(e+=a.substring(b,d[f].start).replace(c,"$1\n$2"),b=d[f].start),b>=d[f].start&&d[f].end>=b&&(e+=a.substring(b,d[f].end),b=d[f].end);return a.length-1>b&&(e+=a.substr(b).replace(c,"$1\n$2")),e}return a.replace(c,"$1\n$2")}},CodeMirror.modeExtensions.xml={commentStart:"<!--",commentEnd:"-->",wordWrapChars:[">"],autoFormatLineBreaks:function(a){for(var b=a.split("\n"),c=new RegExp("(^\\s*?<|^[^<]*?)(.+)(>\\s*?$|[^>]*?$)"),d=new RegExp("<","g"),e=new RegExp("(>)([^\r\n])","g"),f=0;b.length>f;f++){var g=b[f].match(c);null!=g&&g.length>3&&(b[f]=g[1]+g[2].replace(d,"\n$&").replace(e,"$1\n$2")+g[3])}return b.join("\n")}},CodeMirror.modeExtensions.htmlmixed={commentStart:"<!--",commentEnd:"-->",wordWrapChars:[">",";","\\{","\\}"],getModeInfos:function(a,b){var c=new Array;c[0]={pos:0,modeExt:CodeMirror.modeExtensions.xml,modeName:"xml"};var d=new Array;d[0]={regex:new RegExp("<style[^>]*>([\\s\\S]*?)(</style[^>]*>|$)","i"),modeExt:CodeMirror.modeExtensions.css,modeName:"css"},d[1]={regex:new RegExp("<script[^>]*>([\\s\\S]*?)(</script[^>]*>|$)","i"),modeExt:CodeMirror.modeExtensions.javascript,modeName:"javascript"};for(var e="undefined"!=typeof b?b:a.length-1,f=0;d.length>f;f++)for(var g=0;e>=g;){var h=a.substr(g).match(d[f].regex);if(null==h)break;if(h.length>1&&h[1].length>0){var i=g+h.index+h[0].indexOf(h[1]);c.push({pos:i,modeExt:d[f].modeExt,modeName:d[f].modeName}),c.push({pos:i+h[1].length,modeExt:c[0].modeExt,modeName:c[0].modeName}),g+=h.index+h[0].length}else g+=h.index+Math.max(h[0].length,1)}return c.sort(function(a,b){return a.pos-b.pos}),c},autoFormatLineBreaks:function(a,b,c){var d=this.getModeInfos(a),e=new RegExp("^\\s*?\n"),f=new RegExp("\n\\s*?$"),g="";if(d.length>1)for(var h=1;d.length>=h;h++){var i=d[h-1].pos,j=d.length>h?d[h].pos:c;if(i>=c)break;if(b>i){if(b>=j)continue;i=b}j>c&&(j=c);var k=a.substring(i,j);"xml"!=d[h-1].modeName&&(!e.test(k)&&i>0&&(k="\n"+k),!f.test(k)&&a.length-1>j&&(k+="\n")),g+=d[h-1].modeExt.autoFormatLineBreaks(k)}else g=d[0].modeExt.autoFormatLineBreaks(a.substring(b,c));return g}};
;// LICENSE CodeMirror 4.7.0 - see licenses.txt §2.10
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],a):a(CodeMirror)})(function(a){"use strict";a.defineMode("htmlmixed",function(b,c){function d(a,b){var c=b.htmlState.tagName;c&&(c=c.toLowerCase());var d=h.token(a,b.htmlState);if("script"==c&&/\btag\b/.test(d)&&">"==a.current()){var e=a.string.slice(Math.max(0,a.pos-100),a.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i);e=e?e[1]:"",e&&/[\"\']/.test(e.charAt(0))&&(e=e.slice(1,e.length-1));for(var k=0;j.length>k;++k){var l=j[k];if("string"==typeof l.matches?e==l.matches:l.matches.test(e)){l.mode&&(b.token=f,b.localMode=l.mode,b.localState=l.mode.startState&&l.mode.startState(h.indent(b.htmlState,"")));break}}}else"style"==c&&/\btag\b/.test(d)&&">"==a.current()&&(b.token=g,b.localMode=i,b.localState=i.startState(h.indent(b.htmlState,"")));return d}function e(a,b,c){var d,e=a.current(),f=e.search(b);return f>-1?a.backUp(e.length-f):(d=e.match(/<\/?$/))&&(a.backUp(e.length),a.match(b,!1)||a.match(e)),c}function f(a,b){return a.match(/^<\/\s*script\s*>/i,!1)?(b.token=d,b.localState=b.localMode=null,null):e(a,/<\/\s*script\s*>/,b.localMode.token(a,b.localState))}function g(a,b){return a.match(/^<\/\s*style\s*>/i,!1)?(b.token=d,b.localState=b.localMode=null,null):e(a,/<\/\s*style\s*>/,i.token(a,b.localState))}var h=a.getMode(b,{name:"xml",htmlMode:!0,multilineTagIndentFactor:c.multilineTagIndentFactor,multilineTagIndentPastTag:c.multilineTagIndentPastTag}),i=a.getMode(b,"css"),j=[],k=c&&c.scriptTypes;if(j.push({matches:/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,mode:a.getMode(b,"javascript")}),k)for(var l=0;k.length>l;++l){var m=k[l];j.push({matches:m.matches,mode:m.mode&&a.getMode(b,m.mode)})}return j.push({matches:/./,mode:a.getMode(b,"text/plain")}),{startState:function(){var a=h.startState();return{token:d,localMode:null,localState:null,htmlState:a}},copyState:function(b){if(b.localState)var c=a.copyState(b.localMode,b.localState);return{token:b.token,localMode:b.localMode,localState:c,htmlState:a.copyState(h,b.htmlState)}},token:function(a,b){return b.token(a,b)},indent:function(b,c){return!b.localMode||/^\s*<\//.test(c)?h.indent(b.htmlState,c):b.localMode.indent?b.localMode.indent(b.localState,c):a.Pass},innerMode:function(a){return{state:a.localState||a.htmlState,mode:a.localMode||h}}}},"xml","javascript","css"),a.defineMIME("text/html","htmlmixed")});
;// LICENSE CodeMirror 4.7.0 - see licenses.txt §2.10
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){"use strict";a.defineMode("javascript",function(b,c){function d(a){for(var b,c=!1,d=!1;null!=(b=a.next());){if(!c){if("/"==b&&!d)return;"["==b?d=!0:d&&"]"==b&&(d=!1)}c=!c&&"\\"==b}}function e(a,b,c){return ob=a,pb=c,b}function f(a,b){var c=a.next();if('"'==c||"'"==c)return b.tokenize=g(c),b.tokenize(a,b);if("."==c&&a.match(/^\d+(?:[eE][+\-]?\d+)?/))return e("number","number");if("."==c&&a.match(".."))return e("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(c))return e(c);if("="==c&&a.eat(">"))return e("=>","operator");if("0"==c&&a.eat(/x/i))return a.eatWhile(/[\da-f]/i),e("number","number");if(/\d/.test(c))return a.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),e("number","number");if("/"==c)return a.eat("*")?(b.tokenize=h,h(a,b)):a.eat("/")?(a.skipToEnd(),e("comment","comment")):"operator"==b.lastType||"keyword c"==b.lastType||"sof"==b.lastType||/^[\[{}\(,;:]$/.test(b.lastType)?(d(a),a.eatWhile(/[gimy]/),e("regexp","string-2")):(a.eatWhile(xb),e("operator","operator",a.current()));if("`"==c)return b.tokenize=i,i(a,b);if("#"==c)return a.skipToEnd(),e("error","error");if(xb.test(c))return a.eatWhile(xb),e("operator","operator",a.current());if(vb.test(c)){a.eatWhile(vb);var f=a.current(),j=wb.propertyIsEnumerable(f)&&wb[f];return j&&"."!=b.lastType?e(j.type,j.style,f):e("variable","variable",f)}}function g(a){return function(b,c){var d,g=!1;if(sb&&"@"==b.peek()&&b.match(yb))return c.tokenize=f,e("jsonld-keyword","meta");for(;null!=(d=b.next())&&(d!=a||g);)g=!g&&"\\"==d;return g||(c.tokenize=f),e("string","string")}}function h(a,b){for(var c,d=!1;c=a.next();){if("/"==c&&d){b.tokenize=f;break}d="*"==c}return e("comment","comment")}function i(a,b){for(var c,d=!1;null!=(c=a.next());){if(!d&&("`"==c||"$"==c&&a.eat("{"))){b.tokenize=f;break}d=!d&&"\\"==c}return e("quasi","string-2",a.current())}function j(a,b){b.fatArrowAt&&(b.fatArrowAt=null);var c=a.string.indexOf("=>",a.start);if(!(0>c)){for(var d=0,e=!1,f=c-1;f>=0;--f){var g=a.string.charAt(f),h=zb.indexOf(g);if(h>=0&&3>h){if(!d){++f;break}if(0==--d)break}else if(h>=3&&6>h)++d;else if(vb.test(g))e=!0;else if(e&&!d){++f;break}}e&&!d&&(b.fatArrowAt=f)}}function k(a,b,c,d,e,f){this.indented=a,this.column=b,this.type=c,this.prev=e,this.info=f,null!=d&&(this.align=d)}function l(a,b){for(var c=a.localVars;c;c=c.next)if(c.name==b)return!0;for(var d=a.context;d;d=d.prev)for(var c=d.vars;c;c=c.next)if(c.name==b)return!0}function m(a,b,c,d,e){var f=a.cc;for(Bb.state=a,Bb.stream=e,Bb.marked=null,Bb.cc=f,Bb.style=b,a.lexical.hasOwnProperty("align")||(a.lexical.align=!0);;){var g=f.length?f.pop():tb?w:v;if(g(c,d)){for(;f.length&&f[f.length-1].lex;)f.pop()();return Bb.marked?Bb.marked:"variable"==c&&l(a,d)?"variable-2":b}}}function n(){for(var a=arguments.length-1;a>=0;a--)Bb.cc.push(arguments[a])}function o(){return n.apply(null,arguments),!0}function p(a){function b(b){for(var c=b;c;c=c.next)if(c.name==a)return!0;return!1}var d=Bb.state;if(d.context){if(Bb.marked="def",b(d.localVars))return;d.localVars={name:a,next:d.localVars}}else{if(b(d.globalVars))return;c.globalVars&&(d.globalVars={name:a,next:d.globalVars})}}function q(){Bb.state.context={prev:Bb.state.context,vars:Bb.state.localVars},Bb.state.localVars=Cb}function r(){Bb.state.localVars=Bb.state.context.vars,Bb.state.context=Bb.state.context.prev}function s(a,b){var c=function(){var c=Bb.state,d=c.indented;if("stat"==c.lexical.type)d=c.lexical.indented;else for(var e=c.lexical;e&&")"==e.type&&e.align;e=e.prev)d=e.indented;c.lexical=new k(d,Bb.stream.column(),a,null,c.lexical,b)};return c.lex=!0,c}function t(){var a=Bb.state;a.lexical.prev&&(")"==a.lexical.type&&(a.indented=a.lexical.indented),a.lexical=a.lexical.prev)}function u(a){function b(c){return c==a?o():";"==a?n():o(b)}return b}function v(a,b){return"var"==a?o(s("vardef",b.length),R,u(";"),t):"keyword a"==a?o(s("form"),w,v,t):"keyword b"==a?o(s("form"),v,t):"{"==a?o(s("}"),O,t):";"==a?o():"if"==a?("else"==Bb.state.lexical.info&&Bb.state.cc[Bb.state.cc.length-1]==t&&Bb.state.cc.pop()(),o(s("form"),w,v,t,W)):"function"==a?o(ab):"for"==a?o(s("form"),X,v,t):"variable"==a?o(s("stat"),H):"switch"==a?o(s("form"),w,s("}","switch"),u("{"),O,t,t):"case"==a?o(w,u(":")):"default"==a?o(u(":")):"catch"==a?o(s("form"),q,u("("),bb,u(")"),v,t,r):"module"==a?o(s("form"),q,gb,r,t):"class"==a?o(s("form"),cb,t):"export"==a?o(s("form"),hb,t):"import"==a?o(s("form"),ib,t):n(s("stat"),w,u(";"),t)}function w(a){return y(a,!1)}function x(a){return y(a,!0)}function y(a,b){if(Bb.state.fatArrowAt==Bb.stream.start){var c=b?G:F;if("("==a)return o(q,s(")"),M(S,")"),t,u("=>"),c,r);if("variable"==a)return n(q,S,u("=>"),c,r)}var d=b?C:B;return Ab.hasOwnProperty(a)?o(d):"function"==a?o(ab,d):"keyword c"==a?o(b?A:z):"("==a?o(s(")"),z,nb,u(")"),t,d):"operator"==a||"spread"==a?o(b?x:w):"["==a?o(s("]"),lb,t,d):"{"==a?N(J,"}",null,d):"quasi"==a?n(D,d):o()}function z(a){return a.match(/[;\}\)\],]/)?n():n(w)}function A(a){return a.match(/[;\}\)\],]/)?n():n(x)}function B(a,b){return","==a?o(w):C(a,b,!1)}function C(a,b,c){var d=0==c?B:C,e=0==c?w:x;return"=>"==a?o(q,c?G:F,r):"operator"==a?/\+\+|--/.test(b)?o(d):"?"==b?o(w,u(":"),e):o(e):"quasi"==a?n(D,d):";"!=a?"("==a?N(x,")","call",d):"."==a?o(I,d):"["==a?o(s("]"),z,u("]"),t,d):void 0:void 0}function D(a,b){return"quasi"!=a?n():"${"!=b.slice(b.length-2)?o(D):o(w,E)}function E(a){return"}"==a?(Bb.marked="string-2",Bb.state.tokenize=i,o(D)):void 0}function F(a){return j(Bb.stream,Bb.state),n("{"==a?v:w)}function G(a){return j(Bb.stream,Bb.state),n("{"==a?v:x)}function H(a){return":"==a?o(t,v):n(B,u(";"),t)}function I(a){return"variable"==a?(Bb.marked="property",o()):void 0}function J(a,b){return"variable"==a||"keyword"==Bb.style?(Bb.marked="property","get"==b||"set"==b?o(K):o(L)):"number"==a||"string"==a?(Bb.marked=sb?"property":Bb.style+" property",o(L)):"jsonld-keyword"==a?o(L):"["==a?o(w,u("]"),L):void 0}function K(a){return"variable"!=a?n(L):(Bb.marked="property",o(ab))}function L(a){return":"==a?o(x):"("==a?n(ab):void 0}function M(a,b){function c(d){if(","==d){var e=Bb.state.lexical;return"call"==e.info&&(e.pos=(e.pos||0)+1),o(a,c)}return d==b?o():o(u(b))}return function(d){return d==b?o():n(a,c)}}function N(a,b,c){for(var d=3;arguments.length>d;d++)Bb.cc.push(arguments[d]);return o(s(b,c),M(a,b),t)}function O(a){return"}"==a?o():n(v,O)}function P(a){return ub&&":"==a?o(Q):void 0}function Q(a){return"variable"==a?(Bb.marked="variable-3",o()):void 0}function R(){return n(S,P,U,V)}function S(a,b){return"variable"==a?(p(b),o()):"["==a?N(S,"]"):"{"==a?N(T,"}"):void 0}function T(a,b){return"variable"!=a||Bb.stream.match(/^\s*:/,!1)?("variable"==a&&(Bb.marked="property"),o(u(":"),S,U)):(p(b),o(U))}function U(a,b){return"="==b?o(x):void 0}function V(a){return","==a?o(R):void 0}function W(a,b){return"keyword b"==a&&"else"==b?o(s("form","else"),v,t):void 0}function X(a){return"("==a?o(s(")"),Y,u(")"),t):void 0}function Y(a){return"var"==a?o(R,u(";"),$):";"==a?o($):"variable"==a?o(Z):n(w,u(";"),$)}function Z(a,b){return"in"==b||"of"==b?(Bb.marked="keyword",o(w)):o(B,$)}function $(a,b){return";"==a?o(_):"in"==b||"of"==b?(Bb.marked="keyword",o(w)):n(w,u(";"),_)}function _(a){")"!=a&&o(w)}function ab(a,b){return"*"==b?(Bb.marked="keyword",o(ab)):"variable"==a?(p(b),o(ab)):"("==a?o(q,s(")"),M(bb,")"),t,v,r):void 0}function bb(a){return"spread"==a?o(bb):n(S,P)}function cb(a,b){return"variable"==a?(p(b),o(db)):void 0}function db(a,b){return"extends"==b?o(w,db):"{"==a?o(s("}"),eb,t):void 0}function eb(a,b){return"variable"==a||"keyword"==Bb.style?(Bb.marked="property","get"==b||"set"==b?o(fb,ab,eb):o(ab,eb)):"*"==b?(Bb.marked="keyword",o(eb)):";"==a?o(eb):"}"==a?o():void 0}function fb(a){return"variable"!=a?n():(Bb.marked="property",o())}function gb(a,b){return"string"==a?o(v):"variable"==a?(p(b),o(kb)):void 0}function hb(a,b){return"*"==b?(Bb.marked="keyword",o(kb,u(";"))):"default"==b?(Bb.marked="keyword",o(w,u(";"))):n(v)}function ib(a){return"string"==a?o():n(jb,kb)}function jb(a,b){return"{"==a?N(jb,"}"):("variable"==a&&p(b),o())}function kb(a,b){return"from"==b?(Bb.marked="keyword",o(w)):void 0}function lb(a){return"]"==a?o():n(x,mb)}function mb(a){return"for"==a?n(nb,u("]")):","==a?o(M(A,"]")):n(M(x,"]"))}function nb(a){return"for"==a?o(X,nb):"if"==a?o(w,nb):void 0}var ob,pb,qb=b.indentUnit,rb=c.statementIndent,sb=c.jsonld,tb=c.json||sb,ub=c.typescript,vb=c.wordCharacters||/[\w$\xa1-\uffff]/,wb=function(){function a(a){return{type:a,style:"keyword"}}var b=a("keyword a"),c=a("keyword b"),d=a("keyword c"),e=a("operator"),f={type:"atom",style:"atom"},g={"if":a("if"),"while":b,"with":b,"else":c,"do":c,"try":c,"finally":c,"return":d,"break":d,"continue":d,"new":d,"delete":d,"throw":d,"debugger":d,"var":a("var"),"const":a("var"),let:a("var"),"function":a("function"),"catch":a("catch"),"for":a("for"),"switch":a("switch"),"case":a("case"),"default":a("default"),"in":e,"typeof":e,"instanceof":e,"true":f,"false":f,"null":f,undefined:f,NaN:f,Infinity:f,"this":a("this"),module:a("module"),"class":a("class"),"super":a("atom"),yield:d,"export":a("export"),"import":a("import"),"extends":d};if(ub){var h={type:"variable",style:"variable-3"},i={"interface":a("interface"),"extends":a("extends"),constructor:a("constructor"),"public":a("public"),"private":a("private"),"protected":a("protected"),"static":a("static"),string:h,number:h,bool:h,any:h};for(var j in i)g[j]=i[j]}return g}(),xb=/[+\-*&%=<>!?|~^]/,yb=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/,zb="([{}])",Ab={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,"this":!0,"jsonld-keyword":!0},Bb={state:null,column:null,marked:null,cc:null},Cb={name:"this",next:{name:"arguments"}};return t.lex=!0,{startState:function(a){var b={tokenize:f,lastType:"sof",cc:[],lexical:new k((a||0)-qb,0,"block",!1),localVars:c.localVars,context:c.localVars&&{vars:c.localVars},indented:0};return c.globalVars&&"object"==typeof c.globalVars&&(b.globalVars=c.globalVars),b},token:function(a,b){if(a.sol()&&(b.lexical.hasOwnProperty("align")||(b.lexical.align=!1),b.indented=a.indentation(),j(a,b)),b.tokenize!=h&&a.eatSpace())return null;var c=b.tokenize(a,b);return"comment"==ob?c:(b.lastType="operator"!=ob||"++"!=pb&&"--"!=pb?ob:"incdec",m(b,c,ob,pb,a))},indent:function(b,d){if(b.tokenize==h)return a.Pass;if(b.tokenize!=f)return 0;var e=d&&d.charAt(0),g=b.lexical;if(!/^\s*else\b/.test(d))for(var i=b.cc.length-1;i>=0;--i){var j=b.cc[i];if(j==t)g=g.prev;else if(j!=W)break}"stat"==g.type&&"}"==e&&(g=g.prev),rb&&")"==g.type&&"stat"==g.prev.type&&(g=g.prev);var k=g.type,l=e==k;return"vardef"==k?g.indented+("operator"==b.lastType||","==b.lastType?g.info+1:0):"form"==k&&"{"==e?g.indented:"form"==k?g.indented+qb:"stat"==k?g.indented+("operator"==b.lastType||","==b.lastType?rb||qb:0):"switch"!=g.info||l||0==c.doubleIndentSwitch?g.align?g.column+(l?0:1):g.indented+(l?0:qb):g.indented+(/^(?:case|default)\b/.test(d)?qb:2*qb)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:tb?null:"/*",blockCommentEnd:tb?null:"*/",lineComment:tb?null:"//",fold:"brace",helperType:tb?"json":"javascript",jsonldMode:sb,jsonMode:tb}}),a.registerHelper("wordChars","javascript",/[\w$]/),a.defineMIME("text/javascript","javascript"),a.defineMIME("text/ecmascript","javascript"),a.defineMIME("application/javascript","javascript"),a.defineMIME("application/x-javascript","javascript"),a.defineMIME("application/ecmascript","javascript"),a.defineMIME("application/json",{name:"javascript",json:!0}),a.defineMIME("application/x-json",{name:"javascript",json:!0}),a.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),a.defineMIME("text/typescript",{name:"javascript",typescript:!0}),a.defineMIME("application/typescript",{name:"javascript",typescript:!0})});
;// LICENSE CodeMirror 4.7.0 - see licenses.txt §2.10
CodeMirror.defineMode("xml",function(a,b){function c(a,b){function c(c){return b.tokenize=c,c(a,b)}var e=a.next();if("<"==e){if(a.eat("!"))return a.eat("[")?a.match("CDATA[")?c(f("atom","]]>")):null:a.match("--")?c(f("comment","-->")):a.match("DOCTYPE",!0,!0)?(a.eatWhile(/[\w\._\-]/),c(g(1))):null;if(a.eat("?"))return a.eatWhile(/[\w\._\-]/),b.tokenize=f("meta","?>"),"meta";t=a.eat("/")?"closeTag":"openTag",a.eatSpace(),s="";for(var h;h=a.eat(/[^\s\u00a0=<>\"\'\/?]/);)s+=h;return b.tokenize=d,"tag"}if("&"==e){var i;return i=a.eat("#")?a.eat("x")?a.eatWhile(/[a-fA-F\d]/)&&a.eat(";"):a.eatWhile(/[\d]/)&&a.eat(";"):a.eatWhile(/[\w\.\-:]/)&&a.eat(";"),i?"atom":"error"}return a.eatWhile(/[^&<]/),null}function d(a,b){var d=a.next();return">"==d||"/"==d&&a.eat(">")?(b.tokenize=c,t=">"==d?"endTag":"selfcloseTag","tag"):"="==d?(t="equals",null):/[\'\"]/.test(d)?(b.tokenize=e(d),b.tokenize(a,b)):(a.eatWhile(/[^\s\u00a0=<>\"\'\/?]/),"word")}function e(a){return function(b,c){for(;!b.eol();)if(b.next()==a){c.tokenize=d;break}return"string"}}function f(a,b){return function(d,e){for(;!d.eol();){if(d.match(b)){e.tokenize=c;break}d.next()}return a}}function g(a){return function(b,d){for(var e;null!=(e=b.next());){if("<"==e)return d.tokenize=g(a+1),d.tokenize(b,d);if(">"==e){if(1==a){d.tokenize=c;break}return d.tokenize=g(a-1),d.tokenize(b,d)}}return"meta"}}function h(){for(var a=arguments.length-1;a>=0;a--)u.cc.push(arguments[a])}function i(){return h.apply(null,arguments),!0}function j(a,b){var c=x.doNotIndent.hasOwnProperty(a)||u.context&&u.context.noIndent;u.context={prev:u.context,tagName:a,indent:u.indented,startOfLine:b,noIndent:c}}function k(){u.context&&(u.context=u.context.prev)}function l(a){if("openTag"==a)return u.tagName=s,i(o,m(u.startOfLine));if("closeTag"==a){var b=!1;return b=u.context?u.context.tagName!=s:!0,b&&(v="error"),i(n(b))}return i()}function m(a){return function(b){return"selfcloseTag"==b||"endTag"==b&&x.autoSelfClosers.hasOwnProperty(u.tagName.toLowerCase())?i():"endTag"==b?(j(u.tagName,a),i()):i()}}function n(a){return function(b){return a&&(v="error"),"endTag"==b?(k(),i()):(v="error",i(arguments.callee))}}function o(a){return"word"==a?(v="attribute",i(p,o)):"endTag"==a||"selfcloseTag"==a?h():(v="error",i(o))}function p(a){return"equals"==a?i(q,o):(x.allowMissing||(v="error"),"endTag"==a||"selfcloseTag"==a?h():i())}function q(a){return"string"==a?i(r):"word"==a&&x.allowUnquoted?(v="string",i()):(v="error","endTag"==a||"selfCloseTag"==a?h():i())}function r(a){return"string"==a?i(r):h()}var s,t,u,v,w=a.indentUnit,x=b.htmlMode?{autoSelfClosers:{br:!0,img:!0,hr:!0,link:!0,input:!0,meta:!0,col:!0,frame:!0,base:!0,area:!0},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!1}:{autoSelfClosers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1},y=b.alignCDATA;return{startState:function(){return{tokenize:c,cc:[],indented:0,startOfLine:!0,tagName:null,context:null}},token:function(a,b){if(a.sol()&&(b.startOfLine=!0,b.indented=a.indentation()),a.eatSpace())return null;v=t=s=null;var c=b.tokenize(a,b);if(b.type=t,(c||t)&&"comment"!=c)for(u=b;;){var d=b.cc.pop()||l;if(d(t||c))break}return b.startOfLine=!1,v||c},indent:function(a,b,e){var f=a.context;if(a.tokenize!=d&&a.tokenize!=c||f&&f.noIndent)return e?e.match(/^(\s*)/)[0].length:0;if(y&&/<!\[CDATA\[/.test(b))return 0;for(f&&/^<\//.test(b)&&(f=f.prev);f&&!f.startOfLine;)f=f.prev;return f?f.indent+w:0},compareStates:function(a,b){if(a.indented!=b.indented||a.tokenize!=b.tokenize)return!1;for(var c=a.context,d=b.context;;c=c.prev,d=d.prev){if(!c||!d)return c==d;if(c.tagName!=d.tagName)return!1}},electricChars:"/"}}),CodeMirror.defineMIME("application/xml","xml"),CodeMirror.mimeModes.hasOwnProperty("text/html")||CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:!0});
;// LICENSE CodeMirror 4.7.0 - see licenses.txt §2.10
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){"use strict";function b(a){for(var b={},c=0;a.length>c;++c)b[a[c]]=!0;return b}function c(a,b){for(var c,d=!1;null!=(c=a.next());){if(d&&"/"==c){b.tokenize=null;break}d="*"==c}return["comment","comment"]}function d(a,b){return a.skipTo("-->")?(a.match("-->"),b.tokenize=null):a.skipToEnd(),["comment","comment"]}a.defineMode("css",function(b,c){function d(a,b){return n=b,a}function e(a,b){var c=a.next();if(q[c]){var e=q[c](a,b);if(e!==!1)return e}return"@"==c?(a.eatWhile(/[\w\\\-]/),d("def",a.current())):"="==c||("~"==c||"|"==c)&&a.eat("=")?d(null,"compare"):'"'==c||"'"==c?(b.tokenize=f(c),b.tokenize(a,b)):"#"==c?(a.eatWhile(/[\w\\\-]/),d("atom","hash")):"!"==c?(a.match(/^\s*\w*/),d("keyword","important")):/\d/.test(c)||"."==c&&a.eat(/\d/)?(a.eatWhile(/[\w.%]/),d("number","unit")):"-"!==c?/[,+>*\/]/.test(c)?d(null,"select-op"):"."==c&&a.match(/^-?[_a-z][_a-z0-9-]*/i)?d("qualifier","qualifier"):/[:;{}\[\]\(\)]/.test(c)?d(null,c):"u"==c&&a.match("rl(")?(a.backUp(1),b.tokenize=g,d("property","word")):/[\w\\\-]/.test(c)?(a.eatWhile(/[\w\\\-]/),d("property","word")):d(null,null):/[\d.]/.test(a.peek())?(a.eatWhile(/[\w.%]/),d("number","unit")):a.match(/^\w+-/)?d("meta","meta"):void 0}function f(a){return function(b,c){for(var e,f=!1;null!=(e=b.next());){if(e==a&&!f){")"==a&&b.backUp(1);break}f=!f&&"\\"==e}return(e==a||!f&&")"!=a)&&(c.tokenize=null),d("string","string")}}function g(a,b){return a.next(),b.tokenize=a.match(/\s*[\"\')]/,!1)?null:f(")"),d(null,"(")}function h(a,b,c){this.type=a,this.indent=b,this.prev=c}function i(a,b,c){return a.context=new h(c,b.indentation()+p,a.context),c}function j(a){return a.context=a.context.prev,a.context.type}function k(a,b,c){return z[c.context.type](a,b,c)}function l(a,b,c,d){for(var e=d||1;e>0;e--)c.context=c.context.prev;return k(a,b,c)}function m(a){var b=a.current().toLowerCase();o=w.hasOwnProperty(b)?"atom":v.hasOwnProperty(b)?"keyword":"variable"}c.propertyKeywords||(c=a.resolveMode("text/css"));var n,o,p=b.indentUnit,q=c.tokenHooks,r=c.mediaTypes||{},s=c.mediaFeatures||{},t=c.propertyKeywords||{},u=c.nonStandardPropertyKeywords||{},v=c.colorKeywords||{},w=c.valueKeywords||{},x=c.fontProperties||{},y=c.allowNested,z={};return z.top=function(a,b,c){if("{"==a)return i(c,b,"block");if("}"==a&&c.context.prev)return j(c);if("@media"==a)return i(c,b,"media");if("@font-face"==a)return"font_face_before";if(/^@(-(moz|ms|o|webkit)-)?keyframes$/.test(a))return"keyframes";if(a&&"@"==a.charAt(0))return i(c,b,"at");if("hash"==a)o="builtin";else if("word"==a)o="tag";else{if("variable-definition"==a)return"maybeprop";if("interpolation"==a)return i(c,b,"interpolation");if(":"==a)return"pseudo";if(y&&"("==a)return i(c,b,"parens")}return c.context.type},z.block=function(a,b,c){if("word"==a){var d=b.current().toLowerCase();return t.hasOwnProperty(d)?(o="property","maybeprop"):u.hasOwnProperty(d)?(o="string-2","maybeprop"):y?(o=b.match(/^\s*:(?:\s|$)/,!1)?"property":"tag","block"):(o+=" error","maybeprop")}return"meta"==a?"block":y||"hash"!=a&&"qualifier"!=a?z.top(a,b,c):(o="error","block")},z.maybeprop=function(a,b,c){return":"==a?i(c,b,"prop"):k(a,b,c)},z.prop=function(a,b,c){if(";"==a)return j(c);if("{"==a&&y)return i(c,b,"propBlock");if("}"==a||"{"==a)return l(a,b,c);if("("==a)return i(c,b,"parens");if("hash"!=a||/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(b.current())){if("word"==a)m(b);else if("interpolation"==a)return i(c,b,"interpolation")}else o+=" error";return"prop"},z.propBlock=function(a,b,c){return"}"==a?j(c):"word"==a?(o="property","maybeprop"):c.context.type},z.parens=function(a,b,c){return"{"==a||"}"==a?l(a,b,c):")"==a?j(c):"("==a?i(c,b,"parens"):("word"==a&&m(b),"parens")},z.pseudo=function(a,b,c){return"word"==a?(o="variable-3",c.context.type):k(a,b,c)},z.media=function(a,b,c){if("("==a)return i(c,b,"media_parens");if("}"==a)return l(a,b,c);if("{"==a)return j(c)&&i(c,b,y?"block":"top");if("word"==a){var d=b.current().toLowerCase();o="only"==d||"not"==d||"and"==d?"keyword":r.hasOwnProperty(d)?"attribute":s.hasOwnProperty(d)?"property":"error"}return c.context.type},z.media_parens=function(a,b,c){return")"==a?j(c):"{"==a||"}"==a?l(a,b,c,2):z.media(a,b,c)},z.font_face_before=function(a,b,c){return"{"==a?i(c,b,"font_face"):k(a,b,c)},z.font_face=function(a,b,c){return"}"==a?j(c):"word"==a?(o=x.hasOwnProperty(b.current().toLowerCase())?"property":"error","maybeprop"):"font_face"},z.keyframes=function(a,b,c){return"word"==a?(o="variable","keyframes"):"{"==a?i(c,b,"top"):k(a,b,c)},z.at=function(a,b,c){return";"==a?j(c):"{"==a||"}"==a?l(a,b,c):("word"==a?o="tag":"hash"==a&&(o="builtin"),"at")},z.interpolation=function(a,b,c){return"}"==a?j(c):"{"==a||";"==a?l(a,b,c):("variable"!=a&&(o="error"),"interpolation")},{startState:function(a){return{tokenize:null,state:"top",context:new h("top",a||0,null)}},token:function(a,b){if(!b.tokenize&&a.eatSpace())return null;var c=(b.tokenize||e)(a,b);return c&&"object"==typeof c&&(n=c[1],c=c[0]),o=c,b.state=z[b.state](n,a,b),o},indent:function(a,b){var c=a.context,d=b&&b.charAt(0),e=c.indent;return"prop"!=c.type||"}"!=d&&")"!=d||(c=c.prev),!c.prev||("}"!=d||"block"!=c.type&&"top"!=c.type&&"interpolation"!=c.type&&"font_face"!=c.type)&&(")"!=d||"parens"!=c.type&&"media_parens"!=c.type)&&("{"!=d||"at"!=c.type&&"media"!=c.type)||(e=c.indent-p,c=c.prev),e},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",fold:"brace"}});var e=["all","aural","braille","handheld","print","projection","screen","tty","tv","embossed"],f=b(e),g=["width","min-width","max-width","height","min-height","max-height","device-width","min-device-width","max-device-width","device-height","min-device-height","max-device-height","aspect-ratio","min-aspect-ratio","max-aspect-ratio","device-aspect-ratio","min-device-aspect-ratio","max-device-aspect-ratio","color","min-color","max-color","color-index","min-color-index","max-color-index","monochrome","min-monochrome","max-monochrome","resolution","min-resolution","max-resolution","scan","grid"],h=b(g),i=["align-content","align-items","align-self","alignment-adjust","alignment-baseline","anchor-point","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","float-offset","flow-from","flow-into","font","font-feature-settings","font-family","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-weight","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-position","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","justify-content","left","letter-spacing","line-break","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-wrap","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","pitch","pitch-range","play-during","position","presentation-level","punctuation-trim","quotes","region-break-after","region-break-before","region-break-inside","region-fragment","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","shape-image-threshold","shape-inside","shape-margin","shape-outside","size","speak","speak-as","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","tab-size","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-height","text-indent","text-justify","text-outline","text-overflow","text-shadow","text-size-adjust","text-space-collapse","text-transform","text-underline-position","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","volume","white-space","widows","width","word-break","word-spacing","word-wrap","z-index","clip-path","clip-rule","mask","enable-background","filter","flood-color","flood-opacity","lighting-color","stop-color","stop-opacity","pointer-events","color-interpolation","color-interpolation-filters","color-rendering","fill","fill-opacity","fill-rule","image-rendering","marker","marker-end","marker-mid","marker-start","shape-rendering","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-rendering","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","text-anchor","writing-mode"],j=b(i),k=["scrollbar-arrow-color","scrollbar-base-color","scrollbar-dark-shadow-color","scrollbar-face-color","scrollbar-highlight-color","scrollbar-shadow-color","scrollbar-3d-light-color","scrollbar-track-color","shape-inside","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","zoom"],l=b(k),m=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],n=b(m),o=["above","absolute","activeborder","activecaption","afar","after-white-space","ahead","alias","all","all-scroll","alternate","always","amharic","amharic-abegede","antialiased","appworkspace","arabic-indic","armenian","asterisks","auto","avoid","avoid-column","avoid-page","avoid-region","background","backwards","baseline","below","bidi-override","binary","bengali","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","cambodian","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-earthly-branch","cjk-heavenly-stem","cjk-ideographic","clear","clip","close-quote","col-resize","collapse","column","compact","condensed","contain","content","content-box","context-menu","continuous","copy","cover","crop","cross","crosshair","currentcolor","cursive","dashed","decimal","decimal-leading-zero","default","default-button","destination-atop","destination-in","destination-out","destination-over","devanagari","disc","discard","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic","ethiopic-abegede","ethiopic-abegede-am-et","ethiopic-abegede-gez","ethiopic-abegede-ti-er","ethiopic-abegede-ti-et","ethiopic-halehame-aa-er","ethiopic-halehame-aa-et","ethiopic-halehame-am-et","ethiopic-halehame-gez","ethiopic-halehame-om-et","ethiopic-halehame-sid-et","ethiopic-halehame-so-et","ethiopic-halehame-ti-er","ethiopic-halehame-ti-et","ethiopic-halehame-tig","ew-resize","expanded","extra-condensed","extra-expanded","fantasy","fast","fill","fixed","flat","footnotes","forwards","from","geometricPrecision","georgian","graytext","groove","gujarati","gurmukhi","hand","hangul","hangul-consonant","hebrew","help","hidden","hide","higher","highlight","highlighttext","hiragana","hiragana-iroha","horizontal","hsl","hsla","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-table","inset","inside","intrinsic","invert","italic","justify","kannada","katakana","katakana-iroha","keep-all","khmer","landscape","lao","large","larger","left","level","lighter","line-through","linear","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-alpha","lower-armenian","lower-greek","lower-hexadecimal","lower-latin","lower-norwegian","lower-roman","lowercase","ltr","malayalam","match","media-controls-background","media-current-time-display","media-fullscreen-button","media-mute-button","media-play-button","media-return-to-realtime-button","media-rewind-button","media-seek-back-button","media-seek-forward-button","media-slider","media-sliderthumb","media-time-remaining-display","media-volume-slider","media-volume-slider-container","media-volume-sliderthumb","medium","menu","menulist","menulist-button","menulist-text","menulist-textfield","menutext","message-box","middle","min-intrinsic","mix","mongolian","monospace","move","multiple","myanmar","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","nw-resize","nwse-resize","oblique","octal","open-quote","optimizeLegibility","optimizeSpeed","oriya","oromo","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","persian","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","round","row-resize","rtl","run-in","running","s-resize","sans-serif","scroll","scrollbar","se-resize","searchfield","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","semi-condensed","semi-expanded","separate","serif","show","sidama","single","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","solid","somali","source-atop","source-in","source-out","source-over","space","square","square-button","start","static","status-bar","stretch","stroke","sub","subpixel-antialiased","super","sw-resize","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","telugu","text","text-bottom","text-top","textarea","textfield","thai","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","tibetan","tigre","tigrinya-er","tigrinya-er-abegede","tigrinya-et","tigrinya-et-abegede","to","top","transparent","ultra-condensed","ultra-expanded","underline","up","upper-alpha","upper-armenian","upper-greek","upper-hexadecimal","upper-latin","upper-norwegian","upper-roman","uppercase","urdu","url","vertical","vertical-text","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","x-large","x-small","xor","xx-large","xx-small"],p=b(o),q=["font-family","src","unicode-range","font-variant","font-feature-settings","font-stretch","font-weight","font-style"],r=b(q),s=e.concat(g).concat(i).concat(k).concat(m).concat(o);a.registerHelper("hintWords","css",s),a.defineMIME("text/css",{mediaTypes:f,mediaFeatures:h,propertyKeywords:j,nonStandardPropertyKeywords:l,colorKeywords:n,valueKeywords:p,fontProperties:r,tokenHooks:{"<":function(a,b){return a.match("!--")?(b.tokenize=d,d(a,b)):!1},"/":function(a,b){return a.eat("*")?(b.tokenize=c,c(a,b)):!1}},name:"css"}),a.defineMIME("text/x-scss",{mediaTypes:f,mediaFeatures:h,propertyKeywords:j,nonStandardPropertyKeywords:l,colorKeywords:n,valueKeywords:p,fontProperties:r,allowNested:!0,tokenHooks:{"/":function(a,b){return a.eat("/")?(a.skipToEnd(),["comment","comment"]):a.eat("*")?(b.tokenize=c,c(a,b)):["operator","operator"]},":":function(a){return a.match(/\s*\{/)?[null,"{"]:!1},$:function(a){return a.match(/^[\w-]+/),a.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"]},"#":function(a){return a.eat("{")?[null,"interpolation"]:!1}},name:"css",helperType:"scss"}),a.defineMIME("text/x-less",{mediaTypes:f,mediaFeatures:h,propertyKeywords:j,nonStandardPropertyKeywords:l,colorKeywords:n,valueKeywords:p,fontProperties:r,allowNested:!0,tokenHooks:{"/":function(a,b){return a.eat("/")?(a.skipToEnd(),["comment","comment"]):a.eat("*")?(b.tokenize=c,c(a,b)):["operator","operator"]},"@":function(a){return a.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\b/,!1)?!1:(a.eatWhile(/[\w\\\-]/),a.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"])},"&":function(){return["atom","atom"]}},name:"css",helperType:"less"})});
;// LICENSE CodeMirror 4.7.0 - see licenses.txt §2.10
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){"use strict";a.defineMode("sql",function(a,b){function c(a,b){var c=a.next();if(n[c]){var f=n[c](a,b);if(f!==!1)return f}if(1==m.hexNumber&&("0"==c&&a.match(/^[xX][0-9a-fA-F]+/)||("x"==c||"X"==c)&&a.match(/^'[0-9a-fA-F]+'/)))return"number";if(1==m.binaryNumber&&(("b"==c||"B"==c)&&a.match(/^'[01]+'/)||"0"==c&&a.match(/^b[01]+/)))return"number";if(c.charCodeAt(0)>47&&58>c.charCodeAt(0))return a.match(/^[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/),1==m.decimallessFloat&&a.eat("."),"number";if("?"==c&&(a.eatSpace()||a.eol()||a.eat(";")))return"variable-3";if("'"==c||'"'==c&&m.doubleQuote)return b.tokenize=d(c),b.tokenize(a,b);if((1==m.nCharCast&&("n"==c||"N"==c)||1==m.charsetCast&&"_"==c&&a.match(/[a-z][a-z0-9]*/i))&&("'"==a.peek()||'"'==a.peek()))return"keyword";if(/^[\(\),\;\[\]]/.test(c))return null;if(m.commentSlashSlash&&"/"==c&&a.eat("/"))return a.skipToEnd(),"comment";if(m.commentHash&&"#"==c||"-"==c&&a.eat("-")&&(!m.commentSpaceRequired||a.eat(" ")))return a.skipToEnd(),"comment";if("/"==c&&a.eat("*"))return b.tokenize=e,b.tokenize(a,b);if("."!=c){if(l.test(c))return a.eatWhile(l),null;if("{"==c&&(a.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||a.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/)))return"number";a.eatWhile(/^[_\w\d]/);var g=a.current().toLowerCase();return o.hasOwnProperty(g)&&(a.match(/^( )+'[^']*'/)||a.match(/^( )+"[^"]*"/))?"number":i.hasOwnProperty(g)?"atom":j.hasOwnProperty(g)?"builtin":k.hasOwnProperty(g)?"keyword":h.hasOwnProperty(g)?"string-2":null}return 1==m.zerolessFloat&&a.match(/^(?:\d+(?:e[+-]?\d+)?)/i)?"number":1==m.ODBCdotTable&&a.match(/^[a-zA-Z_]+/)?"variable-2":void 0}function d(a){return function(b,d){for(var e,f=!1;null!=(e=b.next());){if(e==a&&!f){d.tokenize=c;break}f=!f&&"\\"==e}return"string"}}function e(a,b){for(;;){if(!a.skipTo("*")){a.skipToEnd();break}if(a.next(),a.eat("/")){b.tokenize=c;break}}return"comment"}function f(a,b,c){b.context={prev:b.context,indent:a.indentation(),col:a.column(),type:c}}function g(a){a.indent=a.context.indent,a.context=a.context.prev}var h=b.client||{},i=b.atoms||{"false":!0,"true":!0,"null":!0},j=b.builtin||{},k=b.keywords||{},l=b.operatorChars||/^[*+\-%<>!=&|~^]/,m=b.support||{},n=b.hooks||{},o=b.dateSQL||{date:!0,time:!0,timestamp:!0};return{startState:function(){return{tokenize:c,context:null}},token:function(a,b){if(a.sol()&&b.context&&null==b.context.align&&(b.context.align=!1),a.eatSpace())return null;var c=b.tokenize(a,b);if("comment"==c)return c;b.context&&null==b.context.align&&(b.context.align=!0);var d=a.current();return"("==d?f(a,b,")"):"["==d?f(a,b,"]"):b.context&&b.context.type==d&&g(b),c},indent:function(b,c){var d=b.context;if(!d)return 0;var e=c.charAt(0)==d.type;return d.align?d.col+(e?0:1):d.indent+(e?0:a.indentUnit)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:m.commentSlashSlash?"//":m.commentHash?"#":null}}),function(){function b(a){for(var b;null!=(b=a.next());)if("`"==b&&!a.eat("`"))return"variable-2";return a.backUp(a.current().length-1),a.eatWhile(/\w/)?"variable-2":null}function c(a){return a.eat("@")&&(a.match(/^session\./),a.match(/^local\./),a.match(/^global\./)),a.eat("'")?(a.match(/^.*'/),"variable-2"):a.eat('"')?(a.match(/^.*"/),"variable-2"):a.eat("`")?(a.match(/^.*`/),"variable-2"):a.match(/^[0-9a-zA-Z$\.\_]+/)?"variable-2":null}function d(a){return a.eat("N")?"atom":a.match(/^[a-zA-Z.#!?]/)?"variable-2":null}function e(a){for(var b={},c=a.split(" "),d=0;c.length>d;++d)b[c[d]]=!0;return b}var f="alter and as asc between by count create delete desc distinct drop from having in insert into is join like not on or order select set table union update values where ";a.defineMIME("text/x-sql",{name:"sql",keywords:e(f+"begin"),builtin:e("bool boolean bit blob enum long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision real date datetime year unsigned signed decimal numeric"),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:e("date time timestamp"),support:e("ODBCdotTable doubleQuote binaryNumber hexNumber")}),a.defineMIME("text/x-mssql",{name:"sql",client:e("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:e(f+"begin trigger proc view index for add constraint key primary foreign collate clustered nonclustered"),builtin:e("bigint numeric bit smallint decimal smallmoney int tinyint money float real char varchar text nchar nvarchar ntext binary varbinary image cursor timestamp hierarchyid uniqueidentifier sql_variant xml table "),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:e("date datetimeoffset datetime2 smalldatetime datetime time"),hooks:{"@":c}}),a.defineMIME("text/x-mysql",{name:"sql",client:e("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:e(f+"accessible action add after algorithm all analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general get global grant grants group groupby_concat handler hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show signal slave slow smallint snapshot soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),builtin:e("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:e("date time timestamp"),support:e("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),hooks:{"@":c,"`":b,"\\":d}}),a.defineMIME("text/x-mariadb",{name:"sql",client:e("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:e(f+"accessible action add after algorithm all always analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general generated get global grant grants group groupby_concat handler hard hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password persistent phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show shutdown signal slave slow smallint snapshot soft soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views virtual warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),builtin:e("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:e("date time timestamp"),support:e("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),hooks:{"@":c,"`":b,"\\":d}}),a.defineMIME("text/x-cassandra",{name:"sql",client:{},keywords:e("use select from using consistency where limit first reversed first and in insert into values using consistency ttl update set delete truncate begin batch apply create keyspace with columnfamily primary key index on drop alter type add any one quorum all local_quorum each_quorum"),builtin:e("ascii bigint blob boolean counter decimal double float int text timestamp uuid varchar varint"),atoms:e("false true"),operatorChars:/^[<>=]/,dateSQL:{},support:e("commentSlashSlash decimallessFloat"),hooks:{}}),a.defineMIME("text/x-plsql",{name:"sql",client:e("appinfo arraysize autocommit autoprint autorecovery autotrace blockterminator break btitle cmdsep colsep compatibility compute concat copycommit copytypecheck define describe echo editfile embedded escape exec execute feedback flagger flush heading headsep instance linesize lno loboffset logsource long longchunksize markup native newpage numformat numwidth pagesize pause pno recsep recsepchar release repfooter repheader serveroutput shiftinout show showmode size spool sqlblanklines sqlcase sqlcode sqlcontinue sqlnumber sqlpluscompatibility sqlprefix sqlprompt sqlterminator suffix tab term termout time timing trimout trimspool ttitle underline verify version wrap"),keywords:e("abort accept access add all alter and any array arraylen as asc assert assign at attributes audit authorization avg base_table begin between binary_integer body boolean by case cast char char_base check close cluster clusters colauth column comment commit compress connect connected constant constraint crash create current currval cursor data_base database date dba deallocate debugoff debugon decimal declare default definition delay delete desc digits dispose distinct do drop else elseif elsif enable end entry escape exception exception_init exchange exclusive exists exit external fast fetch file for force form from function generic goto grant group having identified if immediate in increment index indexes indicator initial initrans insert interface intersect into is key level library like limited local lock log logging long loop master maxextents maxtrans member minextents minus mislabel mode modify multiset new next no noaudit nocompress nologging noparallel not nowait number_base object of off offline on online only open option or order out package parallel partition pctfree pctincrease pctused pls_integer positive positiven pragma primary prior private privileges procedure public raise range raw read rebuild record ref references refresh release rename replace resource restrict return returning returns reverse revoke rollback row rowid rowlabel rownum rows run savepoint schema segment select separate session set share snapshot some space split sql start statement storage subtype successful synonym tabauth table tables tablespace task terminate then to trigger truncate type union unique unlimited unrecoverable unusable update use using validate value values variable view views when whenever where while with work"),builtin:e("abs acos add_months ascii asin atan atan2 average bfile bfilename bigserial bit blob ceil character chartorowid chr clob concat convert cos cosh count dec decode deref dual dump dup_val_on_index empty error exp false float floor found glb greatest hextoraw initcap instr instrb int integer isopen last_day least lenght lenghtb ln lower lpad ltrim lub make_ref max min mlslabel mod months_between natural naturaln nchar nclob new_time next_day nextval nls_charset_decl_len nls_charset_id nls_charset_name nls_initcap nls_lower nls_sort nls_upper nlssort no_data_found notfound null number numeric nvarchar2 nvl others power rawtohex real reftohex round rowcount rowidtochar rowtype rpad rtrim serial sign signtype sin sinh smallint soundex sqlcode sqlerrm sqrt stddev string substr substrb sum sysdate tan tanh to_char text to_date to_label to_multi_byte to_number to_single_byte translate true trunc uid unlogged upper user userenv varchar varchar2 variance varying vsize xml"),operatorChars:/^[*+\-%<>!=~]/,dateSQL:e("date time timestamp"),support:e("doubleQuote nCharCast zerolessFloat binaryNumber hexNumber")}),a.defineMIME("text/x-hive",{name:"sql",keywords:e("select alter $elem$ $key$ $value$ add after all analyze and archive as asc before between binary both bucket buckets by cascade case cast change cluster clustered clusterstatus collection column columns comment compute concatenate continue create cross cursor data database databases dbproperties deferred delete delimited desc describe directory disable distinct distribute drop else enable end escaped exclusive exists explain export extended external false fetch fields fileformat first format formatted from full function functions grant group having hold_ddltime idxproperties if import in index indexes inpath inputdriver inputformat insert intersect into is items join keys lateral left like limit lines load local location lock locks mapjoin materialized minus msck no_drop nocompress not of offline on option or order out outer outputdriver outputformat overwrite partition partitioned partitions percent plus preserve procedure purge range rcfile read readonly reads rebuild recordreader recordwriter recover reduce regexp rename repair replace restrict revoke right rlike row schema schemas semi sequencefile serde serdeproperties set shared show show_database sort sorted ssl statistics stored streamtable table tables tablesample tblproperties temporary terminated textfile then tmp to touch transform trigger true unarchive undo union uniquejoin unlock update use using utc utc_tmestamp view when where while with"),builtin:e("bool boolean long timestamp tinyint smallint bigint int float double date datetime unsigned string array struct map uniontype"),atoms:e("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:e("date timestamp"),support:e("ODBCdotTable doubleQuote binaryNumber hexNumber")})}()});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a,b,c){a.widget("NL.nlSubmenu",a.NL.nlWidget,{options:{menuItems:[],style:"",addAnchorClass:!1,autoOpen:!1,autoClose:!1,standalone:!1,onMenuDisplay:function(){},onMenuHide:function(){}},_$menus:c,_menuEntries:c,_dockingPosition:"",_unbindOnDestroy:c,_buildMenuFlat:function(b){var c=a("<li></li>"),d=a.extend({},b,{rightIcon:"",mode:"submenu"});c.addClass("nlui-submenu-item nlui-submenu-nopadding");var e=a("<span></span>").soButton(d).appendTo(c);return{item:c,button:e}},_buildMenuEntry:function(b,d,e){var f=this,g=a("<li></li>"),h=null;if(d||g.addClass("nlui-submenu-item"),b=null!==b&&b.separator?null:b,null===b)g=a('<li class="nlui-horizontal-separator nlui-submenu-item"> </li>');else{g.addClass("nlui-submenu-nopadding");var i=a.extend({},b,{mode:"submenu"});if(b.subCommands&&(i=a.extend({},i,{rightIcon:"ui-icon-triangle-1-e"})),1===e&&(i=a.extend({},i,{minWidth:this.element.width()})),i.onClick){var j=i.onClick;i.onClick=function(a,b,c){j(a,b,c),f.collapse()}}h=a("<span></span>").soButton(i).appendTo(g)}return b&&b.id!==c&&(g.data("commandId",b.id),this._menuEntries[b.id]=g),{item:g,button:h}},_disableCommand:function(a){a.addClass("nlui-state-disabled")},_buildSubMenu:function(a,b,c,d,e){var f=this,g=null;return SO.isArray(d)?(g=this._buildMenuPanel(d,null,e+1).appendTo(a).css("position","absolute"),e>0&&g.addClass("nlui-submenu-submenu"),f._bindMouseEvents(a,g,e)):SO.isFunction(c.subCommands)&&(f._bindItemMouseEvents(a,e),b.addClass("nlui-submenu-asyncRightArrow"),b.soButton("changeOptions",{onRightIconClick:function(b,d){var g=b.soButton("getOption","rightIcon");b.soButton("changeOptions",{rightIcon:"/xtk/img/loading.gif"}),c.subCommands.call(f,c,function(c){b.soButton("changeOptions",{rightIcon:g}),a.find(".nlui-submenu").remove();var d=f._buildMenuPanel(c,null,e+1).appendTo(a).addClass("nlui-submenu-submenu").css("position","absolute");f._clearBinding(a),f._bindMouseEvents(a,d,e);var h=f._getSubMenuPosition(a,e);(f.options.autoOpen&&0===e||e>0)&&f._mouseOverCB(null,a,d,h,e)}),d.stopPropagation()}})),g},_buildMenuPanel:function(b,c,d){var e,f,g=this;e=a("<ul></ul>"),e.addClass("nlui-submenu"),f=this.getTheme(),f&&e.addClass("clui-"+f),this.options.standalone&&e.addClass("nlui-submenu-standalone"),c?(e.appendTo(c),e.css("position","absolute"),e.css("left",c.width()+"px")):e.appendTo(this.element),this.element.addClass("nlui-state-active");var h,i=(b.length,[]),j=[],k=!0;for(h=0;b.length>h;h++){var l=b[h];if(l){if(l.hidden)continue;j.push(l),k=!1}else{if(k)continue;j.push(null),k=!0}}for(null===j[j.length-1]&&j.splice(j.length-1,1),b=j,h=0;b.length>h;h++){var m,n,l=b[h];n="flat"===g.options.style?g._buildMenuFlat(l,h):g._buildMenuEntry(l,null,d),m=n.item,null!==l&&(SO.isNundef(l.subCommands)?g._bindItemMouseEvents(m,d):g._buildSubMenu(m,n.button,l,l.subCommands,d),("disabled"===l.activationState||l.disabled===!0)&&g._disableCommand(m,l)),i.push(m)}for(h=0;i.length>h;h++)e.append(i[h]);return this._$menus.push(e),e.toggle(!1),e},_computeStyle:function(){var a,b="ui-corner-all",c="";for(a=0;this._$menus.length>a;a++)this._$menus[a].removeClass(b),this._$menus[a].addClass(c)},_create:function(){var b=this,d=this.element;this._$menus=[],this._menuEntries=[],this._dockingPosition="",this._unbindOnDestroy=[],this._$root=c,this.options.popableManager.addPopable(this),d.css("pointer","cursor"),this.options.addAnchorClass&&d.addClass("nlui-submenu-anchor"),b._computeStyle();var e=b._buildSubMenu(d,null,null,this.options.menuItems,0);this.options.autoOpen&&e&&this._mouseOverCB(null,a(this.element),e,this._getSubMenuPosition(a(this.element),0),0),this._$root=e},_getSubMenuPosition:function(b,c){var d=this,e={my:"left top",at:"right top",of:b,collision:"flip"},f=e;return 0===c&&(e={my:"left top",at:"left bottom",collision:"flip",of:b},f=a.extend({using:function(b){d._dockingPosition=0>b.top?"top":"bottom",a(this).position(e)}},e)),f},isOwnerOf:function(b){var c=this;return SO.DOMUtils.isDescendantOf(b,a(c.element))||b.is(this.element)},collapse:function(b){var c=a(this.element);b&&(c=b),c.find(".nlui-submenu").hide(),c.removeClass("nlui-submenu-opened"),c.is(this.element)&&this.options.onMenuHide.call(this.element)},_mouseOverCB:function(b,c,d,e,f){var g=this;c.siblings().each(function(b,c){a(c).data("out",!0)}),c.data("out",!1),d.data("out",!1),setTimeout(function(){d.data("out")||(0===f&&(c.removeClass("ui-corner-all"),c.addClass("ui-corner-top")),c.siblings().each(function(b,c){g.collapse(a(c))}),d.position(e).show().position(e).hide().show(),g.options.onMenuDisplay.call(g.element))},1)},_bindMouseEvents:function(b,d,e){var f=this,g=this._getSubMenuPosition(b,e);d.mouseover(function(){0===e&&b.removeClass("ui-corner-all"),b.data("hoverson",!0),d.data("out",!1),f.options.onMenuDisplay.call(f.element)}),d.mouseout(function(e){b.data("hoverson",!1),d.data("out",!0),setTimeout(function(){if(d.data("out")){var g=!1,h=d.parents(".nlui-submenu");f.options.autoClose&&(g=!0),h.find(".nlui-submenu-item").each(function(b,d){return a(d).data("hoverson")||a(d).data("out")!==c&&!a(d).data("out")?(g=!0,!1):void 0}),g?f.collapse(b):a(e.target).is(d)&&f.collapse(d)}},252)}),d.click(function(){b.data("hoverson",!1),d.data("out",!0),f.collapse(),b.removeClass("nlui-submenu-opened")});var h=function(a){f._mouseOverCB(a,b,d,g,e)};b.mouseover(h),this._unbindOnDestroy.push({obj:b,evt:"mouseover",fun:h});var i=function(){b.data("out",!0),setTimeout(function(){if(!b.data("hoverson")&&b.data("out")){var d=!1;f.options.autoClose&&(d=!0),b.siblings().each(function(b,e){return a(e).data("hoverson")||a(e).data("out")!==c&&!a(e).data("out")?(d=!0,!1):void 0}),d&&(f.collapse(b),0===e&&b.removeClass("nlui-submenu-opened"))}},252)};b.mouseout(i),this._unbindOnDestroy.push({obj:b,evt:"mouseout",fun:i})},_clearBinding:function(a){a.unbind("mouseover"),a.unbind("mouseout")},_bindItemMouseEvents:function(b,c){var d=this,e=a(this.element),f=function(){b.siblings().each(function(b,c){a(c).data("out",!0),d.collapse(a(c))}),b.data("out",!1),0===c&&(e.removeClass("ui-corner-all"),e.addClass("nlui-submenu-opened"))};b.mouseover(f),this._unbindOnDestroy.push({obj:b,evt:"mouseover",fun:f});var g=function(){b.data("out",!0),d.collapse(b)};b.mouseout(g),this._unbindOnDestroy.push({obj:b,evt:"mouseout",fun:g})},dockingPosition:function(){return this._dockingPosition},getMenuItem:function(a){return this._menuEntries[a]},destroy:function(){var b,c=a(this.element);for(this.element.removeClass("nlui-state-active"),this.options.popableManager.removePopable(this),b=this._$menus.length-1;b>=0;b--)this._$menus[b].remove();this._$root.remove(),this._$menus=[],c.removeClass("nlui-submenu-anchor nlui-submenu-opened"),SO.Utils.each(this._unbindOnDestroy,function(b,c){c.obj&&c.evt&&c.fun&&a(c.obj).unbind(c.evt,c.fun),c.obj&&delete c.obj}),this._unbindOnDestroy=null,a.Widget.prototype.destroy.call(this)}})})(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("navigatorInput","Input",{DEFAULT_OPTIONS:{controller:null,items:[],rootLabel:xtk_core.navigator_home(),emptyText:xtk_core.navigator_elementNoneSelected(),rootIcon:"ui-icon-folder-open",breadcrumbIcon:!1,subFolderCheckbox:!1},_$clear:null,_$selectionContainer:null,_$ellipsis:null,_ellipsisConf:[],_selectedItem:!1,_rootConf:{type:"root",id:0,label:"",leaf:!1},_$rootIcon:null,_hitEvent:"click",_insertAfter:null,_job:null,_getRootConf:function(){return $.extend({},this._rootConf,{icon:this._options.rootIcon})},_create:function(){SO.assert(!SO.isNundef(this._options.controller),"controller is mandatory in the navigator widget options");var a=this;if(this._state={},this._state.error=this._options.error,this._state.readOnly=this._options.readOnly,this._state.disabled=this._options.disabled,this._state.strict=this._options.strict,this._state.mandatory=this._options.mandatory,this._checks=this._checks||[],this._checks=[{requirement:function(){return a._state.mandatory},test:function(b){return!a._isValueEmpty(b)},error:{message:xtk_core.field_mandatoryErr()}}],this._hitEvent=SO.Browser.isTouchScreen()?"touchend":"click",this._$subFolderInput=null,this.options.subFolderCheckbox){this._$subFolderContainer=$('<span class="nlui-navigator-subfolder"></span>').appendTo(this.element);var b="navigator_subfolder_"+NL.Utils.sequence().nextVal();this._$subFolderInput=$('<input type="checkbox" id="'+b+'">').on("change",function(){a.options.onExternalChange(a._state.error,a._state.strict)}).appendTo(this._$subFolderContainer),$('<label for="'+b+'">'+xtk_core.folderUseSubTree()+"</label>").appendTo(this._$subFolderContainer)}this._$clear=$('<span class="nlui-navigator-clear"></span>').append(NL.View.genImage("ui-icon-closethick",null,null,0)).on(this._hitEvent,function(){a._state.readOnly||a._state.disabled||a.clear()}).hide().appendTo(this.$el),this._$selectionContainer=$('<ul class="nlui-navigator-root"></ul>').appendTo(this.$el),this.$el.addClass("nlui-navigator"),this._currentTreeJpath=void 0,this._setItems(this._options.items),$("html").on(this._hitEvent,function(){0!==a._$selectionContainer.find(".nlui-navigator-menu").length&&a._rollback()}),this._controller=this._options.controller,this._jpath=this._options.jpath,this._options.layoutManager.registerWidget(this)},_setOption:function(){$.NL.nlWidget.prototype._setOption.apply(this,arguments),this.refresh()},clear:function(){this._setItems([]),this._$clear.hide(),this._state.strict=!0,this._state.error=this._validate(null),this._options.onInternalChange(null,this._state.error,this._state.strict)},_addItemConf:function(a,b){if(this._options.items.length>0){var c=this._options.items[this._options.items.length-1];a&&c&&NL.XTK.toString(a.id)!==NL.XTK.toString(c.id)&&this._addItemConf(a._parent,a)}else a&&this._addItemConf(a._parent,a);this._options.items.push(b)},_addItem:function(a,b,c){var d=this,e=$("<li></li>").nlData("itemId",b.id).appendTo(this._$selectionContainer),f=$("<a></a>").text(b.label).addClass("nlui-navigator-item").appendTo(e);if(b.disabled||f.addClass("nlui-navigator-link"),"root"===b.type?(this._$root=e,f.addClass("nlui-navigator-rootlink"),e.addClass("nlui-navigator-rootparent"),f.on(d._hitEvent,function(a){d._state.readOnly||d._state.disabled||(d._selectedItem=!1,d._insertAfter=null,d._showMenu(b,f,c),d.stopPropagation(a))})):f.on(d._hitEvent,function(e){d._state.readOnly||d._state.disabled||(d._insertAfter=a,d._setItem(null,b,!0,c),d.stopPropagation(e))}),b.icon&&("root"===b.type||d._options.breadcrumbIcon)){var g=$(NL.View.genImage(b.icon,null,null,0));f.addClass("nlui-navigator-icon").prepend(g),"root"===b.type&&(this._$rootIcon=g)}if(!b.leaf&&"root"!==b.type){var h=NL.View.genImage("ui-icon-triangle-1-e",null,null,0),i=$("<span></span>").addClass("nlui-navigator-navigationImg").append(h),j=$("<a></a>").append(i).appendTo(e).addClass("nlui-navigator-navigation");j.addClass("nlui-navigator-link"),j.on(d._hitEvent,function(a){d._state.readOnly||d._state.disabled||(d._selectedItem=!1,d._insertAfter=b,d._showMenu(b,j,c),d.stopPropagation(a))}),e.addClass("nlui-navigator-parent")}this._checkOverflow()},_itemOnClick:function(a,b){var c=null!==a?a._parent:null;this._setItem(c,a,!0,b),this._selectedItem=!0},_workingItemFromSource:function(a,b,c){var d=this,e={};return e.id=b.id,e.fullName=b.fullLabel,e.icon=b.img,e.type=b.type,e.label=b.label,e.leaf=void 0===b.children,e._parent=a,e._originalItem=b,e.onClick=function(){d._itemOnClick(e,c)},b.leaf||(e.rightIcon="ui-icon-carat-1-e",e.subCommands=function(a,b){d._getMenuData(e,function(a){b(a)},void 0,c)}),e},_getMenuData:function(a,b,c,d){var e,f=this;e={onSuccess:function(c){var e=[],g=!1;SO.isNundef(f._getItem(a.id,!0))&&(g=!0),SO.Utils.each(c,function(b,c){var g,h,i;"root"!==a.type?(i=void 0===d?b+"":d+","+b,h=a):(i=b+"",h=null),g=f._workingItemFromSource(h,c,i),e.push(g)}),SO.isFunction(b)&&b.call(f,e)},onError:function(a){f._job=null,SO.isFunction(c)&&c.call(f,a)},onComplete:function(){}},0===a.id||0!==a.id&&void 0!==d?this._getMenuDataFromController(a,e,d):this._getMenuDataWithParent(a,e,d,0)},_getMenuDataFromController:function(a,b,c){var d=this._jpath;void 0!==c&&"root"!==a.type&&(d+="["+c+"]"),this._job=this._controller.getChildren(d,b,!1,"",{folder:a.id})},_getMenuDataWithParent:function(a,b,c,d){var e=this,f=this._jpath;void 0!==c&&"root"!==a.type&&(f+="["+c+"]");var g={onSuccess:function(d){var f,g,h,i=!1,j=!1;for(f=0;d.length>f&&i===!1&&j===!1;){g=d[f];var k;k="root"!==g.type?void 0===c?f+"":c+","+f:f+"",g.id===a.id?j=!0:0===a.fullName.indexOf(g.fullName)&&(i=!0,h=g.id),f++}j?e._getMenuDataFromController(a,b,k):e._getMenuDataWithParent(a,b,k,h)},onError:function(){},onComplete:function(){}};this._job=this._controller.getChildren(f,g,!1,"",{folder:d})},_setRootIcon:function(a){var b=$(NL.View.genImage(a,null,null,0));this._$rootIcon.remove(),this._$rootIcon=b,this._$selectionContainer.find(".nlui-navigator-rootlink").prepend(this._$rootIcon)},_showMenu:function(a,b,c){var d=this,e=b.closest("li"),f=e.nlData("itemId");this._removeFinder(),"root"===a.type&&d._setRootIcon("/xtk/img/loading.gif"),b.find(".nlui-navigator-navigationImg").html(NL.View.genImage("/xtk/img/loading.gif")),this._getMenuData(a,function(b){var c,e=d._getRenderedItem(f).find(".nlui-navigator-navigation, .nlui-navigator-rootlink");e&&(e.nlSubmenu({theme:d._options.theme,menuItems:b,autoOpen:!0,onMenuHide:function(){e.nlSubmenu("destroy"),d._selectedItem||d._rollback(),"root"===a.type?d._setRootIcon(a.icon):(c=$(NL.View.genImage("ui-icon-triangle-1-e",null,null,0)),e.find(".nlui-navigator-navigationImg").html(c))}}),"root"===a.type?d._setRootIcon(a.icon):(c=$(NL.View.genImage("ui-icon-triangle-1-s",null,null,0)),e.find(".nlui-navigator-navigationImg").html(c)))},function(){var c;"root"===a.type?d._setRootIcon(a.icon):(c=$(NL.View.genImage("ui-icon-triangle-1-e",null,null,0)),b.find(".nlui-navigator-navigationImg").html(c))},c)},_addFinder:function(){var a=$('<li class="nlui-navigator-finder"></li>').appendTo(this._$selectionContainer).append(this._options.emptyText),b=0,c=a.outerWidth(!0),d=this._$selectionContainer.width();this._getRenderedItems().not(a).each(function(a,c){b+=$(c).outerWidth(!0)}),b+c>=d&&a.css("width",d-b+"px")},_removeFinder:function(){this._$selectionContainer.find(".nlui-navigator-finder").remove()},_setItem:function(a,b,c,d){var e=[],f=this,g=!1;if(this._getRenderedItems().each(function(a,b){if($(b).is(f._$ellipsis))SO.Utils.each(f._ellipsisConf,function(a,c){if(c.onClick=function(){f._itemOnClick(c,d)},SO.isNundef(f._insertAfter)||e.push(c),f._insertAfter&&NL.XTK.toString(c.id)===NL.XTK.toString(f._insertAfter.id)||SO.isNundef(f._insertAfter)){for(f._ellipsisConf=f._ellipsisConf.slice(0,a);$(b).next().length>0;)$(b).next().remove();return g=!0,!1}});else if(!SO.isNundef($(b).nlData("itemId"))){var c=$(b).nlData("itemId"),h=f._getItem(c,!0);if(!SO.isNundef(f._insertAfter)&&h&&"root"!==h.type&&e.push(h),f._insertAfter&&NL.XTK.toString(c)===NL.XTK.toString(f._insertAfter.id)||SO.isNundef(f._insertAfter)){for(;$(b).next().length>0;)$(b).next().remove();g=!0}}return g?!1:void 0}),f._options.items=e,f._addItemConf(a,b),f._setItems(f._options.items,d),c){var h=$.extend(!0,{},b);h.list=e,this._state.strict=!0,f._options.onInternalChange(h,this._state.error,this._state.strict)}},_setItems:function(a,b){var c,d=this;this._currentTreeJpath=b,d._options.items=[],this._getRenderedItems().remove(),d._ellipsisConf=[],d._$ellipsis=null,d._addItem(null,this._getRootConf(),b),SO.isArray(a)&&a.length>0?(d._$clear.show(),d._removeFinder(),void 0!==b&&(c=b.split(",")),SO.Utils.each(a,function(a,e){e._originalItem?d._options.items.push(e):d._options.items.push(d._workingItemFromSource(null,e,void 0!==b?c.slice(0,a+1).join():void 0))}),SO.Utils.each(d._options.items,function(a,e){SO.isNundef(e._parent)&&a>0&&(e._parent=d._options.items[a-1]),d._addItem(e._parent,e,void 0!==b?c.slice(0,a+1).join():void 0)})):d._addFinder()},getItem:function(a){return this._getItem(a,!1)},_getItem:function(a,b){if(SO.isNundef(a))return this._options.items.length>0?$.extend({},this._options.items[this._options.items.length-1]._originalItem):{};var c;return SO.Utils.each(this._options.items,function(b,d){return NL.XTK.toString(d.id)===NL.XTK.toString(a)?(c=d,!1):void 0}),b?c:c._originalItem},_getItems:function(){var a=[];return SO.Utils.each(this._options.items,function(b,c){var d={};d.id=c.id,d.fullName=c.fullName,d.icon=c.icon,d.type=c.type,d.label=c.label,d.leaf=c.leaf,a.push(d)}),a},getValue:function(){var a=this._getItems();if(SO.isArray(a)&&a.length>0){var b=a[a.length-1];return $.extend({},{id:b.id},{label:b.id,fullName:b.fullName,list:a})}return null},includeSubFolder:function(){return this.options.subFolderCheckbox&&null!==this._$subFolderInput&&this._$subFolderInput[0].checked},setIncludeSubFolder:function(a){this.options.subFolderCheckbox&&null!==this._$subFolderInput&&(this._$subFolderInput[0].checked=a)},setValue:function(a){if(this._value=a,!SO.isNundef(a)){var b=a.list;SO.assert(SO.isArray(b),"A whole list of items must be given."),this._setItems(b),this._state.strict=!0,this._state.error=this._validate(this._value),this._refreshDisplay(!1),this._options.onExternalChange(this._state.error,this._state.strict)}},_rollback:function(){this._setItems(this._options.items,this._currentTreeJpath)},_getItemWidth:function(){var a=0;return this._getRenderedItems().each(function(b,c){a+=$(c).outerWidth(!0)}),a},_indexOf:function(a){var b=-1;return SO.Utils.each(this._options.items,function(c,d){return d.id===a.id?(b=c,!1):!0}),b},_sortEllipsisConf:function(){var a=this,b=function(b,c){var d=a._indexOf(b),e=a._indexOf(c);return d>e};this._ellipsisConf=this._ellipsisConf.sort(b)},_getRenderedItems:function(){return this._$selectionContainer.children()},_getRenderedItem:function(a){var b=function(){return $(this).nlData("itemId")===a};return this._getRenderedItems().filter(b)},_checkOverflow:function(){for(var a,b=this,c=function(){return!$(this).is(b._$ellipsis)},d=this._getRenderedItems().filter(c),e=this._ellipsisConf.length>0,f=0;this._getItemWidth()>=this._$selectionContainer.width()&&d.length>f;)d=this._getRenderedItems().filter(c),a=d[Math.floor(d.length/2)],b._addEllipsisItem(a),$(a).remove(),f++;0!==f||e||(this._$ellipsis=null,this._ellipsisConf=[])},_ellipsisItemOnClick:function(a){this._insertAfter=a._parent,this._setItem(a._parent,a,!0)},_addEllipsisItem:function(a){var b=this,c=this._getItem($(a).nlData("itemId"),!0),d=$.extend({},c,{onClick:function(){b._ellipsisItemOnClick(c)}});this._ellipsisConf.push(d),this._sortEllipsisConf(),this._$ellipsis||this._createEllipsis(a);var e=this._ellipsisConf[this._ellipsisConf.length-1];e.leaf?this._$ellipsis.find(".nlui-navigator-navigation").remove():0===this._$ellipsis.find(".nlui-navigator-navigation").length&&this._addEllipsisNavigation(),this._$ellipsis.nlData("itemId",e.id)},_addEllipsisNavigation:function(){var a=this,b=$("<span></span>").addClass("nlui-navigator-navigationImg").append(NL.View.genImage("ui-icon-triangle-1-e",null,null,0)),c=$("<a></a>").append(b).addClass("nlui-navigator-navigation").appendTo(a._$ellipsis);c.on(a._hitEvent,function(b){var d=a._ellipsisConf[a._ellipsisConf.length-1];a._selectedItem=!1,a._insertAfter=d,a._showMenu(d,c),a.stopPropagation(b)}),c.addClass("nlui-navigator-link")},_createEllipsis:function(a){var b=this;this._$ellipsis=$("<li></li>"),$(a).after(this._$ellipsis),$("<a></a>").text("...").addClass("nlui-navigator-item").on(this._hitEvent,function(){setTimeout(function(){var a=b._$ellipsis.find(".nlui-navigator-item");a.nlSubmenu({autoOpen:!0,menuItems:b._ellipsisConf,style:"flat"})},0)}).addClass("nlui-navigator-link").appendTo(this._$ellipsis),this._$ellipsis.addClass("nlui-navigator-parent")},destroy:function(){this._options.layoutManager.unRegisterWidget(this)},value:function(){return this.getValue()},refresh:function(){this._setItems(this._options.items,this._currentTreeJpath)},_refreshDisplay:function(){this.$el.toggleClass("nlui-state-readonly",this._state.readOnly),this._$root.toggle(!this._state.readOnly),this._$clear.toggle(!this._state.readOnly&&!this._isValueEmpty(this.value())),$("li[data-nl-itemid]:last>a.nlui-navigator-navigation",this._$selectionContainer).toggle(!this._state.readOnly),this.$el.toggleClass("nlui-state-disabled",this._state.disabled),this._state.disabled||null===this._state.error?(null===this._state.error&&this.$el.hasClass("nlui-state-error")||this._state.disabled)&&this.$el.removeClass("nlui-state-error"):this.$el.addClass("nlui-state-error")},rebuildLayout:function(){this._setItems(this._options.items,this._currentTreeJpath)},_setValue:function(a){this._itemOnClick(a),this._options.onInternalChange(a,this._state.error,this._state.strict)}}),$.widget("NL.nlNavigator",{_create:function(){this._widget=new SO.Widgets.navigatorInput(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},clear:function(){this._widget.clear()},getItem:function(a){return this._widget.getItem(a)},destroy:function(){this._widget.destroy()},value:function(){this._widget.value()},refresh:function(){this._widget.refresh()},rebuildLayout:function(){this._widget.rebuildLayout()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("TagList","Input",{DEFAULT_OPTIONS:{params:{dataProvider:null,onAdd:function(){},onRemove:function(){},tags:{defaultColor:"#B4B4B4",separator:";"},tagsArea:{maxWidth:null,position:"bottom"}}},_create:function(){var a=this;this._params=this._options.params,this._tags=this._options.value,this._dataProvider=this._dataProvider(),this._dataProvider._init(this._params.dataProvider,this._tags),this._$tagArea=null,this.$el.addClass("nlui-taglist"),this._checks=[{requirement:function(){return null!==a._value},test:function(a){return SO.isArray(a)},error:{message:"Error"}}],this._super()},_dataProvider:function(){var a=this;return{_getTags:function(){var b=this._provider.controller,c=this._provider.jpath,d=this;this._currentJob&&this._cancel(b,c);var e={onSuccess:function(b){a._tags=b,a._displayTags()},onError:function(){},onComplete:function(){d._currentJob=null}};this._currentJob=b.getCollection(c,0,0,e,!0)},_getDefinition:function(){return this._provider},_removeTag:function(b){this._provider.controller.removeCollectionItem(this._provider.jpath,b,!0),a._params.onRemove(),this._getTags()},_addTags:function(a){this._provider.controller.setValue(this._provider.jpath,a),this._getTags()},_addTag:function(b){if(""!==b&&!SO.isNundef(b)){var c={};c[this._provider.nameAttr]=b,c[this._provider.labelAttr]=b,c[this._provider.colorAttr]=a._params.tags.defaultColor,this._provider.controller.addCollectionItem(this._provider.jpath,c,null,!0),a._params.onAdd(),this._getTags()}},_cancel:function(){this._provider.controller.cancelGetCollection(this._provider.jpath,this._currentJob)},_init:function(b,c){if(b)this._provider=b,SO.assert(this._provider.controller,"No controller defined in the data provider"),SO.assert(this._provider.jpath,"No jpath defined in the data provider"),SO.assert(this._provider.nameAttr,"No nameAttr defined in the data provider"),this._provider.labelAttr||(this._provider.labelAttr=this._provider.nameAttr);else{SO.isString(c)&&(c=c.split(this._params.tags.separator));var d=[];SO.isNundef(c)&&(c=d);for(var e=0;c.length>e;e++){var f={name:c[e].name,label:c[e].label||c[e].name,color:c[e].color||a._params.tags.defaultColor};d.push(f)}var g={data:d},h={data:{type:"list",elements:{name:{type:"string"},label:{type:"string"},color:{type:"string"}},keys:["name"]}},i=new SO.MVC.Controller({model:g,metamodel:h});this._provider={controller:i,jpath:"data",nameAttr:"name",labelAttr:"label",colorAttr:"color"}}}}},_refreshDisplay:function(a){return a&&this._createMarkup(),this._state.readOnly?(this._$icon&&this._$icon.hide(),void 0):(this._$icon.show(),this._state.disabled||null===this._state.error?(null===this._state.error&&this._$input.hasClass("nlui-state-error")||this._state.disabled)&&this._$input.removeClass("nlui-state-error"):this._$input.addClass("nlui-state-error"),this._$input.prop("disabled",this._state.disabled),this._state.readOnly&&this._$input.text(this._formatDisplayValue(this._value)),void 0)},_attachEvent:function(){var a=this;this._$input.on("keyup",function(b){var c=$(this),d=c.val();13===b.keyCode&&($(this).val(""),a._dataProvider._addTag(d))})},_displayTags:function(){var a=this;this._$tagArea.empty();for(var b=this._dataProvider._getDefinition(),c=function(b){return function(){a._dataProvider._removeTag(b)}},d=0;this._tags.length>d;d++){var e=this._tags[d][b.colorAttr]||this._params.tags.defaultColor,f=this._tags[d][b.nameAttr],g=this._tags[d][b.labelAttr]||f,h=$('<div class="nlui-tags"></div>').text(g).css("background-color",e),i=$('<span class="close-button">X</span>').click(c(d,this._tags[d]));h.prepend(i),this._$tagArea.append(h)}},_createMarkup:function(){if(this._$input&&this._$input.remove(),this._$tagArea&&this._$tagArea.remove(),!this._state.readOnly){var a=$('<div class="nlui-taglist-input"></div>');this._$input=$('<input type="text" placeholder="Add tag" class="nlui-input"></input').appendTo(a),this._$icon=SO.IMG.genIcon("target",18).addClass("nlui-taglist-tagicon").appendTo(a),this._attachEvent(),"left"===this._params.tagsArea.position&&a.addClass("toleft"),this.$el.append(a)}this._$tagArea=$("<div class='nlui-taglist-tagarea'></div>").appendTo(this.$el),"left"===this._params.tagsArea.position&&this._$tagArea.addClass("toleft"),SO.isNundef(this._params.tagsArea.maxWidth)||this._$tagArea.css("max-width",this._params.tagsArea.maxWidth+"px"),this._dataProvider._getTags()},getValue:function(){return this._tags},setValue:function(a){this._super(),this._dataProvider._addTags(a)}}),$.widget("SO.soTagList",{_create:function(){this._widget=new SO.Widgets.TagList(this.element,this.options)},setError:function(a){this._widget.setError(a)},setReadOnly:function(a){this._widget.setReadOnly(a)},setDisabled:function(a){this._widget.setDisabled(a)},setMandatory:function(a){this._widget.setMandatory(a)},setStrict:function(a){this._widget.setStrict(a)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},check:function(a,b){return this._widget.check(a,b)},setParamSubtree:function(a,b){this._widget.setParamSubtree(a,b)},setTheme:function(a,b){this._widget.setTheme(a,b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.RenderFunctions"),NL.RenderFunctions.hrefLink=function(a){var b=$("<div></div>"),c=$("<a></a>");if(c.attr("href",a.url),a.icon){var d=SO.IMG.genIcon(a.icon,18);c.append(d.el||d[0])}return a.target&&c.attr("target",a.target),a.label&&c.append($("<span />").css("padding-left","4px").text(a.label)),a.help&&new SO.Widgets.Tooltip(c,{title:a.help,mode:"default"}),b.append(c),b},NL.RenderFunctions.listKPI=function(a){var b,c=$("<div />");if(a.kpis)for(var d=0;a.kpis.length>d;d++)b=$("<span />"),a.kpis[d].icon&&b.append($("<span/>").addClass("nlui-list-kpiIcon").addClass(SO.IMG.genIconClass(a.kpis[d].icon,12))),b.append($("<span/>").addClass("nlui-list-kpi").text(SO.Format.formatValue(a.kpis[d].value,a.kpis[d].displayFormat))),a.kpis[d].help&&new SO.Widgets.Tooltip(b,{title:a.kpis[d].help,mode:"default"}),c.append(b);return c},NL.RenderFunctions.detailedCard=function(a,b,c){function d(a){var b;return b=a instanceof SO.DateTime?SO.Format.formatValue(a,"shortDateTime_m"):SO.Format.formatValue(a,"shortDate")}if(a.kpis)for(var e=0;a.kpis.length>e;e++)a.kpis[e].value=SO.Format.formatValue(a.kpis[e].value,a.kpis[e].displayFormat);a.lastModified=SO.DateTime.parse(a.lastModified),a.lastModifiedFormatted=SO.Format.formatValue(a.lastModified,"timeAgo"),a.startDate&&(a.startDateFormatted=d(a.startDate)),a.endDate&&(a.endDateFormatted=d(a.endDate));var f=NL.Cards._render(a);if(a.kpis&&$(f).find("p.nlui-kpi").each(function(b,c){new SO.Widgets.Tooltip(c,{title:a.kpis[b].help,mode:"default"})}),new SO.Widgets.Tooltip($(f).find("h4")[0],{title:a.label,mode:"default"}),c){var g=c.parent();g&&g.length>0&&g.removeClass("nlui-list-item-default")}return f},NL.RenderFunctions.detailedTimeline=function(a){var b,c,d,e;return b=function(a){a.date;var b=$("<div />"),c=$("<div />");if(c.text(a.label),b.append(c),a.date){var d=$("<div />").text(SO.Format.formatValue(a.date,"shortDateTime_s"));b.append(d)}return b},c=function(a){var b="emailOutbound";switch(a){case"email":b="emailOutbound";break;case"mobile":b="emailOutbound";break;case"callCenter":b="callCenterOutbound";break;case"directMail":b="directMailOutbound";break;case"pushNotification":b="pushNotificationOutbound";break;case"optIn":b="optinInbound";break;case"optOut":b="optoutInbound"}return b},e=c(a.category),d=b(a),{icon:e,right:d}},NL.RenderFunctions.syntaxHighLighting=function(a){var b=$("<div />"),c=a.codeEdit;return a.language?("sql"===a.language&&(c=c.replace("SQL:","").trim()),new SO.Widgets.CodeInput(b,{value:c,params:{presets:a.language,autoWrap:!0},readOnly:!0})):new SO.Widgets.TextFormat(b,{value:c}),b},NL.RenderFunctions.entityLabel=function(a){var b=$("<div />"),c={ellipsis:70,label:a.label,cssClass:a.icon?"status-label-entity":""};return a.href?(c.url=a.href,b.nlLinkView(c)):$("<span />").addClass("nlui-status-text").text(a.label).appendTo(b),(a.status||a.icon)&&new SO.Widgets.Status(b,{icon:a.icon,status:a.status}),b},NL.RenderFunctions.entityDate=function(a){return a.label=a.date.format(),NL.RenderFunctions.entityLabel(a)},NL.RenderFunctions.iconLabel=function(a){var b=$("<div />").css("display","flex");if(!a)return b;if(a.icon&&SO.IMG.genIcon(a.icon,18).appendTo(b),a.label){var c=$("<span />").text(a.label);a.icon&&c.css("margin-left","8px"),b.append(c)}return b},NL.RenderFunctions.howLongAgo=function(a){var b=$("<span />");return a.date&&b.text(SO.Format.formatValue(a.date,"timeAgo")),b},NL.RenderFunctions.defaultTree=function(a){return $("<span />").text(a.label)},NL.RenderFunctions.schemaWalkerAdvanced=function(a){var b=a.nodePath.substr(a.nodePath.lastIndexOf("/")+1);return $("<span />").append($("<span />").text(a.label),$("<span />").text(" ("+b+")"))},SO.ns("NL.RenderHelpers"),NL.RenderHelpers.toWidgetStatus=function(a){var b="normal";switch(a){case"started":b="primary";break;case"finished":b="success";break;case"canceled":b="error"}return b},NL.RenderFunctions.timelineItem=function(a){var b=NL.RenderHelpers.toWidgetStatus(a.status);return{icon:a.status?a.icon:a.icon+"-inverse",status:b,label:a.label,shortLabel:a.shortLabel?a.shortLabel:a.label}},NL.RenderFunctions.initReportDataTable=function(a,b,c){var d,e,f,g=NL.page.controller.getValue(c+"/"+a.resource+"/content"),h=$("<table></table>").css({border:"1px solid grey",width:"50%"});d=$("<tr></tr>"),f=$("<th></th>").text(a.header1).css({"text-align":"left"}).attr("colspan",2),d.append(f),f=$("<th></th>").text(a.header2).css({"text-align":"left"}),d.append(f),h.append(d);for(var i=["#8CC350","#5A6EAA","#D755A5","#1EBED7","#F0A01E","#9B8CE6","#3CB5A0","#3287D2","#F0557D","#C3D250","#EB782D","#78B4F5","#5FAF69","#AA5FA5","#FA5A50","#F5C841"],j=0;g.length>j;j++)d=$("<tr></tr>"),h.append(d),e=$("<td>&nbsp;&nbsp;</td>").css({"background-color":i[j]}),d.append(e),e=$("<td></td>"),e.text(g[j].label),d.append(e),e=$("<td></td>"),e.text(g[j].volume),d.append(e);b.append(h)};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("NL.Cards"),NL.Cards._render=function(a){"use strict";function b(a,b,c,d,e,h,k){var l,m,n=document.createElement("div"),o=document.createElement("img"),p=document.createElement("div"),q=document.createElement("span"),r=document.createElement("span"),s=document.createElement("h4"),t=e?"nlui-cardfolder":"nlui-cardstandard",u="nlui-card-icon "+f(b);return n.className="nlui-cardmain",j(h)||(m=i(h,k,e),n.appendChild(m)),o.className="nlui-cardimg",o.src=c,o.alt="",o.style.display="none",o.onload=function(){this.style.display="block"},n.appendChild(o),p.className=t,j(b)&&j(a)||(q.className=u,r.className=g(a,b),q.appendChild(r),p.appendChild(q)),l=document.createTextNode(d),s.appendChild(l),p.appendChild(s),n.appendChild(p),n}function c(a,b,c,f,g){var h,i,k=document.createElement("div"),l=document.createElement("div"),m=document.createElement("p"),n=document.createElement("span"),o=(document.createElement("span"),document.createElement("span")),p=document.createTextNode(c),q="nlui-card-editdates";if(j(a)||(h=d(a),k.appendChild(h)),j(b)||(i=e(b),""!=i&&k.appendChild(i)),k.className="nlui-cardinfo",c){if(l.className="nlui-card-dates",m.className=q,n.className="nlui-card-calendar soui-icon-12-card-lastModified",o.className="nlui-card-startenddates",o.appendChild(p),m.appendChild(n),m.appendChild(o),l.appendChild(m),f){var r,s,t=document.createElement("p"),u=document.createElement("span"),v=document.createElement("span");v.className="nlui-card-startenddates",t.className=q,u.className="nlui-card-calendar soui-icon-12-card-planning",t.appendChild(u),r=document.createTextNode(f),v.appendChild(r),g&&(s=document.createElement("br"),v.appendChild(s),r=document.createTextNode(g),v.appendChild(r)),t.appendChild(v),l.appendChild(t)}k.appendChild(l)}return k}function d(a){var b,c=document.createElement("div");return c=document.createElement("div"),c.className="nlui-kpiDesc",b=document.createTextNode(a),c.appendChild(b),c}function e(a){var b,c,d,e,f=document.createElement("div");f=document.createElement("div"),f.className="nlui-kpigroup";for(b in a)c=document.createElement("p"),c.className="nlui-kpi",d="",void 0!==a[b].value&&""!==a[b].value&&(d=document.createTextNode(a[b].value)),"undefined"!=typeof a[b].icon&&(e=document.createElement("span"),e.className="nlui-kpiicon soui-icon-12-"+a[b].icon,c.appendChild(e)),d&&c.appendChild(d),f.appendChild(c);return f}function f(a){return""!==a?"nlui-status-mode-"+a:""}function g(a,b){var c="soui-icon-18-"+a;return""!==b&&(c+="-inverse"),c}function h(a){var b,c,d,e;return a&&(b=document.createElement("div"),b.className="nlui-folder-tab",c=document.createElement("span"),c.className="nlui-folder-edge1",d=document.createElement("span"),d.className="nlui-folder-edge2",e=document.createElement("span"),e.className="nlui-folder-edge3",b.appendChild(c),b.appendChild(d),b.appendChild(e),m.appendChild(b)),b}function i(a,b,c){var d=document.createElement("div"),e=document.createElement("span"),f=document.createTextNode(b);return d=document.createElement("div"),d.className="nlui-card-warning "+(c?"nlui-card-warning-folder":"nlui-card-warning")+" nlui-card-ribbon-"+a,e=document.createElement("span"),e.className="soui-icon-12-card-alert",f=document.createTextNode(b),d.appendChild(e),d.appendChild(f),d}function j(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}if(!(this instanceof NL.Cards._render))return new NL.Cards._render(a);this.cardDetails=a;var k,l="folder"===this.cardDetails.style,m=document.createElement("div"),n=document.createElement("article"),o=document.createElement("a"),p=h(l),q=b(this.cardDetails.icon,this.cardDetails.status,this.cardDetails.image,this.cardDetails.label,l,this.cardDetails.alertMode,this.cardDetails.alertMessage);return m.className="nlui-cards",p instanceof HTMLElement&&m.appendChild(p),n.className="nlui-cardcontent",o.href=a.href||"#",o.appendChild(q),(this.cardDetails.lastModifiedFormatted||this.cardDetails.startDateFormatted||this.cardDetails.endDateFormatted)&&(k=c(this.cardDetails.cardDesc,this.cardDetails.kpis,this.cardDetails.lastModifiedFormatted,this.cardDetails.startDateFormatted,this.cardDetails.endDateFormatted),o.appendChild(k)),n.appendChild(o),m.appendChild(n),m};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("ListHeader",{DEFAULT_OPTIONS:{confId:null,jpath:null,controller:null,search:null,navigator:null},_create:function(){return this.$el.addClass("nlui-listheader"),this._options.search&&this._addSearchInput(),this._options.navigator&&this._addNavigator(),this},_addSearchInput:function(){return this._$searchInput=$('<div class="nlui-listheader-search nlui-listheader-element"></div>'),new SO.Plugin.Search({confId:"search-"+this._options.confId,controller:this._options.controller,jpath:this._options.jpath,wildcard:this._options.search.wildcard,realTime:this._options.controller.getDataSourceCapabilities(this._options.jpath).realTime}).render(this._$searchInput),this.$el.append(this._$searchInput),this},_addNavigator:function(){return this._$navigator=$('<div class="nlui-listheader-navigator nlui-listheader-element"></div>'),new SO.Plugin.FilterNavigator({confId:"navigator-"+this._options.confId,controller:this._options.navigator.source?this._options.navigator.source.controller:this._options.controller,jpath:this._options.navigator.source?this._options.navigator.source.jpath:this._options.jpath,extraController:this._options.controller,extraJpath:this._options.jpath,wildcard:this._options.navigator.wildcard,emptyText:this._options.navigator.emptyText}).render(this._$navigator),this.$el.append(this._$navigator),this}}),$.widget("NL.soListHeader",{_create:function(){this._widget=new SO.Widgets.listHeader(this.element,this.options)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlListInDialog",a.NL.nlWidget,{options:{typeList:"list",onDialogOpen:function(){},onDialogClose:function(){},dialogOptions:{autoOpen:!0,modal:!0,title:"",mode:"maximize",noPrimaryFirstButton:!0},listOptions:{fitToParentHeight:!0},withoutButton:!1},_create:function(){this.cancelButtonId="listInDialogCancelButton_"+SO.Utils.sequence().nextVal(),this.okButtonId="listInDialogOkButton_"+SO.Utils.sequence().nextVal(),this.$okButton=null,this.$cancelButton=null,this.$dialog=null,this.$list=null,this._validateSelection=this.options.listOptions.selection,this._createDialog(),this.options.dialogOptions.autoOpen&&this._initList()},destroy:function(){this.$dialog&&this.$dialog.is(":so-soDialog")&&(this.$dialog.soDialog("destroy"),this.$dialog.remove())},_createDialog:function(){var b,c,d=this,e=this.options.dialogOptions.autoOpen;b=SO.Utils.extend({},this.options.dialogOptions,{autoOpen:!1}),""===b.title&&""!==this.options.listOptions.title&&(b.title=this.options.listOptions.title),this.options.withoutButton===!1&&("mono"===this.options.listOptions.selectionMode?(c=!0,b.buttons=[{text:xtk_core.dialog_cancel(),id:this.cancelButtonId,cancels:!0,mode:"quiet",icon:"coral-closeCircle"},{text:xtk_core.dialog_ok(),mode:"transparent",id:this.okButtonId,icon:"coral-checkCircle"}]):b.buttons=[{text:xtk_core.dialog_close(),cancels:!0,mode:"quiet",icon:"coral-closeCircle"}]),b.open=function(){d._initList(),d.options.onDialogOpen(this),null!==d.$list&&(SO.isNundef(d.options.listOptions.selection)||d.$okButton.soSimpleButton("setDisabled",!1))},b.close=function(){d._resetToValidateSelection(),d.options.onDialogClose(this)},this.$dialog=a("<div></div>").soDialog(b),e&&this.$dialog.soDialog("open"),c===!0&&this._bindValidationCallback()},_bindValidationCallback:function(){var a=this;this.$cancelButton=this.$dialog.soDialog("getButton",this.cancelButtonId),this.$okButton=this.$dialog.soDialog("getButton",this.okButtonId),SO.isNundef(this.options.listOptions.selection)&&this.$okButton.soSimpleButton("setDisabled",!0),this.$okButton.soSimpleButton("setOptions",{onClick:function(){var b,c;SO.isNundef(a.options.listOptions.onDblClick)||(b=NL.Widgets.callWidgetMethod(a.$list,"getValue"),c=NL.Widgets.callWidgetMethod(a.$list,"getValue"),a._validateSelection=b,a.options.listOptions.onDblClick(c)),a.$dialog.soDialog("close")}}),this.$cancelButton.soSimpleButton("setOptions",{onClick:function(){a.$dialog.soDialog("close")}})},_initList:function(){var b,c=this,d={};null===this.$list&&(d=SO.Utils.extend({},this.options.listOptions),d.dialog=!1,d.onDblClick=function(a){SO.isNundef(c.options.listOptions.onDblClick)||c.options.listOptions.onDblClick(a),c._validateSelection=a,c.$dialog.soDialog("close")},d.onSelection=function(a){null!==c.$okButton&&c.$okButton.soSimpleButton("setDisabled",SO.isNundef(a)),SO.isNundef(c.options.listOptions.onSelection)||c.options.listOptions.onSelection(a)},this.$list=a("<div></div>"),d.fitToParentHeight&&this.$list.css({width:"100%",height:"100%"}),"treeList"===this.options.typeList?(void 0===this.options.renderingMethods&&(this.options.renderingMethods={defaultTreeRender:{renderer:NL.RenderFunctions.defaultTree,label:"",icon:"",family:"treeNode"}}),this.$dialog.soDialog("setContent",this.$list),this.$list=this.$list.soTreeList(d)):(b=a("<div></div>"),new SO.Widgets.ListHeader(b,{confId:d.confId,controller:d.controller,jpath:d.jpath,search:{wildcard:d.searchWildcard}}),this.$dialog.soDialog("setContent",[b,this.$list]),this.$list=this.$list.soList(d))),NL.Widgets.callWidgetMethod(this.$list,"focusSearchInput")},_resetToValidateSelection:function(){NL.Widgets.callWidgetMethod(this.$list,"setValue",[this._validateSelection])},selection:function(a){return a?(this.options.listOptions.selection=a,this._validateSelection=a,null!==this.$list&&NL.Widgets.callWidgetMethod(this.$list,"setValue",a),void 0):null!==this.$list?NL.Widgets.callWidgetMethod(this.$list,"getValue"):null},openDialog:function(){this.$dialog.soDialog("open"),NL.Widgets.callWidgetMethod(this.$list,"rebuildLayout")},closeDialog:function(){this.$dialog.soDialog("close")},getList:function(){return this.$list}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a,b,c,d){a.widget("NL.nlPickList",{options:{movingMode:"copy",controller:null,sourceList:{sortMethod:function(){},jpath:null,key:null,title:""},targetList:{jpath:null,title:"",key:null},onChange:function(){}},_create:function(){this._selectedList=null,this._listSpacing=10,this._originalPositions={},this._sourceListKeys=this.options.controller.getKeys(this.options.sourceList.jpath),this._oppositeList={source:"target",target:"source"},this._isEmptyList={source:!1,target:!1},this._selectedElements={source:{},target:{}};var a=this._initList(this.options.sourceList,"source");this._$sourceList=a.list,this._$sourceListContainer=a.listContainer;var b=this._initList(this.options.targetList,"target");this._$targetList=b.list,this._$targetListContainer=b.listContainer,this._moveButtonSource=null,this._moveButtonTarget=null,this._controller=this.options.controller,this._moveUp=null,this._moveDown=null,this._controller.addFilter(this.options.sourceList.jpath,{wildcard:"dataFilter"}),this._buildMarkup()},_moveSourceToTarget:function(a,b){for(var c=this._selectedElements.source.item,d=this.options.controller.getValue("targetList"),e=!1,f=0;d.length>f&&!(e=this.options.controller.areKeysEqual("targetList",c,d[f]));f++);if(!e){if("cut"===this.options.movingMode){var g=c[this.options.sourceList.key];this._controller.applyFilter(this.options.sourceList.jpath,"dataFilter",g,!0),this._$sourceList.soList("refresh",null)}b.splice(b.length,0,c),this.options.onChange(b),a.setValue(this.options.targetList.jpath,b,!1),this._selectMovedElement(this._$targetList,"target",c,b),this._gotoMovedElement(this._$targetList)}},_selectMovedElement:function(a,b,c,d){a.soList("refresh",null);var e="target"===b?"source":"target";a.soList("refresh",null),a.soList("setValue",c),this._selectedElements.target.item=c,this._selectedElements.target.position=d.length-1,this._resetSelection(e),this._selectedList=b,this._changeMoveButtonsStates()},_gotoMovedElement:function(a){var b=a[0].scrollHeight,c=a.height(),d=b-c;a.animate({scrollTop:d},750)},_moveTargetToSource:function(a,b){var c=this._selectedElements.target.item,d=this._selectedElements.target.position;b.splice(d,1),this.options.onChange(b),a.setValue(this.options.targetList.jpath,b,!1),this._$targetList.soList("refresh",null),"cut"===this.options.movingMode?(this._controller.applyFilter(this.options.sourceList.jpath,"dataFilter",null,!0),this._selectMovedElement(this._$sourceList),this._gotoMovedElement(this._$sourceList,"source",c,b)):(this._selectedList=null,this._changeMoveButtonsStates()),this._resetSelection("target")},_moveElements:function(a){var b=this.options.controller,c=b.getValue(this.options.targetList.jpath),d=b.getValue(this.options.sourceList.jpath);"targetToSource"===a?this._moveTargetToSource(b,c,d):this._moveSourceToTarget(b,c)},_resetSelection:function(a){this._selectedElements[a]={},"source"===a?this._$sourceList.soList("setValue",null):this._$targetList.soList("setValue",null)},_buildMarkup:function(){this.element.addClass("nlui-pickList");var b=a('<div class="nlui-picklist-listcontainer">'),c=this.options.width,d=this.options.height,e=parseInt(c/2,10);b.width(c+this._listSpacing),this._$sourceListContainer.css({width:e+"px"}),this._$targetListContainer.css({width:e+"px","margin-left":"10px"}),this._$sourceList.css({width:e+"px","max-height":d+"px"}),this._$targetList.css({width:e+"px",height:d+"px","max-height":d+"px"}),this._buildListHeader("source",this._$sourceListContainer),this._buildListHeader("target",this._$targetListContainer),b.append(this._$sourceListContainer,this._$targetListContainer).appendTo(this.element),SO.Widgets.LayoutManager.rebuildLayout(this.element)},_changeMoveButtonsStates:function(){var a=this._selectedList;"source"===a?(this._moveButtonSource.enable(!0),this._moveButtonTarget.disable(!0)):"target"===a?(this._moveButtonTarget.enable(!0),this._moveButtonSource.disable(!0)):a||(this._moveButtonTarget.disable(!0),this._moveButtonSource.disable(!0))},_createListOrdering:function(b){var c=this,e=a("<div class='nlui-picklist-orderbuttons'></div>");this._moveUp=new SO.Widgets.Button(e,{icon:"nlui-icon-list-move-up",label:d,flat:!0,disabled:!0,leftRounded:!1,rightRounded:!1,onClick:function(){if("target"===c._selectedList){var a=c._selectedElements.target.position;a>0&&c._controller.moveCollectionItem(c.options.targetList.jpath,a,a-1,!0)}}});var f=a("<div class='nlui-picklist-orderbuttons'></div>");this._moveDown=new SO.Widgets.Button(f,{icon:"nlui-icon-list-move-down",label:d,flat:!0,disabled:!0,leftRounded:!1,rightRounded:!1,onClick:function(){if("target"===c._selectedList){var a=c._selectedElements.target.position,b=c._controller.getValue(c.options.targetList.jpath);b.length>a&&c._controller.moveCollectionItem(c.options.targetList.jpath,a,a+1,!0)}}}),b.append(e,f)},_buildListHeader:function(b,c){var d=a("<div class='nlui-picklist-header'></div>"),e="source"===b?this.options.sourceList.title:this.options.targetList.title,f=a("<div class='nlui-picklist-listtitle'></div>").text(e),g=a("<div class='nlui-picklist-toolbar'></div>"),h=this._addMoveButton(b);"source"===b?h.appendTo(g):"target"===b&&("move"===this.options.movingMode?(h.appendTo(g),this._createListOrdering(g)):(this._createListOrdering(g),h.appendTo(g))),d.append(f,g),c.prepend(d)},_addMoveButton:function(b){var c=this;if("target"===b){var e="copy"===this.options.movingMode?"nlui-icon-delete":"nlui-icon-wizard-previous",f=a("<div class='nlui-picklist-movebutton-target'></div>");return this._moveButtonTarget=new SO.Widgets.Button(f,{icon:e,label:d,flat:!0,disabled:!0,leftRounded:!1,rightRounded:!1,onClick:function(){c._moveElements("targetToSource")}}),f}var f=a("<div class='nlui-picklist-movebutton-source'></div>");return this._moveButtonSource=new SO.Widgets.Button(f,{icon:"nlui-icon-wizard-next",label:d,flat:!0,disabled:!0,leftRounded:!1,rightRounded:!1,onClick:function(){c._moveElements("sourceToTarget")}}),f},_initList:function(b,c){var d=this,e=this.options.controller,f="source"===c?"nlui-picklist-listsource":"nlui-picklist-listtarget",g=a("<div class='nlui-picklist-wrapper'></div>"),h=function(a,b){for(var c=b.filters,e=0;c.length>e;e++){var f=c[e];if(-1!==a[d.options.sourceList.key].indexOf(f.value))return!1}return!0},i="source"===c?h:null,j=a("<div class='"+f+"'></div>").soList({controller:e,jpath:b.jpath,selectionMode:"mono",selectable:!0,search:!1,fakeColumn:!1,counter:!1,headless:!0,pagination:null,postFilter:i,postSort:function(a,b){return d.options.sourceList.sortMethod(a,b)},onSelection:function(a,e){if(d._selectedElements[c].item=a.getItem(),d._selectedElements[c].position=e,d._selectedList=c,d._resetSelection(d._oppositeList[c]),d._changeMoveButtonsStates(),"target"===c){d._moveUp.enable(!0),d._moveDown.enable(!0),0===e&&d._moveUp.disable(!0);var f={onSuccess:function(a){e===a.length-1&&d._moveDown.disable(!0)},onError:function(){}};d._controller.getCollection(b.jpath,0,null,f,!1)}},defaultRendering:"custom",renderingMethods:{custom:{family:"line",icon:"",label:"",renderer:function(a){return a[b.key]}}}});return g.append(j),{list:j,listContainer:g}},_destroy:function(){}})})(jQuery,window,document);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("ReportTable",{DEFAULT_OPTIONS:{controller:null,jpath:null,rowDefinition:null,emptyArea:null},_create:function(){this._controller=this._options.controller,this._jpath=this._options.jpath,this._$table=null,this._$emptyArea=null,this._currentJob=null,this.$el.addClass("nlui-report-table-container"),this._buildMarkup(),this._fetchData()},_buildMarkup:function(){var a;null===this._options.emptyArea?a=this.$el:(a=$("<div></div>").css("width",100-this._$emptyArea.zoneWidth).appendTo(this.$el),this._$emptyArea=$("<div></div>").css("width",this._$emptyArea.zoneWidth).appendTo(this.$el)),this._$table=$("<table></table>").addClass("nlui-report-table-table").appendTo(a)},_fetchData:function(){var a=this,b={onSuccess:function(b){a._render(b)},onError:function(){},onComplete:function(){a._currentJob=null}};this._currentJob=this._controller.getCollection(this._jpath,0,0,b,!0)},_render:function(a){this._renderHeader();for(var b=0;a.length>b;b++)this._renderLine(a[b])},_renderHeader:function(){var a,b,c,d,e;if(d=$("<tr></tr>").addClass("nlui-report-table-header").appendTo(this._$table),this._options.rowDefinition&&this._options.rowDefinition.headerLine&&this._options.rowDefinition.headerLine.length>0){c=this._options.rowDefinition.headerLine;for(var a=0;c.length>a;a++)e=c[a],b=$("<th>"+e.name+"</th>").attr("colspan",SO.Utils.getValueFromObj(e,"colspan",1)).appendTo(d)}},_renderLine:function(a){var b,c,d,e,f;if(e=$("<tr></tr>").addClass("nlui-report-table-data").appendTo(this._$table),this._options.rowDefinition&&this._options.rowDefinition.dataLine&&this._options.rowDefinition.dataLine.length>0){d=this._options.rowDefinition.dataLine;for(var b=0;d.length>b;b++)f=d[b],c=this._generateCell(f,a).appendTo(e)}},_generateCell:function(a,b){var c,d,e;switch(a.formatType){case"number":e="nlui-report-table-number",d=SO.Integer.parse(b[a.path]);break;case"money":e="nlui-report-table-money",d=b[a.path];break;case"shortDate":case"longDate":e="nlui-report-table-date",d=SO.Format.formatValue(b[a.path],a.formatType);break;case"percent":case"percent_0":case"percent_1":case"percent_2":e="nlui-report-table-number",d=SO.Format.formatValue(b[a.path],a.formatType);break;default:e="nlui-report-table-string",d=b[a.path]}return c=$("<td>"+d+"</td>").attr("colspan",SO.Utils.getValueFromObj(a,"colspan",1)).addClass("nlui-report-table-cell "+e)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){var b={options:{colCount:1,labelPosition:"above",spacerHeight:15,iconPosition:"left",iconSize:18,inputs:[]},_create:function(){this.element.addClass("nlui-fieldSet"),this._$wrapper=a('<div class="nlui-fieldset-wrapper"></div>').appendTo(this.element),this._$table=a('<table class="nlui-fieldset-table"></table>').appendTo(this._$wrapper),this._inputsCollection=this.options.inputs,this._colCount=this.options.colCount,this._buildInputs(),this.options.layoutManager.registerWidget(this)},_destroy:function(){for(var a=0,b=this._inputsCollection.length;b>a;a++){var c=this._inputsCollection[a];c&&c.element instanceof jQuery&&c.element.detach()}this.element.children().remove(),this.element.removeClass("nlui-fieldSet")},rebuildLayout:function(){var b=this.element.width();500>b&&this._colCount>=1?this._refresh(1):800>b&&this._colCount>=2?this._refresh(2):this._refresh(this.options.colCount),a(".nlui-fieldset-auto",this._$table).each(function(){a(this).parent().parent().width(a(this).width())})},_refresh:function(a){this._colCount=a;for(var b=0;this._inputsCollection.length>b;b++){var c=this._inputsCollection[b];c&&c.element&&c.element.detach()}this._$table.empty(),this._buildInputs()},_lineHasIcon:function(a){var b=a*this.options.colCount-1;0>b&&(b=0);for(var c=b+(this.options.colCount-1),d=b;c>d;d++)if(this._inputsCollection[d]&&this._inputsCollection[d].icon)return!0;return!1},_buildInputs:function(){for(var b,c=Math.ceil(this._inputsCollection.length/this._colCount),d=0,e=0;c>e;e++){var f=a("<tr></tr>");b=0;for(var g=0,h=!1,i=0;this._colCount>i;i++){b++;var j=this._inputsCollection[d];if(SO.isNundef(j)||null===j.element){var k=a("<td class='nlui-fieldset-column'></td>");f.append(k),d+=1,g+=1,g===this._colCount&&(h=!0)}else{var l=this.options.labelPosition,m=j.icon,n=this.options.iconPosition,o=SO.Number.isNaN(parseInt(j.colspan,10))?1:j.colspan,p=j.element;o-1>=this._colCount&&(o=1);var q=a('<td class="nlui-fieldset-innercolumn-blank"></td>'),k=a("<td class='nlui-fieldset-column'></td>"),r=a('<td class="nlui-fieldset-innercolumn-blank"></td>'),s=a('<div class="nlui-fieldset-content"></div>'),t=a('<div class="nlui-fieldset-content"></div>'),u=a('<div class="nlui-fieldset-content"></div>');if(p instanceof jQuery&&"above"!==l&&(u.appendTo(k),u.append(p)),"none"===l&&(j.label=null,l="left"),j.noLabel&&(j.label=a("<span></span>").html("&nbsp;")),SO.isObject(j.label)&&(q.removeClass("nlui-fieldset-innercolumn-blank"),t.appendTo(q),t.append(j.label),j.label.addClass("nlui-text-regular"),0===i&&j.label.css("padding-left",0),("left"===l||"right"===l)&&(j.label.addClass("nlui-fieldset-label nlui-fieldset-auto"),t.addClass("nlui-fieldset-label-constraint"),t.css("padding-right",0))),m){r.removeClass("nlui-fieldset-innercolumn-blank");var v=SO.IMG.genIcon(m,this.options.iconSize).addClass("nlui-fieldset-auto");s.append(v),s.appendTo(r)}if("left"===l&&"left"===n)o>1&&(k.attr("colspan",3*(o-1)+1),i+=o-1,c++),f.append(r,q,k);else if("right"===l&&"left"===n)f.append(r,k,q);else if("left"===l&&"right"===n)f.append(q,k,r);else if("right"===l&&"right"===n)f.append(k,r,q);else if("above"===l){var w=a('<div  class="nlui-fieldset-innertable"></div>'),x=a('<div  class="nlui-fieldset-innerrow"></div>'),y=a('<div  class="nlui-fieldset-innerrow"></div>');if(i+(o-1)===this._colCount-1&&(y.css("padding-right",0),x.css("padding-right",0)),y.append(p),m){var z=a('<div class="nlui-fieldset-innercolumn"></div>'),A=a('<div class="nlui-fieldset-innercolumn"></div>');s.removeClass("nlui-fieldset-content"),z.append(s),A.append(j.label),A.addClass("nlui-fieldset-icon-withlabel"),A.css("line-height",this.options.iconSize+"px"),x.append(z,A),w.append(x,y)}else j.label?(this._lineHasIcon(e)&&(x.addClass("nlui-fieldset-icon-withlabel"),x.css("line-height",this.options.iconSize+5+"px")),x.append(j.label),w.append(x,y)):(x.remove(),w.append(y));k.append(w),k.attr("width",parseFloat(100/this._colCount)+"%"),o>1&&(k.attr("colspan",o),i+=o-1,c++),f.append(k)}d++}}if(!h){f.appendTo(this._$table);var B=a("<tr></tr>");B.height(this.options.spacerHeight);var C=a("<td></td>");C.attr("colspan",3*(this._colCount-1)+1),B.append(C),B.appendTo(this._$table)}}}};a.widget("NL.nlFieldSet",a.NL.nlWidget,b)})(jQuery,window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlFormNavController",a.NL.nlWidget,{options:{controller:void 0,forms:[],value:0,transition:void 0},oldValue:-1,oldForm:void 0,_create:function(){var b=this;this.options.transition||(this.options.transition=this._transition),a.each(this.options.forms,function(a,c){SO.assert(b.options.controller===c.nlForm("controller")),a===b.options.value?c.show():c.hide()}),this._refreshValue()},value:function(a){return void 0===a?this._value():(this._setOption("value",a),this)},_setOption:function(b,c){"value"===b&&(this.options.value=c,this._refreshValue(!0)),a.NL.nlWidget.prototype._setOption.apply(this,arguments)},_value:function(){var a=this.options.value;return a},_transition:function(a,b){a&&a.hide(),b.show()},_refreshValue:function(a){void 0===a&&(a=!1);var b=this.value();if(b!==this.oldValue){var c=a||this._canNavigate();if(c){var d=this.oldForm;this.oldForm=this.options.forms[b];var e=this.oldForm,f=this.options.transition;f(d,e)}}},_canNavigate:function(){var a=!0;return void 0!==this.oldForm&&(a=this.options.controller.check().valid,a||this.oldForm.nlForm("refresh")),a},next:function(a){var b=this.value(),c=this.options.forms.length;b=(b+1)%c,this.options.value=b,this._refreshValue(a)},previous:function(a){var b=this.value(),c=this.options.forms.length;b=(c+b-1)%c,this.options.value=b,this._refreshValue(a)},canNavigate:function(){return this._canNavigate()},currentForm:function(){var a=this.value();return-1===a?null:this.options.forms[a]}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Kpi",{_modeClasses:{"default":"nlui-kpi-mode-default",primary:"nlui-kpi-mode-primary",error:"nlui-kpi-mode-error",success:"nlui-kpi-mode-success",warning:"nlui-kpi-mode-warning"},DEFAULT_OPTIONS:{title:null,primaryText:null,primaryTextFormat:null,secondaryText:null,secondaryTextFormat:null,primaryMode:"default"},_create:function(){this.$el.addClass("nlui-kpi"),this._$wrapper=$('<div class="nlui-kpi-wrapper"></div>').appendTo(this.$el),this._$primaryText=$('<div class="nlui-kpi-primary-text"></div>').appendTo(this._$wrapper),this._refreshAll()},_refreshAll:function(){this._refreshTitleText(),this._refreshPrimaryText(),this._refreshSecondaryText(),this._refreshPrimaryMode()},_refreshTitleText:function(){SO.isNundef(this._options.title)||(this._$title||(this._$title=$('<div class="nlui-kpi-title"></div>').insertBefore(this._$primaryText)),this._$title.text(this._options.title))},_refreshPrimaryText:function(){SO.assert(null!==this._options.primaryText,"Primary text is mandatory");var a=SO.Format.formatValue(this._options.primaryText,this._options.primaryTextFormat,{locale:this._options.locale,timezone:this._options.timezone});this._$primaryText.text(a)},_refreshPrimaryMode:function(){var a,b=this;SO.Utils.each(b._modeClasses,function(a,c){b._$wrapper.removeClass(c)}),a=b._modeClasses[this._options.primaryMode],SO.assert(void 0!==a,"Invalid primaryMode ["+this._options.primaryMode+"] for KPI"),b._$wrapper.addClass(a)},_refreshSecondaryText:function(){if(!SO.isNundef(this._options.secondaryText)){this._$secondaryText||(this._$secondaryText=$('<div class="nlui-kpi-secondary-text"></div>').appendTo(this._$wrapper)),this._options.secondaryText===this._options.primaryText&&(this._options.secondaryText=null);var a=SO.Format.formatValue(this._options.secondaryText,this._options.secondaryTextFormat,{locale:this._options.locale,timezone:this._options.timezone});this._$secondaryText.text(a)}},setTitle:function(a){this._options.title=a,this._refreshTitleText()},setPrimaryTextFormat:function(a,b){this._options.primaryTextFormat=a,void 0!==b&&(this._options.primaryText=b),this._refreshPrimaryText()},setPrimaryText:function(a){this._options.primaryText=a,this._refreshPrimaryText()},setSecondaryTextFormat:function(a,b){this._options.secondaryTextFormat=a,void 0!==b&&(this._options.secondaryText=b),this._refreshSecondaryText()},setSecondaryText:function(a){SO.isNundef(a)||(this._options.secondaryText=a,this._refreshSecondaryText())},setPrimaryMode:function(a){this._options.primaryMode=a,this._refreshPrimaryMode()},destroy:function(){this.$el.removeClass("nlui-kpi"),this.$el.children().remove()},setLocale:function(a){this._super(a),this._refreshAll()},setTimezone:function(a){this._super(a),this._refreshAll()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("simpleNotebook",{DEFAULT_OPTIONS:{tabs:[],height:null,contentDriven:!0,defaultSelected:null,layout:"Horizontal",icon:void 0,className:"",defaultContent:null,onSelect:function(){}},_create:function(){var a=this;this._maxChars="vertical"===this._options.layout?15:25,this._tabs=[],this.$ul=void 0,this.$contents=void 0,this.$page=void 0,this.$defaultContent=void 0,this._selectedTab=void 0,this.$el.addClass("nlui-simplenotebook"),"vertical"===this._options.layout?this.$el.addClass("nlui-vertical-simplenotebook"):this.$el.addClass("nlui-horizontal-simplenotebook"),this.$ul=$('<ul class="nlui-simplenotebook-nav"></ul>').appendTo(this.$el),this.$contents=$("<div />").addClass("nlui-simplenotebook-content").appendTo(this.$el),SO.isEmpty(a._options.defaultContent)||(this.$defaultContent=$('<div class="default-content"></div>').append(a._options.defaultContent).appendTo(this.$contents));for(var b=0;a._options.tabs.length>b;b++){if(void 0===a._options.tabs[b].id)throw new Error("id mandatory");a.addTab(a._options.tabs[b],!0,!1)}a._updateLayout()},addTab:function(a,b,c){void 0===a.display&&(a.display=!0),void 0===a.icon&&(a.icon=this._options.icon),void 0===a.className&&(a.className=this._options.className),SO.assert(!SO.isEmpty(a.label),"Tab labels should be defined for the notebook widget, instead seen :"+a.label),a.fullCaption=SO.isString(a.label)?a.label:"",SO.isObject(a.content)&&$(a.content).hide(),this._tabs.push(a),c&&(this._selectedTab=a),b||this._updateLayout()},showTab:function(a){var b=this._getTab(a);b.display=!0,this._updateLayout()},hideTab:function(a){var b=this._getTab(a);b.display=!1,this._updateLayout()},setTabOption:function(a,b,c,d){var e={};e[b]=c,this.setTabOptions(a,e,d)},setTabOptions:function(a,b,c){var d;d="string"==typeof a?this._getTab(a):this._tabs[a],d&&($.each(b,function(a,b){d[a]=b}),c!==!0&&this._updateLayout())},_drawTab:function(a){var b=this,c=$('<li class="nlui-simplenotebook-tab"></li>').data("tabId",a.id).addClass(a.className).appendTo(this.$ul);if(a.$li=c,a.icon){var d=a.icon+"-disabled",e="soui-icon-18-"+d,f="soui-icon-18-"+a.icon,g=SO.IMG.genIcon(d,18).appendTo(c);this._bindIconHover(a),a.$icon=g,a.inactiveIconClassName=e,a.activeIconClassName=f}if(!SO.isEmpty(a.label)){var h=$('<span class="nlui-simplenotebook-tab-label"></span>').appendTo(c);h.text(a.label),a.$labelWrapper=h}a.fullCaption.length>this._maxChars&&b._setTooltip(c,a.fullCaption),SO.Event.bind(c,"vclick",function(){b._tabClicked(a.id)})},_bindIconHover:function(a){a.$li.hover(function(){a.$icon.removeClass().addClass(a.activeIconClassName)},function(){a.$icon.removeClass().addClass(a.inactiveIconClassName)})},_tabClicked:function(a){this._select(this._getTab(a))},switchTab:function(a){SO.isEmpty(a)||this._select(this._getTab(a))},_select:function(a){SO.assert(a&&a.id,"In Notebook widget, tried to select a tab with an unexisting ID or index.");var b=null;if(this._selectedTab&&(b=this._selectedTab.id,this._selectedTab.$li.removeClass("nlui-state-selected"),this._selectedTab.$li.is(":so-soTooltip")&&this._selectedTab.$li.soTooltip("enable"),SO.isEmpty(this._selectedTab.label)||this._selectedTab.$labelWrapper.text(this._selectedTab.label),this._selectedTab.$icon&&(this._selectedTab.$icon.removeClass().addClass(this._selectedTab.inactiveIconClassName),this._bindIconHover(this._selectedTab)),this._selectedTab.$page&&this._selectedTab.$page.hide(),this._selectedTab=null),this.$defaultContent&&this.$defaultContent.hide(),this._selectedTab=a,a.$li.addClass("nlui-state-selected"),a.$icon&&(a.$icon.removeClass().addClass(a.activeIconClassName),a.$li.unbind("hover")),!a.$page){var c,d=$("<div />").addClass("nlui-simplenotebook-page");a.$page=d,this.$contents.append(d),SO.isFunction(a.content)?(c=a.content(),d.append(c)):SO.isFunction(a.attachContent)?a.attachContent(d):(c=$(a.content),c.appendTo(d))}a.$page.show(),a.$labelWrapper&&(a.fullCaption.length<this._maxChars?(this._selectedTab.$li.is(":so-soTooltip")&&a.$li.soTooltip("disable"),a.$labelWrapper.text(a.fullCaption)):SO.isEmpty(a.label)||a.$labelWrapper.text(a.label)),this._options.onSelect(this._selectedTab.id,a.$page,b)},_removeTab:function(a){var b,c,d,e=this;b=e._getTab(a),c=b.$li,d=b.$page,c.soTooltip("hide"),c.slideUp(250,function(){c.remove();var f=-1;$.each(e._tabs,function(a,c){return b.id===c.id?(f=a,!1):void 0}),d.remove(),e._tabs.splice(f,1),b.id===e._selectedTab.id&&e._tabs.length>0&&(f>=e._tabs.length&&f--,e._select(e._tabs[f])),!e._tabs.length&&e.$defaultContent&&(e.$defaultContent.show(),e._updateLayout()),e._options.onRemove(a)})},_updateLayout:function(){var a,b,c=this.$el,d=this;d.$ul.empty();for(var e=0;d._tabs.length>e;e++)d._tabs[e].display&&(b||(b=d._tabs[e]),d._drawTab(d._tabs[e]),d._tabs[e].selected===!0&&(d._selectedTab=d._tabs[e]));if(d._tabs.length>0)if(d._selectedTab&&d._selectedTab.display)d._select(d._selectedTab);else if(SO.isNundef(this._options.defaultSelected))b&&d._select(b);else if(SO.isNumber(this._options.defaultSelected))d._select(d._tabs[this._options.defaultSelected]);else{var f=this._getTab(this._options.defaultSelected).index;d._select(d._tabs[f])}else d.$defaultContent&&d.$defaultContent.show();if("vertical"===this._options.layout){var g=0;SO.isNundef(this._options.height)||c.css("height",this._options.height),g=this.$ul.outerWidth(),this.$contents.css("left",g)}else{var a=this.$ul.children(".nlui-simplenotebook-tab:first");a.addClass("firstTab"),SO.isNundef(this._options.height)||c.css("height",this._options.height)}this._options.contentDriven||c.addClass("nlui-simplenotebook-verticalExpand")},_setTooltip:function(a,b){var c="e";c="vertical"===this._options.layout?"e":"s",SO.assert(-1===b.indexOf("[object")),a.attr("original-title",b).soTooltip({gravity:c})},_getTab:function(a){var b=this,c={index:0};return $.each(b._tabs,function(b,d){return a===d.id?(c=SO.Utils.extend(d,{index:b}),!1):void 0}),c}}),$.widget("SO.soSimpleNotebook",{_create:function(){this._widget=new SO.Widgets.simpleNotebook(this.element,this.options)},addTab:function(a,b,c){this._widget.addTab(a,b,c)},showTab:function(a){this._widget.showTab(a)},hideTab:function(a){this._widget.hideTab(a)},setTabOption:function(a,b,c,d){this._widget.setTabOption(a,b,c,d)},setTabOptions:function(a,b,c){this._widget.setTabOptions(a,b,c)},switchTab:function(a){this._widget.switchTab(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlSection",a.NL.nlWidget,{options:{content:null,topright:null,style:"section"},$content:void 0,$topright:void 0,_create:function(){var b=this.element.children().detach(),c=this.options.style;(null===c||void 0===c)&&(c="section"),"none"!==c&&"section"!==c&&"subsection"!==c&&(SO.log.warn("Invalid style ["+c+"] for section. Using default",this),c="section"),"none"===c&&(c="section-base"),a(this.element).addClass("ui-widget ui-corner-all"),a(this.element).addClass("nlui-section-base nlui-"+c),this.options.topright&&(this.$topright=a("<div></div>").addClass("nlui-section-base-topright").appendTo(this.element)),this.$content=a("<div></div>").addClass("nlui-section-base-contents nlui-"+c+"-contents").appendTo(this.element),(null===this.options.content||void 0===this.options.content)&&(this.options.content=b),this._refreshContent(),this._refreshTopRight()},destroy:function(){},_setOption:function(b,c){"content"===b&&(this.options.content=c,this._refreshContent()),"topright"===b&&(this.options.topright=c,this._refreshTopRight()),a.NL.nlWidget.prototype._setOption.apply(this,arguments)},_refreshContent:function(){null!==this.options.content&&void 0!==this.options.content&&(this.$content.children().remove(),a(this.options.content).appendTo(this.$content))},_refreshTopRight:function(){null!==this.options.topright&&void 0!==this.options.topright&&(this.$topright.children().remove(),a(this.options.topright).appendTo(this.$topright))}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlNavBar",a.NL.nlWidget,{options:{title:"",back:void 0,showBack:!1,onBack:void 0},$backButton:void 0,$title:void 0,_create:function(){var b=this;this.element.addClass("nlui-navBar"),this.$backButton=a("<button></button").button().css("display","none").addClass("back").appendTo(this.element),this.$title=a("<h1></h1>").appendTo(this.element),this.$backButton.click(function(){b.options.onBack&&b.options.onBack()})},destroy:function(){},_setOption:function(b,c){"title"===b&&(this.options.title=c,this.$title.text(c)),"back"===b&&(this.options.back=c,this.$backButton.text(SO.String.ellipsis(c,10))),"showBack"===b&&(this.options.showBack=c,c?this.$backButton.show():this.$backButton.hide()),a.NL.nlWidget.prototype._setOption.apply(this,arguments)}}),a.widget("NL.nlNavController",a.NL.nlWidget,{options:{},navigationStack:[],$navBar:void 0,$navViewContainer:void 0,_create:function(){var b=this;this.element.addClass("nlui-navController"),this.$navBar=a("<div></div>").nlNavBar({onBack:function(){b.pop()}}).appendTo(this.element),this.$navViewContainer=a("<div></div>").addClass("navViewContainer").appendTo(this.element)},destroy:function(){},_setOption:function(){a.NL.nlWidget.prototype._setOption.apply(this,arguments)},_show:function(b){var c=this.$navViewContainer,d=c.offset().left+c.outerWidth()-c.innerWidth(),e=c.offset().top+c.outerHeight()-c.innerHeight(),f=c.innerWidth(),g=this.$navViewContainer.children(),h=this.navigationStack.length;if(0!==h){var i=this.navigationStack[h-1];if(i.$element){var j=a("<div></div>").addClass("slide").appendTo(this.$navViewContainer);i.$element.appendTo(j),b?(j.offset({left:d+f,top:e}),g.offset({left:d,top:e}),j.animate({left:0},{complete:function(){g.detach(),j.offset({left:d,top:e})}}),g.animate({left:-f})):(j.offset({left:d-f,top:e}),g.offset({left:d,top:e}),j.animate({left:0},{complete:function(){g.remove(),j.offset({left:d,top:e})}}),g.animate({left:f}))}if(this.$navBar.nlNavBar("option","title",i.title),h>1){var k=this.navigationStack[h-2];this.$navBar.nlNavBar("option","back",k.title),this.$navBar.nlNavBar("option","showBack",!0)}else this.$navBar.nlNavBar("option","showBack",!1)}},push:function(a){this.navigationStack.push(a),this._show(!0)},pop:function(){0!==this.navigationStack.length&&(this.navigationStack.pop(),this._show(!1))}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";function Navigation(a,b,c){this.reloadCallback=a,this.countCallback=b,this.options=c||{},this.resetData(),this.listeners=[]}function AjaxList(a,b,c,d,e,f,g,h){this.controller=a,this.sListIdent=b,this.sQuery=c,this.sControllerPath="",this.refreshId="",""!=e&&(this.sControllerPath="/"!=e[0]?"/ctx/vars/"+e:"/ctx"+e),this.eXMLNfo=null,""!=d&&(this.eXMLNfo=parseXMLString(d).documentElement),this.iCellPerLine=0==f?1:f,this.fnLineTemplate=g,this.strServerUrl=window.location.protocol+"//"+window.location.host,this.colCount=1,this.sortingData={elCustomOrderBy:parseXMLString("<orderBy><node sort='true'/></orderBy>").documentElement,bUseCustomOrderBy:!1,sortedColumnsImagesRefs:{}};var i=document.controller.getValue("/ctx/@_console");if(this.strViewLink=null,this.strViewLinkEnd="","string"==typeof h&&""!==h){var j=parseXMLString(h).documentElement,k=NL.View.toUrl(j,i,!0,!0);k&&(this.strViewLink="<a",i||(this.strViewLink+=" target='_parent'"),this.strViewLink+=" class='linkProcess' href='"+k,this.strViewLink+=i?"&amp;pk=":"&amp;id=",this.strViewLinkEnd="</a>")}}function showHideBlock(a){var b=document.getElementById(a);if(void 0!=b){var c=document.getElementById("url"+a),d=document.getElementById("img"+a);"none"!=b.style.display&&b.style.display?(d&&(d.src=d.src.replace("filterDown.png","filterRight.png")),b.style.display="none",void 0!=c&&(c.style.fontWeight="normal")):(d&&(d.src=d.src.replace("filterRight.png","filterDown.png")),b.style.display="block",void 0!=c&&(c.style.fontWeight="bold"))}}function percent(a){return NL.Locale.formatPercent(a-0,0,"N/A")}function ellipsis(a,b){var c=a.encodeHtml();return a.length>b?"<p title='"+c.replace(/'/g,"&apos;")+"'>"+a.substr(0,b).encodeHtml()+"..."+"</p>":c}function htmlImg(a){var b="";if("string"==typeof a&&""!=a){var c=SO.route(a,"reverse_img");b="<img style='float:left;' class='linkAction' src='"+c+"'/>"}return b}var DEFAULT_NB_LINES_PER_PAGE=5,NAVIGATION_TYPE_SCROLLING=0,NAVIGATION_TYPE_PAGE=1;Navigation.prototype.resetData=function(){this.data={page:0,total:-1,perPage:this.options.iElementsPerPage||DEFAULT_NB_LINES_PER_PAGE}},Navigation.prototype.getMaxPage=function(){return-1==this.data.total?-1:Math.max(Math.ceil(this.data.total/this.data.perPage),1)},Navigation.prototype.refreshInterface=function(){for(var a in this.listeners)this.listeners[a]()},Navigation.prototype.onPageChange=function(a){var b,a=Number(a),c=this.getMaxPage();if(c>0)0>a&&(a=c+a+1),b=Math.max(Math.min(a,c),1);else{if(!(a>0))return;b=a}b!=this.data.page&&(this.data.page=b||1,this.reloadCallback(),this.refreshInterface())},Navigation.prototype.render=function(a){this.options.bPaginationMode?this.buildPaginationFooter(a):this.buildScrollingFooter(a)};var toggleClass=function(a,b,c){c&&-1==a.className.indexOf(b)?a.className+=" "+b:c||(a.className=a.className.replace(b,""))};Navigation.prototype.buildScrollingFooter=function(a){var b=this,c=document.createElement("div");c.className="btnseparator",a.appendChild(c);var d=document.createElement("div");d.className="group",d.current=d.appendChild(document.createElement("span")),d.appendChild(document.createTextNode("\u00a0")),d.appendChild(document.createTextNode("/")),d.appendChild(document.createTextNode("\u00a0")),d.total=d.appendChild(document.createElement("span")),d.total.className="clickable",d.total.onclick=function(){return b.countCallback(),!1},d.total.title=xtk_core.navigation_getCount(),a.appendChild(d);var e=document.createElement("div");e.className="scrollingNext",e.appendChild(document.createTextNode("\u00a0")),e.appendChild(document.createTextNode(xtk_core.navigation_paginationNextLabel()));var f=document.createElement("img");f.src="/xtk/img/list/next.png",f.style.verticalAlign="top",e.appendChild(f),e.title=xtk_core.navigation_scrollingNext(),e.onclick=function(){b.onPageChange(b.data.page+1)},a.appendChild(e),this.listeners.push(function(){var a=b.getMaxPage(),c=b.data.total,f=b.data.page*b.data.perPage;-1!=c&&f>c&&(f=c),d.current.innerHTML=f,d.total.innerHTML=-1!=c?b.data.total:xtk_core.navigation_totalUnknown(),e.style.display=a>b.data.page||-1==a?"inline":"none"})},Navigation.prototype.buildPaginationFooter=function(a){var b=this,c=document.createElement("div");c.className="button paginationFirst",c.title=xtk_core.navigation_paginationFirst(),c.onclick=function(){b.onPageChange(1)},a.appendChild(c);var d=document.createElement("div");d.className="button paginationPrevious",d.title=xtk_core.navigation_paginationPrevious(),d.onclick=function(){b.onPageChange(b.data.page-1)},a.appendChild(d);var e=document.createElement("div");e.className="group",e.appendChild(document.createTextNode(xtk_core.navigation_paginationPage()+" ")),e.input=e.appendChild(document.createElement("input")),e.input.type="text",e.input.size="4",e.input.onkeypress=function(a){var c=a||window.event||{},d=c.keyCode||c.which;13==d&&b.onPageChange(this.value)},e.appendChild(document.createTextNode("\u00a0")),e.appendChild(document.createTextNode(xtk_core.navigation_paginationOf())),e.appendChild(document.createTextNode("\u00a0")),e.total=e.appendChild(document.createElement("span")),e.total.className="clickable",e.total.onclick=function(){return b.countCallback(),!1},e.total.title=xtk_core.navigation_getCount(),a.appendChild(e);var f=document.createElement("div");f.className="button paginationNext",f.title=xtk_core.navigation_paginationNext(),f.onclick=function(){b.onPageChange(b.data.page+1)},a.appendChild(f);var g=document.createElement("div");g.className="button paginationLast",g.title=xtk_core.navigation_paginationLast(),g.onclick=function(){b.onPageChange(-1)},a.appendChild(g),this.listeners.push(function(){toggleClass(c,"enabled",b.data.page>1),toggleClass(d,"enabled",b.data.page>1);var a=b.getMaxPage();e.input.value=b.data.page,e.input.disabled=-1==b.data.total,e.total.innerHTML=-1!=a?a:xtk_core.navigation_totalUnknown(),toggleClass(f,"enabled",a>b.data.page||-1==a),toggleClass(g,"enabled",a>b.data.page)})},AjaxList.prototype.setupNavigation=function(bPaginationMode){var reload=function(a){return function(){var b=this.options.bPaginationMode;return a.loadData(b,this.data)}}(this),count=function(a){return function(){return a.loadData(!1,{countMode:!0})}}(this),iElementsPerPage=DEFAULT_NB_LINES_PER_PAGE;if(this.sQueryLimit)iElementsPerPage=Number(this.controller.getValue("/ctx"+("/"!=this.sQueryLimit[0]?"/vars/":"")+this.sQueryLimit));else{var qContent=parseXMLString(eval(this.sQuery)),qQueryDef=new NL.QueryDef;qQueryDef.setDefinition(qContent.documentElement),iElementsPerPage=Number(qQueryDef.getLineCount())}var navigationOptions={bPaginationMode:bPaginationMode,iElementsPerPage:iElementsPerPage};this.navigation=new Navigation(reload,count,navigationOptions),this.navigation.progressNav=document.getElementById(this.sListIdent.replace("lstData","progressNav"))},AjaxList.prototype.render=function(a,b,c){this.htmlTable=findElement(a,"TBODY"),null==this.htmlTable&&(this.htmlTable=a),this.colCount=b,this.trLine=null,void 0==c||c!=NAVIGATION_TYPE_SCROLLING&&c!=NAVIGATION_TYPE_PAGE||this.setupNavigation(c==NAVIGATION_TYPE_PAGE);var d=null;if(this.navigation){var e=1;if(d=document.getElementById(this.sListIdent.replace("lstData","lstHeaderNav")),null==d&&(d=document.getElementById(this.sListIdent.replace("lstData","lstFooterNav")))){var f=document.getElementById(this.sListIdent.replace("lstData","lstNav"));f&&(f.style.display="block")}d&&(this.navigation.render(d),this.navigation.onPageChange(e))}null==d&&this.loadData(!1)},AjaxList.prototype.clear=function(){if(this.htmlTable){for(var a=this.htmlTable.firstChild;a;){var b=a.nextSibling;this.htmlTable.removeChild(a),a=b}this.trLine=null}},AjaxList.prototype.addLine=function(a,b){this.trLine=this.htmlTable.appendChild(document.createElement("tr")),b&&(this.trLine.className="ajaxTemp");var c=this.trLine.appendChild(document.createElement("td"));c.colSpan=this.colCount,c.appendChild(document.createTextNode(a))},AjaxList.prototype.addEmptyLine=function(){this.trLine=this.htmlTable.appendChild(document.createElement("tr"));var a=this.trLine.appendChild(document.createElement("td"));a.colSpan=this.colCount,a.appendChild(document.createTextNode(xtk_core.noData())),a.style.padding="4px"},AjaxList.prototype.refresh=function(a){this.refreshId=a,this.load(!0)},AjaxList.prototype.load=function(a){"string"==typeof this.refreshId&&""!=this.refreshId&&(this.sortingData.bUseCustomOrderBy=!1),this.navigation?(this.navigation.resetData(),this.clear(),this.navigation.onPageChange(1)):this.loadData(a)},AjaxList.prototype.toggleSorting=function(sExpr,sAlias){var data=this.sortingData,ndCustomOrderByNode=data.elCustomOrderBy.firstChild,sOrderByExpr=ndCustomOrderByNode.getAttribute("expr"),elDefaultOrderBy=parseXMLString(eval(this.sQuery)).documentElement,defaultOrderByNodes=findNodes(elDefaultOrderBy,"orderBy/node"),bUniqueDefaultSort=!1;defaultOrderByNodes&&1==defaultOrderByNodes.length&&defaultOrderByNodes[0].getAttribute("expr")==sExpr&&(bUniqueDefaultSort=!0),data.bUseCustomOrderBy&&sOrderByExpr==sExpr?0==ndCustomOrderByNode.getAttribute("sortDesc")?ndCustomOrderByNode.setAttribute("sortDesc",1):bUniqueDefaultSort?ndCustomOrderByNode.setAttribute("sortDesc",0):data.bUseCustomOrderBy=!1:(ndCustomOrderByNode.setAttribute("expr",sExpr),ndCustomOrderByNode.setAttribute("alias",sAlias),bUniqueDefaultSort&&!data.bUseCustomOrderBy&&1!=defaultOrderByNodes[0].getAttribute("sortDesc")?ndCustomOrderByNode.setAttribute("sortDesc",1):ndCustomOrderByNode.setAttribute("sortDesc",0),data.bUseCustomOrderBy=!0),this.refresh()},AjaxList.prototype.updateSortingImages=function(a){var b,c=this.sortingData,d=c.sortedColumnsImagesRefs,e={};for(var f in a){var g=a[f];if(b=g.getAttribute("alias")){var h=this.sListIdent+"_"+b.replace("@",""),i=document.getElementById(h);i&&(i.src=1==g.getAttribute("sortDesc")?"/xtk/img/sort_down.png":"/xtk/img/sort_up.png",e[b]=i,delete d[b])}}for(b in d)d[b].src="/xtk/img/sort_default.gif";c.sortedColumnsImagesRefs=e},AjaxList.prototype.loadData=function(bEmptyListFirst,navigationData){if(null!=this.eXMLNfo){var qContent=parseXMLString(eval(this.sQuery)),data=this.sortingData;data.bUseCustomOrderBy&&replaceContent(qContent,"/content/orderBy",data.elCustomOrderBy),this.updateSortingImages(findNodes(qContent.documentElement,"orderBy/node"));var ndWhere=findChildElement(qContent.documentElement,"sysFilter"),ndFolderRoot=null;if(null!=ndWhere&&(ndFolderRoot=findChildElement(ndWhere,"condition")),null!=ndFolderRoot&&document.folderSelectors&&null!=document.folderSelectors[this.sListIdent])qContent.documentElement.setAttribute("folderFilter",document.controller.getValue("/ctx/vars/"+ndFolderRoot.getAttribute("xpath")+"/@id"));else if(null!=ndFolderRoot&&""!=ndFolderRoot.getAttribute("xpath")){var strFullName="",bSubTree=document.controller.getValue("/ctx/vars/"+ndFolderRoot.getAttribute("xpath")+"/@subTree");NL.XTK.parseBoolean(bSubTree,!1)&&(strFullName=document.controller.getValue("/ctx/vars/"+ndFolderRoot.getAttribute("xpath")+"/@fullName"));var ndFolder=qContent.createElement("condition");if(""!=strFullName)ndFolder.setAttribute("expr","@fullName LIKE "+NL.XTK.folderLikeCond(strFullName,"$(homeDir) + %"));else{var iFolderId=document.controller.getValue("/ctx/vars/"+ndFolderRoot.getAttribute("xpath")+"/@id");0!=iFolderId&&ndFolder.setAttribute("expr","@id ="+iFolderId)}ndFolderRoot.insertBefore(ndFolder,null)}var qQueryDef=new NL.QueryDef;qQueryDef.setDefinition(qContent.documentElement),bEmptyListFirst&&this.clear(),navigationData?(this.navigation.progressNav&&(this.navigation.progressNav.style.display="block"),navigationData.countMode?(qQueryDef.setOperation("count"),qQueryDef.action="count"):(qQueryDef.setStartLine((navigationData.page-1)*navigationData.perPage),navigationData.perPage&&qQueryDef.setLineCount(navigationData.perPage+1))):(this.sQueryLimit&&qQueryDef.setLineCount(this.controller.getValue("/ctx"+("/"!=this.sQueryLimit[0]?"/vars/":"")+this.sQueryLimit)),this.addLine(xtk_core.loadingData(),!0)),qQueryDef.execute(this.strServerUrl+"/nl/jsp/soaprouter.jsp","",this)}else this.onXtkQueryCompleted(null,findElement(document.controller.ctx,this.sControllerPath))},AjaxList.prototype.onXtkQueryCompleted=function(a,b,c){this.navigation&&this.navigation.progressNav&&(this.navigation.progressNav.style.display="none");var d=document.getElementById(this.sListIdent.replace("lstData","removeFilter"));if(d){var e=document.getElementById(this.sListIdent.replace("lstData","lstFilterNav"));NL.XTK.parseBoolean(document.controller.isModifiedObservers(),!1)?(d.style.display="block",e.style.display="block"):(d.style.display="none",e.style.display="none")}if(void 0==c)if("count"==a.action&&this.navigation)this.navigation.data.total=b.getAttribute("count"),this.navigation.refreshInterface();else{if(!this.navigation){if(null==this.trLine||"ajaxTemp"!=this.trLine.className)return;this.clear()}var f=null,g="";if(""!=this.sControllerPath&&null!=a){var h=findElement(document.controller.ctx,this.sControllerPath);if(("undefined"==typeof h||null==h)&&(setXPathValue(document.controller.ctx,this.sControllerPath,"__placeHolder__"),h=findElement(document.controller.ctx,this.sControllerPath)),null!=h)for(;null!=h.firstChild;)h.removeChild(h.firstChild);f=h}var i=firstChildElement(b),j=0;this.navigation&&(j=(this.navigation.data.page-1)*this.navigation.data.perPage);for(var k=1,l=!1,m=this.htmlTable,n=null;i;){if(this.navigation&&k==this.navigation.data.perPage+1){l=!0;break}this.currentLine=null!=this.eXMLNfo?createPOJsO(i,this.eXMLNfo):convertToPOJsO(i),null!=f&&f.appendChild(importNode(document.controller.ctx,i,!0));var o=j+k;this.currentLine.__lineIndex=o;var p=this.fnLineTemplate(o);try{var q=parseXMLString(p).documentElement;if("undefined"==typeof q||null==q||"parsererror"==q.nodeName)throw new Error("parserEror");var r=null;for(1>=this.iCellPerLine?r=findElement(q,"tr"):(1==k%this.iCellPerLine&&(m=this.htmlTable.appendChild(document.createElement("tr")),null==this.trLine&&(this.trLine=m)),r=findElement(q,"td")),r&&firstChildElement(r)&&r.nodeName.toLowerCase()==firstChildElement(r).nodeName.toLowerCase()&&(r=firstChildElement(r));r;){var s=m.appendChild(importNodeAsHTML(r,!0));null==this.trLine&&(this.trLine=s,null==n&&(n=this.trLine)),r=nextSiblingElement(r)}}catch(t){this.addLine(p,!1)}i=nextSiblingElement(i),k++}var u=jQuery.Event("loadList");parent.$("body").trigger(u,[$(window).attr("name")]),1==k?this.addEmptyLine():""!=this.sControllerPath&&document.controller.notifyAllObservers(g),this.navigation&&!l&&(this.navigation.data.total=j+k-1,this.navigation.refreshInterface()),""!=this.refreshId&&void 0!=this.refreshId&&n&&void 0!=n.id&&"line"==n.id.substring(0,4)&&(showHideBlock("summary"+n.id.substring(4,n.id.length)),this.refreshId="")}else for(var v=c.toString().split("\n"),w=0;v.length>w;w++)this.addLine(v[w],!1)},AjaxList.prototype.handleViewLinkStart=function(a){return this.strViewLink?this.strViewLink+a+"&amp;__securitytoken="+document.__securitytoken+"'>":""};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.Poller"),NL.Poller=function(a){this.CAP_ON_ERROR=300,this.DEFAULT_INTERVAL=1;var b={resources:[],interval:2};a=SO.Utils.extend({},b,a),this._resources=a.resources,this._interval=a.interval,this._firstPoll=!0,this.start(),this._firstPoll=!1},NL.Poller.prototype={_heartBeat:function(a){for(var b=this,c=0;this._resources.length>c;c++){var d=this._resources[c];(function(c){var d=Date.now();if(c.nextPoll=c.nextPoll||1e3*c.interval||1e3*b.DEFAULT_INTERVAL,c.lastPollTime=c.lastPollTime||d-c.nextPoll,c.noProgression=c.noProgression||0,c.previouslyEnable=c.enable,c.enable=a||(c.enableIf?c.enableIf.call(c):!0),d-c.lastPollTime>=c.nextPoll&&(c.enable||c.initPoll&&b._firstPoll)||c.previouslyEnable&&!c.enable){SO.String.startsWith(c.url,"/rest")||(c.url="/rest"+c.url);var e=new NL.DataSource.Rest({url:c.url,loaderOff:!0});c.lastPollTime=d,e.get(0,null,{onSuccess:function(a){a&&delete a.duration,c.cap>c.originalCap&&(c.cap=c.orignalCap);var d=c.hasProgressed?c.hasProgressed.call(c,a):!SO.Utils.isEqual(c.oldData,a);if(d&&a!=={}){c.noProgression=0,c.nextPoll=1e3*c.interval||1e3*b.DEFAULT_INTERVAL,c.oldData=a;var e=SO.Utils.extend(!0,{},{data:a}).data;c.process.call(this,e)}else c.noProgression++;var f=1e3*c.cap||36e5;c.nextPoll=Math.min(f,Math.round(c.nextPoll+Math.max(0,2e3*(c.noProgression-2))))},onError:function(){c.noProgression++,c.nextPoll=Math.min(1e3*b.CAP_ON_ERROR,Math.round(c.nextPoll+Math.max(0,2e3*(c.noProgression-2))))}})}})(d)}this._runTimer=setTimeout(function(){b._heartBeat()},1e3*this._interval)},refreshNow:function(a){a.nextPoll=0,this.start(!0)},resetProgression:function(a){a.nextPoll=0,a.noProgression=0},addResource:function(a){this._resources.push(a),this.refreshNow(a)},delResource:function(a){for(var b=0;this._resources.length>b;b++)if(this._resources[b]===a){this._resources.splice(b);break}},stop:function(){clearTimeout(this._runTimer)},start:function(a){var b=this;this._runTimer=setTimeout(function(){b._heartBeat(a)},0)}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.Uploader"),NL.Uploader=function(a){var b=this,c={chunkSize:10485760,url:"/u/preupload",retryTime:5e3,maxRetry:10,isPublicFile:!1,observeJob:!1,jobCreateResource:null};b.options=SO.Utils.extend({},c,a),b.stack={},b.observers={},SO.assert(b.options.url,"Uploader endpoint url should not be null"),SO.assert(!b.options.jobCreateResource!=!b.options.isPublicFile,"jobCreateResource xor isPublicFile should be defined")},NL.Uploader.prototype={_prompt:function(a){return this.observers[a].onPrompt.call(this,this._doUpload,this.cancel)},_notify:function(a,b,c,d){this.observers[a].onNotify.call(this,b,c,d)},preUpload:function(a,b,c,d){SO.assert(d.onNotify&&d.onPrompt,"onNotify & onPrompt should be define by the upload component in order to launch an upload");var e=this,f=new SO.md5,g=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,h=104857.6;+new Date;var i=Math.ceil(b.size/h),j=0,f=new SO.md5.ArrayBuffer,k=new FileReader;e.observers[a]=d,e.stack[a]={file:b,totalPacket:Math.ceil(b.size/e.options.chunkSize)-1,currentPacket:0,job:c,callbacks:d};var l=function(){var a=j*h,c=Math.min(a+h,b.size);k.readAsArrayBuffer(g.call(b,a,c))};k.onload=function(d){if(f.append(d.target.result),++j,!e.stack[a].canceled)if(i>j)l();else{var g=f.end(),h=new NL.transport.REST({url:e.options.url,loaderOff:!0,method:"POST",processData:!1});h.start({onSuccess:function(b){e.stack[a].endPoint=b.uploadUri,e.stack[a].range=b.range,b.exists?e._prompt(a,e._doUpload,e.cancel):e._doUpload(a)},onError:function(){e._notify(a,"status","error",{msg:xtk_core.uploader_uploadFailed()})}},{md5:g,name:b.name,size:b.size,jobArgs:c,isPublicFile:e.options.isPublicFile,jobCreateResource:e.options.jobCreateResource})}},e._notify(a,"status","preupload"),l()},_doUpload:function(a){var b=this.stack[a];b.range?this._uploadNextPacket(a):this._uploadWholeFile(a)},_uploadWholeFile:function(a){var b=this,c=b.stack[a],d=new FormData;d.append("file",c.file),c.transport=new NL.transport.AJAX({url:c.endPoint,loaderOff:!0,method:"POST",data:d,processData:!1,contentType:!1,headers:{"Content-Disposition":'attachment; filename="'+encodeURI(c.file.name)+'"'},xhr:function(){var c=(new Date).getTime(),d=$.ajaxSettings.xhr();return d.upload.addEventListener("progress",function(d){var e=(new Date).getTime(),f=e-c;f/=1e3;var g=d.total,h=d.loaded,i=g/h*f-f;i=Math.round(i),b._notify(a,"progress",100*(h/g)),i&&b._notify(a,"eta",i)}),d}}),c.transport.start({onSuccess:function(c){"finished"===c.status&&(b._notify(a,"status","upload_success",c),(b.options.jobCreateResource||b.options.observeJob)&&b._observeJob(a,c.jobResource))},onError:function(){b._notify(a,"status","error",{msg:xtk_core.uploader_uploadFailed()})}})},_uploadNextPacket:function(a){var b=this,c=b.stack[a],d=b.options.chunkSize*c.currentPacket,e=d+b.options.chunkSize>c.file.size?c.file.size:d+b.options.chunkSize,f=c.file.slice||c.file.webkitSlice||c.file.mozSlice,g=f.call(c.file,d,e);c.transport=new NL.transport.AJAX({url:b.stack[a].endPoint,loaderOff:!0,method:"POST",processData:!1,contentType:!1,data:g,xhr:function(){var d=(new Date).getTime(),e=$.ajaxSettings.xhr();return e.upload.addEventListener("progress",function(e){var f=(new Date).getTime(),g=f-d,h=c.currentPacket*b.options.chunkSize+e.loaded,i=c.file.size;g/=1e3;var j=i/h*g-g;j=Math.round(j),b._notify(a,"progress",100*(h/i)),SO.isNumber(j)&&b._notify(a,"eta",j)}),e},headers:{"Content-Type":"application/octet-stream","Content-Range":"bytes="+d+"-"+e+"/"+c.file.size,"Content-Disposition":'attachment; filename="'+encodeURI(c.file.name)+'"'}}),c.transport.start({onSuccess:function(c){b.stack[a].currentPacket===b.stack[a].totalPacket?"finished"===c.status&&(b._notify(a,"status","upload_success",c),(b.options.jobCreateResource||b.options.observeJob)&&b._observeJob(a,c.jobResource)):(b.stack[a].currentPacket++,b._uploadNextPacket(a))},onError:function(){b._notify(a,"status","error",{msg:xtk_core.uploader_uploadFailed()}),setTimeout(function(){b._uploadNextPacket(a)},b.options.retryTime)}})},cancel:function(a){var b=this.stack[a];b&&(b.transport?b.transport.cancel():b.canceled=!0),this._notify(a,"status","canceled")},retry:function(a){var b=this.stack[a];this.preUpload(a,b.file,b.job,b.callbacks)},_observeJob:function(a,b){var c=this;c._notify(a,"status","job_observe");var d=new NL.Poller({resources:[{url:b,onError:function(){c._notify(a,"status","error")},process:function(b){if(b.status)switch(b.status){case"finished":c._notify(a,"status","job_success"),d.stop();break;case"failed":c._notify(a,"status","error",{msg:xtk_core.uploader_jobFailed(),logs:b.logs}),d.stop()}}}]})}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.md5"),SO.md5=function(){var a=function(a,b){return 4294967295&a+b},b=function(b,c,d,e,f,g){return c=a(a(c,b),a(e,g)),a(c<<f|c>>>32-f,d)},c=function(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)},d=function(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)},e=function(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)},f=function(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)},g=function(b,g){var h=b[0],i=b[1],j=b[2],k=b[3];h=c(h,i,j,k,g[0],7,-680876936),k=c(k,h,i,j,g[1],12,-389564586),j=c(j,k,h,i,g[2],17,606105819),i=c(i,j,k,h,g[3],22,-1044525330),h=c(h,i,j,k,g[4],7,-176418897),k=c(k,h,i,j,g[5],12,1200080426),j=c(j,k,h,i,g[6],17,-1473231341),i=c(i,j,k,h,g[7],22,-45705983),h=c(h,i,j,k,g[8],7,1770035416),k=c(k,h,i,j,g[9],12,-1958414417),j=c(j,k,h,i,g[10],17,-42063),i=c(i,j,k,h,g[11],22,-1990404162),h=c(h,i,j,k,g[12],7,1804603682),k=c(k,h,i,j,g[13],12,-40341101),j=c(j,k,h,i,g[14],17,-1502002290),i=c(i,j,k,h,g[15],22,1236535329),h=d(h,i,j,k,g[1],5,-165796510),k=d(k,h,i,j,g[6],9,-1069501632),j=d(j,k,h,i,g[11],14,643717713),i=d(i,j,k,h,g[0],20,-373897302),h=d(h,i,j,k,g[5],5,-701558691),k=d(k,h,i,j,g[10],9,38016083),j=d(j,k,h,i,g[15],14,-660478335),i=d(i,j,k,h,g[4],20,-405537848),h=d(h,i,j,k,g[9],5,568446438),k=d(k,h,i,j,g[14],9,-1019803690),j=d(j,k,h,i,g[3],14,-187363961),i=d(i,j,k,h,g[8],20,1163531501),h=d(h,i,j,k,g[13],5,-1444681467),k=d(k,h,i,j,g[2],9,-51403784),j=d(j,k,h,i,g[7],14,1735328473),i=d(i,j,k,h,g[12],20,-1926607734),h=e(h,i,j,k,g[5],4,-378558),k=e(k,h,i,j,g[8],11,-2022574463),j=e(j,k,h,i,g[11],16,1839030562),i=e(i,j,k,h,g[14],23,-35309556),h=e(h,i,j,k,g[1],4,-1530992060),k=e(k,h,i,j,g[4],11,1272893353),j=e(j,k,h,i,g[7],16,-155497632),i=e(i,j,k,h,g[10],23,-1094730640),h=e(h,i,j,k,g[13],4,681279174),k=e(k,h,i,j,g[0],11,-358537222),j=e(j,k,h,i,g[3],16,-722521979),i=e(i,j,k,h,g[6],23,76029189),h=e(h,i,j,k,g[9],4,-640364487),k=e(k,h,i,j,g[12],11,-421815835),j=e(j,k,h,i,g[15],16,530742520),i=e(i,j,k,h,g[2],23,-995338651),h=f(h,i,j,k,g[0],6,-198630844),k=f(k,h,i,j,g[7],10,1126891415),j=f(j,k,h,i,g[14],15,-1416354905),i=f(i,j,k,h,g[5],21,-57434055),h=f(h,i,j,k,g[12],6,1700485571),k=f(k,h,i,j,g[3],10,-1894986606),j=f(j,k,h,i,g[10],15,-1051523),i=f(i,j,k,h,g[1],21,-2054922799),h=f(h,i,j,k,g[8],6,1873313359),k=f(k,h,i,j,g[15],10,-30611744),j=f(j,k,h,i,g[6],15,-1560198380),i=f(i,j,k,h,g[13],21,1309151649),h=f(h,i,j,k,g[4],6,-145523070),k=f(k,h,i,j,g[11],10,-1120210379),j=f(j,k,h,i,g[2],15,718787259),i=f(i,j,k,h,g[9],21,-343485551),b[0]=a(h,b[0]),b[1]=a(i,b[1]),b[2]=a(j,b[2]),b[3]=a(k,b[3])},h=function(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c},i=function(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c},j=function(a){var b,c,d,e,f,i,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,h(a.substring(b-64,b)));for(a=a.substring(b-64),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a.charCodeAt(b)<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),i=parseInt(e[1],16)||0,d[14]=f,d[15]=i,g(k,d),k},k=function(a){var b,c,d,e,f,h,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,i(a.subarray(b-64,b)));for(a=j>b-64?a.subarray(b-64):new Uint8Array(0),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a[b]<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),h=parseInt(e[1],16)||0,d[14]=f,d[15]=h,g(k,d),k},l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],m=function(a){var b,c="";for(b=0;4>b;b+=1)c+=l[15&a>>8*b+4]+l[15&a>>8*b];return c},n=function(a){var b;for(b=0;a.length>b;b+=1)a[b]=m(a[b]);return a.join("")},o=function(a){return n(j(a))},p=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==o("hello")&&(a=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),p.prototype.append=function(a){return/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),this.appendBinary(a),this},p.prototype.appendBinary=function(a){this._buff+=a,this._length+=a.length;var b,c=this._buff.length;for(b=64;c>=b;b+=64)g(this._state,h(this._buff.substring(b-64,b)));return this._buff=this._buff.substr(b-64),this},p.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d.charCodeAt(b)<<(b%4<<3);return this._finish(f,e),c=a?this._state:n(this._state),this.reset(),c},p.prototype._finish=function(a,b){var c,d,e,f=b;if(a[f>>2]|=128<<(f%4<<3),f>55)for(g(this._state,a),f=0;16>f;f+=1)a[f]=0;c=8*this._length,c=c.toString(16).match(/(.*?)(.{0,8})$/),d=parseInt(c[2],16),e=parseInt(c[1],16)||0,a[14]=d,a[15]=e,g(this._state,a)},p.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},p.hash=function(a,b){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));var c=j(a);return b?c:n(c)},p.hashBinary=function(a,b){var c=j(a);return b?c:n(c)},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(a){var b,c=this._concatArrayBuffer(this._buff,a),d=c.length;for(this._length+=a.byteLength,b=64;d>=b;b+=64)g(this._state,i(c.subarray(b-64,b)));return this._buff=d>b-64?c.subarray(b-64):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d[b]<<(b%4<<3);return this._finish(f,e),c=a?this._state:n(this._state),this.reset(),c},p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._concatArrayBuffer=function(a,b){var c=a.length,d=new Uint8Array(c+b.byteLength);return d.set(a),d.set(new Uint8Array(b),c),d},p.ArrayBuffer.hash=function(a,b){var c=k(new Uint8Array(a));return b?c:n(c)},p}();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.Widgets.define("MonoFileDropZone",{DEFAULT_OPTIONS:{allowedExtensions:null,uploader:null,job:null,onJobComplete:function(){},onUploadComplete:function(){}},_create:function(){SO.assert(this._options.uploader&&this._options.job,"Wrong uploader or job definition passed to FileDropZone, troubles incoming..."),this._filesStack={},this._refreshDisplay(!0)},_createMarkup:function(){this._view={},SO.tie(this._view,{tag:"div",cls:"nlui-mono-fd",cld:[{tag:"div",cls:"nlui-fd-overlay",field:"$overlay",cld:[{tag:"div",cls:"nlui-fd-overlay-message-wrapper",cld:[{tag:"i",cls:"soui-icon-12-warning"},{tag:"span",cls:"nlui-fd-overlay-message",field:"$overlayMessage"}]}]},{tag:"input",type:"file",cls:"nlui-fd-input",field:"$input"},{tag:"div",cls:"nlui-fd-content",field:"$content",cld:[{tag:"div",cls:"nlui-fd-instructions",field:"$instructions",cld:[{tag:"div",cls:"nlui-fd-cloud"},{tag:"div",cls:"nlui-fd-instructions-content",cld:[{tag:"div",cls:"nlui-fd-instructions-large",text:xtk_sirocco.monoFileDropZone_instructions_dragFileHere()},{tag:"div",cls:"nlui-fd-instructions-small",text:xtk_sirocco.fileDropZone_instructions_or()+" ",cld:[{tag:"span",cls:"nlui-instructions-link",text:xtk_sirocco.fileDropZone_instructions_selectFromFolder(),field:"$link"}]}]}]},{tag:"div",cls:"nlui-fd-uploading",field:"$uploading",cld:[{tag:"div",cls:"nlui-fd-uploading-content",field:"$uploadingContent"}]}]}]}),this._view.$uploading.style.display="none",this.$el.append(this._view.el)},_bindEvents:function(){var a=this;this._view.$instructions.addEventListener("dragenter",function(b){b.preventDefault(),b.stopPropagation(),a._view.$content.classList.add("dragged")}),this._view.$instructions.addEventListener("dragover",function(a){a.preventDefault(),a.stopPropagation()}),this._view.$instructions.addEventListener("dragleave",function(b){b.preventDefault(),b.stopPropagation(),a._view.$content.classList.remove("dragged")}),this._view.$instructions.addEventListener("drop",function(b){b.stopPropagation(),b.preventDefault(),a._view.$content.classList.remove("dragged"),a._processFile(b.dataTransfer.files)&&a._showUpload()}),this._view.$link.addEventListener("click",function(){a._view.$input.click()}),this._view.$input.addEventListener("change",function(b){a._processFile(b.target.files)&&a._showUpload(),b.target.value=""})},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents())},_processFile:function(a){var b=this;if("undefined"==typeof a||0===a.length)return!1;var c=a[0];if(!this._checkFileExtensions(c)){var d=this._options.allowedExtensions.map(function(a){return"."+a.toLowerCase()});return this._view.$overlayMessage.textContent=xtk_core.monoFileDropZone_badFileType(d.join(", ")),this._view.$overlay.style.display="block",setTimeout(function(){$(b._view.$overlay).fadeOut(500,function(){b._view.$overlay.style.display="none"})},2e3),!1}return b._options.uploader.preUpload(c.name,c,b._options.job,{onPrompt:function(a,b){var d=this;new SO.Widgets.MessageBox($("<div></div>"),{message:xtk_core.monoFileDropZone_fileAlreadyExists(c.name),confirmButtonLabel:xtk_core.monoFileDropZone_confirmButtonLabel(),type:"confirm",onCancel:function(){b.call(d,c.name)},onConfirm:function(){a.call(d,c.name)}})},onNotify:function(a,d,e){var f=b._filesStack[c.name];switch(a){case"status":switch(d){case"error":if(f.tieItem.$errorMessage.textContent=e.msg,b._view.$uploading.classList.add("error"),f.tieItem.$progressBarContainer.style.display="none",f.tieItem.$errorContainer.removeAttribute("style"),e.logs){f.tieItem.$errorDetails.style.display="";var g=new SO.Widgets.List($("<div></div>"),{controller:new SO.MVC.Controller({model:{jobLog:[]},metamodel:{jobLog:{type:"list",keys:["PKey"],elements:{PKey:{type:"string"},message:{type:"string"},logDate:{type:"date"}},dataSource:new NL.DataSource.Rest({url:e.logs.href})}}}),metaDataUrl:e.logs.href,renderingMethods:{grid:{family:"grid",label:"List",icon:"coral-viewList",columns:[{name:"",editable:!1,renderer:function(a){return SO.IMG.genIcon("log"+a.logType.charAt(0).toUpperCase()+a.logType.slice(1),18)},visible:!0,width:38},{editable:!1,name:"logDate",label:"Date",visible:!0,width:170},{editable:!1,label:"Message",name:"message",renderer:function(a){return a.message},visible:!0,width:void 0}]}},defaultRendering:"grid",jpath:"jobLog"});b._detailsDialog.setContent(g.$el)}break;case"canceled":delete f;for(var h,i=b._view.$uploadingContent;h=i.firstChild;)i.removeChild(h);b._showInstructions();break;case"upload_success":for(;f.tieItem.$progressBar.hasChildNodes();)f.tieItem.$progressBar.removeChild(f.tieItem.$progressBar.lastChild);b._options.onUploadComplete.call(b,f,e);break;case"job_observe":f.progressBar=new SO.Widgets.ProgressBar(f.tieItem.$progressBar,{theme:"white",size:"small",infinite:!0,showPercent:!1});break;case"job_success":f.tieItem.$progressBarContainer.style.display="none",b._options.onJobComplete.call(b,f)}break;case"progress":f.progressBar.setValue(d)}}}),b._renderFile(c),!0},_renderFile:function(a){var b=this,c=SO.tie({},{tag:"div",cls:"nlui-fd-uploading-item",cld:[{tag:"div",cls:"nlui-fd-file-container",cld:[{tag:"i",cls:"soui-icon-18-file-inverse"},{tag:"div",cls:"nlui-fd-filename",text:a.name},{tag:"div",cls:"nlui-fd-filesize",text:"("+this._bytesToSize(a.size)+")"},{tag:"i",cls:"nlui-fd-cancel soui-icon-12-cancel-inverse",field:"$cancel"}]},{tag:"div",cls:"nlui-fd-progressbar-container",field:"$progressBarContainer",cld:[{tag:"div",cls:"nlui-fd-progressbar",field:"$progressBar"}]},{tag:"div",cls:"nlui-fd-error-container",field:"$errorContainer",cld:[{tag:"div",cls:"nlui-fd-error-wrapper",cld:[{tag:"i",cls:"soui-icon-12-warning"},{tag:"div",cls:"nlui-fd-error-message",field:"$errorMessage"},{tag:"span",cls:"nlui-fd-error-details",field:"$errorDetails",text:"(Details)"}]},{tag:"i",cls:"nlui-fd-retry soui-icon-12-retry-inverse",field:"$retry"}]}]}),d=new SO.Widgets.ProgressBar($(c.$progressBar),{theme:"white",size:"small",showPercent:!1});SO.Event.bind($(c.$cancel),"vclick",function(){b._options.uploader.cancel(a.name)}),SO.Event.bind($(c.$retry),"vclick",function(){c.$progressBarContainer.removeAttribute("style"),b._view.$uploading.classList.remove("error"),c.$errorContainer.style.display="none",b._options.uploader.retry(a.name)}),this._detailsDialog=new SO.Widgets.Dialog($("<div></div>"),{mode:"fullPage",title:xtk_core.jobProgressIndicator_jobLogLabel(),autoOpen:!1}),SO.Event.bind(c.$errorDetails,"vclick",function(){b._detailsDialog.open()}),this._filesStack[a.name]={tieItem:c,progressBar:d},c.$errorContainer.style.display="none",this._view.$uploadingContent.appendChild(c.el)},_bytesToSize:function(a){var b=["Bytes","KB","MB","GB","TB"];if(0==a)return"n/a";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,c),2)+" "+b[c]},_showInstructions:function(){this._view.$uploading.style.display="none",this._view.$instructions.removeAttribute("style"),this._view.$uploading.classList.remove("error")},_showUpload:function(){this._view.$instructions.style.display="none",this._view.$uploading.removeAttribute("style")},_checkFileExtensions:function(a){var b=this._options.allowedExtensions;if(b){b=b.map(function(a){return a.toLowerCase()});var c=a.name.split(".")[1]||"";return-1!==SO.Utils.indexOf(b,c.toLowerCase())}return!0}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.Widgets.define("MultiFileDropZone",{DEFAULT_OPTIONS:{allowedExtensions:null,uploader:null,job:null,fileStack:[],onJobComplete:function(){},onUploadComplete:function(){}},_create:function(){var a=this;SO.assert(this._options.uploader&&this._options.job,"Wrong uploader or job definition passed to FileDropZone, troubles incoming..."),this._filesStack={},this._refreshDisplay(!0),this._options.fileStack.length>0&&(SO.Utils.each(this._options.fileStack,function(b,c){a._renderFile(c)}),this._showUpload())},_createMarkup:function(){this._view={},SO.tie(this._view,{tag:"div",cls:"nlui-multi-fd",cld:[{tag:"div",cls:"nlui-fd-overlay",field:"$overlay",cld:[{tag:"div",cls:"nlui-fd-instructions-content",cld:[{tag:"div",cls:"nlui-fd-instructions-large",text:"Drag files here"},{tag:"div",cls:"nlui-fd-instructions-small",text:"or ",cld:[{tag:"span",cls:"nlui-instructions-link",text:"Select from a folder"}]}]}]},{tag:"input",multiple:"",type:"file",cls:"nlui-fd-input",field:"$input"},{tag:"div",cls:"nlui-fd-content",field:"$content",cld:[{tag:"div",cls:"nlui-fd-instructions",field:"$instructions",cld:[{tag:"div",cls:"nlui-fd-cloud"},{tag:"div",cls:"nlui-fd-instructions-content",cld:[{tag:"div",cls:"nlui-fd-instructions-large",text:xtk_sirocco.multiFileDropZone_instructions_dragFileHere()},{tag:"div",cls:"nlui-fd-instructions-small",text:xtk_sirocco.fileDropZone_instructions_or()+" ",cld:[{tag:"span",cls:"nlui-instructions-link",text:xtk_sirocco.fileDropZone_instructions_selectFromFolder(),field:"$link"}]}]}]},{tag:"div",cls:"nlui-fd-uploading nlui-flex-grid",field:"$uploading",cld:[{tag:"div",cls:"nlui-fd-uploading-content nlui-flex-row",field:"$uploadingContent"},{tag:"div",cls:"nlui-fd-add-button",field:"$addButton"}]}]}]}),this.$el.append(this._view.el)},_bindEvents:function(){var a=this;this._view.$instructions.addEventListener("dragenter",function(b){b.preventDefault(),b.stopPropagation(),a._view.$content.classList.add("dragged")}),this._view.$instructions.addEventListener("dragover",function(a){a.preventDefault(),a.stopPropagation()}),this._view.$instructions.addEventListener("dragleave",function(b){b.preventDefault(),b.stopPropagation(),a._view.$content.classList.remove("dragged")}),this._view.$instructions.addEventListener("drop",function(b){b.stopPropagation(),b.preventDefault(),a._view.$content.classList.remove("dragged"),a._processFile(b.dataTransfer.files)&&a._showUpload()}),this._view.$uploading.addEventListener("dragenter",function(b){b.preventDefault(),b.stopPropagation(),a._view.$overlay.style.display="inherit"}),this._view.$overlay.addEventListener("dragleave",function(b){b.preventDefault(),b.stopPropagation(),a._view.$overlay.style.display="none"}),this._view.$overlay.addEventListener("dragover",function(a){a.preventDefault(),a.stopPropagation()}),this._view.$overlay.addEventListener("drop",function(b){b.stopPropagation(),b.preventDefault(),a._view.$overlay.style.display="none",a._processFile(b.dataTransfer.files)}),this._view.$link.addEventListener("click",function(){a._view.$input.click()}),this._view.$input.addEventListener("change",function(b){a._processFile(b.target.files)&&a._showUpload(),b.target.value=""}),this._addButton=new SO.Widgets.SimpleButton(this._view.$addButton,{icon:"upload",mode:"secondary",onClick:function(){a._view.$input.click()}})},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents())},_processFile:function(a){var b=this;return"undefined"==typeof a||0===a.length?!1:(SO.Utils.each(a,function(a,c){return b._filesStack[c.name]?!0:(b._options.uploader.preUpload(c.name,c,b._options.job,{onPrompt:function(a,b){var d=this;new SO.Widgets.MessageBox($("<div></div>"),{message:xtk_core.monoFileDropZone_fileAlreadyExists(c.name),type:"confirm",onCancel:function(){b.call(d,c.name)},onConfirm:function(){a.call(d,c.name)}})},onNotify:function(a,d,e){var f=b._filesStack[c.name];switch(a){case"status":switch(d){case"error":b._showError(f.tieItem,e.msg);break;case"canceled":b._removeFile(f);break;case"success":break;case"upload_success":for(;f.tieItem.$progressBar.hasChildNodes();)f.tieItem.$progressBar.removeChild(f.tieItem.$progressBar.lastChild);b._options.onUploadComplete.call(b,f,e);break;case"job_observe":f.progressBar=new SO.Widgets.ProgressBar(f.tieItem.$progressBar,{size:"small",infinite:!0,showPercent:!1});break;case"job_success":f.tieItem.$progressBarContainer.style.display="none",b._options.onJobComplete.call(b,f)}break;case"progress":f.progressBar.setValue(d)}}}),b._renderFile(c),void 0)}),!0)},_removeFile:function(a){var b=this._view.$uploadingContent;b.removeChild(a.tieItem.el),b.firstChild||this._showInstructions(),delete this._filesStack[a.fileName]},_renderFile:function(a){var b=this,c=SO.tie({},{tag:"div",cls:"nlui-fd-uploading-item col-6-xs",cld:[{tag:"div",cls:"nlui-fd-file-container",field:"$fileContainer",cld:[{tag:"i",cls:"soui-icon-18-file",field:"$fileIcon"},{tag:"div",cls:"nlui-fd-filename",title:a.name,text:a.name},{tag:"div",cls:"nlui-fd-filesize",text:"("+this._bytesToSize(a.size)+")"},{tag:"div",cls:"nlui-fd-progressbar-container",field:"$progressBarContainer",cld:[{tag:"div",cls:"nlui-fd-progressbar",field:"$progressBar"}]},{tag:"div",cls:"nlui-fd-error-container",field:"$errorContainer",cld:[{tag:"div",cls:"nlui-fd-error-wrapper",cld:[{tag:"i",cls:"soui-icon-12-warning"},{tag:"div",cls:"nlui-fd-error-message",field:"$errorMessage"}]},{tag:"i",cls:"nlui-fd-retry soui-icon-12-retry",field:"$retry"}]},{tag:"i",cls:"nlui-fd-cancel soui-icon-12-cancel",field:"$cancel"}]}]});if(a instanceof File){var d=new SO.Widgets.ProgressBar($(c.$progressBar),{size:"small",showPercent:!1});SO.Event.bind($(c.$cancel),"vclick",function(){b._options.uploader.cancel(a.name)})}else c.$progressBarContainer.style.display="none",SO.Event.bind($(c.$cancel),"vclick",function(){b._removeFile(b._filesStack[a.name])});SO.Event.bind($(c.$retry),"vclick",function(){b._removeError(c),b._options.uploader.retry(a.name)}),this._filesStack[a.name]={tieItem:c,progressBar:d,fileName:a.name},this._view.$uploadingContent.appendChild(c.el)},_bytesToSize:function(a){var b=["Bytes","KB","MB","GB","TB"];if(0==a)return"n/a";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,c),2)+" "+b[c]},_showInstructions:function(){this._view.$uploading.style.display="none",this._view.$instructions.style.display="inherit"},_showUpload:function(){this._view.$instructions.style.display="none",this._view.$uploading.style.display="inherit"},_checkFileExtensions:function(a){var b=this._options.allowedExtensions;if(b){b=b.map(function(a){return a.toLowerCase()});var c=a.name.split(".")[1]||"";return-1!==SO.Utils.indexOf(b,c.toLowerCase())}return!0},_showError:function(a,b){a.$fileContainer.classList.add("error"),a.$fileIcon.classList.remove("soui-icon-18-file"),a.$fileIcon.classList.add("soui-icon-18-file-active"),a.$cancel.classList.remove("soui-icon-12-cancel"),a.$cancel.classList.add("soui-icon-12-cancel-active"),a.$progressBarContainer.style.display="none",a.$errorContainer.style.display="inherit",a.$errorMessage.textContent=b,a.$retry.style.display="block"},_removeError:function(a){a.$fileContainer.classList.remove("error"),a.$fileIcon.classList.add("soui-icon-18-file"),a.$fileIcon.classList.remove("soui-icon-18-file-active"),a.$cancel.classList.add("soui-icon-12-cancel"),a.$cancel.classList.remove("soui-icon-12-cancel-active"),a.$progressBarContainer.style.display="inherit",a.$errorContainer.style.display="none"}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";NL.InputWrapper=function(a,b){var c={controller:void 0,disabled:!1,readOnly:!1,mandatory:!1,strict:!1,icon:null,format:null,help:null,error:null,inputParams:{},context:{}};this._controller=b.controller;var d={help:this._controller.getHelp(a),error:this._controller.getError(a),mandatory:this._controller.isMandatory(a),strict:this._controller.isStrict(a)},e=$.extend({},c,d,b);this.jpath=a,this._vc=null,this.$value=null,this.readOnly=e.readOnly,this.disabled=e.disabled,this.mandatory=e.mandatory,this.strict=e.strict,this.help=e.help,this.error=e.error,this.icon=e.icon,this.format=e.style,this.inputParams=e.inputParams,this.context=e.context,this._injectItem(),this._controller.observerReady(this)},NL.InputWrapper.prototype._injectItem=function(){if(!this._vc){var a={readOnly:this.readOnly,disabled:this.disabled,strict:this.strict,format:this.format,icon:this.icon};this._vc=ViewControllerManager.newViewController(this._controller,this.jpath,a,this.inputParams),this.$value=this._vc.widget(),this.$value.addClass("value"),this._vc.isVariableHeight()?this.$value.addClass("variable-height"):this.$value.addClass("fixed-height"),this._vc.initialize(this.context),this._controller.registerJpathObserver(this._vc.jpath,this)}this._vc.setError(this.error),this._vc.setDisabled(this.disabled)},NL.InputWrapper.prototype.getInputBlock=function(){return this.$value},NL.InputWrapper.prototype.setDisabled=function(a){this._vc.setDisabled(a)},NL.InputWrapper.prototype.setReadOnly=function(a){this._vc.setReadOnly(a)},NL.InputWrapper.prototype.refresh=function(){this._vc&&this._vc.setValue(this._controller.getValue(this.jpath))},NL.InputWrapper.prototype.onJpathNotify=function form_onJpathNotify(a,b,c,d){if(SO.String.startsWith(this.jpath,b)){var e=c;if(b!==this.jpath&&(e=this._controller.getValue(this.jpath)),void 0!==this._vc){if(d._sourceObserver!==this._vc)switch(a){case"error":this._vc.setError(e);break;case"update":break;case"value":this._vc.setValue(e);break;case"strict":this._vc.setStrict(e);break;case"params":this._vc.setParamSubtree(d.paramPath,d.value);break;case"mandatory":this._vc.setMandatory(this.mandatory);break;default:throw"Unknown type in method onJpathNotify: "+a}}else this._injectItem()}},SO.ns("NL.WebComponent"),NL.WebComponent.evaluateExpression=function(controller,expr,contextJpath,index){var HasPackage=function(a){return!0},EVal=function(a){for(var b=controller.getEnumValues(a),c=controller.getValue(a),d=void 0,e=0;void 0===d&&b.length>e;e++)b[e].name===c&&(d=b[e].value);return d},EValStr=function(a,b){for(var c=controller.getEnumValues(a),d=void 0,e=0;void 0===d&&c.length>e;e++)c[e].name===b&&(d=c[e].value);return d},EV=function(a,b){var c=controller.getValue(a);return c===b},EL=function(a,b){for(var c,d=controller.getEnumValues(a),e=controller.getValue(a),f=0;void 0===c&&d.length>f;f++)d[f].name===e&&(c=d[f].label);return c&&b===!0&&(c=c.toUpperCase()),c},EI=function(a){for(var b=controller.getEnumValues(a),c=controller.getValue(a),d=void 0,e=0;void 0===d&&b.length>e;e++)b[e].name===c&&(d=b[e].image);return d},GetOption=function(){return""},SubString=function(a){return a},CollectionAttribute=function CollectionAttribute(a){SO.assert(void 0!==index,xtk_webPage.missingCollectionIndex_1(contextJpath));var b="";return b=null===index?contextJpath+"/"+a:contextJpath+"["+index+"]/"+a},GetString=function GetString(){var a=Array.prototype.slice.call(arguments),b=a[0];SO.assert(b,xtk_webPage.missingStringGroupName(expr.expr)),b=b.replace(":","_"),SO.assert(window[b],xtk_webPage.unknownStringGroup(b));var c=a[1],d=a.slice(2),e=window[b][c];return SO.assert(void 0!==e,xtk_webPage.invalidStringInStringGroup(c,b)),e.apply(this,d)},GetMinDate=function GetMinDate(a,b){return a?b?a.lessThan(b)?a:b:a:b},FormatDate=function FormatDate(a,b){return null===a&&(a=new SO.DateTime),SO.DateTime.format(a,{format:b})};return eval(expr.expr)},NL.WebComponent.applyMapping=function(a,b,c,d,e){var f,g={},h=e;SO.isNundef(c)||(h=h+"["+c+"]");for(var i in b)if(b.hasOwnProperty(i)&&(f=b[i].mapping))if("list"===b[i].type){g[i]=[];for(var j=0;f.length>j;j++){if("enabledIfExpr"in f[j]){var k=NL.WebComponent.evaluateExpression(d,f[j].enabledIfExpr,e,c);if(!k)continue}g[i].push(this.applyMapping(a,f[j],c,d,e))}g[i].length||delete g[i]}else{if("enabledIfExpr"in f){var k=NL.WebComponent.evaluateExpression(d,f.enabledIfExpr,e,c);if(!k){i in a&&delete a.paramName;continue}}if(f.const)g[i]=f.const;else if(f.expr)g[i]=this.evaluateExpression(d,f,e,c);else if(f.path){var l=a;if(SO.isNundef(l))l=d.getValue(h+"/"+f.path);else for(var m,n=f.path.split("/");n.length;)if(m=n.shift(),""!==m){if(!(m in l)){l="";break}l=l[m]}g[i]=l}}return g},NL.WebComponent.finalizePatch=function webComponent_finalizePatch(a,b,c,d){if(d){var e=a.getValue(c+"/PKey");e&&(b.PKey=e)}var f=a.getValue(c+"/metadata");f&&(b.metadata=f);for(var g in b)if(b.hasOwnProperty(g)&&"object"==typeof b[g]){var h=c+"/"+g;NL.WebComponent.finalizePatch(a,b[g],h,!0),SO.isArray(b[g])&&(b[g]=SO.Utils.filter(b[g],function(a,b){return"undefined"!=typeof b}))}},SO.ns("NL.Widgets"),SO.Widgets.define("WebPage",{DEFAULT_OPTIONS:{configManager:null,locale:SO.LocaleManager.getDefaultLocale(),timezone:SO.TimezoneManager.getDefaultTimezone()},_create:function _webPageCreate(){var a=this;this._shellAreas={},this._shellWidget={},this._locale=this._options.locale,this._timezone=this._options.timezone,this._configManager=this._options.configManager,this._currentController=this._options.controller,this._metadataService=this._options.metadataService,this._metadataService||(this._metadataService=new NL.MetaDataService(void 0,{dataSourceType:"metadata"})),this._componentFunctions=[],this._dialogStack=[],this._autoRefreshInterval=null,void 0!==this._options.containers?this._containers=this._options.containers:(this._containers={},this._createDelegates()),this._readOnly=!1,this._title="",a._newEntityStoragePath=this._options.structure.privateStoragePath+"/openCreationWebPage/newEntity",a._duplicatedEntityStoragePath="/ignored/private/duplicate";var b=$("<div></div>"),c="";this._options.structure&&(c=this._computeDynamicAttribute(this._options.structure,"title",function(b){a.setTitle(b),a._shellWidget.setTitle(b),a._options.titleDisplay&&a._options.titleDisplay(b)}),this.setTitle(c));var d=!1,e=!1,f=!1;this._options.structure.readOnlyIf&&(d=this._bindExpression(this._options.structure,"readOnlyIf",function(b){var c=!1,d=!1,e="";void 0!==a._options.structure.rootPath&&(c=a._currentController.isReadOnly(a._options.structure.rootPath)),d=c?!0:b,d!==a._readOnly&&(a.setReadOnly(d),e=a.getTitle(),d&&(e=xtk_webPage.readOnly(e)),a._shellWidget.setTitle(e),e&&a._options.titleDisplay&&a._options.titleDisplay(e),a._fullRefresh(""))})),void 0!==this._options.structure.rootPath&&(e=this._currentController.isReadOnly(this._options.structure.rootPath)),f=e?!0:d,this.setReadOnly(f),this.isReadOnly()&&c&&(c=xtk_webPage.readOnly(c)),c&&this._options.titleDisplay&&this._options.titleDisplay(c);var g={},h={},i=[];if(this._options.structure.canSave){SO.assert(this._options.structure.rootPath,"A root path is necessary to trigger the save");var j;g.right=[],h={save:{label:xtk_webPage.save(),mode:"transparent",icon:"coral-checkCircle",command:function(b){b.$el.hide(),a._shellWidget.showOperator(),a._currentController.save(function(c){c?(a._resetTemporaryHandling(),a._currentController._metamodel.exists(a._newEntityStoragePath)&&a._currentController.setValueNotDirty(a._newEntityStoragePath,{})):(b.$el.show(),a._shellWidget.hideOperator())},[a._options.structure.rootPath])}},cancel:{label:xtk_webPage.cancel(),mode:"quiet",icon:"coral-closeCircle",command:function(b){var c="/rest"+a._currentController.getValue("/private/webPage/originalUrl");a._currentController.rollback(),a._currentController.setDirty(!1),b.$el.hide(),a._shellWidget.showOperator(),a._resetTemporaryHandling();var d=new NL.Transport.REST({url:c,method:"GET"});d.start({onSuccess:function(b){a._currentController.setValue("/private/webPage/tmpRestUrl",null),a._currentController.setValue("/private/webPage/currentMainResource",c);var d=a._currentController._metamodel.getAllTypes(a._options.structure.rootPath);b=SO.MVC.Model.parseJSON(b,d);var e=new SO.MVC.Model(b);a._processLazyLoadedCollection(a._options.structure.rootPath,e,["PKey","href","metadata"]),a._currentController.setValueNotDirty(a._options.structure.rootPath,e._model),a._currentController.startTransaction()},onError:function(){}}),a._currentController.setValueNotDirty(a._newEntityStoragePath,{})}}},g.right.push("cancel"),g.right.push("save"),j=new SO.Widgets.cmdBar($('<div class="nlui-blackbar-actions"></div>').hide(),{commands:g.right,commandConfigs:h}),i=[j.$el],this._currentController.registerOnDirtyChanged(function(b){if(b){if(j.$el.show(),a._shellWidget.hideOperator(),a._options.structure.canSave){j.setCommandAttribute("save","disabled",!0);var c=a._options.structure.resource.split("/");c.length=4;var d=c.join("/");a._switchToTemporary(d,a._options.structure.rootPath,function(a){a&&j.setCommandAttribute("save","disabled",!1)})}}else j.$el.hide(),a._shellWidget.showOperator()})}var k={globalActions:this._options.structure&&this._options.structure.actionBar&&this._options.structure.actionBar.globalActions?[]:!1,localActions:this._options.structure&&this._options.structure.actionBar&&this._options.structure.actionBar.localActions?[]:!1,viewConfig:this._options.structure&&this._options.structure.actionBar&&this._options.structure.actionBar.viewConfig?[]:!1,viewSwitcher:this._options.structure&&this._options.structure.actionBar&&this._options.structure.actionBar.viewSwitcher?[]:!1,reports:this._options.structure&&this._options.structure.actionBar&&this._options.structure.actionBar.reports?[]:!1};this._options.structure&&this._options.structure.wizard&&this._options.structure.wizard.hasActionBar&&this._options.structure.wizard.steps.length>0&&(k={globalActions:[],localActions:[],viewConfig:[],viewSwitcher:[],reports:[]});var l,m,n,o,p;m=[],n=!1,p=this._options.structure&&(this._options.structure.canvas&&this._options.structure.canvas.padding||this._options.structure.overviewList&&this._options.structure.overviewList.padding)||0,this._options.structure&&this._options.structure.rail&&(o=this._options.structure.rail,o&&o.tabs&&(n=o.collapsed,m=o.tabs)),this._options.structure.overviewList?this._options.structure.canvas={}:this._options.structure&&this._options.structure.wizard&&this._options.structure.wizard.hasRail&&(m=[],n=!0),this._options.structure.wizard&&(this._options.structure.canvas={},this._options.$headerLeftZone&&(this._$wizardNavigationLeft=this._options.$headerLeftZone),this._options.$headerCenterZone&&(this._$wizardBreadCrumb=this._options.$headerCenterZone),this._options.$headerRightZone&&(this._$wizardNavigationRight=this._options.$headerRightZone),this._options.cancelParentDialog&&(this._wizardOnAbort=this._options.cancelParentDialog),this._options.closeParentDialog&&(this._wizardValid=this._options.closeParentDialog));var q=SO.Utils.extend(!0,{},{blackBar:{title:c,rightContent:i},actionBar:k,rail:{collapsed:n,tabs:[]},canvas:{content:b,padding:p,background:this._options.structure.canvas&&this._options.structure.canvas.background}},this._options.shellConfig);if(this._shellWidget=new SO.Widgets.Shell(this._options.container,q),this._shellAreas.$globalActionsActionBar=this._shellWidget.getActionBar("globalActions"),this._shellAreas.$localActionsActionBar=this._shellWidget.getActionBar("localActions"),this._shellAreas.$viewConfigActionBar=this._shellWidget.getActionBar("viewConfig"),this._shellAreas.$viewSwitcherActionBar=this._shellWidget.getActionBar("viewSwitcher"),this._shellAreas.$reportsActionBar=this._shellWidget.getActionBar("reports"),this._setCurrentShellRail(m),this._setCurrentShellCanvas(b),this._currentController.registerObserver("blocks",this,null),this._currentController.registerOnFullRefresh(function(){a._fullRefresh("")}),this._options.structure.autoRefresh&&0!==this._options.structure.autoRefresh.period&&(this._autoRefreshInterval=window.setInterval(function(){window.location.reload()},1e3*this._options.structure.autoRefresh.period),this._currentController.registerOnDirtyChanged(function(b){b&&window.clearInterval(a._autoRefreshInterval)})),this._options.structure.reports&&this._buildReportList(this._options.structure.reports,"","",{}),this._options.structure.poller){this._currentController.registerOnDirtyChanged(function(a){a&&w.stop()});var r=this._options.structure.poller,s=[],t=SO.Utils.extend([],r.resources);if(t.length>0){for(var l=0;t.length>l;l++){var u=t[l];if(u.forceRefreshPath&&function(b){a._currentController.registerJpathObserver(b.forceRefreshPath,{onJpathNotify:function(c,d,e){e===!0&&(w.resetProgression(b),w.refreshNow(b),a._currentController.setValue(d,!1,!1))}})}(u),"dstPath"in u&&(u.setPath=u.dstPath),u.enabledIfExpr&&(u.enableIf=function(b){return function(){var c=NL.WebComponent.evaluateExpression(a._currentController,b.enabledIfExpr);return c||w.resetProgression(b),c}}(u)),u.hasProgressed=function(a){return function(b){delete b.PKey;var c=!1;return SO.Utils.isEqual(b,a.oldData)||(c=!0),c}}(u),u.process=function(b){return function(c){for(var d,e=0;b.actions.length>e;e++){var f=b.actions[e];switch(f.type){case"set":if(!a._currentController.isDirty()){var g=b.setPath;if(SO.String.startsWith(g,"/rest")&&(g=g.substr(5)),SO.isObject(c)){delete c.PKey;for(var h in c)d=a._currentController._metamodel.getAllTypes(g+"/"+h),c[h]=SO.MVC.Model.parseJSON(c[h],d),a._currentController.setValueNotDirty(g+"/"+h,c[h],!0)}else d=a._currentController._metamodel.getAllTypes(g),c=SO.MVC.Model.parseJSON(c,d),a._currentController.setValueNotDirty(g,c,!0)}}}}}(u),u.pathExpr){u._isPolled=!1;var v=a._bindExpression(u,"pathExpr",function(a,b){b._isPolled&&(w.delResource(b),b._isPolled=!1),a&&("dstPath"in b||(b.setPath=a),b._isPolled=!0,b.url=a,w.addResource(b))});v&&("dstPath"in u||(u.setPath=v),u._isPolled=!0,u.url=v,s.push(u))}else"dstPath"in u||(u.setPath=u.path),s.push(u)}var w=new NL.Poller({interval:r.interval,resources:s})}}if(this._shellAreas.$canvas&&this._shellAreas.$canvas.addClass("nlui-webpage-container-fullsize"),void 0!==this._options.structure.initActions){for(var x=[],l=0;this._options.structure.initActions.length>l;l++)x.push(this._buildAction(this._options.structure.initActions[l]));this._sequentialCaller(this._currentController,null,x,0,function(){a._build()})}else this._build()},_setCurrentShellRail:function(a){var b=this;this._shellAreas.railTabs=a;var c=[];b._currentTabSelected=void 0,SO.Utils.each(a,function(a,d){var e,f,g,h=!0;f=$("<div></div>"),c.push(f),g=b._computeDynamicAttribute(d,"selected"),g=void 0!==g&&null!==g&&g!==!1,e=b._shellWidget.getOption("rail").collapsed,e||g||0!==a||(g=!0),d.content.visibleIfExpr&&(h=b._bindExpression(d.content,"visibleIfExpr",function(a){b._shellWidget.toggleRailTab(d.content.id,a)})),b._shellWidget.addRailView({id:d.content?d.content.id:void 0,icon:d.icon,caption:d.caption,padding:d.padding,label:d.label,content:f,visible:h},g,!1),(g&&h!==!1||h!==!1&&void 0===b._currentTabSelected&&!e)&&(b._currentTabSelected=a)}),a.length>0&&(this._options.structure.rail&&(this._options.structure.rail.collapsed?this._shellWidget.hideRail():this._shellWidget.showRail()),this._shellWidget.enableRail(),this._shellWidget.rebuildLayout()),this._shellAreas.railContents=c},_setCurrentShellCanvas:function(a){this._shellAreas.$canvas=a},_clearCurrentShellRail:function(){this._shellAreas.railContents=[],this._shellWidget.clearRailViews()},_clearCurrentShellActionBar:function(){this._shellAreas.$globalActionsActionBar.empty(),this._shellAreas.$localActionsActionBar.empty(),this._shellAreas.$viewConfigActionBar.empty(),this._shellAreas.$viewSwitcherActionBar.empty(),this._shellAreas.$reportsActionBar.empty()},_clearCurrentShellCanvas:function(){this._shellAreas.$canvas.empty()},_createDelegates:function(){if(void 0!==this._options.structure.delegateIds)for(var a=0;this._options.structure.delegateIds.length>a;a++){var b=new SO.Widgets.cellLayout,c={formLayout:new SO.Widgets.formLayout({cells:[b]})};c.cell=b,this._containers[this._options.structure.delegateIds[a]]=c}},_build:function pageBuild(){this._options.structure.overviewList?this._prepareOverviewList():this._options.structure.wizard?this._prepareWizard(this._options.structure.wizard):this._fullRefresh("");for(var a=0;this._componentFunctions.length>a;a++)try{this._componentFunctions[a]()}catch(b){SO.log.warn(xtk_webPage.componentFunctionException()),SO.log.warn(b)}},onBlockNotify:function webPage_onBlockNotify(a,b){this._fullRefresh(b)},_fullRefresh:function(a){this._options.structure.actionBar&&this._processElement(null,this._options.structure.actionBar,"",a),this._shellAreas.railContents&&this._options.structure.rail&&this._processElement(null,this._options.structure.rail,"",a),this._options.structure.crud&&this._processElement(null,this._options.structure.crud,"",a),this._options.structure.canvas._$block=this._shellAreas.$canvas,this._options.structure.isListItem&&(this._options.structure.canvas.isListItem=!0,this._options.structure.canvas.itemIndex=this._options.structure.itemIndex,this._options.structure.canvas.parentPath=this._options.structure.parentPath),this._processElement(null,this._options.structure.canvas,"",a),SO.Widgets.LayoutManager.rebuildLayout(this._shellWidget.$el)},_prepareOverviewList:function _webPage_prepareOverviewList(){return this._options.structure.actionBar&&this._processElement(null,this._options.structure.actionBar,"",""),this._shellAreas.railContents&&this._options.structure.rail&&this._processElement(null,this._options.structure.rail,"",""),this._options.structure.crud&&this._processElement(null,this._options.structure.crud,"",""),this._options.structure.isListItem&&(this._options.structure.overvewList.isListItem=!0,this._options.structure.overvewList.itemIndex=this._options.structure.itemIndex,this._options.structure.overvewList.parentPath=this._options.structure.parentPath),this._processElement(this._shellAreas.$canvas,this._options.structure.overviewList,"",""),this},_updateActionBar:function(a,b,c,d){d.hidden?this._shellWidget.hideActionbar():(this._shellWidget.showActionbar(),a.globalActions&&this._processElement(null,a.globalActions,b,c),a.localActions&&this._processElement(null,a.localActions,b,c),a.viewConfig&&this._processElement(null,a.viewConfig,b,c),a.viewSwitcher&&this._processElement(null,a.viewSwitcher,b,c),a.reports&&this._processElement(null,a.reports,b,c))},_buildActionBar:function(a,b,c,d){if(d.hidden)this._shellWidget.hideActionbar();else{if(this._shellWidget.showActionbar(),a.globalActions){var e=$("<div></div>");this._shellWidget.addActionBarContent("globalActions",e),this._processElement(e,a.globalActions,b,c)}if(a.localActions){var f=$("<div></div>");this._shellWidget.addActionBarContent("localActions",f),this._processElement(f,a.localActions,b,c)}if(a.viewConfig){var g=$("<div></div>");this._shellWidget.addActionBarContent("viewConfig",g),this._processElement(g,a.viewConfig,b,c)}if(a.viewSwitcher){var h=$("<div></div>");this._shellWidget.addActionBarContent("viewSwitcher",h),this._processElement(h,a.viewSwitcher,b,c)}if(a.reports){var i=$("<div></div>");this._shellWidget.addActionBarContent("reports",i),this._processElement(i,a.reports,b,c)}}},_buildRail:function(a,b,c,d){var e=this;if(d.hidden)this._shellWidget.disableRail();else{this._shellWidget.enableRail();var f=a.tabs;this._shellWidget.setOption("onRailViewSelect",function(a,d){var g,h;d>=0?(f[d].content._$block=e._shellAreas.railContents[d]||$("<div></div>"),e._processElement(null,f[d].content,b,c),g=b+"/"+f[d].content.id,h=e._currentController.isHidden(g),e._shellWidget.toggleRailTab(f[d].content.id,!h)):e._currentTabSelected=void 0}),void 0!==this._currentTabSelected&&e._shellWidget.selectRailView(this._currentTabSelected+1)}},_computeDynamicAttribute:function _computeDynamicAttribute(a,b,c){var d=void 0;return b?d=b in a?a[b]:c?this._bindExpression(a,b+"Expr",function(a,d){c(a,d,b)}):this._bindExpression(a,b+"Expr"):"const"in a?d=a.const:"path"in a?d=this._bindPath(a,a.path,c):"expr"in a&&(d=this._bindExpression(a,"expr",c)),d},_bindPath:function _bindPath(a,b,c){var d=this._currentController.getValue(b),e=this;return c&&"function"==typeof c&&e._currentController.registerJpathObserver(b,{onJpathNotify:function(f,g,h){if("value"===f){var h=e._currentController.getValue(b);d!=h&&(c(h,a,"path",b),d=h)}},refresh:function(){var f=e._currentController.getValue(b);d!=f&&(c(f,a,"path",b),d=f)}}),d},_bindExpression:function _bindExpression(a,b,c){var d=a[b],e=this;if(d){var f=NL.WebComponent.evaluateExpression(this._currentController,d,a.parentPath,a.itemIndex),g=d.exprJpaths;return g&&c&&SO.Utils.each(g,function(g,h){e._currentController.registerJpathObserver(h,{onJpathNotify:function(g,h,i){if("value"===g){var i=NL.WebComponent.evaluateExpression(e._currentController,d,a.parentPath,a.itemIndex);f!=i&&(c(i,a,b),f=i)}},refresh:function(){var g=NL.WebComponent.evaluateExpression(e._currentController,d,a.parentPath,a.itemIndex);f!=g&&(c(g,a,b),f=g)}})}),f}return null},_closeDialog:function _webPage_closeDialog(){var a=this._dialogStack[this._dialogStack.length-1];this._dialogStack.splice(this._dialogStack.length-1,1),a.instanceChildren=[]},_processSoapCall:function(a,b){for(var c=new NL.transport.SOAP({urn:a.service,method:a.name,nsEncoding:"UTF-8"}),d=0;a.children.length>d;d++){var e=a.children[d],f=NL.WebComponent.evaluateExpression(this._currentController,e.expr,a.parentPath,a.itemIndex),g=e.type;c.addParameter("param"+d,g,f)}c.start({onSuccess:function(){b()},onError:function(){b()}})},_executeBuildSubWebPage:function _executeBuildSubWebPage(a,b,c,d,e){var f=this;a.resourceExpr&&a.resourceNameExpr&&(a.resource=NL.WebComponent.evaluateExpression(this._currentController,a.resourceExpr),a.metadataSource=NL.WebComponent.evaluateExpression(this._currentController,a.resourceNameExpr));var g=new SO.Widgets.MessageBox($("<div></div>"),{type:"loading",message:xtk_webPage.loadingSubWebPage()}),h=new NL.transport.REST({url:"/rest/head/webPageStructure",method:"GET",loaderOff:!0});h.start({onSuccess:function(g){var h=JSON.parse(g.metamodel),i=new SO.MVC.Model({});a.fetchData?i=JSON.parse(g.model):a.dataStorage&&i.setValue(a.jpath,f._currentController.getValue(a.dataStorage));var j=JSON.parse(g.statemodel),k=JSON.parse(g.structure);JSON.parse(g.clientScripts);var l,m=JSON.parse(g.parameters),n={};if(a.params)for(l=0;a.params.length>l;l++){var o=a.params[l];"const"in o&&(n[o.name]=o.const),"path"in o&&(n[o.name]=f._currentController.getValue(o.path)),"expr"in o&&(n[o.name]=NL.WebComponent.evaluateExpression(f._currentController,o.expr))}if(a.newController){var p=f._currentController,q={metamodel:h._metamodel,model:i._model,statemodel:j._statemodel,workingSpace:["/ignored","/private"],dataFormat:"json"};a.pageController&&(q.pageController=!0),f._currentController=new SO.MVC.Controller(q),f._currentController.startTransaction(),a.jpath&&f._currentController.registerOnSave(function(b){return f.onSave(b,d,e,a.noRefresh)}),i._model.tmp&&f._currentController.propagateValues("/tmp",p.getValue("/tmp")),i._model.ignored&&f._currentController.propagateValues("/ignored",p.getValue("/ignored"))}else{k.rootPath=f._options.structure.rootPath;var r=new SO.MVC.Controller({metamodel:h._metamodel,model:i._model,statemodel:j._statemodel,dataFormat:"json"});a.jpath&&!f._currentController._metamodel.exists(a.jpath)&&f._currentController._metamodel.setSubtree(a.jpath,r._metamodel._getItem(a.jpath)),r._metamodel.exists("/head")&&f._currentController._metamodel.importSubtree("/head",r._metamodel._getItem("/head"));try{f._currentController._statemodel.setSubtree(a.jpath,r._statemodel._getItem(a.jpath))}catch(s){}r._metamodel.exists("/tmp")&&f._currentController._metamodel.importSubtree("/tmp",r._metamodel._getItem("/tmp"),!0),r._metamodel.exists("/ignored")&&f._currentController._metamodel.importSubtree("/ignored",r._metamodel._getItem("/ignored"),!0),r._metamodel.exists("/private")&&f._currentController._metamodel.importSubtree("/private",r._metamodel._getItem("/private")),f._processLazyLoadedCollection(a.jpath,i,["PKey","href","metadata"]),f._currentController=f._currentController.buildSubController()}a.onOpen&&a.onOpen(f._currentController,f);var t;for(t=0;m.length>t;t++){var o=m[t];f._currentController.setValue(o.dstPath,n[o.name])}a.isTemporaryEntity&&(f._setTemporaryEntity(!0),f._currentController.setValue("/private/webPage/tmpRestUrl",f._currentController.getValue(a.dataStorage).href)),k.type="perl",k.newPage=!0;var u=!0,v=!1,w=f._computeDynamicAttribute(k,"title");k.metadataService=a.metadataService,k.wizard&&(u=!1,v=!0,w="");var x=k.leaveActions,y="fullPage";a.dialogMode&&(y=a.dialogMode);var z={mode:y,type:"openWebPage",children:[k],noButtons:v,newController:a.newController,pageController:a.pageController};k.titleExpr?z.titleExpr=k.titleExpr:a.title=a.dialogTitle||w,f._buildStandardDialog(z,b,c,{closeButton:u},{close:function(b,c,e){var g="cancel"!==e;a.newController?a.pageController&&f._currentController.unregisterUnloadHandler():f._currentController=f._currentController.getParent();var h=function(){if(g)if("auto"===a.creationMode)d&&d();else if(a.newController){if(a.createInWorkflow){var b={PKey:f._currentController.getValue(a.dataSource+"/PKey"),title:f._currentController.getValue(a.dataSource+"/label")},c=f._currentController.getValue("/ignored/deliveryActivityMetadata"),e={};e[a.activityDeliveryPath+c]="link",p._metamodel.setType(a.activityDeliveryPath,"container"),p._metamodel.setType(a.activityDeliveryPath+c,"link"),b=SO.MVC.Model.parseJSON(b,e),p.setValue(a.activityDeliveryPath+c,b),"deliveryTemplate"==c?(p.setValue(a.activityDeliveryPath+"img","nms:activities/recurrentEmail.svg"),p.setValue(a.activityDeliveryPath+"deliverySel","new"),p.setValue(a.activityDeliveryPath+"actionType","prepare")):(p.setValue(a.activityDeliveryPath+"img","nms:activities/email.svg"),p.setValue(a.activityDeliveryPath+"actionType","prepareAndStart"))}else f._currentController.save(null,[a.jpath]);f._currentController=p}else if(f._currentController.commitSubController(),a.editInWorkflow){var h=f._currentController.getCurrentPatch(a.dataSource),i=f._currentController.getValue(a.dataSource+"/PKey");NL.WebComponent.finalizePatch(f._currentController,h,a.dataSource);var j=f._currentController.getDataSource(a.editWorkflowPath+"/deliveries").getURL()+i,k=new NL.Transport.REST({url:j,method:"PATCH"}),l={onSuccess:function(){d&&d()}};k.start(l,h)}else d&&d();else a.newController?f._currentController=p:f._currentController.rollbackSubController()};if(void 0!==x){for(var i=[],j=0;x.length>j;j++)i.push(f._buildAction(x[j]));h.displayName="leaveActionsDoneCallbackInSubWebPageDialogClosure",f._sequentialCaller(f._currentController,null,i,0,h)}else h()}}),a.newController&&a.jpath&&a.creationMode&&f._currentController.setDirty(!0)},onComplete:function(){g.close()}},{name:a.name,resource:a.path,options:JSON.stringify({creation:"openCreationWebPage"===a.type,navigatePostCreation:a.navigatePostCreation,creationResource:a.resource,createInWorkflow:a.createInWorkflow,listItem:a.listItem,fetchData:a.fetchData,checkParameters:!1,hasRemove:a.hasRemove,hasDuplicate:a.hasDuplicate,params:{dataPrefix:a.dataPrefix,resource:a.dataSource,metadataPrefix:a.metadataPrefix,metadataSource:a.metadataSource}})})},_preOpen:function webPage_creationPreOpen(a,b,c,d){var e=this;if(!e._options.structure.canSave)throw new Error(xtk_webPage.noCanSave());e._switchToTemporary(e._options.structure.resource,e._options.structure.rootPath,function(a){a&&SO.isFunction(d)&&d()})},_autoPreOpen:function webPage_creationAutoPreOpen(a,b,c,d){var e=this,f=a.jpath;a.dataStorage=f;var g=this._getResourceURL(a);a.dataPrefix&&(g+="/"+a.dataPrefix),e._currentController.setValue("/private/webPage/originalUrl",g);var h={};a.resourceType&&(h.metadata=a.resourceType);var i=e._buildAction({type:"create",resource:g,postOnTmp:a.postOnTmp,forceMainEntityToTmp:a.forceMainEntityToTmp,dstPath:f,data:h,params:[]},b,c);i(e._currentController,null,d)},_open:function webPage_creationOpen(a,b,c,d){var e=this;a.subCollection&&a.subCollectionLazyLoaded&&(a.resource=e._currentController.getDataSource(a.resourcePath).getURL()),e._executeBuildSubWebPage(a,b,c,d)},_autoPostOpen:function webPage_creationAutoPostOpen(a,b,c,d){var e=this;"auto"!==a.creationMode||a.newController||e._currentController.commitSubController();var f=e._buildAction({type:"save",resource:a.resource,srcPath:a.jpath,params:[]});f(e._currentController,null,d)},_postOpen:function webPage_creationPostOpen(a,b,c,d){var e=this;if(a.navigatePostCreation){d=null;for(var f=this._currentController;f._parent;)f=f._parent;var g=e._options.rootPath,h=[];g&&h.push(g);var i=null;f.save(function(b){if(b){var c=f.getValue(e._options.privateStoragePath+"/openCreationWebPage/newEntity"),d={PKey:c.name},g=e._replaceURLPattern(d,a.nextPageURLPattern),h=e._buildAction({type:"navigate",params:[],url:g});h(f)}else i&&i.close()},h),i=new SO.Widgets.MessageBox($("<div></div>"),{type:"loading",delay:0})}d&&d()},_buildAction:function _buildAction(a,b,c){var d=this,e=a.type,f=a.enabledIfExpr,g=function(g,h,i){if(f){var j=NL.WebComponent.evaluateExpression(d._currentController,f,a.parentPath,a.itemIndex);if(!j)return i&&i(),void 0}if(a.isListItem&&h.position>=0&&(a.path=a.parentPath+"["+h.position+"]/"+a.relativePath,a.itemIndex=h.position),"navigate"===e){var k="";"url"in a?k=new SO.Structure.URL(a.url):"urlExpr"in a&&(k=new SO.Structure.URL(NL.WebComponent.evaluateExpression(d._currentController,a.urlExpr,a.parentPath,a.itemIndex)));for(var l,m={},n=0;a.params.length>n;n++)l=a.params[n],"const"in l&&(m[l.name]=l.const),"path"in l&&(m[l.name]=d._currentController.getValue(l.path)),"expr"in l&&(m[l.name]=NL.WebComponent.evaluateExpression(d._currentController,l.expr,a.parentPath,a.itemIndex));k.query(m);var o=d._addSecurityTokenToUrl(k.toString());a.newTab?window.open(o,"_blank"):document.location.href=o}else if("navigateBack"===e)window.history.back();else if("openDialog"===e)d._buildDialog(SO.Utils.extend(!0,{},a),b,c,i);else if("refresh"===e)window.location.reload();else if("refreshPageData"===e){var p="/rest"+d._options.structure.resource;d._isTemporaryEntity()&&(p=d._currentController.getValue("/private/webPage/tmpRestUrl"));var q={resource:p,dstPath:d._options.structure.rootPath,verb:"GET",type:"restCall",params:[],notDirty:!0},r=d._buildAction(q);r(d._currentController,null,i)}else if("reloadCollectionData"===e)d._currentController.getCollection(a.jpath,0,0,{onSuccess:function(){i&&i()},onError:function(){},onComplete:function(){}},!0,"");else if("soapCall"===e)d._processSoapCall(a,i);else if("closeDialog"===e)SO.assert(d._options.closeParentDialog,"Cannot close a dialog from inside."),d._options.closeParentDialog(),i&&i();else if("defaultCloseDialog"===e)d._dialogStack.length>0&&d._dialogStack[d._dialogStack.length-1].widget.close(null,null,"close"),i&&i();else if("defaultCancelDialog"===e)d._dialogStack.length>0&&d._dialogStack[d._dialogStack.length-1].widget.close(null,null,"cancel");else if("set"===e){var s,t=a.dstPath;s=a.autoUpdate?d._computeDynamicAttribute(a,"",function(a){d._currentController.setValue(t,a,!0)}):d._computeDynamicAttribute(a,""),d._currentController.setValue(t,s,!0),i&&i()}else if("if"===e||"when"===e){for(var u=[],n=0;a.actions.length>n;n++){var v=a.actions[n],w=d._buildAction(v,b,c);u.push(w)}var x;if("if"===e){var y=a.expr;x=void 0===y||NL.WebComponent.evaluateExpression(d._currentController,y,a.parentPath,a.itemIndex)}else x=d._bindExpression(a,"expr",function(a){a&&d._sequentialCaller(g,null,u,0)});x?d._sequentialCaller(g,null,u,0,i):i&&i()}else if("update"===e||"create"===e||"save"===e){a.params=a.params||[];var z,A,B,p,C;if("create"===e){C="POST";var D=function(b){SO.assert(b,"Need a valid resource to create or update an entity");
var c=new NL.Transport.REST({url:b,method:C,loaderOff:!0}),f={};a.data&&(f=a.data),a.metadata&&(f.metadata=a.metadata),a.srcPath&&(z=d._currentController.getValue(a.srcPath),m=d._currentController._metamodel.getAllTypes(a.srcPath),f=SO.Utils.extend(f,SO.MVC.Model.serializeJSON(z,m)));for(var g=new SO.MVC.Model(f),h=0;a.params.length>h;h++){B=a.params[h];var j=B.enabledIfExpr,k=!0;if(j&&(k=NL.WebComponent.evaluateExpression(d._currentController,j)),k){var l="";if("const"in B){var m={};m[B.dstPath]=B.type,g.setValue(B.dstPath,SO.MVC.Model.serializeJSON(B.const,m))}else if("expr"in B){l=NL.WebComponent.evaluateExpression(d._currentController,B.expr);var m={};m[B.dstPath]=B.type,g.setValue(B.dstPath,SO.MVC.Model.serializeJSON(l,m))}else if("path"in B){l=d._currentController.getValue(B.path);var m=d._currentController._metamodel.getAllTypes(B.path);g.setValue(B.dstPath,SO.MVC.Model.serializeJSON(l,m))}}}var n={onSuccess:function(b){if(a.navigate){var c=d._replaceURLPattern(b,a.nextPageURLPattern);window.location.href=d._addSecurityTokenToUrl(c)}else{if(a.forceMainEntityToTmp||(d._setTemporaryEntity(!0),d._currentController.setValue("/private/webPage/tmpRestUrl",b.href)),"dstPath"in a){if("create"===e){var f=d._currentController._metamodel.getAllTypes(a.dstPath);b=SO.MVC.Model.parseJSON(b,f);var g=new SO.MVC.Model(b);d._processLazyLoadedCollection(a.dstPath,g,["PKey","href","metadata"]),d._currentController.setValue(a.dstPath,g._model,!0)}"update"===e&&(d._currentController.setValue(a.dstPath+"/href",b.href,!0),d._currentController.setValue(a.dstPath+"/PKey",b.PKey,!0))}i&&i()}}};c.start(n,g._model)};if(a.forceMainEntityToTmp)d._switchToTemporary(d._options.structure.resource,d._options.structure.rootPath,function(b){if(b){var c=d._getResourceURL(a);D.call(d,c)}});else{var p=d._getResourceURL(a);a.postOnTmp&&(p+="/tmp"),D.call(d,p)}}else if("update"===e||"save"===e){var E={};"save"===e?a.srcPath&&(p=d._currentController.getValue(a.srcPath).href,E=d._currentController.getCurrentPatch(a.srcPath),NL.WebComponent.finalizePatch(d._currentController,E,a.srcPath)):(p=d._currentController.getValue(a.dstPath).href,a.srcPath&&(z=d._currentController.getValue(a.srcPath),A=d._currentController._metamodel.getAllTypes(a.srcPath),E=SO.Utils.extend(E,SO.MVC.Model.serializeJSON(z,A)))),SO.assert(p,"Need a valid resource to create or update an entity");var F=new NL.Transport.REST({url:p,method:"PATCH",loaderOff:!0});a.data&&(E=a.data);for(var G=new SO.MVC.Model(E),n=0;a.params.length>n;n++){B=a.params[n];var H=B.enabledIfExpr,I=!0;if(H&&(I=NL.WebComponent.evaluateExpression(d._currentController,H)),I){var s="";if("const"in B){var A={};A[B.dstPath]=B.type,G.setValue(B.dstPath,SO.MVC.Model.serializeJSON(B.const,A))}else if("expr"in B){s=NL.WebComponent.evaluateExpression(d._currentController,B.expr);var A={};A[B.dstPath]=B.type,G.setValue(B.dstPath,SO.MVC.Model.serializeJSON(s,A))}else"path"in B&&(s=d._currentController.getValue(B.path),A=d._currentController._metamodel.getAllTypes(B.path),G.setValue(B.dstPath,SO.MVC.Model.serializeJSON(s,A)))}}var J={onSuccess:function(b){if("save"===e){var c=new NL.Transport.REST({url:a.resource,method:"POST",loaderOff:!0}),b={PKey:d._currentController.getValue(a.srcPath+"/PKey")},f={onSuccess:function(b){if(d._currentController.unregisterUnloadHandler(),a.navigate){var c=d._replaceURLPattern(b,a.nextPageURLPattern);window.location.replace(d._addSecurityTokenToUrl(c))}else K.close(),i&&i()}};c.start(f,b)}else if(K.close(),a.navigate){var g=d._replaceURLPattern(b,a.nextPageURLPattern);window.location.href=d._addSecurityTokenToUrl(g)}else{if("dstPath"in a){if("create"===e){var h=d._currentController._metamodel.getAllTypes(a.dstPath);b=SO.MVC.Model.parseJSON(b,h),d._currentController.setValue(a.dstPath,b,!0)}"update"===e&&(d._currentController.setValue(a.dstPath+"/href",b.href,!0),d._currentController.setValue(a.dstPath+"/PKey",b.PKey,!0))}i&&i()}}},K=new SO.Widgets.MessageBox($("<div></div>"),{type:"loading",message:xtk_webPage.loadingSubWebPage()});F.start(J,G._model)}}else if("sync"===e){for(var L=d._options.structure.rootPath,M=d._currentController;M._parent;)M=M._parent;var N=M.getCurrentPatch(L);"{}"==JSON.stringify(N)?i():d._syncTmpEntity(N,function(){i()})}else if("restCall"===e){var A,B,p;p=d._getResourceURL(a);for(var O=new NL.Transport.REST({url:p,method:a.verb}),E={},G=new SO.MVC.Model(E),n=0;a.params.length>n;n++){B=a.params[n];var s="";if("const"in B){var A={};A[B.name]=B.type,G.setValue(B.name,SO.MVC.Model.serializeJSON(B.const,A))}else if("expr"in B){s=NL.WebComponent.evaluateExpression(d._currentController,B.expr);var A={};A[B.name]=B.type,G.setValue(B.name,SO.MVC.Model.serializeJSON(s,A))}else"path"in B&&(s=d._currentController.getValue(B.path),A=d._currentController._metamodel.getAllTypes(B.path),G.setValue(B.name,SO.MVC.Model.serializeJSON(s,A)))}var J={onSuccess:function(b){if("dstPath"in a){if("DELETE"===a.verb){var c=d._currentController._metamodel.getType(a.dstPath);switch(c){case"list":var e=d._currentController._metamodel.getKeys(a.dstPath);b=e.length>0?[]:{};break;default:b=null}a.notDirty=!0}else{var f=d._currentController._metamodel.getAllTypes(a.dstPath);b=SO.MVC.Model.parseJSON(b,f)}a.notDirty?d._currentController.setValueNotDirty(a.dstPath,b,!0):d._currentController.setValue(a.dstPath,b,!0)}i()}};O.start(J,G._model)}else if("delete"===e){var p=d._getResourceURL(a);SO.assert(p,"Need a valid resource to delete an entity"),p=SO.String.removeSuffix(p,"/");var O=new NL.transport.REST({url:p+"/"+h.item.PKey,method:"DELETE"}),J={onSuccess:function(){i()}};O.start(J)}else if("duplicate"===e){var p=d._getResourceURL(a);SO.assert(p,"Need a valid resource to duplicate an entity");var P,O=new NL.transport.REST({url:p,method:"POST"}),E={PKey:h.item.PKey},Q=h.item.metadata;P=h.detailURLPattern?h.detailURLPattern:h.metadataTypeUrlPattern[Q];var J={onSuccess:function(b){var c=d._currentController._metamodel.getAllTypes(a.dstPath);if(b=SO.MVC.Model.parseJSON(b,c),d._currentController.setValue(a.dstPath,b,!0),a.navigate){var e=d._replaceURLPattern(b,P),f=d._buildAction({type:"navigate",params:[],url:e});new SO.Widgets.MessageBox($("<div></div>"),{type:"loading",delay:0}),f(d._currentController)}else i&&i()}};O.start(J,E)}else if("openCreationWebPage"===e)"auto"===a.creationMode?d._autoPreOpen(a,b,c,function(){d._open(a,b,c,function(){d._autoPostOpen(a,b,c,i)})}):d._open(a,b,c,function(){d._postOpen(a,b,c,i)});else if("openWebPage"===e)d._executeBuildSubWebPage(a,b,c,i);else if("pick"===e){a._$block=$("<div></div>"),d._buildItemPicker(a,b,c,{});var R={onJpathNotify:function(b){"value"===b&&(d._currentController.unregisterJpathObserver(a.jpath,R),i&&i())}};d._currentController.registerJpathObserver(a.jpath,R)}else SO.log.warn(xtk_webPage.unsupportedCommandSubnode(e))};return g.displayName="_webPage_action_"+e+(a.jpath?"_"+a.jpath:"")+(a.dstPath?"_"+a.dstPath:""),g},_sequentialCaller:function _webPage_sequentialCaller(a,b,c,d,e){if(c.length>d){var f=this;c[d](a,b,function(){f._sequentialCaller(a,b,c,d+1,e)})}else e&&e()},_prepareCommand:function _webPage_prepareCommand(a,b,c){for(var d=this._computeDynamicAttribute(a,"label"),e=a.name,f=a.mode,g=a.icon,h=a.help,i=a.confirmDialog,j=this,k=[],l=0;a.children.length>l;l++)k.push(this._buildAction(a.children[l],b,c));i&&(i.message=this._computeDynamicAttribute(a.confirmDialog,"message",function(a){i.message=a}));var m=function(a,b,c){if(this.forceSave&&j._currentController.isDirty())j._currentController._parent&&(j._currentController=j._currentController.getParent(),j._currentController.commitSubController()),j._currentController.save(function(d){d&&(j._resetTemporaryHandling(),j._sequentialCaller(a,b,k,0,c))},[j._options.structure.rootPath]);else if(this.checkSave&&j._currentController.isDirty())$("<div></div>").soMessageBox({type:"confirm",title:xtk_webPage.checkSaveTitle(),confirmButtonLabel:xtk_webPage.save(),message:xtk_webPage.checkSaveText(),onConfirm:function(){j._currentController._parent&&(j._currentController=j._currentController.getParent(),j._currentController.commitSubController()),j._currentController.save(function(d){d&&(j._resetTemporaryHandling(),j._sequentialCaller(a,b,k,0,c))},[j._options.structure.rootPath])}});else if(this.cancellable){var d=j._options.structure.resource,e=j._options.structure.rootPath;j._switchToTemporary(d,e,function(d){d&&(j._currentController.setDirty(!0),j._sequentialCaller(a,b,k,0,c))})}else j._sequentialCaller(a,b,k,0,c)};m.displayName="_webPage_command_"+a.name;var n={label:d,mode:f,icon:g,help:h,confirmDialog:i,forceSave:a.forceSave,checkSave:a.checkSave,cancellable:a.cancellable,command:m};return{name:e,config:n}},_prepareCommandBar:function _webPage_prepareCommandBar(a,b,c){var d=[],e=[],f=[],g={},h=this;return SO.Utils.each(a.children,function(a,i){var j=h._prepareCommand(i,b+"/"+i.id,c);if(i.visibleIfExpr&&i.visibleIfExpr.expr){var k=NL.WebComponent.evaluateExpression(h._currentController,i.visibleIfExpr,i.parentPath,i.itemIndex);j.config.hidden=!k,e.push(i)}if(i.enabledIfExpr&&i.enabledIfExpr.expr){var l=NL.WebComponent.evaluateExpression(h._currentController,i.enabledIfExpr,i.parentPath,i.itemIndex);j.config.disabled=!l,f.push(i)}if(i.disableOnDirty){var m=h._currentController.isDirty();j.config.disabled=j.config.disabled||m,f.push(i)}d.push(j.name),g[j.name]=j.config}),{commands:d,configs:g,visibleConfigs:e,enabledConfigs:f}},_updateCommandBar:function _webPage_updateCommandBar(a,b,c){var d;for(d=0;a.children.length>d;d++){var e=a.children[d];if(e.visibleIfExpr){var f=NL.WebComponent.evaluateExpression(this._currentController,e.visibleIfExpr,e.parentPath,e.itemIndex);a.widget.setCommandAttribute(e.name,"hidden",!f)}if(e.enabledIfExpr){var g=NL.WebComponent.evaluateExpression(this._currentController,e.enabledIfExpr,e.parentPath,e.itemIndex);a.widget.setCommandAttribute(e.name,"disabled",!g)}this._updateCommand(e,b+"/"+e.id,c)}},_buildCommandBar:function _webPage_buildCommandBar(a,b,c){var d=this,e=this._prepareCommandBar(a,b,c),f=$("<div></div>");a._$block.append(f),a.widget=new SO.Widgets.cmdBar(f,{iconSize:24,commands:e.commands,commandConfigs:e.configs,locale:a.locale,timezone:a.timezone}),SO.Utils.each(e.visibleConfigs,function(b,c){c.visibleIfExpr&&d._bindExpression(c,"visibleIfExpr",function(b){a.widget.setCommandAttribute(c.name,"hidden",!b)})}),SO.Utils.each(e.enabledConfigs,function(b,c){c.enabledIfExpr&&d._bindExpression(c,"enabledIfExpr",function(b){a.widget.setCommandAttribute(c.name,"disabled",!b)}),c.disableOnDirty&&d._currentController.registerOnDirtyChanged(function(b){a.widget.setCommandAttribute(c.name,"disabled",b)})})},_updateCommand:function _webPage_updateCommand(a,b,c){for(var d=0;a.children.length>d;d++){var e=a.children[d];this._updateAction(e,b,c)}},_updateAction:function _webPage_updateAction(a,b,c){if("openDialog"===a.type||"openWebPage"===a.type){if(this._dialogStack.length>0){for(var d=null,e=0;this._dialogStack.length>e;e++)if(this._dialogStack[e].structure.id===a.id){d=this._dialogStack[e].structure;break}d&&this._processElement(null,d,b,c)}}else if(a.children)for(var e=0;a.children.length>e;e++)this._processElement(a._$content,a.children[e],b,c)},_updateDialog:function _webPage_updateDialog(a,b,c){var d=this._dialogStack[this._dialogStack.length-1];if(d)for(var e=0;d.instanceChildren.length>e;e++)this._processElement(d.container,d.instanceChildren[e],b,c)},_buildViewBar:function _webPage_buildViewBar(a){var b={},c=[],d=this,e=function(c){for(var e=c.params,f={},g=0;e.length>g;g++)void 0!==e[g].const?f[e[g].name]=e[g].const:void 0!==e[g].expr&&(f[e[g].name]=NL.WebComponent.evaluateExpression(d._currentController,e[g].expr,a.parentPath,a.itemIndex));var h=c.name;return b[h]={type:"navigation",label:c.label,help:c.help,view:h,params:f},h},f=function(a,b){for(var c=0;a.views.length>c;c++){var d=a.views[c];if("view"===d.type){var g=e(d);b.push(g)}else{var h={config:{label:d.label,icon:d.icon},subViews:[]};f(d,h.subViews),b.push(h)}}};f(a,c),a.widget=new SO.Widgets.viewBar({controller:new SO.MVC.Controller,viewConfigs:b,views:c,locale:a.locale,timezone:a.timezone})},_buildKpi:function _webPage_buildKpi(a){a.jpath;var b,c=["primaryText","secondaryText"];({locale:a.locale,timezone:a.timezone});for(var d=0;c.length>d;d++)b=c[d],b in a&&(a[b+"Format"]=a[b].displayFormat,a[b+"FormatOriginal"]=a[b].displayFormat,a[b]=this._computeDynamicAttribute(a[b],"",function(b,c){if(a.widget)switch(c.type){case"primaryText":a.widget.setPrimaryText(b),1!==b&&0!==b||-1===a.primaryTextFormatOriginal.indexOf("percent_")?a.widget.setPrimaryTextFormat(a.primaryTextFormatOriginal):a.widget.setPrimaryTextFormat("percent_0");break;case"secondaryText":a.widget.setSecondaryText(b),1!==b&&0!==b||-1===a.secondaryTextFormatOriginal.indexOf("percent_")?a.widget.setSecondaryTextFormat(a.secondaryTextFormatOriginal):a.widget.setSecondaryTextFormat("percent_0")}}));1!==a.primaryText&&0!==a.primaryText||-1===a.primaryTextFormat.indexOf("percent_")||(a.primaryTextFormat="percent_0"),1!==a.secondaryText&&0!==a.secondaryText||-1===a.secondaryTextFormat.indexOf("percent_")||(a.secondaryTextFormat="percent_0"),a.title=this._computeDynamicAttribute(a,"title",function(b){a.widget&&a.widget.setTitle(b)});var e=this._computeDynamicAttribute(a,"mode",function(b){a.widget&&a.widget.setPrimaryMode(b)});null!==e&&(a.primaryMode=e);var f=$("<div></div>");a._$block.append(f),a.widget=new SO.Widgets.Kpi(f,a)},_prepareWizard:function(a){var b=this,c=$("<div></div>");this._shellAreas.$canvas.append(c),this._shellAreas.$canvas.attr("id",a.id);var d={locale:a.locale,timezone:a.timezone,navigationBar:{navigationLeft:this._$wizardNavigationLeft,navigationRight:this._$wizardNavigationRight,breadCrumb:this._$wizardBreadCrumb},parent:this._shellAreas.$canvas};d.title=a.title||"",d.stepPadding=a.padding,d.steps=[],SO.Utils.each(a.steps,function(c,e){if(e.enabledIfExpr){var f=NL.WebComponent.evaluateExpression(b._currentController,e.enabledIfExpr);if(!f)return}var g=$("<div></div>"),h={id:e.id,label:e.label,content:g,leave:e.leaveActions,lastStep:c===a.steps.length-1},i=function(c,d){if(c.leave&&c.leave.length>0){var e,f=[];for(e=0;c.leave.length>e;e++){var g=c.leave[e];f.push(b._buildAction(g,"",""))}b._sequentialCaller(b._currentController,null,f,0,function(){a.widget.validateStep(c.id,"validated"),d()})}else a.widget.validateStep(c.id,"validated"),d()};"validIf"in e?(h.validIf=e.validIf,h.onValidation=function(c){var d=NL.WebComponent.evaluateExpression(b._currentController,this.validIf,a.parentPath,a.itemIndex);d?i(this,c):a.widget.validateStep(this.id,"unvalidated")}):h.onValidation=function(a){i(this,a)},h.onDisplay=function(){b._clearCurrentShellActionBar(),b._clearCurrentShellRail(),e.content.rail?(b._options.structure.rail=e.content.rail,b._setCurrentShellRail(e.content.rail.tabs),b._processElement(g,e.content.rail,"","")):(b._options.structure.rail=null,b._setCurrentShellRail([])),e.content.actionBar&&(b._options.structure.actionBar=e.content.actionBar,b._processElement(g,e.content.actionBar,"","")),b._options.structure.canvas=e.content.canvas,b._processElement(g,e.content.canvas,"","")},d.steps.push(h)});var e=a.cancelButtonCommand;if(e){var f=this._prepareCommand(e,e.name,""),g=f.config;d.cancelButtonCommand={label:e.label},d.onAbort=function(){g.command(b._currentController,null),b._wizardOnAbort&&b._wizardOnAbort()}}var h=a.lastButtonCommand;if(h){var i=this._prepareCommand(h,h.name,""),j=i.config;d.lastButtonConfig={onSuccess:function(){j.command(b._currentController,null,function(){b._wizardValid&&b._wizardValid()})},mode:j.mode,label:j.label}}a.widget=new SO.Widgets.Wizard(c,d)},_updateWizard:function(a,b,c){for(var d=0;a.steps.length>d;d++)this._processElement(null,a.steps[d],b,c)},_buildWizardStep:function(a,b,c){a._$layout=$("<div></div>");var d=SO.Utils.extend({},a.layout),e=new SO.Widgets.formLayout(a._$layout,d);a._$layout.attr("id",a.id),a._$block.append(a._$layout),a._$block.hide();for(var f=a.children,g=0;f.length>g;g++){var h=f[g];this._processElement(e,h,b,c)}},_updateWizardStep:function(a,b,c){for(var d=a.children,e=0;d.length>e;e++)this._processElement(null,d[e],b,c)},_buildChart:function(a){var b=a.jpath,c=a.renderingType;a.selectionTarget;var d={chartTitle:a.title||null,showLabels:a.showLabels,showLegend:a.showLegend,showTooltip:a.showTooltip,legendPosition:a.legendPosition,titlePosition:a.titlePosition,dataLabelsFormat:"point",chartHeight:200,minYAxis:a.minYAxis};if("tickInterval"in a&&(d.tickInterval=a.tickInterval),this._registerFilterMappings(b,a.conditionMappings),SO.isNundef(a.size)||(d.chartHeight="small"==a.size?90:"medium"==a.size?200:void 0),a.dimension1&&a.dimension2);else if(a.dimension1)if(1===a.measures.length){d.serieTitle=a.measures[0].label;var e={};e[a.measures[0].path]=a.measures[0].displayFormat;var f={renderingType:c,dataProvider:{controller:this._currentController,jpath:b,dimension:a.dimension1,measure:a.measures[0].path},displayFormats:e,layout:d,locale:a.locale,timezone:a.timezone};new SO.Charts.chart1D1(a._$block,f)}else{for(var g=[],h={},e={},i=0;a.measures.length>i;i++){var j=a.measures[i].path;g.push(j),h[j]={label:a.measures[i].label},e[j]=a.measures[i].displayFormat}var f={renderingType:c,dataProvider:{controller:this._currentController,jpath:b,dimensionAttr:a.dimension1,measureAttr:g},legend:h,layout:d,displayFormats:e,locale:a.locale,timezone:a.timezone};new SO.Charts.chart1DN(a._$block,f)}},_checkMethodAvailable:function(a){for(var b,c={owner:window,method:null},d=a.split("."),e=!1;!e&&d.length;)b=d.shift(),b in c.owner||(e=!0,c.method=null),c.method=b,0!=d.length&&(c.owner=c.owner[b]);return e&&SO.log.warn(xtk_webPage.renderingMethodNotFound(a)),c},_buildComponent:function(a){var b=this,c=a.mapping,d=a.resource;switch(a.componentType){case"advancedHtml":var e=null;if(a.html&&(e=$(a.html),a._$block.append(e)),a.function){var f=this._checkMethodAvailable(a.function);f.method&&this._componentFunctions.push(function(){f.owner[f.method](NL.WebComponent.applyMapping(null,c.params,null,b._currentController,c.resource),e,d,b)})}break;case"htmlElement":if(a.function){var f=this._checkMethodAvailable(a.function);if(f.method){var g=f.owner[f.method](NL.WebComponent.applyMapping(null,c.params,null,b._currentController,c.resource),e,d,b);a._$block.append(g)}}break;default:SO.log.warn("Component used out of allowed context"+a.name)}},_buildItemSelector:function(a,b,c){var d=this,e={title:a.title,itemList:a.itemList,locale:a.locale,timezone:a.timezone};if(this._currentController.setValueNotDirty(a.jpath,"",!0),a.itemsPerLine&&(e.itemsPerLine=a.itemsPerLine),a.onValueChange){for(var f=[],g=0;a.onValueChange.length>g;g++)f.push(this._buildAction(a.onValueChange[g],b,c));this._bindPath(a,a.jpath,function(){d._sequentialCaller(d._currentController,null,f,0)})}e.onInternalChange=function(b){d._currentController.setValue(a.jpath,b,!0)};var h=$("<div></div>");a._$block.append(h),a.widget=new SO.Widgets.itemSelector(h,e)},_buildStatus:function(a){var b=this,c=b._computeDynamicAttribute(a,"text",function(b){a.widget.setText(b)}),d=b._computeDynamicAttribute(a,"status",function(b){a.widget.setStatus(b)}),e=b._computeDynamicAttribute(a,"icon",function(b){a.widget.setIcon(b)}),f=a.iconAfter,g=$("<div></div>");a._$block.append(g),a.widget=new SO.Widgets.Status(g,{icon:e,status:d,text:c,iconAfter:f,locale:a.locale,timezone:a.timezone})},_buildPlaceholder:function(a){a._$block.append(this._containers[a.id].formLayout.$el),a._$block.show()},_getPlaceholder:function(a){if(!this._containers[a])throw"The container '"+a+"' is not built or does not exist";return this._containers[a].cell.getContentContainer()},_buildTitle:function pageBuildTitle(a){var b,c=this._computeDynamicAttribute(a,"label",function(b){b&&a._$block.text(b)}),d=a.size||"medium",e=a.center;b="huge"===d?$("<h1></h1>"):"large"===d?$("<h2></h2>"):"small"===d?$("<h4></h4>"):$("<h3></h3>"),c&&(e&&a._$block.addClass("nlui-align-center"),b.text(c),a._$block.append(b))},_buildText:function _webPage_buildText(a){a.params.mode=this._computeDynamicAttribute(a.params,"mode");var b=$("<div></div>");a._$block.append(b),a.widget=new SO.Widgets.TextFormat(b,a)},_buildWell:function _webpage_buildWell(a,b,c){a._$layout=$("<div></div>");var d=SO.Utils.extend({},a.layout),e=new SO.Widgets.formLayout(a._$layout,d),f=$("<div></div>");a._$block.append(f),a.widget=new SO.Widgets.Well(f,{children:[a._$layout],params:a.params});for(var g,h=0;a.children.length>h;h++)g=a.children[h],this._processElement(e,g,b,c)},_buildSection:function _webpage_buildSection(a,b,c){var d={};a._$layout=$("<div />");var e=SO.Utils.extend({},a.layout),f=new SO.Widgets.formLayout(a._$layout,e),g=$("<div />");a._$block.append(g),d.title=this._computeDynamicAttribute(a.params,"title",function(b){a.widget.setTitle(b)}),d.headLine=a.params.headLine,d.style=a.params.style,d.expandable=a.params.expandable,d.collapsed=a.params.collapsed,a.widget=new SO.Widgets.Section(g,{children:[a._$layout],params:d});for(var h,i=0;a.children.length>i;i++)h=a.children[i],this._processElement(f,h,b,c)},_buildMonoFileDropZone:function(a,b,c){var d=this,e=[],f=0;this._uploader||(this._uploader=new NL.Uploader({observeJob:!0}));for(var g=a.job.params,h=new SO.MVC.Model({}),f=0;g.length>f;f++){var i=g[f],j="",k={};if("const"in i)k[i.name]=i.type,h.setValue(i.name,SO.MVC.Model.serializeJSON(i.const,k));else if("expr"in i){j=NL.WebComponent.evaluateExpression(this._currentController,i.expr,a.parentPath,a.itemIndex);var k={};k[i.name]=i.type,h.setValue(i.name,SO.MVC.Model.serializeJSON(j,k))}else"path"in i&&(j=this._currentController.getValue(i.path),k=this._currentController._metamodel.getAllTypes(i.path),h.setValue(i.name,SO.MVC.Model.serializeJSON(j,k)))}if(a.onSuccess)for(f=0;a.onSuccess.length>f;f++)e.push(d._buildAction(a.onSuccess[f],b,c));var l={uploader:this._uploader,job:{entitySchema:a.job.entitySchema,method:a.job.method,comment:a.job.comment,arguments:h.getValue("/")},allowedExtensions:a.allowedExtensions};e.length&&(l.onJobComplete=function(){d._sequentialCaller(d._currentController,null,e,0)});var m=$("<div></div>");a._$block.append(m),a.widget=new SO.Widgets.MonoFileDropZone(m,l)},_buildMessage:function _webPage_buildMessage(a){var b={title:a.title,state:a.mode,displayIcon:a.displayIcon,timezone:a.timezone,locale:a.locale,closable:a.closable};b.message=this._computeDynamicAttribute(a,"message",function(b){a.widget.setMessage(b)});var c=$("<div></div>");a._$block.append(c),a.widget=new SO.Widgets.ActionMessage(c,b),void 0!==a.timeout&&setTimeout(function(){c.hide()},1e3*parseInt(a.timeout,10))},_buildImage:function _webPage_buildImage(a,b,c,d){var e,f,g=this._currentController,h=!0;a.path?this._buildInput(a,b,c,d):(f=this._computeDynamicAttribute(a,"path",function(a){e.setValue(a)}),f||(h=!1,f=this._computeDynamicAttribute(a,"url",function(a){e.setValue(a)})),e=new SO.Widgets.Image({value:f,params:SO.Utils.extend({editable:h},a.inputParams),onInternalChange:function(b){a.dstPath&&g.setValue(a.dstPath,b)}}),a.widget=e,a._$block.append(e.$el))},_buildNotebook:function _webPage_buildNotebook(a,b,c){var d=this,e={tabs:[],layout:a.layout,timezone:a.timezone,locale:a.locale,height:a.height};a.cell&&a.cell.verticalExpand&&(e.height="100%",e.contentDriven=!1);var f={},g=!1,h=a.tabStructures;SO.Utils.each(h,function(h,i){i.attachContent=function(a){return d._processElement(a,i,b,c),i._$layout.addClass("nlui-formlayout-expanded"),i._$block};var j=!0;if(i.visibleIfExpr&&(j=d._bindExpression(i,"visibleIfExpr",function(b){b?a.widget.showTab(i.id):a.widget.hideTab(i.id)})),i.onSelect){g=!0;for(var k=[],h=0;i.onSelect.length>h;h++)k.push(d._buildAction(i.onSelect[h],b,c));f[i.id]=function(){d._sequentialCaller(d._currentController,null,k,0)}}e.tabs.push({id:i.id,label:i.label,display:j,attachContent:i.attachContent,icon:i.icon})}),g&&(e.onSelect=function(a){setTimeout(f[a],0)});var i=$("<div></div>");a._$block.append(i),a.widget=new SO.Widgets.simpleNotebook(i,e)},_updateNotebook:function _webPage_updateNotebook(a,b,c){for(var d,e=a.tabStructures,f=0;e.length>f;f++)d=e[f],d._built&&this._processElement(null,d,b,c),d.visibleIfExpr&&(NL.WebComponent.evaluateExpression(this._currentController,d.visibleIfExpr,a.parentPath,a.itemIndex)?a.widget.showTab(d.id):a.widget.hideTab(d.id))},_createCell:function _webPage_createCell(a,b){var c={dataProvider:{controller:this._currentController},cellConfig:{element:null,hidden:b.hidden}};a.cell&&(c.cellConfig=SO.Utils.extend({},c.cellConfig,a.cell)),a.label&&(c.cellConfig.label=a.label),("radioButton"===a.type||"checkBox"===a.type||"chart"===a.type)&&(c.cellConfig.noLabel=SO.isBoolean(a.noLabel)?a.noLabel:!0),a.jpath?c.dataProvider.jpath=a.jpath:"value"!==a.type&&"component"!==a.type&&(c.cellConfig.noLabel=!0);var d=new SO.Widgets.cellLayout(c);return d},_buildSeparator:function _webPage_buildSeparator(a){var b=$("<hr/>");"none"!==a.lineStyle&&(b.css({border:0,"border-top-style":a.lineStyle,"border-top-color":a.lineColor,"border-top-width":a.lineWidth}),a._$block.append(b)),a._$block.addClass("nlui-webpage-separator").addClass(a.heightClass)},_buildItemPicker:function(a,b,c,d){var e=this,f=a.jpath,g=this._currentController.getParams(f),h=a.flatMode;if(!h){var i=g.inlineRendererName;if(i){var j=this._checkMethodAvailable(i);if(j.method){var k=g.inlineRendererMapping;g.inlineRenderer=function(a){return j.owner[j.method](NL.WebComponent.applyMapping(a.getItem(),k.params,0,e._currentController,f))}}}}var l,m=g.source;if(h)a.listConfig._$block=a._$block,a.listConfig.confId||(a.listConfig.confId="itemPicker_"+m),this._buildList(a.listConfig,m,b,c);else{if(l=this._computeListConfiguration(a.listConfig,m,b,c,d,null),this._currentController.setParamSubtree(m,"/",l),a.filterTabContentStructure){var n=SO.Utils.extend(!0,{},a.filterTabContentStructure);this._processElement($("<div></div>"),n,b,c),this._currentController.setParamSubtree(f,"rail",{tabs:[{icon:"coral-search",id:"search",caption:xtk_core.list_search_button_help(),label:xtk_core.list_search_button_help(),padding:!0,content:n._$block}]})}a.zoomConfig&&(this._currentController.setParamSubtree(f,"zoomInReadOnly",!0),this._currentController.setParamSubtree(f,"zoomTooltip",a.zoomConfig.tooltip),this._currentController.setParamSubtree(f,"zoomAction",function(b){var c=b.getValue().getItem();if(a.zoomConfig.zoomInDialog){var d=e._replaceURLPattern(c,a.zoomConfig.itemDetailResourcePattern),f={type:"openWebPage",name:a.zoomConfig.webPage,metadataSource:a.zoomConfig.detailResourceType,metadataPrefix:void 0,listItem:!1,dataPrefix:void 0,dataSource:d,jpath:d,newController:!0,pageController:!0,fetchData:!0,noRefresh:!0,params:[]},g=e._buildAction(f);g()}else{var h=e._replaceURLPattern(c,a.zoomConfig.itemDetailURLPattern);window.location.href=h}}));var o=this._prepareInput(a,b,c,d);a._$block.append(o.$value)}},_buildPathEdit:function(a,b,c,d){var e=this,f=new NL.MetaDataService(this._metadataService,{dataSourceType:"metadata"}),g={displayBuilder:a.exprBuilder,builderMode:"query",targetResource:"/head/resourceType/"+this._currentController.getValue(a.targetResourcePath),metaDataService:f,filters:"all"!==a.filter?[a.filter]:[],help:xtk_core.exprEdit_builderHelp()};a.dstPath&&(g.onItemSelected=function(b){e._currentController.setValue(a.dstPath,b)}),a.dialogTitle&&(g.dialogTitle=a.dialogTitle),this._currentController.setParamSubtree(a.jpath,"/",g),this._buildInput(a,b,c,d)},_buildExprEdit:function(a,b,c,d){this._buildPathEdit(a,b,c,d)},_updateQueryEditor:function webpage_updateQueryEditor(a){var b=a.widget;b.getResourceURL()!==b._oldResourceURL?b.setResourceURL(b._oldResourceURL):b.reset()},_getURLFromPath:function _webPage_getUrlFromPath(a,b){for(var c=b.split("/"),d=[],e=a,f=0;c.length>f;f++){var g=c[f];e+="/"+g;var h=this._currentController.getValue(e+"/PKey");h?-1!==g.indexOf("[")?(g=g.split("[")[0]+"/"+h,d.push(g)):d.push(h):d.push(g)}var b=d.join("/"),i=this._options.privateStoragePath+"/openCreationWebPage";if(-1!=b.indexOf(i)){var j=this._currentController.getValue(this._options.rootPath).href,k=j.split("/");b="/"+k.splice(2,2).join("/")+b.substring(i.length)}return b},_buildQueryEditor:function webpage_buildQueryEditor(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o;e=this,g=a.paletteContainerId,h=a.actionsContainerId,l=a.jpath,k=g?this._getPlaceholder(g):null,m="/head/",j=a.targetResource?a.targetResource:this._bindPath(a,a.targetResourcePath,function(a){var b=a&&"none"!==a?m+"resourceType/"+a:void 0;f.getResourceURL()!==b&&f.setResourceURL(b),f.getCompatibleResource()!==a&&f.setCompatibleResource(a)}),SO.assert(j,"targetResource must be defined"),k&&k.empty(),i=j&&"none"!==j?m+"resourceType/"+j+"/":void 0,n=e._options.structure.resource,o=e._options.structure.rootPath;var p=$("<div></div>");a._$block.append(p),f=new SO.Widgets.QueryEditor(p,{actionsContainer:h?this._getPlaceholder(h):null,rootURL:m,resourceURL:i,compatibleResource:j,confId:"queryeditor_id_"+this._currentController.getValue(a.entityPath).name,palette:{$container:k},readOnly:d.readOnly,controller:this._currentController,jpath:l,onDelete:function(b){e._switchToTemporary(n,o,function(){var c=e._getURLFromPath(a.entityPath,a.localPath);new NL.transport.REST({url:e._currentController.getValue("/private/webPage/tmpRestUrl")+"/"+c,method:"DELETE"}).start({onSuccess:b||function(){}})})},onPost:function(b,c){e._switchToTemporary(n,o,function(){var d=e._getURLFromPath(a.entityPath,a.localPath),f=new NL.transport.REST({url:e._currentController.getValue("/private/webPage/tmpRestUrl")+"/"+d,method:"POST"});f.start({onSuccess:c||function(){}},b)})},beforeAction:function(b){var c=e._currentController.getCurrentPatch(a.entityPath);e._syncTmpEntity(c,b)},onFilterEdit:function(a,b){var c=e._buildAction({type:"openWebPage",name:"filter:"+a.name,metadataSource:f.getCompatibleResource(),dialogTitle:a.dialogTitle,dialogMode:"maximize",onOpen:function(b){b.setValueNotDirty("/tmp/filters",void 0),a.currentCtx&&(b.parseXML(a.currentCtx,"/tmp/filters"),b.setDefaultValuesNotDirty("/tmp/filters"))}});c(e._currentController,null,function(){var a=e._currentController.serializeXML("/tmp/filters","ctx");b(a)})},locale:a.locale,timezone:a.timezone,metaDataService:this._metadataService}),f._oldResourceURL=i?i.replace(/\/$/,""):i,a.widget=f},_buildDCE:function(a,b,c,d){var e=this,f=$("<div></div>");a._$block.append(f);var g=SO.Utils.extend(a.params,{locale:a.locale,timezone:a.timezone,configManager:a.configManager}),h=e._currentController;g.content=this._currentController.getValue(a.jpath),g.readOnly=d.readOnly,g.beforeUpload=function(a){e._switchToTemporary(e._options.structure.resource,e._options.structure.rootPath,function(b){b&&a&&a()})},g.onTouched=function(){var b=h.isInWorkingSpace(a.jpath);b||h.isDirty()||h.setDirty(!0)},g.onInternalChange=function(b){h.setValue(a.jpath,b,!0)},g.onExternalChange=function(){},g.getUploadData=function(){return{resource:e._getResourceURL(a),schema:a.uploadSchema}};var i,j=[],k=0,l=!1;if(a.params.onContentLoaded)for(l=a.params.onContentLoaded.cancellable,a.params.onContentLoaded.enabledIfExpr&&(i=a.params.onContentLoaded.enabledIfExpr),k=0;a.params.onContentLoaded.actions.length>k;k++)j.push(e._buildAction(a.params.onContentLoaded.actions[k],b,c));g.onContentLoaded=j.length?function(){var a=!0;if(i&&(a=NL.WebComponent.evaluateExpression(e._currentController,i,b)),a)if(l){var c=e._options.structure.resource,d=e._options.structure.rootPath;e._switchToTemporary(c,d,function(a){a&&(e._currentController.setDirty(!0),e._sequentialCaller(e._currentController,null,j,0,null))})}else e._sequentialCaller(e._currentController,null,j,0,null)}:function(){},g.propertiesContainer=this._getPlaceholder(a.sideBarContainerId),g.globalCommandsContainer=this._getPlaceholder(a.firstCommandsId),g.visualCommandsContainer=this._getPlaceholder(a.secondCommandsId),g.hasPreviousAction=this._computeDynamicAttribute(g,"hasPreviousAction"),g.hasNextAction=this._computeDynamicAttribute(g,"hasNextAction");
var m=new NL.MetaDataService(this._metadataService,{dataSourceType:"metadata"});g.target&&(g.target.metaDataService=m,g.target.uncollapsedNodePathExpr&&(g.target.uncollapsedNodePath=this._bindExpression(g.target,"uncollapsedNodePathExpr"),delete g.target.uncollapsedNodePathExpr),g.target.resourceExpr&&(g.target.resource=this._bindExpression(g.target,"resourceExpr"),delete g.target.resourceExpr)),h.registerObserver("blocks",{onBlockNotify:function(a,c,d){if(c===b)switch(a){case"readOnly":f.nlDCE("setReadOnly",d)}}}),h.registerJpathObserver(a.jpath,{onJpathNotify:function(b,c,d){a.jpath===c&&"value"===b&&f.nlDCE("setValue",d)}}),f.nlDCE(g)},_updateWorkflow:function(a){a.widget.refresh()},_buildWorkflow:function(a,b,c,d){var e=this,f=a.jpath,g="/activities/activity";e._currentController._metamodel._getItem(f+g,!0).removeMethod=function(b,c,d){e._switchToTemporary(e._options.structure.resource,e._options.structure.rootPath,function(c){if(!b.PKey)return SO.isFunction(d)&&d(!1),void 0;if(!c)return SO.isFunction(d)&&(d(!0),a.widget.refresh()),void 0;var h=new NL.transport.REST({url:e._currentController.getValue("/private/webPage/tmpRestUrl")+g+"/"+b.PKey,method:"DELETE"}),i={onSuccess:function(){SO.isFunction(d)&&d(!1)},onError:function(b){new SO.Widgets.MessageBox($("<div></div>"),{type:"error",message:b.message,details:b.details!=b.message?b.details:null}),SO.isFunction(d)&&(d(!0),a.widget.refresh())}};h.start(i,{PKey:e._currentController.getValue(f+g+"/PKey")})})};var h=$("<div></div>");a._$block.append(h),a.widget=new SO.Widgets.Workflow(h,{locale:a.locale,timezone:a.timezone,paletteContainer:this._getPlaceholder(a.paletteContainerId),paletteConf:SO.Widgets.Workflow.paletteConf,executionContainer:this._getPlaceholder(a.executionContainerId),actionsContainer:this._getPlaceholder(a.actionsContainerId),advancedContainer:this._getPlaceholder(a.advancedContainerId),jpath:f,selectionPath:a.selectionPath,forceReadOnlyPath:a.forceReadOnlyPath,controller:this._currentController,mainSetPath:a.mainSetPath,readonly:d.readOnly,resourceType:"/head/resourceType/",onDroppedActivity:function(a,b,c){e._switchToTemporary(e._options.structure.resource,e._options.structure.rootPath,function(d){if(d){e._currentController.setValueCollectNoChange(a,b);var f=e._currentController.getValue("/private/webPage/tmpRestUrl")+"/activities/activity",g=new NL.transport.REST({url:f,method:"POST"}),h={onSuccess:function(a){a.metadata=b.metadata,e._currentController.setValueNotDirty(e._options.structure.rootPath+"/activities/activity/"+b.name,a),c&&c(a)}};g.start(h,b)}})},onDisplayActivity:function(a,b){if(e.isReadOnly()||b)a(e);else{var c=e._currentController.getCurrentPatch(f);e._syncTmpEntity(c,function(){e._currentController.setDirty(!0),e._switchToTemporary(e._options.structure.resource,f,function(b){b&&a(e)})})}},onDeleteActivity:function(a,b){var c=!0;if("delivery"===a.metadata){var d=null;if(a.delivery&&(d=a.delivery),a.deliveryTemplate&&(d=a.deliveryTemplate),d instanceof SO.Selection&&(d=d.getItem(),d&&d.PKey)){c=!1;var g=e._currentController.getValue(f+"/PKey"),h=f.split("/");h[h.length-1]=g;var i="/rest"+h.join("/")+"/deliveries/",j=new NL.transport.REST({url:i+d.PKey,method:"GET",loaderOff:!0}),k={onSuccess:function(a){var c=new NL.transport.REST({url:i+a.PKey,method:"DELETE",loaderOff:!0}),d={onSuccess:function(){b&&b(!0)},onFailure:function(){b&&b(!1)}};c.start(d)},onFailure:function(){b&&b(!1)}};j.start(k)}}c&&b&&b(!0)},onDisplayTransition:function(a,b,c){var d={type:"openWebPage",name:"workflow/transition",metadataSource:"workflow",metadataPrefix:"activities/activity/subMetadata/"+a.metadata+"/"+b,listItem:!1,hasRemove:!0,hasDuplicate:!0,dataPrefix:"activities/activity/"+a.name+"/"+b,dataSource:f,jpath:f+"/activities/activity/"+a.name+"/"+b,newController:!1,fetchData:!1,params:[]},g=e._buildAction(d);if(e.isReadOnly()||c)g();else{var h=e._currentController.getCurrentPatch(f);e._syncTmpEntity(h,function(){e._currentController.setDirty(!0),e._switchToTemporary(e._options.structure.resource,f,function(a){a&&g()})})}}})},_syncTmpEntity:function webPage_syncTmpEntity(a,b){if(this._isTemporaryEntity()){NL.WebComponent.finalizePatch(this._currentController,a,this._options.structure.rootPath);var c=this._currentController.getValue("/private/webPage/tmpRestUrl");SO.assert(c,"Missing  URL of the temporary entity");var d=new NL.Transport.REST({url:c,method:"PATCH"}),e={onSuccess:function(){SO.isFunction(b)&&b()}};d.start(e,a)}else SO.isFunction(b)&&b()},_updateRecipientLink:function(a){var b=this,c=b._currentController.getValue(a.targetResourcePath);if(c){for(var d,e=b._currentController.getEnumValues(a.targetResourcePath),f=0;e.length>f;f++)if(e[f].name===c){d=e[f].label;break}var g={name:"",resTarget:c,label:d};this._currentController.setValue(a.privateStoragePath,[g]);var h=new NL.DataSource.MetaDataService({url:"/head/resourceType/"+c,metaDataService:this._metadataService});h.get(null,null,{onSuccess:function(c){for(var d=b._currentController.getValue(a.jpath),e=!1,f=[g],h=0;c.length>h;h++)f.push({name:c[h].apiName,resTarget:c[h].resTarget,label:c[h].label}),c[h].apiName===d&&(e=!0);b._currentController.setValue(a.privateStoragePath,f,!0),e||(d=""),b._currentController.setValue(a.jpath,d)},onError:function(){},onComplete:function(){}},null,!0,[{wildcard:"$link"}])}},_buildRecipientLink:function(a,b,c,d){var e=this;this._bindPath(a,a.targetResourcePath,function(b){void 0!==b&&e._updateRecipientLink(a)}),e._updateRecipientLink(a),this._buildDropDown(a,b,c,d)},_buildMainSet:function(a,b,c,d){this._buildDropDown(a,b,c,d)},_getValueOfValue:function _getValueOfValue(a){var b="",c="";if("expr"in a?(b=NL.WebComponent.evaluateExpression(this._currentController,a.expr,a.parentPath,a.itemIndex),a.exprType&&(c=a.exprType)):"const"in a&&(a.exprType&&(c=a.exprType),b=a.const),a.displayFormat)b=SO.Format.formatValue(b,a.displayFormat,{locale:a.locale.getName(),timezone:a.timezone.getName()}),SO.isNundef(b)&&(b=xtk_core.notDefined());else if(SO.isNundef(b))b=xtk_core.notDefined();else switch(c){case"datetime":b=SO.DateTime.format(b,{locale:a.locale.getName(),timezone:a.timezone.getName()}),SO.isNundef(b)&&(b=xtk_core.notDefined());break;case"dateonly":b=SO.DateOnly.format(b,{locale:a.locale.getName(),timezone:a.timezone.getName()}),SO.isNundef(b)&&(b=xtk_core.notDefined())}return b},_buildValue:function pageBuildValue(a){var b,c=this;if(a.path)b=ViewControllerManager.newViewController(c._currentController,a.path,{},{editType:"value",displayFormat:a.displayFormat,style:a.style,locale:a.locale,timezone:a.timezone,icon:a.icon}),b.initialize({locale:a.locale,timezone:a.timezone,configManager:a.configManager}),a.widget=b.widget(),a._$block.append(a.widget);else{var d=$("<div />"),e=c._getValueOfValue(a);a.widget=new SO.Widgets.TextFormat(d,{locale:c._locale,timezone:c._timezone,value:e,params:{icon:a.icon,style:a.style}}),c._computeDynamicAttribute(a,"",function(){var b=c._getValueOfValue(a);a.widget.setValue(b)}),a._$block.append(a.widget.$el)}},_buildProgress:function(a){var b=a.jpath,c=ViewControllerManager.newViewController(this._currentController,b,{}),d=this,e=this._currentController.getParams(b).source;this._currentController.registerJpathObserver(e,{onJpathNotify:function(a,b,f,g){var h=new SO.Structure.Jpath(e);if(b!==e&&!h.startWith(b))return c.setValue(0),void 0;if(void 0!==c&&g._sourceObserver!==c)switch(a){case"value":SO.isFloat(d._currentController.getValue(e))&&c.setValue(d._currentController.getValue(e));break;default:throw"Unknown type in method onJpathNotify: "+a}}}),a._$block.html(c.widget()),c.initialize({locale:a.locale,timezone:a.timezone,configManager:a.configManager})},_prepareInput:function pagePrepareInput(a,b,c,d){var e=this,f=a.jpath;if(a.onValueChange){for(var g=[],h=0;a.onValueChange.length>h;h++)g.push(this._buildAction(a.onValueChange[h],b,c));this._bindPath(a,f,function(){e._sequentialCaller(e._currentController,null,g,0)})}a.labelPosition||"left";var i=this._currentController.getLabel(f);void 0!==a.label&&(i=a.label);var j=new NL.InputWrapper(f,{controller:this._currentController,readOnly:d.readOnly,disabled:a.disabled||d.disabled,mandatory:a.mandatory,icon:a.icon,format:a.style,inputParams:a.inputParams||{},context:{timezone:a.timezone,locale:a.locale,configManager:a.configManager}});a._form=j;var k=j.getInputBlock();return a.cell.verticalExpand&&k.addClass("full-height"),{$value:k,label:i}},_buildDropDown:function pageBuildDropDown(a,b,c,d){this._buildInput(a,b,c,d)},_buildInput:function pageBuildInput(a,b,c,d){var e=this._prepareInput(a,b,c,d);a._$block.append(e.$value)},_updateInput:function pageUpdateInput(a,b,c,d){var e=a.disabled||d.disabled;a._form.setDisabled(e),a._form.setReadOnly(d.readOnly)},_buildCheckBox:function pageBuildCheckBox(a,b,c,d){this._buildInput(a,b,c,d)},_updateCheckBox:function pageUpdateCheckBox(a,b,c,d){this._updateInput(a,b,c,d)},_buildRadioButton:function pageBuildRadioButton(a,b,c,d){this._buildInput(a,b,c,d)},_updateRadioButton:function pageUpdateRadioButton(a,b,c,d){this._updateInput(a,b,c,d)},_buildCode:function pageBuildCode(a,b,c,d){this._buildInput(a,b,c,d)},_updateCode:function pageUpdateCode(a,b,c,d){this._updateInput(a,b,c,d)},_buildPersonalizedTextPreview:function pageBuildPersonalizedTextPreview(a){var b=this,c=new SO.Widgets.PersonalizedTextPreview({locale:this._locale,timezone:this._timezone,value:this._currentController.getValue(a.jpath)});this._currentController.registerJpathObserver(a.jpath,{onJpathNotify:function(b,d,e){a.jpath===d&&"value"===b&&c.setValue(e)},refresh:function(){var d=b._currentController.getValue(a.jpath);c.setValue(d)}}),a._$block.append(c.$el),a.widget=c},_buildPersonalizedText:function pageBuildPersonalizedText(a,b,c,d){var e=a.inputParams.multiLineOptions;e.target&&(a.inputParams.multiLineOptions.target.metaDataService=new NL.MetaDataService(this._metadataService,{dataSourceType:"metadata"}),e.target.uncollapsedNodePathExpr&&(e.target.uncollapsedNodePath=this._bindExpression(e.target,"uncollapsedNodePathExpr"),delete e.target.uncollapsedNodePathExpr),e.target.resourceExpr&&(e.target.resource=this._bindExpression(e.target,"resourceExpr"),delete e.target.resourceExpr)),e.sideBarContainerId&&(e.propertiesContainer=this._getPlaceholder(e.sideBarContainerId)),e.firstCommandsId&&(e.globalCommandsContainer=this._getPlaceholder(e.firstCommandsId)),e.secondCommandsId&&(e.visualCommandsContainer=this._getPlaceholder(e.secondCommandsId)),this._buildInput(a,b,c,d)},_updatePersonalizedText:function pageUpdatePersonalizedText(a,b,c,d){this._updateInput(a,b,c,d)},_buildTimezone:function pageBuildTimezone(a,b,c,d){this._buildInput(a,b,c,d)},_updateTimezone:function pageUpdateTimezone(a,b,c,d){this._updateInput(a,b,c,d)},_buildTimeSpan:function pageBuildTimeSpan(a,b,c,d){this._buildInput(a,b,c,d)},_updateTimeSpan:function pageUpdateTimeSpan(a,b,c,d){this._updateInput(a,b,c,d)},_buildPager:function _webPage_buildPager(a,b,c){var d=this,e={height:"100%",width:"100%",timezone:a.timezone,locale:a.locale,navigationBar:a.navigationBar,pages:[]};SO.Utils.each(a.pages,function(a,f){f._$layout=$("<div></div>");var g=SO.Utils.extend({},f.layout),h=new SO.Widgets.formLayout(f._$layout,g);f.widget=h,d._processElement(f._$layout,f,b,c),f.cell&&f.cell.verticalExpand&&f._$layout.addClass("nlui-formlayout-expanded"),e.pages.push({id:f.id,content:f._$layout})});var f=$("<div></div>");a._$block.append(f),a.widget=new SO.Widgets.Pager(f,e)},_updatePager:function _webPage_updatePager(a,b,c){for(var d,e=a.pages,f=e.length,g=0;f>g;g++)d=e[g],d._built&&this._processElement(null,d,b,c)},_buildPagerList:function _webPage_buildPagerList(a,b,c){var d=this,e={height:"100%",width:"100%",timezone:a.timezone,locale:a.locale,navigationBar:a.navigationBar,pages:[]};SO.Utils.each(a.pages,function(a,f){f._$layout=$("<div></div>");var g=SO.Utils.extend({},f.layout),h=new SO.Widgets.formLayout(f._$layout,g);f.widget=h,d._processElement(f._$layout,f,b,c),f.cell&&f.cell.verticalExpand&&f._$layout.addClass("nlui-formlayout-expanded"),e.pages.push({id:f.id,content:f._$layout})});var f=$("<div></div>");a._$block.append(f),a.widget=new SO.Widgets.Pager(f,e)},_updatePagerList:function _webPage_updatePagerList(a,b,c){for(var d,e=a.pages,f=e.length,g=0;f>g;g++)d=e[g],d._built&&this._processElement(null,d,b,c)},_registerFilterMappings:function(a,b){var c=this,d={};if(b)for(var e=0;b.length>e;e++){var f=b[e];d[f.name]=!0,this._currentController.registerJpathObserver(a,{onJpathNotify:function(b,c,e){c===a&&"loading"===b&&(d[f.name]=!e)}});var g=this._computeDynamicAttribute(f,"",function(b,e){d[f.name]&&c._currentController.applyFilter(a,e.name,b,!0)});this._currentController.addFilter(a,{wildcard:f.name}),this._currentController.applyFilter(a,f.name,g,!1)}},_setCollectionHeaderBlocks:function(a,b,c,d){var e=a.headerBlocks;if(b.headerBlocks=[],void 0!==e)for(var f=0;e.length>f;f++){var g=e[f];switch(g.type){case"input":this._processElement(null,e[f],c,d),b.headerBlocks.push({contents:e[f]._$block});break;case"combo":var h=new SO.Plugin.FilterCombo({values:g.values,wildcard:g.wildcard,controller:params.controller,jpath:jpath,selected:a.pluginConf[position].values[0].value});b.headerBlocks.push({contents:h.$node})}}},_replaceURLPattern:function _webPage_replaceURLPattern(a,b){var c=b;if(b){var d=b.match(/\${([^}]+)}/gi);d&&(c=b,d.forEach(function(b){var d=b.substring(2,b.length-1);c=c.replace(b,a[d])}))}return c},_computeListConfiguration:function _computeListConfiguration(a,b,c,d,e,f){var g=this,h={jpath:b,confId:a.confId,displayColumnsHeader:a.displayColumnsHeader,title:a.title,search:!1,refreshOnAdd:a.refreshOnAdd,defaultRendering:a.rendering.defaultRendering,selectable:a.selectable,selectionMode:a.selectionMode,selection:f,actions:a.actions,metaDataUrl:a.metadataURL,readOnly:e.readOnly,selectAndNavigate:a.selectAndNavigate};h.renderingMethods={};var i=0;return SO.Utils.each(a.rendering.renderingMethods,function(c,d){var e={family:d.family,label:d.label,icon:d.icon};if(d.functionName){var f=g._checkMethodAvailable(d.functionName);if(f.method){i++;var j=d.mapping;e.renderer=g._generateItemRenderer(a.detailURLPattern,a.metadataTypeUrlPattern,g._currentController,j,b,f)}}"columns"in d&&(e.columns=[],d.columns.forEach(function(c){var d=!0;"visibleIfExpr"in c&&(d=NL.WebComponent.evaluateExpression(g._currentController,c.visibleIfExpr),g._bindExpression(c,"visibleIfExpr",function(b){b?a.widget.showColumn(c.name,!0):a.widget.hideColumn(c.name,!0)}));var f={name:c.name,label:c.label,width:c.width,editable:c.editable,visible:d};switch(c.editType){case"pathedit":case"expredit":var h=new NL.MetaDataService(g._metadataService,{dataSourceType:"metadata"}),i={targetResource:"/head/resourceType/"+g._currentController.getValue(c.editAttributes.targetResourcePath),metaDataService:h,filters:"all"!==c.editAttributes.filter?[c.editAttributes.filter]:[],editType:c.editType,displayBuilder:c.editAttributes.exprBuilder,builderMode:"query",help:xtk_core.exprEdit_builderHelp()};c.editAttributes.dialogTitle&&(i.dialogTitle=c.editAttributes.dialogTitle),g._currentController.registerJpathObserver(c.editAttributes.targetResourcePath,{onJpathNotify:function(a){"value"==a&&(i.targetResource="/head/resourceType/"+g._currentController.getValue(c.editAttributes.targetResourcePath),g._currentController.setParamSubtree(b+"/"+c.relativePath,"/",i))}}),g._currentController.setParamSubtree(b+"/"+c.relativePath,"/",i)}if(e.columns.push(f),c.componentStructure){var j=g._checkMethodAvailable(c.componentStructure.function);if(j.method){var k=a.detailURLPattern;c.detailURLPattern&&(k=c.detailURLPattern);var l=c.componentStructure.mapping,m=g._generateItemRenderer(k,a.metadataTypeUrlPattern,g._currentController,l,b,j);f.renderer=function(a,b){if(c.relativePath){var d=new SO.MVC.Model(a);if(a=d.getValue(c.relativePath),a instanceof SO.Selection)if(a.isMono())a=a.getItem();else{var e=a.getItems();a=e[0]}if(!a)return""}return m(a,b)}}}})),h.renderingMethods[c]=e}),void 0!==a.lineCount&&(h.pagination={perPage:a.lineCount}),this._setCollectionHeaderBlocks(a,h,c,d),this._registerFilterMappings(b,a.conditionMappings),this._registerListSort(b,a.orderBy),this._computeListActions(a,b,c,d,h),h},_computeListActions:function _computeListActions(a,b,c,d,e){var f=this;if(a.crudConfig)for(var g in a.crudConfig)a.crudConfig.hasOwnProperty(g)&&SO.isObject(a.crudConfig[g])&&a.crudConfig[g].actions&&SO.Utils.each(a.crudConfig[g].actions,function(g,h){var i=f._prepareCommand(h,c,d);"add"===g?f._currentController._metamodel._getItem(b,!0).addMethod=function(a,b,c){i.config.command.call(i.config,f._currentController,{item:a,position:b},function(){var a=f._currentController.getValue(f._newEntityStoragePath);a&&a.PKey?c(a,!1):c(null,!0)})}:"remove"===g?f._currentController._metamodel._getItem(b,!0).removeMethod=function(a,b,c){i.config.command.call(i.config,f._currentController,{item:a,position:b},function(){c()})}:"duplicate"===g?f._currentController._metamodel._getItem(b,!0).duplicateMethod=function(b,c,d,e){i.config.command.call(i.config,f._currentController,{item:c,position:d,detailURLPattern:a.detailURLPattern,metadataTypeUrlPattern:a.metadataTypeUrlPattern},function(){var a=f._currentController.getValue(f._duplicatedEntityStoragePath);e(a,!1)})}:"zoom"===g&&(e.onZoom=function(a,b){var c=f._options.structure.resource.split("/");c.length=4;var d=c.join("/");f._switchToTemporary(d,f._options.structure.rootPath,function(c){c&&i.config.command.call(f,f._currentController,{selection:a,position:b})})})});if(e.actions&&e.actions.search&&e.actions.search.enable&&e.actions.search.placeholderId){var h=this._getPlaceholder(e.actions.search.placeholderId);e.actions.search.placeholder=$("<div></div>").appendTo(h)}if(e.actions&&e.actions.creation&&e.actions.creation.placeholderId){var i=this._getPlaceholder(e.actions.creation.placeholderId);e.actions.creation.placeholder=$("<div></div>").appendTo(i)}if(e.actions&&e.actions.selection&&e.actions.selection.placeholderId){var j=this._getPlaceholder(e.actions.selection.placeholderId);e.actions.selection.placeholder=$("<div></div>").appendTo(j)}if(e.actions&&e.actions.global&&e.actions.global.placeholderId){var k=this._getPlaceholder(e.actions.global.placeholderId);e.actions.global.placeholder=$("<div></div>").appendTo(k)}return e},_prepareListActionBar:function _prepareListActionBar(a,b,c){var d,e,f,g,h=!1;return b.actions&&SO.Utils.each(b.actions,function(a,b){return SO.Utils.each(b,function(a,b){return b===!0?(h=!0,!1):void 0}),h?!1:!0}),h?(d=new SO.Widgets.GrayBar($('<nav class="nlui-list-header"></nav>')),b.actions&&b.actions.creation&&(e=$("<div></div>"),d.addActionBarContent("globalActions",e),b.actions.creation.placeholder=e),b.actions&&b.actions.selection&&(f=$("<div></div>"),d.addActionBarContent("localActions",f),b.actions.selection.placeholder=f),b.actions&&b.actions.global&&(g=$("<div></div>"),d.addActionBarContent("viewConfig",g),b.actions.global.placeholder=g,b.actions.global.placeholder=g),c.prepend(d.$el),this):this},_buildList:function _buildList(a,b,c,d){var e=this,f=a.jpath,g=null;a.selectionPath&&(g=this._currentController.getValue(a.selectionPath));var h,i=this._computeListConfiguration(a,f,b,c,d,g);a.cell&&a.cell.verticalExpand&&(i.fitToParentHeight=!0);var j=$("<div></div>");a._$block.append(j),i.locale=a.locale,i.timezone=a.timezone,i.metaDataService=this._metadataService,a.selectionPath&&(i.onSelection=function(b){e._currentController.setValue(a.selectionPath,b,!0)},e._currentController.registerJpathObserver(a.selectionPath,{onJpathNotify:function(b,c,d){"value"===b&&a.widget.setValue(d)}})),i.controller=this._currentController,i.configManager=this._configManager,a.internalActionBar&&this._prepareListActionBar(a,i,j),a.perPage&&(i.pagination={perPage:a.perPage}),h=new SO.Widgets.List(j,i),this._currentController.registerObserver("blocks",{onBlockNotify:function(a,c,d){if(c===b)switch(a){case"readOnly":h.setReadOnly(d)}}}),a.widget=h},_registerListSort:function(a,b){for(var c=this,d=0;b.length>d;d++)c._currentController.addSort(a,{id:SO.String.toIdentifier(b[d].path),expr:b[d].path,desc:b[d].sortDesc})},_buildReportTable:function _buildReportTable(a){var b=this._currentController,c={jpath:a.jpath,controller:b,rowDefinition:a.rowDefinition};a.widget=new SO.Widgets.ReportTable(a._$block,c)},_generateItemRenderer:function _webPage_generateItemRenderer(a,b,c,d,e,f){var g=this;return function(h,i,j){var k;k=h.metadata&&b&&b[h.metadata]?b[h.metadata]:a;var l=NL.WebComponent.applyMapping(h,d.params,i,c,e);if(k){var m=g._replaceURLPattern(h,k);l.href=m}return f.owner[f.method](l,i,j)}},_buildTimeline:function(a){var b=this._currentController,c=this,d={jpath:a.jpath,controller:b,minDate:a.minDate,maxDate:a.maxDate,displayStartDate:a.displayStartDate,displayEndDate:a.displayEndDate,locale:a.locale,timezone:a.timezone};if(this._registerFilterMappings(a.jpath,a.conditionMappings),a.rendering.item){var e=this._checkMethodAvailable(a.rendering.item.function);if(e.method){var f=a.rendering.item.mapping;d.objectRendering=c._generateItemRenderer(a.detailURLPattern,a.metadataTypeUrlPattern,b,f,a.jpath,e)}}if(SO.assert(void 0!==d.objectRendering,"Missing component of 'javascript' type to render timeline item"),a.rendering.popover){var g=this._checkMethodAvailable(a.rendering.popover.function);if(g.method){var h=a.rendering.popover.mapping;d.popoverRendering=c._generateItemRenderer(a.detailURLPattern,a.metadataTypeUrlPattern,b,h,a.jpath,g)}}SO.assert(void 0!==d.popoverRendering,"Missing component of 'list' type to render timeline item popover");var i=this._getPlaceholder(a.zoomContainerId);d.zoomIconContainer=i;var j=$("<div></div>");a._$block.append(j),a.widget=new SO.Widgets.Timeline(j,d)},_buildStandardDialog:function _buildStandardDialog(a,b,c,d,e){var f=this;if(this._dialogStack.length>0){for(var g=null,h=0;this._dialogStack.length>h;h++)if(this._dialogStack[h].structure.id===a.id){g=this._dialogStack[h].structure;break}if(g)return this._processExpressions(g,b),this._updateDialog(g,b,c),void 0}var i=a.id;SO.assert(void 0!==i,"Ids must be defined on dialog blocks");var j=a.vAlign,k=$('<div style="'+(j?"":"width: 100%; height: 100%")+'"></div>'),l=this._computeDynamicAttribute(a,"title",function(b){a.widget.setTitle(b)});a._$content=$('<div style="height: 100%; width: 100%;"></div>');var m={container:k,structure:a,instanceChildren:[]};this._dialogStack.push(m),l&&this.isReadOnly()&&"openWebPage"!==a.type&&(l=xtk_webPage.readOnly(l));var n={title:l,content:a._$content,modal:!0,destroyOnClose:!0,removeOnClose:!0,resizable:!1,mode:"maximize",width:a.width,height:a.height,configManager:this._configManager,open:function(c,d){a.noButtons||"transparent"===a.mode||(d.setCommandAttribute(null,"validate","hidden",!0),d.setCommandAttribute(null,"cancel","hidden",!0),"fullPage"!==a.mode&&"maximize"!==a.mode?d.setCommandAttribute(null,"submit","hidden",!1):d.toggleCloseButton(!0)),SO.Utils.each(s.visibleConfigs,function(a,b){b.visibleIfExpr&&f._bindExpression(b,"visibleIfExpr",function(a){d.setCommandAttribute(null,b.name,"hidden",!a)})}),SO.Utils.each(s.enabledConfigs,function(a,b){b.enabledIfExpr&&f._bindExpression(b,"enabledIfExpr",function(a){d.setCommandAttribute(null,b.name,"disabled",!a)}),b.disableOnDirty&&f._currentController.registerOnDirtyChanged(function(a){d.setCommandAttribute(null,b.name,"disabled",a)})}),f._currentController.registerOnDirtyChanged(function(b){a.noButtons||"transparent"===a.mode||(d.setCommandAttribute(null,"validate","hidden",!b),d.setCommandAttribute(null,"cancel","hidden",!b),"fullPage"!==a.mode&&"maximize"!==a.mode?d.setCommandAttribute(null,"submit","hidden",b):d.toggleCloseButton(!b))}),f._currentController.registerObserver("blocks",{onBlockNotify:function(a,b){f._fullRefresh(b)}},null);for(var g=0;a.children.length>g;g++){var h=SO.Utils.extend(!0,{},a.children[g]);m.instanceChildren.push(h);var i=h.type;"dialogBar"!==i&&(h._$block=null,h._built=!1,h._expressionBuilt=!1,"perl"===h.type&&(a.isListItem&&(h.rootPath=a.parentPath+"["+a.itemIndex+"]",h.itemIndex=a.itemIndex),h.$headerLeftZone=d.getHeaderLeft(),h.$headerCenterZone=d.getHeaderContent(),h.$headerRightZone=d.getHeaderRight(),h.cancelParentDialog=function(){d.cancel()},h.closeParentDialog=function(){d.close()}),f._processElement(a._$content,h,b,""))}d.updateSize(),SO.isFunction(e.open)&&e.open(c,d)},close:function(a,b,c){f._closeDialog(a,b,c),SO.isFunction(e.close)&&e.close(a,b,c)},vAlign:j,locale:a.locale,timezone:a.timezone};a.mode?n.mode=a.mode:"openDialog"!==a.type||a.mode||(a.mode=n.mode="fullPage"),void 0!==a.padding&&(n.padding=a.padding),"maximize"===n.mode&&(n.padding=!1,n.closeButton=!0);for(var o,h=0;a.children.length>h;h++){var p=a.children[h],q=p.type;"dialogBar"===q&&(o=SO.Utils.extend(!0,{},p),SO.Utils.each(o.children,function(a,b){b.children.push({type:"defaultCloseDialog"})}))}o||(o={children:[]});var r=xtk_webPage.validate();a.newController&&(r=xtk_webPage.save()),a.noButtons||"transparent"===a.mode||(o.children.unshift({label:r,name:"validate",mode:"auto"!==a.mode?"transparent":"default",icon:"auto"!==a.mode?"coral-checkCircle":"",children:[{type:"defaultCloseDialog"}]}),o.children.unshift({label:xtk_webPage.cancel(),name:"cancel",icon:"auto"!==a.mode?"coral-closeCircle":"",mode:"auto"!==a.mode?"quiet":"default",children:[{type:"defaultCancelDialog"}]})),a.noButtons||"fullPage"===a.mode||"transparent"===a.mode||"maximize"===a.mode||o.children.unshift({label:xtk_webPage.cancel(),name:"submit",icon:"auto"!==a.mode?"coral-closeCircle":"",mode:"auto"!==a.mode?"quiet":"default",children:[{type:"defaultCancelDialog"}]});var s=this._prepareCommandBar(o,b,c);n.commandBarConfig={commands:s.commands,commandConfigs:s.configs},SO.assert(!d.open&&!d.close,'Callbacks must be defined in the "callbacks" parameter'),a.widget=new SO.Widgets.Dialog(k,SO.Utils.extend(!0,{},n,d)),m.widget=a.widget},_buildDialog:function(a,b,c,d){var e=this;this._currentController=this._currentController.buildSubController({propagateInputChanges:a.propagateInputChanges});var f=[];if(void 0!==a.initActions)for(var g=0;a.initActions.length>g;g++)f.push(this._buildAction(a.initActions[g]));this._sequentialCaller(this._currentController,null,f,0,function(){e._buildStandardDialog(a,b,c,{},{close:function(b,c,f){var g="cancel"!==f;e._currentController=e._currentController.getParent();var h=function(){g?(e._currentController.commitSubController(),d&&d()):e._currentController.rollbackSubController()};if(void 0!==a.leaveActions){for(var i=[],j=0;a.leaveActions.length>j;j++)i.push(e._buildAction(a.leaveActions[j]));h.displayName="leaveActionsDoneCallback",e._sequentialCaller(e._currentController,null,i,0,h)}else h()}})})},_buildCRUD:function _webPage_buildCRUD(a,b,c){a.creationActions&&(a.creationActions._$block=this._getPlaceholder(a.creationActions.placeholderId),this._buildCommandBar(a.creationActions,b,c)),a.selectionActions&&(a.selectionActions._$block=this._getPlaceholder(a.selectionActions.placeholderId),this._buildCommandBar(a.selectionActions,b,c))},_updateCRUD:function _webPage_updateCRUD(a,b,c){a.creationActions&&this._updateCommandBar(a.creationActions,b,c),a.selectionActions&&this._updateCommandBar(a.selectionActions,b,c)},_buildCreation:function _webPage_buildCreation(a,b,c){for(var d=0;a.children.length>d;d++)this._processElement(a._parentElement,a.children[d],b,c)},_updateCreation:function _webPage_updateCreation(a,b,c){for(var d=0;a.children.length>d;d++)this._processElement(null,a.children[d],b,c)},_buildReportList:function _webPage_buildReportList(a,b,c){var d=this._getPlaceholder(a.placeholderId);a._$block=d,this._processElement(a._$block,a,b,c)},_buildDetail:function _webPage_buildDetail(a,b,c){for(var d=0;a.children.length>d;d++)this._processElement(a._parentElement,a.children[d],b,c)},_updateDetail:function _webPage_updateDetail(a,b,c){for(var d=0;a.children.length>d;d++)this._processElement(null,a.children[d],b,c)},_buildActionBarContent:function _webPage_buildActionBarContent(a,b,c,d){a.layout={layout:"stackLeft"},this._buildContainer(a,b,c,d)},_updateActionBarContent:function(a,b,c,d){this._updateContainer(a,b,c,d)},_buildContainer:function _webPage_buildContainer(a,b,c){a._$layout=$("<div></div>");var d=SO.Utils.extend({},a.layout),e=new SO.Widgets.formLayout(a._$layout,d);a._$block.append(a._$layout);var f=a.width;""!==f&&a._$block.css({width:f});for(var g=0;a.children.length>g;g++){var h=a.children[g];a.isListItem&&(h.isListItem=a.isListItem,h.itemIndex=a.itemIndex,h.parentPath=a.parentPath),this._processElement(e,h,b,c)}},_buildCanvas:function(a,b,c,d){this._buildContainer(a,b,c,d),a.verticalExpand&&a._$layout.addClass("nlui-formlayout-expanded")},_updateContainer:function _webPage_updateContainer(a,b,c){for(var d=a.children,e=0;d.length>e;e++){var f=d[e];this._processElement(null,f,b,c)}},_buildTile:function _webPage_buildTile(a,b,c){var d,e,f,g=this,h=this._computeDynamicAttribute(a,"url",function(b){var c=g._addSecurityTokenToUrl(b);a.widget.setNavigationURL(c)});f={width:a.width||void 0,height:a.height||void 0,mode:a.action||void 0,navigationURL:h?this._addSecurityTokenToUrl(h):null,dialogMode:a.dialogMode,clickArea:a.clickArea,fullWidth:a.fullWidth,fullHeight:a.fullHeight,footer:{icon:a.footerIcon},locale:a.locale,timezone:a.timezone};var d=a.front,i=function(a){i._$block=a,g._processElement(a,d,b,c)},j=this._computeDynamicAttribute(d.header,"title",function(b){a.widget.setTitle("front",b)});f.front={state:a.state,width:d.width||void 0,height:d.height||void 0,vAlign:d.vCenter,hAlign:d.hCenter,padding:d.padding,content:i,header:d.header?{title:j,icon:d.header.icon}:null,footer:d.footer?{icon:d.footer.icon}:null};var e=a.back;if(e.children.length>0){var k=function(a){e._$block=a,g._buildDialog(e,b,c)};f.back={content:k}}else f.footer=!1;var l=$("<div></div>");a._$block.append(l),a.widget=new SO.Widgets.Tile(l,f)},_addSecurityTokenToUrl:function(a){var b=new RegExp("http(s)?://","i"),c=b.test(a);return a=new SO.Structure.URL(a),c||a.query({__securitytoken:NL.session.__securitytoken}),a.toString()},_updateTile:function _webPage_updateTile(a,b,c){var d=a.front;a.back,this._processElement(null,d,b,c)},_buildURLViewer:function _webPage_buildURLViewer(a){var b,c,d={};if(a.url||a.urlExpr)b=this._computeDynamicAttribute(a,"url",function(b){b?(a.authenticated&&(d.__securitytoken=NL.session.__securitytoken,a._$block.nlURLViewer("option","params",d)),a._$block.nlURLViewer("option","baseURL",b),a._$block.nlURLViewer("load")):a._$block.nlURLViewer("unload")});else{c=a.path;var e=this;this._bindPath(a,a.path,function(){var b=e._currentController.getValue(c);a._$block.nlURLViewer("load",b)})}for(var f=function f(b,c){d[c.name]=b,a._$block.nlURLViewer("option","params",d),a._$block.nlURLViewer("load")},g=0;a.params.length>g;g++){var h=a.params[g],i=this._computeDynamicAttribute(h,"",f);d[h.name]=i}c||b||(b="about:blank"),(c||"about:blank"!==b)&&a.authenticated&&(d.__securitytoken=NL.session.__securitytoken);var j={params:d};c?j.directContent=this._currentController.getValue(c):j.baseURL=b,a._$block.nlURLViewer(j)},_buildPearl:function _webPage_buildPearl(a){var b={navigationRail:!1,footer:!1,blackBar:!1,locale:a.locale,timezone:a.timezone},c={canSave:a.canSave,rootPath:a.rootPath,container:a._$block,controller:this._currentController,structure:a,shellConfig:b,$headerLeftZone:a.$headerLeftZone,$headerCenterZone:a.$headerCenterZone,$headerRightZone:a.$headerRightZone,cancelParentDialog:a.cancelParentDialog,closeParentDialog:a.closeParentDialog,configManager:this._configManager,metadataService:a.metadataService||this._metadataService,locale:this._locale,timezone:this._timezone,privateStoragePath:this._options.structure.privateStoragePath};a.isListItem&&(c.itemIndex=a.itemIndex),a.newPage||(c.containers=this._containers,this._options.structure.readOnlyIf&&(c.structure.readOnlyIf=this._options.structure.readOnlyIf)),new SO.Widgets.WebPage(c)},_processExpressions:function(a,b){var c=this;
if(a.visibleIfExpr){var d=!NL.WebComponent.evaluateExpression(this._currentController,a.visibleIfExpr,a.parentPath,a.itemIndex);this._currentController.setHidden(b,d,!0)}if(a.enabledIfExpr){var e=!NL.WebComponent.evaluateExpression(this._currentController,a.enabledIfExpr,a.parentPath,a.itemIndex);this._currentController.setDisabled(b,e,!0)}if(a.readOnlyIfExpr){var f=NL.WebComponent.evaluateExpression(this._currentController,a.readOnlyIfExpr,a.parentPath,a.itemIndex);this._currentController.setReadOnly(b,f,!0)}if(!a._expressionBuilt){if(a._expressionBuilt=!0,a.visibleIfExpr){var g=c._bindExpression(a,"visibleIfExpr",function(a){c._currentController.setHidden(b,!a,!1)});this._currentController.setHidden(b,!g,!1)}if(a.enabledIfExpr){var h=c._bindExpression(a,"enabledIfExpr",function(a){c._currentController.setDisabled(b,!a,!1)});this._currentController.setDisabled(b,!h,!1)}if(a.readOnlyIfExpr){var f=c._bindExpression(a,"readOnlyIfExpr",function(a){c._currentController.setReadOnly(b,a,!1)});this._currentController.setReadOnly(b,f,!1)}}},_getResourceURL:function _webPage_getResourceURL(a){var b=null;if(a.resourceExpr)b=NL.WebComponent.evaluateExpression(this._currentController,a.resourceExpr,a.parentPath,a.itemIndex);else if(a.pathForResource)b="/rest"+this._getURLFromPath("",a.pathForResource).replace(/\/\//g,"/");else if(a.resource)b=a.resource;else{var c=this._currentController.getDataSource(a.resourcePath);b=c?c.getURL():this._currentController.getValue(a.resourcePath)}return b},_isTemporaryEntity:function _webPage_isTemporaryEntity(){return this._currentController.getValue("/private/webPage/isTemporary")},_setTemporaryEntity:function _webPage_setTemporaryEntity(a){this._currentController.setValue("/private/webPage/isTemporary",a,!0)},_processLazyLoadedCollection:function(a,b,c,d){var e=this,f=["list","tree","link","grid","chart","container","range","int64"],g=function(h){if(e._currentController._metamodel.exists(h)&&f.indexOf(e._currentController.getType(h))>-1){var i=e._currentController._metamodel.getDataSource(h),j=SO.String.removePrefix(h,a),k=b.getValue(j),l=e._currentController.getValue(h);k&&i&&SO.isFunction(i.setURL)?(SO.assert(k.href,'No new resource URL for lazy-loaded collection "'+h+'"'),i.setURL(k.href),b.setValue(j,l||[]),d&&e._currentController.notifyJpathObservers("update",h)):SO.Utils.each(k,function(a){0>c.indexOf(a)&&g(h+"/"+a)})}};g(a)},_switchingToTemporary:!1,_pendingTemporary:[],_processPendingTemporary:function(){var a=this._pendingTemporary.shift();a&&(a(this._isTemporaryEntity()),this._processPendingTemporary())},_resetTemporaryHandling:function(){this._switchingToTemporary=!1,this._setTemporaryEntity(!1),this._pendingTemporary=[]},_switchToTemporary:function _webPage_switchToTemporary(a,b,c){if(this.isReadOnly())return SO.isFunction(c)&&c(!1),void 0;if(this._switchingToTemporary)return this._pendingTemporary.push(c),void 0;if(this._isTemporaryEntity())return SO.isFunction(c)&&c(!0),void 0;this._pendingTemporary.push(c);var d=this;this._switchingToTemporary=!0,this._currentController.setValue("/private/webPage/PKey",this._currentController.getValue(b+"/PKey"));var e=new NL.Transport.REST({url:"/rest"+a+"/tmp",method:"POST"}),f={onSuccess:function(c){d._currentController.setValue("/private/webPage/currentMainResource",c.href),d._currentController.setValue("/private/webPage/originalUrl",a),d._currentController.setValue("/private/webPage/tmpRestUrl",c.href);var e=d._currentController.getCurrentPatch(b,!0);SO.Utils.extend(!0,c,e);var f=d._currentController._metamodel.getAllTypes(b);c=SO.MVC.Model.parseJSON(c,f);var g=new SO.MVC.Model(c);d._processLazyLoadedCollection(b,g,["PKey","href","metadata"]),d._currentController.setValueNotDirty(b,g._model),d._setTemporaryEntity(!0),d._switchingToTemporary=!1,d._processPendingTemporary()},onError:function(a){d._switchingToTemporary=!1,d._setTemporaryEntity(!1),d._processPendingTemporary(),new SO.Widgets.MessageBox($("<div></div>"),{type:"error",message:a.message,details:a.details})}};e.start(f)},onSave:function webPage_onSave(a,b,c,d){var e=this,f=function(a){var f=a.subtrees[0],g=a.controller.getCurrentPatch(f);e._syncTmpEntity(g,function(){var g="/rest"+a.controller.getValue("/private/webPage/originalUrl"),h=new NL.Transport.REST({url:g,method:"PATCH"}),i={onSuccess:function(){if(e._currentController.setValue("/private/webPage/currentMainResource",g),e._currentController.setValue("/private/webPage/tmpRestUrl",null),d)a.success(),SO.isFunction(b)&&b();else{var h=new NL.Transport.REST({url:g,method:"GET"});h.start({onSuccess:function(c){var d=e._currentController.getValue("/private/webPage/PKey"),g=c.PKey;if(d!==g){var h=e._currentController.getValue("/private/webPage/currentMainResource");h=h.replace(d,g),e._currentController.setValue("/private/webPage/currentMainResource",h);var i=e._currentController.getValue("/private/webPage/originalUrl");i=i.replace(d,g),e._currentController.setValue("/private/webPage/originalUrl",i)}var j=a.controller._metamodel.getAllTypes(f);c=SO.MVC.Model.parseJSON(c,j);var k=new SO.MVC.Model(c);e._processLazyLoadedCollection(f,k,["PKey","href","metadata"],!0),a.controller.setValueNotDirty(f,k._model),a.success(),a.controller.startTransaction(),SO.isFunction(b)&&b()},onError:function(b){a.error(b)},onComplete:function(){a.complete(),SO.isFunction(c)&&c()}})}},onError:a.error,onComplete:a.complete};h.start(i,{PKey:a.controller.getValue(f+"/PKey")})})};if(void 0!==this._options.structure.leaveActions){for(var g=[],h=0;this._options.structure.leaveActions.length>h;h++)g.push(this._buildAction(this._options.structure.leaveActions[h]));this._sequentialCaller(this._currentController,null,g,0,function(){f.call(e,a)})}else f.call(e,a);return{}},_processElement:function _webPage_processElement(a,b,c,d){function e(a,b){var c=a._currentController.isReadOnly(g);return!a.isReadOnly()||b.jpath&&-1!==b.jpath.indexOf("/ignored/")||(c=!0),c}var f=b.id,g=c+"/"+f,h=d!==g&&SO.String.startsWith(d,g),i=SO.String.startsWith(g,d);if(h||i){b.isListItem&&b.parentPath&&(b.jpath=b.parentPath+"["+b.itemIndex+"]/",b.relativePath&&(b.jpath+=b.relativePath)),this._processExpressions(b,g);var j={hidden:this._currentController.isHidden(g),readOnly:e(this,b),disabled:this._currentController.isDisabled(g)};if(SO.assert(!!a||!!b._$block&&!!b._$block[0]&&!!b._$block[0].parentElement,"For layout reasons, an element ("+b.type+") should not be processed out of the DOM"),!b._$block)if(a instanceof SO.Widgets.cellLayout)b._parentElement=a,b._$block=a.getContentContainer();else if(a instanceof SO.Widgets.formLayout){var k=this._createCell(b,j),l=a.getOptions();l.labelPosition&&k.set("labelPosition",l.labelPosition),l.labelSize&&k.set("labelSize",l.labelSize),b._$block=k.getContentContainer(),a.appendCell(k),b._parentElement=k}else a instanceof jQuery?(b._parentElement=a,b._$block=a):SO.log.debug("parentElement is unknown at path "+g);var m=b.type;b.locale=SO.LocaleManager.getLocale(b.localeName)||this._locale,b.timezone=SO.TimezoneManager.getTimezone(b.timezoneName)||this._timezone,b.configManager=this._configManager,"tab"!==m&&"notebookTab"!==m&&"actionBar"!==m&&"canvas"!==m&&"rail"!==m&&"railTab"!==m&&(!b._parentElement||b._parentElement instanceof jQuery||b._parentElement.set("hidden",j.hidden)),b._built?j.hidden?"rail"===m?this._buildRail(b,g,d,j):"actionBar"===m&&this._buildActionBar(b,g,d,j):"creation"===m?this._updateCreation(b,g,d,j):"detail"===m?this._updateDetail(b,g,d,j):"rail"===m?this._buildRail(b,g,d,j):"actionBar"===m?this._updateActionBar(b,g,d,j):"actionBarContent"===m?this._updateActionBarContent(b,g,d,j):"railTab"===m||"canvas"===m?this._updateContainer(b,g,d,j):"container"===m||"notebookTab"===m||"tileFront"===m||"tileBack"===m?this._updateContainer(b,g,d,j):"perl"===m||("wizard"===m?this._updateWizard(b,g,d,j):"step"===m?this._updateWizardStep(b,g,d,j):"tile"===m?this._updateTile(b,g,d,j):"notebook"===m?this._updateNotebook(b,g,d,j):"message"===m||"image"===m||("input"===m?this._updateInput(b,g,d,j):"checkBox"===m?this._updateCheckBox(b,g,d,j):"radioButton"===m?this._updateRadioButton(b,g,d,j):"code"===m?this._updateCode(b,g,d,j):"personalizedText"===m?this._updatePersonalizedText(b,g,d,j):"timezone"===m?this._updateTimezone(b,g,d,j):"timeSpan"===m?this._updateTimeSpan(b,g,d,j):"personalizedTextPreview"===m||"text"===m||"itemPicker"===m||"personalizedTextPreview"===m||"text"===m||"pathEdit"===m||"exprEdit"===m||"dropDown"===m||"placeholder"===m||"separator"===m||"value"===m||"list"===m||("commandBar"===m?this._updateCommandBar(b,g,d):"command"===m?this._updateCommand(b,g,d):"kpi"===m||"chart"===m||"title"===m||"reportTable"===m||"status"===m||"component"===m||("openDialog"===m?this._buildDialog(b,g,d):"crud"===m?this._updateCRUD(b,g,d):"workflow"===m?this._updateWorkflow(b,g,d):"recipientLink"===m||"mainSet"===m||("queryEditor"===m?this._updateQueryEditor(b,g,d):"progressBar"===m||"progressCircle"===m||("pager"===m?this._updatePager(b,g,d,j):"pagerList"===m?this._updatePagerList(b,g,d,j):"well"===m?this._updateContainer(b,g,d,j):"section"===m?this._updateContainer(b,g,d,j):SO.log.warn(xtk_webPage.elementOfUnknownType(m)))))))):j.hidden?"rail"===m?this._buildRail(b,g,d,j):"actionBar"===m&&this._buildActionBar(b,g,d,j):("creation"===m?this._buildCreation(b,g,d,j):"detail"===m?this._buildDetail(b,g,d,j):"rail"===m?this._buildRail(b,g,d,j):"actionBar"===m?this._buildActionBar(b,g,d,j):"canvas"===m?this._buildCanvas(b,g,d,j):"railTab"===m?this._buildContainer(b,g,d,j):"actionBarContent"===m?this._buildActionBarContent(b,g,d,j):"container"===m||"notebookTab"===m||"tileFront"===m||"tileBack"===m?this._buildContainer(b,g,d,j):"perl"===m?this._buildPearl(b,g,d,j):"notebook"===m?this._buildNotebook(b,g,d,j):"tile"===m?this._buildTile(b,g,d,j):"separator"===m?this._buildSeparator(b,g,d,j):"message"===m?this._buildMessage(b,g,d,j):"image"===m?this._buildImage(b,g,d,j):"input"===m?this._buildInput(b,g,d,j):"checkBox"===m?this._buildCheckBox(b,g,d,j):"radioButton"===m?this._buildRadioButton(b,g,d,j):"code"===m?this._buildCode(b,g,d,j):"personalizedText"===m?this._buildPersonalizedText(b,g,d,j):"personalizedTextPreview"===m?this._buildPersonalizedTextPreview(b,g,d,j):"timezone"===m?this._buildTimezone(b,g,d,j):"timeSpan"===m?this._buildTimeSpan(b,g,d,j):"itemPicker"===m?this._buildItemPicker(b,g,d,j):"pathEdit"===m?this._buildPathEdit(b,g,d,j):"exprEdit"===m?this._buildExprEdit(b,g,d,j):"dropDown"===m?this._buildDropDown(b,g,d,j):"dce"===m?this._buildDCE(b,g,d,j):"queryEditor"===m?this._buildQueryEditor(b,g,d,j):"workflow"===m?this._buildWorkflow(b,g,d,j):"recipientLink"===m?this._buildRecipientLink(b,g,d,j):"mainSet"===m?this._buildMainSet(b,g,d,j):"value"===m?this._buildValue(b,g,d,j):"list"===m||"collection"===m||"overviewList"===m?this._buildList(b,g,d,j):"timeline"===m?this._buildTimeline(b,g,d,j):"reportTable"===m?this._buildReportTable(b,g,d,j):"commandBar"===m?this._buildCommandBar(b,g,d,j):"viewBar"===m?this._buildViewBar(b,g,d,j):"kpi"===m?this._buildKpi(b,g,d,j):"chart"===m?this._buildChart(b,g,d,j):"title"===m?this._buildTitle(b,g,d,j):"step"===m?this._buildWizardStep(b,g,d,j):"component"===m?this._buildComponent(b,g,d,j):"itemSelector"===m?this._buildItemSelector(b,g,d,j):"urlViewer"===m?this._buildURLViewer(b,g,d,j):"status"===m?this._buildStatus(b,g,d,j):"placeholder"===m?this._buildPlaceholder(b,g,d,j):"openDialog"===m?this._buildDialog(b,g,d):"crud"===m?this._buildCRUD(b,g,d):"progressBar"===m||"progressCircle"===m?this._buildProgress(b,g,d):"pager"===m?this._buildPager(b,g,d,j):"pagerList"===m?this._buildPagerList(b,g,d,j):"text"===m?this._buildText(b,g,d,j):"well"===m?this._buildWell(b,g,d,j):"section"===m?this._buildSection(b,g,d,j):"monoFileDropZone"===m?this._buildMonoFileDropZone(b,g,d,j):SO.log.warn(xtk_webPage.elementOfUnknownType(m)),b._built=!0),$(b._$block).attr("data-component-type",b.type)}},_getFormatClassNames:function webPage_getClassNames(a){var b=[];return a&&SO.Utils.each(a,function(a,c){switch(a){case"bold":c&&b.push("nlui-text-bold");break;case"italic":c&&b.push("nlui-text-italic");break;case"underline":c&&b.push("nlui-text-underline");break;case"uppercase":c&&b.push("nlui-text-uppercase");break;case"link":c&&b.push("nlui-link");break;case"size":case"state":case"mode":case"color":b.push("nlui-text-"+c)}}),b.join(" ")},isReadOnly:function webPage_isReadOnly(){return this._readOnly},setReadOnly:function webPage_setReadOnly(a){this._readOnly=a},getTitle:function webPage_getTitle(){return this._title},setTitle:function webPage_setTitle(a){this._title=a}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Timeline",{DEFAULT_OPTIONS:{controller:null,jpath:null,locale:null,timezone:null,displayStartDate:null,displayEndDate:null,popoverRendering:null,zoomIconContainer:null,emptyText:xtk_core.noData()},_create:function(){this._zoomUnitDisplay={year:{value:366,out:null,"in":"halfyear"},halfyear:{value:180,out:"year","in":"quarter"},quarter:{value:90,out:"halfyear","in":"month"},month:{value:30,out:"quarter","in":null}},this._zoomLevel="year",this._displayStartDate=null,this._displayEndDate=null,this._referenceDate=null,this._displayedInterval=0,this._displayUnit=0,this._initDisplayDatesAndZoom(),this._updateDisplayUnits(),this._jpath=this._options.jpath,this._controller=this._options.controller,this._displayingObjects=[],this._rows=[],this._expandedFoldersStack=[],this._availableDisplayWidth=this.$el.width(),this.$el.addClass("timeline-container"),this._$objectsHeader=null,this._$objectsContainer=null,this._$zoomContainer=null,this._$todayMarker=null,this._$popover=null,this._itemPxShift=10,this._itemMinWidth=150,this._itemMinWidthInDay=this._availableDisplayWidth>0?Math.ceil(366*this._itemMinWidth/this._availableDisplayWidth):0,this._buildMarkup()._refreshTimelineHeader()._fetchData(),this._bindEvents()},_initDisplayDatesAndZoom:function(){var a=SO.DateOnly();if(null===this._options.displayStartDate||null===this._options.displayEndDate)this._zoomLevel="year",this._displayStartDate=this._addIntervalToDate(a,-1*(this._zoomUnitDisplay[this._zoomLevel].value/2)),this._displayEndDate=this._addIntervalToDate(a,this._zoomUnitDisplay[this._zoomLevel].value/2);else{this._displayStartDate=this._options.displayStartDate instanceof SO.DateOnly?this._options.displayStartDate:SO.DateOnly.parse(this._options.displayStartDate),this._displayEndDate=this._options.displayEndDate instanceof SO.DateOnly?this._options.displayEndDate:SO.DateOnly.parse(this._options.displayEndDate);var b,c,d=this._getIntervalBetween2Date(this._displayStartDate,this._displayEndDate),e=null,f=null;SO.Utils.each(this._zoomUnitDisplay,function(a,g){1.2*g.value>=d&&d>=.8*g.value?(c=a,g.value=d,b=g):d>g.value&&(!e||g.value>e.value)?e=a:g.value>d&&(!f||g.value<f.value)&&(f=a)}),SO.isNundef(b)?(b={value:d,"in":e,out:f},this._zoomLevel="custom",this._zoomUnitDisplay[this._zoomLevel]=b):this._zoomLevel=c}this._referenceDate=new SO.DateOnly(this._displayStartDate.getYear(),this._displayStartDate.getMonth(),this._displayStartDate.getDay())},_buildMarkup:function(){if(this._$objectsHeader=$("<div></div>").addClass("timeline-object-header"),this._$objectsHeader.appendTo(this.$el),this._$objectsContainer=$("<div></div>").addClass("timeline-object-container"),this._$objectsContainer.appendTo(this.$el),this._$todayMarker=$("<div></div>").addClass("timeline-today-marker").appendTo(this.$el),this._$zoomContainer=$("<div></div>").addClass("timeline-header-zoom"),null!==this._options.zoomIconContainer?this._$zoomContainer.appendTo(this._options.zoomIconContainer):this._$zoomContainer=null,null!==this._$zoomContainer){var a=this;this._actionBar=new SO.Widgets.cmdBar($("<div></div"),{iconSize:24,commands:["zoomInCmd","zoomOutCmd"],commandConfigs:{zoomInCmd:{mode:"transparent",icon:"coral-zoomIn",command:function(){a._handleZoom(a._zoomUnitDisplay[a._zoomLevel].in)}},zoomOutCmd:{mode:"transparent",icon:"coral-zoomOut",command:function(){a._handleZoom(a._zoomUnitDisplay[a._zoomLevel].out)}}}}),this._actionBar.$el.prependTo(this._$zoomContainer),this._zoomUnitDisplay&&this._zoomLevel&&(this._actionBar.setCommandAttribute("zoomInCmd","disabled",null==this._zoomUnitDisplay[this._zoomLevel].in),this._actionBar.setCommandAttribute("zoomOutCmd","disabled",null==this._zoomUnitDisplay[this._zoomLevel].out))}return this},_refreshTimelineHeader:function(){var a,b;return this._$objectsHeader.empty(),this._$objectsHeader.css("left","0"),this._$todayMarker.css("left","0"),b=this._addIntervalToDate(this._displayStartDate,-1*this._displayedInterval),a=this._addIntervalToDate(this._displayEndDate,this._displayedInterval),"month"===this._zoomLevel?this._displayDateMonthHeader(b,a):this._displayMonthYearHeader(b,a),this._updateTodayMarker(),this},_displayMonthYearHeader:function(a,b){if(SO.isDateOnly(a)&&SO.isDateOnly(b)){var c,d,e,f,g,h;for(h=[""+a.getYear(),(10>a.getMonth()?"0":"")+a.getMonth(),"01"],b=[""+b.getYear(),(10>b.getMonth()?"0":"")+b.getMonth(),(10>b.getMonth()+1?"0":"")+(b.getMonth()+1),"01"],c=null;h[0]+"-"+h[1]+"-"+h[2]<=b[0]+"-"+b[1]+"-"+b[2];){if(g=new Date(h[0]+"-"+h[1]+"-"+h[2]),g.setHours(12),c!==h[0]){d=this._getIntervalBetween2Date(this._displayStartDate,h[0]+"-01-01")*this._displayUnit,f=this._getIntervalBetween2Date(h[0]+"-01-01",parseInt(h[0],10)+1+"-01-01")*this._displayUnit;var i=$("<span></span>").addClass("timeline-header-element timeline-header-level1").css({left:d,width:f}).appendTo(this._$objectsHeader);c=h[0];var j=$('<span class="timeline-header-level1-content">'+h[0]+"</span>").appendTo(i),k=this.$el.width()/2;this._positionHeaderLevel1Content(i,j,d,k)}e=this._getIntervalBetween2Date(this._displayStartDate,h[0]+"-"+h[1]+"-01")*this._displayUnit,$("<span>"+this._getHeaderMonth(g)+"</span>").addClass("timeline-header-element timeline-header-level2").css({left:e,width:this._countMonthDays(h[0],h[1])*this._displayUnit}).appendTo(this._$objectsHeader),g.setMonth(g.getMonth()+1),h=g.toISOString().substring(0,10).split("-")}}},_displayDateMonthHeader:function(a,b){if(SO.isDateOnly(a)&&SO.isDateOnly(b)){var c,d,e,f,g,h;for(h=[""+a.getYear(),(10>a.getMonth()?"0":"")+a.getMonth(),"01"],b=[""+b.getYear(),(10>b.getMonth()?"0":"")+b.getMonth(),(10>b.getMonth()+1?"0":"")+(b.getMonth()+1),"01"],c=null;h[0]+"-"+h[1]+"-"+h[2]<=b[0]+"-"+b[1]+"-"+b[2];){if(g=new Date(h[0]+"-"+h[1]+"-"+h[2]),g.setHours(12),c!==h[1]){e=this._getIntervalBetween2Date(this._displayStartDate,h[0]+"-"+h[1]+"-01")*this._displayUnit,f=this._countMonthDays(h[0],h[1])*this._displayUnit;var i=$("<span></span>").addClass("timeline-header-element timeline-header-level1").css({left:e,width:f}).appendTo(this._$objectsHeader);c=h[1];var j=$('<span class="timeline-header-level1-content">'+this._getHeaderMonth(g,!0)+"</span>").appendTo(i),k=this.$el.width()/2;this._positionHeaderLevel1Content(i,j,e,k)}d=this._getIntervalBetween2Date(this._displayStartDate,h[0]+"-"+h[1]+"-"+h[2])*this._displayUnit,$("<span>"+h[2]+"</span>").addClass("timeline-header-element timeline-header-level2").css({left:d,width:this._displayUnit}).appendTo(this._$objectsHeader),g.setDate(g.getDate()+1),h=g.toISOString().substring(0,10).split("-")}}},_positionHeaderLevel1Content:function(a,b,c,d){if(a&&b){var e=a.outerWidth(!0),f=c+e,g=b.outerWidth(!0);d>c&&d+g>f?b.css({left:e-g}):c>d&&f>d?b.css({left:0}):b.css({left:d-c})}},_updateTodayMarker:function(){var a=new SO.DateOnly,b=this._getIntervalBetween2Date(this._displayStartDate,a)*this._displayUnit;this._$todayMarker.css("left",b)},_updateDisplayUnits:function(){return this._displayedInterval=this._getIntervalBetween2Date(this._displayStartDate,this._displayEndDate),this._displayUnit=this.$el.width()/this._displayedInterval,this},_fetchData:function(a,b){if(SO.isDateOnly(this._displayStartDate)&&SO.isDateOnly(this._displayEndDate)){var c=this._addIntervalToDate(this._displayStartDate,-1*this._zoomUnitDisplay[this._zoomLevel].value),d=this._addIntervalToDate(this._displayEndDate,this._zoomUnitDisplay[this._zoomLevel].value);return this._currentJob,that=this,SO.isNundef(b)&&(b={options:a,onSuccess:function(b){that._currentJob=null,b=$.extend([],!0,b),that._handleDataSuccess(b,a)},onError:function(){that._currentJob=null},onComplete:function(){that._currentJob=null}}),this._currentJob=this._controller.getRange(this._jpath,c.toString(),d.toString(),b),this._currentJob}},_fetchChildrenData:function(a,b){this._currentJob;var c=this;SO.isNundef(b)&&(b={item:a,onSuccess:function(b){c._currentJob=null,b=$.extend([],!0,b),c._handleChildrenDataSuccess(a,b)},onError:function(){c._currentJob=null},onComplete:function(){c._currentJob=null}});var d=this._getObjectJpath(a);return this._currentJob=this._controller.getChildren(d,b,!1,"",a),this._currentJob},_hasChildren:function(a){return this._controller.hasChildren(this._getObjectJpath(a),a)},_getObjectJpath:function(a){var b,c,d,e,f=this._jpath,g=this._controller.getKeys(this._jpath);for(d=a._start.getYear(),e=(10>a._start.getMonth()?"0":"")+a._start.getMonth(),c=(10>a._start.getDay()?"0":"")+a._start.getDay(),f+="["+d+","+e+","+c+"]",b=0;g.length>b;b++)f+="/"+a[g[b]];return f},_handleDataSuccess:function(a,b){if(SO.isArray(a)&&0!=a.length){b&&1==b.clearContent&&(this._displayingObjects=[],this._rows=[]);var c,d,e,f;if(SO.isArray(a))for(e=0;a.length>e;e++){for(c=a[e],d=null,f=0;!d&&this._displayingObjects.length>f;f++)this._displayingObjects[f].PKey==c.PKey&&(d=this._displayingObjects[f]);c=this._prepareData(c),d?SO.Utils.extend(!0,d,c):this._displayingObjects.push(SO.Utils.extend(!0,{_parent:null,_expanded:!1},c))}this._refreshObjects(b)}},_prepareData:function(a){return a?(a.start&&(a._start=a.start),a.end&&(a._end=a.end),a):null},_prepareChildrenData:function(a,b){return a&&b?(a=this._prepareData(a),a._start||(a._start=b._start),a._end||(a._end=b._end),a):null},_handleChildrenDataSuccess:function(a,b){if(a){if(!SO.isArray(b)||0==b.length){if(a._$iconSpan){var c=SO.IMG.genIcon("coral-accordionDown",18);c&&c.el&&a._$iconSpan.empty().append($(c.el)),a._$noData?a._$noData.enable():(a._$noData=new SO.Widgets.Tooltip(a._$iconSpan),a._$noData.setTitle(this._options.emptyText))}return a._expanded=!1,void 0}if(a._expanded=!0,a._$objectContent.addClass("timeline-object-content-expanded"),this._expandedFoldersStackPush(a),a._$iconSpan){var c=SO.IMG.genIcon("coral-accordionUp",18);c&&c.el&&a._$iconSpan.empty().append($(c.el))}a._$noData&&a._$noData.disable(),a._children||(a._children=[]);var d,e,f,g;if(SO.isArray(b))for(f=0;b.length>f;f++){for(d=b[f],e=null,g=0;!e&&a._children.length>g;g++)a._children[g].PKey==d.PKey&&(e=a._children[g]);d=this._prepareChildrenData(d,a),e?SO.Utils.extend(!0,e,d):a._children.push(SO.Utils.extend(!0,{_parent:a,_expanded:!1},d))}a._rows||(a._rows=[]),this._organizeDisplayRows(a._children,a._rows,a._$childrenContainer),this._displayRows(a._children),this._updateRowHeight(a),a._$childrenContainer.show(),this._updateChildrenOverlays(a),a._$element.children(".timeline-children-overlay").show()}},_refreshObjects:function(a){this._$objectsContainer.css("left","0"),a&&a.clearContent===!0&&this._$objectsContainer.empty(),this._organizeDisplayRows(this._displayingObjects,this._rows,this._$objectsContainer),this._displayRows(this._displayingObjects,a);for(var b=0;this._rows.length>b;b++)for(var c=this._rows[b],d=0;c.length>d;d++){var e=c[d];this._updateChildrenOverlays(e)}return this},_organizeDisplayRows:function(a,b,c){SO.isArray(a)&&SO.isArray(b)||(b=[]);var d,e,f,g,h,i,j,k,l,m=[];for(d=0;a.length>d;d++)h=a[d],h._$element||m.push(h);if(0!=m.length)for(d=0;m.length>d;d++){for(g=m[d],j=-1,e=0;b.length>e&&0>j;e++){for(i=b[e],k=!0,f=0;i.length>f;f++)h=i[f],l=h._$row,g._start.lessThan(h._start)&&g._end.lessThan(h._start)&&this._addIntervalToDate(g._start,this._itemMinWidthInDay).lessThan(h._start)||g._start.greaterThan(h._end)&&g._end.greaterThan(h._end)&&g._start.greaterThan(this._addIntervalToDate(h._start,this._itemMinWidthInDay))||(k=!1);k&&(j=e)}if(0>j){l=this._addHTMLRow(c);var n=[];g._$row=l,g._row=n,n.push(g),b.push(n)}else g._$row=l,b[j].push(g),g._row=b[j]}},_displayRows:function(a,b){if(SO.isArray(a)){var c,d;for(d=b&&b.refreshAllDisplay,c=0;a.length>c;c++)this._upcreateHTMLObject(a[c]),d&&a[c]._children&&this._displayRows(a[c]._children,b)}},_displayPopOver:function(a,b,c){null!==this._$popover&&this._$popover.destroy&&this._$popover.destroy(),this._$popover=new SO.Widgets.popover(b,{params:{content:this._options.popoverRendering(a),displayOn:"click",classNames:"timeline-popover",popOnMouse:!0,within:this.el}}),this._$popover.show(c)},_addHTMLRow:function(a){return a?$("<div></div>").addClass("timeline-object-lines").appendTo(a):null},_upcreateHTMLObject:function(a){if(!a)return null;if(!a._$row)return null;var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(k=this,n=this._options.objectRendering(a),i=this._hasChildren(a),a._$element)b=a._$element;else{if(b=$("<div></div>").addClass("timeline-object").appendTo(a._$row),i&&(l=$("<div></div>").addClass("timeline-children-overlay").appendTo(b).hide(),$("<div></div>").addClass("timeline-children-overlay-parent-subcontainer").appendTo(l)),f=$("<span></span>").addClass("timeline-object-content").appendTo(b),SO.Event.bind(f,"vclick",function(b){q.hide(),k._displayPopOver(a,f,b)},{stopPropagation:!0}),SO.isNundef(a.thumbnail)||(m=$("<span></span>").addClass("timeline-object-content-thumbnail "+n.status).css({backgroundImage:"url("+a.thumbnail+")",backgroundSize:"cover"}).appendTo(f)),o=$("<span></span>").addClass("timeline-object-content-icon").appendTo(f),a._$stateIcon=o,this._addItemIconState(a,b,!1),h=$("<span>"+n.label+"</span>").addClass("timeline-object-label").appendTo(f),q=new SO.Widgets.Tooltip(f),q.setTitle(n.label),i){g=$("<div></div>").addClass("timeline-children-container").appendTo(b).hide(),SO.Event.bind(g,"vclick",function(b){q.hide(),k._displayPopOver(a,g,b)},{stopPropagation:!0}),j=$("<span></span>").addClass("timeline-children-collapse").appendTo(f);var r=SO.IMG.genIcon("coral-accordionDown",18);r&&r.el&&$(r.el).appendTo(j),SO.Event.bind(j,"vclick",function(){q.hide(),k._childrenContainerExpand(a)},{stopPropagation:!0})}a._$element=b,a._$childrenContainer=g,a._$iconSpan=j,a._$currentLabel=h,a._$objectContent=f}e=a._parent?0:this._getIntervalBetween2Date(this._displayStartDate,this._referenceDate)*this._displayUnit,a._$row.css({left:e}),p=n.label,d=a._parent?this._getIntervalBetween2Date(a._parent._start,a._start)*this._displayUnit:this._getIntervalBetween2Date(this._referenceDate,a._start)*this._displayUnit,c=this._getIntervalBetween2Date(a._start,a._end)*this._displayUnit,1.5*this._itemMinWidth>c&&(p=n.shortLabel),this._itemMinWidth>c&&(c=this._itemMinWidth),b.css({width:c,left:d}),a._$currentLabel&&a._$currentLabel.html(p)},_addItemIconState:function(a,b,c){if(a&&b&&a._$stateIcon){a._$stateIcon.empty();var d=SO.IMG.genIcon(c?a.icon+"-inverse":a.icon,18);d instanceof SO.Icon?$(d.el).addClass("timeline-object-content-icon-image").appendTo(a._$stateIcon):d.appendTo(a._$stateIcon)}},_childrenContainerExpand:function(a){if(a)if(a._expanded){if(a._$childrenContainer.hide(),a._expanded=!1,a._$objectContent.removeClass("timeline-object-content-expanded"),this._expandedFoldersStackPop(a),a._$iconSpan){var b=SO.IMG.genIcon("coral-accordionDown",18);b&&b.el&&a._$iconSpan.empty().append($(b.el))}this._updateRowHeight(a),a._$element.children(".timeline-children-overlay").hide(),this._updateChildrenOverlays(a)}else{if(a._$iconSpan){var b=SO.IMG.genIcon("coral-pending",18);b&&b.el&&a._$iconSpan.empty().append($(b.el))}that._fetchChildrenData(a)}},_getItemHeight:function(a){if(!a)return 0;var b=0;return b=a._expanded&&a._$childrenContainer?a._$childrenContainer.outerHeight(!0):a._$element.outerHeight(!0)},_updateRowHeight:function(a){if(a&&a._row){if(a._$row){for(var b=0,c=0;a._row.length>c;c++){var d=a._row[c],e=this._getItemHeight(d);e>b&&(b=e)}a._$row.height(b)}a._parent&&this._updateRowHeight(a._parent)}},_updateChildrenOverlay:function(a){if(a){var b,c,d,e,f=0,g=0,h=0;if(a._$element&&(g=a._$element.width()),a._children)for(c=0;a._children.length>c;c++)b=a._children[c],b._$element&&(d=parseFloat(b._$element.css("left")),e=b._$element.width(),h>d&&(h=d),d+e>g&&(g=d+e));a._$childrenContainer&&a._$childrenContainer.is(":visible")&&(f=a._$childrenContainer.outerHeight(!0)),a._$element.children(".timeline-children-overlay").css({height:f,left:h,width:g-h})}},_updateChildrenOverlays:function(a,b){if(a)if(b===!1)this._updateChildrenOverlay(a),a._parent&&this._updateChildrenOverlays(a._parent,!1);else if(SO.isArray(a._children)&&a._children.length>0)for(var c=0;a._children.length>c;c++)this._updateChildrenOverlays(a._children[c],!0);else a._parent&&this._updateChildrenOverlays(a._parent,!1)},_expandedFoldersStackPush:function(a){if(a){var b=3,c=b;if(this._expandedFoldersStack.length>0){var d=this._expandedFoldersStack[this._expandedFoldersStack.length-1];d&&d._$element&&(c=parseInt(d._$element.css("z-index"))+1)}this._expandedFoldersStack.push(a),a._$element&&a._$element.css({zIndex:c})}},_expandedFoldersStackPop:function(a){if(a){for(var b=this._expandedFoldersStack.length-1,c=-1;b>=0&&0>c;){var d=this._expandedFoldersStack[b];d==a&&(c=b),b--}a._$element&&a._$element.css({zIndex:""}),c>=0&&this._expandedFoldersStack.splice(c,1)}},_bindEvents:function(){var a=this;this.el.addEventListener("mouseleave",function(){var b=document.createEvent("MouseEvents");b.initEvent("mouseup",!0,!0),a._$objectsHeader[0].dispatchEvent(b)}),SO.Browser.isTouchScreen()?(SO.Event.bind(this._$objectsHeader,"slide",{onMove:function(b){a._handleSwype(b)},onStop:function(b){b.distance.x=b.currentX-b.originalX,a._handleSwypeEnd(b)}},{direction:"horizontal",tolerance:100}),SO.Event.bind(this._$objectsContainer,"slide",{onMove:function(b){a._handleSwype(b)},onStop:function(b){b.distance.x=b.currentX-b.originalX,a._handleSwypeEnd(b)}},{direction:"horizontal",tolerance:100})):(SO.Event.bind(this._$objectsHeader,"vdrag",{onMove:function(b){a._handleDrag(b,"header")},onStop:function(b){a._handleSwypeEnd(b)}},{dragBlockY:!0,dropFailed:"",dragStartDuration:0}),SO.Event.bind(this._$objectsContainer,"vdrag",{onMove:function(b){a._handleDrag(b,"content")},onStop:function(b){a._handleSwypeEnd(b)}},{dragBlockY:!0,dropFailed:"",dragStartDuration:0})),SO.Event.bind(this._$objectsHeader,"vclick",function(){null!==a._$popover&&a._$popover.destroy&&a._$popover.destroy()}),SO.Event.bind(this._$objectsContainer,"vclick",function(){null!==a._$popover&&a._$popover.destroy&&a._$popover.destroy()})},_handleZoom:function(a){var b,c,d;a&&(b=this._zoomUnitDisplay[a],c=this._zoomUnitDisplay[this._zoomLevel],this._zoomLevel=a,d=b.value-c.value,this._displayStartDate=this._addIntervalToDate(this._displayStartDate,-1*(d/2)),this._displayEndDate=this._addIntervalToDate(this._displayEndDate,d/2),this._actionBar.setCommandAttribute("zoomInCmd","disabled",null==b.in),this._actionBar.setCommandAttribute("zoomOutCmd","disabled",null==b.out),this._updateDisplayUnits()._refreshTimelineHeader()._fetchData({refreshAllDisplay:!0}))},_handleDrag:function(a,b){null!==this._$popover&&this._$popover.hide&&this._$popover.hide();var c=0,d=parseInt(this._$objectsHeader.css("left"),10),e=parseInt(this._$objectsContainer.css("left"),10),f=parseInt(this._$todayMarker.css("left"),10);isNaN(d)&&(d=0),isNaN(e)&&(e=0),isNaN(f)&&(f=0),null===a.lastX&&(a.currentX=a.distance.x),c=a.currentX-a.lastX,"header"!==b?this._$objectsHeader.css("left",d+c):"content"!==b&&this._$objectsContainer.css("left",e+c),this._$todayMarker.css("left",f+c);var g=this,h=this.$el.width()/2;$(".timeline-header-level1:visible").each(function(){var b=$(this).children(".timeline-header-level1-content:first")[0];b&&(parseFloat($(this).css("left"))+a.distance.x,g._positionHeaderLevel1Content($(this),$(b),parseFloat($(this).css("left"))+a.distance.x,h))})},_handleSwype:function(a){null!==this._$popover&&this._$popover.hide&&this._$popover.hide();var b=parseInt(this._$objectsHeader.css("left"),10),c=parseInt(this._$objectsContainer.css("left"),10),d=parseInt(this._$todayMarker.css("left"),10);isNaN(b)&&(b=0),isNaN(c)&&(c=0),isNaN(d)&&(d=0),null===a.lastX&&(a.lastX=a.originalX),this._$objectsHeader.css("left",b+(a.currentX-a.lastX)),this._$objectsContainer.css("left",c+(a.currentX-a.lastX)),this._$todayMarker.css("left",d+(a.currentX-a.lastX))},_handleSwypeEnd:function(a){if(null!==a.currentX&&0!==a.distance.x){var b=-1*Math.ceil(a.distance.x/this._displayUnit);this._displayStartDate=this._addIntervalToDate(this._displayStartDate,b),this._displayEndDate=this._addIntervalToDate(this._displayEndDate,b),this._updateDisplayUnits()._refreshTimelineHeader()._fetchData()}},_getHeaderMonth:function(a,b){var c,d=[xtk_core.timeline_month_january(),xtk_core.timeline_month_february(),xtk_core.timeline_month_march(),xtk_core.timeline_month_april(),xtk_core.timeline_month_may(),xtk_core.timeline_month_june(),xtk_core.timeline_month_july(),xtk_core.timeline_month_august(),xtk_core.timeline_month_september(),xtk_core.timeline_month_october(),xtk_core.timeline_month_november(),xtk_core.timeline_month_december()];return c=b===!0?d[a.getMonth()]+" "+a.getFullYear():d[a.getMonth()]},_countMonthDays:function(a,b){var c=new Date(a,b,0,12);return c.getDate()},_getIntervalBetween2Date:function(a,b){var c=a,d=b;if(!(a instanceof SO.DateOnly||a instanceof SO.DateTime))try{c=SO.DateOnly.parse(a)}catch(e){try{c=SO.DateTime.parse(a),c=new SO.DateOnly(c.getYear(),c.getMonth,c.getDay())}catch(e){return 0}}if(!(b instanceof SO.DateOnly||b instanceof SO.DateTime))try{d=SO.DateOnly.parse(b)}catch(e){try{d=SO.DateTime.parse(b)}catch(e){return 0}}c instanceof SO.DateTime&&(c=new SO.DateOnly(c.getYear(),c.getMonth(),c.getDay())),d instanceof SO.DateTime&&(d=new SO.DateOnly(d.getYear(),d.getMonth(),d.getDay()));var f=d.substract(c);return Math.ceil(f/86400)},_addIntervalToDate:function(a,b){if(!(a instanceof SO.DateOnly||a instanceof SO.DateTime))return a;var c;return c=a instanceof SO.DateOnly?new SO.DateOnly(a.getYear(),a.getMonth(),a.getDay()):new SO.DateTime(a.getYear(),a.getMonth(),a.getDay(),a.getHours(),a.getMinutes(),a.getSeconds()),c.add("days",b)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("popover",{DEFAULT_OPTIONS:{params:{content:null,gravity:"s",title:null,displayOn:"mouseover",classNames:"",onShow:null,popOnMouse:!1,within:null}},_create:function(){var a,b,c,d;switch(a=this,this._hasBeenOpened=!1,this._isVisible=!1,this._$title=null,this._$body=null,this._$popoverContainer=$('<div class="nlui-popover-container"></div>'),this._$popoverArrow=$('<div class="nlui-popover-arrow"></div>'),this._options.popableManager.addPopable(this),d="nlui-popover clui-light",this._options.params.classNames&&(d+=" "+this._options.params.classNames),this._$popover=$('<div class="'+d+'"></div>').append(this._$popoverArrow,this._$popoverContainer),this.setFloatable(this._$popover[0]),b=function(){a._stillOver=!0,a.show()},c=function(){a._stillOver=!1,setTimeout(function(){a._stillOver||a.hide()},100)},this._options.params.displayOn){case"click":SO.Event.bind(this.$el.get(0),"vclick",function(){a.toggle()}),SO.Event.bind(this.$el.get(0),"vmousedown",function(b){a._options.popableManager.stopPropagation(b.originalEvent)}),this._$popover.on("focus",b);break;case"mouseover":default:this.$el.on("mouseenter",b).on("mouseleave",c),this._$popover.on("mouseenter",b).on("mouseleave",c)}return this.$el.addClass("nlui-popable"),this},_firstDisplay:function(){return this._options.params.title&&this.setTitle(this._options.params.title),this._options.params.content&&this.addContent(this._options.params.content),this._hasBeenOpened=!0,this},show:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;switch(b=this,g=this._options.params.gravity,c=8,e=11,f=24,this._isVisible=!0,this._hasBeenOpened||this._$popover.appendTo("body"),r=this._options.params.popOnMouse&&a&&"click"===a.eventName&&a.originalEvent?a.originalEvent:this.$el,this.$el.focus(),d={collision:"flipfit",of:r,within:this._options.params.within,using:function(a,b){var c,d,e;c=8,e=a.top,d=a.left,d+b.element.width===window.outerWidth&&(d-=c),e+b.element.height===window.outerHeight&&(e-=c),b.element.element.css({top:e||c,left:d||c})}},g){case"n":d=SO.Utils.extend(d,{my:"center bottom-"+(e+2),at:"center top"});break;case"ne":d=SO.Utils.extend(d,{my:"left bottom-"+(e+2),at:"right-"+(f+c)+" top"});break;case"nw":d=SO.Utils.extend(d,{my:"right bottom-"+(e+2),at:"left+"+(f+c)+" top"});break;case"s":d=SO.Utils.extend(d,{my:"center top+"+e,at:"center bottom"});break;case"se":d=SO.Utils.extend(d,{my:"left top+"+e,at:"right-"+(f+c)+" bottom"});break;case"sw":d=SO.Utils.extend(d,{my:"right top+"+e,at:"left+"+(f+c)+" bottom"});break;case"w":d=SO.Utils.extend(d,{my:"right center",at:"left-"+(e+2)+" center"});break;case"e":d=SO.Utils.extend(d,{my:"left+"+e+" center",at:"right center"})}switch(this._$popover.show(),this._zIndexManager.bringToFront(this._$popover[0]),this._hasBeenOpened||this._firstDisplay(),this._$popover.position(d),h=this._$popover.offset(),i=this.$el.offset(),j=this._$popover.outerWidth(!0),k=this._$popover.outerHeight(!0),l=this.$el.outerWidth(!0),m=this.$el.outerHeight(!0),o="",h.top+k<i.top+m/2?o+="n":h.top>i.top+m/2&&(o+="s"),h.left+j<i.left+l/2?o+="w":h.left>i.left+l/2&&(o+="e"),n="nlui-popover-"+o,this._$popover.addClass(n),this._oldGravity=n,g){case"n":case"s":this._options.params.popOnMouse?(this._$popover.left,p=this._$popover.offset().left,q=this.$el.offset().left,this._$popoverArrow.css("left",this._$popover.outerWidth(!0)/2-this._$popoverArrow.outerWidth(!0)/2+"px")):(p=this._$popover.offset().left,q=this.$el.offset().left,this._$popoverArrow.css("left",q-p+this.$el.outerWidth(!0)/2+"px"));break;case"e":case"w":}return this._options.params.onShow&&this._options.params.onShow.call(this),this},hide:function(){return this._isVisible=!1,this._$popover.hide(),this._$popover.removeClass(this._oldGravity),this},toggle:function(){return this._isVisible?this.hide():this.show(),this},setTitle:function(a){return this._$title||(this._$title=$('<div class="nlui-popover-title"></div>'),this._$popoverContainer.append(this._$title)),this._$title.text(a),this},_buildBody:function(){this._$body=$('<div class="nlui-popover-body"></div>'),this._$popoverContainer.append(this._$body)},addContent:function(a){return this._$body||this._buildBody(),this._$body.append(a),this},setContent:function(a){return this._$body||this._buildBody(),this._$body.empty().append(a),this},destroy:function(){this._$popover.remove()},isOwnerOf:function(a){var b=!1;return(SO.DOMUtils.isDescendantOf(a,this._$popover)||SO.DOMUtils.isDescendantOf(a,this.$el))&&(b=!0),b},collapse:function(){return this.hide(),this}}),$.widget("NL.nlPopover",{_create:function(){this._widget=new SO.Widgets.popover(this.element,this.options)},destroy:function(){this._widget.destroy()},isOwnerOf:function(a,b){return this._widget.isOwnerOf(a,b)},collapse:function(a){this._widget.collapse(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Status",{DEFAULT_OPTIONS:{icon:"",status:"",text:"",iconAfter:null},_modes:{"default":"nlui-status-mode-default",edition:"nlui-status-mode-edition",started:"nlui-status-mode-started",finished:"nlui-status-mode-finished",warning:"nlui-status-mode-warning",error:"nlui-status-mode-error",label:"nlui-status-mode-label"},_create:function(){this._text=this._options.text,this._status=this._options.status,this._icon=this._options.icon,this._iconAfter=this._options.iconAfter,this._refreshDisplay()},_refreshDisplay:function(){if(this.el.classList.add("nlui-status"),this._statusIconHolder=document.createElement("span"),this._statusIconHolder.classList.add("nlui-status-icon"),this.setStatus(this._status),this.setIcon(this._icon),this.el.insertBefore(this._statusIconHolder,this.el.firstChild),this._iconAfter){var a=SO.IMG.genIcon(this._iconAfter,24)[0],b=document.createElement("span");a.classList.add("nlui-status-opacity"),b.appendChild(a),b.classList.add("nlui-status-background"),this.el.appendChild(b)}var c=document.createTextNode("");return this._textLabel=document.createElement("span"),this._textLabel.classList.add("nlui-status-label"),this._textLabel.appendChild(c),this._text&&this.setText(this._text),this.el.appendChild(this._textLabel),this},setIcon:function(a){var b=a+(this._status?"-inverse":""),c=SO.IMG.genIcon(b,18)[0];this._icon=a,this._statusIconHolder.innerHTML="",this._statusIconHolder.appendChild(c)},setStatus:function(a){var b,c=this._modes[this._status]||this._modes["default"];b=!a&&this._text?this._modes.label:this._modes[a]||this._modes["default"],this._statusIconHolder.classList.remove(c),this._statusIconHolder.classList.add(b),this._status=a},setText:function(a){this._text=a,this._textLabel.textContent="",this._textLabel.style.display="none",""!==a&&(this._textLabel.textContent=a,this._textLabel.style.display="block")}}),$.widget("SO.soStatus",{_create:function(){this._widget=new SO.Widgets.Status(this.element,this.options)},setText:function(a){this.widget.setText(a)},setIcon:function(a){this.widget.setIcon(a)},setStatus:function(a){this.widget.setStatus(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("QueryEditor",{DEFAULT_OPTIONS:{resourceURL:"",compatibleResource:"",palette:{$container:null},jpath:null,controller:null,actionsContainer:null,countable:!1,rootURL:"",readOnly:!1,disabled:!1,beforeAction:function(){},onFilterEdit:function(){}},_create:function(){var a,b,c;return a=this,b="nlui-queryeditor",this._forbiddenCategory="99_none",this._queryItems=[],this._selection=[],this._$actionsContainer=null,this._actionDelete=null,this._monoSelection=!0,this._dropAreas=null,this._paletteCategories={},this._categories={},this._values={},this._state={},this._itemsIcons={queryFilter:"coral-filteringQuery",audience:"coral-users",audienceStatic:"coral-users",expression:"coral-feedManagement",field:"coral-mBox","advanced-field":"coral-feed"},this._jpath=this._options.jpath,this._controller=this._options.controller,this.setReadOnly(this._options.readOnly),this.setDisabled(this._options.disabled),this.groupOperators=[{label:xtk_core.qe_operator_and(),value:"AND"},{label:xtk_core.qe_operator_or(),value:"OR"},{label:xtk_core.qe_operator_except(),value:"AND NOT"}],this._options.countable&&(b+=" nlui-queryeditor-countable"),this._rootURL=this._options.rootURL.replace(/\/$/,""),this._dropAreas=new SO.Event.droppable,this.$el.addClass(b),c=this._options.resourceURL,c&&(this._options.resourceURL=c=c.replace(/\/$/,""),this._jpath&&this._controller&&(this._values[c]=this._controller.getValue(this._jpath)),this.resetMeta()),this._controller.registerJpathObserver(this._jpath+"/condition",this),this},_addToLoader:function(a){var b,c,d;for(this._palette.$el.hide(),"object"!=typeof a&&(a=[a]),b=0,c=a.length;c>b;b+=1)d=a[b],-1===this._currentLoading.indexOf(d)&&this._currentLoading.push(d);return this._showLoading(),this},_removeFromLoader:function(a){var b=this._currentLoading.indexOf(a);return b>-1&&this._currentLoading.splice(b,1),0===this._currentLoading.length&&(this._hideLoading(),this._palette&&(this._palette.$el.show(),this._palette.openCategory(0)),this._render()),this},_showLoading:function(){var a,b,c,d;return a=this,this._loading||(this._loading=document.createElement("div"),this._loading.classList.add("nlui-queryeditor-loading"),b=document.createElement("span"),b.classList.add("nlui-queryeditor-loading-text"),b.textContent=xtk_core.dialog_loading(),c=document.createElement("div"),c.classList.add("clui-wait-indicator"),d=new SO.Widgets.SimpleButton($('<div class="nlui-queryeditor-loading-stop"></div>'),{mode:"transparent",tooltip:xtk_core.dialog_cancel(),iconSize:24,icon:"coral-stop",onClick:function(){a._cancelLoading()}}),this._loading.appendChild(c),this._loading.appendChild(b),this._loading.appendChild(d.el),$(this._loading).hide(),this._grayBar.addActionBarContent("reports",this._loading)),setTimeout(function(){a._preventLoading||(a._isLoading=!0,a._countElement&&$(a._countElement).hide(),a._previewElement&&$(a._previewElement).hide(),$(a._loading).show()),a._preventLoading=!1},200),this},_hideLoading:function(){return this._isLoading?(this._loading&&$(this._loading).hide(),this._countElement&&$(this._countElement).show(),this._previewElement&&$(this._previewElement).show()):this._preventLoading=!0,this._isLoading=!1,this},_cancelLoading:function(){return this._currentRestRequest&&this._currentRestRequest.cancel(),this._hideLoading(),this},findMetaData:function(a,b){var c,d,e,f,g,h,i,j;for(c=this,d=a.split("/"),f=d.length,h=[],i=0,this._metaChild=this._metaChild||new NL.MetaDataService(this._options.metaDataService,{dataSourceType:"point"});d.length>0;)e=d.splice(d.length-1,1)[0],g=d.join("/"),a?function(d,e){c._getMetaByPath(g,function(g){var h=g.meta[d];i+=1,h?(e.push(h.label),"object"==typeof g.additionalLabel&&(e=g.additionalLabel.concat(e)),"item"===h.type&&i===f&&j?b({additionalLabel:e,meta:j.content}):i===f?c._getMetaByPath(a,function(a){a.additionalLabel=e,b(a)}):1===i&&(j=h)):b()})}(e,h):c._getMetaByPath(a,b);return this},_getMetaByPath:function(a,b){var c,d,e,f,g,h,i;return c=this,this._metaChild=this._metaChild||new NL.MetaDataService(this._options.metaDataService,{dataSourceType:"metadata"}),e=a?this._options.resourceURL+"/"+a:this._options.resourceURL,f=/\/[\w-]+$/gi,h=this._metaDataMap[e.replace(f,"")],g=e.match(f)[0].replace("/",""),d=this._metaDataMap[e],!d&&h&&"item"===h.meta[g].type&&(i=h.meta[g],d={meta:i.content}),d?b(d):this._metaChild.get(e,function(a){var d;a&&(d="item"===a.type?a.content:"collection"===a.type?a.content.content.content.content:a,c._palette&&!c._isPopulate&&(c._populatePalette(a,d),c._isPopulate=!0),c._metaDataMap[e]={meta:d},c._resourceLabel||(c._resourceLabel=a.label),b(c._metaDataMap[e]))}),this},_render:function(){var a=this._values[this._options.resourceURL];return this._buildWorkSpace(),this._updateActions(),a&&this.setValue(a),this._checkEmpty(),this},setValue:function(a){return SO.assert("object"==typeof a.condition&&a.condition.length>0,"QueryEditor conditions value must be an array"),this._setCtx(a.ctx),this._parseCondition(a?a.condition:null,void 0,void 0,!0),this},setReadOnly:function(a,b){this._state.readOnly=a,b&&this.reset(!0)},setDisabled:function(a,b){this._state.disabled=a,b&&this.reset(!0)},isEditable:function(){return!this._state.readOnly&&!this._state.disabled},getCondition:function(a){var b,c,d;return c=[],d=this._queryItems.length,d>0&&(b=this._queryItems[0],c="queryBlock"!==b.getItemType()||b.isSpecialItem()?b.getCondition(a):[b.getCondition(a)]),c},_callbacks:{onAdd:function(){this._refreshCollection()},onChange:function(){this._refreshCollection()},onRemove:function(){this._refreshCollection()},onDuplicate:function(){this._refreshCollection()},onMove:function(){this._refreshCollection()}},_refreshCollection:function(){var a,b;return a=this,b=this._controller.getValue(this._jpath),a._options.beforeAction.call(a,function(){a._options.onDelete(function(){var c,d;d=a.getCondition(),0===d.length&&a._setCtx(""),c=SO.Utils.extend({},b,{condition:d,ctx:a._getCtx()}),delete c.filteringSchema,delete c.count,delete c.preview,0===d.length&&delete c.condition,a._options.onPost(c,function(b){a._resetCount();var c=a._controller.getDataSource(a._jpath+"/count"),d=a._controller.getDataSource(a._jpath+"/preview");c&&b.count&&c.setURL(b.count.href),d&&b.preview&&d.setURL(b.preview.href),a._controller.setValueNotDirty(a._jpath+"/condition",b.condition,!0),a._controller.setValueNotDirty(a._jpath+"/ctx",b.ctx,!0),a._controller.setValue(a._jpath+"/displayFilter",a.getDescription(),!0),a._controller.setDirty(!0),a._controller instanceof SO.MVC.SubController&&a._controller.getParent().setDirty(!0)})})}),this},_parseCondition:function(a,b,c,d){var e,f,g,h,i,j,k,a,l,m,n,o,p;if(c=c||{},a&&(f=a.length,k=[],f>0)){for(e=0;f>e;e+=1)g=a[e],1===g.condition.length?(p=g,g=g.condition[0]):p=void 0,h=g.condition,o="queryFilter"===g.entityType||"audience"===g.entityType||"audienceStatic"===g.entityType||"expression"===g.entityType,n=o?{entityType:g.entityType,entityLabel:g.entityLabel,entityName:g.entityName,entityHumanCond:g.desc,filterName:"queryFilter"===g.entityType?g.filterName:"",parentParams:p}:void 0,g.enabledIf&&h&&h.length>0&&(n||(n={}),n.parentParams={enabledIf:g.enabledIf}),h&&h.length>0?j=this._parseCondition(h,void 0,n,d):(l={expr:g.expr,label:g.desc},l.params=1===f&&c.entityLabel?c:o?SO.Utils.extend({},c,n):{parentParams:c.parentParams},g.dateTypeAndPrecision&&SO.Utils.each(g.dateTypeAndPrecision,function(a,b){(b||0===b)&&(l.params.dateTypeAndPrecision||(l.params.dateTypeAndPrecision={}),l.params.dateTypeAndPrecision[a]=b)}),g.internalId&&(l.params.internalId=g.internalId),g.PKey&&(l.params.PKey=g.PKey),g.enabledIf&&(l.params.enabledIf=g.enabledIf),l.params.condition=a,j=this.addQueryItem("item",l)),j&&k.push(j);f>1?(c.condition=a,i=this.addQueryItem("group",{queryGroup:b,params:c,operator:void 0})):b&&(i=b),i&&k.length>0&&(i.addItems(k),m=a[0],i.setOperator(m.boolOperator,d))}return i},_checkPaletteCategorie:function(a){return a&&!this._paletteCategories[a]&&this._categories[a]&&a!==this._forbiddenCategory&&(this._palette.addCategory({name:a,label:this._categories[a].label}),this._paletteCategories[a]=!0),this},_populatePalette:function(a,b){var c,d;return d=this,c=new NL.DataSource.Rest({url:this._rootURL+"/resourceType/resourceType.json",returnRaw:!0}),c.get(0,100,{onSuccess:function(c){var e,f,g;e=c.content.content.content.category,f=e&&e.values?e.values:{},g="00_general",d._categories=SO.Utils.extend({},f,d._categories),a._filters&&a._filters.href?d._populatePaletteFilters(a._filters.href):d._removeFromLoader("paletteFilter"),d._populatePaletteFields(b),d._checkPaletteCategorie(g),d._palette.addItem({label:xtk_core.qe_palette_basic_audience(),name:"basic-audience",icon:d._itemsIcons.audience,template:{type:"audience"}},g)}}),this},_populatePaletteFilters:function(a){var b,c;return b=this,c=new NL.DataSource.Rest({url:a}),this._filters={},c.get(0,void 0,{onSuccess:function(a){SO.Utils.each(a,function(a,c){var d=c.category;b._checkPaletteCategorie(d),d!==b._forbiddenCategory&&(b._filters[a]=c,b._palette.addItem({label:c.label||a,name:a,icon:b._itemsIcons.queryFilter,template:SO.Utils.extend({type:"queryFilter",name:a},c)},d))})},onComplete:function(){b._removeFromLoader("paletteFilter")},onError:function(a){b.setError(a.message)}}),this},_populatePaletteFields:function(a){var b=this,c=function(a,d){SO.Utils.each(a,function(a,e){var f;"item"===e.type?(f=d?d+"/"+e.apiName:e.apiName,c(e.content,f)):e.category!==b._forbiddenCategory&&(b._checkPaletteCategorie(e.category),b._paletteCategories[e.category]&&b._palette.addItem({label:e.label,name:e.apiName,icon:b._itemsIcons.field,template:{type:"field",isNew:!0,metaType:e.type,choices:e.values,fields:[{fieldName:"@"+e.apiName,fieldPath:d,meta:e}]}},e.category))})};return c(a,""),this._removeFromLoader("paletteFields"),this},_buildPalette:function(){var a,b;a=this,b=this._options.palette,this._$palette=$('<div class="nlui-queryeditor-palette"></div>'),b.$container.append(this._$palette);var c={categories:[{label:xtk_core.qe_palette_advanced(),sort:!1,name:"zz_advanced"}],items:[{label:xtk_core.qe_palette_field_label(),icon:this._itemsIcons["advanced-field"],name:"advanced-field",category:"zz_advanced",template:{type:"field"}},{label:xtk_core.qe_palette_expression_label(),name:"advanced-expression",icon:this._itemsIcons.expression,category:"zz_advanced",template:{type:"expression"}}]};return this._palette=new SO.Widgets.DiagramPalette(this._$palette,{rendering:"line",droppable:this._dropAreas,paletteConfiguration:c,defaultOpen:!1,sortCategories:!0,sortItems:!0,dragStart:function(a){a.data("helper").cloneElement.style.opacity=".3",a.css({width:a.data("helper").cloneElement.offsetWidth}).addClass("nlui-dragged-queryitem")},dragStop:function(a){a.data("helper").cloneElement.style.opacity="1",a.css({width:""}).removeClass("nlui-dragged-queryitem")},onDrop:function(b){var c,d;c=$(b.data("helper").droppableElement).data("queryItem"),b.css({width:""}).removeClass("nlui-dragged-queryitem"),d=b.data("template"),"audience"===d.type?a._displayAudiencePicker(c):"queryFilter"===d.type&&d.formType&&"none"!==d.formType?(a._preventReset=!0,d.dialogTitle=xtk_core.qe_create_filter_title(),a._options.onFilterEdit(d,function(b){var e=a._genCtxId();a._updateCtx(e,b),a._updateCtxInConditions(e,d.condition),a._appendItem(c,d)})):a._appendItem(c,d)}}),this},_appendItem:function(a,b){var c,d,e,f,g,h,i,j,k,l;return c=this,a&&("queryGroup"!==a.getItemType()||a.isSpecialItem()?(e=this.addQueryItem("group",{queryGroup:a.getQueryGroup(),position:a.getIndex()||0}),this.moveItem(a,e,void 0,!0)):e=a),!a&&this._queryItems.length>0&&(f=this._queryItems[0],"queryGroup"!==f.getItemType()||f.isSpecialItem()||"AND"!==f.getOperator().value||(h="OR"),e=this.addQueryItem("group",{operator:h}),this.moveItem(f,e,void 0,!0)),"queryFilter"===b.type||"audience"===b.type||"audienceStatic"===b.type?(i=b.condition||b.where,j=i.condition,1===j.length&&j[0].condition&&j[0].condition.length>0&&(l=j[0],j=l.condition),c._parseCondition(j,e,{entityType:b.type,entityName:b.name,entityLabel:b.label||b.name,entityHumanCond:i.displayFilter,filterName:"none"!==b.formType?i.filterName:void 0,parentParams:l},!0),c._callbacks.onAdd.call(c)):(k=b||{},"expression"===b.type&&(k.entityType=b.type),g={expr:"",type:b.type,params:k},!a&&c._queryItems.length>0?(d=c.addQueryItem("item",g),c.moveItem(d,e,void 0,!0)):(g.queryGroup=e,d=c.addQueryItem("item",g)),d.showExprEdition(b.type,!0,b)),this},_displayAudiencePicker:function(a,b){var c,d,e,f,g,h,i,j,k,l,m;return c=this,l=c._rootURL+"/audienceBase",b&&(m=new SO.Selection({selectionMode:"mono",items:[{name:b.getParam("entityName")}]})),d=this._controller.getValue(this._jpath.replace("/where","")),f=this.getResourceURL(),f&&(g=f.split("/"),e=g[g.length-1]),k=new NL.DataSource.Rest({url:l,filterNames:["byText","byFilteringResource"]}),this._metaChild.get(l+"/metadata",function(d){h={audiences:{type:"list",params:{metaDataUrl:l+"/metadata",confId:c._options.confId+"_audiences",actions:{search:{enable:!0,wildcard:"text"},global:{count:!0,columnConf:!0}},renderingMethods:{grid:{family:"grid",label:xtk_core.list_layout_grid(),icon:"coral-viewGrid",columns:[{name:"title",label:d.title.label}]}},defaultRendering:"grid"},elements:d,keys:["name"],dataSource:k}},i=new SO.MVC.Controller({model:{audiences:[]},metamodel:h}),i.addFilter("audiences",{wildcard:"filteringResource",value:c._options.compatibleResource}),i.addSort("audiences",{expr:"title",desc:!1,id:"audiencesSort"}),j=new SO.Widgets.ItemPicker($("<div></div>"),{value:m,params:{dialogHelp:xtk_core.qe_audience_picker_help(),autoOpen:!0,sourcePath:"audiences",controller:i,dialogTitle:xtk_core.qe_audience_picker_title()},onInternalChange:function(d){new NL.DataSource.Rest({url:c._rootURL+"/audience/"+d.getItem().PKey}).get(0,void 0,{onSuccess:function(d){var e,f,g,h,i,j;if(e=d.where,"list"===d.type)g="byStaticAudience",f=c._filters[g],e=f.condition,h="audienceStatic",i=d.label,j=b?c._getCtxIdFromCondition(b.getCondition()):c._genCtxId(),c._updateCtx(j,"<audience>"+d.PKey+"</audience>"),c._updateCtxInConditions(j,e);else if(h="audience",i=xtk_core.qe_audiences_block_label(d.label),0===e.condition.length)return new SO.Widgets.MessageBox($("<div></div>"),{type:"warning",message:xtk_core.qe_audience_create_warning()}),void 0;b?(b.setParam("entityName",d.name).setParam("entityLabel",d.label).refreshSpecialItemLabel(),c._callbacks.onChange.call(c)):e.condition.length>0&&c._appendItem(a,{type:h,label:i,condition:e,name:d.name})}})}})}),this},_getCtxIdFromCondition:function(a){var b,c,d,e;if(a.expr&&(d=a.expr.match(/(ctxid_[0-9]+)/i))&&(c=d[1]),e=a.length>0?a:a.condition,!c&&e)for(b=0;e.length>b&&!(c=this._getCtxIdFromCondition(e[b]));b+=1);return c},_genCtxId:function(){var a="ctxid_"+SO.Utils.sequence().nextVal().replace("seq","")+Math.floor(1e3*Math.random()+1);return this._ctx&&this._ctx.querySelector(a)&&(a=this._genCtxId()),a},_updateCtx:function(a,b){var c,d,e,f,g;if(d=document.implementation.createDocument("","",null),this._ctx||(this._ctx=d.createElement("ctx")),f=this._ctx.querySelector(a),f||(f=d.createElement(a),this._ctx.appendChild(f)),f.innerHTML="",e=(new DOMParser).parseFromString(b,"text/xml").firstChild,"ctx"===e.tagName){for(c=0;e.attributes.length>c;c+=1)g=e.attributes[c],f.setAttribute(g.name,g.value);for(c=0;e.childNodes.length>c;c+=1)f.appendChild(e.childNodes[c].cloneNode(!0))}else f.appendChild(e);return this},_updateCtxInConditions:function(a,b){var c;if(b.expr&&(b.expr=b.expr.replace(/__FILTER_CTX__/gi,a)),b.enabledIf&&(b.enabledIf=b.enabledIf.replace(/__FILTER_CTX__/gi,a)),b.condition&&b.condition.length>0)for(c=0;b.condition.length>c;c+=1)this._updateCtxInConditions(a,b.condition[c]);return this},_getCtxTitleFromId:function(a){var b,c,d,e,f,g;if(this._ctx&&(d=this._ctx.querySelector(a))){if(d.childNodes&&d.childNodes.length>0)for(b=0;d.childNodes.length>b;b+=1)if(g=d.childNodes[b],g.attributes)for(c=0;g.attributes.length>c;c+=1)if(e=g.attributes[c],"title"===e.name){f=e.value;break}for(b=0;d.attributes.length>b;b+=1)if(e=d.attributes[b],"title"===e.name){f=e.value;break}}return f},_getCtx:function(){return this._ctx?(new XMLSerializer).serializeToString(this._ctx):""},_getCtxById:function(a){var b,c;return c="",b=this._ctx.querySelector(a),b&&(c=(new XMLSerializer).serializeToString(b)),c},_setCtx:function(a){return this._ctx=a?(new DOMParser).parseFromString(a,"text/xml").firstChild:void 0,this},_updateCtxAudience:function(a){var b,c,d;return this._ctx?b=(new DOMParser).parseFromString(this._ctx,"text/xml").firstChild:(c=document.implementation.createDocument("","",null),b=c.createElement("ctx"),c.appendChild(b)),(d=b.querySelector("audience"))&&b.removeChild(d),b.appendChild(a),this._ctx=(new XMLSerializer).serializeToString(b),this},_buildActionBar:function(){var a=this._$actionBarContainer=$("<nav></nav>");return this._grayBar=new SO.Widgets.GrayBar(a),this.$el.append(a),this},_buildWorkSpace:function(){return this._$workSpace=$('<div class="nlui-queryeditor-workspace"></div>'),this._dropAreas.addAreas(this._$workSpace[0]),this.$el.append(this._$workSpace),this},addQueryItem:function(a,b){var c;return b=SO.Utils.extend({queryEditor:this},b),c="group"===a||"queryGroup"===a?new SO.Widgets.QueryGroup($("<div></div>"),b):new SO.Widgets.QueryBlock($("<div></div>"),b),b.queryGroup?b.queryGroup.addItem(c,b.position):(this._$workSpace.append(c.$el),this._queryItems.push(c)),this.$el.removeClass("nlui-queryeditor-empty"),c},_dropSpecialItem:function(a,b,c){return a.condition.length>0&&(this._parseCondition(a.condition,b,c),this._callbacks.onAdd.call(this)),this},_buildActions:function(){var a=this;return this._actionBar=new SO.Widgets.cmdBar($("<div></div"),{iconSize:24,commands:["delete","duplicate"],commandConfigs:{"delete":{mode:"transparent",icon:"coral-delete",help:xtk_core.qe_remove_selection(),command:function(){a.removeSelection()}},duplicate:{mode:"transparent",icon:"coral-copy",help:xtk_core.qe_duplicate_selection(),command:function(){a.duplicateItems(a._selection)}}}}),this._options.actionsContainer?this._options.actionsContainer.append(this._actionBar.$el):(this._buildActionBar(),this._grayBar.addActionBarContent("globalActions",this._actionBar.$el),this._checkViewButtons()),this},_getViewUrl:function(a){var b,c=this._controller.getDataSource(this._jpath+"/"+a);return b=c?c.getURL():""},_checkViewButtons:function(){var a,b;return a=this._getViewUrl("count"),b=this._getViewUrl("preview"),!this._countElement&&a?this._createCountButton():this._countElement&&!a&&($(this._countElement).remove(),this._countElement=null),!this._previewElement&&b?this._createPreviewButton():this._previewElement&&!b&&($(this._previewElement).remove(),this._previewElement=null),this},onJpathNotify:function(){this._checkViewButtons()},_createCountButton:function(){var a,b;return a=this,b=new SO.Widgets.SimpleButton(document.createElement("div"),{mode:"transparent",icon:"coral-refresh",tooltip:xtk_core.qe_count_label()}),b.el.classList.add("nlui-queryeditor-count-icon"),this._countElement=document.createElement("div"),this._countElement.classList.add("nlui-queryeditor-count"),this._countResult=document.createElement("div"),this._countResult.classList.add("nlui-queryeditor-count-text"),this._resetCount(),this._countElement.appendChild(this._countResult),this._countElement.appendChild(b.el),this._grayBar.addActionBarContent("viewConfig",this._countElement),SO.Event.bind(this._countElement,"vclick",function(){a._options.beforeAction.call(a,function(){a._showLoading(),a._currentRestRequest=new NL.DataSource.Rest({url:a._getViewUrl("count"),returnRaw:!1}),a._currentRestRequest.get(0,void 0,{onSuccess:function(b){a._countElement.classList.remove("nlui-queryeditor-count-error"),a._countResult.textContent=SO.Format.formatValue(b,"rounded")},onComplete:function(){a._hideLoading()},onError:function(b){a.setError(b.message)}})})}),this},_createPreviewButton:function(){var a,b;return a=this,b=new SO.Widgets.SimpleButton(document.createElement("div"),{icon:"coral-viewOn",iconSize:24,mode:"transparent",tooltip:xtk_core.qe_preview_label()}),this._previewElement=document.createElement("div"),this._previewElement.classList.add("nlui-queryeditor-preview"),this._previewElement.appendChild(b.el),this._grayBar.addActionBarContent("viewConfig",this._previewElement),SO.Event.bind(this._previewElement,"vclick",function(){a._options.beforeAction.call(a,function(){a._displayPreviewList()})}),this},_displayPreviewList:function(){var a=this;return this.findMetaData("",function(b){var c,d,e,f;f=b.meta.title?"title":"PKey",c=new SO.Widgets.GrayBar($("<div></div>")),e=new SO.Widgets.Dialog($('<div class="nlui-queryeditor-previewlist"></div>'),{mode:"maximize",title:xtk_core.qe_preview_label(),dialogClass:"nlui-queryeditor-preview-dialog",closeButton:!0,destroyOnClose:!0,padding:!1,content:[c.$el],modal:!0}),d=new SO.Widgets.List($("<div></div>"),{confId:a._options.confId+"_preview",fitToParentHeight:!0,metaDataUrl:a.getResourceURL(),jpath:a._jpath+"/preview",renderingMethods:{grid:{family:"grid",label:xtk_core.list_layout_grid(),icon:"coral-viewList",columns:[{name:f,label:b.meta[f].label}]}},actions:{global:{count:!0,placeholder:c.getActionBar("viewConfig")}},controller:a._controller}),e.addContent(d.$el)}),this},setError:function(a){var b=SO.IMG.genIcon("coral-alert",18);b.el.classList.add("nlui-queryeditor-icon-error"),this._countResult?(this._countResult.textContent="",this._countResult.appendChild(b.el),this._countElement.classList.add("nlui-queryeditor-count-error")):this._grayBar.addActionBarContent("viewConfig",b.el);var c=new SO.Widgets.Tooltip($(b.el),{title:xtk_core.grid_listError(),gravity:"n",mode:"error"});return SO.Event.bind(b.el,"vclick",function(){c.hide(),$("<div></div>").soMessageBox({type:"error",message:a})}),this},_resetCount:function(){return this._countResult&&(this._countResult.textContent=""),this},_updateActions:function(){return 0===this._selection.length&&this._actionBar?this._actionBar.setCommandAttribute("delete","disabled",!0).setCommandAttribute("duplicate","disabled",!0).setCommandAttribute("delete","hidden",!0).setCommandAttribute("duplicate","hidden",!0):this._actionBar&&this._actionBar.setCommandAttribute("delete","disabled",!1).setCommandAttribute("duplicate","disabled",!1).setCommandAttribute("delete","hidden",!1).setCommandAttribute("duplicate","hidden",!1),this},removeSelection:function(){var a,b;return b=this,a=new SO.Widgets.MessageBox($("<div></div>"),{type:"confirm",title:xtk_core.qe_messagebox_delete_title(),message:xtk_core.qe_messagebox_delete_text(),confirmButtonLabel:xtk_core.qe_messagebox_button_delete(),onConfirm:function(){var a,c,d,e;for(d=b._selection.slice(),c=d.length,a=0;c>a;a+=1)e=d[a],b._callbacks.onRemove.call(b,e),e.remove();b._checkEmpty()}}),this},duplicateItems:function(a,b){var c,d,e,f,g,h,i,j,k;for(e=a.slice(),d=e.length,c=0;d>c;c+=1)f=e[c],g=f.getItemType(),i=[],k=b||f.getQueryGroup(),k||(k=this.addQueryItem("group"),this.moveItem(f,k)),h={queryGroup:k,params:f.getParams()},"queryGroup"===g?(h=SO.Utils.extend(h,{operator:f.getOperator().value}),i=f.getItems()):h=SO.Utils.extend(h,{expr:f.getExpression(),label:f.getLabel()}),j=this.addQueryItem(g,h),i.length>0&&this.duplicateItems(i,j);return this._callbacks.onDuplicate.call(this),this},cleanSelection:function(){var a,b,c;for(c=this._selection.slice(),b=c.length,a=0;b>a;a+=1)c[a].unselect();return this},_checkEmpty:function(){var a;return a=this.$el,0===this._queryItems.length?a.addClass("nlui-queryeditor-empty"):a.removeClass("nlui-queryeditor-empty"),this},moveItem:function(a,b,c,d){var e,f,g,h;if(g=!1,h=a.getQueryGroup(),h!==b){if(b instanceof SO.Widgets.QueryGroup)b.addItem(a,c),b.setDirty(),b.getOperator().value===this.groupOperators[2].value&&(g=!0);else if(a._options.queryGroup=null,this._$workSpace.append(a.$el),this._queryItems.push(a),h)for(f=h._queryItems.length,e=0;f>e;e+=1)if(h._queryItems[e]===a){h._queryItems.splice(e,1);break}g||a._removeExceptSeparator(),h&&0===h._queryItems.length?h.remove():h&&1===h._queryItems.length&&this.moveItem(h._queryItems[0],h.getQueryGroup(),h.getIndex(),!0),d||this._callbacks.onMove.call(this,a,b)}return this},getItems:function(){return this._queryItems},getResourceURL:function(){return this._options.resourceURL},getCompatibleResource:function(){return this._options.compatibleResource},getDescription:function(){var a,b,c,d,e;for(d=[],a=0,b=this._queryItems.length;b>a;a+=1)c=this._queryItems[a],e=c.isSpecialItem()?c.getSpecialItemLabel():c.getLabel?c.getLabel():void 0,d.push(e||c.getHumanCond());return d.join(" ")},setResourceURL:function(a){return this._options.resourceURL=a?a.replace(/\/$/,""):a,this.reset(!0),this},setCompatibleResource:function(a){return this._options.compatibleResource=a,this},reset:function(a){if(this._preventReset)this._preventReset=!1;else{for(;this._queryItems.length>0;)this._queryItems[0].remove();this._loading=null,this._checkEmpty(),this.$el.empty(),this._palette&&this._palette.destroy(),this.getResourceURL()&&this.resetMeta(a)}return this},resetMeta:function(a){var b=this;return this._metaDataMap={},this._paletteCategories={},this._currentLoading=[],this._countElement=void 0,this._previewElement=void 0,this._isPopulate=void 0,this._options.palette.$container&&this.isEditable()&&this._buildPalette(),this._buildActions(),this._palette&&this._addToLoader(["meta","paletteFilter","paletteFields"]),this.findMetaData("",function(){b._removeFromLoader("meta"),a&&b._refreshCollection()}),this},destroy:function(){return this._palette.destroy(),this.$el.remove(),this}}),SO.Widgets.QueryEditor._cacheTypeLabel="cache";
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("QueryItem",{DEFAULT_OPTIONS:{queryGroup:null,queryEditor:null,onSelection:null,params:void 0},_create:function(){this._$exceptSeparator=null,this._resultBlockWidth=130,this._clearResult="?",this._isDirty=!1,this._isError=!1,this._refreshButton=null,this._itemType=null,this._queryEditor=this._options.queryEditor},_render:function(){var a,b,c;return a=this,b=this.$el,c=this.getParams(),b.data("queryItem",this).addClass("nlui-queryitem"),this._queryEditor.isEditable()&&(SO.Event.bind(b,"vclick",function(b){a.toggleSelection(),b.originalEvent.stopPropagation()}),this._queryEditor._dropAreas.addAreas(b[0]),SO.Event.bind(b,"vmousedown",function(){a._queryEditor._openedPopover&&a._queryEditor._openedPopover.hide()}),SO.Event.bind(b,"vdrag",{onStart:function(b){var c,d;c=$(b.element),d=$(b.cloneElement),a._queryEditor.cleanSelection(),d.removeClass("nlui-queryitem-selected"),c.css("min-width",d.width()+"px")},onDrop:function(b){var c,d,e,f,g;c=$(b.droppableElement).data("queryItem"),e=c?c.getQueryGroup():null,!c&&a._queryEditor._queryItems.length>0?(f=a._queryEditor._queryItems[0],f!==a&&("queryGroup"!==f.getItemType()||f.isSpecialItem()||"AND"!==f.getOperator().value||(g="OR"),d=a._queryEditor.addQueryItem("group",{operator:g}),a._queryEditor.moveItem(f,d,void 0,!0),a!==d&&a._queryEditor.moveItem(a,d))):c!==a.getQueryGroup()&&c!==a&&(e!==a.getQueryGroup()||e&&e.getItems().length>2||"queryGroup"===c.getItemType())&&(c&&"queryGroup"===c.getItemType()&&!c.isSpecialItem()?d=c:c&&(d=a._queryEditor.addQueryItem("group",{queryGroup:c.getQueryGroup(),position:c.getIndex()||0}),a._queryEditor.moveItem(c,d,void 0,!0)),a._queryEditor.moveItem(a,d)),$(b.element).css("min-width","0")}},{dragClass:"nlui-dragged-queryitem",droppable:this._queryEditor._dropAreas,appendToBody:!0,clone:!0,dragStartDuration:150})),this.isSpecialItem()&&(this.createCache(),this.refreshSpecialItemLabel()),this},refreshCacheLabel:function(a){return this._cacheLabel.textContent=a||this.getParam("entityLabel"),this},refreshSpecialItemLabel:function(){return this.refreshCacheLabel(this.getSpecialItemLabel()),this},getSpecialItemLabel:function(){var a,b,c,d;return a="","audienceStatic"===this.getParam("entityType")?a=xtk_core.qe_specialitem_label(xtk_core.qe_palette_basic_audience(),this.getParam("entityLabel")):(b=this._queryEditor._getCtxIdFromCondition(this.getCondition()),!b&&(d=this.getParam("condition"))&&(b=this._queryEditor._getCtxIdFromCondition(d)),b&&(c=this._queryEditor._getCtxTitleFromId(b))&&(a=xtk_core.qe_specialitem_label(this.getParam("entityLabel"),c))),a||this.getParam("entityLabel")},createCache:function(){var a,b,c,d,e,f,g,h;return a=this,d=this.getParam("entityType"),e=this.getParam("entityName"),h=SO.IMG.genIcon(a._queryEditor._itemsIcons[d],24),h.el.classList.add("nlui-queryitem-icon"),this._cacheItem=document.createElement("div"),this._cacheItem.classList.add("nlui-queryitem-cache"),this._cacheLabel=document.createElement("span"),this._cacheLabel.textContent=this.getParam("entityLabel"),f=this._queryEditor._filters[e],this._cacheItem.appendChild(h.el),this._cacheItem.appendChild(this._cacheLabel),this.el.classList.add("nlui-queryitem-hascache"),this.el.appendChild(this._cacheItem),(b=this.getParam("entityHumanCond"))&&(c="queryFilter"===d?xtk_core.qe_filter_label()+" ":"audience"===d?xtk_core.qe_audience_label()+" ":"",c+=b,new SO.Widgets.Tooltip($(this._cacheLabel),{title:c})),("queryFilter"===d&&f&&"none"!==f.formType||"audienceStatic"===d)&&(g=new SO.Widgets.SimpleButton($('<div class="nlui-queryblock-button-edit"></div>'),{icon:"coral-edit",mode:"transparent",iconSize:18,onClick:function(){var b,c;switch(d){case"queryFilter":a._queryEditor._preventReset=!0,c=a._queryEditor._getCtxIdFromCondition(a.getCondition()),b=SO.Utils.extend({name:e,type:d,dialogTitle:xtk_core.qe_edit_filter_title(),currentCtx:a._queryEditor._getCtxById(c)},f),a._queryEditor.getOption("onFilterEdit")(b,function(b){a._queryEditor._updateCtx(c,b),a._queryEditor._callbacks.onChange.call(a._queryEditor),a.refreshSpecialItemLabel()});break;case"audienceStatic":a._queryEditor._displayAudiencePicker(void 0,a);break;case"audience":a._hideCache()}}}),this._cacheItem.appendChild(g.el)),this},_hideCache:function(){this.el.classList.remove("nlui-queryitem-hascache"),this._cacheItem.style.display="none"},_createExceptSeparator:function(){var a,b;return a=this.getQueryGroup(),b=this._options.queryEditor,a&&(this._$exceptSeparator=$('<div class="nlui-querygroup-except-separator nlui-text-bright">'+b.groupOperators[2].label+"</div>"),this.$el.before(this._$exceptSeparator)),this},_removeExceptSeparator:function(){return this._$exceptSeparator&&(this._$exceptSeparator.remove(),this._$exceptSeparator=null),this},setParam:function(a,b){return this._options.params[a]=b,this},getParams:function(){return this._options.params||{}},getParam:function(a){return this.getParams()[a]},getDepth:function(){var a,b;return b=this.getQueryGroup(),a=b?b.getDepth()+1:0},getQueryGroup:function(){return this._options.queryGroup},getIndex:function(){var a,b,c,d,e;for(d=this.getQueryGroup()||this._options.queryEditor,b=d._queryItems,c=d._queryItems.length,a=0;c>a;a+=1)if(b[a]===this){e=a;break}return e},remove:function(a){var b,c,d,e,f,g,h,i;for(d=this._options.queryEditor,c=this.getQueryGroup(),i=this.getIndex(),i=void 0===i?a:i,c?(c.getOperator().value===d.groupOperators[2].value&&0===i&&(h=c.getItems()[i+1],h._removeExceptSeparator()),c.removeItem(this)):(this._removeExceptSeparator(),this.$el.remove()),g=d._selection.length,b=0;g>b;b+=1)if(d._selection[b]===this){d._selection.splice(b,1);break}for(e=d.getItems(),f=e.length,b=0;f>b;b+=1)if(e[b]===this){d._queryItems.splice(b,1);break}return d._updateActions(),this},getItemType:function(){return this._itemType},getQueryResult:function(){var a,b,c;a=this,c=this.getQueryGroup(),this.$el.addClass("nlui-queryitem-loading"),this._refreshButton._setIcon("refresh-active","left");var d=Math.floor(3e3*Math.random()+1e3);return setTimeout(function(){b=Math.floor(100*Math.random()+1)+"K",a._$result.text(b),a._isEmpty&&(a._isEmpty=!1,a.$el.removeClass("nlui-queryitem-nocount")),a.$el.removeClass("nlui-queryitem-loading"),a.setDirty(!1),d>3e3&&a.setError(!0,"C'est ballot"),a._refreshButton._setIcon("refresh","left")},d),this},_clearQueryResult:function(){return this._isEmpty=!0,this._$result.text(this._clearResult),this.$el.addClass("nlui-queryitem-nocount"),this.setDirty(),this},setError:function(a,b){var c,d,e;return c=this,d=this.$el,a=void 0===a?!0:a,this._isError=a,a?(e=SO.IMG.genIcon("pushNotificationOutbound",18),d.addClass("nlui-queryitem-error"),this._refreshButton.disable(),this._$result.empty().append(e),SO.Event.bind(e,"vclick",function(a){new SO.Widgets.MessageBox($("<div></div>"),{type:"error",title:xtk_core.qe_messagebox_error_title(),message:xtk_core.qe_messagebox_error_text(),details:b}),a.originalEvent.stopPropagation(),c.setError(!1)._clearQueryResult()})):(d.removeClass("nlui-queryitem-error"),this._refreshButton.enable()),this},setDirty:function(a){var b,c;return this._isError||(a=void 0===a?!0:a,b=this.getQueryGroup(),c=this.$el,this._isDirty=a,a?(c.addClass("nlui-queryitem-dirty"),this._dirtyIcon||this._isEmpty||(this._dirtyIcon=SO.IMG.genIcon("pushNotificationOutbound",18).addClass("nlui-queryitem-icon-dirty"),new SO.Widgets.Tooltip(this._dirtyIcon,{title:xtk_core.qe_dirty_message()}),this._options.queryEditor._options.countable&&this._$blockContainer.append(this._dirtyIcon)),b&&b.setDirty()):(c.removeClass("nlui-queryitem-dirty"),this._dirtyIcon&&(this._dirtyIcon.remove(),this._dirtyIcon=null))),this},toggleSelection:function(){return this._isSelected?this.unselect():this.select(),this},select:function(){var a,b;return a=this._options.queryEditor,a.isEditable()&&(b=this.getQueryGroup(),this._isSelected=!0,this.$el.addClass("nlui-queryitem-selected"),a._selection.push(this),this.unselectParent(),a._updateActions(),this._options.onSelection&&this._options.onSelection.call(this),a._monoSelection&&(a._currentSelection&&a._currentSelection.unselect(),a._currentSelection=this)),this},unselectParent:function(){var a=this.getQueryGroup();return a&&(a._isSelected&&a.unselect(!1),a.unselectParent()),this},unselect:function(){var a,b,c;for(c=this._options.queryEditor,this._isSelected=!1,this.$el.removeClass("nlui-queryitem-selected"),b=c._selection.length,a=0;b>a;a+=1)if(c._selection[a]===this){c._selection.splice(a,1);break}return c._updateActions(),c._monoSelection&&c._currentSelection===this&&(c._currentSelection=null),this},_resizeResultContainer:function(){var a,b,c,d;if(this._options.queryEditor._options.countable){if(b=this.getDepth(),c=this._resultBlockWidth-10*b,"queryGroup"===this.getItemType()&&(c-=9,this._queryItems))for(d=this._queryItems.length,a=0;d>a;a+=1)this._queryItems[a]._resizeResultContainer();this._$blockContainer&&this._$blockContainer.css("width","calc(100% - "+c+"px)"),this._$resultContainer&&this._$resultContainer.css("width",c+"px"),this._oldDepth=b}return this},_generateRefreshButton:function(){var a=this;return this._refreshButton=new SO.Widgets.SimpleButton($('<div class="nlui-queryitem-button-refresh"></div>'),{icon:"refresh",mode:"transparent",iconSize:18,onClick:function(){a.getQueryResult()}}),this._refreshButton},isSpecialItem:function(){var a=this.getParam("entityType");return"queryFilter"===a||"audience"===a||"audienceStatic"===a},destroy:function(){return this}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("QueryBlock","QueryItem",{DEFAULT_OPTIONS:{label:"",icon:null,expr:""},_create:function(){return this._super(),this._$label=null,this._$icon=null,this._$result=null,this._isSelected=!1,this.qEditor=this._options.queryEditor,this._itemType="queryBlock",this._operatorsLabels={"=":xtk_core.qe_label_operator_is(xtk_core.qe_operator_equals()).toLowerCase(),">":xtk_core.qe_label_operator_is(xtk_core.qe_operator_higher()).toLowerCase(),">=":xtk_core.qe_label_operator_is(xtk_core.qe_operator_higher_inclusive()).toLowerCase(),"<":xtk_core.qe_label_operator_is(xtk_core.qe_operator_lower()).toLowerCase(),"<=":xtk_core.qe_label_operator_is(xtk_core.qe_operator_lower_inclusive()).toLowerCase(),"!=":xtk_core.qe_label_operator_is(xtk_core.qe_operator_different()).toLowerCase(),"IS NULL":xtk_core.qe_operator_empty().toLowerCase(),"IS NOT NULL":xtk_core.qe_operator_notempty().toLowerCase(),AND:xtk_core.qe_operator_and().toLowerCase(),OR:xtk_core.qe_operator_or().toLowerCase()},this._dateOperatorsLabels=SO.Utils.extend({},this._operatorsLabels,{">":xtk_core.qe_label_operator_is(xtk_core.qe_operator_date_higher()).toLowerCase(),">=":xtk_core.qe_label_operator_is(xtk_core.qe_operator_date_higher_inclusive()).toLowerCase(),"<":xtk_core.qe_label_operator_is(xtk_core.qe_operator_date_lower()).toLowerCase(),"<=":xtk_core.qe_label_operator_is(xtk_core.qe_operator_date_lower_inclusive()).toLowerCase()}),this._operatorsValues={"=":"equals",">":"higher",">=":"higher-inclusive","<":"lower","<=":"lower-inclusive","!=":"different",empty:"IS NULL",notempty:"IS NOT NULL"},this._render(),this},_render:function(){var a,b;return this._super(),a=this,b=this.$el,b.addClass("nlui-queryblock"),this.setLabel(this._options.label),this.qEditor._options.countable&&(this._createResultContainer(),this._resizeResultContainer()),this},_createResultContainer:function(){return this._$result=$('<span class="nlui-queryitem-result-label nlui-text-large"></span>'),this._$resultContainer=$('<div class="nlui-queryitem-result-container"></div>').append(this._$result,this._generateRefreshButton().$el),this.$el.append(this._$resultContainer),this._clearQueryResult(),this},setLabel:function(a){var b,c,d,e;return c=this,this._options.label=a,this._$label||(e=this.getParam("entityType")||"field",d=SO.IMG.genIcon(c._queryEditor._itemsIcons[e],24),d.el.classList.add("nlui-queryitem-icon"),this._$label=$('<span class="nlui-queryblock-label"></span>'),this._$blockContainer=$('<div class="nlui-queryblock-label-container"></div>').append(d.el,this._$label),this.qEditor.isEditable()&&(b=new SO.Widgets.SimpleButton($('<div class="nlui-queryblock-button-edit"></div>'),{icon:"coral-edit",mode:"transparent",iconSize:18,onClick:function(){c.showExprEdition()}}),this._$blockContainer.append(b.$el)),this.$el.append(this._$blockContainer)),this._refreshDisplay(),this},_refreshDisplay:function(){var a=this;return a._setExpressionDirty(!0),this.getExpressionInfo(function(b){var c;a._options.label?(c=a._options.label,new SO.Widgets.Tooltip(a._$label,{title:b.humanCond})):c="expression"===a.getParam("entityType")?a.getExpression():b.humanCond,a._$label.text(c)}),this},getLabel:function(){return this.isSpecialItem()?this.getParam("entityLabel"):this._options.label},getExpression:function(){return this._options.expr},setExpression:function(a,b){var c=this;return this._options.expr=a,this.getExpressionInfo(function(){b?c.qEditor._callbacks.onAdd.call(c.qEditor,c):c.qEditor._callbacks.onChange.call(c.qEditor)}),this},showExprEdition:function(a,b,c){var d=this;if("expression"===this.getParam("entityType")&&(a="expression"),a)switch(a){case"field":this._buildFieldsDialog(b,c);break;default:case"expression":this._buildExpressionDialog(b,c)}else this.getExpressionInfo(function(a){a.isGeneric?d._buildExpressionDialog(b,a):d._buildFieldsDialog(b,a)});return this},_parseExpression:function(a,b){var c,d;return c=this,d="date"===b?this._dateOperatorsLabels:this._operatorsLabels,SO.Utils.each(d,function(b,d){b===c._operatorsValues.empty||b===c._operatorsValues.notempty?a=a.replace(new RegExp(b,"gi"),d):"OR"!==b&&"AND"!==b&&(a=a.replace(new RegExp("([^=><!%'])("+b+")([^=><!%'])","gi"),"$1 "+d+" $3"))}),a=a.replace(/#([0-9\/]+)#/g,"'$1'").replace(/ NOT LIKE[ '"]+%(.*?)%['"]+/gi," "+xtk_core.qe_operator_notcontains().toLowerCase()+" '$1'").replace(/ LIKE[ '"]+%(.*?)%['"]+/gi," "+xtk_core.qe_operator_contains().toLowerCase()+" '$1'").replace(/ NOT LIKE[ '"]+%(.*?)['"]+/gi," "+xtk_core.qe_operator_notends().toLowerCase()+" '$1'").replace(/ LIKE[ '"]+%(.*?)['"]+/gi," "+xtk_core.qe_operator_ends().toLowerCase()+" '$1'").replace(/ NOT LIKE[ '"]+(.*?)%['"]+/gi," "+xtk_core.qe_operator_notbegins().toLowerCase()+" '$1'").replace(/ LIKE[ '"]+(.*?)%['"]+/gi," "+xtk_core.qe_operator_begins().toLowerCase()+" '$1'").replace(/Upper\((.*?)\)/gi,"$1")},_setExpressionDirty:function(a){return this._isExpressionDirty=void 0===a?!0:a,this},getCondition:function(a){var b,c,d,e;return c=this.getParams(),b={expr:this.getExpression(),desc:this.getLabel(),entityType:c.entityType},c&&(c.dateTypeAndPrecision&&(b.dateTypeAndPrecision=c.dateTypeAndPrecision),c.internalId&&a&&(b.internalId=c.internalId),c.PKey&&a&&(b.PKey=c.PKey),c.enabledIf&&(b.enabledIf=c.enabledIf)),this.isSpecialItem()&&(b.entityLabel=c.entityLabel,b.entityName=c.entityName,b.filterName="queryFilter"===c.entityType?c.filterName:"",d=c.parentParams,d&&(e={entityType:b.entityType,entityLabel:b.entityLabel,entityName:b.entityName,filterName:b.filterName,desc:this.getParam("entityHumanCond"),condition:b,enabledIf:d.enabledIf,expr:d.expr,setOperator:d.setOperator,boolOperator:d.boolOperator},d.setOperator&&(e.setOperator=d.setOperator),d.boolOperator&&(e.boolOperator=d.boolOperator),b=[e])),b},getExpressionInfo:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(a=0;arguments.length>a;a+=1)j=arguments[a],"function"==typeof j?r=j:"string"==typeof j?d=j:"object"==typeof j&&(t=j);if(d?s=!0:(d=this.getExpression(),s=!1),t||(t=this.getParams()),o=[],!this._expressionInfo||this._isExpressionDirty||s)if(b=this,c={humanCond:d,fields:[]},e=d.match(/(\[[\w\/@]+\])|(\s|^)(@[a-z0-9]+)|(Upper\(@(.*?)\))/gi)){for(f=e.length,a=0;f>a;a+=1)m=e[a],g=m.replace(/\s|(Upper\()|\)/g,""),-1===o.indexOf(g)&&o.push(g),n=g;for(l=o.slice(),a=0;o.length>a;a+=1)m=o[a],g=m.replace(/\s|(Upper\()|\)/g,""),h=g.replace(/([\[@\]]+)|(([@\/]|)+[\w]+([\]]|)$)/gi,""),i=g.match(/(\/|)(@|)[\w]+(\]|)$/gi)[0].replace(/[\/@\[\]]/gi,""),k={fieldName:g,fieldPath:h},c.fields.push(k),void 0===c.isGeneric&&void 0!==n&&g!==n&&(c.isGeneric=!0),function(a,e){b.qEditor.findMetaData(h,function(g){var h,i,j,k,l,m,n,o,r,u,v,w,x,y,z,A,B,C,D,E,F,G,H;if(j=g?g.meta[a.fTarget]:null,a.fArray.meta=j,k=null,G=!1,j?(H=g.additionalLabel,H&&(H=H.reverse()),i=g.additionalLabel?xtk_core.qe_humancond_concat(j.label,H.join(xtk_core.qe_humancond_concat("",""))):j.label,c.humanCond=c.humanCond.replace(new RegExp(a.fName,"g"),i)):(c.isGeneric=!0,c.humanCond=b._parseExpression(c.humanCond)),!c.isGeneric)switch(c.metaType=j.type,c.metaType){case"date":var I,J,K,L,M,N,O,P;if(m="(|[ ])([=><!]+)(([\\s#]+(.*?)#)|(.*))",n=d.match(new RegExp(m,"ig")),o=[],!t||!t.dateTypeAndPrecision)break;if(N=t.dateTypeAndPrecision,O=N.type,P=N.precision||"day",I=!1,n)for(r=n.length,M="qe_date_relative_humancond",h=0;r>h;h+=1){if(y=n[h].match(new RegExp(m,"i")),q=y[6]){if(A=q,I=!0,O="relative",L=q,o.push({operator:y[2]}),c.params={},J=q.match(/DaysAgo\(([\s0-9]+)\)/i))switch(c.params.precision="day",K=J[1]){case"0":c.params["relative-day"]="current",L=xtk_core.qe_valueeditor_date_relative_current_day().toLowerCase();break;case"1":c.params["relative-day"]="last",L=xtk_core.qe_valueeditor_date_relative_last_day().toLowerCase();break;default:c.params["relative-day"]="last_x",c.params["relative-x-day"]=K,M="qe_date_relative_humancond_many",L=xtk_core.qe_valueeditor_date_x_last_days(K).toLowerCase()}else if(J=q.match(/YearAndMonth[\(\w]+\(([\s0-9]+)\)/i))switch(c.params.precision="month",K=J[1]){case"0":c.params["relative-month"]="current",M="qe_date_relative_in_humancond",L=xtk_core.qe_valueeditor_date_relative_current_month().toLowerCase();break;case"1":c.params["relative-month"]="last",M="qe_date_relative_in_humancond",L=xtk_core.qe_valueeditor_date_relative_last_month().toLowerCase();break;default:c.params["relative-month"]="last_x",c.params["relative-x-month"]=K,M="qe_date_relative_in_humancond",L=xtk_core.qe_valueeditor_date_relative_last_x_month(K).toLowerCase()}else if(J=q.match(/TruncQuarter[\(\w]+\(([\s0-9]+)\)/i))switch(c.params.precision="quarter",K=J[1]){case"0":c.params["relative-quarter"]="current",M="qe_date_relative_in_humancond",L=xtk_core.qe_valueeditor_date_relative_current_quarter().toLowerCase();break;case"1":c.params["relative-quarter"]="last",M="qe_date_relative_in_humancond",L=xtk_core.qe_valueeditor_date_relative_last_quarter().toLowerCase();break;default:c.params["relative-quarter"]="last_x",c.params["relative-x-quarter"]=K,M="qe_date_relative_in_humancond",L=xtk_core.qe_valueeditor_date_relative_last_x_quarter(K).toLowerCase()}else if(J=q.match(/TruncYear[\(\w]+\(([\s0-9]+)\)/i))switch(c.params.precision="year",K=J[1]/12){case 0:c.params["relative-year"]="current",M="qe_date_relative_in_humancond",L=xtk_core.qe_valueeditor_date_relative_current_year().toLowerCase();break;case 1:c.params["relative-year"]="last",M="qe_date_relative_in_humancond",L=xtk_core.qe_valueeditor_date_relative_last_year().toLowerCase();break;default:c.params["relative-year"]="last_x",c.params["relative-x-year"]=K,M="qe_date_relative_in_humancond",L=xtk_core.qe_valueeditor_date_relative_last_x_year(K).toLowerCase()}break}A=y[5],u=b._parseDate(A),u&&o.push({dateValue:A,operator:y[2],stringValue:SO.Format.formatValue(u,"shortDate"),value:{type:"day",month:u.getMonth(),day:u.getDay(),year:u.getYear()}})}if(w=o[0],x=o[1],1!==o.length||O?2!==o.length||w.fieldName!==x.fieldName||O||(O="range"):O="simple",y=d.match(/IS NULL|IS NOT NULL/i))switch(G=!0,c.params={mode:"simple"},y[0]){case"IS NULL":c.params.operator="empty";break;case"IS NOT NULL":c.params.operator="notempty"}else switch(O){case"relative":c.params.mode=O,c.humanCond=xtk_core[M](i,L);break;default:v=b._getDateInfo(O,P,o,i),c.params=v.params,c.humanCond=v.humanCond}break;case"timespan":y=d.match(/(|[ ])(=)(|[ ])(.*)/i),l=y[4],c.humanCond=xtk_core.qe_enum_label(i,SO.Format.formatValue(SO.TimeSpan.parse(l),"longTimeSpan")),c.params={value:l};break;case"string":if(c.params={values:[]},E=[],F=[],G=!0,D="("+xtk_core.qe_casesinsensitive_humancond()+")",/in\((.*?)\)/i.test(d)){for(y=d.match(/in\((.*)\)/i),z=y[1].split(","),B=!/Upper\(/.test(d),h=0;z.length>h;h+=1)l=z[h].replace(/Upper\((.*?)\)/gi,"$1").replace(/^['"]|['"]$/g,"").replace(/$'/g,"$1").replace(/\\('|")/g,"$1"),F.push("'"+l+"' "+(B?"":D)),c.params.values.push({_rowIndex:c.params.values.length+1,value:l,sensitive:B,operator:b._operatorsValues["="]});C=!0}else for(z=d.split("OR"),h=0;z.length>h;h+=1)y=z[h].match(/(IS NULL|IS NOT NULL|[=!]+|NOT LIKE|LIKE)(([\s]+|)Upper\(|)([ '"]+(.*)['"])?/i),B=!/Upper\(/.test(z[h]),y&&y.length>0&&(k=y[1].toLowerCase(),l=y[5],l&&(l=l.replace(/\\('|")/g,"$1")),p="'"+l+"' "+(B?"":D),F.push(p),/is null|is not null/.test(k)?E.push(b._operatorsLabels[k.toUpperCase()]):E.push(k+" "+p),"like"===k?(/%[\w\W]+%/.test(l)?k="contains":/%[\w\W]+/.test(l)?k="ends":/[\w\W]+%/.test(l)&&(k="begins"),l=l.replace(/%/g,"")):"not like"===k?(/%[\w\W]+%/.test(l)?k="notcontains":/%[\w\W]+/.test(l)?k="notends":/[\w\W]+%/.test(l)&&(k="notbegins"),l=l.replace(/%/g,"")):k="is null"===k?"empty":"is not null"===k?"notempty":b._operatorsValues[k],C="equals"===k&&C!==!1?!0:!1,c.params.values.push({_rowIndex:c.params.values.length+1,value:l,sensitive:B,operator:k}));c.humanCond=C?xtk_core.qe_enum_label(i,F.join(" "+b._operatorsLabels.OR+" ")):i+" "+E.join(" "+b._operatorsLabels.OR+" ");break;case"integer":for(z=d.split("OR"),E=[],F=[],c.params={values:[]},h=0;z.length>h;h+=1)y=z[h].match(/(|[ ])([=!><]+)(|[ ])([\d]+)/i),y&&y.length>0&&(k=y[2].toLowerCase(),l=parseInt(y[4],10),C="="===k&&C!==!1?!0:!1,E.push(k+" "+l),F.push(l),k=b._operatorsValues[k],c.params.values.push({_rowIndex:c.params.values.length+1,value:l,operator:k}));C?c.humanCond=xtk_core.qe_enum_label(i,F.join(" "+b._operatorsLabels.OR+" ")):(G=!0,c.humanCond=i+" "+E.join(" "+b._operatorsLabels.OR+" "));break;case"boolean":y=d.match(/(.*?)(true|false|1|0)/i),l=y[2];var Q=NL.XTK.parseBoolean(l,!1);c.params={value:Q},c.humanCond=Q?i:xtk_core.qe_boolean_humancond(i);break;case"enumeration":if(y=d.match(/[\w]+/gi),c.params={value:[]},y){for(f=y.length,z=[],h=0;f>h;h+=1)l=y[h],c.params.value.push(l),SO.Utils.each(j.values,function(a,b){return b.value===l?(z.push(b.label),!1):void 0});c.humanCond=xtk_core.qe_enum_label(i,z.join(" "+b._operatorsLabels.OR+" "))}c.choices=j.values;break;case"link":case"collection":y=d.match(/\$RestKey\((.*)\)/i),new NL.DataSource.Rest({url:"/head/"+j.resTarget+"/"+y[1]}).get(0,void 0,{onSuccess:function(d){c.humanCond=xtk_core.qe_enum_label(i,d.label||d.title),c.params={value:new SO.Selection({selectionMode:"mono",items:[d]})},b._execGetExprInfoCallback(a,c,G,s,e)}})}"link"!==c.metaType&&"collection"!==c.metaType&&b._execGetExprInfoCallback(a,c,G,s,e)})}({fArray:k,fName:g,fTarget:i,mElt:m,tmpArray:l},r),n=g}else{var u={humanCond:this._parseExpression(d),expression:d,isGeneric:!0};s||(this._expressionInfo=u),r(u)}else r(this._expressionInfo);return this},_execGetExprInfoCallback:function(a,b,c,d,e){return a.tmpArray.splice(a.tmpArray.indexOf(a.mElt),1),0===a.tmpArray.length&&e&&(c&&(b.humanCond=this._parseExpression(b.humanCond,b.metaType)),d||(this._expressionInfo=b,this._setExpressionDirty(!1)),e(b)),this},_parseDate:function(a){var b,c;return/\//.test(a)?c=SO.DateOnly.safeParse(a):(b=a.split("-"),c=new SO.DateOnly(b[0],b[1],b[2])),c},_getDateInfo:function(a,b,c,d){var e,f,g,h,i,j,k,l,m;switch(f=c[0]||{},g=c[1]||{},e={humanCond:"",params:{mode:a,precision:b}},b){case"month":i="longMonth";break;case"quarter":i="longQuarter";break;case"year":i="%4Y";break;default:case"day":i="shortDate"}return f.value&&(l=new SO.PartialDate({day:f.value.day,month:f.value.month,year:f.value.year,type:"day"}).format({format:i})),g.value&&(m=new SO.PartialDate({day:g.value.day,month:g.value.month,year:g.value.year,type:"day"}).format({format:i})),"simple"===a?(h="<"===f.operator&&">"===g.operator?"!=":">="===f.operator&&"<="===g.operator?"=":f.operator,e.params.operator=this._operatorsValues[h],e.params["simple-"+b]=f.value,e.humanCond=d+" "+this._dateOperatorsLabels[h]+" "+l):(j=/=/.test(f.operator),k=/=/.test(g.operator),e.params["range-"+b+"-from"]=f.value,e.params["range-"+b+"-to"]=g.value,e.params["range-"+b+"-from-inclusive"]=j,e.params["range-"+b+"-to-inclusive"]=k,e.humanCond=xtk_core.qe_date_humancond_between(d,l+(j?" ("+xtk_core.qe_valueeditor_date_inclusive()+")":""),m+(k?" ("+xtk_core.qe_valueeditor_date_inclusive()+")":""))),e},getHumanCond:function(){return this._expressionInfo.humanCond},_createEditDialog:function(a,b){var c,d;return c=this,d=this.qEditor,this._editDialog=new SO.Widgets.Dialog($('<div class="nlui-queryblock-edit-form"></div>'),{title:a.title,modal:!0,removeOnClose:!0,content:a.content,dialogClass:"nlui-qevalueeditor-dialog",width:900,height:600,padding:!1,autoOpen:!1,mode:"maximize",cancel:function(){b&&(c.remove(),d._checkEmpty())},buttons:[{preset:"cancel",mode:"quiet"},{id:"qe_edit_dialog_ok",preset:"ok",label:xtk_core.dialog_ok(),onClick:a.confirmAction,mode:"transparent"}]}),this.expressionIsDirty(!1),this._editDialog.open(),this._editDialog},_buildExpressionDialog:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;return b=this,d=this.qEditor,e=this.getLabel(),f=this.getExpression(),k={label:this.getLabel(),expression:this.getExpression()},l={label:{type:"string",labelsPosition:"above",label:xtk_core.qe_edit_block_label()},expression:{type:"exprbuilder",labelsPosition:"above",label:xtk_core.qe_edit_block_expression(),params:{fieldFilters:["query"],mode:"query",help:xtk_core.qe_edit_block_expression_help(),targetResource:d.getResourceURL()}}},m=new SO.Widgets.TextFormat($('<div class="nlui-queryblock-form-labeldesc"><div>'),{value:xtk_core.qe_rule_name_description(),params:{style:"emphasis",icon:"coral-helpCircle"}}),j='<div class="nlui-queryblock-form"><div data-nl-jpath="expression" class="nlui-queryblock-form-expr"></div><div data-nl-jpath="label" class="nlui-queryblock-form-label"></div>'+m.el.outerHTML,j+="</div>",h=new SO.MVC.Controller({model:k,metamodel:l,onValueChanged:function(){var a=g(h);b.expressionIsDirty(a),a||h.setDirty(!1)},onDirtyChanged:function(a){a&&b.expressionIsDirty(!0)}}),i=$(j).nlForm({controller:h}),c=this._createEditDialog({title:a?xtk_core.qe_create_expression_title():xtk_core.qe_edit_expression_title(),buttonLabel:a?xtk_core.qe_dialog_create_label():xtk_core.qe_dialog_save_label(),content:i,confirmAction:function(){var c=h.getValue("label");b.setParam("enabledIf",h.getValue("enabledIf")),b._options.label=h.getValue("label"),b._setExpressionDirty(!0).setExpression(h.getValue("expression"),a),c?b.setLabel(c):b._refreshDisplay()}},a),g=function(a){var b,c,d;return b=a.getValue("expression"),c=a.getValue("label"),d=b?b!==f||c!==e?!0:!1:!1},this},_getValueEditor:function(a,b,c){var d,e,f;if(e=$("<div></div>"),b=b||{},f={linked:this,dialog:c},a)switch(f.params=this._tmpEditorParams||b.params||{},f.params.label=this.getLabel(),f.params.humanCond=this.getHumanCond(),b.apiName?f.params.fieldName=this._formatFieldName(b.nodePath):b.fields&&(f.params.fieldName=b.fields[0].fieldName),a){case"date":d=new SO.Widgets.QEDateEditor(e,f);break;case"integer":d=new SO.Widgets.QENumberEditor(e,f);break;case"boolean":f.isNew=b.isNew,d=new SO.Widgets.QEBooleanEditor(e,f);break;case"enumeration":f.choices=b.choices||b.values,d=new SO.Widgets.QEEnumEditor(e,f);break;case"link":case"collection":f.list=b.list||[],f.jpath=b.jpath,f.controller=b.controller,f.dataSourceUrl=b.dataSourceUrl,d=new SO.Widgets.QELinkEditor(e,f);break;case"timespan":d=new SO.Widgets.QETimeSpanEditor(e,f);break;case"item":d=null;break;default:case"string":f.isNew=b.isNew,d=new SO.Widgets.QEStringEditor(e,f)}return d},_buildFieldsDialog:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;return c=this,g=[],l=[],d=this.qEditor,j=$('<div class="nlui-queryblock-dialog-leftcontainer"></div>'),k=$('<div class="nlui-queryblock-dialog-rightcontainer"></div>'),(!a||b&&b.fields)&&(h=b.fields[0],n=SO.Utils.extend({},h.meta,{nodePath:h.fieldPath?"/"+h.fieldPath+"/"+h.meta.apiName:""}),i=new SO.Selection({selectionMode:"mono",items:[n]})),e=this._buildResourceWalker({onSelection:function(d){var e,g;e=d.getItem(),g=c._formatFieldName(e.nodePath),c.expressionIsDirty(!1),c._currentFieldName!==g&&(c._exprInfo=e,c._currentFieldName=g,c._currentValueEditor&&c._currentValueEditor.destroy(),b.metaType=e.type,("link"===e.type||"collection"===e.type)&&(e.dataSourceUrl="/head/"+e.resTarget),e.isNew=a,c._currentValueEditor=c._getValueEditor(e.type,e,f),c._currentValueEditor&&k.append(c._currentValueEditor.$el))},selection:i}),g.push(j.append(e.$el),k),f=this._createEditDialog({height:600,title:a?xtk_core.qe_create_filter_title():xtk_core.qe_edit_filter_title(),buttonLabel:a?xtk_core.qe_dialog_create_label():xtk_core.qe_dialog_save_label(),content:g,confirmAction:function(){var d,e;return(d=c._currentValueEditor.isValid())?(e=c._currentFieldName,c._options.label=c._currentValueEditor.getLabel(),c._options.params=SO.Utils.extend(c._options.params,c._currentValueEditor.getParams()),"link"===b.metaType&&(e=e.replace(/@|^[\[]|\]$/g,"")),c._setExpressionDirty(!0).setExpression(c._formatExpr(e,c._currentValueEditor.getValue()),a),f.close(),c._refreshDisplay(),void 0):(c.expressionIsDirty(!1),!1)}},a),h&&(m=b.fields[0],("link"===b.metaType||"collection"===b.metaType)&&(b.dataSourceUrl="/head/"+m.meta.resTarget),this._currentFieldName=c._formatFieldName(n.nodePath||n.apiName),this._currentValueEditor=this._getValueEditor(b.metaType,b,f),this._currentValueEditor&&k.append(this._currentValueEditor.$el)),f.getBody().prepend($('<div class="nlui-queryblock-resourcewalker-message">'+xtk_core.qe_valueeditor_resourcewalker_info()+"</div>")),this},_formatFieldName:function(a){var b=a.replace(/[\w]+$/i,"@$&").replace(/^\//,"");return/\//.test(b)&&(b="["+b+"]"),b},expressionIsDirty:function(a){var b;return this._editDialog&&a!==this._currentDirtyValue&&(b=this._editDialog.getButton("qe_edit_dialog_ok"),a?b.soSimpleButton("setDisabled",!1):b.soSimpleButton("setDisabled",!0)),this._currentDirtyValue=a,this},_formatExpr:function(a,b){return b.replace(/\{0\}/g,a)},_buildResourceWalker:function(a){var b,c,d,e,f,g,h,i,j,k;return b=this,d=this.qEditor,c={type:"tree",elements:{PKey:{type:"string",label:"PKey"},apiName:{type:"string",label:"apiName"},desc:{type:"string",label:"desc"},help:{type:"string",label:"help"},icon:{type:"string",label:"icon"},label:{type:"string",label:"label"},lazyLoaded:{type:"boolean",label:"lazyLoaded"},length:{type:"string",label:"length"},privacy:{type:"number",label:"privacy"},readOnly:{type:"boolean",label:"readOnly"},required:{type:"boolean",label:"required"},resName:{type:"string",label:"resName"},resType:{type:"string",label:"resType"},type:{type:"string",label:"type"},nodePath:{type:"string",label:"nodePath"}},keys:["PKey","apiName"]},e={},f="queryeditor-treelist-resourcewalker",e[f]=[],g=SO.Utils.extend(!0,{},c),k=new NL.MetaDataService(void 0,{dataSourceType:"metadata"}),g.dataSource=new NL.DataSource.MetaDataService({url:d.getResourceURL()+"/metadata",metaDataService:k}),h={},h[f]=g,i=new SO.MVC.Controller({model:e,metamodel:h,statemodel:{}}),j=new SO.Widgets.Treelist($('<div class="nlui-queryblock-resourcewalker"></div>'),{controller:i,jpath:f,selectable:!0,selectionMode:"mono",fitToParentHeight:!0,onSelection:a.onSelection,selection:a.selection,renderingMethods:{defaultTreeRender:{family:"treeNode",renderer:NL.RenderFunctions.defaultTree,icon:"",label:xtk_core.treeList_hide_advanced_fields_help}},defaultRendering:"defaultTreeRender"})}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("QueryGroup","QueryItem",{DEFAULT_OPTIONS:{operator:"AND"},_create:function(){return this._super(),this._operatorButton=null,this._queryItems=[],this._popoverButtons={},this._itemType="queryGroup",this._render(),this},_render:function(){var a=this.$el;return this._super(),a.addClass("nlui-querygroup"),this._options.queryEditor._options.countable&&this._createResultContainer(),null!==this._options.operator&&this.setOperator(this._options.operator,!0),this},_createOperatorButton:function(){var a,b,c,d,e,f,g,h,i,j;if(b=this,e=$("<ul></ul>"),i=this._options.queryEditor,h=i.groupOperators,d=h.length,g=this.getOperator(),this._operatorButton=document.createElement("div"),this._operatorButton.classList.add("nlui-querygroup-operator"),this._operatorText=document.createElement("span"),this._operatorButton.appendChild(this._operatorText),i.isEditable()){for(j=SO.IMG.genIcon("arrow-down-white",12),j.addClass("nlui-querygroup-operator-icon"),this._operatorButton.appendChild(j[0]),a=0;d>a;a+=1)c=h[a],function(a){b._popoverButtons[a.value]=new SO.Widgets.Button($("<li class='nlui-popover-menu-item'></li>"),{mode:"popover",label:a.label,onClick:function(){e.prepend(b._popoverButtons[b.getOperator().value].$el),b.setOperator(a.value),f.hide()}})}(c),e.append(b._popoverButtons[c.value].$el);f=new SO.Widgets.popover(this._operatorButton,{params:{classNames:"nlui-popover-menu nlui-queryeditor-popover",gravity:"s",displayOn:"click",content:e,onShow:function(){i._openedPopover&&i._openedPopover!==this&&i._openedPopover.hide(),b._popoverButtons[b.getOperator().value].$el.detach(),i._openedPopover=this}}})}return this.$el.prepend(this._operatorButton),this},setOperator:function(a,b){var c,d,e,f,g,h,i,j;if(a=a||this._options.operator,a&&(a=a.toUpperCase()),this._options.operator=a,f=this.$el,h=this._options.queryEditor,j=this.getOperator(),i=h.groupOperators[2].value,this._operatorButton||this._createOperatorButton(),j.value===i){if(d=this._queryItems.length,e=this.getQueryGroup(),e&&e.getOperator().value===i)for(;this._queryItems.length>0;)g=this._queryItems[0],"queryGroup"===g.getItemType()&&g.getOperator().value===i?g.setOperator(i):this._options.queryEditor.moveItem(g,this.getQueryGroup());else for(c=0;d>c;c+=1)0!==c&&this._queryItems[c]._createExceptSeparator();f.addClass("nlui-querygroup-except"),this.el.removeChild(this._operatorButton)}else this._operatorText.textContent=j.label;return b||h._callbacks.onChange.call(h,"operator"),this.setDirty(),this},getOperator:function(){var a,b,c,d,e,f;if(b=this._options.queryEditor.groupOperators,c=b.length,f=this._options.operator,null!==f&&void 0!==f){for(a=0;c>a;a+=1)if(d=b[a],d.value===f.toUpperCase()){e=d;break}}else e=f;return e},addItems:function(a,b){var c,d;for(c=0,d=a.length;d>c;c+=1)this.addItem(a[c],b);return this},addItem:function(a,b){var c,d,e,f,g,h;for(e=a.getQueryGroup()||this._options.queryEditor,d=e._queryItems.length,f=a.$el.addClass("nlui-querygroup-item"),h=this.getOperator(),c=0;d>c;c+=1)if(e._queryItems[c]===a){e._queryItems.splice(c,1);break}return a._options.queryGroup=this,void 0!==b?(g=this._queryItems[b],g&&g.$el.before(f),this._queryItems.splice(b,0,a)):(this._queryItems.push(a),this.$el.append(f)),h&&h.value===this._options.queryEditor.groupOperators[2].value&&0!==a.getIndex()&&a._createExceptSeparator(),a._resizeResultContainer(),this},_createResultContainer:function(){return this._$result=$('<span class="nlui-queryitem-result-label nlui-text-large"></span>'),this._$blockContainer=$('<div class="nlui-querygroup-space-container"></div>'),this._$resultContainer=$('<div class="nlui-queryitem-result-container"></div>').append(this._$result,this._generateRefreshButton().$el),this.$el.append(this._$blockContainer,this._$resultContainer),this._resizeResultContainer()._clearQueryResult(),this},removeItem:function(a){var b,c,d,e,f;for(c=this._queryItems.length,e=this.getQueryGroup(),b=0;c>b;b+=1)this._queryItems[b]===a&&(this._queryItems.splice(b,1),f=b);return a._options.queryGroup=null,a.remove(f),1===this._queryItems.length&&(d=e?e:this._options.queryEditor,this._options.queryEditor.moveItem(this._queryItems[0],d,this.getIndex(),!0),this._queryItems=[]),this.setDirty(),this},select:function(){return this._super(),this._options.queryEditor._monoSelection||this.unselectChildren(),this},getItems:function(){return this._queryItems},unselectChildren:function(){var a,b,c;for(c=this._queryItems.length,a=0;c>a;a+=1)b=this._queryItems[a],b._isSelected&&b.unselect(),b._queryItems&&b.unselectChildren();return this},getCondition:function(a){var b,c,d,e,f,g,h,i,j,k;for(e=[],f=this.getOperator().value,i=this.getParams(),j=i.parentParams||{},c=this._queryItems.length,b=0;c>b;b+=1)d=this._queryItems[b],h=d.getParams(),g={desc:"",entityType:h.entityType},d.isSpecialItem()&&(g.entityLabel=h.entityLabel,g.entityName=h.entityName,g.filterName="queryFilter"===h.entityType?h.filterName:"",g.desc=h.entityHumanCond),g.boolOperator=c-1>b?f:"AND","queryGroup"===d.getItemType()?(h.parentParams&&h.parentParams.enabledIf&&(g.enabledIf=h.parentParams.enabledIf),g.condition=d.getCondition(a)):SO.Utils.extend(g,d.getCondition(a)),h.internalId&&a&&(g.internalId=h.internalId),h.PKey&&a&&(g.PKey=h.PKey),e.push(g);return this.isSpecialItem()&&(k={entityType:i.entityType,entityLabel:i.entityLabel,entityName:i.entityName,filterName:i.filterName,condition:e,enabledIf:j.enabledIf,expr:j.expr},j.setOperator&&(k.setOperator=j.setOperator),j.boolOperator&&(k.boolOperator=j.boolOperator),e=[k]),e},getHumanCond:function(){var a,b,c,d,e,f,g;if(d=[],c=this._queryItems.length,this.isSpecialItem())f=this.getParam("entityLabel");else{for(a=0;c>a;a+=1)b=this._queryItems[a],"queryGroup"===b.getItemType()&&b.getDepth()>0&&b.isSpecialItem()?e="("+b.getHumanCond()+")":(e=b.getLabel&&(g=b.getLabel())?g:b.getHumanCond(),b.isSpecialItem()&&(e=b.getSpecialItemLabel()||e)),d.push(e);f=d.join(" "+this.getOperator().label.toLowerCase()+" ")}return f}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("QEValueEditor",{DEFAULT_OPTIONS:{linked:null,dialog:null,params:{label:""}},_create:function(){var a;return this._numberOperators=[{name:"equals",label:xtk_core.qe_operator_equals()},{name:"higher",label:xtk_core.qe_operator_higher()},{name:"higher-inclusive",label:xtk_core.qe_operator_higher_inclusive()},{name:"lower",label:xtk_core.qe_operator_lower()},{name:"lower-inclusive",label:xtk_core.qe_operator_lower_inclusive()},{name:"different",label:xtk_core.qe_operator_different()}],this._stringOperators=[{name:"equals",label:xtk_core.qe_operator_equals()},{name:"begins",label:xtk_core.qe_operator_begins()},{name:"notbegins",label:xtk_core.qe_operator_notbegins()},{name:"ends",label:xtk_core.qe_operator_ends()},{name:"notends",label:xtk_core.qe_operator_notends()},{name:"contains",label:xtk_core.qe_operator_contains()},{name:"notcontains",label:xtk_core.qe_operator_notcontains()},{name:"different",label:xtk_core.qe_operator_different()},{name:"empty",label:xtk_core.qe_operator_empty()},{name:"notempty",label:xtk_core.qe_operator_notempty()}],this._dateOperators=[{name:"equals",label:xtk_core.qe_operator_equals()},{name:"higher",label:xtk_core.qe_operator_date_higher()},{name:"higher-inclusive",label:xtk_core.qe_operator_date_higher_inclusive()},{name:"lower",label:xtk_core.qe_operator_date_lower()},{name:"lower-inclusive",label:xtk_core.qe_operator_date_lower_inclusive()},{name:"different",label:xtk_core.qe_operator_different()},{name:"empty",label:xtk_core.qe_operator_empty()},{name:"notempty",label:xtk_core.qe_operator_notempty()}],this._operatorsValues={equals:"=",higher:">","higher-inclusive":">=",lower:"<","lower-inclusive":"<=",different:"!=",empty:"IS NULL",notempty:"IS NOT NULL"},this._defaultModel={label:this._options.params.label},this._defaultMetaModel={},this._defaultFormMarkup="",this._defaultMetaModel.label={type:"string",label:xtk_core.qe_edit_block_label()},a=new SO.Widgets.TextFormat($("<div><div>"),{value:xtk_core.qe_rule_name_description(),params:{style:"emphasis",icon:"coral-helpCircle"}}),this._defaultFormMarkup+='<div data-nl-jpath="label" class="nlui-qevalueeditor-label"></div>'+a.el.outerHTML,this._defaultDisplayModel={},this._params={},this._controller=null,this._render(),this},_render:function(){var a=this;return this.$el.addClass("nlui-qevalueeditor"),this._options.dialog._$actionBar&&this._options.dialog._$actionBar.remove(),this.renderForm(),SO.assert(this._controller,"You must define a controller for each editor"),this._controller.registerOnValueChanged(function(){var b=a.isValid();a.activeDialogButton(b),b||a._controller.setDirty(!1)}),this._controller.registerOnDirtyChanged(function(b){a.activeDialogButton(b)}),this},_generateGrid:function(a){var b,c,d,e,f,g,h,i;b=this,i=1,g=$('<div class="nlui-qevalueeditor-grid-container"></div>'),this._jpath="qe-"+a.name+"-editor",h={grid:{family:"grid",columns:[]}},c=this._defaultModel,c[this._jpath]=a.values||[],d=this._defaultMetaModel,e=d[this._jpath]={type:"list",elements:{_rowIndex:{type:"integer",label:"_rowIndex",defaultValue:function(){return i+=1}}}},e.keys=["_rowIndex"],SO.Utils.each(a.elements,function(a,b){e.elements[a]={type:b.type,label:b.label,params:b.params,defaultValue:b.defaultValue},h.grid.columns.push({name:a,label:b.label,displayInput:!0,width:b.width,align:b.align}),e.keys.push(a)}),this._controller=new SO.MVC.Controller({model:c,metamodel:d,displaymodel:this._defaultDisplayModel,statemodel:{}}),this._options.dialog._$actionBar=$('<div class="nlui-qevalueeditor-actionbar"></div>'),f=new SO.Widgets.GrayBar(this._options.dialog._$actionBar),this._list=new SO.Widgets.List($("<div></div>"),{controller:this._controller,jpath:this._jpath,renderingMethods:h,defaultRendering:"grid",actions:{creation:{add:!0,placeholder:f.getActionBar("globalActions")},selection:{sort:!1,remove:!0,duplicate:!0,placeholder:f.getActionBar("localActions")}},selectable:!0,selectionMode:"multi"});var j=$('<div class="nlui-queryblock-form">'+this._defaultFormMarkup+"</div>").nlForm({labelsPosition:"above",controller:this._controller});return g.append(this._options.dialog._$actionBar,this._list.$el,j),g},_transformValue:function(a){var b=a;return this._options.linked.getParams("advanced")&&(b="$(@"+a+")"),b},activeDialogButton:function(a){return this._options.linked.expressionIsDirty(a),this},renderForm:function(){return SO.assert(!1,"renderForm function must be define for each type"),this},getLabel:function(){return this._controller.getValue("label")},getValue:function(){return SO.assert(!1,"getValue function must be define for each type"),null},isValid:function(){return SO.assert(!1,"isValid function must be define for each type"),null},getParams:function(){var a=this._controller.getValue("enabledIf");return void 0!==a&&(this._params.enabledIf=a),this._params},destroy:function(){return this.$el.remove(),this}}),SO.Widgets.define("QEStringEditor","QEValueEditor",{DEFAULT_OPTIONS:{params:{values:[{_rowIndex:1,value:"",operator:"equals",sensitive:!0}]}},renderForm:function(){var a=this;return this.$el.append(this._generateGrid({name:"string",elements:{operator:{type:"enum",label:xtk_core.qe_valueeditor_operator(),params:{items:this._stringOperators},width:190,defaultValue:"equals"},value:{type:"string",label:xtk_core.qe_valueeditor_value()},sensitive:{type:"boolean",label:xtk_core.qe_valueeditor_casesensitive(),align:"center",defaultValue:!0,width:150}},values:this._options.params.values})),this._controller.registerOnValueChanged(function(){a._refreshForm()}),a._refreshForm(),this.activeDialogButton(this._options.isNew),this},_refreshForm:function(){var a,b,c,d,e;for(b=this._controller.getValue(this._jpath),c=b.length,a=0;c>a;a+=1)d=b[a],e="empty"===d.operator||"notempty"===d.operator,this._list.disableItemByPath(this._jpath+"["+a+"]/value",e),this._list.disableItemByPath(this._jpath+"["+a+"]/sensitive",e);return this},getValue:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;for(d=this._controller.getValue(this._jpath),f=d.length,b=[],h=!0,j=[],a=0;f>a;a+=1){switch(c=d[a],i="{0}",void 0!==c.value&&(e=n=c.value.replace(/['"]+/g,"\\$&")),c.sensitive||(i="Upper("+i+")"),c.operator){case"different":g=c.sensitive?i+"!='"+e+"'":i+"!=Upper('"+e+"')";break;case"begins":g=e?c.sensitive?i+" LIKE '"+e+"%'":i+" LIKE Upper('"+e+"%')":"";break;case"notbegins":g=e?c.sensitive?i+" NOT LIKE  '"+e+"%'":i+" NOT LIKE Upper('"+e+"%')":"";break;case"ends":g=e?c.sensitive?i+" LIKE '%"+e+"'":i+" LIKE Upper('%"+e+"')":"";break;case"notends":g=e?c.sensitive?i+" NOT LIKE '%"+e+"'":i+" NOT LIKE Upper('%"+e+"')":"";break;case"contains":g=e?c.sensitive?i+" LIKE '%"+e+"%'":i+" LIKE Upper('%"+e+"%')":"";break;case"notcontains":g=e?c.sensitive?i+" NOT LIKE '%"+e+"%'":i+" NOT LIKE Upper('%"+e+"%')":"";break;case"empty":g=i+" "+this._operatorsValues.empty;break;case"notempty":g=i+" "+this._operatorsValues.notempty;break;default:case"equals":g=c.sensitive?i+"='"+e+"'":i+"=Upper('"+e+"')"}b.push(g),this._controller.check([this._jpath+"["+a+"]/value"]).valid||(h=!1),k="equals"===c.operator&&k!==!1?!0:!1,l=c.sensitive&&l!==!1?!0:!1,m=c.sensitive||m===!1?!1:!0,j.push(c.sensitive?"'"+e+"'":"Upper('"+e+"')")}return b=k&&(l||m)?(m?"Upper({0})":"{0}")+" in("+j.join(",")+")":h?b.join(" OR "):null},isValid:function(){return Boolean(this.getValue())}}),SO.Widgets.define("QENumberEditor","QEValueEditor",{DEFAULT_OPTIONS:{params:{values:[{_rowIndex:1,value:"",operator:"equals"}]}},renderForm:function(){return this.$el.append(this._generateGrid({name:"number",elements:{operator:{type:"enum",label:xtk_core.qe_valueeditor_operator(),params:{items:this._numberOperators},width:170,defaultValue:"equals"},value:{type:"number",label:xtk_core.qe_valueeditor_value(),defaultValue:"",align:"left"}},values:this._options.params.values})),this},getValue:function(){var a,b,c,d,e,f,g;for(d=this._controller.getValue(this._jpath),e=d.length,b=[],f=!0,a=0;e>a;a+=1)c=d[a],c.value||0===c.value?(g=this._operatorsValues[c.operator||"equals"],b.push("{0}"+g+c.value),this._controller.check([this._jpath+"["+a+"]/value"]).valid||(f=!1)):f=!1;return b=f?b.join(" OR "):null},isValid:function(){return Boolean(this.getValue())}}),SO.Widgets.define("QEBooleanEditor","QEValueEditor",{DEFAULT_OPTIONS:{isNew:!1,params:{value:!1}},renderForm:function(){var a,b;return a=this,this._controller=new SO.MVC.Controller({model:SO.Utils.extend({value:this._options.params.value},this._defaultModel),metamodel:SO.Utils.extend({value:{type:"radiogroup",label:xtk_core.qe_valueeditor_value(),params:{radioButtons:[{label:xtk_core.qe_boolean_true(),value:!0},{label:xtk_core.qe_boolean_false(),value:!1}]}}},this._defaultMetaModel),displaymodel:this._defaultDisplayModel}),this._currentValue=this._controller.getValue("value"),b=$('<div class="nlui-queryblock-form"><div data-nl-jpath="value"></div>'+this._defaultFormMarkup+"</div>").nlForm({labelsPosition:"above",controller:this._controller}),this.$el.append(b),this.activeDialogButton(this._options.isNew),this},getValue:function(){return"{0}="+NL.XTK.parseBoolean(this._controller.getValue("value"),!1)},isValid:function(){var a;return a=this._options.isNew?!0:void 0!==this._controller.getValue("value")}}),SO.Widgets.define("QEEnumEditor","QEValueEditor",{DEFAULT_OPTIONS:{choices:{},params:{value:null}},renderForm:function(){var a,b,c,d;return a=this,d=[],SO.Utils.each(this._options.choices,function(a,b){d.push({value:b.value,label:b.label})}),d.sort(function(a,b){return a.label>b.label?1:-1}),b=SO.Utils.extend({value:{type:"multiplechoice",label:xtk_core.qe_valueeditor_enum_values(),params:{choices:d}}},this._defaultMetaModel),this._controller=new SO.MVC.Controller({model:SO.Utils.extend({value:this._options.params.value},this._defaultModel),metamodel:b,displaymodel:this._defaultDisplayModel}),this._currentValue=this._controller.getValue("value"),c=$('<div class="nlui-queryblock-form"><div data-nl-jpath="value"></div>'+this._defaultFormMarkup+"</div>").nlForm({labelsPosition:"above",controller:this._controller}),this.$el.append(c),this},getValue:function(){var a,b,c,d,e;if(d=this._controller.getValue("value"),d&&(c=d.length)>0)for(e="{0}=",a=0;c>a;a+=1)b=d[a],e+=(a>0?" OR {0}=":"")+b;return e},isValid:function(){return this._controller.getValue("value").length>0}}),SO.Widgets.define("QEDateEditor","QEValueEditor",{DEFAULT_OPTIONS:{params:{mode:"simple",precision:"day",operator:"equals","simple-year":void 0,"simple-quarter":void 0,"simple-month":void 0,"simple-day":void 0,"range-year-from":void 0,"range-year-to":void 0,"range-year-from-inclusive":!0,"range-year-to-inclusive":!0,"range-quarter-to":void 0,"range-quarter-from":void 0,"range-quarter-to-inclusive":!0,"range-quarter-from-inclusive":!0,"range-month-to":void 0,"range-month-from":void 0,"range-month-to-inclusive":!0,"range-month-from-inclusive":!0,"range-day-to":void 0,"range-day-from":void 0,"range-day-to-inclusive":!0,"range-day-from-inclusive":!0,"relative-year":"last","relative-quarter":"last","relative-month":"last","relative-day":"last","relative-x-year":"","relative-x-quarter":"","relative-x-month":"","relative-x-day":""}},_create:function(){return this._model={},this._metamodel={},this._formStringMarkup="",this._datePrecisions=["year","quarter","month","day"],this._super(),this},_proxyFormConfig:function(a){var b,c,d,e,f;for(c=this,d=a.length,b=0;d>b;b+=1)e=a[b],this._model["simple-"+e]=this._options.params["simple-"+e],this._model["range-"+e+"-from"]=this._options.params["range-"+e+"-from"],this._model["range-"+e+"-to"]=this._options.params["range-"+e+"-to"],this._model["range-"+e+"-from-inclusive"]=this._options.params["range-"+e+"-from-inclusive"],this._model["range-"+e+"-to-inclusive"]=this._options.params["range-"+e+"-to-inclusive"],this._model["relative-"+e]=[this._options.params["relative-"+e]],this._metamodel["simple-"+e]={type:"partialDate",params:{selector:e},label:xtk_core["qe_valueeditor_date_"+e]()},this._metamodel["range-"+e+"-from"]={type:"partialDate",params:{selector:e},label:xtk_core.qe_valueeditor_date_from()},this._metamodel["range-"+e+"-to"]={type:"partialDate",params:{selector:e},label:xtk_core.qe_valueeditor_date_to()},this._metamodel["range-"+e+"-from-inclusive"]={type:"boolean",label:xtk_core.qe_valueeditor_date_inclusive()},this._metamodel["range-"+e+"-to-inclusive"]={type:"boolean",label:xtk_core.qe_valueeditor_date_inclusive()},f=this._options.params["relative-x-"+e],this._metamodel["relative-"+e]={type:"multiplechoice",params:{choices:[{label:xtk_core["qe_valueeditor_date_relative_last_"+e](),value:"last"},{label:xtk_core["qe_valueeditor_date_relative_current_"+e](),value:"current"},{label:xtk_core["qe_valueeditor_date_relative_last_x_"+e]('<input type="text" id="qe_date_relative_x_'+e+'" '+'class="nlui-input nlui-qe-relative-input" value="'+f+'"'+" />"),value:"last_x"}],type:"radio",columns:1}},this._formStringMarkup+='<div data-nl-jpath="simple-'+e+'"></div>'+'<div data-nl-jpath="range-'+e+'-from"></div>'+'<div data-nl-jpath="range-'+e+'-from-inclusive"></div>'+'<div data-nl-jpath="range-'+e+'-to"></div>'+'<div data-nl-jpath="range-'+e+'-to-inclusive"></div>'+'<div data-nl-jpath="relative-'+e+'"></div>',$("body").on("change keyup","#qe_date_relative_x_"+e,function(){c._controller.setValue("fake","-"+Math.random()+"-",!0)}).on("focus","#qe_date_relative_x_"+e,{type:e},function(a){c._controller.setValue("relative-"+a.data.type,["last_x"],!0)});return this},renderForm:function(){var a,b;return a=this,this._model=SO.Utils.extend({fake:"",mode:this._options.params.mode,precision:this._options.params.precision,operator:this._options.params.operator},this._defaultModel),this._metamodel=SO.Utils.extend({fake:{type:"string"},mode:{type:"enum",label:xtk_core.qe_valueeditor_date_type(),params:{items:[{name:"simple",label:xtk_core.qe_valueeditor_date_type_simple()},{name:"range",label:xtk_core.qe_valueeditor_date_type_range()},{name:"relative",label:xtk_core.qe_valueeditor_date_type_relative()}]}},precision:{type:"enum",label:xtk_core.qe_valueeditor_date_precision(),params:{items:[{name:"year",label:xtk_core.qe_valueeditor_date_precision_year()},{name:"quarter",label:xtk_core.qe_valueeditor_date_precision_quarter()},{name:"month",label:xtk_core.qe_valueeditor_date_precision_month()},{name:"day",label:xtk_core.qe_valueeditor_date_precision_day()}]}},operator:{type:"enum",label:xtk_core.qe_valueeditor_operator(),params:{items:this._dateOperators}}},this._defaultMetaModel),this._formStringMarkup='<div data-nl-jpath="mode"></div><div data-nl-jpath="precision"></div><div data-nl-jpath="operator"></div>',this._proxyFormConfig(["year","quarter","month","day"]),this._controller=new SO.MVC.Controller({model:this._model,metamodel:this._metamodel,displaymodel:this._defaultDisplayModel,onValueChanged:function(b){a._preventError="mode"===b||"precision"===b||"operator"===b?!0:!1,a._params={dateTypeAndPrecision:{type:a._controller.getValue("mode"),precision:a._controller.getValue("precision")}},a._refreshForm()}}),this._formStringMarkup+=this._defaultFormMarkup,b=$('<div class="nlui-queryblock-form">'+this._formStringMarkup+"</div>").nlForm({labelsPosition:"above",controller:this._controller,locale:this._options.locale,timezone:this._options.timezone}),this.$el.append(b),this._refreshForm(),this},_getMode:function(){var a,b,c,d,e,f;for(b=this._controller.getValue("mode"),c=this._controller.getValue("precision"),e=["simple","range","relative"],d={mode:b,precision:c},a=0;e.length>a;a+=1)f=e[a],d[f]={year:b===f&&"year"===c,quarter:b===f&&"quarter"===c,month:b===f&&"month"===c,day:b===f&&"day"===c};return d},_refreshForm:function(){var a,b,c,d,e;for(c=this._getMode(),d=this._controller.getValue("operator"),e=("empty"===d||"notempty"===d)&&"simple"===this._controller.getValue("mode"),this._controller.setHidden("precision",e),this._controller.setHidden("operator","simple"!==this._controller.getValue("mode")),a=0;this._datePrecisions.length>a;a+=1)b=this._datePrecisions[a],this._proxyChangeState(c,"simple",b,d),this._proxyChangeState(c,"range",b,d),this._proxyChangeState(c,"relative",b,d);return this},isValid:function(){var a,b,c,d,e,f,g,h;return a=this._getMode(),f=!0,g=this._controller.check(),h=this._controller.getValue("operator"),"range"===a.mode?(b=this._controller.getValue("range-"+a.precision+"-from"),c=this._controller.getValue("range-"+a.precision+"-to"),b&&c?(d=new SO.PartialDate(b),e=new SO.PartialDate(c),f=e.compare(d)>=0,f?this._controller.setError("range-"+a.precision+"-to",null,!0):this._controller.setError("range-"+a.precision+"-to",{message:xtk_core.qe_date_range_error()},!0)):f=!1):f="empty"!==h&&"notempty"!==h||"simple"!==a.mode?"relative"===a.mode?Boolean(this.getValue()):Boolean(this._controller.getValue(a.mode+"-"+a.precision)):!0,this._cleanEmptyError(),g.valid&&f},_cleanEmptyError:function(){var a,b;return a=this,b=this._getMode(),SO.Utils.each(b,function(b,c){"object"==typeof c&&SO.Utils.each(c,function(c){"simple"===b?a._controller.getValue(b+"-"+c)||a._controller.setError(b+"-"+c,null,!0):"range"===b&&(a._controller.getValue(b+"-"+c+"-from")||a._controller.setError(b+"-"+c+"-from",null,!0),a._controller.getValue(b+"-"+c+"-to")||a._controller.setError(b+"-"+c+"-to",null,!0))})}),this},_proxyChangeState:function(a,b,c,d){var e,d;switch(e="empty"!==d&&"notempty"!==d||"simple"!==b?!a[b][c]:!0,b){case"simple":this._controller.setHidden("simple-"+c,e);break;case"range":this._controller.setHidden("range-"+c+"-from",e),this._controller.setHidden("range-"+c+"-from-inclusive",e),this._controller.setHidden("range-"+c+"-to",e),this._controller.setHidden("range-"+c+"-to-inclusive",e);break;case"relative":this._controller.setHidden("relative-"+c,e)}return this},getValue:function(){var a,b,c,d;for(d=this._getMode(),a=0;this._datePrecisions.length>a;a+=1)b=this._datePrecisions[a],d.simple[b]?c=this._formatSimpleValue(this._controller.getValue("operator"),this._controller.getValue("simple-"+b),b):d.range[b]?c=this._proxyFormatRangeValue(b):d.relative[b]&&(c=this._proxyFormatRelativeValue(b));return c},_proxyFormatRelativeValue:function(a){var b,c,d,e,f,g;return c=this._controller.getValue("relative-"+a)[0],e=this._operatorsValues.equals,f=this._operatorsValues["higher-inclusive"],g=this._operatorsValues.lower,"last_x"===c&&(d=parseInt($("#qe_date_relative_x_"+a).val(),10)),"day"===a&&"current"===c?b="{0}"+e+"ToDate(DaysAgo(0))":"day"===a&&"last"===c?b="{0}"+e+"ToDate(DaysAgo(1))":"day"===a&&"last_x"===c&&d?b="{0}"+f+"ToDate(DaysAgo("+d+"))":"month"===a&&"current"===c?b="{0}"+f+"YearAndMonth(ToDate(MonthsAgo(0)))":"month"===a&&"last"===c?b="{0}"+f+"YearAndMonth(ToDate(MonthsAgo(1))) AND {0}"+g+"YearAndMonth(ToDate(MonthsAgo(0)))":"month"===a&&"last_x"===c&&d?b="{0}"+f+"YearAndMonth(ToDate(MonthsAgo("+d+")))":"quarter"===a&&"current"===c?b="{0}"+f+"TruncQuarter(MonthsAgo(0))":"quarter"===a&&"last"===c?b="{0}"+f+"TruncQuarter(MonthsAgo(1)) AND {0}"+g+"TruncQuarter(MonthsAgo(0))":"quarter"===a&&"last_x"===c&&d?b="{0}"+f+"TruncQuarter(MonthsAgo("+d+"))":"year"===a&&"current"===c?b="{0}"+f+"TruncYear(MonthsAgo(0))":"year"===a&&"last"===c?b="{0}"+f+"TruncYear(MonthsAgo(12)) AND {0}"+g+"TruncYear(MonthsAgo(0))":"year"===a&&"last_x"===c&&d&&(b="{0}"+f+"TruncYear(MonthsAgo("+12*d+"))"),b},_proxyFormatRangeValue:function(a){var b,c,d,e,f;return b=this._controller.getValue("range-"+a+"-from"),c=this._controller.getValue("range-"+a+"-to"),d=this._controller.getValue("range-"+a+"-from-inclusive"),e=this._controller.getValue("range-"+a+"-to-inclusive"),e&&this._convertDate(c,{interval:"right"}),f=this._formatRangeValue(b,c,d,e)},_convertDate:function(a,b){var c;return b=SO.Utils.extend(b,{format:"shortDate"}),c=new SO.PartialDate(a).format(b),SO.DateOnly.safeParse(c).toString()},_formatSimpleValue:function(a,b,c){var d,e,f;return"empty"===a?d="{0} "+this._operatorsValues.empty:"notempty"===a?d="{0} "+this._operatorsValues.notempty:b&&a&&(a=this._operatorsValues[a],e=this._convertDate(b),"day"!==c&&"="===a?(f=this._convertDate(b,{interval:"right"}),d=this._formatRangeValue(e,f,!0,!0)):"day"!==c&&">"===a?(f=this._convertDate(b,{interval:"right"}),d="{0}"+a+"#"+f+"#"):"day"!==c&&"!="===a?(f=this._convertDate(b,{interval:"right"}),d="{0}"+this._operatorsValues.lower+"#"+e+"# OR {0}"+this._operatorsValues.higher+"#"+f+"#"):d="{0}"+a+"#"+e+"#"),d},_formatRangeValue:function(a,b,c,d){var e,f,g;return a&&b&&(f=c?this._operatorsValues["higher-inclusive"]:this._operatorsValues.higher,g=d?this._operatorsValues["lower-inclusive"]:this._operatorsValues.lower,a="string"==typeof a?a:this._convertDate(a),b="string"==typeof b?b:this._convertDate(b),e="{0}"+f+"#"+a+"# AND {0}"+g+"#"+b+"#"),e}}),SO.Widgets.define("QETimeSpanEditor","QEValueEditor",{DEFAULT_OPTIONS:{choices:{},params:{value:null}},renderForm:function(){var a,b,c,d;return a=this,d=[],SO.Utils.each(this._options.choices,function(a,b){d.push({value:b.value,label:b.label})}),d.sort(function(a,b){return a.label>b.label?1:-1}),b=SO.Utils.extend({value:{type:"timespan",label:xtk_core.qe_valueeditor_enum_values(),params:{choices:d}}},this._defaultMetaModel),this._controller=new SO.MVC.Controller({model:SO.Utils.extend({value:this._options.params.value},this._defaultModel),metamodel:b,displaymodel:this._defaultDisplayModel}),this._currentValue=this._controller.getValue("value"),c=$('<div class="nlui-queryblock-form"><div data-nl-jpath="value"></div>'+this._defaultFormMarkup+"</div>").nlForm({labelsPosition:"above",controller:this._controller}),this.$el.append(c),this},getValue:function(){return"{0}="+this._controller.getValue("value")},isValid:function(){return!SO.Utils.isEqual(this._controller.getValue("value"),this._currentValue)}}),SO.Widgets.define("QELinkEditor","QEValueEditor",{DEFAULT_OPTIONS:{dataSourceUrl:null,params:{value:null}},renderForm:function(){var a,b,c,d;return a=this,d=SO.Utils.extend({value:this._options.params.value},this._defaultModel),b=SO.Utils.extend({value:{label:xtk_core.qe_valueeditor_value(),type:"itemPicker",params:{source:"valuesStorage",dropdown:!0,inlineRenderer:function(a){var b,c;return a&&(b=a.getItem(),c=b.label||b.title),c}}},valuesStorage:{type:"list",dataSource:new NL.DataSource.Rest({url:this._options.dataSourceUrl}),params:{renderingMethods:{"default":{family:"line",label:"",icon:"",renderer:function(a){return a.label||a.title}}},defaultRendering:"default"},elements:{PKey:{type:"string",label:"PKey"},title:{type:"string",label:"title"}},keys:["PKey"]}},this._defaultMetaModel),this._controller=new SO.MVC.Controller({model:d,metamodel:b,statemodel:{},displaymodel:this._defaultDisplayModel,onValueChanged:function(){a.activeDialogButton(Boolean(a.getValue()))}}),c=$('<div class="nlui-queryblock-form"><div data-nl-jpath="value"></div>'+this._defaultFormMarkup+"</div>").nlForm({labelsPosition:"above",controller:this._controller}),this.$el.append(c),this},isValid:function(){return Boolean(this.getValue())},getValue:function(){var a,b,c;return a=this._controller.getValue("value"),a&&(c=a.getItem(),c.PKey&&(b="[{0}] = $RestKey("+c.PKey+")")),b}}),$.widget("SO.soQEValueEditor",{_create:function(){this._widget=new SO.Widgets.QEValueEditor(this.element,this.options)},_destroy:function(){this._widget.destroy()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.WebPage.Editor"),NL.WebPage.Editor.selfClosingTags={area:"nlArea",base:"nlbase",br:"nlBr",col:"nlCol",hr:"nlHr",img:"nlImg",input:"nlInput",meata:"nlMeta",param:"nlParam"},NL.WebPage.Editor.formatXmlString=function(a){a=a.replace(/></g,">\n<"),a=a.replace(/&/g,"&amp;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/</g,"&lt;"),a=a.replace(/\n/g,"<br>");for(tag in NL.WebPage.Editor.selfClosingTags){var b=new RegExp(NL.WebPage.Editor.selfClosingTags[tag],"gi");a=a.replace(b,tag)}return a},NL.WebPage.Editor.xmlToString=function(a){var b;return b=window.ActiveXObject?a.xml:(new XMLSerializer).serializeToString(a),NL.WebPage.Editor.formatXmlString(b)},NL.WebPage.Editor.jsonToXmlString=function(a,b){var c='<?xml version="1.0" encoding="UTF-8" ?>',d=function(a){var b=NL.WebPage.Editor.selfClosingTags[a]?NL.WebPage.Editor.selfClosingTags[a]:a;return b},e=function(a,b,c,f){var g,h=a[f+"Config"];if(h&&(g=h.params),g)for(var i in g)b.attr(i,g[i]);if("node"===f)for(var i in a)"nodeType"!==i&&b.attr(i,a[i]);var j;if(h&&(j=h.nodes),a._children_){for(var k=0;a._children_.length>k;k++){var l=a._children_[k],m=l.type,n=$("<"+d(m)+">");e(l,n,c,m),b.append(n)}b.appendTo(c)}else if(j)for(var o in j){var l=j[o],m=l.type,n=$("<"+d(m)+">");e(l,n,c,m),b.append(n)}else{var p=a.nextElement;if(p){var p=a[p];for(var o in p){var l=p[o];if(l){var m=l.type||l.nodeType,n=$("<"+d(m)+">");e(l,n,c,m),b.append(n)}}}}},f=$("<"+b+">"),g=$("<div></div>").append(f);e(a,f,f,b);var h=c+g.html(),i=$.parseXML(h),j=NL.WebPage.Editor.xmlToString(i);return j},NL.WebPage.Editor.getStateModel=function(){return{screen:{elements:{nodes:{elements:{inputConfig:{elements:{params:{elements:{type:{readOnly:!0}}}}}}}}}}},NL.WebPage.Editor.getMetaModel=function(){var a="Libell\u00e9",b="Expression",c="XPath",d=[{value:"labelRenderer",label:"labelRenderer"},{value:"itemRenderer",label:"itemRenderer"}],e={screen:{type:"container",elements:{nodes:{type:"tree",elements:{type:{type:"string"},id:{type:"number"},nextElement:{type:"string"},valueConfig:{type:"container",elements:{params:{type:"container",elements:{expr:{type:"string",label:b}}}}},blockConfig:{type:"container",elements:{params:{type:"container",elements:{visibleIf:{type:"string",label:"Condition de visibilit\u00e9"}}}}},titleConfig:{type:"container",elements:{params:{type:"container",elements:{title:{type:"string",label:"Titre"},label:{type:"string",label:a}}}}},inputConfig:{type:"container",elements:{inputType:{type:"string"},params:{type:"container",elements:{label:{type:"string",label:a},xpath:{type:"string",label:c},type:{type:"string",label:"Type"}}}}},listConfig:{type:"container",elements:{params:{type:"container",elements:{readOnly:{type:"boolean",label:"Lecture seul"},defaultRendering:{type:"enum",label:"Rendu par d\u00e9faut",params:{items:d}},title:{type:"string",label:"Titre"},id:{type:"string",label:"Id"}}},nodes:{type:"container",elements:{header:{type:"container",elements:{row:{type:"container",elements:{creation:{type:"container",elements:{creationConfig:{type:"container",elements:{params:{type:"container",elements:{view:{type:"string",label:"Vue cible"},label:{type:"string",label:a}}}}}}},order:{type:"container",elements:{node:{type:"list",elements:{label:{type:"string",label:a},expr:{type:"string",label:b},sortDesc:{type:"boolean",label:"Tri d\u00e9croissant"}},keys:["label"]}}}}}}}}}}},commandbarConfig:{type:"container",elements:{label:{type:"string"},mode:{type:"enum",label:"Choix du mode",params:{selection:"mono"}}}},webPageConfig:{type:"container",elements:{params:{type:"container",elements:{label:{type:"string",label:"Libell\u00e9"},name:{type:"string",label:"Nom"},pageTitle:{type:"string",label:"Titre de la page"},schema:{type:"string",label:"Sch\u00e9ma"},titleExpr:{type:"string",label:"Expression"}}}}},notebookConfig:{type:"container",elements:{params:{type:"container",elements:{layout:{type:"string",label:"Layout"}}},nodes:{type:"container",elements:{caption:{type:"string",label:"Libell\u00e9"},selected:{type:"boolean",label:"Selectionn\u00e9 par defaut"}}}}},tabConfig:{type:"container",elements:{params:{type:"container",elements:{label:{type:"string",label:"Label"}}}}}},keys:["id"]}}}};return e},NL.WebPage.Editor.buildGenericParams=function(a,b,c){for(var d in a)if(a.hasOwnProperty(d)){var e=b+"/"+d,f=$("<div></div>").attr("data-nl-jpath",e);c.append(f)}},NL.WebPage.Editor.treeListRenderer=function(a){var b=a.type,c=a[b+"Config"].inputType;return c?b+" : "+c:b},NL.WebPage.Editor.buildBlock=function(a,b,c){var d=b+"/blockConfig",e=a.getValue(d);NL.WebPage.Editor.buildGenericParams(e.params,d+"/params",c)},NL.WebPage.Editor.buildList=function(a,b,c){var d,e,f;d=b+"/listConfig",e=a.getValue(d),f=e.type,d+="/params",$("<h4></h4>",{text:"Propri\u00e9t\u00e9s de la liste"}).appendTo(c),NL.WebPage.Editor.buildGenericParams(e.params,d,c),$("<h4></h4>",{text:"Options de tri de la liste"}).appendTo(c)},NL.WebPage.Editor.buildNotebook=function(a,b,c){var d,e;d=b+"/notebookConfig",e=a.getValue(d),NL.WebPage.Editor.buildGenericParams(e.params,d+"/params",c)},NL.WebPage.Editor.drawForm=function(a,b,c,d){b=a.getValue(c);var e=$("<div></div>").appendTo(d),f=b.type;switch(f){case"list":NL.WebPage.Editor.buildList(a,c,e);break;case"block":NL.WebPage.Editor.buildBlock(a,c,e);break;case"notebook":NL.WebPage.Editor.buildNotebook(a,c,e);break;default:var g=c+"/"+f+"Config/params";NL.WebPage.Editor.buildGenericParams(b[f+"Config"].params,g,e)}e.nlForm({controller:a})};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("NL.nms.Delivery"),NL.nms.Delivery.getJSONNavigationForDelivery=function(a,b,c){var d=void 0!==a&&null!==a,e=c.backview;SO.isEmpty(e)&&(e="deliveryOverview");var f=e;SO.isObject(e)&&(f=JSON.stringify(e));var g={currentView:void 0,views:[],viewConfigs:{}};if(g.viewConfigs.general=d?{label:nms_campaign.blockGeneral(),icon:"nlui-icon-delivery",type:"navigation",view:"delivery",params:{id:b.id,backview:f},onBeforeExecuteCommand:function(){a.is("nl-nlDCE")&&(a.nlDCE("deselectAll",!0),a.nlDCE("setDirty",a.nlDCE("isDirty")))}}:getSwitchableViewConf({label:nms_campaign.blockGeneral(),icon:"nlui-icon-delivery",params:{backview:f}}),g.views.push("general"),c.isInConsole||(g.viewConfigs.content={view:"delivery/htmlContent",icon:"soui-icon-edit-content",label:xtk_core.monoContentLabel(),params:{backview:f}},d?SO.Utils.extend(!0,g.viewConfigs.content,{type:"code",checkSave:!0,confirmSave:!0,confirmSaveTargets:["preview"],onDisplay:function(){onDisplayPageFromViewBar(void 0,!0)}}):SO.Utils.extend(!0,g.viewConfigs.content,{type:"navigation",view:"delivery/htmlContent",params:{target:"delivery",sc:b.schema,id:b.id}}),g.views.push("content"),g.viewConfigs.preview={label:xtk_core.preview(),icon:"nlui-icon-preview",type:"block",blocks:[$("#previewContainer")],name:"preview",onDisplay:function(){showPreview()},onHide:function(){hidePreview()}},d&&SO.Utils.extend(g.viewConfigs.preview,{type:"navigation",view:"delivery",params:{id:b.id,view:"preview"}}),g.views.push("preview")),!c.standalone){var h={};SO.isObject(e)&&(SO.Utils.extend(h,e.params),e=e.view),g.viewConfigs.backView={type:"navigation",view:e,help:nms_campaign.backToDeliveries(),icon:"nlui-icon-back-to-list",mode:"backToTheList",params:h},g.views.push("backView")}return SO.isEmpty(g.currentView)&&(g.currentView=d?"content":"general"),g};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";(function(a){a.widget("NL.nlURLViewer",a.NL.nlWidget,{options:{autoLoad:!0,iframeWrapperClass:"",iframeClass:"",disableURLchange:!0,displayURL:!1,displayRefresh:!1,baseURL:"",directContent:"",params:{},size:{width:"auto",height:"auto"},onload:function(){},onunload:function(){}},_formController:null,_$form:null,_$iframeContainer:null,_$iframe:null,_$refreshButton:null,_create:function(){SO.assert(!this.options.baseURL||!this.options.directContent,"You must define either a 'baseURL' or a 'directContent' but not both."),this.options.layoutManager.registerWidget(this);var b=this;if(this._$form=a("<div></div>"),this.options.displayURL){var c="";this.options.displayRefresh&&(c="nlui-urlViewer-hasRefresh",this._$refreshButton=a('<span class="nlui-urlViewer-refresh"></span>').soButton({icon:"nlui-icon-refresh",onClick:function(){b.load()}}),this._$form.append(this._$refreshButton)),this._$form.append('<div data-nl-jpath="url" class="'+c+'"></div>')}this._formController=new SO.MVC.Controller({model:{url:this._buildURL()},metamodel:{url:{type:"string",labelsPosition:"none"}},statemodel:{url:{disabled:this.options.disableURLchange}},onCheck:{method:function(a){var c=!0,d=null,e=a.getValue("url");return b.options.displayURL&&(SO.Structure.URL.isValid(e)||(d=xtk_core.urlViewer_invalidURL(e),c=!1)),{valid:c,message:d}},jpath:null},onValueChanged:function(a,c,d,e){b.options.autoLoad&&b._populateIframe(),"url"===a&&b._checkURL(e,c)}}),this._$form.nlForm({controller:this._formController}),this._$errorActionMessage=a("<div>").soActionMessage({state:"error",displayIcon:"message"}).hide(),this._$iframeContainer=a('<div class="nlui-urlViewer-iframeContainer '+this.options.iframeWrapperClass+'"></div>'),this._$iframe=a('<iframe class="nlui-urlViewer-iframe '+this.options.iframeClass+'" src="about:blank"></iframe>'),this._$iframeContainer.append(this._$iframe),this.element.addClass("nlui-urlViewer").append(this._$form).append(this._$errorActionMessage).append(this._$iframeContainer),this.options.autoLoad&&this._populateIframe(),this.options.directContent||this._checkURL(this._formController.getValue("url"),this._formController)},_setOption:function(b){a.Widget.prototype._setOption.apply(this,arguments),("params"===b||"baseURL"===b)&&this._formController.setValue("url",this._buildURL()),"size"===b&&this._updateIFrameSize()},_checkURL:function(a,b){this.options.displayURL?(b.check(),this._$form.nlForm("refresh")):this._$errorActionMessage.soActionMessage("setMessage",xtk_core.urlViewer_invalidURL(a)).toggle(!SO.Structure.URL.isValid(a))},_updateIFrameSize:function(){var b=this._$iframe.height(),c=this.options.size.width,d=this.options.size.height;if(this._$iframe.css({width:0,height:0}),c="auto"===c?"100%":NL.XTK.parseNumber(c,0)+"px","auto"===d){var e=0;a(".page-header").each(function(){e+=a(this).outerHeight(!0)});var f=.9*a(window).height()-a(".nlui-dashboardNavigation-header").outerHeight(!0)-a(".nlui-dashboardSection-header").outerHeight(!0)-e,g=this._$iframe.get(0);if(this._onLoadError)c="100%",d=b;else{var h=g.contentWindow&&g.contentWindow.document&&g.contentWindow.document.body?NL.XTK.parseInt(g.contentWindow.document.body.offsetHeight,0):0,i=Math.max(h,0),j={};(g.contentDocument||g.contentWindow&&g.contentWindow.document)&&(j=this._$iframe.contents()),j.length>1&&(i=Math.max(i,j.outerHeight(!0))),d=Math.max(i+20,f),320>d&&(d=320)}}else d=NL.XTK.parseNumber(d,0);this._$iframe.css({width:c,height:d+"px"})},_buildURL:function(){return SO.Structure.URL.isValid(this.options.baseURL)?new SO.Structure.URL(this.options.baseURL).query(this.options.params).toString():this.options.baseURL},_populateIframe:function(){var a=this;this._updateIFrameSize(),a._$refreshButton&&a._$refreshButton.soButton("changeOptions",{icon:"/xtk/img/loading.gif"}),this._onLoadError=!0,this._$iframe.attr("src","about:blank").one("load",function(){a.options.directContent?this.contentWindow.document.write(a.options.directContent):SO.Structure.URL.isValid(a.options.baseURL)&&a._$iframe.attr("src",a._buildURL()).one("load",function(){a._$errorActionMessage.hide();try{this.contentWindow.document,a._onLoadError=!1}catch(b){a._$errorActionMessage.soActionMessage("setMessage",xtk_core.urlViewer_pageLoadError(this.src)+" ("+b+")").show()}a._updateIFrameSize(),a._$refreshButton&&a._$refreshButton.soButton("changeOptions",{icon:"nlui-icon-refresh"}),a.options.onload(a._$iframe,a._$iframeContainer)})})},_unloadIframe:function(){var a=this;this._updateIFrameSize(),this._$iframe.attr("src","about:blank").one("load",function(){a._updateIFrameSize(),a.options.onunload(a._$iframe,a._$iframeContainer)})},getIframe:function(){return this._$iframe},load:function(a){a&&(this.options.directContent=a),this._populateIframe()},unload:function(){this._unloadIframe()},rebuildLayout:function(){this._updateIFrameSize()},destroy:function(){this._formController=null,this._$form.remove(),this._$iframe=null,this._$iframeContainer.remove(),this.element.removeClass("nlui-urlViewer"),a.Widget.prototype.destroy.call(this)}})})(jQuery);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("DiagramPalette",{DEFAULT_OPTIONS:{droppable:null,paletteConfiguration:null,rendering:"line",sortCategories:!1,sortItems:!1,defaultOpen:void 0,onDrop:function(){},dragStart:function(){},dragStop:function(){},onCategoryOpen:function(){},onCategoryClose:function(){}},_create:function(){this._categories={},this.$el.addClass("nlui-diagrampalette"),this._paletteConfiguration=this._options.paletteConfiguration,this._render(),this._aggregateData()},_createLineItem:function(a){var b,c,d,e,f,g;return b=document.createElement("div"),b.classList.add("nlui-diagrampalette-item"),b.classList.add("linelayout"),a.icon&&(e=document.createElement("div"),e.classList.add("nlui-diagrampalette-iconwrapper"),c=SO.IMG.genIcon(a.icon,24),d=c instanceof jQuery?c[0]:c.el,e.appendChild(d),b.appendChild(e)),a.label&&(f=document.createElement("div"),f.classList.add("nlui-diagrampalette-item-labelwrapper"),g=document.createElement("span"),g.classList.add("nlui-diagrampalette-item-label"),g.textContent=a.label,f.appendChild(g),b.appendChild(f)),this._attachDragEvent($(b),a),b},_createBlockItem:function(a){var b,c=$('<div class="nlui-diagrampalette-item blocklayout"></div>'),d=$('<div class="nlui-diagrampalette-item-image"></div>');if(a.icon){b=$("<div></div>",{"class":"nlui-diagrampalette-item-imagewrapper nlui-diagrampalette-item-imagewrapper-background-"+a.backgroundColor});var e=$("<img/>");e.attr({src:a.icon,height:48,width:48}),e.appendTo(d),d.appendTo(b),c.append(b)}if(a.label){var f=$('<div class="nlui-diagrampalette-item-labelwrapper"></div>').append($('<span class="nlui-diagrampalette-item-label"></span>').text(a.label));c.append(f)}return this._attachDragEvent(d,a),c[0]},_createItemsMarkup:function(a){var b,c,d;for(d=document.createElement("div"),d.classList.add("nlui-diagrampalette-itemscontainer"),b=0,c=a.length;c>b;b++)d.appendChild(this._createItem(a[b]));return $(d)},_createItem:function(a){var b;return"line"===this._options.rendering?b=this._createLineItem(a):"block"===this._options.rendering&&(b=this._createBlockItem(a)),b},_attachDragEvent:function(a,b){var c=this;SO.Event.bind(a,"vdrag",{onDrop:function(a){var b=$(a.element);b.data("template",SO.Utils.extend({},a.data.template)),delete a.data,b.data("helper",a),c._options.onDrop(b)},onStart:function(a){var b=$(a.element);b.data("helper",a),c._options.dragStart(b)},onStop:function(a){var b=$(a.element);b.data("helper",a),c._options.dragStop(b)}},{dragStartDuration:0,appendToBody:!0,dragClass:"nlui-diagrampalette-draggeditem",droppable:this._options.droppable,revert:!0,clone:!0,data:b})},_render:function(){var a,b,c;return a=this,b=[],c=$("<div></div>").appendTo(this.$el),this._accordion=new SO.Widgets.Accordion(c,{defaultOpen:this._options.defaultOpen,sortPanels:this._options.sortCategories,panels:b,onOpen:function(b,c){a._options.onCategoryOpen(b,c)},onClose:function(b,c){a._options.onCategoryClose(b,c)},section:{width:"100%"}}),this},_aggregateData:function(){var a,b,c,d,e,f,g;for(b=this._paletteConfiguration.items,d=this._paletteConfiguration.categories,SO.assert(!SO.isNundef(d),"PaletteDiagram Widget: categories property is required for the palette configuration"),SO.assert(!SO.isNundef(b),"PaletteDiagram Widget: items property is required for the palette configuration"),a=0,e=d.length;e>a;a++)g=d[a],this.addCategory(g);for(a=0,f=b.length;f>a;a++)c=b[a],this.addItem(c,c.category);return this},addItem:function(a,b){var c,d,e,f,g,h;if(d=this._accordion.getPanelById(b)){if(h=this._categories[b],e=h.items,this._options.sortItems)for(c=0,f=e.length;f>c;c+=1)if(h.sort&&-1===a.label.localeCompare(e[c].label)){g=c;break}void 0!==g?e.splice(g,0,a):e.push(a),this._accordion.addPanelContent(d,this._createItem(a),g)}else SO.log.warn("PaletteDiagram Widget: can't insert the item, category '"+b+"' doesn't exist ");return this},addCategory:function(a){return a.items=a.items||[],a.sort=void 0===a.sort?!0:a.sort,this._categories[a.name]=a,a.panel=this._accordion.addPanel({id:a.name,title:a.label,icon:a.icon,content:this._createItemsMarkup(a.items)}),a.panel},openCategory:function(a){return this._accordion.expandPanel(a),this},destroy:function(){return this.$el.remove(),this}}),$.widget("SO.soDiagramPalette",{_create:function(){this._widget=new SO.Widgets.DiagramPalette(this.element,this.options)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
(function(a){var b,c,d="0.4.2",e="hasOwnProperty",f=/[\.\/]/,g=/\s*,\s*/,h="*",i=function(a,b){return a-b},j={n:{}},k=function(){for(var a=0,b=this.length;b>a;a++)if("undefined"!=typeof this[a])return this[a]},l=function(){for(var a=this.length;--a;)if("undefined"!=typeof this[a])return this[a]},m=function(a,d){a=String(a);var e,f=c,g=Array.prototype.slice.call(arguments,2),h=m.listeners(a),j=0,n=[],o={},p=[],q=b;p.firstDefined=k,p.lastDefined=l,b=a,c=0;for(var r=0,s=h.length;s>r;r++)"zIndex"in h[r]&&(n.push(h[r].zIndex),0>h[r].zIndex&&(o[h[r].zIndex]=h[r]));for(n.sort(i);0>n[j];)if(e=o[n[j++]],p.push(e.apply(d,g)),c)return c=f,p;for(r=0;s>r;r++)if(e=h[r],"zIndex"in e)if(e.zIndex==n[j]){if(p.push(e.apply(d,g)),c)break;do if(j++,e=o[n[j]],e&&p.push(e.apply(d,g)),c)break;while(e)}else o[e.zIndex]=e;else if(p.push(e.apply(d,g)),c)break;return c=f,b=q,p};m._events=j,m.listeners=function(a){var b,c,d,e,g,i,k,l,m=a.split(f),n=j,o=[n],p=[];for(e=0,g=m.length;g>e;e++){for(l=[],i=0,k=o.length;k>i;i++)for(n=o[i].n,c=[n[m[e]],n[h]],d=2;d--;)b=c[d],b&&(l.push(b),p=p.concat(b.f||[]));o=l}return p},m.on=function(a,b){if(a=String(a),"function"!=typeof b)return function(){};for(var c=a.split(g),d=0,e=c.length;e>d;d++)(function(a){for(var c,d=a.split(f),e=j,g=0,h=d.length;h>g;g++)e=e.n,e=e.hasOwnProperty(d[g])&&e[d[g]]||(e[d[g]]={n:{}});for(e.f=e.f||[],g=0,h=e.f.length;h>g;g++)if(e.f[g]==b){c=!0;break}!c&&e.f.push(b)})(c[d]);return function(a){+a==+a&&(b.zIndex=+a)}},m.f=function(a){var b=[].slice.call(arguments,1);return function(){m.apply(null,[a,null].concat(b).concat([].slice.call(arguments,0)))}},m.stop=function(){c=1},m.nt=function(a){return a?new RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(b):b},m.nts=function(){return b.split(f)},m.off=m.unbind=function(a,b){if(!a)return m._events=j={n:{}},void 0;var c=a.split(g);if(c.length>1)for(var d=0,i=c.length;i>d;d++)m.off(c[d],b);else{c=a.split(f);var k,l,n,d,i,o,p,q=[j];for(d=0,i=c.length;i>d;d++)for(o=0;q.length>o;o+=n.length-2){if(n=[o,1],k=q[o].n,c[d]!=h)k[c[d]]&&n.push(k[c[d]]);else for(l in k)k[e](l)&&n.push(k[l]);q.splice.apply(q,n)}for(d=0,i=q.length;i>d;d++)for(k=q[d];k.n;){if(b){if(k.f){for(o=0,p=k.f.length;p>o;o++)if(k.f[o]==b){k.f.splice(o,1);break}!k.f.length&&delete k.f}for(l in k.n)if(k.n[e](l)&&k.n[l].f){var r=k.n[l].f;for(o=0,p=r.length;p>o;o++)if(r[o]==b){r.splice(o,1);break}!r.length&&delete k.n[l].f}}else{delete k.f;for(l in k.n)k.n[e](l)&&k.n[l].f&&delete k.n[l].f}k=k.n}}},m.once=function(a,b){var c=function(){return m.unbind(a,c),b.apply(this,arguments)};return m.on(a,c)},m.version=d,m.toString=function(){return"You are running Eve "+d},"undefined"!=typeof module&&module.exports?module.exports=m:"function"==typeof define&&define.amd?define("eve",[],function(){return m}):a.eve=m})(this),function(a,b){"function"==typeof define&&define.amd?define(["eve"],function(c){return b(a,c)}):b(a,a.eve)}(this,function(a,b){var c=function(b){var c={},d=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){setTimeout(a,16)},e=Array.isArray||function(a){return a instanceof Array||"[object Array]"==Object.prototype.toString.call(a)},f=0,g="M"+(+new Date).toString(36),h=function(){return g+(f++).toString(36)},i=Date.now||function(){return+new Date},j=function(a){var b=this;if(null==a)return b.s;var c=b.s-a;b.b+=b.dur*c,b.B+=b.dur*c,b.s=a},k=function(a){var b=this;return null==a?b.spd:(b.spd=a,void 0)},l=function(a){var b=this;return null==a?b.dur:(b.s=b.s*a/b.dur,b.dur=a,void 0)},m=function(){var a=this;delete c[a.id],a.update(),b("mina.stop."+a.id,a)},n=function(){var a=this;a.pdif||(delete c[a.id],a.update(),a.pdif=a.get()-a.b)},o=function(){var a=this;a.pdif&&(a.b=a.get()-a.pdif,delete a.pdif,c[a.id]=a)},p=function(){var a,b=this;if(e(b.start)){a=[];for(var c=0,d=b.start.length;d>c;c++)a[c]=+b.start[c]+(b.end[c]-b.start[c])*b.easing(b.s)}else a=+b.start+(b.end-b.start)*b.easing(b.s);b.set(a)},q=function(){var a=0;for(var e in c)if(c.hasOwnProperty(e)){var f=c[e],g=f.get();a++,f.s=(g-f.b)/(f.dur/f.spd),f.s>=1&&(delete c[e],f.s=1,a--,function(a){setTimeout(function(){b("mina.finish."+a.id,a)})}(f)),f.update()}a&&d(q)},r=function(a,b,e,f,g,i,s){var t={id:h(),start:a,end:b,b:e,s:0,dur:f-e,spd:1,get:g,set:i,easing:s||r.linear,status:j,speed:k,duration:l,stop:m,pause:n,resume:o,update:p};c[t.id]=t;var u,v=0;for(u in c)if(c.hasOwnProperty(u)&&(v++,2==v))break;return 1==v&&d(q),t};return r.time=i,r.getById=function(a){return c[a]||null},r.linear=function(a){return a},r.easeout=function(a){return Math.pow(a,1.7)},r.easein=function(a){return Math.pow(a,.48)},r.easeinout=function(a){if(1==a)return 1;if(0==a)return 0;var b=.48-a/1.04,c=Math.sqrt(.1734+b*b),d=c-b,e=Math.pow(Math.abs(d),1/3)*(0>d?-1:1),f=-c-b,g=Math.pow(Math.abs(f),1/3)*(0>f?-1:1),h=e+g+.5;return 3*(1-h)*h*h+h*h*h},r.backin=function(a){if(1==a)return 1;var b=1.70158;return a*a*((b+1)*a-b)},r.backout=function(a){if(0==a)return 0;a-=1;var b=1.70158;return a*a*((b+1)*a+b)+1},r.elastic=function(a){return a==!!a?a:Math.pow(2,-10*a)*Math.sin((a-.075)*2*Math.PI/.3)+1},r.bounce=function(a){var b,c=7.5625,d=2.75;return 1/d>a?b=c*a*a:2/d>a?(a-=1.5/d,b=c*a*a+.75):2.5/d>a?(a-=2.25/d,b=c*a*a+.9375):(a-=2.625/d,b=c*a*a+.984375),b},a.mina=r,r}("undefined"==typeof b?function(){}:b),d=function(){function d(a,b){if(a){if(a.tagName)return y(a);if(f(a,"array")&&d.set)return d.set.apply(d,a);if(a instanceof u)return a;if(null==b)return a=z.doc.querySelector(a),y(a)}return a=null==a?"100%":a,b=null==b?"100%":b,new x(a,b)}function e(a,b){if(b){if("#text"==a&&(a=z.doc.createTextNode(b.text||"")),"string"==typeof a&&(a=e(a)),"string"==typeof b)return"xlink:"==b.substring(0,6)?a.getAttributeNS(W,b.substring(6)):"xml:"==b.substring(0,4)?a.getAttributeNS(X,b.substring(4)):a.getAttribute(b);for(var c in b)if(b[A](c)){var d=B(b[c]);d?"xlink:"==c.substring(0,6)?a.setAttributeNS(W,c.substring(6),d):"xml:"==c.substring(0,4)?a.setAttributeNS(X,c.substring(4),d):a.setAttribute(c,d):a.removeAttribute(c)}}else a=z.doc.createElementNS(X,a);return a}function f(a,b){return b=B.prototype.toLowerCase.call(b),"finite"==b?isFinite(a):"array"==b&&(a instanceof Array||Array.isArray&&Array.isArray(a))?!0:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||L.call(a).slice(8,-1).toLowerCase()==b}function h(a){if("function"==typeof a||Object(a)!==a)return a;var b=new a.constructor;for(var c in a)a[A](c)&&(b[c]=h(a[c]));return b}function i(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return a.push(a.splice(c,1)[0])}function j(a,b,c){function d(){var e=Array.prototype.slice.call(arguments,0),f=e.join("\u2400"),g=d.cache=d.cache||{},h=d.count=d.count||[];return g[A](f)?(i(h,f),c?c(g[f]):g[f]):(h.length>=1e3&&delete g[h.shift()],h.push(f),g[f]=a.apply(b,e),c?c(g[f]):g[f])}return d}function k(a,b,c,d,e,f){if(null==e){var g=a-c,h=b-d;return g||h?(180+180*E.atan2(-h,-g)/I+360)%360:0}return k(a,b,e,f)-k(c,d,e,f)}function l(a){return a%360*I/180}function m(a){return 180*a/I%360}function n(a){var b=[];return a=a.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,function(a,c,d){return d=d.split(/\s*,\s*|\s+/),"rotate"==c&&1==d.length&&d.push(0,0),"scale"==c&&(d.length>2?d=d.slice(0,2):2==d.length&&d.push(0,0),1==d.length&&d.push(d[0],0,0)),"skewX"==c?b.push(["m",1,0,E.tan(l(d[0])),1,0,0]):"skewY"==c?b.push(["m",1,E.tan(l(d[0])),0,1,0,0]):b.push([c.charAt(0)].concat(d)),a}),b}function o(a,b){var c=eb(a),e=new d.Matrix;if(c)for(var f=0,g=c.length;g>f;f++){var h,i,j,k,l,m=c[f],n=m.length,o=B(m[0]).toLowerCase(),p=m[0]!=o,q=p?e.invert():0;"t"==o&&2==n?e.translate(m[1],0):"t"==o&&3==n?p?(h=q.x(0,0),i=q.y(0,0),j=q.x(m[1],m[2]),k=q.y(m[1],m[2]),e.translate(j-h,k-i)):e.translate(m[1],m[2]):"r"==o?2==n?(l=l||b,e.rotate(m[1],l.x+l.width/2,l.y+l.height/2)):4==n&&(p?(j=q.x(m[2],m[3]),k=q.y(m[2],m[3]),e.rotate(m[1],j,k)):e.rotate(m[1],m[2],m[3])):"s"==o?2==n||3==n?(l=l||b,e.scale(m[1],m[n-1],l.x+l.width/2,l.y+l.height/2)):4==n?p?(j=q.x(m[2],m[3]),k=q.y(m[2],m[3]),e.scale(m[1],m[1],j,k)):e.scale(m[1],m[1],m[2],m[3]):5==n&&(p?(j=q.x(m[3],m[4]),k=q.y(m[3],m[4]),e.scale(m[1],m[2],j,k)):e.scale(m[1],m[2],m[3],m[4])):"m"==o&&7==n&&e.add(m[1],m[2],m[3],m[4],m[5],m[6])}return e}function p(a,b){if(null==b){var c=!0;if(b="linearGradient"==a.type||"radialGradient"==a.type?a.node.getAttribute("gradientTransform"):"pattern"==a.type?a.node.getAttribute("patternTransform"):a.node.getAttribute("transform"),!b)return new d.Matrix;b=n(b)}else b=d._.rgTransform.test(b)?B(b).replace(/\.{3}|\u2026/g,a._.transform||J):n(b),f(b,"array")&&(b=d.path?d.path.toString.call(b):B(b)),a._.transform=b;var e=o(b,a.getBBox(1));return c?e:(a.matrix=e,void 0)}function q(a){var b=a.node.ownerSVGElement&&y(a.node.ownerSVGElement)||a.node.parentNode&&y(a.node.parentNode)||d.select("svg")||d(0,0),c=b.select("defs"),e=null==c?!1:c.node;return e||(e=w("defs",b.node).node),e}function r(a){return a.node.ownerSVGElement&&y(a.node.ownerSVGElement)||d.select("svg")}function s(a,b,c){function d(a){if(null==a)return J;if(a==+a)return a;e(j,{width:a});try{return j.getBBox().width}catch(b){return 0}}function f(a){if(null==a)return J;if(a==+a)return a;e(j,{height:a});try{return j.getBBox().height}catch(b){return 0}}function g(d,e){null==b?i[d]=e(a.attr(d)||0):d==b&&(i=e(null==c?a.attr(d)||0:c))}var h=r(a).node,i={},j=h.querySelector(".svg---mgr");switch(j||(j=e("rect"),e(j,{x:-9e9,y:-9e9,width:10,height:10,"class":"svg---mgr",fill:"none"}),h.appendChild(j)),a.type){case"rect":g("rx",d),g("ry",f);case"image":g("width",d),g("height",f);case"text":g("x",d),g("y",f);break;case"circle":g("cx",d),g("cy",f),g("r",d);break;case"ellipse":g("cx",d),g("cy",f),g("rx",d),g("ry",f);break;case"line":g("x1",d),g("x2",d),g("y1",f),g("y2",f);break;case"marker":g("refX",d),g("markerWidth",d),g("refY",f),g("markerHeight",f);break;case"radialGradient":g("fx",d),g("fy",f);break;case"tspan":g("dx",d),g("dy",f);break;default:g(b,d)}return h.removeChild(j),i}function t(a){f(a,"array")||(a=Array.prototype.slice.call(arguments,0));for(var b=0,c=0,d=this.node;this[b];)delete this[b++];for(b=0;a.length>b;b++)"set"==a[b].type?a[b].forEach(function(a){d.appendChild(a.node)}):d.appendChild(a[b].node);var e=d.childNodes;for(b=0;e.length>b;b++)this[c++]=y(e[b]);return this}function u(a){if(a.snap in Y)return Y[a.snap];var b,c=this.id=V();try{b=a.ownerSVGElement}catch(d){}if(this.node=a,b&&(this.paper=new x(b)),this.type=a.tagName,this.anims={},this._={transform:[]},a.snap=c,Y[c]=this,"g"==this.type&&(this.add=t),this.type in{g:1,mask:1,pattern:1})for(var e in x.prototype)x.prototype[A](e)&&(this[e]=x.prototype[e])}function v(a){this.node=a}function w(a,b){var c=e(a);b.appendChild(c);var d=y(c);return d}function x(a,b){var c,d,f,g=x.prototype;if(a&&"svg"==a.tagName){if(a.snap in Y)return Y[a.snap];var h=a.ownerDocument;c=new u(a),d=a.getElementsByTagName("desc")[0],f=a.getElementsByTagName("defs")[0],d||(d=e("desc"),d.appendChild(h.createTextNode("Created with Snap")),c.node.appendChild(d)),f||(f=e("defs"),c.node.appendChild(f)),c.defs=f;for(var i in g)g[A](i)&&(c[i]=g[i]);c.paper=c.root=c}else c=w("svg",z.doc.body),e(c.node,{height:b,version:1.1,width:a,xmlns:X});return c}function y(a){return a?a instanceof u||a instanceof v?a:a.tagName&&"svg"==a.tagName.toLowerCase()?new x(a):a.tagName&&"object"==a.tagName.toLowerCase()&&"image/svg+xml"==a.type?new x(a.contentDocument.getElementsByTagName("svg")[0]):new u(a):a}d.version="0.3.0",d.toString=function(){return"Snap v"+this.version},d._={};var z={win:a,doc:a.document};d._.glob=z;var A="hasOwnProperty",B=String,C=parseFloat,D=parseInt,E=Math,F=E.max,G=E.min,H=E.abs,I=(E.pow,E.PI),J=(E.round,""),K=" ",L=Object.prototype.toString,M=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i,N="	\n\f\r \u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029",O=(d._.separator=new RegExp("[,"+N+"]+"),new RegExp("["+N+"]","g"),new RegExp("["+N+"]*,["+N+"]*")),P={hs:1,rg:1},Q=new RegExp("([a-z])["+N+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+N+"]*,?["+N+"]*)+)","ig"),R=new RegExp("([rstm])["+N+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+N+"]*,?["+N+"]*)+)","ig"),S=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+N+"]*,?["+N+"]*","ig"),T=0,U="S"+(+new Date).toString(36),V=function(){return U+(T++).toString(36)},W="http://www.w3.org/1999/xlink",X="http://www.w3.org/2000/svg",Y={},Z=d.url=function(a){return"url('#"+a+"')"};d._.$=e,d._.id=V,d.format=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))}),e=(null==e||e==d?a:e)+""};return function(b,d){return B(b).replace(a,function(a,b){return c(a,b,d)})}}(),d._.clone=h,d._.cacher=j,d.rad=l,d.deg=m,d.angle=k,d.is=f,d.snapTo=function(a,b,c){if(c=f(c,"finite")?c:10,f(a,"array")){for(var d=a.length;d--;)if(c>=H(a[d]-b))return a[d]}else{a=+a;var e=b%a;if(c>e)return b-e;if(e>a-c)return b-e+a}return b},d.getRGB=j(function(a){if(!a||(a=B(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:bb};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:bb};if(!(P[A](a.toLowerCase().substring(0,2))||"#"==a.charAt())&&(a=$(a)),!a)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:bb};var b,c,e,g,h,i,j=a.match(M);return j?(j[2]&&(e=D(j[2].substring(5),16),c=D(j[2].substring(3,5),16),b=D(j[2].substring(1,3),16)),j[3]&&(e=D((h=j[3].charAt(3))+h,16),c=D((h=j[3].charAt(2))+h,16),b=D((h=j[3].charAt(1))+h,16)),j[4]&&(i=j[4].split(O),b=C(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),c=C(i[1]),"%"==i[1].slice(-1)&&(c*=2.55),e=C(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),"rgba"==j[1].toLowerCase().slice(0,4)&&(g=C(i[3])),i[3]&&"%"==i[3].slice(-1)&&(g/=100)),j[5]?(i=j[5].split(O),b=C(i[0]),"%"==i[0].slice(-1)&&(b/=100),c=C(i[1]),"%"==i[1].slice(-1)&&(c/=100),e=C(i[2]),"%"==i[2].slice(-1)&&(e/=100),("deg"==i[0].slice(-3)||"\u00b0"==i[0].slice(-1))&&(b/=360),"hsba"==j[1].toLowerCase().slice(0,4)&&(g=C(i[3])),i[3]&&"%"==i[3].slice(-1)&&(g/=100),d.hsb2rgb(b,c,e,g)):j[6]?(i=j[6].split(O),b=C(i[0]),"%"==i[0].slice(-1)&&(b/=100),c=C(i[1]),"%"==i[1].slice(-1)&&(c/=100),e=C(i[2]),"%"==i[2].slice(-1)&&(e/=100),("deg"==i[0].slice(-3)||"\u00b0"==i[0].slice(-1))&&(b/=360),"hsla"==j[1].toLowerCase().slice(0,4)&&(g=C(i[3])),i[3]&&"%"==i[3].slice(-1)&&(g/=100),d.hsl2rgb(b,c,e,g)):(b=G(E.round(b),255),c=G(E.round(c),255),e=G(E.round(e),255),g=G(F(g,0),1),j={r:b,g:c,b:e,toString:bb},j.hex="#"+(16777216|e|c<<8|b<<16).toString(16).slice(1),j.opacity=f(g,"finite")?g:1,j)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:bb}},d),d.hsb=j(function(a,b,c){return d.hsb2rgb(a,b,c).hex}),d.hsl=j(function(a,b,c){return d.hsl2rgb(a,b,c).hex}),d.rgb=j(function(a,b,c,d){if(f(d,"finite")){var e=E.round;return"rgba("+[e(a),e(b),e(c),+d.toFixed(2)]+")"}return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)});var $=function(a){var b=z.doc.getElementsByTagName("head")[0]||z.doc.getElementsByTagName("svg")[0],c="rgb(255, 0, 0)";return $=j(function(a){if("red"==a.toLowerCase())return c;b.style.color=c,b.style.color=a;var d=z.doc.defaultView.getComputedStyle(b,J).getPropertyValue("color");return d==c?null:d}),$(a)},_=function(){return"hsb("+[this.h,this.s,this.b]+")"},ab=function(){return"hsl("+[this.h,this.s,this.l]+")"},bb=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},cb=function(a,b,c){if(null==b&&f(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(c=a.b,b=a.g,a=a.r),null==b&&f(a,string)){var e=d.getRGB(a);a=e.r,b=e.g,c=e.b}return(a>1||b>1||c>1)&&(a/=255,b/=255,c/=255),[a,b,c]},db=function(a,b,c,e){a=E.round(255*a),b=E.round(255*b),c=E.round(255*c);var g={r:a,g:b,b:c,opacity:f(e,"finite")?e:1,hex:d.rgb(a,b,c),toString:bb};return f(e,"finite")&&(g.opacity=e),g};d.color=function(a){var b;return f(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=d.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.opacity=1,a.hex=b.hex):f(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=d.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.opacity=1,a.hex=b.hex):(f(a,"string")&&(a=d.getRGB(a)),f(a,"object")&&"r"in a&&"g"in a&&"b"in a&&!("error"in a)?(b=d.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=d.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1,a.error=1)),a.toString=bb,a},d.hsb2rgb=function(a,b,c,d){f(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o),a*=360;var e,g,h,i,j;return a=a%360/60,j=c*b,i=j*(1-H(a%2-1)),e=g=h=c-j,a=~~a,e+=[j,i,0,0,i,j][a],g+=[i,j,j,i,0,0][a],h+=[0,0,i,j,j,i][a],db(e,g,h,d)},d.hsl2rgb=function(a,b,c,d){f(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h),(a>1||b>1||c>1)&&(a/=360,b/=100,c/=100),a*=360;var e,g,h,i,j;return a=a%360/60,j=2*b*(.5>c?c:1-c),i=j*(1-H(a%2-1)),e=g=h=c-j/2,a=~~a,e+=[j,i,0,0,i,j][a],g+=[i,j,j,i,0,0][a],h+=[0,0,i,j,j,i][a],db(e,g,h,d)},d.rgb2hsb=function(a,b,c){c=cb(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g;return f=F(a,b,c),g=f-G(a,b,c),d=0==g?null:f==a?(b-c)/g:f==b?(c-a)/g+2:(a-b)/g+4,d=60*((d+360)%6)/360,e=0==g?0:g/f,{h:d,s:e,b:f,toString:_}},d.rgb2hsl=function(a,b,c){c=cb(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g,h,i;return g=F(a,b,c),h=G(a,b,c),i=g-h,d=0==i?null:g==a?(b-c)/i:g==b?(c-a)/i+2:(a-b)/i+4,d=60*((d+360)%6)/360,f=(g+h)/2,e=0==i?0:.5>f?i/(2*f):i/(2-2*f),{h:d,s:e,l:f,toString:ab}},d.parsePathString=function(a){if(!a)return null;var b=d.path(a);if(b.arr)return d.path.clone(b.arr);var c={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return f(a,"array")&&f(a[0],"array")&&(e=d.path.clone(a)),e.length||B(a).replace(Q,function(a,b,d){var f=[],g=b.toLowerCase();if(d.replace(S,function(a,b){b&&f.push(+b)}),"m"==g&&f.length>2&&(e.push([b].concat(f.splice(0,2))),g="l",b="m"==b?"l":"L"),"o"==g&&1==f.length&&e.push([b,f[0]]),"r"==g)e.push([b].concat(f));else for(;f.length>=c[g]&&(e.push([b].concat(f.splice(0,c[g]))),c[g]););}),e.toString=d.path.toString,b.arr=d.path.clone(e),e};var eb=d.parseTransformString=function(a){if(!a)return null;var b=[];return f(a,"array")&&f(a[0],"array")&&(b=d.path.clone(a)),b.length||B(a).replace(R,function(a,c,d){var e=[];c.toLowerCase(),d.replace(S,function(a,b){b&&e.push(+b)}),b.push([c].concat(e))}),b.toString=d.path.toString,b};d._.svgTransform2string=n,d._.rgTransform=new RegExp("^[a-z]["+N+"]*-?\\.?\\d","i"),d._.transform2matrix=o,d._unit2px=s,z.doc.contains||z.doc.compareDocumentPosition?function(a,b){var c=9==a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a==d||!(!d||1!=d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b;)if(b=b.parentNode,b==a)return!0;return!1},d._.getSomeDefs=q,d._.getSomeSVG=r,d.select=function(a){return y(z.doc.querySelector(a))},d.selectAll=function(a){for(var b=z.doc.querySelectorAll(a),c=(d.set||Array)(),e=0;b.length>e;e++)c.push(y(b[e]));return c},setInterval(function(){for(var a in Y)if(Y[A](a)){var b=Y[a],c=b.node;("svg"!=b.type&&!c.ownerSVGElement||"svg"==b.type&&(!c.parentNode||"ownerSVGElement"in c.parentNode&&!c.ownerSVGElement))&&delete Y[a]}},1e4),function(a){function g(a){function b(a,b){var c=e(a.node,b);c=c&&c.match(g),c=c&&c[2],c&&"#"==c.charAt()&&(c=c.substring(1),c&&(i[c]=(i[c]||[]).concat(function(c){var d={};d[b]=Z(c),e(a.node,d)})))}function c(a){var b=e(a.node,"xlink:href");b&&"#"==b.charAt()&&(b=b.substring(1),b&&(i[b]=(i[b]||[]).concat(function(b){a.attr("xlink:href","#"+b)})))}for(var d,f=a.selectAll("*"),g=/^\s*url\(("|'|)(.*)\1\)\s*$/,h=[],i={},j=0,k=f.length;k>j;j++){d=f[j],b(d,"fill"),b(d,"stroke"),b(d,"filter"),b(d,"mask"),b(d,"clip-path"),c(d);var l=e(d.node,"id");l&&(e(d.node,{id:d.id}),h.push({old:l,id:d.id}))}for(j=0,k=h.length;k>j;j++){var m=i[h[j].old];if(m)for(var n=0,o=m.length;o>n;n++)m[n](h[j].id)}}function h(a,b,c){return function(d){var e=d.slice(a,b);return 1==e.length&&(e=e[0]),c?c(e):e}}function i(a){return function(){var b=a?"<"+this.type:"",c=this.node.attributes,d=this.node.childNodes;if(a)for(var e=0,f=c.length;f>e;e++)b+=" "+c[e].name+'="'+c[e].value.replace(/"/g,'\\"')+'"';if(d.length){for(a&&(b+=">"),e=0,f=d.length;f>e;e++)3==d[e].nodeType?b+=d[e].nodeValue:1==d[e].nodeType&&(b+=y(d[e]).toString());a&&(b+="</"+this.type+">")}else a&&(b+="/>");return b}}a.attr=function(a,c){var d=this;if(d.node,!a)return d;if(f(a,"string")){if(!(arguments.length>1))return b("snap.util.getattr."+a,d).firstDefined();var e={};e[a]=c,a=e}for(var g in a)a[A](g)&&b("snap.util.attr."+g,d,a[g]);return d},a.getBBox=function(a){if(!d.Matrix||!d.path)return this.node.getBBox();var b=this,c=new d.Matrix;if(b.removed)return d._.box();for(;"use"==b.type;)if(a||(c=c.add(b.transform().localMatrix.translate(b.attr("x")||0,b.attr("y")||0))),b.original)b=b.original;else{var e=b.attr("xlink:href");b=b.original=b.node.ownerDocument.getElementById(e.substring(e.indexOf("#")+1))}var f=b._,g=d.path.get[b.type]||d.path.get.deflt;try{return a?(f.bboxwt=g?d.path.getBBox(b.realPath=g(b)):d._.box(b.node.getBBox()),d._.box(f.bboxwt)):(b.realPath=g(b),b.matrix=b.transform().localMatrix,f.bbox=d.path.getBBox(d.path.map(b.realPath,c.add(b.matrix))),d._.box(f.bbox))}catch(h){return d._.box()}};var j=function(){return this.string};a.transform=function(a){var b=this._;if(null==a){for(var c,f=this,g=new d.Matrix(this.node.getCTM()),h=p(this),i=[h],k=new d.Matrix,l=h.toTransformString(),m=B(h)==B(this.matrix)?B(b.transform):l;"svg"!=f.type&&(f=f.parent());)i.push(p(f));for(c=i.length;c--;)k.add(i[c]);return{string:m,globalMatrix:g,totalMatrix:k,localMatrix:h,diffMatrix:g.clone().add(h.invert()),global:g.toTransformString(),total:k.toTransformString(),local:l,toString:j}}return a instanceof d.Matrix?this.matrix=a:p(this,a),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?e(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?e(this.node,{patternTransform:this.matrix}):e(this.node,{transform:this.matrix})),this},a.parent=function(){return y(this.node.parentNode)},a.append=a.add=function(a){if(a){if("set"==a.type){var b=this;return a.forEach(function(a){b.add(a)}),this}a=y(a),this.node.appendChild(a.node),a.paper=this.paper}return this},a.appendTo=function(a){return a&&(a=y(a),a.append(this)),this},a.prepend=function(a){if(a){if("set"==a.type){var b,c=this;return a.forEach(function(a){b?b.after(a):c.prepend(a),b=a}),this}a=y(a);var d=a.parent();this.node.insertBefore(a.node,this.node.firstChild),this.add&&this.add(),a.paper=this.paper,this.parent()&&this.parent().add(),d&&d.add()}return this},a.prependTo=function(a){return a=y(a),a.prepend(this),this},a.before=function(a){if("set"==a.type){var b=this;return a.forEach(function(a){var c=a.parent();b.node.parentNode.insertBefore(a.node,b.node),c&&c.add()}),this.parent().add(),this}a=y(a);var c=a.parent();return this.node.parentNode.insertBefore(a.node,this.node),this.parent()&&this.parent().add(),c&&c.add(),a.paper=this.paper,this},a.after=function(a){a=y(a);var b=a.parent();return this.node.nextSibling?this.node.parentNode.insertBefore(a.node,this.node.nextSibling):this.node.parentNode.appendChild(a.node),this.parent()&&this.parent().add(),b&&b.add(),a.paper=this.paper,this},a.insertBefore=function(a){a=y(a);var b=this.parent();return a.node.parentNode.insertBefore(this.node,a.node),this.paper=a.paper,b&&b.add(),a.parent()&&a.parent().add(),this},a.insertAfter=function(a){a=y(a);var b=this.parent();return a.node.parentNode.insertBefore(this.node,a.node.nextSibling),this.paper=a.paper,b&&b.add(),a.parent()&&a.parent().add(),this},a.remove=function(){var a=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),delete this.paper,this.removed=!0,a&&a.add(),this},a.select=function(a){return y(this.node.querySelector(a))},a.selectAll=function(a){for(var b=this.node.querySelectorAll(a),c=(d.set||Array)(),e=0;b.length>e;e++)c.push(y(b[e]));return c},a.asPX=function(a,b){return null==b&&(b=this.attr(a)),+s(this,a,b)},a.use=function(){var a,b=this.node.id;return b||(b=this.id,e(this.node,{id:b})),a="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?w(this.type,this.node.parentNode):w("use",this.node.parentNode),e(a.node,{"xlink:href":"#"+b}),a.original=this,a};var k=/\S+/g;a.addClass=function(a){var b,c,d,e,f=(a||"").match(k)||[],g=this.node,h=g.className.baseVal,i=h.match(k)||[];if(f.length){for(b=0;d=f[b++];)c=i.indexOf(d),~c||i.push(d);e=i.join(" "),h!=e&&(g.className.baseVal=e)}return this},a.removeClass=function(a){var b,c,d,e,f=(a||"").match(k)||[],g=this.node,h=g.className.baseVal,i=h.match(k)||[];if(i.length){for(b=0;d=f[b++];)c=i.indexOf(d),~c&&i.splice(c,1);e=i.join(" "),h!=e&&(g.className.baseVal=e)}return this},a.hasClass=function(a){var b=this.node,c=b.className.baseVal,d=c.match(k)||[];return!!~d.indexOf(a)},a.toggleClass=function(a,b){if(null!=b)return b?this.addClass(a):this.removeClass(a);var c,d,e,f,g=(a||"").match(k)||[],h=this.node,i=h.className.baseVal,j=i.match(k)||[];for(c=0;e=g[c++];)d=j.indexOf(e),~d?j.splice(d,1):j.push(e);return f=j.join(" "),i!=f&&(h.className.baseVal=f),this},a.clone=function(){var a=y(this.node.cloneNode(!0));return e(a.node,"id")&&e(a.node,{id:a.id}),g(a),a.insertAfter(this),a},a.toDefs=function(){var a=q(this);return a.appendChild(this.node),this},a.pattern=a.toPattern=function(a,b,c,d){var g=w("pattern",q(this));return null==a&&(a=this.getBBox()),f(a,"object")&&"x"in a&&(b=a.y,c=a.width,d=a.height,a=a.x),e(g.node,{x:a,y:b,width:c,height:d,patternUnits:"userSpaceOnUse",id:g.id,viewBox:[a,b,c,d].join(" ")}),g.node.appendChild(this.node),g},a.marker=function(a,b,c,d,g,h){var i=w("marker",q(this));return null==a&&(a=this.getBBox()),f(a,"object")&&"x"in a&&(b=a.y,c=a.width,d=a.height,g=a.refX||a.cx,h=a.refY||a.cy,a=a.x),e(i.node,{viewBox:[a,b,c,d].join(K),markerWidth:c,markerHeight:d,orient:"auto",refX:g||0,refY:h||0,id:i.id}),i.node.appendChild(this.node),i};var l=function(a,b,d,e){"function"!=typeof d||d.length||(e=d,d=c.linear),this.attr=a,this.dur=b,d&&(this.easing=d),e&&(this.callback=e)};d._.Animation=l,d.animation=function(a,b,c,d){return new l(a,b,c,d)},a.inAnim=function(){var a=this,b=[];for(var c in a.anims)a.anims[A](c)&&function(a){b.push({anim:new l(a._attrs,a.dur,a.easing,a._callback),mina:a,curStatus:a.status(),status:function(b){return a.status(b)},stop:function(){a.stop()}})}(a.anims[c]);return b},d.animate=function(a,d,e,f,g,h){"function"!=typeof g||g.length||(h=g,g=c.linear);var i=c.time(),j=c(a,d,i,i+f,c.time,e,g);return h&&b.once("mina.finish."+j.id,h),j},a.stop=function(){for(var a=this.inAnim(),b=0,c=a.length;c>b;b++)a[b].stop();return this},a.animate=function(a,d,e,g){"function"!=typeof e||e.length||(g=e,e=c.linear),a instanceof l&&(g=a.callback,e=a.easing,d=e.dur,a=a.attr);var i,j,k,m,n=[],o=[],p={},q=this;for(var r in a)if(a[A](r)){q.equal?(m=q.equal(r,B(a[r])),i=m.from,j=m.to,k=m.f):(i=+q.attr(r),j=+a[r]);var s=f(i,"array")?i.length:1;p[r]=h(n.length,n.length+s,k),n=n.concat(i),o=o.concat(j)}var t=c.time(),u=c(n,o,t,t+d,c.time,function(a){var b={};for(var c in p)p[A](c)&&(b[c]=p[c](a));q.attr(b)},e);return q.anims[u.id]=u,u._attrs=a,u._callback=g,b("snap.animcreated."+q.id,u),b.once("mina.finish."+u.id,function(){delete q.anims[u.id],g&&g.call(q)}),b.once("mina.stop."+u.id,function(){delete q.anims[u.id]}),q};var m={};a.data=function(a,c){var e=m[this.id]=m[this.id]||{};if(0==arguments.length)return b("snap.data.get."+this.id,this,e,null),e;if(1==arguments.length){if(d.is(a,"object")){for(var f in a)a[A](f)&&this.data(f,a[f]);return this}return b("snap.data.get."+this.id,this,e[a],a),e[a]}return e[a]=c,b("snap.data.set."+this.id,this,c,a),this},a.removeData=function(a){return null==a?m[this.id]={}:m[this.id]&&delete m[this.id][a],this},a.outerSVG=a.toString=i(1),a.innerSVG=i()}(u.prototype),d.parse=function(a){var b=z.doc.createDocumentFragment(),c=!0,d=z.doc.createElement("div");if(a=B(a),a.match(/^\s*<\s*svg(?:\s|>)/)||(a="<svg>"+a+"</svg>",c=!1),d.innerHTML=a,a=d.getElementsByTagName("svg")[0])if(c)b=a;else for(;a.firstChild;)b.appendChild(a.firstChild);return d.innerHTML=J,new v(b)},v.prototype.select=u.prototype.select,v.prototype.selectAll=u.prototype.selectAll,d.fragment=function(){for(var a=Array.prototype.slice.call(arguments,0),b=z.doc.createDocumentFragment(),c=0,e=a.length;e>c;c++){var f=a[c];f.node&&f.node.nodeType&&b.appendChild(f.node),f.nodeType&&b.appendChild(f),"string"==typeof f&&b.appendChild(d.parse(f).node)}return new v(b)},d._.make=w,d._.wrap=y,x.prototype.el=function(a,b){var c=w(a,this.node);return b&&c.attr(b),c},b.on("snap.util.getattr",function(){var a=b.nt();a=a.substring(a.lastIndexOf(".")+1);var c=a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()});return fb[A](c)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(c):e(this.node,a)});var fb={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};b.on("snap.util.attr",function(a){var c=b.nt(),d={};c=c.substring(c.lastIndexOf(".")+1),d[c]=a;var f=c.replace(/-(\w)/gi,function(a,b){return b.toUpperCase()}),g=c.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()});fb[A](g)?this.node.style[f]=null==a?J:a:e(this.node,d)}),function(){}(x.prototype),d.ajax=function(a,c,d,e){var g=new XMLHttpRequest,h=V();if(g){if(f(c,"function"))e=d,d=c,c=null;else if(f(c,"object")){var i=[];for(var j in c)c.hasOwnProperty(j)&&i.push(encodeURIComponent(j)+"="+encodeURIComponent(c[j]));c=i.join("&")}return g.open(c?"POST":"GET",a,!0),c&&(g.setRequestHeader("X-Requested-With","XMLHttpRequest"),g.setRequestHeader("Content-type","application/x-www-form-urlencoded")),d&&(b.once("snap.ajax."+h+".0",d),b.once("snap.ajax."+h+".200",d),b.once("snap.ajax."+h+".304",d)),g.onreadystatechange=function(){4==g.readyState&&b("snap.ajax."+h+"."+g.status,e,g)},4==g.readyState?g:(g.send(c),g)}},d.load=function(a,b,c){d.ajax(a,function(a){var e=d.parse(a.responseText);c?b.call(c,e):b(e)})};var gb=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,h=e.clientLeft||d.clientLeft||0,i=b.top+(g.win.pageYOffset||e.scrollTop||d.scrollTop)-f,j=b.left+(g.win.pageXOffset||e.scrollLeft||d.scrollLeft)-h;return{y:i,x:j}};return d.getElementByPoint=function(a,b){var c=this,d=(c.canvas,z.doc.elementFromPoint(a,b));if(z.win.opera&&"svg"==d.tagName){var e=gb(d),f=d.createSVGRect();f.x=a-e.x,f.y=b-e.y,f.width=f.height=1;var g=d.getIntersectionList(f,null);g.length&&(d=g[g.length-1])}return d?y(d):null},d.plugin=function(a){a(d,u,x,z,v)},z.win.Snap=d,d}();return d.plugin(function(a){function b(a,b,d,e,f,g){return null==b&&"[object SVGMatrix]"==c.call(a)?(this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.e=a.e,this.f=a.f,void 0):(null!=a?(this.a=+a,this.b=+b,this.c=+d,this.d=+e,this.e=+f,this.f=+g):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0),void 0)
}var c=Object.prototype.toString,d=String,e=Math,f="";(function(c){function g(a){return a[0]*a[0]+a[1]*a[1]}function h(a){var b=e.sqrt(g(a));a[0]&&(a[0]/=b),a[1]&&(a[1]/=b)}c.add=function(a,c,d,e,f,g){var h,i,j,k,l=[[],[],[]],m=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],n=[[a,d,f],[c,e,g],[0,0,1]];for(a&&a instanceof b&&(n=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),h=0;3>h;h++)for(i=0;3>i;i++){for(k=0,j=0;3>j;j++)k+=m[h][j]*n[j][i];l[h][i]=k}return this.a=l[0][0],this.b=l[1][0],this.c=l[0][1],this.d=l[1][1],this.e=l[0][2],this.f=l[1][2],this},c.invert=function(){var a=this,c=a.a*a.d-a.b*a.c;return new b(a.d/c,-a.b/c,-a.c/c,a.a/c,(a.c*a.f-a.d*a.e)/c,(a.b*a.e-a.a*a.f)/c)},c.clone=function(){return new b(this.a,this.b,this.c,this.d,this.e,this.f)},c.translate=function(a,b){return this.add(1,0,0,1,a,b)},c.scale=function(a,b,c,d){return null==b&&(b=a),(c||d)&&this.add(1,0,0,1,c,d),this.add(a,0,0,b,0,0),(c||d)&&this.add(1,0,0,1,-c,-d),this},c.rotate=function(b,c,d){b=a.rad(b),c=c||0,d=d||0;var f=+e.cos(b).toFixed(9),g=+e.sin(b).toFixed(9);return this.add(f,g,-g,f,c,d),this.add(1,0,0,1,-c,-d)},c.x=function(a,b){return a*this.a+b*this.c+this.e},c.y=function(a,b){return a*this.b+b*this.d+this.f},c.get=function(a){return+this[d.fromCharCode(97+a)].toFixed(4)},c.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"},c.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},c.determinant=function(){return this.a*this.d-this.b*this.c},c.split=function(){var b={};b.dx=this.e,b.dy=this.f;var c=[[this.a,this.c],[this.b,this.d]];b.scalex=e.sqrt(g(c[0])),h(c[0]),b.shear=c[0][0]*c[1][0]+c[0][1]*c[1][1],c[1]=[c[1][0]-c[0][0]*b.shear,c[1][1]-c[0][1]*b.shear],b.scaley=e.sqrt(g(c[1])),h(c[1]),b.shear/=b.scaley,0>this.determinant()&&(b.scalex=-b.scalex);var d=-c[0][1],f=c[1][1];return 0>f?(b.rotate=a.deg(e.acos(f)),0>d&&(b.rotate=360-b.rotate)):b.rotate=a.deg(e.asin(d)),b.isSimple=!(+b.shear.toFixed(9)||b.scalex.toFixed(9)!=b.scaley.toFixed(9)&&b.rotate),b.isSuperSimple=!+b.shear.toFixed(9)&&b.scalex.toFixed(9)==b.scaley.toFixed(9)&&!b.rotate,b.noRotation=!+b.shear.toFixed(9)&&!b.rotate,b},c.toTransformString=function(a){var b=a||this.split();return+b.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(b.scalex=+b.scalex.toFixed(4),b.scaley=+b.scaley.toFixed(4),b.rotate=+b.rotate.toFixed(4),(b.dx||b.dy?"t"+[+b.dx.toFixed(4),+b.dy.toFixed(4)]:f)+(1!=b.scalex||1!=b.scaley?"s"+[b.scalex,b.scaley,0,0]:f)+(b.rotate?"r"+[+b.rotate.toFixed(4),0,0]:f))}})(b.prototype),a.Matrix=b,a.matrix=function(a,c,d,e,f,g){return new b(a,c,d,e,f,g)}}),d.plugin(function(a,c,d,e,f){function g(d){return function(e){if(b.stop(),e instanceof f&&1==e.node.childNodes.length&&("radialGradient"==e.node.firstChild.tagName||"linearGradient"==e.node.firstChild.tagName||"pattern"==e.node.firstChild.tagName)&&(e=e.node.firstChild,n(this).appendChild(e),e=l(e)),e instanceof c)if("radialGradient"==e.type||"linearGradient"==e.type||"pattern"==e.type){e.node.id||p(e.node,{id:e.id});var g=q(e.node.id)}else g=e.attr(d);else if(g=a.color(e),g.error){var h=a(n(this).ownerSVGElement).gradient(e);h?(h.node.id||p(h.node,{id:h.id}),g=q(h.node.id)):g=e}else g=r(g);var i={};i[d]=g,p(this.node,i),this.node.style[d]=t}}function h(a){b.stop(),a==+a&&(a+="px"),this.node.style.fontSize=a}function i(a){for(var b=[],c=a.childNodes,d=0,e=c.length;e>d;d++){var f=c[d];3==f.nodeType&&b.push(f.nodeValue),"tspan"==f.tagName&&(1==f.childNodes.length&&3==f.firstChild.nodeType?b.push(f.firstChild.nodeValue):b.push(i(f)))}return b}function j(){return b.stop(),this.node.style.fontSize}var k=a._.make,l=a._.wrap,m=a.is,n=a._.getSomeDefs,o=/^url\(#?([^)]+)\)$/,p=a._.$,q=a.url,r=String,s=a._.separator,t="";b.on("snap.util.attr.mask",function(a){if(a instanceof c||a instanceof f){if(b.stop(),a instanceof f&&1==a.node.childNodes.length&&(a=a.node.firstChild,n(this).appendChild(a),a=l(a)),"mask"==a.type)var d=a;else d=k("mask",n(this)),d.node.appendChild(a.node);!d.node.id&&p(d.node,{id:d.id}),p(this.node,{mask:q(d.id)})}}),function(a){b.on("snap.util.attr.clip",a),b.on("snap.util.attr.clip-path",a),b.on("snap.util.attr.clipPath",a)}(function(a){if(a instanceof c||a instanceof f){if(b.stop(),"clipPath"==a.type)var d=a;else d=k("clipPath",n(this)),d.node.appendChild(a.node),!d.node.id&&p(d.node,{id:d.id});p(this.node,{"clip-path":q(d.id)})}}),b.on("snap.util.attr.fill",g("fill")),b.on("snap.util.attr.stroke",g("stroke"));var u=/^([lr])(?:\(([^)]*)\))?(.*)$/i;b.on("snap.util.grad.parse",function(a){a=r(a);var b=a.match(u);if(!b)return null;var c=b[1],d=b[2],e=b[3];return d=d.split(/\s*,\s*/).map(function(a){return+a==a?+a:a}),1==d.length&&0==d[0]&&(d=[]),e=e.split("-"),e=e.map(function(a){a=a.split(":");var b={color:a[0]};return a[1]&&(b.offset=parseFloat(a[1])),b}),{type:c,params:d,stops:e}}),b.on("snap.util.attr.d",function(c){b.stop(),m(c,"array")&&m(c[0],"array")&&(c=a.path.toString.call(c)),c=r(c),c.match(/[ruo]/i)&&(c=a.path.toAbsolute(c)),p(this.node,{d:c})})(-1),b.on("snap.util.attr.#text",function(a){b.stop(),a=r(a);for(var c=e.doc.createTextNode(a);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(c)})(-1),b.on("snap.util.attr.path",function(a){b.stop(),this.attr({d:a})})(-1),b.on("snap.util.attr.class",function(a){b.stop(),this.node.className.baseVal=a})(-1),b.on("snap.util.attr.viewBox",function(a){var c;c=m(a,"object")&&"x"in a?[a.x,a.y,a.width,a.height].join(" "):m(a,"array")?a.join(" "):a,p(this.node,{viewBox:c}),b.stop()})(-1),b.on("snap.util.attr.transform",function(a){this.transform(a),b.stop()})(-1),b.on("snap.util.attr.r",function(a){"rect"==this.type&&(b.stop(),p(this.node,{rx:a,ry:a}))})(-1),b.on("snap.util.attr.textpath",function(a){if(b.stop(),"text"==this.type){var d,e,f;if(!a&&this.textPath){for(e=this.textPath;e.node.firstChild;)this.node.appendChild(e.node.firstChild);return e.remove(),delete this.textPath,void 0}if(m(a,"string")){var g=n(this),h=l(g.parentNode).path(a);g.appendChild(h.node),d=h.id,h.attr({id:d})}else a=l(a),a instanceof c&&(d=a.attr("id"),d||(d=a.id,a.attr({id:d})));if(d)if(e=this.textPath,f=this.node,e)e.attr({"xlink:href":"#"+d});else{for(e=p("textPath",{"xlink:href":"#"+d});f.firstChild;)e.appendChild(f.firstChild);f.appendChild(e),this.textPath=l(e)}}})(-1),b.on("snap.util.attr.text",function(a){if("text"==this.type){for(var c=this.node,d=function(a){var b=p("tspan");if(m(a,"array"))for(var c=0;a.length>c;c++)b.appendChild(d(a[c]));else b.appendChild(e.doc.createTextNode(a));return b.normalize&&b.normalize(),b};c.firstChild;)c.removeChild(c.firstChild);for(var f=d(a);f.firstChild;)c.appendChild(f.firstChild)}b.stop()})(-1),b.on("snap.util.attr.fontSize",h)(-1),b.on("snap.util.attr.font-size",h)(-1),b.on("snap.util.getattr.transform",function(){return b.stop(),this.transform()})(-1),b.on("snap.util.getattr.textpath",function(){return b.stop(),this.textPath})(-1),function(){function c(c){return function(){b.stop();var d=e.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+c);return"none"==d?d:a(e.doc.getElementById(d.match(o)[1]))}}function d(a){return function(c){b.stop();var d="marker"+a.charAt(0).toUpperCase()+a.substring(1);if(""==c||!c)return this.node.style[d]="none",void 0;if("marker"==c.type){var e=c.node.id;return e||p(c.node,{id:c.id}),this.node.style[d]=q(e),void 0}}}b.on("snap.util.getattr.marker-end",c("end"))(-1),b.on("snap.util.getattr.markerEnd",c("end"))(-1),b.on("snap.util.getattr.marker-start",c("start"))(-1),b.on("snap.util.getattr.markerStart",c("start"))(-1),b.on("snap.util.getattr.marker-mid",c("mid"))(-1),b.on("snap.util.getattr.markerMid",c("mid"))(-1),b.on("snap.util.attr.marker-end",d("end"))(-1),b.on("snap.util.attr.markerEnd",d("end"))(-1),b.on("snap.util.attr.marker-start",d("start"))(-1),b.on("snap.util.attr.markerStart",d("start"))(-1),b.on("snap.util.attr.marker-mid",d("mid"))(-1),b.on("snap.util.attr.markerMid",d("mid"))(-1)}(),b.on("snap.util.getattr.r",function(){return"rect"==this.type&&p(this.node,"rx")==p(this.node,"ry")?(b.stop(),p(this.node,"rx")):void 0})(-1),b.on("snap.util.getattr.text",function(){if("text"==this.type||"tspan"==this.type){b.stop();var a=i(this.node);return 1==a.length?a[0]:a}})(-1),b.on("snap.util.getattr.#text",function(){return this.node.textContent})(-1),b.on("snap.util.getattr.viewBox",function(){b.stop();var c=p(this.node,"viewBox");return c?(c=c.split(s),a._.box(+c[0],+c[1],+c[2],+c[3])):void 0})(-1),b.on("snap.util.getattr.points",function(){var a=p(this.node,"points");return b.stop(),a?a.split(s):void 0})(-1),b.on("snap.util.getattr.path",function(){var a=p(this.node,"d");return b.stop(),a})(-1),b.on("snap.util.getattr.class",function(){return this.node.className.baseVal})(-1),b.on("snap.util.getattr.fontSize",j)(-1),b.on("snap.util.getattr.font-size",j)(-1)}),d.plugin(function(){function a(a){return a}function c(a){return function(b){return+b.toFixed(3)+a}}var d={"+":function(a,b){return a+b},"-":function(a,b){return a-b},"/":function(a,b){return a/b},"*":function(a,b){return a*b}},e=String,f=/[a-z]+$/i,g=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;b.on("snap.util.attr",function(a){var c=e(a).match(g);if(c){var h=b.nt(),i=h.substring(h.lastIndexOf(".")+1),j=this.attr(i),k={};b.stop();var l=c[3]||"",m=j.match(f),n=d[c[1]];if(m&&m==l?a=n(parseFloat(j),+c[2]):(j=this.asPX(i),a=n(this.asPX(i),this.asPX(i,c[2]+l))),isNaN(j)||isNaN(a))return;k[i]=a,this.attr(k)}})(-10),b.on("snap.util.equal",function(h,i){var j=e(this.attr(h)||""),k=e(i).match(g);if(k){b.stop();var l=k[3]||"",m=j.match(f),n=d[k[1]];return m&&m==l?{from:parseFloat(j),to:n(parseFloat(j),+k[2]),f:c(m)}:(j=this.asPX(h),{from:j,to:n(j,this.asPX(h,k[2]+l)),f:a})}})(-10)}),d.plugin(function(a,c,d,e){var f=d.prototype,g=a.is;f.rect=function(a,b,c,d,e,f){var h;return null==f&&(f=e),g(a,"object")&&"[object Object]"==a?h=a:null!=a&&(h={x:a,y:b,width:c,height:d},null!=e&&(h.rx=e,h.ry=f)),this.el("rect",h)},f.circle=function(a,b,c){var d;return g(a,"object")&&"[object Object]"==a?d=a:null!=a&&(d={cx:a,cy:b,r:c}),this.el("circle",d)};var h=function(){function a(){this.parentNode.removeChild(this)}return function(b,c){var d=e.doc.createElement("img"),f=e.doc.body;d.style.cssText="position:absolute;left:-9999em;top:-9999em",d.onload=function(){c.call(d),d.onload=d.onerror=null,f.removeChild(d)},d.onerror=a,f.appendChild(d),d.src=b}}();f.image=function(b,c,d,e,f){var i=this.el("image");if(g(b,"object")&&"src"in b)i.attr(b);else if(null!=b){var j={"xlink:href":b,preserveAspectRatio:"none"};null!=c&&null!=d&&(j.x=c,j.y=d),null!=e&&null!=f?(j.width=e,j.height=f):h(b,function(){a._.$(i.node,{width:this.offsetWidth,height:this.offsetHeight})}),a._.$(i.node,j)}return i},f.ellipse=function(a,b,c,d){var e;return g(a,"object")&&"[object Object]"==a?e=a:null!=a&&(e={cx:a,cy:b,rx:c,ry:d}),this.el("ellipse",e)},f.path=function(a){var b;return g(a,"object")&&!g(a,"array")?b=a:a&&(b={d:a}),this.el("path",b)},f.group=f.g=function(a){var b=this.el("g");return 1==arguments.length&&a&&!a.type?b.attr(a):arguments.length&&b.add(Array.prototype.slice.call(arguments,0)),b},f.svg=function(a,b,c,d,e,f,h,i){var j={};return g(a,"object")&&null==b?j=a:(null!=a&&(j.x=a),null!=b&&(j.y=b),null!=c&&(j.width=c),null!=d&&(j.height=d),null!=e&&null!=f&&null!=h&&null!=i&&(j.viewBox=[e,f,h,i])),this.el("svg",j)},f.mask=function(a){var b=this.el("mask");return 1==arguments.length&&a&&!a.type?b.attr(a):arguments.length&&b.add(Array.prototype.slice.call(arguments,0)),b},f.ptrn=function(a,b,c,d,e,f,h,i){if(g(a,"object"))var j=a;else arguments.length?(j={},null!=a&&(j.x=a),null!=b&&(j.y=b),null!=c&&(j.width=c),null!=d&&(j.height=d),null!=e&&null!=f&&null!=h&&null!=i&&(j.viewBox=[e,f,h,i])):j={patternUnits:"userSpaceOnUse"};return this.el("pattern",j)},f.use=function(a){return null!=a?(make("use",this.node),a instanceof c&&(a.attr("id")||a.attr({id:ID()}),a=a.attr("id")),this.el("use",{"xlink:href":a})):c.prototype.use.call(this)},f.text=function(a,b,c){var d={};return g(a,"object")?d=a:null!=a&&(d={x:a,y:b,text:c||""}),this.el("text",d)},f.line=function(a,b,c,d){var e={};return g(a,"object")?e=a:null!=a&&(e={x1:a,x2:c,y1:b,y2:d}),this.el("line",e)},f.polyline=function(a){arguments.length>1&&(a=Array.prototype.slice.call(arguments,0));var b={};return g(a,"object")&&!g(a,"array")?b=a:null!=a&&(b={points:a}),this.el("polyline",b)},f.polygon=function(a){arguments.length>1&&(a=Array.prototype.slice.call(arguments,0));var b={};return g(a,"object")&&!g(a,"array")?b=a:null!=a&&(b={points:a}),this.el("polygon",b)},function(){function c(){return this.selectAll("stop")}function d(b,c){var d=j("stop"),e={offset:+c+"%"};return b=a.color(b),e["stop-color"]=b.hex,1>b.opacity&&(e["stop-opacity"]=b.opacity),j(d,e),this.node.appendChild(d),this}function e(){if("linearGradient"==this.type){var b=j(this.node,"x1")||0,c=j(this.node,"x2")||1,d=j(this.node,"y1")||0,e=j(this.node,"y2")||0;return a._.box(b,d,math.abs(c-b),math.abs(e-d))}var f=this.node.cx||.5,g=this.node.cy||.5,h=this.node.r||0;return a._.box(f-h,g-h,2*h,2*h)}function g(a,c){function d(a,b){for(var c=(b-l)/(a-m),d=m;a>d;d++)g[d].offset=+(+l+c*(d-m)).toFixed(2);m=a,l=b}var e,f=b("snap.util.grad.parse",null,c).firstDefined();if(!f)return null;f.params.unshift(a),e="l"==f.type.toLowerCase()?h.apply(0,f.params):i.apply(0,f.params),f.type!=f.type.toLowerCase()&&j(e.node,{gradientUnits:"userSpaceOnUse"});var g=f.stops,k=g.length,l=0,m=0;k--;for(var n=0;k>n;n++)"offset"in g[n]&&d(n,g[n].offset);for(g[k].offset=g[k].offset||100,d(k,g[k].offset),n=0;k>=n;n++){var o=g[n];e.addStop(o.color,o.offset)}return e}function h(b,f,g,h,i){var k=a._.make("linearGradient",b);return k.stops=c,k.addStop=d,k.getBBox=e,null!=f&&j(k.node,{x1:f,y1:g,x2:h,y2:i}),k}function i(b,f,g,h,i,k){var l=a._.make("radialGradient",b);return l.stops=c,l.addStop=d,l.getBBox=e,null!=f&&j(l.node,{cx:f,cy:g,r:h}),null!=i&&null!=k&&j(l.node,{fx:i,fy:k}),l}var j=a._.$;f.gradient=function(a){return g(this.defs,a)},f.gradientLinear=function(a,b,c,d){return h(this.defs,a,b,c,d)},f.gradientRadial=function(a,b,c,d,e){return i(this.defs,a,b,c,d,e)},f.toString=function(){var b,c=this.node.ownerDocument,d=c.createDocumentFragment(),e=c.createElement("div"),f=this.node.cloneNode(!0);return d.appendChild(e),e.appendChild(f),a._.$(f,{xmlns:"http://www.w3.org/2000/svg"}),b=e.innerHTML,d.removeChild(d.firstChild),b},f.clear=function(){for(var a,b=this.node.firstChild;b;)a=b.nextSibling,"defs"!=b.tagName?b.parentNode.removeChild(b):f.clear.call({node:b}),b=a}}()}),d.plugin(function(a,b){function c(a){var b=c.ps=c.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[K](c)&&c!=a&&(b[c].sleep--,!b[c].sleep&&delete b[c])}),b[a]}function d(a,b,c,d){return null==a&&(a=b=c=d=0),null==b&&(b=a.y,c=a.width,d=a.height,a=a.x),{x:a,y:b,width:c,w:c,height:d,h:d,x2:a+c,y2:b+d,cx:a+c/2,cy:b+d/2,r1:N.min(c,d)/2,r2:N.max(c,d)/2,r0:N.sqrt(c*c+d*d)/2,path:w(a,b,c,d),vb:[a,b,c,d].join(" ")}}function e(){return this.join(",").replace(L,"$1")}function f(a){var b=J(a);return b.toString=e,b}function g(a,b,c,d,e,f,g,h,j){return null==j?n(a,b,c,d,e,f,g,h):i(a,b,c,d,e,f,g,h,o(a,b,c,d,e,f,g,h,j))}function h(c,d){function e(a){return+(+a).toFixed(3)}return a._.cacher(function(a,f,h){a instanceof b&&(a=a.attr("d")),a=E(a);for(var j,k,l,m,n,o="",p={},q=0,r=0,s=a.length;s>r;r++){if(l=a[r],"M"==l[0])j=+l[1],k=+l[2];else{if(m=g(j,k,l[1],l[2],l[3],l[4],l[5],l[6]),q+m>f){if(d&&!p.start){if(n=g(j,k,l[1],l[2],l[3],l[4],l[5],l[6],f-q),o+=["C"+e(n.start.x),e(n.start.y),e(n.m.x),e(n.m.y),e(n.x),e(n.y)],h)return o;p.start=o,o=["M"+e(n.x),e(n.y)+"C"+e(n.n.x),e(n.n.y),e(n.end.x),e(n.end.y),e(l[5]),e(l[6])].join(),q+=m,j=+l[5],k=+l[6];continue}if(!c&&!d)return n=g(j,k,l[1],l[2],l[3],l[4],l[5],l[6],f-q)}q+=m,j=+l[5],k=+l[6]}o+=l.shift()+l}return p.end=o,n=c?q:d?p:i(j,k,l[0],l[1],l[2],l[3],l[4],l[5],1)},null,a._.clone)}function i(a,b,c,d,e,f,g,h,i){var j=1-i,k=R(j,3),l=R(j,2),m=i*i,n=m*i,o=k*a+3*l*i*c+3*j*i*i*e+n*g,p=k*b+3*l*i*d+3*j*i*i*f+n*h,q=a+2*i*(c-a)+m*(e-2*c+a),r=b+2*i*(d-b)+m*(f-2*d+b),s=c+2*i*(e-c)+m*(g-2*e+c),t=d+2*i*(f-d)+m*(h-2*f+d),u=j*a+i*c,v=j*b+i*d,w=j*e+i*g,x=j*f+i*h,y=90-180*N.atan2(q-s,r-t)/O;return{x:o,y:p,m:{x:q,y:r},n:{x:s,y:t},start:{x:u,y:v},end:{x:w,y:x},alpha:y}}function j(b,c,e,f,g,h,i,j){a.is(b,"array")||(b=[b,c,e,f,g,h,i,j]);var k=D.apply(null,b);return d(k.min.x,k.min.y,k.max.x-k.min.x,k.max.y-k.min.y)}function k(a,b,c){return b>=a.x&&a.x+a.width>=b&&c>=a.y&&a.y+a.height>=c}function l(a,b){return a=d(a),b=d(b),k(b,a.x,a.y)||k(b,a.x2,a.y)||k(b,a.x,a.y2)||k(b,a.x2,a.y2)||k(a,b.x,b.y)||k(a,b.x2,b.y)||k(a,b.x,b.y2)||k(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)}function m(a,b,c,d,e){var f=-3*b+9*c-9*d+3*e,g=a*f+6*b-12*c+6*d;return a*g-3*b+3*c}function n(a,b,c,d,e,f,g,h,i){null==i&&(i=1),i=i>1?1:0>i?0:i;for(var j=i/2,k=12,l=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],n=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],o=0,p=0;k>p;p++){var q=j*l[p]+j,r=m(q,a,c,e,g),s=m(q,b,d,f,h),t=r*r+s*s;o+=n[p]*N.sqrt(t)}return j*o}function o(a,b,c,d,e,f,g,h,i){if(!(0>i||i>n(a,b,c,d,e,f,g,h))){var j,k=1,l=k/2,m=k-l,o=.01;for(j=n(a,b,c,d,e,f,g,h,m);S(j-i)>o;)l/=2,m+=(i>j?1:-1)*l,j=n(a,b,c,d,e,f,g,h,m);return m}}function p(a,b,c,d,e,f,g,h){if(!(Q(a,c)<P(e,g)||P(a,c)>Q(e,g)||Q(b,d)<P(f,h)||P(b,d)>Q(f,h))){var i=(a*d-b*c)*(e-g)-(a-c)*(e*h-f*g),j=(a*d-b*c)*(f-h)-(b-d)*(e*h-f*g),k=(a-c)*(f-h)-(b-d)*(e-g);if(k){var l=i/k,m=j/k,n=+l.toFixed(2),o=+m.toFixed(2);if(!(+P(a,c).toFixed(2)>n||n>+Q(a,c).toFixed(2)||+P(e,g).toFixed(2)>n||n>+Q(e,g).toFixed(2)||+P(b,d).toFixed(2)>o||o>+Q(b,d).toFixed(2)||+P(f,h).toFixed(2)>o||o>+Q(f,h).toFixed(2)))return{x:l,y:m}}}}function q(a,b,c){var d=j(a),e=j(b);if(!l(d,e))return c?0:[];for(var f=n.apply(0,a),g=n.apply(0,b),h=~~(f/8),k=~~(g/8),m=[],o=[],q={},r=c?0:[],s=0;h+1>s;s++){var t=i.apply(0,a.concat(s/h));m.push({x:t.x,y:t.y,t:s/h})}for(s=0;k+1>s;s++)t=i.apply(0,b.concat(s/k)),o.push({x:t.x,y:t.y,t:s/k});for(s=0;h>s;s++)for(var u=0;k>u;u++){var v=m[s],w=m[s+1],x=o[u],y=o[u+1],z=.001>S(w.x-v.x)?"y":"x",A=.001>S(y.x-x.x)?"y":"x",B=p(v.x,v.y,w.x,w.y,x.x,x.y,y.x,y.y);if(B){if(q[B.x.toFixed(4)]==B.y.toFixed(4))continue;q[B.x.toFixed(4)]=B.y.toFixed(4);var C=v.t+S((B[z]-v[z])/(w[z]-v[z]))*(w.t-v.t),D=x.t+S((B[A]-x[A])/(y[A]-x[A]))*(y.t-x.t);C>=0&&1>=C&&D>=0&&1>=D&&(c?r++:r.push({x:B.x,y:B.y,t1:C,t2:D}))}}return r}function r(a,b){return t(a,b)}function s(a,b){return t(a,b,1)}function t(a,b,c){a=E(a),b=E(b);for(var d,e,f,g,h,i,j,k,l,m,n=c?0:[],o=0,p=a.length;p>o;o++){var r=a[o];if("M"==r[0])d=h=r[1],e=i=r[2];else{"C"==r[0]?(l=[d,e].concat(r.slice(1)),d=l[6],e=l[7]):(l=[d,e,d,e,h,i,h,i],d=h,e=i);for(var s=0,t=b.length;t>s;s++){var u=b[s];if("M"==u[0])f=j=u[1],g=k=u[2];else{"C"==u[0]?(m=[f,g].concat(u.slice(1)),f=m[6],g=m[7]):(m=[f,g,f,g,j,k,j,k],f=j,g=k);var v=q(l,m,c);if(c)n+=v;else{for(var w=0,x=v.length;x>w;w++)v[w].segment1=o,v[w].segment2=s,v[w].bez1=l,v[w].bez2=m;n=n.concat(v)}}}}}return n}function u(a,b,c){var d=v(a);return k(d,b,c)&&1==t(a,[["M",b,c],["H",d.x2+10]],1)%2}function v(a){var b=c(a);if(b.bbox)return J(b.bbox);if(!a)return d();a=E(a);for(var e,f=0,g=0,h=[],i=[],j=0,k=a.length;k>j;j++)if(e=a[j],"M"==e[0])f=e[1],g=e[2],h.push(f),i.push(g);else{var l=D(f,g,e[1],e[2],e[3],e[4],e[5],e[6]);h=h.concat(l.min.x,l.max.x),i=i.concat(l.min.y,l.max.y),f=e[5],g=e[6]}var m=P.apply(0,h),n=P.apply(0,i),o=Q.apply(0,h),p=Q.apply(0,i),q=d(m,n,o-m,p-n);return b.bbox=J(q),q}function w(a,b,c,d,f){if(f)return[["M",+a+ +f,b],["l",c-2*f,0],["a",f,f,0,0,1,f,f],["l",0,d-2*f],["a",f,f,0,0,1,-f,f],["l",2*f-c,0],["a",f,f,0,0,1,-f,-f],["l",0,2*f-d],["a",f,f,0,0,1,f,-f],["z"]];var g=[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]];return g.toString=e,g}function x(a,b,c,d,f){if(null==f&&null==d&&(d=c),a=+a,b=+b,c=+c,d=+d,null!=f)var g=Math.PI/180,h=a+c*Math.cos(-d*g),i=a+c*Math.cos(-f*g),j=b+c*Math.sin(-d*g),k=b+c*Math.sin(-f*g),l=[["M",h,j],["A",c,c,0,+(f-d>180),0,i,k]];else l=[["M",a,b],["m",0,-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]];return l.toString=e,l}function y(b){var d=c(b),g=String.prototype.toLowerCase;if(d.rel)return f(d.rel);a.is(b,"array")&&a.is(b&&b[0],"array")||(b=a.parsePathString(b));var h=[],i=0,j=0,k=0,l=0,m=0;"M"==b[0][0]&&(i=b[0][1],j=b[0][2],k=i,l=j,m++,h.push(["M",i,j]));for(var n=m,o=b.length;o>n;n++){var p=h[n]=[],q=b[n];if(q[0]!=g.call(q[0]))switch(p[0]=g.call(q[0]),p[0]){case"a":p[1]=q[1],p[2]=q[2],p[3]=q[3],p[4]=q[4],p[5]=q[5],p[6]=+(q[6]-i).toFixed(3),p[7]=+(q[7]-j).toFixed(3);break;case"v":p[1]=+(q[1]-j).toFixed(3);break;case"m":k=q[1],l=q[2];default:for(var r=1,s=q.length;s>r;r++)p[r]=+(q[r]-(r%2?i:j)).toFixed(3)}else{p=h[n]=[],"m"==q[0]&&(k=q[1]+i,l=q[2]+j);for(var t=0,u=q.length;u>t;t++)h[n][t]=q[t]}var v=h[n].length;switch(h[n][0]){case"z":i=k,j=l;break;case"h":i+=+h[n][v-1];break;case"v":j+=+h[n][v-1];break;default:i+=+h[n][v-2],j+=+h[n][v-1]}}return h.toString=e,d.rel=f(h),h}function z(b){var d=c(b);if(d.abs)return f(d.abs);if(I(b,"array")&&I(b&&b[0],"array")||(b=a.parsePathString(b)),!b||!b.length)return[["M",0,0]];var g,h=[],i=0,j=0,k=0,l=0,m=0;"M"==b[0][0]&&(i=+b[0][1],j=+b[0][2],k=i,l=j,m++,h[0]=["M",i,j]);for(var n,o,p=3==b.length&&"M"==b[0][0]&&"R"==b[1][0].toUpperCase()&&"Z"==b[2][0].toUpperCase(),q=m,r=b.length;r>q;q++){if(h.push(n=[]),o=b[q],g=o[0],g!=g.toUpperCase())switch(n[0]=g.toUpperCase(),n[0]){case"A":n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=+o[6]+i,n[7]=+o[7]+j;break;case"V":n[1]=+o[1]+j;break;case"H":n[1]=+o[1]+i;break;case"R":for(var s=[i,j].concat(o.slice(1)),t=2,u=s.length;u>t;t++)s[t]=+s[t]+i,s[++t]=+s[t]+j;h.pop(),h=h.concat(G(s,p));break;case"O":h.pop(),s=x(i,j,o[1],o[2]),s.push(s[0]),h=h.concat(s);break;case"U":h.pop(),h=h.concat(x(i,j,o[1],o[2],o[3])),n=["U"].concat(h[h.length-1].slice(-2));break;case"M":k=+o[1]+i,l=+o[2]+j;default:for(t=1,u=o.length;u>t;t++)n[t]=+o[t]+(t%2?i:j)}else if("R"==g)s=[i,j].concat(o.slice(1)),h.pop(),h=h.concat(G(s,p)),n=["R"].concat(o.slice(-2));else if("O"==g)h.pop(),s=x(i,j,o[1],o[2]),s.push(s[0]),h=h.concat(s);else if("U"==g)h.pop(),h=h.concat(x(i,j,o[1],o[2],o[3])),n=["U"].concat(h[h.length-1].slice(-2));else for(var v=0,w=o.length;w>v;v++)n[v]=o[v];if(g=g.toUpperCase(),"O"!=g)switch(n[0]){case"Z":i=+k,j=+l;break;case"H":i=n[1];break;case"V":j=n[1];break;case"M":k=n[n.length-2],l=n[n.length-1];default:i=n[n.length-2],j=n[n.length-1]}}return h.toString=e,d.abs=f(h),h}function A(a,b,c,d){return[a,b,c,d,c,d]}function B(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]}function C(b,c,d,e,f,g,h,i,j,k){var l,m=120*O/180,n=O/180*(+f||0),o=[],p=a._.cacher(function(a,b,c){var d=a*N.cos(c)-b*N.sin(c),e=a*N.sin(c)+b*N.cos(c);return{x:d,y:e}});if(k)y=k[0],z=k[1],w=k[2],x=k[3];else{l=p(b,c,-n),b=l.x,c=l.y,l=p(i,j,-n),i=l.x,j=l.y;var q=(N.cos(O/180*f),N.sin(O/180*f),(b-i)/2),r=(c-j)/2,s=q*q/(d*d)+r*r/(e*e);s>1&&(s=N.sqrt(s),d=s*d,e=s*e);var t=d*d,u=e*e,v=(g==h?-1:1)*N.sqrt(S((t*u-t*r*r-u*q*q)/(t*r*r+u*q*q))),w=v*d*r/e+(b+i)/2,x=v*-e*q/d+(c+j)/2,y=N.asin(((c-x)/e).toFixed(9)),z=N.asin(((j-x)/e).toFixed(9));y=w>b?O-y:y,z=w>i?O-z:z,0>y&&(y=2*O+y),0>z&&(z=2*O+z),h&&y>z&&(y-=2*O),!h&&z>y&&(z-=2*O)}var A=z-y;if(S(A)>m){var B=z,D=i,E=j;z=y+m*(h&&z>y?1:-1),i=w+d*N.cos(z),j=x+e*N.sin(z),o=C(i,j,d,e,f,0,h,D,E,[z,B,w,x])}A=z-y;var F=N.cos(y),G=N.sin(y),H=N.cos(z),I=N.sin(z),J=N.tan(A/4),K=4/3*d*J,L=4/3*e*J,M=[b,c],P=[b+K*G,c-L*F],Q=[i+K*I,j-L*H],R=[i,j];if(P[0]=2*M[0]-P[0],P[1]=2*M[1]-P[1],k)return[P,Q,R].concat(o);o=[P,Q,R].concat(o).join().split(",");for(var T=[],U=0,V=o.length;V>U;U++)T[U]=U%2?p(o[U-1],o[U],n).y:p(o[U],o[U+1],n).x;return T}function D(a,b,c,d,e,f,g,h){for(var i,j,k,l,m,n,o,p,q=[],r=[[],[]],s=0;2>s;++s)if(0==s?(j=6*a-12*c+6*e,i=-3*a+9*c-9*e+3*g,k=3*c-3*a):(j=6*b-12*d+6*f,i=-3*b+9*d-9*f+3*h,k=3*d-3*b),1e-12>S(i)){if(1e-12>S(j))continue;l=-k/j,l>0&&1>l&&q.push(l)}else o=j*j-4*k*i,p=N.sqrt(o),0>o||(m=(-j+p)/(2*i),m>0&&1>m&&q.push(m),n=(-j-p)/(2*i),n>0&&1>n&&q.push(n));for(var t,u=q.length,v=u;u--;)l=q[u],t=1-l,r[0][u]=t*t*t*a+3*t*t*l*c+3*t*l*l*e+l*l*l*g,r[1][u]=t*t*t*b+3*t*t*l*d+3*t*l*l*f+l*l*l*h;return r[0][v]=a,r[1][v]=b,r[0][v+1]=g,r[1][v+1]=h,r[0].length=r[1].length=v+2,{min:{x:P.apply(0,r[0]),y:P.apply(0,r[1])},max:{x:Q.apply(0,r[0]),y:Q.apply(0,r[1])}}}function E(a,b){var d=!b&&c(a);if(!b&&d.curve)return f(d.curve);for(var e=z(a),g=b&&z(b),h={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},j=(function(a,b,c){var d,e;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];switch(!(a[0]in{T:1,Q:1})&&(b.qx=b.qy=null),a[0]){case"M":b.X=a[1],b.Y=a[2];break;case"A":a=["C"].concat(C.apply(0,[b.x,b.y].concat(a.slice(1))));break;case"S":"C"==c||"S"==c?(d=2*b.x-b.bx,e=2*b.y-b.by):(d=b.x,e=b.y),a=["C",d,e].concat(a.slice(1));break;case"T":"Q"==c||"T"==c?(b.qx=2*b.x-b.qx,b.qy=2*b.y-b.qy):(b.qx=b.x,b.qy=b.y),a=["C"].concat(B(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1],b.qy=a[2],a=["C"].concat(B(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"].concat(A(b.x,b.y,a[1],a[2]));break;case"H":a=["C"].concat(A(b.x,b.y,a[1],b.y));break;case"V":a=["C"].concat(A(b.x,b.y,b.x,a[1]));break;case"Z":a=["C"].concat(A(b.x,b.y,b.X,b.Y))}return a}),k=function(a,b){if(a[b].length>7){a[b].shift();for(var c=a[b];c.length;)m[b]="A",g&&(n[b]="A"),a.splice(b++,0,["C"].concat(c.splice(0,6)));a.splice(b,1),r=Q(e.length,g&&g.length||0)}},l=function(a,b,c,d,f){a&&b&&"M"==a[f][0]&&"M"!=b[f][0]&&(b.splice(f,0,["M",d.x,d.y]),c.bx=0,c.by=0,c.x=a[f][1],c.y=a[f][2],r=Q(e.length,g&&g.length||0))},m=[],n=[],o="",p="",q=0,r=Q(e.length,g&&g.length||0);r>q;q++){e[q]&&(o=e[q][0]),"C"!=o&&(m[q]=o,q&&(p=m[q-1])),e[q]=j(e[q],h,p),"A"!=m[q]&&"C"==o&&(m[q]="C"),k(e,q),g&&(g[q]&&(o=g[q][0]),"C"!=o&&(n[q]=o,q&&(p=n[q-1])),g[q]=j(g[q],i,p),"A"!=n[q]&&"C"==o&&(n[q]="C"),k(g,q)),l(e,g,h,i,q),l(g,e,i,h,q);var s=e[q],t=g&&g[q],u=s.length,v=g&&t.length;h.x=s[u-2],h.y=s[u-1],h.bx=M(s[u-4])||h.x,h.by=M(s[u-3])||h.y,i.bx=g&&(M(t[v-4])||i.x),i.by=g&&(M(t[v-3])||i.y),i.x=g&&t[v-2],i.y=g&&t[v-1]}return g||(d.curve=f(e)),g?[e,g]:e}function F(a,b){if(!b)return a;var c,d,e,f,g,h,i;for(a=E(a),e=0,g=a.length;g>e;e++)for(i=a[e],f=1,h=i.length;h>f;f+=2)c=b.x(i[f],i[f+1]),d=b.y(i[f],i[f+1]),i[f]=c,i[f+1]=d;return a}function G(a,b){for(var c=[],d=0,e=a.length;e-2*!b>d;d+=2){var f=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}];b?d?e-4==d?f[3]={x:+a[0],y:+a[1]}:e-2==d&&(f[2]={x:+a[0],y:+a[1]},f[3]={x:+a[2],y:+a[3]}):f[0]={x:+a[e-2],y:+a[e-1]}:e-4==d?f[3]=f[2]:d||(f[0]={x:+a[d],y:+a[d+1]}),c.push(["C",(-f[0].x+6*f[1].x+f[2].x)/6,(-f[0].y+6*f[1].y+f[2].y)/6,(f[1].x+6*f[2].x-f[3].x)/6,(f[1].y+6*f[2].y-f[3].y)/6,f[2].x,f[2].y])}return c}var H=b.prototype,I=a.is,J=a._.clone,K="hasOwnProperty",L=/,?([a-z]),?/gi,M=parseFloat,N=Math,O=N.PI,P=N.min,Q=N.max,R=N.pow,S=N.abs,T=h(1),U=h(),V=h(0,1),W=a._unit2px,X={path:function(a){return a.attr("path")},circle:function(a){var b=W(a);return x(b.cx,b.cy,b.r)},ellipse:function(a){var b=W(a);return x(b.cx||0,b.cy||0,b.rx,b.ry)},rect:function(a){var b=W(a);return w(b.x||0,b.y||0,b.width,b.height,b.rx,b.ry)},image:function(a){var b=W(a);return w(b.x||0,b.y||0,b.width,b.height)},line:function(a){return"M"+[a.attr("x1")||0,a.attr("y1")||0,a.attr("x2"),a.attr("y2")]},polyline:function(a){return"M"+a.attr("points")},polygon:function(a){return"M"+a.attr("points")+"z"},deflt:function(a){var b=a.node.getBBox();return w(b.x,b.y,b.width,b.height)}};a.path=c,a.path.getTotalLength=T,a.path.getPointAtLength=U,a.path.getSubpath=function(a,b,c){if(1e-6>this.getTotalLength(a)-c)return V(a,b).end;var d=V(a,c,1);return b?V(d,b).end:d},H.getTotalLength=function(){return this.node.getTotalLength?this.node.getTotalLength():void 0},H.getPointAtLength=function(a){return U(this.attr("d"),a)},H.getSubpath=function(b,c){return a.path.getSubpath(this.attr("d"),b,c)},a._.box=d,a.path.findDotsAtSegment=i,a.path.bezierBBox=j,a.path.isPointInsideBBox=k,a.path.isBBoxIntersect=l,a.path.intersection=r,a.path.intersectionNumber=s,a.path.isPointInside=u,a.path.getBBox=v,a.path.get=X,a.path.toRelative=y,a.path.toAbsolute=z,a.path.toCubic=E,a.path.map=F,a.path.toString=e,a.path.clone=f}),d.plugin(function(a){var d=Math.max,e=Math.min,f=function(a){if(this.items=[],this.bindings={},this.length=0,this.type="set",a)for(var b=0,c=a.length;c>b;b++)a[b]&&(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},g=f.prototype;g.push=function(){for(var a,b,c=0,d=arguments.length;d>c;c++)a=arguments[c],a&&(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this},g.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},g.forEach=function(a,b){for(var c=0,d=this.items.length;d>c;c++)if(a.call(b,this.items[c],c)===!1)return this;return this},g.animate=function(d,e,f,g){"function"!=typeof f||f.length||(g=f,f=c.linear),d instanceof a._.Animation&&(g=d.callback,f=d.easing,e=f.dur,d=d.attr);var h=arguments;if(a.is(d,"array")&&a.is(h[h.length-1],"array"))var i=!0;var j,k=function(){j?this.b=j:j=this.b},l=0,m=g&&function(){l++==this.length&&g.call(this)};return this.forEach(function(a,c){b.once("snap.animcreated."+a.id,k),i?h[c]&&a.animate.apply(a,h[c]):a.animate(d,e,f,m)})},g.remove=function(){for(;this.length;)this.pop().remove();return this},g.bind=function(a,b,c){var d={};if("function"==typeof b)this.bindings[a]=b;else{var e=c||a;this.bindings[a]=function(a){d[e]=a,b.attr(d)}}return this},g.attr=function(a){var b={};for(var c in a)this.bindings[c]?this.bindings[c](a[c]):b[c]=a[c];for(var d=0,e=this.items.length;e>d;d++)this.items[d].attr(b);return this},g.clear=function(){for(;this.length;)this.pop()},g.splice=function(a,b){a=0>a?d(this.length+a,0):a,b=d(0,e(this.length-a,b));var c,g=[],h=[],i=[];for(c=2;arguments.length>c;c++)i.push(arguments[c]);for(c=0;b>c;c++)h.push(this[a+c]);for(;this.length-a>c;c++)g.push(this[a+c]);var j=i.length;for(c=0;j+g.length>c;c++)this.items[a+c]=this[a+c]=j>c?i[c]:g[c-j];for(c=this.items.length=this.length-=b-j;this[c];)delete this[c++];return new f(h)},g.exclude=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return this.splice(b,1),!0;return!1},g.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this},g.getBBox=function(){for(var a=[],b=[],c=[],f=[],g=this.items.length;g--;)if(!this.items[g].removed){var h=this.items[g].getBBox();a.push(h.x),b.push(h.y),c.push(h.x+h.width),f.push(h.y+h.height)}return a=e.apply(0,a),b=e.apply(0,b),c=d.apply(0,c),f=d.apply(0,f),{x:a,y:b,x2:c,y2:f,width:c-a,height:f-b,cx:a+(c-a)/2,cy:b+(f-b)/2}},g.clone=function(a){a=new f;for(var b=0,c=this.items.length;c>b;b++)a.push(this.items[b].clone());return a},g.toString=function(){return"Snap\u2018s set"},g.type="set",a.set=function(){var a=new f;return arguments.length&&a.push.apply(a,Array.prototype.slice.call(arguments,0)),a}}),d.plugin(function(a,c){function d(a){var b=a[0];switch(b.toLowerCase()){case"t":return[b,0,0];case"m":return[b,1,0,0,1,0,0];case"r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case"s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}}function e(b,c,e){c=m(c).replace(/\.{3}|\u2026/g,b),b=a.parseTransformString(b)||[],c=a.parseTransformString(c)||[];for(var f,g,h,k,l=Math.max(b.length,c.length),n=[],o=[],p=0;l>p;p++){if(h=b[p]||d(c[p]),k=c[p]||d(h),h[0]!=k[0]||"r"==h[0].toLowerCase()&&(h[2]!=k[2]||h[3]!=k[3])||"s"==h[0].toLowerCase()&&(h[3]!=k[3]||h[4]!=k[4])){b=a._.transform2matrix(b,e()),c=a._.transform2matrix(c,e()),n=[["m",b.a,b.b,b.c,b.d,b.e,b.f]],o=[["m",c.a,c.b,c.c,c.d,c.e,c.f]];break}for(n[p]=[],o[p]=[],f=0,g=Math.max(h.length,k.length);g>f;f++)f in h&&(n[p][f]=h[f]),f in k&&(o[p][f]=k[f])}return{from:j(n),to:j(o),f:i(n)}}function f(a){return a}function g(a){return function(b){return+b.toFixed(3)+a
}}function h(b){return a.rgb(b[0],b[1],b[2])}function i(a){var b,c,d,e,f,g,h=0,i=[];for(b=0,c=a.length;c>b;b++){for(f="[",g=['"'+a[b][0]+'"'],d=1,e=a[b].length;e>d;d++)g[d]="val["+h++ +"]";f+=g+"]",i[b]=f}return Function("val","return Snap.path.toString.call(["+i+"])")}function j(a){for(var b=[],c=0,d=a.length;d>c;c++)for(var e=1,f=a[c].length;f>e;e++)b.push(a[c][e]);return b}var k={},l=/[a-z]+$/i,m=String;k.stroke=k.fill="colour",c.prototype.equal=function(a,c){return b("snap.util.equal",this,a,c).firstDefined()},b.on("snap.util.equal",function(b,c){var d,n,o=m(this.attr(b)||""),p=this;if(o==+o&&c==+c)return{from:+o,to:+c,f:f};if("colour"==k[b])return d=a.color(o),n=a.color(c),{from:[d.r,d.g,d.b,d.opacity],to:[n.r,n.g,n.b,n.opacity],f:h};if("transform"==b||"gradientTransform"==b||"patternTransform"==b)return c instanceof a.Matrix&&(c=c.toTransformString()),a._.rgTransform.test(c)||(c=a._.svgTransform2string(c)),e(o,c,function(){return p.getBBox(1)});if("d"==b||"path"==b)return d=a.path.toCubic(o,c),{from:j(d[0]),to:j(d[1]),f:i(d[0])};if("points"==b)return d=m(o).split(a._.separator),n=m(c).split(a._.separator),{from:d,to:n,f:function(a){return a}};aUnit=o.match(l);var q=m(c).match(l);return aUnit&&aUnit==q?{from:parseFloat(o),to:parseFloat(c),f:g(aUnit)}:{from:this.asPX(b),to:this.asPX(b,c),f:f}})}),d.plugin(function(a,c,d,e){for(var f=c.prototype,g="hasOwnProperty",h=("createTouch"in e.doc),i=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","touchstart","touchmove","touchend","touchcancel"],j={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},k=(function(a,b){var c="y"==a?"scrollTop":"scrollLeft",d=b&&b.node?b.node.ownerDocument:e.doc;return d[c in d.documentElement?"documentElement":"body"][c]}),l=function(){this.returnValue=!1},m=function(){return this.originalEvent.preventDefault()},n=function(){this.cancelBubble=!0},o=function(){return this.originalEvent.stopPropagation()},p=function(){return e.doc.addEventListener?function(a,b,c,d){var e=h&&j[b]?j[b]:b,f=function(e){var f=k("y",d),i=k("x",d);if(h&&j[g](b))for(var l=0,n=e.targetTouches&&e.targetTouches.length;n>l;l++)if(e.targetTouches[l].target==a||a.contains(e.targetTouches[l].target)){var p=e;e=e.targetTouches[l],e.originalEvent=p,e.preventDefault=m,e.stopPropagation=o;break}var q=e.clientX+i,r=e.clientY+f;return c.call(d,e,q,r)};return b!==e&&a.addEventListener(b,f,!1),a.addEventListener(e,f,!1),function(){return b!==e&&a.removeEventListener(b,f,!1),a.removeEventListener(e,f,!1),!0}}:e.doc.attachEvent?function(a,b,c,d){var e=function(a){a=a||d.node.ownerDocument.window.event;var b=k("y",d),e=k("x",d),f=a.clientX+e,g=a.clientY+b;return a.preventDefault=a.preventDefault||l,a.stopPropagation=a.stopPropagation||n,c.call(d,a,f,g)};a.attachEvent("on"+b,e);var f=function(){return a.detachEvent("on"+b,e),!0};return f}:void 0}(),q=[],r=function(a){for(var c,d=a.clientX,e=a.clientY,f=k("y"),g=k("x"),i=q.length;i--;){if(c=q[i],h){for(var j,l=a.touches&&a.touches.length;l--;)if(j=a.touches[l],j.identifier==c.el._drag.id||c.el.node.contains(j.target)){d=j.clientX,e=j.clientY,(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var m=c.el.node;m.nextSibling,m.parentNode,m.style.display,d+=g,e+=f,b("snap.drag.move."+c.el.id,c.move_scope||c.el,d-c.el._drag.x,e-c.el._drag.y,d,e,a)}},s=function(c){a.unmousemove(r).unmouseup(s);for(var d,e=q.length;e--;)d=q[e],d.el._drag={},b("snap.drag.end."+d.el.id,d.end_scope||d.start_scope||d.move_scope||d.el,c);q=[]},t=i.length;t--;)(function(b){a[b]=f[b]=function(c,d){return a.is(c,"function")&&(this.events=this.events||[],this.events.push({name:b,f:c,unbind:p(this.node||document,b,c,d||this)})),this},a["un"+b]=f["un"+b]=function(a){for(var c=this.events||[],d=c.length;d--;)if(c[d].name==b&&(c[d].f==a||!a))return c[d].unbind(),c.splice(d,1),!c.length&&delete this.events,this;return this}})(i[t]);f.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)},f.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var u=[];f.drag=function(c,d,e,f,g,h){function i(i,j,k){(i.originalEvent||i).preventDefault(),this._drag.x=j,this._drag.y=k,this._drag.id=i.identifier,!q.length&&a.mousemove(r).mouseup(s),q.push({el:this,move_scope:f,start_scope:g,end_scope:h}),d&&b.on("snap.drag.start."+this.id,d),c&&b.on("snap.drag.move."+this.id,c),e&&b.on("snap.drag.end."+this.id,e),b("snap.drag.start."+this.id,g||f||this,j,k,i)}if(!arguments.length){var j;return this.drag(function(a,b){this.attr({transform:j+(j?"T":"t")+[a,b]})},function(){j=this.transform().local})}return this._drag={},u.push({el:this,start:i}),this.mousedown(i),this},f.undrag=function(){for(var c=u.length;c--;)u[c].el==this&&(this.unmousedown(u[c].start),u.splice(c,1),b.unbind("snap.drag.*."+this.id));return!u.length&&a.unmousemove(r).unmouseup(s),this}}),d.plugin(function(a,c,d){var e=(c.prototype,d.prototype),f=/^\s*url\((.+)\)/,g=String,h=a._.$;a.filter={},e.filter=function(b){var d=this;"svg"!=d.type&&(d=d.paper);var e=a.parse(g(b)),f=a._.id(),i=(d.node.offsetWidth,d.node.offsetHeight,h("filter"));return h(i,{id:f,filterUnits:"userSpaceOnUse"}),i.appendChild(e.node),d.defs.appendChild(i),new c(i)},b.on("snap.util.getattr.filter",function(){b.stop();var c=h(this.node,"filter");if(c){var d=g(c).match(f);return d&&a.select(d[1])}}),b.on("snap.util.attr.filter",function(d){if(d instanceof c&&"filter"==d.type){b.stop();var e=d.node.id;e||(h(d.node,{id:d.id}),e=d.id),h(this.node,{filter:a.url(e)})}d&&"none"!=d||(b.stop(),this.node.removeAttribute("filter"))}),a.filter.blur=function(b,c){null==b&&(b=2);var d=null==c?b:[b,c];return a.format('<feGaussianBlur stdDeviation="{def}"/>',{def:d})},a.filter.blur.toString=function(){return this()},a.filter.shadow=function(b,c,d,e,f){return"string"==typeof d&&(e=d,f=e,d=4),"string"!=typeof e&&(f=e,e="#000"),e=e||"#000",null==d&&(d=4),null==f&&(f=1),null==b&&(b=0,c=2),null==c&&(c=b),e=a.color(e),a.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',{color:e,dx:b,dy:c,blur:d,opacity:f})},a.filter.shadow.toString=function(){return this()},a.filter.grayscale=function(b){return null==b&&(b=1),a.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-b),b:.7152-.7152*(1-b),c:.0722-.0722*(1-b),d:.2126-.2126*(1-b),e:.7152+.2848*(1-b),f:.0722-.0722*(1-b),g:.2126-.2126*(1-b),h:.0722+.9278*(1-b)})},a.filter.grayscale.toString=function(){return this()},a.filter.sepia=function(b){return null==b&&(b=1),a.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-b),b:.769-.769*(1-b),c:.189-.189*(1-b),d:.349-.349*(1-b),e:.686+.314*(1-b),f:.168-.168*(1-b),g:.272-.272*(1-b),h:.534-.534*(1-b),i:.131+.869*(1-b)})},a.filter.sepia.toString=function(){return this()},a.filter.saturate=function(b){return null==b&&(b=1),a.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-b})},a.filter.saturate.toString=function(){return this()},a.filter.hueRotate=function(b){return b=b||0,a.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:b})},a.filter.hueRotate.toString=function(){return this()},a.filter.invert=function(b){return null==b&&(b=1),a.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:b,amount2:1-b})},a.filter.invert.toString=function(){return this()},a.filter.brightness=function(b){return null==b&&(b=1),a.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:b})},a.filter.brightness.toString=function(){return this()},a.filter.contrast=function(b){return null==b&&(b=1),a.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',{amount:b,amount2:.5-b/2})},a.filter.contrast.toString=function(){return this()}}),d});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Diagram",{DEFAULT_OPTIONS:{width:4e3,height:4e3,dragZoneWidth:250,backgroundImage:null,readonly:!1,graph:{nodes:[],edges:[]},onEdgeDeleted:function(){},onEdgeAdded:function(){},onEdgeMoved:function(){},onNodeDeleted:function(){},onNodeAdded:function(){},onNodeMoved:function(){},onNodeDblClick:function(){},onEdgeDblClick:function(){},onSelectionChange:function(){},states:{}},NODE_SELECTED_CLASS:"node-selected",EDGE_SELECTED_CLASS:"edge-selected",NODE_CONNECTABLE_CLASS:"node-connectable",UNCONNECTED_EDGE_CLASS:"edge-unconnected",NODE_SIZE:48,ARROW_SIZE:11,DIAMOND_SIZE:15,SOURCE_CONTROL_SIZE:7,RANK_OFFSET:20,LINE_LENGTH:15,TARGET_CONTROL_HITZONE_SIZE:SO.Browser.isTouchScreen()?30:15,SNAP_THRESHOLD:20,_getArrowPath:function(a,b){var c=this.ARROW_SIZE;return["M",a,b,"L",a-c,b-c/2,"L",a-c,b+c/2,"Z"].join(" ")},_getDiamondPath:function(a,b){var c=this.DIAMOND_SIZE;return["M",a,b,"L",a-c/2,b-c/2,"L",a-c,b,"L",a-c/2,b+c/2,"Z"].join(" ")},_getEdgePointPath:function(a,b,c){return a+=2,c?this._getArrowPath(a,b):this._getDiamondPath(a,b)},_getEdgeTargetControlHitZonePoint:function(a,b){return{x:a-this.TARGET_CONTROL_HITZONE_SIZE,y:b-this.TARGET_CONTROL_HITZONE_SIZE/2}},_getEdgeTargetBulletPoint:function(a,b){return{x:a-this.ARROW_SIZE/2,y:b}},_refreshIncomingEdges:function(a){var b,c,d,e=this._getNodeByName(a);for(d=0;e.incomingEdges.length>d;d++)b=this._getEdgeByName(e.incomingEdges[d]),c=this._getPathBetweenNodes(e.incomingEdges[d],b.source,a),this._updateEdge(b.name,c)},_refreshOutgoingEdges:function(a,b){var c,d,e,f=this._getNodeByName(a);for(e=0;f.outgoingEdges.length>e;e++){if(c=this._getEdgeByName(f.outgoingEdges[e]),this._isNode(c.target))d=this._getPathBetweenNodes(f.outgoingEdges[e],a,c.target);else{if(!b){var g=this._getBaseRankY(f,!1),h=this._getOutgoingRank(c.source,c.name),i=f.y+this.NODE_SIZE/2-g;c.target.y=i+h*this.RANK_OFFSET,this._options.onEdgeMoved(c)}d=this._getPathBetweenNodeAndPoint(f.outgoingEdges[e],a,c.target.x,c.target.y)}this._updateEdge(c.name,d)}},_refreshPaths:function(a,b){if(b=b||[],!~b.indexOf(a)){var c,d,e,f=this._getNodeByName(a);for(this._sortIncomingEdges(a),this._sortOutgoingEdges(a),e=0;f.outgoingEdges.length>e;e++)c=this._getEdgeByName(f.outgoingEdges[e]),this._isNode(c.target)&&(d=this._getPathBetweenNodes(f.outgoingEdges[e],a,c.target),this._updateEdge(c.name,d),this._refreshPaths(c.target,b.concat([a])));for(e=0;f.incomingEdges.length>e;e++)c=this._getEdgeByName(f.incomingEdges[e]),d=this._getPathBetweenNodes(f.incomingEdges[e],c.source,a),this._updateEdge(c.name,d)}},_updateEdge:function(a,b){var c=this._getEdgeByName(a),d=Snap.parsePathString(b),e=d.length,f=this._getEdgeLabelPoint(b),g=d[0][1],h=d[0][2],i=d[e-1][1],j=d[e-1][2],k=this._getEdgeTargetControlHitZonePoint(i,j),l=this._getEdgeTargetBulletPoint(i,j);c.sourceControl.attr({x:g-this.SOURCE_CONTROL_SIZE/2,y:h-this.SOURCE_CONTROL_SIZE/2}),c.labelElement.attr({x:f.x,y:f.y}),c.targetBullet.attr({cx:l.x,cy:l.y}),c.targetControlHitZone.attr({x:k.x,y:k.y}),c.targetControl.attr({path:this._getEdgePointPath(i,j,this._isNode(c.target))}),c.element.attr({path:b})},_connectNodeToEdge:function(a,b){var c=this._getNodeByName(b.source).group;c.after(b.group),b.target=a,this._getNodeByName(a).incomingEdges.push(b.name),this._options.onEdgeMoved(b)},_snapNode:function(a){var b=this._getNodeByName(a),c=b.y%this.SNAP_THRESHOLD;b.y=b.y-c,b.group.transform(b.group.transform().localMatrix.translate(0,-c))},_sortIncomingEdges:function(a){var b=this,c=function c(a,c){var d=b._getNodeByName(b._getEdgeByName(a).source)||a,e=b._getNodeByName(b._getEdgeByName(c).source)||c;return d.y-e.y};this._getNodeByName(a).incomingEdges.sort(c)},_sortOutgoingEdges:function(a){var b=this,c=function c(a,c){var d=b._getNodeByName(b._getEdgeByName(a).target)||a,e=b._getNodeByName(b._getEdgeByName(c).target)||c;return d.y-e.y};this._getNodeByName(a).outgoingEdges.sort(c)},_getRank:function(a,b,c){var d=this._getNodeByName(a),e=c?d.incomingEdges:d.outgoingEdges,f=e.indexOf(b);return f},_getIncomingRank:function(a,b){return this._getRank(a,b,!0)},_getOutgoingRank:function(a,b){return this._getRank(a,b,!1)},_getBaseRankY:function(a,b){var c=this.RANK_OFFSET,d=b?a.incomingEdges:a.outgoingEdges,e=d.length,f=~~(e/2)*c;return 0===e%2&&(f-=c/2),f},_getEdgeLabelPoint:function(a){a=Snap.parsePathString(a);for(var b=a[0][1],c=a[0][2],d=0;a.length>d&&!("h"===a[d][0]&&(b+=a[d][1],Math.abs(a[d][1])>this.LINE_LENGTH))&&("v"===a[d][0]&&(c+=a[d][1]),"L"!==a[d][0]);d++);return{x:b+5,y:c-5}},_getPathBetweenPoints:function(a,b,c,d,e){var f=[],g=15,h=30;if(f.push("M",b,c),f.push("h",g),Math.abs(b-d)<this.NODE_SIZE/2){var i=e>c?1:-1;f.push("v",i*(this.NODE_SIZE+h)),f.push("h",2*-this.NODE_SIZE),f.push("v",e-c-i*(this.NODE_SIZE+h))}else if(d>b)f.push("v",e+this.NODE_SIZE/2-(c+this.NODE_SIZE/2));else{var i=c>e?-1:1;f.push("v",i*(this.NODE_SIZE+h)),f.push("h",-(g+(b-d)+g)),f.push("v",i*(Math.abs(e-c)-(this.NODE_SIZE+h)))}return f.push("L",d,e),f.join(" ")},_getPathBetweenNodeAndPoint:function(a,b,c,d){var e,f=this._getNodeByName(b),g={x:f.x,y:f.y,x2:f.x+this.NODE_SIZE,height:this.NODE_SIZE},h=this._getOutgoingRank(b,a),i=this._getBaseRankY(f,!1),j=g.y+g.height/2-i,k=g.x2+10,l=j+h*this.RANK_OFFSET;return e=this._getPathBetweenPoints(a,k,l,c,d)},_getPathBetweenNodes:function(a,b,c){var d,e=this._getNodeByName(b),f=this._getNodeByName(c),g={x:e.x,y:e.y,x2:e.x+this.NODE_SIZE,height:this.NODE_SIZE},h={x:f.x,y:f.y,height:this.NODE_SIZE},i=this._getOutgoingRank(b,a),j=this._getIncomingRank(c,a),k=this._getBaseRankY(e,!1),l=this._getBaseRankY(f,!0),m=g.y+g.height/2-k,n=h.y+h.height/2-l,o=g.x2+10,p=m+i*this.RANK_OFFSET,q=h.x-10,r=n+j*this.RANK_OFFSET;return d=this._getPathBetweenPoints(a,o,p,q,r)},_renderEdge:function(a){var b,c,d,e=this,f=a.name,g=this._getNodeByName(a.source),h=this._getNodeByName(a.target)||a.target,i=!!h;if(this._sortOutgoingEdges(g.name),h&&h.name)this._sortIncomingEdges(h.name),b=this._getPathBetweenNodes(f,g.name,h.name);else{if(!h){var j=this._getBaseRankY(g,!1),k=this._getOutgoingRank(a.source,f),l=g.y+this.NODE_SIZE/2-j,m=g.x+3*this.NODE_SIZE,n=l+k*this.RANK_OFFSET;h={x:m,y:n},a.target=h}b=this._getPathBetweenNodeAndPoint(f,g.name,h.x,h.y)}c=Snap.parsePathString(b),d=this._getEdgeLabelPoint(b),a.labelElement=this._paper.text(d.x,d.y,a.label).addClass("edge-label"),a.sourceControl=this._paper.el("rect",{x:c[0][1]-this.SOURCE_CONTROL_SIZE/2,y:c[0][2]-this.SOURCE_CONTROL_SIZE/2,width:this.SOURCE_CONTROL_SIZE,height:this.SOURCE_CONTROL_SIZE});var o=this._getEdgeTargetControlHitZonePoint(c[c.length-1][1],c[c.length-1][2]);a.targetControlHitZone=this._paper.el("rect",{x:o.x,y:o.y,width:1.1*this.TARGET_CONTROL_HITZONE_SIZE,height:1.1*this.TARGET_CONTROL_HITZONE_SIZE,stroke:"none","fill-opacity":0});var p=this._getEdgeTargetBulletPoint(c[c.length-1][1],c[c.length-1][2]);return a.targetBullet=this._paper.el("circle",{cx:p.x,cy:p.y,r:17.5,display:"none"}).addClass("edge-target-bullet"),a.targetControl=this._paper.path(this._getEdgePointPath(c[c.length-1][1],c[c.length-1][2],this._isNode(a.target))).attr("cursor","pointer"),this._initControlDrag(a.name,a.targetControlHitZone),a.element=this._paper.path(b).addClass("edge-path"),a.group=this._paper.g(a.element,a.sourceControl,a.targetBullet,a.targetControl,a.targetControlHitZone,a.labelElement).addClass("edge"),h&&!h.name&&(g.outgoingEdgesGroup.add(a.group),a.group.addClass(this.UNCONNECTED_EDGE_CLASS)),SO.Event.bind(a.element.node,"dblclick",function(){e._options.onEdgeDblClick(a)},{duration:300}),this._refreshOutgoingEdges(a.source,i),this._isNode(a.target)&&this._refreshIncomingEdges(a.target),SO.Event.bind(a.group.node,"vclick",function(){e._clearSelectedElements(),e._selectedElements.add(a),e._selectEdge(a.name,!0),e._options.onSelectionChange(e._selectedElements.toArray())}),a.target},_renderNode:function(a,b){b="boolean"==typeof b?b:!0;var c=this,d=a.name,e=a.label,f=a.x,g=a.y,h=a.dblclick||this._options.onNodeDblClick,i=a.backgroundColor,j=this.NODE_SIZE,k=this._paper.text(f+j/2,g+j+10,this._splitString(e,this.LINE_LENGTH)),l=this._paper.el("rect",{x:0,y:0,width:j,height:j,"stroke-width":"2px",stroke:"white",fill:"none"}).addClass("node-outline"),m=c._paper.image(a.overlayImg||a.img,0,0,j,j).attr("opacity",a.overlayImg?1:0),n=k.selectAll("tspan");n.length&&(n.attr({x:f+j/2,dy:"1.2em","text-anchor":"middle"}).forEach(function(a){a.addClass("node-label")}),n[0].attr("dy","0.5em")),a.outgoingEdgesGroup=this._paper.g(),a.element=this._paper.g(),a.outline=l,a.iconOverlay=m,a.labelEl=k,a.group=this._paper.group(a.element,a.labelEl,a.outgoingEdgesGroup),this._nodesGroup.add(a.group),Snap.load(a.img,function(e){var k=c._paper.el("rect",{x:0,y:0,width:j,height:j}).addClass(c._options.states.nodeBackgrounds[i]+" "+"node-background"),l=e.select("g").addClass("node-icon");a.element.add(k,l,a.outline,a.iconOverlay),a.element.attr("cursor","pointer"),a.backgroundImage=k,a.icon=l,a.element.transform("T"+[f,g]),b&&!c._selectionMode&&c._initNodeDrag(d),SO.Event.bind(a.element.node,"dblclick",function(){h(a)},{duration:300}),SO.Event.bind(a.group.node,"longtouch",{onPress:function(){h(a)}},{duration:1e3,stopPropagation:!1}),a.tooltip&&c.setNodeDescription(a.name,a.tooltip)});var o=this._selectedElements.find(a);o&&(this._selectedElements.remove(o),this._selectedElements.add(a),this._selectNode(a.name,!0))},_splitString:function(a,b){for(var c=a.split(" "),d=[],e="",f=0;c.length>f;f++)b>(e+" "+c[f]).length?e+=(e?" ":"")+c[f]:(e&&d.push(e),e=c[f]);return e&&d.push(e),d},_getEdgeAtPoint:function(a,b){for(var c,d,e,f,g,h,i,j=0,k=this._graph.edges.length;k>j;j++)if(c=this._graph.edges[j].target,!this._isNode(c)&&(d=~~(this.NODE_SIZE/this.ARROW_SIZE),e=c.x-this.ARROW_SIZE*(d/2),f=c.y-this.ARROW_SIZE*(d/2),g=this.ARROW_SIZE*d,h=a+this.NODE_SIZE/2,i=b+this.NODE_SIZE/2,h>=e&&e+g>=h&&i>=f&&f+g>=i))return this._graph.edges[j];return null},_initNodeDrag:function(a){var b,c=this,d=c._getNodeByName(a),e=function(a,c){var e=b+(b?"T":"t")+[a,c];d.group.transform(e)},f=function(a,e,f){c._options.readonly||(f.stopPropagation(),b=d.group.transform().local,this.oldPosition={x:d.x,y:d.y},this.copy=d.group.clone(),this.copy.addClass("ghost"),this.attr("cursor","move")),c._clearSelectedElements(d),c._selectedElements.contains(d)||(c._selectNode(d.name,!d.element.hasClass(c.NODE_SELECTED_CLASS)),c._selectedElements.add(d)),c._options.onSelectionChange(c._selectedElements.toArray())},g=function(){if(!c._options.readonly){this.attr("cursor","pointer"),this.copy.remove(),this.copy=null,d.x=d.element.transform().globalMatrix.e,d.y=d.element.transform().globalMatrix.f,(d.x!==this.oldPosition.x||d.y!==this.oldPosition.y)&&c._snapNode(d.name);var e,f,g=d.x,h=d.outgoingEdges.some(function(a){return c._isNode(c._getEdgeByName(a).target)});if(0>g||g>c._options.width||0>d.y||d.y>c._options.height)return d.group.transform(b),d.x=this.oldPosition.x+d.group.transform().localMatrix.e,d.y=this.oldPosition.y+d.group.transform().localMatrix.f,void 0;e=c._getEdgeAtPoint(g,d.y),e&&e.source!==d.name&&(c._connectNodeToEdge(a,e),e.group.removeClass(c.UNCONNECTED_EDGE_CLASS)),(d.incomingEdges.length||h)&&c._refreshPaths(a);for(var i=0;d.outgoingEdges.length>i;i++)f=c._getEdgeByName(d.outgoingEdges[i]),c._isNode(f.target)||d.x===this.oldPosition.x&&d.y===this.oldPosition.y||(f.target={x:f.target.x+(d.x-this.oldPosition.x),y:f.target.y+(d.y-this.oldPosition.y)},c._options.onEdgeMoved(f));(d.x!==this.oldPosition.x||d.y!==this.oldPosition.y)&&(c._selectNode(d.name,!0),c._options.onNodeMoved(d,this.oldPosition))}};d.element.undrag(),d.element.drag(SO.Utils.throttle(e,20),f,g)},_initControlDrag:function(a,b){var c=this,d=this._getEdgeByName(a),e=function(a,b){var e=this.ox+a-(c._isNode(d.target)?this.transformMatrix.e:0),f=this.oy+b-(c._isNode(d.target)?this.transformMatrix.f:0);this.x=e-(c._isNode(d.target)?0:this.transformMatrix.e),this.y=f-(c._isNode(d.target)?0:this.transformMatrix.f);var g=Snap.parsePathString(d.element.attr("path")),h=c._getPathBetweenPoints(d.name,g[0][1],g[0][2],this.x,this.y),i=c._getEdgeLabelPoint(h);d.element.attr("path",h),d.labelElement.attr({x:i.x,y:i.y});var j=c._getEdgeTargetBulletPoint(this.x,this.y);d.targetBullet.attr({cx:j.x,cy:j.y});var k=c._getEdgeTargetControlHitZonePoint(this.x,this.y);this.attr({x:k.x,y:k.y}),d.targetControl.attr({path:c._getEdgePointPath(this.x,this.y,c._isNode(d.target))});for(var l=0,m=c._graph.nodes.length;m>l;l++){var n=c._graph.nodes[l],o={x:n.x,y:n.y,x2:n.x+c.NODE_SIZE,y2:n.y+c.NODE_SIZE};n.element.toggleClass(c.NODE_CONNECTABLE_CLASS,e>=o.x&&o.x2>=e&&f>=o.y&&o.y2>=f)}},f=function(b,e,f){f.stopPropagation();var g,h;c._clearSelectedElements(),c._selectedElements.add(d),c._selectEdge(d.name,!0),c._options.onSelectionChange(c._selectedElements.toArray()),this.transformMatrix=c._getNodeByName(d.source).group.transform().globalMatrix,d.group.addClass("edge-hover"),d.group.removeClass(c.UNCONNECTED_EDGE_CLASS),d.targetBullet.attr("display",""),c._isNode(d.target)?(g=c._getNodeByName(d.target),h=g.incomingEdges.indexOf(a),g.incomingEdges.splice(h,1),this.ox=g.x-10+this.transformMatrix.e,this.oy=g.y+c.NODE_SIZE/2+this.transformMatrix.f):(this.ox=d.target.x,this.oy=d.target.y),c._draggedEdgeGroup.transform(c._isNode(d.target)?"":d.group.transform().global),c._draggedEdgeGroup.add(d.group)},g=function(){var a,b,e=!1,f=this.x+(c._isNode(d.target)?0:this.transformMatrix.e),g=this.y+(c._isNode(d.target)?0:this.transformMatrix.f);d.group.removeClass("edge-hover");for(var h=0,i=c._graph.nodes.length;i>h;h++)if(a=c._graph.nodes[h],b={x:a.x,y:a.y,x2:a.x+c.NODE_SIZE,y2:a.y+c.NODE_SIZE},f>=b.x&&b.x2>=f&&g>=b.y&&b.y2>=g&&a.name!==d.source){c._connectNodeToEdge(a.name,d),a.element.removeClass(c.NODE_CONNECTABLE_CLASS),a.incomingEdges.length&&c._refreshPaths(a.name),e=!0;break}if(e)d.group.removeClass(c.UNCONNECTED_EDGE_CLASS);else{var j=c._getNodeByName(d.source),k=this.x,l=this.y;if(void 0===k||void 0===l)return d.targetBullet.attr("display","none"),d.group.addClass(c.UNCONNECTED_EDGE_CLASS),void 0;c._isNode(d.target)?(j.outgoingEdgesGroup.add(d.group),d.sourceControl.attr({x:+d.sourceControl.attr("x")-this.transformMatrix.e,y:+d.sourceControl.attr("y")-this.transformMatrix.f}),d.labelElement.attr({x:+d.labelElement.attr("x")-this.transformMatrix.e,y:+d.labelElement.attr("y")-this.transformMatrix.f}),k-=this.transformMatrix.e,l-=this.transformMatrix.f):j&&j.outgoingEdgesGroup.add(d.group),d.target={x:k+this.transformMatrix.e,y:l+this.transformMatrix.f};var m=c._getEdgeTargetBulletPoint(k,l);d.targetBullet.attr({cx:m.x,cy:m.y});var n=c._getEdgeTargetControlHitZonePoint(k,l);this.attr({x:n.x,y:n.y}),d.targetControl.attr("path",c._getEdgePointPath(k,l,!1));var o=c._getPathBetweenPoints(d.name,+d.sourceControl.attr("x")+c.SOURCE_CONTROL_SIZE/2,+d.sourceControl.attr("y")+c.SOURCE_CONTROL_SIZE/2,k,l);d.element.attr("path",o),d.group.addClass(c.UNCONNECTED_EDGE_CLASS)}d.targetBullet.attr("display","none"),this.attr("cursor","pointer"),c._options.onEdgeMoved(d)};c._options.readonly||b.drag(SO.Utils.throttle(e,20),f,g)},_isNode:function(a){return"string"==typeof a},_generateID:function(a,b,c){var d=new RegExp("^"+c.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")+"(?:"+"(\\d*)"+")?"+"$"),e=this._graph[a].reduce(function(a,c){var e=d.exec(c[b]);return e?e[1]||0!==a?+e[1]>a?+e[1]:a:1:a},0);return e+1},getNewNodeIndex:function(a){return this._generateID("nodes","name",a,!1)},_getElementByName:function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c].name===b)return a[c];return null},_getEdgeByName:function(a){return this._edgeCache=this._edgeCache||{},this._edgeCache[a]||(this._edgeCache[a]=this._getElementByName(this._graph.edges,a)),this._edgeCache[a]},_getNodeByName:function(a){return this._nodeCache=this._nodeCache||{},this._nodeCache[a]||(this._nodeCache[a]=this._getElementByName(this._graph.nodes,a)),this._nodeCache[a]},_selectNode:function(a,b){var c=this._getNodeByName(a);return b?(c.state=c.element.hasClass(this.NODE_SELECTED_CLASS)?c.state:c.element.node.className.baseVal,null!==c.state&&(c.element.removeClass(c.state),c.element.addClass(this.NODE_SELECTED_CLASS))):(null!==c.state&&c.element.addClass(c.state),c.element.removeClass(this.NODE_SELECTED_CLASS)),this},_selectEdge:function(a,b){var c=this._getEdgeByName(a);return b?c.group.addClass(this.EDGE_SELECTED_CLASS):c.group.removeClass(this.EDGE_SELECTED_CLASS),this},_clearSelectedElementsFromGroup:function(){var a=this._selectedElements.toArray();if(this._selectedElementsGroup.node.childNodes.length){for(var b=0;a.length>b;b++){var c=a[b].group.transform().local,d=this._selectedElementsGroup.transform().localMatrix,e=d.e,f=d.f,g=c+(c?"T":"t")+[e,f];a[b].group.transform(g),this._refreshPaths(a[b].name),this._selectedElementsGroup.after(a[b].group);for(var h=a[b].outgoingEdges,i=0;h.length>i;i++){var j=this._getEdgeByName(h[i]);this._isNode(j.target)||(j.target={x:j.target.x+e,y:j.target.y+f},this._options.onEdgeMoved(j))}this._options.onNodeMoved(a[b],{x:a[b].x-e,y:a[b].y-f})}this._selectedElementsGroup.transform("")}},_clearSelectedElements:function(a){var b=this._selectedElements.toArray();this._clearSelectedElementsFromGroup();for(var c=0;b.length>c;c++)b[c].target?b[c]!==a&&(this._selectEdge(b[c].name,!1),this._selectedElements.remove(b[c])):b[c].outline?b[c]!==a&&(this._initNodeDrag(b[c].name),this._selectNode(b[c].name,!1),this._selectedElements.remove(b[c])):this._selectedElements.remove(b[c]);this._options.onSelectionChange(this._selectedElements.toArray())},_clearSelectedEdges:function(){for(var a=this._selectedElements.toArray(),b=0;a.length>b;b++)a[b].source&&(this._selectEdge(a[b].name,!1),this._selectedElements.remove(a[b]))},_initSelectedNodesDrag:function(){var a=this;if(!a._options.readonly)for(var b,c,d=this._selectedElements.toArray(),e=0;d.length>e;e++)d[e].element.undrag(),d[e].element.drag(SO.Utils.throttle(function(c,d){a._selectedElementsGroup.transform(b+(b?"T":"t")+[c,d])},20),function(e,f,g){g.stopPropagation(),a._selectedElementsGroup.add(d.map(function(a){return a.group})),b=a._selectedElementsGroup.transform().local,c=a._selectedElementsGroup.clone().addClass("ghost")},function(){c.remove();var d=a._selectedElements.toArray(),e=d.some(function(b){var c=b.element.transform().globalMatrix,d=c.e,e=c.f;return 0>d||d>a._options.width||0>e||e>a._options.height});if(e)a._selectedElementsGroup.transform(b);else for(var f=0;d.length>f;f++){var g=d[f].element.transform().globalMatrix;d[f].x=g.e,d[f].y=g.f,a._snapNode(d[f].name),a._refreshPaths(d[f].name)}a._clearSelectedElements()})},_initSelectBox:function(){var a,b=this,c=function(c,d){var e=0,f=0;a&&(0>c&&(e=c,c=-1*c),0>d&&(f=d,d=-1*d),b._selectBox.transform("T"+[e,f]),b._selectBox.attr({width:c,height:d}))},d=function(c,d){a=!0,b._clearSelectedElements(),b._selectBox.attr({x:c-b.$el.offset().left+b.$el.scrollLeft(),y:d-b.$el.offset().top+b.$el.scrollTop(),width:0,height:0})},e=function(){if(a=!1,+b._selectBox.attr("width")){for(var c=b._selectBox.transform().globalMatrix,d=+b._selectBox.attr("x")+c.e,e=+b._selectBox.attr("y")+c.f,f=d+ +b._selectBox.attr("width"),g=e+ +b._selectBox.attr("height"),h=[],i=0,j=b._graph.nodes;j.length>i;i++)j[i].x+b.NODE_SIZE/2>d&&f>j[i].x&&j[i].y+b.NODE_SIZE/2>e&&g>j[i].y&&(b._selectNode(j[i].name,!0),h.push(j[i]));b._clearSelectedElements(),b._selectedElements.add(h),b._selectBox.attr({width:0,height:0}),b._initSelectedNodesDrag()}b._options.onSelectionChange(b._selectedElements.toArray())};this._paper.undrag(),this._paper.drag(SO.Utils.throttle(c,20),d,e)},_initGraph:function(a){if(this._graph=SO.Utils.extend(!0,{},a),this._canvas=this._paper.group(),"string"!=typeof this._options.backgroundImage){this._canvas.add(this._paper.rect(0,0,this._options.width,this._options.height).attr({fill:"#eee",stroke:"#ccc"}));for(var b=0;this._options.width>b;b+=50)this._canvas.add(this._paper.path(["M",b,0,"v",this._options.height].join(" ")).attr({stroke:"#ddd","stroke-width":"0.5px"}));for(var c=0;this._options.height>c;c+=50)this._canvas.add(this._paper.path(["M",0,c,"h",this._options.width].join(" ")).attr({stroke:"#ddd","stroke-width":"0.5px"}))}if(Array.isArray(this._options.backgroundImage))for(var b=0;this._options.width>b;)for(var d=0;this._options.backgroundImage.length>d&&this._options.width>b;d++){var e=this._options.backgroundImage[d];this._canvas.add(this._paper.rect(b,0,e.width||this._options.width-b,this._options.height).attr({fill:e.color,"fill-opacity":.1,stroke:"#333","stroke-width":"0.1px"})),this._canvas.add(this._paper.text(b+10,25,e.title).attr({"font-family":"AdobeClean","font-size":"22px","text-anchor":"start",fill:"#4B4B4B"})),b+=e.width}else"string"==typeof this._options.backgroundImage&&this._canvas.add(this._paper.image("/xtk/img/workflow/"+this._options.backgroundImage,0,0,775,542));this._graph&&(this._nodesGroup=this._paper.g(),this._renderGraph(this._graph))},_renderGraph:function(a){this._selectionMode=!!a.selectionMode;var b=2>a.selectedNodes.length;if(a.nodes){for(var c=0,d=a.nodes.length;d>c;c++)this._graph.nodes[c]=SO.Utils.extend({},a.nodes[c],{outgoingEdges:[],incomingEdges:[]}),this._renderNode(this._graph.nodes[c],b);for(var c=0,d=a.edges.length;d>c;c++)this._graph.edges[c]=SO.Utils.extend({},a.edges[c]),this._getNodeByName(this._graph.edges[c].source).outgoingEdges.push(this._graph.edges[c].name),this._isNode(this._graph.edges[c].target)&&this._getNodeByName(this._graph.edges[c].target).incomingEdges.push(a.edges[c].name),this._renderEdge(this._graph.edges[c]);if(a.selectedNodes.length)for(var c=0;a.selectedNodes.length>c;c++){var e=this._getNodeByName(a.selectedNodes[c]);this._selectedElementsGroup.add(e.group),this._selectedElements.add(e),this._selectNode(e.name,!0)}this.enableSelectionMode(this._selectionMode)}},setNodeIcon:function(a,b){var c=this._getNodeByName(a);return c&&Snap.load(b,function(a){var b=a.select("g").addClass("node-icon");c.icon.remove(),c.element.add(b),c.icon=b}),this},setNodeIconOverlay:function(a,b){var c=this._getNodeByName(a);return c&&c.iconOverlay.attr({href:b||c.img,opacity:b?1:0}),this},resetState:function(){for(var a=0,b=this._graph.nodes.length;b>a;a++){var c=this._graph.nodes[a];c.element.node.className.baseVal=this._selectedElements.contains(c)?this.NODE_SELECTED_CLASS:""}for(var a=0,b=this._graph.edges.length;b>a;a++){var d=this._graph.edges[a];this._isNode(d.target)&&(d.group.node.className.baseVal="edge")}},setNodeState:function(a,b){var c=this._getNodeByName(a);return c?(c.element.node.className.baseVal="",c.element.addClass(this._options.states.nodeStates[b]),this._selectedElements.contains(c)&&this._selectNode(a,!0),this):this},setNodeDescription:function(a,b){var c=this._getNodeByName(a);return c?(c.tooltip=b,c.tooltipEl=new SO.Widgets.Tooltip(c.labelEl.node,{gravity:"n"}),c.labelEl.attr("original-title",c.tooltip),c.labelEl.attr("cursor","pointer"),this):this},setEdgeDescription:function(a,b,c){var d=this._getEdgeByName(a);return d?(d.label=d.label,d.labelElement.attr({text:b,"original-title":c}),new SO.Widgets.Tooltip(d.labelElement.node,{gravity:"s"}),this):this},setEdgeState:function(a,b){var c=this._getEdgeByName(a);return c?(c.group.node.className.baseVal="edge",c.group.addClass(this._options.states.edgeStates[b]),this):this},addNode:function(a){var b=SO.Utils.extend({},a),c=this._getEdgeAtPoint(b.x,b.y);c&&(b.x=c.target.x,b.y=c.target.y-this.NODE_SIZE/2,setTimeout(function(){this._options.onNodeMoved(b,{x:b.x,y:b.y})}.bind(this))),this._graph.nodes.push(SO.Utils.extend(b,{outgoingEdges:[],incomingEdges:[]})),this._renderNode(b),this._options.onNodeAdded(b),c&&(c.group.removeClass(this.UNCONNECTED_EDGE_CLASS),this._connectNodeToEdge(b.name,c),this._refreshPaths(b.name)),this._clearSelectedElements(),this._selectNode(b.name,!0),this._selectedElements.add(this._getNodeByName(b.name)),this._options.onSelectionChange(this._selectedElements.toArray())},removeNode:function(a,b){for(var c,d,e,f,g,h,i,j,k=this._getNodeByName(a),l=this._graph.nodes.indexOf(this._getNodeByName(a)),m=[],n=0;k.incomingEdges.length>n;n++){c=this._getEdgeByName(k.incomingEdges[n]),d=this._getNodeByName(c.source),j=Snap.parsePathString(c.targetControl),e=d.group.transform().globalMatrix,f=+c.sourceControl.attr("x")+this.SOURCE_CONTROL_SIZE/2-e.e,g=+c.sourceControl.attr("y")+this.SOURCE_CONTROL_SIZE/2-e.f,h=j[0][1]-e.e,i=j[0][2]-e.f,c.sourceControl.attr({x:f-this.SOURCE_CONTROL_SIZE/2,y:g-this.SOURCE_CONTROL_SIZE/2}),c.group.addClass(this.UNCONNECTED_EDGE_CLASS),c.element.attr("path",this._getPathBetweenPoints(c.name,f,g,h,i));var o=this._getEdgeTargetBulletPoint(h,i);c.targetBullet.attr({cx:o.x,cy:o.y});var p=this._getEdgeTargetControlHitZonePoint(h,i);c.targetControlHitZone.attr({x:p.x,y:p.y}),c.targetControl.attr("path",this._getEdgePointPath(h,i,!1)),c.target={x:h,y:i},d.outgoingEdgesGroup.add(c.group),m.push(c)}for(var n=0;k.outgoingEdges.length>n;n++)c=this._getEdgeByName(k.outgoingEdges[n]),this.removeEdge(c.name,b),n--;k.element.undrag(),k.element.remove(),delete this._nodeCache[a],this._selectedElements.remove(k),this._options.onSelectionChange(this._selectedElements.toArray()),SO.Event.unbind(k.group.node,"longtouch"),SO.Event.unbind(k.element.node,"dblclick"),k.group.remove(),k.outgoingEdgesGroup.remove(),this._graph.nodes.splice(l,1),b&&this._options.onNodeDeleted(k,m),k=null},addEdge:function(a){var b=SO.Utils.extend({},a),c=this._getNodeByName(b.source),d=this._getNodeByName(b.target);this._graph.edges.push(b),c.outgoingEdges.push(b.name),d&&d.incomingEdges.push(b.name);var e=this._renderEdge(b);return a.propagate&&this._options.onEdgeAdded(b,c.type),e},removeEdge:function(a,b){var c,d=this._getEdgeByName(a),e=this._getNodeByName(d.source),f=this._getNodeByName(d.target),g=this._graph.edges.indexOf(d),h=e.outgoingEdges.indexOf(d.name);f&&(c=f.incomingEdges.indexOf(d.name),f.incomingEdges.splice(c,1)),e.outgoingEdges.splice(h,1),delete this._edgeCache[a],SO.Event.unbind(d.element.node,"dblclick"),d.element.remove(),d.labelElement.remove(),d.sourceControl.remove(),d.targetControl.remove(),this._graph.edges.splice(g,1),b&&this._options.onEdgeDeleted(d,e.type)},refreshGraph:function(a){for(var b=this._graph.nodes&&this._graph.nodes.length||0;b--;)this.removeNode(this._graph.nodes[0].name);this._selectedElements.clear(),this._selectedElementsGroup.transform(""),this._graph=SO.Utils.extend(!0,{},a),this._renderGraph(this._graph)},enableSelectionMode:function(a){var b=this;if(a){this._clearSelectedEdges(),this._paper.undrag();for(var c=0;this._graph.nodes.length>c;c++){var d=this._graph.nodes[c];d.element.undrag(),d.element.drag(function(){},function(){var a=this.element.hasClass(b.NODE_SELECTED_CLASS);a?(b._selectedElements.remove(this),b._selectedElementsGroup.after(this.group)):(b._selectedElements.add(this),b._selectedElementsGroup.add(this.group)),b._options.onSelectionChange(b._selectedElements.toArray()),b._selectNode(this.name,!a)},function(){},d,d,d)}}else SO.Browser.isTouchScreen()||this._initSelectBox(),this._initSelectedNodesDrag(),this._graph.nodes.forEach(function(a){b._selectedElements.contains(a)||b._initNodeDrag(a.name)}),this._options.onSelectionChange(b._selectedElements.toArray());return this},_create:function(){this.el.classList.add("nlui-diagram");var a=this._options.graph.nodes.reduce(function(a,b){return a>b.x?a:b.x},this._options.width),b=this._options.graph.nodes.reduce(function(a,b){return a>b.y?a:b.y},this._options.height);this._options.width=this._options.width!==a?a+2*this.NODE_SIZE:this._options.width,this._options.height=this._options.height!==b?b+2*this.NODE_SIZE:this._options.height,this._paper=Snap(this._options.width,this._options.height),this.el.appendChild(this._paper.node),this._graph={},this._selectedElements=new SO.Structure.Set(function(a,b){return a.name===b.name}),this._initGraph(this._options.graph),this._selectBox=this._paper.rect(0,0,0,0).addClass("select-box"),this._selectedElementsGroup=this._paper.g(),this._draggedEdgeGroup=this._paper.g()},destroy:function(){this._paper.remove()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.Widgets.define("Workflow",{DEFAULT_OPTIONS:{paletteConf:{},value:{},mainSetPath:"",selectionPath:null,forceReadOnlyPath:null,controller:null,jpath:null,readOnly:!1,executionContainer:null,actionsContainer:null,advancedContainer:null,onInternalChange:function(){},onExternalChange:function(){},onDisplayActivity:function(){},onDeleteActivity:null,onDisplayTransition:function(){}},ACTIVITY_STATES:["edition","processing","blink_error","done","error","running"],EXECUTION_NORMAL:"none",EXECUTION_SUSPEND:"suspend",EXECUTION_DISABLE:"disable",EXECUTION_IMAGES:{suspend:"/xtk/img/activities/pause.png",disable:"/xtk/img/activities/disabled.png",running:"/xtk/img/activities/spinnerWorkflow.gif"},_create:function(){var a=this;this._value=this._options.value,this._mainSetPath=this._options.mainSetPath,this._controller=this._options.controller,this._locale=this._options.locale.getName(),this._selectionPath=this._options.selectionPath,this._forceReadOnlyPath=this._options.forceReadOnlyPath,this._jpath=this._options.jpath,this._activitiesJpath=this._jpath+"/activities/activity/",this._readOnly=this._options.readOnly,this._resourceType=this._options.resourceType,this._selection={activities:[],transitions:[]},this._selectionMode=!1,this._isTemplate=this._controller.getValue(this._jpath+"/isTemplate"),this._buildActionBar(),this._paletteContainer=this._options.paletteContainer,this._paletteContainer&&!this._readOnly&&this._createPalette(),this._diagram=new SO.Widgets.Diagram(this.$el,{graph:a._transformValue(),readonly:this._readOnly,states:{nodeBackgrounds:{blue:"node-background-blue",yellow:"node-background-yellow",green:"node-background-green",purple:"node-background-purple",red:"node-background-red"},nodeStates:{edition:"",processing:"node-done-blink",blink_error:"node-error-blink",done:"node-done",error:"node-error",running:"node-spinner"},edgeStates:{edition:"",processing:"edge-done-blink",done:"edge-done",error:"edge-error"}},onSelectionChange:function(b){a._onSelectionChange(b)},onEdgeMoved:function(b){a._moveTransition(b)},onEdgeDblClick:function(b){a._displayTransition(b.name)},onNodeDeleted:function(b,c){a._deleteActivity(b,c)},onNodeMoved:function(b){a._moveActivity(b)},onNodeDblClick:function(b){a._displayActivity(b.name)}}),this._isTemplate||(this._executionState=this._controller.getValue(this._jpath+"/executionState"),this._initExecutionState())},_buildActionBar:function(){this._isTemplate||this._buildExecutionContainer(),this._buildActionsContainer(),this._buildAdvancedContainer()},_buildExecutionContainer:function(){this._$executionContainer=$("<div></div>"),null!==this._options.executionContainer?this._$executionContainer.appendTo(this._options.executionContainer):this._$executionContainer=null},_executeMethod:function(a,b){var c=this,d=new NL.transport.REST({url:c._controller.getValue(a+"/href"),method:"POST"});d.start({onSuccess:function(){c._controller.setValue("/ignored/resetExecutionState",!0)}},b)},_buildActionsContainer:function(){var a=this;this._$actionsContainer=$("<div></div>"),null!==this._options.actionsContainer?this._$actionsContainer.appendTo(this._options.actionsContainer):this._$actionsContainer=null,null!==this._$actionsContainer&&this._$actionsContainer.soCmdBar({iconSize:24,commands:["enableSelectionMode","edit","editTransition",null,"executionNormal","executionSuspend","executionDisable","wakeupActivity","delete"],commandConfigs:{enableSelectionMode:{mode:"transparent",icon:"coral-checkCircle",help:xtk_workflow.enableSelectionMode(),command:function(){a._toggleSelectionMode()}},edit:{mode:"transparent",icon:"coral-editCircle",hidden:!0,help:xtk_workflow.activityEdit(),command:function(){a._displayActivity(a._selection.activities[0])}},editTransition:{mode:"transparent",icon:"editTransition",hidden:!0,help:xtk_workflow.transitionEdit(),command:function(){a._selection.transitions.length&&a._displayTransition(a._selection.transitions[0])}},executionNormal:{mode:"transparent",icon:"coral-check",hidden:!0,help:xtk_workflow.normalExecution(),command:function(){for(var b=0;a._selection.activities.length>b;b++)a._setExecutionMode(a._selection.activities[b],a.EXECUTION_NORMAL)}},executionSuspend:{mode:"transparent",icon:"coral-pauseCheck",hidden:!0,help:xtk_workflow.suspendExecution(),command:function(){for(var b=0;a._selection.activities.length>b;b++)a._setExecutionMode(a._selection.activities[b],a.EXECUTION_SUSPEND)}},executionDisable:{mode:"transparent",icon:"coral-close",hidden:!0,help:xtk_workflow.disableExecution(),command:function(){for(var b=0;a._selection.activities.length>b;b++)a._setExecutionMode(a._selection.activities[b],a.EXECUTION_DISABLE)}},wakeupActivity:{mode:"transparent",icon:"coral-pending",hidden:!0,help:xtk_workflow.wakeupActivity(),command:function(){1==a._selection.activities.length&&a._executeMethod(a._activitiesJpath+a._selection.activities[0]+"/wakeup")}},"delete":{mode:"transparent",icon:"coral-delete",hidden:!0,help:xtk_workflow.activityDelete(),command:function(){for(var b=a._selection.activities.length;b--;)a._diagram.removeNode(a._selection.activities[b],!0)}}}})},_buildAdvancedContainer:function(){this._$advancedContainer=$("<div></div>"),null!==this._options.advancedContainer?this._$advancedContainer.appendTo(this._options.advancedContainer):this._$advancedContainer=null,null!==this._$advancedContainer&&this._$advancedContainer.soCmdBar({iconSize:24,commands:[],commandConfigs:{}})},_transformValue:function(){var a={nodes:[],edges:[],selectionMode:this._selectionMode,selectedNodes:this._selection.activities},b=this._controller.getValue(this._activitiesJpath);for(var c in b){var d=b[c];if(d){var e=d.metadata,f=this._findActivityConf(e,d.form),g={name:d.name,label:d.label,type:e,x:d.x,y:d.y,img:this._getImageUrl(d.img),overlayImg:this.EXECUTION_IMAGES[d.mask],backgroundColor:f?f.backgroundColor:"blue"};a.nodes.push(g),this._transformTransitions(d,function(c,d){c.target=d.target&&b[d.target]?d.target:d.x&&d.y?{x:d.x,y:d.y}:null,d.enabled&&a.edges.push(c)})}}return a},_createPalette:function(){var a,b=this;new SO.Widgets.DiagramPalette(b._paletteContainer,{rendering:"block",droppable:new SO.Event.droppable("svg"),paletteConfiguration:b._options.paletteConf,onDrop:function(c){var d=c.data("helper"),e=SO.Utils.extend({},c.data("template"));c.removeClass(a);var f=Math.floor(d.dropPosition.left+b.$el.parent().scrollLeft()),g=Math.floor(d.dropPosition.top+b.$el.parent().scrollTop());b._addActivity(e,f,g)},dragStart:function(b){a=["nlui-diagram-item ","node-background-"+b.data("helper").data.backgroundColor].join(" "),b.addClass(a)},dragStop:function(b){b.removeClass(a)}})},refresh:function(){var a=this;this._selection.activities=SO.Utils.filter(this._selection.activities,function(b,c){return a._activityExists(c)}),this._refreshSelection(),this._diagram.refreshGraph(this._transformValue()),this._refreshExecutionState()},_initExecutionState:function(){var a=this;this._refreshExecutionState(),this._controller.registerJpathObserver(this._jpath+"/executionState",{onJpathNotify:function(b,c){"value"==b&&"/executionState"===c.slice(-15)&&(a._executionState=a._controller.getValue(a._jpath+"/executionState"),a._refreshExecutionState())}}),this._controller.registerJpathObserver(this._jpath+"/state",{onJpathNotify:function(b,c,d){"value"==b&&("starting"==d||"restarting"==d)&&a._diagram.resetState()}})},_refreshExecutionState:function(){if(!this._isTemplate){var a="starting"==this._executionState.state||"restarting"==this._executionState.state?[]:this._executionState.activities;this._diagram.resetState();for(var b=0;a.length>b;b++){var c=a[b];if(this._activityExists(c.name)){var d=this.ACTIVITY_STATES[c.state];this._diagram.setNodeState(c.name,d);var e;if("running"==d)e=this.EXECUTION_IMAGES.running;else{var f=this._controller.getValue(this._activitiesJpath+c.name+"/mask");e=this.EXECUTION_IMAGES[f]}this._diagram.setNodeIconOverlay(c.name,e);for(var g=this._controller.getValue(this._activitiesJpath+c.name+"/transitions"),h=function(a,b,c){var d=!1;return SO.Utils.each(g,function(a,e){if("object"==typeof e&&e.name){if(e.name===b)return c+="/"+a,d=!0,!1}else SO.Utils.each(e,function(e,f){return f.name===b?(c+="/"+a+("string"==typeof e?"/"+e:"["+e+"]"),d=!0,!1):void 0})}),d?c:null},i=0;c.transitions.length>i;i++){var j=c.transitions[i],k=h(c,j.name,"transitions");if(k){var l=c.name+"/"+k;this._diagram.setEdgeState(l,this.ACTIVITY_STATES[j.state]);var m,n;if(j.desc)m=j.desc;else{m="";var o=Math.floor(j.timeExec/1e3),p=new SO.TimeSpan({seconds:o}),q=this._controller.getValue(this._activitiesJpath+l+"/label");n=SO.Integer.format(j.recCount,{locale:this._locale});var r=SO.Float.format(j.recCount,{locale:this._locale,format:"count",significantFigures:3}),s=SO.Format.formatValue(p,"shortTimeSpan",{locale:this._locale});-1!=j.recCount&&(m=r),q&&(m+=(m?" - ":"")+q),o>0&&(m+=(m?" - ":"")+s)}this._diagram.setEdgeDescription(l,m,n)}}}}}},_toggleSelectionMode:function(a){this._selectionMode=void 0!==a?a:!this._selectionMode,this._diagram.enableSelectionMode(this._selectionMode),this._$actionsContainer.soCmdBar("setCommandAttribute","enableSelectionMode","help",this._selectionMode?xtk_workflow.disableSelectionMode():xtk_workflow.enableSelectionMode()),this._$actionsContainer.soCmdBar("setCommandAttribute","enableSelectionMode","icon",this._selectionMode?"coral-closeCircle":"coral-checkCircle")},_onSelectionChange:function(a){this._selection.activities=[],this._selection.transitions=[];for(var b=0;a.length>b;b++)-1!==a[b].name.indexOf("/")?this._selection.transitions.push(a[b].name):this._selection.activities.push(a[b].name);this._refreshSelection()},_refreshSelection:function(){this._$actionsContainer.soCmdBar("setCommandAttribute","edit","hidden",1!==this._selection.activities.length),this._$actionsContainer.soCmdBar("setCommandAttribute","delete","hidden",this._readOnly||!this._selection.activities.length),this._$actionsContainer.soCmdBar("setCommandAttribute","editTransition","hidden",!this._selection.transitions.length),this._$actionsContainer.soCmdBar("setCommandAttribute","executionNormal","hidden",this._readOnly||!this._selection.activities.length),this._$actionsContainer.soCmdBar("setCommandAttribute","executionSuspend","hidden",this._readOnly||!this._selection.activities.length),this._$actionsContainer.soCmdBar("setCommandAttribute","executionDisable","hidden",this._readOnly||!this._selection.activities.length),this._$actionsContainer.soCmdBar("setCommandAttribute","wakeupActivity","hidden",this._isTemplate||1!=this._selection.activities.length);var a=1==this._selection.activities.length?this._selection.activities[0]:"";this._selectionPath&&this._controller.setValue(this._selectionPath,a?this._getActivity(a):null,!0)},_moveTransition:function(a){var b=this._controller.getValue(this._activitiesJpath+a.name);if(void 0!==b){var c,d,e;"string"==typeof a.target?(e=a.target,c=null,d=null):(c=a.target.x,d=a.target.y,e=""),this._controller.setValue(this._activitiesJpath+a.name+"/target",e),this._controller.setValue(this._activitiesJpath+a.name+"/x",c),this._controller.setValue(this._activitiesJpath+a.name+"/y",d)}},_deleteActivity:function(a,b){var c=this,d=this._activitiesJpath+a.name,e=c._controller.getValue(d),f={onJpathNotify:function(g,h,i,j){h==c._activitiesJpath&&j.position==a.name&&("cancelRemove"==g?c.refresh():"remove"==g&&(c._options.onDeleteActivity?c._options.onDeleteActivity(e,function(a){a&&c._moveTransitions(b)}):c._moveTransitions(b)),c._controller.unregisterJpathObserver(d,f))}};this._controller.registerJpathObserver(d,f),this._controller.removeCollectionItem(this._activitiesJpath,a.name,!0)},_moveTransitions:function(a){for(var b=0;a.length>b;b++)this._moveTransition(a[b])},_findActivityConf:function(a,b){var c=SO.Utils.filter(this._options.paletteConf.items,function(b,c){return c.template.metadata===a});if(1==c.length)return c[0];if(c.length>1){var d=SO.Utils.find(c,function(a,c){return c.template.form===b});return d?d:c[0]}return null},_transformTransitions:function(a,b){if(a.transitions)for(var c in a.transitions){var d=a.transitions[c];if(d){var e=[],f=!1;SO.isArray(d)||void 0===d.name?(e=d,f=!0):e.push(d),SO.Utils.each(e,function(d,e){var g={name:a.name+"/transitions/"+c,type:c,label:e.label,source:a.name};f&&(g.name+="string"==typeof d?"/"+d:"["+d+"]"),b(g,e)})}}},_setExecutionMode:function(a,b){this._controller.setValue(this._activitiesJpath+a+"/mask",b),this._diagram.setNodeIconOverlay(a,this.EXECUTION_IMAGES[b])},_getActivity:function(a){return this._controller.getValue(this._activitiesJpath+a)},_activityExists:function(a){return void 0!==this._getActivity(a)},_evaluateExpr:function(a,b){if(b&&"["==b[0]){var c=b.slice(1,b.length-1);if("/"==c[0])return this._controller.getValue(this._jpath+c)}return b},_getImageUrl:function(a){return a.replace(/([^:]+):activities\/([^']+)/,"/$1/img/activities/$2")},_addActivity:function(a,b,c){var d=this._findActivityConf(a.metadata,a.form),e=this._diagram.getNewNodeIndex(a.name),f=a.name+e;1!=e&&(a.label+=" "+e),a.name=f,a.x=b,a.y=c;var g=this;SO.Utils.each(a,function(b,c){"string"==typeof c&&(a[b]=g._evaluateExpr(f,c))}),this._options.onDroppedActivity(this._activitiesJpath+f,a,function(a){g._diagram.addNode({x:b-g.$el.parent().scrollLeft(),y:c-g.$el.parent().scrollTop(),img:g._getImageUrl(a.img),type:a.name,name:f,label:a.label,backgroundColor:d?d.backgroundColor:"blue"}),g._transformTransitions(a,function(a,b){if(b.enabled){var c=g._diagram.addEdge(a);a.target={x:c.x,y:c.y},g._moveTransition(a)}})})},_moveActivity:function(a){this._controller.setValue(this._activitiesJpath+a.name+"/x",a.x),this._controller.setValue(this._activitiesJpath+a.name+"/y",a.y)},_getInputActivities:function(a){var b=this._controller.getValue(this._activitiesJpath),c=SO.Utils.filter(b,function(b,c){return SO.Utils.find(c.transitions,function(b,c){return SO.isArray(c)?SO.Utils.find(c,function(b,c){return c.target===a}):c.target===a})});return c},_displayActivity:function(a){var b=this._getActivity(a),c=this,d=this._readOnly,e=this._findActivityConf(b.metadata,b.form);if(e&&e.role,d=d||e.readOnly,this._forceReadOnlyPath&&this._controller.setValue(this._forceReadOnlyPath,d),b.form){var f=this._getInputActivities(a),g=[];SO.Utils.each(f,function(a,b){g.push({name:b.name,label:b.label})}),this._controller.setValue(this._mainSetPath,g);var h=null;if("delivery"===b.metadata){var i="";if(b.delivery?i="delivery":b.deliveryTemplate&&(i="deliveryTemplate"),i){var j=b[i];j instanceof SO.Selection&&(j=j.getItem());var k="/tmp/deliveryActivities/"+b.name+"/delivery",l={type:"openWebPage",editInWorkflow:!0,editWorkflowPath:c._jpath,name:"delivery",metadataSource:"delivery",listItem:!1,dataSource:k,jpath:k,newController:!1,fetchData:!1,params:[{name:"inWorkflow","const":!0}],onOpen:function(a,b){var d=a.getDataSource(c._jpath+"/deliveries").getURL()+j.PKey,e=new NL.Transport.REST({url:d,method:"GET"}),f={onSuccess:function(c){var d=a._metamodel.getAllTypes(k);c=SO.MVC.Model.parseJSON(c,d);var e=new SO.MVC.Model(c);b._processLazyLoadedCollection(k,e,["PKey","href","metadata"],!0),a.setValueNotDirty(k,e._model,!0)}};e.start(f)}};h=function(a){l.metadataService=new NL.MetaDataService(a._metadataService,{prefixe:c._resourceType,dataSourceType:"metadata",dataURL:b.tempMetadata.href});var d=a._buildAction(l);d()},this._options.onDisplayActivity(h,d)}else h=function(d){c._controller.registerJpathObserver(c._activitiesJpath+a+"/img",{onJpathNotify:function(b,d,e){"value"==b&&"/img"===d.slice(-4)&&c._diagram.setNodeIcon(a,c._getImageUrl(e))}});var e=c._activitiesJpath+b.name+"/",f=new NL.MetaDataService(d._metadataService,{prefixe:c._resourceType,dataSourceType:"metadata",dataURL:b.tempMetadata.href}),g=c._controller.getDataSource(c._jpath+"/deliveries").getURL();g=SO.String.removePrefix(g,"/rest");var h="/tmp/private/openCreationWebPage/newEntity";d._executeBuildSubWebPage({confId:"deliveryCreation",activityDeliveryPath:e,creationMode:"manual",createInWorkflow:!0,resource:g,dataSource:h,metadataSource:"delivery",subCollection:!0,fetchData:!1,id:"seq3_openCreationWebPage_defaultID_3",listItem:!1,name:"deliveryCreation",navigatePostCreation:!1,newController:!0,pageController:!1,params:[{name:"channel","const":"email"},{name:"inWorkflow","const":!0},{name:"campaignPKey","const":c._controller.getValue(c._jpath+"/campaign/PKey")}],type:"openCreationWebPage",metadataService:f})},c._options.onDisplayActivity(h,d)}else h=function(a){var d={type:"openWebPage",name:"workflow/"+b.form,metadataSource:"workflow",metadataPrefix:"activities/activity/subMetadata/"+b.metadata,listItem:!1,hasRemove:!0,hasDuplicate:!0,dataPrefix:"activities/activity/"+b.name,dataSource:c._jpath,jpath:c._activitiesJpath+b.name,newController:!1,fetchData:!1,params:[]};d.metadataService=new NL.MetaDataService(a._metadataService,{prefixe:c._resourceType,dataSourceType:"metadata",dataURL:b.tempMetadata.href});var e=a._buildAction(d);e()},this._options.onDisplayActivity(h,d)}},_displayTransition:function(a){this._controller.getValue(this._activitiesJpath+a);var b=a.split(/\//)[0],c=a.replace(b+"/",""),d=this._getActivity(b),e=!1;this._options.onDisplayTransition(d,c,e)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.Widgets.Workflow.paletteConf={categories:[{label:xtk_workflow.categoryTargeting(),name:"targeting"},{label:xtk_workflow.categoryControlFlow(),name:"controlFlow"},{label:xtk_workflow.categoryChannels(),name:"channels"},{label:xtk_workflow.categoryDataManagement(),name:"dataManagement"}],items:[{icon:"/xtk/img/activities/start.svg",backgroundColor:"green",label:xtk_workflow.start_label(),category:"controlFlow",template:{name:"start",label:xtk_workflow.start_label(),metadata:"start"}},{icon:"/xtk/img/activities/end.svg",backgroundColor:"red",label:xtk_workflow.end_label(),category:"controlFlow",template:{name:"end",label:xtk_workflow.end_label(),metadata:"end"}},{icon:"/xtk/img/activities/fork.svg",backgroundColor:"green",label:xtk_workflow.fork_label(),category:"controlFlow",template:{name:"fork",label:xtk_workflow.fork_label(),metadata:"fork"}},{icon:"/xtk/img/activities/andjoin.svg",backgroundColor:"green",label:xtk_workflow.andjoin_label(),category:"controlFlow",template:{name:"andjoin",label:xtk_workflow.andjoin_label(),metadata:"andjoin"}},{icon:"/xtk/img/activities/clock.svg",backgroundColor:"yellow",label:xtk_workflow.schedule_label(),category:"controlFlow",role:"admin",template:{name:"schedule",label:xtk_workflow.schedule_label(),metadata:"schedule"}},{icon:"/xtk/img/activities/hourglass.svg",backgroundColor:"blue",label:xtk_workflow.wait_label(),category:"controlFlow",template:{name:"wait",label:xtk_workflow.wait_label(),metadata:"wait"}},{icon:"/xtk/img/activities/hourglass.svg",backgroundColor:"blue",label:xtk_workflow.timefilter_label(),category:"undefined",template:{name:"timefilter",label:xtk_workflow.timefilter_label(),metadata:"timefilter"}},{icon:"/xtk/img/activities/workflowjob.svg",backgroundColor:"blue",label:xtk_workflow.subworkflow_label(),category:"undefined",template:{name:"subworkflow",label:xtk_workflow.subworkflow_label(),metadata:"subworkflow"}},{icon:"/xtk/img/activities/signal.svg",backgroundColor:"blue",label:xtk_workflow.signal_label(),category:"undefined",template:{name:"signal",label:xtk_workflow.signal_label(),metadata:"signal"}},{icon:"/xtk/img/activities/shell.svg",backgroundColor:"blue",label:xtk_workflow.extern_label(),category:"undefined",template:{name:"extern",label:xtk_workflow.extern_label(),metadata:"extern"},readOnly:!0},{icon:"/xtk/img/activities/script.svg",backgroundColor:"blue",label:xtk_workflow.js_label(),template:{name:"js",label:xtk_workflow.js_label(),metadata:"js"},readOnly:!0,role:"admin"},{icon:"/xtk/img/activities/script.svg",backgroundColor:"blue",label:xtk_workflow.jsx_label(),template:{name:"jsx",label:xtk_workflow.jsx_label(),metadata:"jsx"},readOnly:!0,role:"admin"},{icon:"/xtk/img/activities/multiscript.svg",backgroundColor:"blue",label:xtk_workflow.multiscript_label(),category:"undefined",template:{name:"multiscript",label:xtk_workflow.multiscript_label(),metadata:"multiscript"}},{icon:"/xtk/img/activities/buildAggregate.svg",backgroundColor:"blue",label:xtk_workflow.buildAggregate_label(),category:"undefined",template:{name:"buildAggregate",label:xtk_workflow.buildAggregate_label(),metadata:"buildAggregate"}},{icon:"/xtk/img/activities/exec.svg",backgroundColor:"blue",label:xtk_workflow.nlmodule_label(),template:{name:"nlmodule",label:xtk_workflow.nlmodule_label(),metadata:"nlmodule"},readOnly:!0,role:"admin"},{icon:"/nms/img/activities/java.svg",backgroundColor:"blue",label:xtk_workflow.javaProcessor_label(),category:"undefined",template:{name:"javaProcessor",label:xtk_workflow.javaProcessor_label(),metadata:"javaProcessor"}},{icon:"/nms/img/activities/validation.svg",backgroundColor:"purple",label:xtk_workflow.validation_label(),category:"undefined",template:{name:"validation",label:xtk_workflow.validation_label(),metadata:"validation"}},{icon:"/nms/img/activities/alert.svg",backgroundColor:"yellow",label:xtk_workflow.alert_label(),category:"undefined",template:{name:"alert",label:xtk_workflow.alert_label(),metadata:"alert"}},{icon:"/nms/img/activities/notification.svg",backgroundColor:"blue",label:xtk_workflow.notification_label(),category:"undefined",template:{name:"notification",label:xtk_workflow.notification_label(),metadata:"notification"}},{icon:"/nms/img/activities/email.svg",backgroundColor:"blue",label:"email",category:"channels",template:{name:"delivery",label:"email",deliverySel:"explicit",metadata:"delivery",form:"delivery",img:"nms:activities/email.svg",channel:"email"}},{icon:"/nms/img/activities/control-delivery.svg",backgroundColor:"blue",label:xtk_workflow.controlDelivery_label(),category:"undefined",template:{name:"controlDelivery",label:xtk_workflow.controlDelivery_label(),metadata:"controlDelivery"}},{icon:"/nms/img/activities/query.svg",backgroundColor:"blue",label:xtk_workflow.query_label(),category:"targeting",template:{name:"query",label:xtk_workflow.query_label(),metadata:"query",resource:"profile"}},{icon:"/nms/img/activities/union.svg",backgroundColor:"blue",label:xtk_workflow.union_label(),category:"targeting",template:{name:"union",label:xtk_workflow.union_label(),metadata:"union"}},{icon:"/nms/img/activities/intersection.svg",backgroundColor:"blue",label:xtk_workflow.intersection_label(),category:"targeting",template:{name:"intersection",label:xtk_workflow.intersection_label(),metadata:"intersection"}},{icon:"/nms/img/activities/exclusion.svg",backgroundColor:"blue",label:xtk_workflow.exclusion_label(),category:"targeting",template:{name:"exclusion",label:xtk_workflow.exclusion_label(),metadata:"exclusion"}},{icon:"/nms/img/activities/extract.svg",backgroundColor:"blue",label:xtk_workflow.extract_label(),category:"targeting",template:{name:"extract",label:xtk_workflow.extract_label(),metadata:"extract"}},{icon:"/nms/img/activities/dedup.svg",backgroundColor:"blue",label:xtk_workflow.dedup_label(),category:"targeting",template:{name:"dedup",label:xtk_workflow.dedup_label(),metadata:"dedup"}},{icon:"/nms/img/activities/changeAxis.svg",backgroundColor:"blue",label:xtk_workflow.changeAxis_label(),category:"targeting",template:{name:"changeAxis",label:xtk_workflow.changeAxis_label(),metadata:"changeAxis"}},{icon:"/xtk/img/activities/export.svg",backgroundColor:"blue",label:xtk_workflow.fileExport_label(),category:"dataManagement",template:{name:"fileExport",label:xtk_workflow.fileExport_label(),metadata:"fileExport"}},{icon:"/nms/img/activities/setService.svg",backgroundColor:"blue",label:xtk_workflow.setOfService_label(),category:"undefined",template:{name:"setOfService",label:xtk_workflow.setOfService_label(),metadata:"setOfService"}},{icon:"/nms/img/activities/ftp.svg",backgroundColor:"blue",label:xtk_workflow.fileTransfer_label(),category:"dataManagement",template:{name:"fileTransfer",label:xtk_workflow.fileTransfer_label(),metadata:"fileTransfer"}},{icon:"/nms/img/activities/inmail.svg",backgroundColor:"blue",label:xtk_workflow.inmail_label(),category:"undefined",template:{name:"inmail",label:xtk_workflow.inmail_label(),metadata:"inmail"},readOnly:!0},{icon:"/nms/img/activities/dbImport.svg",backgroundColor:"blue",label:xtk_workflow.dbImport_label(),category:"undefined",template:{name:"dbImport",label:xtk_workflow.dbImport_label(),metadata:"dbImport"}},{icon:"/nms/img/activities/soapImport.svg",backgroundColor:"blue",label:xtk_workflow.soapImport_label(),category:"undefined",template:{name:"soapImport",label:xtk_workflow.soapImport_label(),metadata:"soapImport"}},{icon:"/nms/img/activities/fileImport.svg",backgroundColor:"blue",label:xtk_workflow.fileImport_label(),category:"dataManagement",template:{name:"fileImport",label:xtk_workflow.fileImport_label(),metadata:"fileImport"}},{icon:"/nms/img/activities/writer.svg",backgroundColor:"blue",label:xtk_workflow.writer_label(),category:"dataManagement",template:{name:"writer",label:xtk_workflow.writer_label(),metadata:"writer",resource:"[/resource]"}},{icon:"/nms/img/activities/crmConnector_48x48.svg",backgroundColor:"blue",label:xtk_workflow.crmConnectorDataMgt_label(),category:"undefined",template:{name:"crmConnectorDataMgt",label:xtk_workflow.crmConnectorDataMgt_label(),metadata:"crmConnectorDataMgt"}},{icon:"/nms/img/activities/group.svg",backgroundColor:"blue",label:xtk_workflow.saveAudience_label(),category:"dataManagement",template:{name:"saveAudience",label:xtk_workflow.saveAudience_label(),metadata:"saveAudience"}}]};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.Widgets.define("itemSelector","Input",{DEFAULT_OPTIONS:{theme:"dark",itemList:[],itemsPerLine:4,fitToParent:!0},_create:function(){this._iconSize=48,this._iconClassSuffix="dark"===this._options.theme?"-inverse":"",this._hoverIconClassSuffix="-active",this._items=[];for(var a=0;this._options.itemList.length>a;a++)this._items.push(this._options.itemList[a]);this._super()},_createMarkup:function(){this.$el.empty(),this.$el.addClass("nlui-itemselector"),this._options.fitToParent&&this.$el.addClass("nlui-itemselector-fitToParent"),this._$content=this.$el},_refreshDisplay:function(a){if(a){this._createMarkup(),this._$content.empty();for(var b=$('<div class="nlui-itemselector-item-group"></div>').appendTo(this._$content),c=0;this._items.length>c;c++)this._drawItem(this._items[c],b),0===(c+1)%this._options.itemsPerLine&&(b=$('<div class="nlui-itemselector-item-group"></div>').appendTo(this._$content))}else SO.assert(!1,"SO.ItemSelector._refreshDisplay does not support incremental display")},_drawItem:function(a,b){var c=a.icon+this._iconClassSuffix,d=a.icon+this._hoverIconClassSuffix,e=$('<div class="nlui-itemselector-item"></div>'),f=$('<div class="nlui-itemselector-icon"></div>').appendTo(e),g=SO.IMG.genIcon(c,this._iconSize).appendTo(f);$('<span class="nlui-itemselector-label"></span>').text(a.label).appendTo(e);var h=SO.IMG.genIcon(d,this._iconSize),i=g.attr("class"),j=h.attr("class");e.hover(function(){g.removeClass(i).addClass(j)},function(){g.removeClass(j).addClass(i)});var k=this;SO.Event.bind(e,"vclick",function(){k._setValue(a.value)}),e.appendTo(b)},setTheme:function(a,b){this._options.theme=a,this._iconClassSuffix="dark"===this._options.theme?"-inverse":"",this._hoverIconClassSuffix="-active",this._refreshDisplay(!0),this._super(a,b)},setItems:function(a){for(this._options.itemList=a,this._items=[],i=0;this._options.itemList.length>i;i++)this._items.push(this._options.itemList[i]);this._refreshDisplay(!0)},setItemsPerLine:function(a){this._options.itemsPerLine=a,this._refreshDisplay(!0)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("PersonalizedTextPreview",{DEFAULT_OPTIONS:{value:""},_create:function(){return SO.isNundef(this._options.value)&&(this._options.value=""),this._refreshDisplay(!0),this},_refreshDisplay:function(a){var b=this.getValue();return a&&this._createMarkup(),-1===b.indexOf("data-nl")?this._$inner.text(b):this._$inner.html(b),this},_createMarkup:function(){return this._$inner&&this._$inner.remove(),this.$el.empty().addClass("nlui-personalizedtext-preview"),this._$inner=$("<div></div>").addClass("nlui-personalizedtext-preview-inner"),this.$el.append(this._$inner),this},setValue:function(a){return this._options.value=a,this._refreshDisplay(!0),this},getValue:function(){return this._options.value}}),$.widget("SO.soPersonalizedTextPreview",{_create:function(){this._widget=new SO.Widgets.PersonalizedTextPreview(this.element,this.options)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Image","Input",{DEFAULT_OPTIONS:{params:{editable:!1,align:"center",title:null,width:null,height:null,maxWidth:null,maxHeight:null,dialogTitle:xtk_core.image_dialogTitle(),dialogWidth:402,dialogHeight:146}},_create:function(){var a=this;return this._dialog=null,this._uploader=null,this._cmdBar=null,this._$preview=$(),this._$dialog=$(),this._$uploader=$(),this._$cmdBar=$(),this._checks=[{requirement:function(){return!SO.isNundef(a._value)},test:function(a){return SO.isString(a)},error:{message:xtk_sirocco.inputs_incorrectValueErr()}}],this._super(),this},_refreshDisplay:function(a){return a&&(this.isEditable()&&!this._state.readOnly&&(this._unbindEvents(),this._bindEvents()),this._createMarkup()),this._state.disabled?this.$el.addClass("nlui-image-input-disabled"):this.$el.removeClass("nlui-image-input-disabled"),this._state.readOnly?this.$el.addClass("nlui-image-input-readonly"):this.$el.removeClass("nlui-image-input-readonly"),this._state.error?this.$el.addClass("nlui-image-input-error"):this.$el.removeClass("nlui-image-input-error"),this._$preview.attr({src:this._value||""}),this},_bindEvents:function(){var a=this;return this._onMouseEnter=function(){var b=a._$preview.position();a._$cmdBar.css({top:b.top,left:b.left}).show()},this._onMouseLeave=function(b){var c=$(b.target),d=c.offset(),e=b.clientX>d.left&&b.clientX<d.left+c.outerWidth(),f=b.clientY>d.top&&b.clientY<d.top+c.outerHeight();e&&f||a._$cmdBar.hide()},this.$el.on("mouseenter","img",this._onMouseEnter),this.$el.on("mouseleave","img",this._onMouseLeave),this.$el.on("mouseleave",".nlui-image-input-commands",this._onMouseLeave),this},_unbindEvents:function(){return this._onMouseEnter&&this.$el.off("mouseenter",this._onMouseEnter),this._onMouseLeave&&this.$el.off("mouseleave",this._onMouseLeave),this},_createMarkup:function(){return this.$el.empty().addClass("nlui-image-input").css({"text-align":this._options.params.align||"center"}),this.isEditable()&&!this._state.readOnly&&this._createCmdBar(),this._createPreview(),this},_createCmdBar:function(){var a=this;return this._$cmdBar&&this._$cmdBar.remove(),this._$cmdBar=$("<div></div>",{"class":"nlui-image-input-commands"}),this._cmdBar=new SO.Widgets.cmdBar(this._$cmdBar,{iconSize:24,commands:["upload"],commandConfigs:{upload:{mode:"transparent",icon:"coral-image",tooltip:xtk_core.grid_addRow(),iconSize:24,command:function(){a._createUploader(),a._createDialog()}}}}),this.$el.append(this._$cmdBar),this},_createPreview:function(){return this._$preview&&this._$preview.remove(),this._$preview=$("<img>",{"class":"nlui-image-input-preview"}),this._options.params.title&&this._$preview.attr("title",this._options.params.title),this._options.params.width&&this._$preview.attr("width",this._options.params.width),this._options.params.height&&this._$preview.attr("height",this._options.params.height),this._options.params.maxWidth&&(-1!==this._options.params.maxWidth.indexOf("%")?this._$preview.css("max-width",this._options.params.maxWidth):this._$preview.css({display:"inline-block","overflow-x":"hidden","max-width":this._options.params.maxWidth})),this.$el.append(this._$preview),this},_createUploader:function(){var a=this;return this._$uploader&&this._$uploader.remove(),this._$uploader=$("<div></div>",{"class":"nlui-image-input-uploader"}),this._uploader=new SO.Widgets.MonoFileDropZone(this._$uploader,{uploader:new NL.Uploader({isPublicFile:!0}),onUploadComplete:function(b,c){SO.isString(c.url)&&(a._setValue(c.url),a._refreshDisplay(!0)),a._dialog.destroy()}}),this},_createDialog:function(){var a=this;return this._$dialog&&this._$dialog.remove(),this._$dialog=$("<div></div>",{"class":"nlui-image-input-dialog"}),this._dialog=new SO.Widgets.Dialog(this._$dialog,{title:this._options.params.dialogTitle,width:this._options.params.dialogWidth,height:this._options.params.dialogHeight,autoOpen:!1,padding:!1,modal:!0,open:function(){a._$cmdBar.hide(),a._dialog.setContent(a._uploader.el)}}),this._dialog.open(),this},isEditable:function(){return this._options.params.editable},setEditable:function(a){return this._options.params.editable=a,this._refreshDisplay(!0),this}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
(function(a){"use strict";SO.ns("NL.Navigation");try{Typekit.load({contextPath:"/typekit"})}catch(b){console.log(b)}var c=null,d=function(a){var b={pageController:!0,model:{},metamodel:{},statemodel:{},workingSpace:["/ignored","/private"]};return null!==a&&(b.model=a.model._model,b.metamodel=a.metamodel._metamodel,b.statemodel=a.statemodel._statemodel,b.displaymodel=a.displaymodel._displaymodel,b.dataFormat="json",b.pageController=a.pageController),new SO.MVC.Controller(b)},e=function(a){$("<div></div>").soMessageBox({type:"warning",message:SO.XSS.escapeXMLString(a)})},f=function(a,b,c,d,e){var f,g;e&&e.stack?(f=e.stack,g=xtk_dashboard.uncaughtJSExceptionsDetailsWithStack(a,f)):g=xtk_dashboard.uncaughtJSExceptionsDetails(a,b,c),$("<div></div>").soMessageBox({type:"error",message:xtk_dashboard.uncaughtJSExceptions(),details:g})},g=function(b){return NL.session.buildNumber=b.buildNumber,NL.session.instanceName=b.instanceName,NL.session.user=b.user,b.localeName&&NL.session.setLocale(b.localeName),b.timezoneName&&NL.session.setTimezone(b.timezoneName,b.timezoneData||[]),NL.session.serverURL=a.location.protocol+"//"+a.location.host,NL.session.hostName=a.location.hostname,NL.session.hasCampaign=b.hasCampaign,NL.session.hasMobileApp=b.hasMobileApp,NL.session.initConfManager(),b.newSecurityToken&&(document.__securitytoken=b.newSecurityToken,NL.session.__securitytoken=b.newSecurityToken),NL.session},h=function(a,b){var e=g(a);SO.init();var f=NL.session.confManager.get("navigation"),h=b.navigationConfig,i=b.webPageConfig;c=d(i);var j=[];SO.isEmpty(f)||f.lru&&(j=f.lru),NL.page={controller:c,lru:j,shell:{navigationRail:{selection:h.railSelection,data:h.model,collapsed:h.railCollapsed},breadcrumb:{content:h.breadcrumbContent},session:e,context:{label:xtk_sirocco.shell_marketingCloudLabel(),icon:"amc-logo-white",url:h.amcURL},solution:{label:xtk_sirocco.shell_adobeCampaignLabel(),icon:"ac-logo-white",url:h.solutionURL},blackBar:h.blackBar,helpURL:h.helpURL,logOutUrl:h.logoutURL},pageStructure:null!==i&&i.pageStructure?i.pageStructure:null,constraints:{}}},i=function(a,b,c,d){$("<div></div>");var e=null;a.pageStructure&&a.pageStructure.canSave&&a.controller.registerOnSave(function(a){return e.onSave(a)});var f={},g=!1;a.pageStructure&&a.pageStructure.disableNavigation&&(g=a.pageStructure.disableNavigation),g?(f.blackBar=!1,f.footer=!1,f.navigationRail={collapsed:!0}):f=a.shell,delete a.shell,a.pageStructure&&(e=new SO.Widgets.WebPage({titleDisplay:function(a){$(document).attr("title",a)},container:$("#"+b),controller:a.controller,structure:a.pageStructure,shellConfig:f,configManager:d.confManager,locale:SO.LocaleManager.getLocale(d.locale.getLocale()),timezone:SO.TimezoneManager.getTimezone(d.timezone.getName())})),a.controller.startTransaction()};NL.Navigation={init:h,ready:i},a.onerror=f,a.alert=e})(window);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.tie=function(a,b){var c=document.createElement(b.tag);return a.el=c,this._rtie(a,c,b),a},SO._rtie=function(a,b,c){if(0!=c.appendIf)for(var d in c){var e=c[d];if("id"===d)b.id=e;else if("text"===d)b.appendChild(document.createTextNode(e));else if("cls"===d)b.className=e;else if("cld"===d)for(var f=0,g=c.cld.length;g>f;f++){var h,i=c.cld[f];if("string"==typeof i)b.appendChild(document.createTextNode(i));else if(i.tag){var h=document.createElement(i.tag);b.appendChild(h),i.field&&(a[i.field]=h),this._rtie(a,h,i)}else i.el?b.appendChild(i.el):i.obj?(b.appendChild(i.obj.el),i.field&&(a[i.field]=i.obj)):b.appendChild(i)}else"tag"===d||"field"===d||("function"==typeof e?b[d]=function(){e.call(a,this)}:b.setAttribute(d,e))}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.ns("SO.Format"),SO.Format.formats={},SO.Format.formats.percent_0={format:"percent",decimalPlaces:0},SO.Format.formats.percent_1={format:"percent",decimalPlaces:1},SO.Format.formats.percent_2={format:"percent",decimalPlaces:2},SO.Format.formats.percent=SO.Format.formats.percent_2,SO.Format.formats.shortDate={format:"shortDate"},SO.Format.formats.longDate={format:"longDate"},SO.Format.formats.shortDateTime_m={format:"shortDate",precision:"shortTime"},SO.Format.formats.shortDateTime={format:"shortDateTime"},SO.Format.formats.shortDateTime_s={format:"shortDateTime"},SO.Format.formats.shortDateTime_h={format:"shortDate",precision:"shortHour"},SO.Format.formats.shortDateTime_m_tz={format:SO.Format.formats.shortDateTime_m.format,precision:SO.Format.formats.shortDateTime_m.precision},SO.Format.formats.shortDateTime_s_tz={format:SO.Format.formats.shortDateTime_s.format},SO.Format.formats.shortDateTime_h_tz={format:SO.Format.formats.shortDateTime_h.format,precision:SO.Format.formats.shortDateTime_h.precision},SO.Format.formats.rounded_3={format:"count",significantFigures:3},SO.Format.formats.rounded_2={format:"count",significantFigures:2},SO.Format.formats.rounded=SO.Format.formats.rounded_3,SO.Format.formats.rounded_3_dataSize={format:"dataSize",significantFigures:3},SO.Format.formats.rounded_2_dataSize={format:"dataSize",significantFigures:2},SO.Format.formats.rounded_dataSize=SO.Format.formats.rounded_3_dataSize,SO.Format.formats.timeZone={},SO.Format.formats.time_m={format:"shortTime"},SO.Format.formats.time_s={format:"time"},SO.Format.formats.time_h={format:"shortHour"},SO.Format.formats.integer={},SO.Format.formats.number_1={format:"#,###.0"},SO.Format.formats.number_2={format:"#,###.00"},SO.Format.formats.number_3={format:SO.Format.formats.number_2.format+"0"},SO.Format.formats.number=SO.Format.formats.number_2,SO.Format.formats.shortTimeSpan={format:"shortTimeSpan"},SO.Format.formats.shortTimeSpan_d={format:"shortDays"},SO.Format.formats.shortTimeSpan_h={format:"shortDaysHours"},SO.Format.formats.longTimeSpan={format:"longTimeSpan"},SO.Format.formats.longTimeSpan_d={format:"longDays"},SO.Format.formats.longTimeSpan_h={format:"longDaysHours"},SO.Format.formats.fileSize={format:"dataSize"},SO.Format.formats.timeAgo={},SO.Format.formats.age={},SO.Format.formats.boolean={},SO.Format.getDefaultFormatForType=function(a){var b;switch(a=a?a.toLowerCase():void 0){case"long":case"integer":case"short":case"byte":b="integer";break;case"float":case"double":b="number_2";break;case"boolean":b="boolean";break;case"datetime":b="shortDateTime";break;case"date":case"dateonly":b="shortDate";break;case"time":b="time_s";break;case"timespan":b="shortTimeSpan";break;default:b=a}return b},SO.Format.formatValue=function(a,b,c){var d,e,f,g,h,b,i;if(c=c||{},b||(SO.isNumber(a)?b="number_2":SO.isBoolean(a)?b="boolean":SO.isDateOnly(a)||SO.isPartialDate(a)?b="shortDate":SO.isDateTime(a)?b="shortDateTime":SO.isTimeSpan(a)?b="shortTimeSpan":SO.isTime(a)&&(b="time_s")),b&&(f=SO.Format.formats[b])){if(d=null,i=c.timezone&&c.timezone instanceof SO.Timezone?c.timezone:SO.TimezoneManager.getTimezone(c.timezone)||SO.TimezoneManager.getDefaultTimezone(),g={format:f.format,significantFigures:f.significantFigures,locale:c.locale,decimalPlaces:f.decimalPlaces,timezone:c.timezone},null===a||void 0===a)d="";else switch(b){case"percent":case"percent_0":case"percent_1":case"percent_2":SO.isFloat(a)?d=SO.Float.format(a,g):e="Float";break;case"shortDate":case"longDate":SO.isDateOnly(a)||SO.isDateTime(a)||SO.isPartialDate(a)?d=a.format(g):e="Date";break;case"timeZone":SO.isDateOnly(a)||SO.isDateTime(a)||SO.isPartialDate(a)?d=i.getName():e="Date";break;case"timeAgo":SO.isDateTime(a)||SO.isDateTime(a)||SO.isPartialDate(a)?d=this.TimeAgo(a,null,g):e="DateTime";break;case"age":SO.isDateOnly(a)||SO.isInteger(a)||SO.isFloat(a)?d=this.age(a,g):e="DateOnly";break;case"integer":SO.isInteger(a)?d=SO.Integer.format(a,g):e="Integer";break;case"number":case"number_1":case"number_2":case"number_3":SO.isInteger(a)||SO.isFloat(a)?d=SO.Float.format(a,g):e="Integer or Float";break;case"time_m":case"time_s":case"time_h":SO.isTime(a)||SO.isDateTime(a)?d=a.format(g):e="DateTime or Time";break;case"shortDateTime":case"shortDateTime_m":case"shortDateTime_s":case"shortDateTime_h":case"shortDateTime_m_tz":case"shortDateTime_s_tz":case"shortDateTime_h_tz":SO.isDateTime(a)?(f.precision&&(h=c.locale&&c.locale instanceof SO.Locale?c.locale:(c.locale?SO.LocaleManager.getLocale(c.locale):SO.LocaleManager.getDefaultLocale()).getSettings(),g.format=h[f.format]+" "+h[f.precision]),d=a.format(g),/_tz$/.test(b)&&(d+=" "+i.getName())):e="DateTime";break;case"rounded_3":case"rounded_2":case"rounded":case"rounded_3_dataSize":case"rounded_2_dataSize":case"rounded_dataSize":SO.isInteger(a)||SO.isFloat(a)?d=SO.Float.format(a,g):e="Integer or Float";break;case"shortTimeSpan":case"shortTimeSpan_d":case"shortTimeSpan_h":case"longTimeSpan":case"longTimeSpan_d":case"longTimeSpan_h":SO.isTimeSpan(a)?d=SO.TimeSpan.format(a,g):e="TimeSpan";break;case"fileSize":SO.isInteger(a)?d=SO.Integer.format(a,g):e="Integer";break;case"boolean":SO.isBoolean(a)?d=SO.Boolean.format(a,g):e="Boolean";break;default:SO.assert(!1,'The format "'+b+'" is not take into acount in the function "So.Format.formatValue"')}null===d&&c.defaultValue&&(d=c.defaultValue)}return void 0===d&&(d=a),SO.assert(!e,'The value must be a "'+e+'" type to be formatted in "'+b+'"'),d},SO.Format.TimeAgo=function(a,b,c){var d,e,f,g;return c=c||{},b=b||new SO.DateTime,d=b.substract(a),e=new SO.TimeSpan(Math.round(d)),f=e.format({format:"timeAgo",locale:c.locale}),g=Math.abs(d)<c.maxSeconds?a.format({format:"shortDate"}):f},SO.Format.age=function(a,b){var c,d,e;if(b=b||{},SO.isDateOnly(a)){var f=new SO.DateOnly;c=f.substract(a),d=new SO.TimeSpan(Math.round(c))}else(SO.isFloat(a)||SO.isIntger(a))&&(d=new SO.TimeSpan({years:Math.round(a)}));return e=d.format({format:"age",locale:b.locale})};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.Boolean"),SO.Boolean.safeParse=function(a,b){b=b||{};var c=" is not a boolean.",d=SO.LocaleManager.getDefaultLocale(),e=!1;void 0!==b.defaultValue&&(e=SO.assert(null===b.defaultValue||SO.isBoolean(b.defaultValue),b.defaultValue+c)?b.defaultValue:!1),void 0!==b.locale&&(d=SO.LocaleManager.getLocale(b.locale),d=SO.assert(d,b.locale+" is not a valid locale name.")?d:SO.LocaleManager.getDefaultLocale()),SO.isString(a)&&(a=a.toLowerCase());var f=d.get("booleanStrings");return a===f["true"]||"1"===a?!0:a===f["false"]||"0"===a?!1:(SO.assert(null,a+" can not be parsed to a boolean value."),e)},SO.Boolean.parse=function(a){if(""===a||null===a||void 0===a)return!1;a=SO.assert(SO.isString(a),a+"is not a String.")?a.toLowerCase():a;var b="true"===a||"1"===a,c="false"===a||"0"===a;if(!b&&!c)throw new Error(a+" can't be parsed into a boolean");return b?!0:c?!1:void 0},SO.Boolean.toString=function(a){return void 0!==a&&null!==a?a.toString():""},SO.Boolean.format=function(a,b){b=b||{};var c=SO.LocaleManager.getDefaultLocale();return void 0!==b.locale&&(c=SO.LocaleManager.getLocale(b.locale),c=SO.assert(c,b.locale+" is not valid locale name.")?c:SO.LocaleManager.getDefaultLocale()),SO.isBoolean(a)?c.get("booleanStrings")[a.toString()]:(SO.assert(null,a+" is not a boolean value."),"")};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.Border"),SO.Border.safeParse=function(){},SO.Border.parse=function(){},SO.Border.toString=function(){},SO.Border.format=function(){},SO.Border.xtkStringify=function(){},SO.Border.isBorder=function(){};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.Float"),SO.Float.REG_EXP=/^(\+|-)?[0-9]+\.[0-9]+(e(\+|-)[0-9]+)?$/,SO.Float.safeParse=function(a,b){b=SO.Utils.extend({},b);var c=0,d=SO.LocaleManager.getDefaultLocale(),e=" is not a valid float value.";void 0!==b.defaultValue&&(c=SO.assert(null===b.defaultValue||SO.isFloat(b.defaultValue),b.defaultValue+e)?b.defaultValue:0),void 0!==b.locale&&(d=SO.LocaleManager.getLocale(b.locale),d=SO.assert(d,b.locale+" is not a valid locale name.")?d:SO.LocaleManager.getDefaultLocale());var f=d.getSettings();if(SO.isString(a)&&(a=a.replace(new RegExp(f.digitGroupingSymbol,"g"),"").replace(f.decimalSymbol,"."),SO.isFloat(+a)||(a=c?c.toFixed(1):null),null!==a)){var g=parseFloat(a);return SO.assert(SO.isFloat(g),a+e)?g:c}return SO.assert(null,a+e),c},SO.Float.parse=function(a){if(""===a||null===a||void 0===a)return 0;var b=parseFloat(a),c=SO.isFloat(b);if(SO.assert(c),!c)throw new Error(a+" is not a valid float");return b},SO.Float.toString=function(a){return void 0!==a&&null!==a?a.toString():""},SO.Float.format=function(a,b){b=SO.Utils.extend({format:"#,##0"},b),a=SO.isFloat(a)&&1e-8>Math.abs(a)?0:a;var c=SO.LocaleManager.getDefaultLocale();if(void 0!==b.locale&&(c=SO.LocaleManager.getLocale(b.locale),c=SO.assert(c,b.locale+" is not a valid locale name.")?c:SO.LocaleManager.getDefaultLocale),SO.assert(SO.isFloat(a),a+" is not a valid float value.")){switch(b.localeSettings=c.getSettings(),b.format){case"percent":if(a=100*a,b.decimalPlaces=+b.decimalPlaces||0,b.pattern="#,##0",b.symbol="%",b.decimalPlaces){b.pattern+=".";for(var d=0;b.decimalPlaces>d;d++)b.pattern+="0"}b.pattern+=" ",b.pattern+="\u00a4",delete b.decimalPlaces;break;case"dataSize":case"count":return SO.Float._formatWithUnit(a,b,b.format).trim();default:b.pattern=b.format}return delete b.format,SO.Number._format(a,b)}return""},SO.Float._formatWithUnit=function(a,b,c){b.significantFigures=+b.significantFigures||1;var d=b.localeSettings.units[c];if(!d)throw new Error("Invalid unit '"+c+"'");var e=!1;0>a&&(a=-a,e=!0);for(var f=d.length-1;f>0&&d[f].factor>a;)f--;var b=SO.Utils.extend(b,{pattern:null,significantFigures:b.significantFigures,addSymbol:!0,symbol:d[f].symbol});return a=e?-a:a,SO.Number._format(a/d[f].factor,b)};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";"shared library";SO.ns("SO.Integer"),SO.Integer.REG_EXP=/^(\+|-)?([0-9]+(e(\+|-)[0-9]+)?)$/,SO.Integer.safeParse=function(a,b){b=SO.Utils.extend({},b);var c=" is not a valid integer value",d=0,e=SO.LocaleManager.getDefaultLocale();void 0!==b.defaultValue&&(d=SO.assert(null===b.defaultValue||SO.isInteger(b.defaultValue),b.defaultValue+" is not a valid default value.")?b.defaultValue:0),void 0!==b.locale&&(e=SO.LocaleManager.getLocale(b.locale),e=SO.assert(e,b.locale+" is not a valid locale name.")?e:SO.LocaleManager.getDefaultLocale());var f=e.getSettings();if(SO.isString(a)&&(a=a.replace(new RegExp(f.digitGroupingSymbol,"g"),"").replace(f.decimalSymbol,"."),a=SO.assert(SO.isInteger(parseInt(a,10),a+c))?a:null!==d?d.toString():null,null!==a)){var g=parseInt(a,10);return SO.assert(SO.isInteger(g)&&SO.Integer.REG_EXP.test(a),a+c)?g:d}return SO.assert(null,a+c),d},SO.Integer.parse=function(a){if(""===a||null===a||void 0===a)return 0;var b=parseInt(a,10),c=SO.isInteger(b)&&SO.Integer.REG_EXP.test(a);if(SO.assert(c),!c)throw new Error(a+" could not be parsed to an Integer");return b},SO.Integer.toString=function(a){return void 0!==a&&null!==a?a.toString():""},SO.Integer.format=function(a,b){b=SO.Utils.extend({format:"#,##0"},b);var c=SO.LocaleManager.getDefaultLocale();if(void 0!==b.locale&&(c=SO.LocaleManager.getLocale(b.locale),c=SO.assert(c,b.locale+"is not a valid locale name.")?c:SO.LocaleManager.getDefaultLocale()),SO.assert(SO.isInteger(a),a+" is not a valid integer value.")){switch(b.pattern=b.format,b.localeSettings=c.getSettings(),b.format){case"dataSize":return SO.Integer._formatWithUnit(a,b,b.format).trim();default:b.pattern=b.format}return delete b.format,SO.Number._format(a,b)}return""},SO.Integer._formatWithUnit=function(a,b,c){var d=b.localeSettings.units[c];if(!d)throw new Error("Invalid unit '"+c+"'");var e=!1;0>a&&(a=-a,e=!0);for(var f=d.length-1;f>0&&d[f].factor>a;)f--;var b=SO.Utils.extend(b,{pattern:null,addSymbol:!0,symbol:d[f].symbol});return a=e?-a:a,SO.Number._format(a/d[f].factor,b)};
;// LICENSE Highcharts JS 3.0.10 - see licenses.txt §2.11
(function(){function a(a,b){var c;a||(a={});for(c in b)a[c]=b[c];return a}function b(){var a,b,c=arguments,d={},e=function(a,b){var c,d;"object"!=typeof a&&(a={});for(d in b)b.hasOwnProperty(d)&&(c=b[d],a[d]=c&&"object"==typeof c&&"[object Array]"!==Object.prototype.toString.call(c)&&"renderTo"!==d&&"number"!=typeof c.nodeType?e(a[d]||{},c):b[d]);return a};for(c[0]===!0&&(d=c[1],c=Array.prototype.slice.call(c,2)),b=c.length,a=0;b>a;a++)d=e(d,c[a]);return d}function c(){for(var a=0,b=arguments,c=b.length,d={};c>a;a++)d[b[a++]]=b[a];return d}function d(a,b){return parseInt(a,b||10)}function e(a){return"string"==typeof a}function f(a){return"object"==typeof a}function g(a){return"[object Array]"===Object.prototype.toString.call(a)}function h(a){return"number"==typeof a}function i(a){return nb.log(a)/nb.LN10}function j(a){return nb.pow(10,a)}function k(a,b){for(var c=a.length;c--;)if(a[c]===b){a.splice(c,1);break}}function l(a){return a!==Q&&null!==a}function m(a,b,c){var d,g,h="setAttribute";if(e(b))l(c)?a[h](b,c):a&&a.getAttribute&&(g=a.getAttribute(b));else if(l(b)&&f(b))for(d in b)a[h](d,b[d]);return g}function n(a){return g(a)?a:[a]}function o(){var a,b,c=arguments,d=c.length;for(a=0;d>a;a++)if(b=c[a],"undefined"!=typeof b&&null!==b)return b}function p(b,c){Ab&&!Gb&&c&&c.opacity!==Q&&(c.filter="alpha(opacity="+100*c.opacity+")"),a(b.style,c)}function q(b,c,d,e,f){var g=lb.createElement(b);return c&&a(g,c),f&&p(g,{padding:0,border:Wb,margin:0}),d&&p(g,d),e&&e.appendChild(g),g}function r(b,c){var d=function(){};return d.prototype=new b,a(d.prototype,c),d}function s(a,b,c,e){var f=U.lang,g=+a||0,h=-1===b?(g.toString().split(".")[1]||"").length:isNaN(b=tb(b))?2:b,i=void 0===c?f.decimalPoint:c,j=void 0===e?f.thousandsSep:e,k=0>g?"-":"",l=String(d(g=tb(g).toFixed(h))),m=l.length>3?l.length%3:0;return k+(m?l.substr(0,m)+j:"")+l.substr(m).replace(/(\d{3})(?=\d)/g,"$1"+j)+(h?i+tb(g-l).toFixed(h).slice(2):"")}function t(a,b){return new Array((b||2)+1-String(a).length).join(0)+a}function u(a,b,c){var d=a[b];a[b]=function(){var a=Array.prototype.slice.call(arguments);return a.unshift(d),c.apply(this,a)}}function v(a,b){var c,d=/f$/,e=/\.([0-9])/,f=U.lang;return d.test(a)?(c=a.match(e),c=c?c[1]:-1,b=s(b,c,f.decimalPoint,a.indexOf(",")>-1?f.thousandsSep:"")):b=V(a,b),b}function w(a,b){for(var c,d,e,f,g,h,i,j="{",k=!1,l=[];-1!==(i=a.indexOf(j));){if(c=a.slice(0,i),k){for(d=c.split(":"),e=d.shift().split("."),g=e.length,h=b,f=0;g>f;f++)h=h[e[f]];d.length&&(h=v(d.join(":"),h)),l.push(h)}else l.push(c);a=a.slice(i+1),k=!k,j=k?"}":"{"}return l.push(a),l.join("")}function x(a){return nb.pow(10,pb(nb.log(a)/nb.LN10))}function y(a,b,c,d){var e,f;for(c=o(c,1),e=a/c,b||(b=[1,2,2.5,5,10],d&&d.allowDecimals===!1&&(1===c?b=[1,2,5,10]:.1>=c&&(b=[1/c]))),f=0;b.length>f&&(a=b[f],!((b[f]+(b[f+1]||b[f]))/2>=e));f++);return a*=c}function z(){this.color=0,this.symbol=0}function A(a,b){var c,d,e=a.length;for(d=0;e>d;d++)a[d].ss_i=d;for(a.sort(function(a,d){return c=b(a,d),0===c?a.ss_i-d.ss_i:c}),d=0;e>d;d++)delete a[d].ss_i}function B(a){for(var b=a.length,c=a[0];b--;)c>a[b]&&(c=a[b]);return c}function C(a){for(var b=a.length,c=a[0];b--;)a[b]>c&&(c=a[b]);return c}function D(a,b){var c;for(c in a)a[c]&&a[c]!==b&&a[c].destroy&&a[c].destroy(),delete a[c]}function E(a){T||(T=q(Pb)),a&&T.appendChild(a),T.innerHTML=""}function F(a,b){var c="Highcharts error #"+a+": www.highcharts.com/errors/"+a;if(b)throw c;mb.console&&console.log(c)}function G(a){return parseFloat(a.toPrecision(14))}function H(a,b){W=o(a,b.animation)}function I(){var a=U.global.useUTC,b=a?"getUTC":"get",c=a?"setUTC":"set";_=6e4*(a&&U.global.timezoneOffset||0),$=a?Date.UTC:function(a,b,c,d,e,f){return new Date(a,b,o(c,1),o(d,0),o(e,0),o(f,0)).getTime()},ab=b+"Minutes",bb=b+"Hours",cb=b+"Day",db=b+"Date",eb=b+"Month",fb=b+"FullYear",gb=c+"Minutes",hb=c+"Hours",ib=c+"Date",jb=c+"Month",kb=c+"FullYear"}function J(a){return U=b(!0,U,a),I(),U}function K(){return U}function L(){}function M(a,b,c,d){this.axis=a,this.pos=b,this.type=c||"",this.isNew=!0,c||d||this.addLabel()}function N(){this.init.apply(this,arguments)}function O(){this.init.apply(this,arguments)}function P(a,b,c,d,e,f){var g=a.chart.inverted;this.axis=a,this.isNegative=c,this.options=b,this.x=d,this.total=null,this.points={},this.stack=e,this.percent="percent"===f,this.alignOptions={align:b.align||(g?c?"left":"right":"center"),verticalAlign:b.verticalAlign||(g?"middle":c?"bottom":"top"),y:o(b.y,g?4:c?14:-6),x:o(b.x,g?c?-6:6:0)},this.textAlign=b.textAlign||(g?c?"right":"left":"center")}var Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb=document,mb=window,nb=Math,ob=nb.round,pb=nb.floor,qb=nb.ceil,rb=nb.max,sb=nb.min,tb=nb.abs,ub=nb.cos,vb=nb.sin,wb=nb.PI,xb=2*wb/360,yb=navigator.userAgent,zb=mb.opera,Ab=/msie/i.test(yb)&&!zb,Bb=8===lb.documentMode,Cb=/AppleWebKit/.test(yb),Db=/Firefox/.test(yb),Eb=/(Mobile|Android|Windows Phone)/.test(yb),Fb="http://www.w3.org/2000/svg",Gb=!!lb.createElementNS&&!!lb.createElementNS(Fb,"svg").createSVGRect,Hb=Db&&4>parseInt(yb.split("Firefox/")[1],10),Ib=!Gb&&!Ab&&!!lb.createElement("canvas").getContext,Jb={},Kb=0,Lb=function(){},Mb=[],Nb="Highcharts",Ob="3.0.10",Pb="div",Qb="absolute",Rb="relative",Sb="hidden",Tb="highcharts-",Ub="visible",Vb="px",Wb="none",Xb="M",Yb="L",Zb=/^[0-9]+$/,$b="",_b="hover",ac="select",bc="millisecond",cc="second",dc="minute",ec="hour",fc="day",gc="week",hc="month",ic="year",jc="stroke-width",kc={},lc=mb.Highcharts=mb.Highcharts?F(16,!0):{};V=function(b,c,d){if(!l(c)||isNaN(c))return"Invalid date";b=o(b,"%Y-%m-%d %H:%M:%S");var e,f=new Date(c-_),g=f[bb](),h=f[cb](),i=f[db](),j=f[eb](),k=f[fb](),m=U.lang,n=m.weekdays,p=a({a:n[h].substr(0,3),A:n[h],d:t(i),e:i,b:m.shortMonths[j],B:m.months[j],m:t(j+1),y:k.toString().substr(2,2),Y:k,H:t(g),I:t(g%12||12),l:g%12||12,M:t(f[ab]()),p:12>g?"AM":"PM",P:12>g?"am":"pm",S:t(f.getSeconds()),L:t(ob(c%1e3),3)},lc.dateFormats);for(e in p)for(;-1!==b.indexOf("%"+e);)b=b.replace("%"+e,"function"==typeof p[e]?p[e](c):p[e]);return d?b.substr(0,1).toUpperCase()+b.substr(1):b},z.prototype={wrapColor:function(a){this.color>=a&&(this.color=0)},wrapSymbol:function(a){this.symbol>=a&&(this.symbol=0)}},Y=c(bc,1,cc,1e3,dc,6e4,ec,36e5,fc,864e5,gc,6048e5,hc,26784e5,ic,31556952e3),X={init:function(a,b,c){b=b||"";var d,e,f,g,h,i=a.shift,j=b.indexOf("C")>-1,k=j?7:3,l=b.split(" "),m=[].concat(c),n=function(a){for(f=a.length;f--;)a[f]===Xb&&a.splice(f+1,0,a[f+1],a[f+2],a[f+1],a[f+2])};if(j&&(n(l),n(m)),a.isArea&&(g=l.splice(l.length-6,6),h=m.splice(m.length-6,6)),m.length/k>=i&&l.length===m.length)for(;i--;)m=[].concat(m).splice(0,k).concat(m);if(a.shift=0,l.length)for(d=m.length;d>l.length;)e=[].concat(l).splice(l.length-k,k),j&&(e[k-6]=e[k-2],e[k-5]=e[k-1]),l=l.concat(e);return g&&(l=l.concat(g),m=m.concat(h)),[l,m]},step:function(a,b,c,d){var e,f=[],g=a.length;if(1===c)f=d;else if(g===b.length&&1>c)for(;g--;)e=parseFloat(a[g]),f[g]=isNaN(e)?a[g]:c*parseFloat(b[g]-e)+e;else f=b;return f}},function(b){mb.HighchartsAdapter=mb.HighchartsAdapter||b&&{init:function(a){var c,d=b.fx,f=d.step,g=b.Tween,h=g&&g.propHooks,i=b.cssHooks.opacity;b.extend(b.easing,{easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c}}),b.each(["cur","_default","width","height","opacity"],function(a,b){var c,e=f;"cur"===b?e=d.prototype:"_default"===b&&g&&(e=h[b],b="set"),c=e[b],c&&(e[b]=function(d){var e;return d=a?d:this,"align"!==d.prop?(e=d.elem,e.attr?e.attr(d.prop,"cur"===b?Q:d.now):c.apply(this,arguments)):void 0})}),u(i,"get",function(a,b,c){return b.attr?b.opacity||0:a.call(this,b,c)}),c=function(b){var c,d=b.elem;b.started||(c=a.init(d,d.d,d.toD),b.start=c[0],b.end=c[1],b.started=!0),d.attr("d",a.step(b.start,b.end,b.pos,d.toD))},g?h.d={set:c}:f.d=c,this.each=Array.prototype.forEach?function(a,b){return Array.prototype.forEach.call(a,b)}:function(a,b){for(var c=0,d=a.length;d>c;c++)if(b.call(a[c],a[c],c,a)===!1)return c},b.fn.highcharts=function(){var a,b,c,d="Chart",f=arguments;return e(f[0])&&(d=f[0],f=Array.prototype.slice.call(f,1)),a=f[0],a!==Q&&(a.chart=a.chart||{},a.chart.renderTo=this[0],c=new lc[d](a,f[1]),b=this),a===Q&&(b=Mb[m(this[0],"data-highcharts-chart")]),b}},getScript:b.getScript,inArray:b.inArray,adapterRun:function(a,c){return b(a)[c]()},grep:b.grep,map:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=b.call(a[d],a[d],d,a);return c},offset:function(a){return b(a).offset()},addEvent:function(a,c,d){b(a).bind(c,d)},removeEvent:function(a,c,d){var e=lb.removeEventListener?"removeEventListener":"detachEvent";lb[e]&&a&&!a[e]&&(a[e]=function(){}),b(a).unbind(c,d)},fireEvent:function(c,d,e,f){var g,h=b.Event(d),i="detached"+d;!Ab&&e&&(delete e.layerX,delete e.layerY),a(h,e),c[d]&&(c[i]=c[d],c[d]=null),b.each(["preventDefault","stopPropagation"],function(a,b){var c=h[b];h[b]=function(){try{c.call(h)}catch(a){"preventDefault"===b&&(g=!0)}}}),b(c).trigger(h),c[i]&&(c[d]=c[i],c[i]=null),!f||h.isDefaultPrevented()||g||f(h)},washMouseEvent:function(a){var b=a.originalEvent||a;return b.pageX===Q&&(b.pageX=a.pageX,b.pageY=a.pageY),b},animate:function(a,c,d){var e=b(a);a.style||(a.style={}),c.d&&(a.toD=c.d,c.d=1),e.stop(),c.opacity!==Q&&a.attr&&(c.opacity+="px"),e.animate(c,d)},stop:function(a){b(a).stop()}}}(mb.jQuery);var mc=mb.HighchartsAdapter,nc=mc||{};mc&&mc.init.call(mc,X);var oc=nc.adapterRun,pc=nc.getScript,qc=nc.inArray,rc=nc.each,sc=nc.grep,tc=nc.offset,uc=nc.map,vc=nc.addEvent,wc=nc.removeEvent,xc=nc.fireEvent,yc=nc.washMouseEvent,zc=nc.animate,Ac=nc.stop,Bc={enabled:!0,x:0,y:15,style:{color:"#666",cursor:"default",fontSize:"11px"}};U={colors:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],decimalPoint:".",numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:","},global:{useUTC:!0,canvasToolsURL:"http://code.highcharts.com/3.0.10/modules/canvas-tools.js",VMLRadialGradientURL:"http://code.highcharts.com/3.0.10/gfx/vml-radial-gradient.png"},chart:{borderColor:"#4572A7",borderRadius:5,defaultSeriesType:"line",ignoreHiddenSeries:!0,spacing:[10,10,15,10],backgroundColor:"#FFFFFF",plotBorderColor:"#C0C0C0",resetZoomButton:{theme:{zIndex:20},position:{align:"right",x:-10,y:10}}},title:{text:"Chart title",align:"center",margin:15,style:{color:"#274b6d",fontSize:"16px"}},subtitle:{text:"",align:"center",style:{color:"#4d759e"}},plotOptions:{line:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:{enabled:!0,lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:b(Bc,{align:"center",enabled:!1,formatter:function(){return null===this.y?"":s(this.y,-1)},verticalAlign:"bottom",y:0}),cropThreshold:300,pointRange:0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!0,turboThreshold:1e3}},labels:{style:{position:Qb,color:"#3E576F"}},legend:{enabled:!0,align:"center",layout:"horizontal",labelFormatter:function(){return this.name},borderWidth:1,borderColor:"#909090",borderRadius:5,navigation:{activeColor:"#274b6d",inactiveColor:"#CCC"},shadow:!1,itemStyle:{color:"#274b6d",fontSize:"12px"},itemHoverStyle:{color:"#000"},itemHiddenStyle:{color:"#CCC"},itemCheckboxStyle:{position:Qb,width:"13px",height:"13px"},symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:Rb,top:"1em"},style:{position:Qb,backgroundColor:"white",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:Gb,backgroundColor:"rgba(255, 255, 255, .85)",borderWidth:1,borderRadius:3,dateTimeLabelFormats:{millisecond:"%A, %b %e, %H:%M:%S.%L",second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",week:"Week from %A, %b %e, %Y",month:"%B %Y",year:"%Y"},headerFormat:'<span style="font-size: 10px">{point.key}</span><br/>',pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>',shadow:!0,snap:Eb?25:10,style:{color:"#333333",cursor:"default",fontSize:"12px",padding:"8px",whiteSpace:"nowrap"}},credits:{enabled:!0,text:"Highcharts.com",href:"http://www.highcharts.com",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#909090",fontSize:"9px"}}};var Cc=U.plotOptions,Dc=Cc.line;I();var Ec=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,Fc=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,Gc=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,Hc=function(a){function c(a){a&&a.stops?j=uc(a.stops,function(a){return Hc(a[1])}):(i=Ec.exec(a),i?k=[d(i[1]),d(i[2]),d(i[3]),parseFloat(i[4],10)]:(i=Fc.exec(a),i?k=[d(i[1],16),d(i[2],16),d(i[3],16),1]:(i=Gc.exec(a),i&&(k=[d(i[1]),d(i[2]),d(i[3]),1]))))}function e(c){var d;return j?(d=b(a),d.stops=[].concat(d.stops),rc(j,function(a,b){d.stops[b]=[d.stops[b][0],a.get(c)]})):d=k&&!isNaN(k[0])?"rgb"===c?"rgb("+k[0]+","+k[1]+","+k[2]+")":"a"===c?k[3]:"rgba("+k.join(",")+")":a,d}function f(a){if(j)rc(j,function(b){b.brighten(a)});else if(h(a)&&0!==a){var b;for(b=0;3>b;b++)k[b]+=d(255*a),0>k[b]&&(k[b]=0),k[b]>255&&(k[b]=255)}return this}function g(a){return k[3]=a,this}var i,j,k=[];return c(a),{get:e,brighten:f,rgba:k,setOpacity:g}};L.prototype={init:function(a,b){var c=this;c.element="span"===b?q(b):lb.createElementNS(Fb,b),c.renderer=a,c.attrSetters={}},opacity:1,animate:function(a,c,d){var e=o(c,W,!0);Ac(this),e?(e=b(e,{}),d&&(e.complete=d),zc(this,a,e)):(this.attr(a),d&&d())},attr:function(a,b){var c,f,g,h,i,j,k,n,p,q=this,r=q.element,s=r.nodeName.toLowerCase(),t=q.renderer,u=q.attrSetters,v=q.shadows,w=q;if(e(a)&&l(b)&&(c=a,a={},a[c]=b),e(a))c=a,"circle"===s?c={x:"cx",y:"cy"}[c]||c:"strokeWidth"===c&&(c="stroke-width"),w=m(r,c)||q[c]||0,"d"!==c&&"visibility"!==c&&"fill"!==c&&(w=parseFloat(w));else{for(c in a)if(j=!1,f=a[c],g=u[c]&&u[c].call(q,f,c),g!==!1){if(g!==Q&&(f=g),"d"===c)f&&f.join&&(f=f.join(" ")),/(NaN| {2}|^$)/.test(f)&&(f="M 0 0");else if("x"===c&&"text"===s)for(h=0;r.childNodes.length>h;h++)i=r.childNodes[h],m(i,"x")===m(r,"x")&&m(i,"x",f);else if(!q.rotation||"x"!==c&&"y"!==c)if("fill"===c)f=t.color(f,r,c);else if("circle"!==s||"x"!==c&&"y"!==c)if("rect"===s&&"r"===c)m(r,{rx:f,ry:f}),j=!0;else if("translateX"===c||"translateY"===c||"rotation"===c||"verticalAlign"===c||"scaleX"===c||"scaleY"===c)p=!0,j=!0;else if("stroke"===c)f=t.color(f,r,c);else if("dashstyle"===c){if(c="stroke-dasharray",f=f&&f.toLowerCase(),"solid"===f)f=Wb;else if(f){for(f=f.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(","),h=f.length;h--;)f[h]=d(f[h])*o(a["stroke-width"],q["stroke-width"]);f=f.join(",")}}else"width"===c?f=d(f):"align"===c?(c="text-anchor",f={left:"start",center:"middle",right:"end"}[f]):"title"===c&&(k=r.getElementsByTagName("title")[0],k||(k=lb.createElementNS(Fb,"title"),r.appendChild(k)),k.textContent=f);else c={x:"cx",y:"cy"}[c]||c;else p=!0;if("strokeWidth"===c&&(c="stroke-width"),("stroke-width"===c||"stroke"===c)&&(q[c]=f,q.stroke&&q["stroke-width"]?(m(r,"stroke",q.stroke),m(r,"stroke-width",q["stroke-width"]),q.hasStroke=!0):"stroke-width"===c&&0===f&&q.hasStroke&&(r.removeAttribute("stroke"),q.hasStroke=!1),j=!0),q.symbolName&&/^(x|y|width|height|r|start|end|innerR|anchorX|anchorY)/.test(c)&&(n||(q.symbolAttr(a),n=!0),j=!0),v&&/^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(c))for(h=v.length;h--;)m(v[h],c,"height"===c?rb(f-(v[h].cutHeight||0),0):f);("width"===c||"height"===c)&&"rect"===s&&0>f&&(f=0),q[c]=f,"text"===c?f!==q.textStr&&(delete q.bBox,q.textStr=f,q.added&&t.buildText(q)):j||void 0!==f&&r.setAttribute(c,f)}p&&q.updateTransform()}return w},addClass:function(a){var b=this.element,c=m(b,"class")||"";return-1===c.indexOf(a)&&m(b,"class",c+" "+a),this},symbolAttr:function(a){var b=this;rc(["x","y","r","start","end","width","height","innerR","anchorX","anchorY"],function(c){b[c]=o(a[c],b[c])}),b.attr({d:b.renderer.symbols[b.symbolName](b.x,b.y,b.width,b.height,b)})},clip:function(a){return this.attr("clip-path",a?"url("+this.renderer.url+"#"+a.id+")":Wb)},crisp:function(a){var b,c,d=this,e={},f=a.strokeWidth||d.strokeWidth||d.attr&&d.attr("stroke-width")||0;c=ob(f)%2/2,a.x=pb(a.x||d.x||0)+c,a.y=pb(a.y||d.y||0)+c,a.width=pb((a.width||d.width||0)-2*c),a.height=pb((a.height||d.height||0)-2*c),a.strokeWidth=f;for(b in a)d[b]!==a[b]&&(d[b]=e[b]=a[b]);return e},css:function(b){var c,e,f,g=this,h=g.styles,i={},j=g.element,k="",l=!h;if(b&&b.color&&(b.fill=b.color),h)for(e in b)b[e]!==h[e]&&(i[e]=b[e],l=!0);if(l){if(c=g.textWidth=b&&b.width&&"text"===j.nodeName.toLowerCase()&&d(b.width),h&&(b=a(h,i)),g.styles=b,c&&(Ib||!Gb&&g.renderer.forExport)&&delete b.width,Ab&&!Gb)p(g.element,b);else{f=function(a,b){return"-"+b.toLowerCase()};for(e in b)k+=e.replace(/([A-Z])/g,f)+":"+b[e]+";";m(j,"style",k)}c&&g.added&&g.renderer.buildText(g)}return g},on:function(a,b){var c=this,d=c.element;return S&&"click"===a?(d.ontouchstart=function(a){c.touchEventFired=Date.now(),a.preventDefault(),b.call(d,a)},d.onclick=function(a){(-1===yb.indexOf("Android")||Date.now()-(c.touchEventFired||0)>1100)&&b.call(d,a)}):d["on"+a]=b,this},setRadialReference:function(a){return this.element.radialReference=a,this},translate:function(a,b){return this.attr({translateX:a,translateY:b})},invert:function(){var a=this;return a.inverted=!0,a.updateTransform(),a},updateTransform:function(){var a,b=this,c=b.translateX||0,d=b.translateY||0,e=b.scaleX,f=b.scaleY,g=b.inverted,h=b.rotation;g&&(c+=b.attr("width"),d+=b.attr("height")),a=["translate("+c+","+d+")"],g?a.push("rotate(90) scale(-1,1)"):h&&a.push("rotate("+h+" "+(b.x||0)+" "+(b.y||0)+")"),(l(e)||l(f))&&a.push("scale("+o(e,1)+" "+o(f,1)+")"),a.length&&m(b.element,"transform",a.join(" "))},toFront:function(){var a=this.element;return a.parentNode.appendChild(a),this},align:function(a,b,c){var d,f,g,h,i,j={},l=this.renderer,m=l.alignedObjects;return a?(this.alignOptions=a,this.alignByTranslate=b,(!c||e(c))&&(this.alignTo=i=c||"renderer",k(m,this),m.push(this),c=null)):(a=this.alignOptions,b=this.alignByTranslate,i=this.alignTo),c=o(c,l[i],l),d=a.align,f=a.verticalAlign,g=(c.x||0)+(a.x||0),h=(c.y||0)+(a.y||0),("right"===d||"center"===d)&&(g+=(c.width-(a.width||0))/{right:1,center:2}[d]),j[b?"translateX":"x"]=ob(g),("bottom"===f||"middle"===f)&&(h+=(c.height-(a.height||0))/({bottom:1,middle:2}[f]||1)),j[b?"translateY":"y"]=ob(h),this[this.placed?"animate":"attr"](j),this.placed=!0,this.alignAttr=j,this},getBBox:function(){var b,c,d,e=this,f=e.bBox,g=e.renderer,h=e.rotation,i=e.element,j=e.styles,k=h*xb,l=e.textStr;if((""===l||Zb.test(l))&&(d=l.toString().length+(j?"|"+j.fontSize+"|"+j.fontFamily:""),f=g.cache[d]),!f){if(i.namespaceURI===Fb||g.forExport){try{f=i.getBBox?a({},i.getBBox()):{width:i.offsetWidth,height:i.offsetHeight}}catch(m){}(!f||0>f.width)&&(f={width:0,height:0})}else f=e.htmlGetBBox();g.isSVG&&(b=f.width,c=f.height,Ab&&j&&"11px"===j.fontSize&&"16.9"===c.toPrecision(3)&&(f.height=c=14),h&&(f.width=tb(c*vb(k))+tb(b*ub(k)),f.height=tb(c*ub(k))+tb(b*vb(k)))),e.bBox=f,d&&(g.cache[d]=f)}return f},show:function(a){return this.attr({visibility:a?"inherit":Ub})},hide:function(){return this.attr({visibility:Sb})},fadeOut:function(a){var b=this;b.animate({opacity:0},{duration:a||150,complete:function(){b.hide()}})},add:function(a){var b,c,e,f,g,h=this.renderer,i=a||h,j=i.element||h.box,k=this.element,n=this.zIndex;if(a&&(this.parentGroup=a),this.parentInverted=a&&a.inverted,void 0!==this.textStr&&h.buildText(this),n&&(i.handleZ=!0,n=d(n)),i.handleZ)for(b=j.childNodes,f=0;b.length>f;f++)if(c=b[f],e=m(c,"zIndex"),c!==k&&(d(e)>n||!l(n)&&l(e))){j.insertBefore(k,c),g=!0;break}return g||j.appendChild(k),this.added=!0,this.onAdd&&this.onAdd(),this},safeRemoveChild:function(a){var b=a.parentNode;b&&b.removeChild(a)},destroy:function(){var a,b,c,d=this,e=d.element||{},f=d.shadows,g=d.renderer.isSVG&&"SPAN"===e.nodeName&&d.parentGroup;if(e.onclick=e.onmouseout=e.onmouseover=e.onmousemove=e.point=null,Ac(d),d.clipPath&&(d.clipPath=d.clipPath.destroy()),d.stops){for(c=0;d.stops.length>c;c++)d.stops[c]=d.stops[c].destroy();d.stops=null}for(d.safeRemoveChild(e),f&&rc(f,function(a){d.safeRemoveChild(a)});g&&0===g.div.childNodes.length;)a=g.parentGroup,d.safeRemoveChild(g.div),delete g.div,g=a;d.alignTo&&k(d.renderer.alignedObjects,d);for(b in d)delete d[b];return null},shadow:function(a,b,c){var d,e,f,g,h,i,j=[],k=this.element;if(a){for(g=o(a.width,3),h=(a.opacity||.15)/g,i=this.parentInverted?"(-1,-1)":"("+o(a.offsetX,1)+", "+o(a.offsetY,1)+")",d=1;g>=d;d++)e=k.cloneNode(0),f=2*g+1-2*d,m(e,{isShadow:"true",stroke:a.color||"black","stroke-opacity":h*d,"stroke-width":f,transform:"translate"+i,fill:Wb}),c&&(m(e,"height",rb(m(e,"height")-f,0)),e.cutHeight=f),b?b.element.appendChild(e):k.parentNode.insertBefore(e,k),j.push(e);this.shadows=j}return this}};var Ic=function(){this.init.apply(this,arguments)};Ic.prototype={Element:L,init:function(a,b,c,d,e){var f,g,h,i=this,j=location;f=i.createElement("svg").attr({version:"1.1"}).css(this.getStyle(d)),g=f.element,a.appendChild(g),-1===a.innerHTML.indexOf("xmlns")&&m(g,"xmlns",Fb),i.isSVG=!0,i.box=g,i.boxWrapper=f,i.alignedObjects=[],i.url=(Db||Cb)&&lb.getElementsByTagName("base").length?j.href.replace(/#.*?$/,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20"):"",h=this.createElement("desc").add(),h.element.appendChild(lb.createTextNode("Created with "+Nb+" "+Ob)),i.defs=this.createElement("defs").add(),i.forExport=e,i.gradients={},i.cache={},i.setSize(b,c,!1);var k,l;Db&&a.getBoundingClientRect&&(i.subPixelFix=k=function(){p(a,{left:0,top:0}),l=a.getBoundingClientRect(),p(a,{left:qb(l.left)-l.left+Vb,top:qb(l.top)-l.top+Vb})},k(),vc(mb,"resize",k))},getStyle:function(b){return this.style=a({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif',fontSize:"12px"},b)},isHidden:function(){return!this.boxWrapper.getBBox().width},destroy:function(){var a=this,b=a.defs;return a.box=null,a.boxWrapper=a.boxWrapper.destroy(),D(a.gradients||{}),a.gradients=null,b&&(a.defs=b.destroy()),a.subPixelFix&&wc(mb,"resize",a.subPixelFix),a.alignedObjects=null,null},createElement:function(a){var b=new this.Element;return b.init(this,a),b},draw:function(){},buildText:function(a){for(var b=a.element,c=this,e=c.forExport,f=o(a.textStr,"").toString().replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">').replace(/<a/g,"<span").replace(/<\/(b|strong|i|em|a)>/g,"</span>").split(/<br.*?>/g),g=b.childNodes,h=/<.*style="([^"]+)".*>/,i=/<.*href="(http[^"]+)".*>/,j=m(b,"x"),k=a.styles,l=a.textWidth,n=k&&k.lineHeight,q=g.length,r=function(a){return n?d(n):c.fontMetrics(/(px|em)$/.test(a&&a.style.fontSize)?a.style.fontSize:k.fontSize||11).h};q--;)b.removeChild(g[q]);l&&!a.added&&this.box.appendChild(b),""===f[f.length-1]&&f.pop(),rc(f,function(d,f){var g,n=0;d=d.replace(/<span/g,"|||<span").replace(/<\/span>/g,"</span>|||"),g=d.split("|||"),rc(g,function(d){if(""!==d||1===g.length){var o,q={},s=lb.createElementNS(Fb,"tspan");if(h.test(d)&&(o=d.match(h)[1].replace(/(;| |^)color([ :])/,"$1fill$2"),m(s,"style",o)),i.test(d)&&!e&&(m(s,"onclick",'location.href="'+d.match(i)[1]+'"'),p(s,{cursor:"pointer"})),d=(d.replace(/<(.|\n)*?>/g,"")||" ").replace(/&lt;/g,"<").replace(/&gt;/g,">")," "!==d&&(s.appendChild(lb.createTextNode(d)),n?q.dx=0:q.x=j,m(s,q),!n&&f&&(!Gb&&e&&p(s,{display:"block"}),m(s,"dy",r(s),Cb&&s.offsetHeight)),b.appendChild(s),n++,l))for(var t,u,v,w=d.replace(/([^\^])-/g,"$1- ").split(" "),x=w.length>1&&"nowrap"!==k.whiteSpace,y=a._clipHeight,z=[],A=r(),B=1;x&&(w.length||z.length);)delete a.bBox,v=a.getBBox(),u=v.width,!Gb&&c.forExport&&(u=c.measureSpanWidth(s.firstChild.data,a.styles)),t=u>l,t&&1!==w.length?(s.removeChild(s.firstChild),z.unshift(w.pop())):(w=z,z=[],w.length&&(B++,y&&B*A>y?(w=["..."],a.attr("title",a.textStr)):(s=lb.createElementNS(Fb,"tspan"),m(s,{dy:A,x:j}),o&&m(s,"style",o),b.appendChild(s),u>l&&(l=u)))),w.length&&s.appendChild(lb.createTextNode(w.join(" ").replace(/- /g,"-")))}})})},button:function(c,d,e,f,g,h,i,j,k){var l,m,n,o,p,q,r=this.label(c,d,e,k,null,null,null,null,"button"),s=0,t="style",u={x1:0,y1:0,x2:0,y2:1};return g=b({"stroke-width":1,stroke:"#CCCCCC",fill:{linearGradient:u,stops:[[0,"#FEFEFE"],[1,"#F6F6F6"]]},r:2,padding:5,style:{color:"black"}},g),n=g[t],delete g[t],h=b(g,{stroke:"#68A",fill:{linearGradient:u,stops:[[0,"#FFF"],[1,"#ACF"]]}},h),o=h[t],delete h[t],i=b(g,{stroke:"#68A",fill:{linearGradient:u,stops:[[0,"#9BD"],[1,"#CDF"]]}},i),p=i[t],delete i[t],j=b(g,{style:{color:"#CCC"}},j),q=j[t],delete j[t],vc(r.element,Ab?"mouseover":"mouseenter",function(){3!==s&&r.attr(h).css(o)}),vc(r.element,Ab?"mouseout":"mouseleave",function(){3!==s&&(l=[g,h,i][s],m=[n,o,p][s],r.attr(l).css(m))}),r.setState=function(a){r.state=s=a,a?2===a?r.attr(i).css(p):3===a&&r.attr(j).css(q):r.attr(g).css(n)},r.on("click",function(){3!==s&&f.call(r)}).attr(g).css(a({cursor:"default"},n))},crispLine:function(a,b){return a[1]===a[4]&&(a[1]=a[4]=ob(a[1])-b%2/2),a[2]===a[5]&&(a[2]=a[5]=ob(a[2])+b%2/2),a},path:function(b){var c={fill:Wb};return g(b)?c.d=b:f(b)&&a(c,b),this.createElement("path").attr(c)},circle:function(a,b,c){var d=f(a)?a:{x:a,y:b,r:c};return this.createElement("circle").attr(d)},arc:function(a,b,c,d,e,g){var h;return f(a)&&(b=a.y,c=a.r,d=a.innerR,e=a.start,g=a.end,a=a.x),h=this.symbol("arc",a||0,b||0,c||0,c||0,{innerR:d||0,start:e||0,end:g||0}),h.r=c,h},rect:function(a,b,c,d,e,g){e=f(a)?a.r:e;var h=this.createElement("rect"),i=f(a)?a:a===Q?{}:{x:a,y:b,width:rb(c,0),height:rb(d,0)};return g!==Q&&(i.strokeWidth=g,i=h.crisp(i)),e&&(i.r=e),h.attr(i)},setSize:function(a,b,c){var d=this,e=d.alignedObjects,f=e.length;for(d.width=a,d.height=b,d.boxWrapper[o(c,!0)?"animate":"attr"]({width:a,height:b});f--;)e[f].align()},g:function(a){var b=this.createElement("g");return l(a)?b.attr({"class":Tb+a}):b},image:function(b,c,d,e,f){var g,h={preserveAspectRatio:Wb};return arguments.length>1&&a(h,{x:c,y:d,width:e,height:f}),g=this.createElement("image").attr(h),g.element.setAttributeNS?g.element.setAttributeNS("http://www.w3.org/1999/xlink","href",b):g.element.setAttribute("hc-svg-href",b),g},symbol:function(b,c,d,e,f,g){var h,i,j,k,l,m=this.symbols[b],n=m&&m(ob(c),ob(d),e,f,g),o=/^url\((.*?)\)$/;return n?(h=this.path(n),a(h,{symbolName:b,x:c,y:d,width:e,height:f}),g&&a(h,g)):o.test(b)&&(l=function(a,b){a.element&&(a.attr({width:b[0],height:b[1]}),a.alignByTranslate||a.translate(ob((e-b[0])/2),ob((f-b[1])/2)))},j=b.match(o)[1],k=Jb[j],h=this.image(j).attr({x:c,y:d}),h.isImg=!0,k?l(h,k):(h.attr({width:0,height:0}),i=q("img",{onload:function(){l(h,Jb[j]=[this.width,this.height])},src:j}))),h},symbols:{circle:function(a,b,c,d){var e=.166*c;return[Xb,a+c/2,b,"C",a+c+e,b,a+c+e,b+d,a+c/2,b+d,"C",a-e,b+d,a-e,b,a+c/2,b,"Z"]},square:function(a,b,c,d){return[Xb,a,b,Yb,a+c,b,a+c,b+d,a,b+d,"Z"]},triangle:function(a,b,c,d){return[Xb,a+c/2,b,Yb,a+c,b+d,a,b+d,"Z"]},"triangle-down":function(a,b,c,d){return[Xb,a,b,Yb,a+c,b,a+c/2,b+d,"Z"]},diamond:function(a,b,c,d){return[Xb,a+c/2,b,Yb,a+c,b+d/2,a+c/2,b+d,a,b+d/2,"Z"]},arc:function(a,b,c,d,e){var f=e.start,g=e.r||c||d,h=e.end-.001,i=e.innerR,j=e.open,k=ub(f),l=vb(f),m=ub(h),n=vb(h),o=wb>e.end-f?0:1;return[Xb,a+g*k,b+g*l,"A",g,g,0,o,1,a+g*m,b+g*n,j?Xb:Yb,a+i*m,b+i*n,"A",i,i,0,o,0,a+i*k,b+i*l,j?"":"Z"]}},clipRect:function(a,b,c,d){var e,f=Tb+Kb++,g=this.createElement("clipPath").attr({id:f}).add(this.defs);return e=this.rect(a,b,c,d,0).add(g),e.id=f,e.clipPath=g,e},color:function(a,c,d){var e,f,h,i,j,k,n,o,p,q,r,s=this,t=/^rgba/,u=[];if(a&&a.linearGradient?f="linearGradient":a&&a.radialGradient&&(f="radialGradient"),f){h=a[f],i=s.gradients,k=a.stops,p=c.radialReference,g(h)&&(a[f]=h={x1:h[0],y1:h[1],x2:h[2],y2:h[3],gradientUnits:"userSpaceOnUse"}),"radialGradient"===f&&p&&!l(h.gradientUnits)&&(h=b(h,{cx:p[0]-p[2]/2+h.cx*p[2],cy:p[1]-p[2]/2+h.cy*p[2],r:h.r*p[2],gradientUnits:"userSpaceOnUse"}));for(q in h)"id"!==q&&u.push(q,h[q]);for(q in k)u.push(k[q]);return u=u.join(","),i[u]?r=i[u].id:(h.id=r=Tb+Kb++,i[u]=j=s.createElement(f).attr(h).add(s.defs),j.stops=[],rc(k,function(a){var b;t.test(a[1])?(e=Hc(a[1]),n=e.get("rgb"),o=e.get("a")):(n=a[1],o=1),b=s.createElement("stop").attr({offset:a[0],"stop-color":n,"stop-opacity":o}).add(j),j.stops.push(b)})),"url("+s.url+"#"+r+")"}return t.test(a)?(e=Hc(a),m(c,d+"-opacity",e.get("a")),e.get("rgb")):(c.removeAttribute(d+"-opacity"),a)},text:function(a,b,c,d){var e,f=this,g=Ib||!Gb&&f.forExport;return d&&!f.forExport?f.html(a,b,c):(b=ob(o(b,0)),c=ob(o(c,0)),e=f.createElement("text").attr({x:b,y:c,text:a}),g&&e.css({position:Qb}),e.x=b,e.y=c,e)},fontMetrics:function(a){a=a||this.style.fontSize,a=/px/.test(a)?d(a):/em/.test(a)?12*parseFloat(a):12;var b=24>a?a+4:ob(1.2*a),c=ob(.8*b);return{h:b,b:c}},label:function(c,d,e,f,g,h,i,j,k){function m(){var a,c,d=z.element.style;q=(void 0===r||void 0===s||y.styles.textAlign)&&z.textStr&&z.getBBox(),y.width=(r||q.width||0)+2*B+C,y.height=(s||q.height||0)+2*B,v=B+x.fontMetrics(d&&d.fontSize).b,w&&(p||(a=ob(-A*B),c=j?-v:0,y.box=p=f?x.symbol(f,a,c,y.width,y.height,E):x.rect(a,c,y.width,y.height,0,E[jc]),p.attr("fill",Wb).add(y)),p.isImg||p.attr(b({width:y.width,height:y.height},E)),E=null)}function n(){var a,b=y.styles,c=b&&b.textAlign,d=C+B*(1-A);a=j?0:v,l(r)&&q&&("center"===c||"right"===c)&&(d+={center:.5,right:1}[c]*(r-q.width)),(d!==z.x||a!==z.y)&&z.attr({x:d,y:a}),z.x=d,z.y=a}function o(a,b){p?p.attr(a,b):E[a]=b}var p,q,r,s,t,u,v,w,x=this,y=x.g(k),z=x.text("",0,0,i).attr({zIndex:1}),A=0,B=3,C=0,D=0,E={},F=y.attrSetters;y.onAdd=function(){z.add(y),y.attr({text:c,x:d,y:e}),p&&l(g)&&y.attr({anchorX:g,anchorY:h})},F.width=function(a){return r=a,!1},F.height=function(a){return s=a,!1},F.padding=function(a){return l(a)&&a!==B&&(B=a,n()),!1},F.paddingLeft=function(a){return l(a)&&a!==C&&(C=a,n()),!1},F.align=function(a){return A={left:0,center:.5,right:1}[a],!1},F.text=function(a,b){return z.attr(b,a),m(),n(),!1},F[jc]=function(a,b){return a&&(w=!0),D=a%2/2,o(b,a),!1},F.stroke=F.fill=F.r=function(a,b){return"fill"===b&&a&&(w=!0),o(b,a),!1},F.anchorX=function(a,b){return g=a,o(b,a+D-t),!1},F.anchorY=function(a,b){return h=a,o(b,a-u),!1},F.x=function(a){return y.x=a,a-=A*((r||q.width)+B),t=ob(a),y.attr("translateX",t),!1},F.y=function(a){return u=y.y=ob(a),y.attr("translateY",u),!1};var G=y.css;return a(y,{css:function(a){if(a){var c={};a=b(a),rc(["fontSize","fontWeight","fontFamily","color","lineHeight","width","textDecoration","textShadow"],function(b){a[b]!==Q&&(c[b]=a[b],delete a[b])}),z.css(c)}return G.call(y,a)},getBBox:function(){return{width:q.width+2*B,height:q.height+2*B,x:q.x-B,y:q.y-B}},shadow:function(a){return p&&p.shadow(a),y},destroy:function(){wc(y.element,"mouseenter"),wc(y.element,"mouseleave"),z&&(z=z.destroy()),p&&(p=p.destroy()),L.prototype.destroy.call(y),y=x=m=n=o=null}})}},R=Ic,a(L.prototype,{htmlCss:function(b){var c=this,d=c.element,e=b&&"SPAN"===d.tagName&&b.width;return e&&(delete b.width,c.textWidth=e,c.updateTransform()),c.styles=a(c.styles,b),p(c.element,b),c},htmlGetBBox:function(){var a=this,b=a.element,c=a.bBox;return c||("text"===b.nodeName&&(b.style.position=Qb),c=a.bBox={x:b.offsetLeft,y:b.offsetTop,width:b.offsetWidth,height:b.offsetHeight}),c},htmlUpdateTransform:function(){if(!this.added)return this.alignOnAdd=!0,void 0;
var a=this,b=a.renderer,c=a.element,e=a.translateX||0,f=a.translateY||0,g=a.x||0,h=a.y||0,i=a.textAlign||"left",j={left:0,center:.5,right:1}[i],k=a.shadows;if(p(c,{marginLeft:e,marginTop:f}),k&&rc(k,function(a){p(a,{marginLeft:e+1,marginTop:f+1})}),a.inverted&&rc(c.childNodes,function(a){b.invertChild(a,c)}),"SPAN"===c.tagName){var m,n,q=a.rotation,r=d(a.textWidth),s=[q,i,c.innerHTML,a.textWidth].join(",");s!==a.cTT&&(n=b.fontMetrics(c.style.fontSize).b,l(q)&&a.setSpanRotation(q,j,n),m=o(a.elemWidth,c.offsetWidth),m>r&&/[ \-]/.test(c.textContent||c.innerText)&&(p(c,{width:r+Vb,display:"block",whiteSpace:"normal"}),m=r),a.getSpanCorrection(m,n,j,q,i)),p(c,{left:g+(a.xCorr||0)+Vb,top:h+(a.yCorr||0)+Vb}),Cb&&(n=c.offsetHeight),a.cTT=s}},setSpanRotation:function(a,b,c){var d={},e=Ab?"-ms-transform":Cb?"-webkit-transform":Db?"MozTransform":zb?"-o-transform":"";d[e]=d.transform="rotate("+a+"deg)",d[e+(Db?"Origin":"-origin")]=d.transformOrigin=100*b+"% "+c+"px",p(this.element,d)},getSpanCorrection:function(a,b,c){this.xCorr=-a*c,this.yCorr=-b}}),a(Ic.prototype,{html:function(b,c,d){var e=this.createElement("span"),f=e.attrSetters,g=e.element,h=e.renderer;return f.text=function(a){return a!==g.innerHTML&&delete this.bBox,g.innerHTML=this.textStr=a,!1},f.x=f.y=f.align=f.rotation=function(a,b){return"align"===b&&(b="textAlign"),e[b]=a,e.htmlUpdateTransform(),!1},e.attr({text:b,x:ob(c),y:ob(d)}).css({position:Qb,whiteSpace:"nowrap",fontFamily:this.style.fontFamily,fontSize:this.style.fontSize}),e.css=e.htmlCss,h.isSVG&&(e.add=function(b){var c,d,f=h.box.parentNode,i=[];if(this.parentGroup=b,b){if(c=b.div,!c){for(d=b;d;)i.push(d),d=d.parentGroup;rc(i.reverse(),function(b){var d;c=b.div=b.div||q(Pb,{className:m(b.element,"class")},{position:Qb,left:(b.translateX||0)+Vb,top:(b.translateY||0)+Vb},c||f),d=c.style,a(b.attrSetters,{translateX:function(a){d.left=a+Vb},translateY:function(a){d.top=a+Vb},visibility:function(a,b){d[b]=a}})})}}else c=f;return c.appendChild(g),e.added=!0,e.alignOnAdd&&e.htmlUpdateTransform(),e}),e}});var Jc,Kc;if(!Gb&&!Ib){lc.VMLElement=Kc={init:function(a,b){var c=this,d=["<",b,' filled="f" stroked="f"'],e=["position: ",Qb,";"],f=b===Pb;("shape"===b||f)&&e.push("left:0;top:0;width:1px;height:1px;"),e.push("visibility: ",f?Sb:Ub),d.push(' style="',e.join(""),'"/>'),b&&(d=f||"span"===b||"img"===b?d.join(""):a.prepVML(d),c.element=q(d)),c.renderer=a,c.attrSetters={}},add:function(a){var b=this,c=b.renderer,d=b.element,e=c.box,f=a&&a.inverted,g=a?a.element||a:e;return f&&c.invertChild(d,g),g.appendChild(d),b.added=!0,b.alignOnAdd&&!b.deferUpdateTransform&&b.updateTransform(),b.onAdd&&b.onAdd(),b},updateTransform:L.prototype.htmlUpdateTransform,setSpanRotation:function(){var a=this.rotation,b=ub(a*xb),c=vb(a*xb);p(this.element,{filter:a?["progid:DXImageTransform.Microsoft.Matrix(M11=",b,", M12=",-c,", M21=",c,", M22=",b,", sizingMethod='auto expand')"].join(""):Wb})},getSpanCorrection:function(a,b,c,d,e){var f,g=d?ub(d*xb):1,h=d?vb(d*xb):0,i=o(this.elemHeight,this.element.offsetHeight),j=e&&"left"!==e;this.xCorr=0>g&&-a,this.yCorr=0>h&&-i,f=0>g*h,this.xCorr+=h*b*(f?1-c:c),this.yCorr-=g*b*(d?f?c:1-c:1),j&&(this.xCorr-=a*c*(0>g?-1:1),d&&(this.yCorr-=i*c*(0>h?-1:1)),p(this.element,{textAlign:e}))},pathToVML:function(a){for(var b=a.length,c=[];b--;)h(a[b])?c[b]=ob(10*a[b])-5:"Z"===a[b]?c[b]="x":(c[b]=a[b],!a.isArc||"wa"!==a[b]&&"at"!==a[b]||(c[b+5]===c[b+7]&&(c[b+7]+=a[b+7]>a[b+5]?1:-1),c[b+6]===c[b+8]&&(c[b+8]+=a[b+8]>a[b+6]?1:-1)));return c.join(" ")||"x"},attr:function(a,b){var c,d,f,g,i,j,k=this,n=k.element||{},o=n.style,p=n.nodeName,r=k.renderer,s=k.symbolName,t=k.shadows,u=k.attrSetters,v=k;if(e(a)&&l(b)&&(c=a,a={},a[c]=b),e(a))c=a,v="strokeWidth"===c||"stroke-width"===c?k.strokeweight:k[c];else for(c in a)if(d=a[c],j=!1,g=u[c]&&u[c].call(k,d,c),g!==!1&&null!==d){if(g!==Q&&(d=g),s&&/^(x|y|r|start|end|width|height|innerR|anchorX|anchorY)/.test(c))i||(k.symbolAttr(a),i=!0),j=!0;else if("d"===c){if(d=d||[],k.d=d.join(" "),n.path=d=k.pathToVML(d),t)for(f=t.length;f--;)t[f].path=t[f].cutOff?this.cutOffPath(d,t[f].cutOff):d;j=!0}else if("visibility"===c){if("inherit"===d&&(d=Ub),t)for(f=t.length;f--;)t[f].style[c]=d;"DIV"===p&&(d=d===Sb?"-999em":0,Bb||(o[c]=d?Ub:Sb),c="top"),o[c]=d,j=!0}else if("zIndex"===c)d&&(o[c]=d),j=!0;else if(-1!==qc(c,["x","y","width","height"]))k[c]=d,"x"===c||"y"===c?c={x:"left",y:"top"}[c]:d=rb(0,d),k.updateClipping?(k[c]=d,k.updateClipping()):o[c]=d,j=!0;else if("class"===c&&"DIV"===p)n.className=d;else if("stroke"===c)d=r.color(d,n,c),c="strokecolor";else if("stroke-width"===c||"strokeWidth"===c)n.stroked=d?!0:!1,c="strokeweight",k[c]=d,h(d)&&(d+=Vb);else if("dashstyle"===c){var w=n.getElementsByTagName("stroke")[0]||q(r.prepVML(["<stroke/>"]),null,null,n);w[c]=d||"solid",k.dashstyle=d,j=!0}else"fill"===c?"SPAN"===p?o.color=d:"IMG"!==p&&(n.filled=d!==Wb?!0:!1,d=r.color(d,n,c,k),c="fillcolor"):"opacity"===c?j=!0:"shape"===p&&"rotation"===c?(k[c]=n.style[c]=d,n.style.left=-ob(vb(d*xb)+1)+Vb,n.style.top=ob(ub(d*xb))+Vb):("translateX"===c||"translateY"===c||"rotation"===c)&&(k[c]=d,k.updateTransform(),j=!0);j||(Bb?n[c]=d:m(n,c,d))}return v},clip:function(a){var b,c,d=this;return a?(b=a.members,k(b,d),b.push(d),d.destroyClip=function(){k(b,d)},c=a.getCSS(d)):(d.destroyClip&&d.destroyClip(),c={clip:Bb?"inherit":"rect(auto)"}),d.css(c)},css:L.prototype.htmlCss,safeRemoveChild:function(a){a.parentNode&&E(a)},destroy:function(){return this.destroyClip&&this.destroyClip(),L.prototype.destroy.apply(this)},on:function(a,b){return this.element["on"+a]=function(){var a=mb.event;a.target=a.srcElement,b(a)},this},cutOffPath:function(a,b){var c;return a=a.split(/[ ,]/),c=a.length,(9===c||11===c)&&(a[c-4]=a[c-2]=d(a[c-2])-10*b),a.join(" ")},shadow:function(a,b,c){var e,f,g,h,i,j,k,l=[],m=this.element,n=this.renderer,p=m.style,r=m.path;if(r&&"string"!=typeof r.value&&(r="x"),i=r,a){for(j=o(a.width,3),k=(a.opacity||.15)/j,e=1;3>=e;e++)h=2*j+1-2*e,c&&(i=this.cutOffPath(r.value,h+.5)),g=['<shape isShadow="true" strokeweight="',h,'" filled="false" path="',i,'" coordsize="10 10" style="',m.style.cssText,'" />'],f=q(n.prepVML(g),null,{left:d(p.left)+o(a.offsetX,1),top:d(p.top)+o(a.offsetY,1)}),c&&(f.cutOff=h+1),g=['<stroke color="',a.color||"black",'" opacity="',k*e,'"/>'],q(n.prepVML(g),null,null,f),b?b.element.appendChild(f):m.parentNode.insertBefore(f,m),l.push(f);this.shadows=l}return this}},Kc=r(L,Kc);var Lc={Element:Kc,isIE8:yb.indexOf("MSIE 8.0")>-1,init:function(b,c,d,e){var f,g,h,i=this;if(i.alignedObjects=[],f=i.createElement(Pb).css(a(this.getStyle(e),{position:Rb})),g=f.element,b.appendChild(f.element),i.isVML=!0,i.box=g,i.boxWrapper=f,i.cache={},i.setSize(c,d,!1),!lb.namespaces.hcv){lb.namespaces.add("hcv","urn:schemas-microsoft-com:vml"),h="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } ";try{lb.createStyleSheet().cssText=h}catch(j){lb.styleSheets[0].cssText+=h}}},isHidden:function(){return!this.box.offsetWidth},clipRect:function(b,c,d,e){var g=this.createElement(),h=f(b);return a(g,{members:[],left:(h?b.x:b)+1,top:(h?b.y:c)+1,width:(h?b.width:d)-1,height:(h?b.height:e)-1,getCSS:function(b){var c=b.element,d=c.nodeName,e="shape"===d,f=b.inverted,g=this,h=g.top-(e?c.offsetTop:0),i=g.left,j=i+g.width,k=h+g.height,l={clip:"rect("+ob(f?i:h)+"px,"+ob(f?k:j)+"px,"+ob(f?j:k)+"px,"+ob(f?h:i)+"px)"};return!f&&Bb&&"DIV"===d&&a(l,{width:j+Vb,height:k+Vb}),l},updateClipping:function(){rc(g.members,function(a){a.css(g.getCSS(a))})}})},color:function(a,b,c,d){var e,f,g,h=this,i=/^rgba/,j=Wb;if(a&&a.linearGradient?g="gradient":a&&a.radialGradient&&(g="pattern"),g){var k,l,m,n,o,p,r,s,t,u,v,w,x=a.linearGradient||a.radialGradient,y="",z=a.stops,A=[],B=function(){f=['<fill colors="'+A.join(",")+'" opacity="',s,'" o:opacity2="',r,'" type="',g,'" ',y,'focus="100%" method="any" />'],q(h.prepVML(f),null,null,b)};if(v=z[0],w=z[z.length-1],v[0]>0&&z.unshift([0,v[1]]),1>w[0]&&z.push([1,w[1]]),rc(z,function(a,b){i.test(a[1])?(e=Hc(a[1]),k=e.get("rgb"),l=e.get("a")):(k=a[1],l=1),A.push(100*a[0]+"% "+k),b?(s=l,t=k):(r=l,u=k)}),"fill"===c)if("gradient"===g)m=x.x1||x[0]||0,n=x.y1||x[1]||0,o=x.x2||x[2]||0,p=x.y2||x[3]||0,y='angle="'+(90-180*nb.atan((p-n)/(o-m))/wb)+'"',B();else{var C,D=x.r,E=2*D,F=2*D,G=x.cx,H=x.cy,I=b.radialReference,J=function(){I&&(C=d.getBBox(),G+=(I[0]-C.x)/C.width-.5,H+=(I[1]-C.y)/C.height-.5,E*=I[2]/C.width,F*=I[2]/C.height),y='src="'+U.global.VMLRadialGradientURL+'" '+'size="'+E+","+F+'" '+'origin="0.5,0.5" '+'position="'+G+","+H+'" '+'color2="'+u+'" ',B()};d.added?J():d.onAdd=J,j=t}else j=k}else if(i.test(a)&&"IMG"!==b.tagName)e=Hc(a),f=["<",c,' opacity="',e.get("a"),'"/>'],q(this.prepVML(f),null,null,b),j=e.get("rgb");else{var K=b.getElementsByTagName(c);K.length&&(K[0].opacity=1,K[0].type="solid"),j=a}return j},prepVML:function(a){var b="display:inline-block;behavior:url(#default#VML);",c=this.isIE8;return a=a.join(""),c?(a=a.replace("/>",' xmlns="urn:schemas-microsoft-com:vml" />'),a=-1===a.indexOf('style="')?a.replace("/>",' style="'+b+'" />'):a.replace('style="','style="'+b)):a=a.replace("<","<hcv:"),a},text:Ic.prototype.html,path:function(b){var c={coordsize:"10 10"};return g(b)?c.d=b:f(b)&&a(c,b),this.createElement("shape").attr(c)},circle:function(a,b,c){var d=this.symbol("circle");return f(a)&&(c=a.r,b=a.y,a=a.x),d.isCircle=!0,d.r=c,d.attr({x:a,y:b})},g:function(a){var b,c;return a&&(c={className:Tb+a,"class":Tb+a}),b=this.createElement(Pb).attr(c)},image:function(a,b,c,d,e){var f=this.createElement("img").attr({src:a});return arguments.length>1&&f.attr({x:b,y:c,width:d,height:e}),f},createElement:function(a){return"rect"===a?this.symbol(a):Ic.prototype.createElement.call(this,a)},invertChild:function(a,b){var c=this,e=b.style,f="IMG"===a.tagName&&a.style;p(a,{flip:"x",left:d(e.width)-(f?d(f.top):1),top:d(e.height)-(f?d(f.left):1),rotation:-90}),rc(a.childNodes,function(b){c.invertChild(b,a)})},symbols:{arc:function(a,b,c,d,e){var f,g=e.start,h=e.end,i=e.r||c||d,j=e.innerR,k=ub(g),l=vb(g),m=ub(h),n=vb(h);return 0===h-g?["x"]:(f=["wa",a-i,b-i,a+i,b+i,a+i*k,b+i*l,a+i*m,b+i*n],e.open&&!j&&f.push("e",Xb,a,b),f.push("at",a-j,b-j,a+j,b+j,a+j*m,b+j*n,a+j*k,b+j*l,"x","e"),f.isArc=!0,f)},circle:function(a,b,c,d,e){return e&&(c=d=2*e.r),e&&e.isCircle&&(a-=c/2,b-=d/2),["wa",a,b,a+c,b+d,a+c,b+d/2,a+c,b+d/2,"e"]},rect:function(a,b,c,d,e){var f,g,h=a+c,i=b+d;return l(e)&&e.r?(g=sb(e.r,c,d),f=[Xb,a+g,b,Yb,h-g,b,"wa",h-2*g,b,h,b+2*g,h-g,b,h,b+g,Yb,h,i-g,"wa",h-2*g,i-2*g,h,i,h,i-g,h-g,i,Yb,a+g,i,"wa",a,i-2*g,a+2*g,i,a+g,i,a,i-g,Yb,a,b+g,"wa",a,b,a+2*g,b+2*g,a,b+g,a+g,b,"x","e"]):f=Ic.prototype.symbols.square.apply(0,arguments),f}}};lc.VMLRenderer=Jc=function(){this.init.apply(this,arguments)},Jc.prototype=b(Ic.prototype,Lc),R=Jc}Ic.prototype.measureSpanWidth=function(a,b){var c,d=lb.createElement("span"),e=lb.createTextNode(a);return d.appendChild(e),p(d,b),this.box.appendChild(d),c=d.offsetWidth,E(d),c};var Mc,Nc;Ib&&(lc.CanVGRenderer=Mc=function(){Fb="http://www.w3.org/1999/xhtml"},Mc.prototype.symbols={},Nc=function(){function a(){var a,c=b.length;for(a=0;c>a;a++)b[a]();b=[]}var b=[];return{push:function(c,d){0===b.length&&pc(d,a),b.push(c)}}}(),R=Mc),M.prototype={addLabel:function(){var b,c,d,e,f=this,g=f.axis,i=g.options,k=g.chart,m=g.horiz,n=g.categories,p=g.names,q=f.pos,r=i.labels,s=g.tickPositions,t=m&&n&&!r.step&&!r.staggerLines&&!r.rotation&&k.plotWidth/s.length||!m&&(k.margin[3]||.33*k.chartWidth),u=q===s[0],v=q===s[s.length-1],w=n?o(n[q],p[q],q):q,x=f.label,y=s.info;g.isDatetimeAxis&&y&&(e=i.dateTimeLabelFormats[y.higherRanks[q]||y.unitName]),f.isFirst=u,f.isLast=v,b=g.labelFormatter.call({axis:g,chart:k,isFirst:u,isLast:v,dateTimeLabelFormat:e,value:g.isLog?G(j(w)):w}),c=t&&{width:rb(1,ob(t-2*(r.padding||10)))+Vb},c=a(c,r.style),l(x)?x&&x.attr({text:b}).css(c):(d={align:g.labelAlign},h(r.rotation)&&(d.rotation=r.rotation),t&&r.ellipsis&&(d._clipHeight=g.len/s.length),f.label=l(b)&&r.enabled?k.renderer.text(b,0,0,r.useHTML).attr(d).css(c).add(g.labelGroup):null)},getLabelSize:function(){var a=this.label,b=this.axis;return a?a.getBBox()[b.horiz?"height":"width"]:0},getLabelSides:function(){var a=this.label.getBBox(),b=this.axis,c=b.horiz,d=b.options,e=d.labels,f=c?a.width:a.height,g=c?e.x-f*{left:0,center:.5,right:1}[b.labelAlign]:0,h=c?f+g:f;return[g,h]},handleOverflow:function(a,b){var c,d,e,f,g,h=!0,i=this.axis,j=this.isFirst,k=this.isLast,l=i.horiz,m=l?b.x:b.y,n=i.reversed,o=i.tickPositions,p=this.getLabelSides(),q=p[0],r=p[1],s=this.label.line||0,t=i.labelEdge,u=i.justifyLabels&&(j||k);if(t[s]===Q||m+q>t[s]?t[s]=m+r:u||(h=!1),u){g=i.justifyToPlot,c=g?i.pos:0,d=g?c+i.len:i.chart.chartWidth;do a+=j?1:-1,e=i.ticks[o[a]];while(o[a]&&(!e||e.label.line!==s));f=e&&e.label.xy&&e.label.xy.x+e.getLabelSides()[j?0:1],j&&!n||k&&n?c>m+q&&(m=c-q,e&&m+r>f&&(h=!1)):m+r>d&&(m=d-r,e&&f>m+q&&(h=!1)),b.x=m}return h},getPosition:function(a,b,c,d){var e=this.axis,f=e.chart,g=d&&f.oldChartHeight||f.chartHeight;return{x:a?e.translate(b+c,null,null,d)+e.transB:e.left+e.offset+(e.opposite?(d&&f.oldChartWidth||f.chartWidth)-e.right-e.left:0),y:a?g-e.bottom+e.offset-(e.opposite?e.height:0):g-e.translate(b+c,null,null,d)-e.transB}},getLabelPosition:function(a,b,c,d,e,f,g,h){var i=this.axis,j=i.transA,k=i.reversed,m=i.staggerLines,n=i.chart.renderer.fontMetrics(e.style.fontSize).b,o=e.rotation;return a=a+e.x-(f&&d?f*j*(k?-1:1):0),b=b+e.y-(f&&!d?f*j*(k?1:-1):0),o&&2===i.side&&(b-=n-n*ub(o*xb)),l(e.y)||o||(b+=n-c.getBBox().height/2),m&&(c.line=g/(h||1)%m,b+=c.line*(i.labelOffset/m)),{x:a,y:b}},getMarkPath:function(a,b,c,d,e,f){return f.crispLine([Xb,a,b,Yb,a+(e?0:-c),b+(e?c:0)],d)},render:function(a,b,c){var d,e,f,g=this,h=g.axis,i=h.options,j=h.chart,k=j.renderer,l=h.horiz,m=g.type,n=g.label,p=g.pos,q=i.labels,r=g.gridLine,s=m?m+"Grid":"grid",t=m?m+"Tick":"tick",u=i[s+"LineWidth"],v=i[s+"LineColor"],w=i[s+"LineDashStyle"],x=i[t+"Length"],y=i[t+"Width"]||0,z=i[t+"Color"],A=i[t+"Position"],B=g.mark,C=q.step,D=!0,E=h.tickmarkOffset,F=g.getPosition(l,p,E,b),G=F.x,H=F.y,I=l&&G===h.pos+h.len||!l&&H===h.pos?-1:1;this.isActive=!0,u&&(d=h.getPlotLinePath(p+E,u*I,b,!0),r===Q&&(f={stroke:v,"stroke-width":u},w&&(f.dashstyle=w),m||(f.zIndex=1),b&&(f.opacity=0),g.gridLine=r=u?k.path(d).attr(f).add(h.gridGroup):null),!b&&r&&d&&r[g.isNew?"attr":"animate"]({d:d,opacity:c})),y&&x&&("inside"===A&&(x=-x),h.opposite&&(x=-x),e=g.getMarkPath(G,H,x,y*I,l,k),B?B.animate({d:e,opacity:c}):g.mark=k.path(e).attr({stroke:z,"stroke-width":y,opacity:c}).add(h.axisGroup)),n&&!isNaN(G)&&(n.xy=F=g.getLabelPosition(G,H,n,l,q,E,a,C),g.isFirst&&!g.isLast&&!o(i.showFirstLabel,1)||g.isLast&&!g.isFirst&&!o(i.showLastLabel,1)?D=!1:h.isRadial||q.step||q.rotation||b||0===c||(D=g.handleOverflow(a,F)),C&&a%C&&(D=!1),D&&!isNaN(F.y)?(F.opacity=c,n[g.isNew?"attr":"animate"](F),g.isNew=!1):n.attr("y",-9999))},destroy:function(){D(this,this.axis)}},lc.PlotLineOrBand=function(a,b){this.axis=a,b&&(this.options=b,this.id=b.id)},lc.PlotLineOrBand.prototype={render:function(){var a,c,d,e,f,g,h,j=this,k=j.axis,m=k.horiz,n=(k.pointRange||0)/2,p=j.options,q=p.label,r=j.label,s=p.width,t=p.to,u=p.from,v=l(u)&&l(t),w=p.value,x=p.dashStyle,y=j.svgElem,z=[],A=p.color,D=p.zIndex,E=p.events,F=k.chart.renderer;if(k.isLog&&(u=i(u),t=i(t),w=i(w)),s)z=k.getPlotLinePath(w,s),h={stroke:A,"stroke-width":s},x&&(h.dashstyle=x);else{if(!v)return;u=rb(u,k.min-n),t=sb(t,k.max+n),z=k.getPlotBandPath(u,t,p),h={fill:A},p.borderWidth&&(h.stroke=p.borderColor,h["stroke-width"]=p.borderWidth)}if(l(D)&&(h.zIndex=D),y)z?y.animate({d:z},null,y.onGetPath):(y.hide(),y.onGetPath=function(){y.show()},r&&(j.label=r=r.destroy()));else if(z&&z.length&&(j.svgElem=y=F.path(z).attr(h).add(),E)){a=function(a){y.on(a,function(b){E[a].apply(j,[b])})};for(c in E)a(c)}return q&&l(q.text)&&z&&z.length&&k.width>0&&k.height>0?(q=b({align:m&&v&&"center",x:m?!v&&4:10,verticalAlign:!m&&v&&"middle",y:m?v?16:10:v?6:-4,rotation:m&&!v&&90},q),r||(j.label=r=F.text(q.text,0,0,q.useHTML).attr({align:q.textAlign||q.align,rotation:q.rotation,zIndex:D}).css(q.style).add()),d=[z[1],z[4],o(z[6],z[1])],e=[z[2],z[5],o(z[7],z[2])],f=B(d),g=B(e),r.align(q,!1,{x:f,y:g,width:C(d)-f,height:C(e)-g}),r.show()):r&&r.hide(),j},destroy:function(){k(this.axis.plotLinesAndBands,this),delete this.axis,D(this)}},Z={getPlotBandPath:function(a,b){var c=this.getPlotLinePath(b),d=this.getPlotLinePath(a);return d&&c?d.push(c[4],c[5],c[1],c[2]):d=null,d},addPlotBand:function(a){this.addPlotBandOrLine(a,"plotBands")},addPlotLine:function(a){this.addPlotBandOrLine(a,"plotLines")},addPlotBandOrLine:function(a,b){var c=new lc.PlotLineOrBand(this,a).render(),d=this.userOptions;return c&&(b&&(d[b]=d[b]||[],d[b].push(a)),this.plotLinesAndBands.push(c)),c},removePlotBandOrLine:function(a){for(var b=this.plotLinesAndBands,c=this.options,d=this.userOptions,e=b.length;e--;)b[e].id===a&&b[e].destroy();rc([c.plotLines||[],d.plotLines||[],c.plotBands||[],d.plotBands||[]],function(b){for(e=b.length;e--;)b[e].id===a&&k(b,b[e])})}},N.prototype={defaultOptions:{dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e. %b",week:"%e. %b",month:"%b '%y",year:"%Y"},endOnTick:!1,gridLineColor:"#C0C0C0",labels:Bc,lineColor:"#C0D0E0",lineWidth:1,minPadding:.01,maxPadding:.01,minorGridLineColor:"#E0E0E0",minorGridLineWidth:1,minorTickColor:"#A0A0A0",minorTickLength:2,minorTickPosition:"outside",startOfWeek:1,startOnTick:!1,tickColor:"#C0D0E0",tickLength:5,tickmarkPlacement:"between",tickPixelInterval:100,tickPosition:"outside",tickWidth:1,title:{align:"middle",style:{color:"#4d759e",fontWeight:"bold"}},type:"linear"},defaultYAxisOptions:{endOnTick:!0,gridLineWidth:1,tickPixelInterval:72,showLastLabel:!0,labels:{x:-8,y:3},lineWidth:0,maxPadding:.05,minPadding:.05,startOnTick:!0,tickWidth:0,title:{rotation:270,text:"Values"},stackLabels:{enabled:!1,formatter:function(){return s(this.total,-1)},style:Bc.style}},defaultLeftAxisOptions:{labels:{x:-8,y:null},title:{rotation:270}},defaultRightAxisOptions:{labels:{x:8,y:null},title:{rotation:90}},defaultBottomAxisOptions:{labels:{x:0,y:14},title:{rotation:0}},defaultTopAxisOptions:{labels:{x:0,y:-5},title:{rotation:0}},init:function(a,b){var c=b.isX,d=this;d.horiz=a.inverted?!c:c,d.isXAxis=c,d.coll=c?"xAxis":"yAxis",d.opposite=b.opposite,d.side=b.side||(d.horiz?d.opposite?0:2:d.opposite?1:3),d.setOptions(b);var e=this.options,f=e.type,g="datetime"===f;d.labelFormatter=e.labels.formatter||d.defaultLabelFormatter,d.userOptions=b,d.minPixelPadding=0,d.chart=a,d.reversed=e.reversed,d.zoomEnabled=e.zoomEnabled!==!1,d.categories=e.categories||"category"===f,d.names=[],d.isLog="logarithmic"===f,d.isDatetimeAxis=g,d.isLinked=l(e.linkedTo),d.tickmarkOffset=d.categories&&"between"===e.tickmarkPlacement?.5:0,d.ticks={},d.labelEdge=[],d.minorTicks={},d.plotLinesAndBands=[],d.alternateBands={},d.len=0,d.minRange=d.userMinRange=e.minRange||e.maxZoom,d.range=e.range,d.offset=e.offset||0,d.stacks={},d.oldStacks={},d.max=null,d.min=null,d.crosshair=o(e.crosshair,n(a.options.tooltip.crosshairs)[c?0:1],!1);var h,k=d.options.events;-1===qc(d,a.axes)&&(c&&!this.isColorAxis?a.axes.splice(a.xAxis.length,0,d):a.axes.push(d),a[d.coll].push(d)),d.series=d.series||[],a.inverted&&c&&d.reversed===Q&&(d.reversed=!0),d.removePlotBand=d.removePlotBandOrLine,d.removePlotLine=d.removePlotBandOrLine;for(h in k)vc(d,h,k[h]);d.isLog&&(d.val2lin=i,d.lin2val=j)},setOptions:function(a){this.options=b(this.defaultOptions,this.isXAxis?{}:this.defaultYAxisOptions,[this.defaultTopAxisOptions,this.defaultRightAxisOptions,this.defaultBottomAxisOptions,this.defaultLeftAxisOptions][this.side],b(U[this.coll],a))},defaultLabelFormatter:function(){var a,b,c=this.axis,d=this.value,e=c.categories,f=this.dateTimeLabelFormat,g=U.lang.numericSymbols,h=g&&g.length,i=c.options.labels.format,j=c.isLog?d:c.tickInterval;if(i)b=w(i,this);else if(e)b=d;else if(f)b=V(f,d);else if(h&&j>=1e3)for(;h--&&b===Q;)a=Math.pow(1e3,h+1),j>=a&&null!==g[h]&&(b=s(d/a,-1)+g[h]);return b===Q&&(b=d>=1e4?s(d,0):s(d,-1,Q,"")),b},getSeriesExtremes:function(){var a=this,b=a.chart;a.hasVisibleSeries=!1,a.dataMin=a.dataMax=null,a.buildStacks&&a.buildStacks(),rc(a.series,function(c){if(c.visible||!b.options.chart.ignoreHiddenSeries){var d,e,f,g=c.options,h=g.threshold;a.hasVisibleSeries=!0,a.isLog&&0>=h&&(h=null),a.isXAxis?(d=c.xData,d.length&&(a.dataMin=sb(o(a.dataMin,d[0]),B(d)),a.dataMax=rb(o(a.dataMax,d[0]),C(d)))):(c.getExtremes(),f=c.dataMax,e=c.dataMin,l(e)&&l(f)&&(a.dataMin=sb(o(a.dataMin,e),e),a.dataMax=rb(o(a.dataMax,f),f)),l(h)&&(a.dataMin>=h?(a.dataMin=h,a.ignoreMinPadding=!0):h>a.dataMax&&(a.dataMax=h,a.ignoreMaxPadding=!0)))}})},translate:function(a,b,c,d,e,f){var g,i=this,j=1,k=0,l=d?i.oldTransA:i.transA,m=d?i.oldMin:i.min,n=i.minPixelPadding,o=(i.options.ordinal||i.isLog&&e)&&i.lin2val;return l||(l=i.transA),c&&(j*=-1,k=i.len),i.reversed&&(j*=-1,k-=j*(i.sector||i.len)),b?(a=a*j+k,a-=n,g=a/l+m,o&&(g=i.lin2val(g))):(o&&(a=i.val2lin(a)),"between"===f&&(f=.5),g=j*(a-m)*l+k+j*n+(h(f)?l*f*i.pointRange:0)),g},toPixels:function(a,b){return this.translate(a,!1,!this.horiz,null,!0)+(b?0:this.pos)},toValue:function(a,b){return this.translate(a-(b?0:this.pos),!0,!this.horiz,null,!0)},getPlotLinePath:function(a,b,c,d,e){var f,g,h,i,j,k=this,l=k.chart,m=k.left,n=k.top,p=c&&l.oldChartHeight||l.chartHeight,q=c&&l.oldChartWidth||l.chartWidth,r=k.transB;return e=o(e,k.translate(a,null,null,c)),f=h=ob(e+r),g=i=ob(p-e-r),isNaN(e)?j=!0:k.horiz?(g=n,i=p-k.bottom,(m>f||f>m+k.width)&&(j=!0)):(f=m,h=q-k.right,(n>g||g>n+k.height)&&(j=!0)),j&&!d?null:l.renderer.crispLine([Xb,f,g,Yb,h,i],b||1)},getLinearTickPositions:function(a,b,c){var d,e,f=G(pb(b/a)*a),g=G(qb(c/a)*a),h=[];for(d=f;g>=d&&(h.push(d),d=G(d+a),d!==e);)e=d;return h},getMinorTickPositions:function(){var a,b,c,d=this,e=d.options,f=d.tickPositions,g=d.minorTickInterval,h=[];if(d.isLog)for(c=f.length,b=1;c>b;b++)h=h.concat(d.getLogTickPositions(g,f[b-1],f[b],!0));else if(d.isDatetimeAxis&&"auto"===e.minorTickInterval)h=h.concat(d.getTimeTicks(d.normalizeTimeTickInterval(g),d.min,d.max,e.startOfWeek)),h[0]<d.min&&h.shift();else for(a=d.min+(f[0]-d.min)%g;d.max>=a;a+=g)h.push(a);return h},adjustForMinRange:function(){var a,b,c,d,e,f,g,h,i=this,j=i.options,k=i.min,m=i.max,n=i.dataMax-i.dataMin>=i.minRange;if(i.isXAxis&&i.minRange===Q&&!i.isLog&&(l(j.min)||l(j.max)?i.minRange=null:(rc(i.series,function(a){for(e=a.xData,f=a.xIncrement?1:e.length-1,c=f;c>0;c--)d=e[c]-e[c-1],(b===Q||b>d)&&(b=d)}),i.minRange=sb(5*b,i.dataMax-i.dataMin))),i.minRange>m-k){var p=i.minRange;a=(p-m+k)/2,g=[k-a,o(j.min,k-a)],n&&(g[2]=i.dataMin),k=C(g),h=[k+p,o(j.max,k+p)],n&&(h[2]=i.dataMax),m=B(h),p>m-k&&(g[0]=m-p,g[1]=o(j.min,m-p),k=C(g))}i.min=k,i.max=m},setAxisTranslation:function(a){var b,c,d=this,f=d.max-d.min,g=d.axisPointRange||0,h=0,i=0,j=d.linkedParent,k=!!d.categories,m=d.transA;(d.isXAxis||k||g)&&(j?(h=j.minPointOffset,i=j.pointRangePadding):rc(d.series,function(a){var c=rb(d.isXAxis?a.pointRange:d.axisPointRange||0,+k),j=a.options.pointPlacement,m=a.closestPointRange;c>f&&(c=0),g=rb(g,c),h=rb(h,e(j)?0:c/2),i=rb(i,"on"===j?0:c),!a.noSharedTooltip&&l(m)&&(b=l(b)?sb(b,m):m)}),c=d.ordinalSlope&&b?d.ordinalSlope/b:1,d.minPointOffset=h*=c,d.pointRangePadding=i*=c,d.pointRange=sb(g,f),d.closestPointRange=b),a&&(d.oldTransA=m),d.translationSlope=d.transA=m=d.len/(f+i||1),d.transB=d.horiz?d.left:d.bottom,d.minPixelPadding=m*h},setTickPositions:function(a){var b,c,d,e,f=this,g=f.chart,h=f.options,j=f.isLog,k=f.isDatetimeAxis,m=f.isXAxis,n=f.isLinked,p=f.options.tickPositioner,q=h.maxPadding,r=h.minPadding,s=h.tickInterval,t=h.minTickInterval,u=h.tickPixelInterval,v=f.categories;if(n?(f.linkedParent=g[f.coll][h.linkedTo],c=f.linkedParent.getExtremes(),f.min=o(c.min,c.dataMin),f.max=o(c.max,c.dataMax),h.type!==f.linkedParent.options.type&&F(11,1)):(f.min=o(f.userMin,h.min,f.dataMin),f.max=o(f.userMax,h.max,f.dataMax)),j&&(!a&&0>=sb(f.min,o(f.dataMin,f.min))&&F(10,1),f.min=G(i(f.min)),f.max=G(i(f.max))),f.range&&l(f.max)&&(f.userMin=f.min=rb(f.min,f.max-f.range),f.userMax=f.max,f.range=null),f.beforePadding&&f.beforePadding(),f.adjustForMinRange(),v||f.axisPointRange||f.usePercentage||n||!l(f.min)||!l(f.max)||(b=f.max-f.min,b&&(l(h.min)||l(f.userMin)||!r||!(0>f.dataMin)&&f.ignoreMinPadding||(f.min-=b*r),l(h.max)||l(f.userMax)||!q||!(f.dataMax>0)&&f.ignoreMaxPadding||(f.max+=b*q))),f.min===f.max||void 0===f.min||void 0===f.max?f.tickInterval=1:n&&!s&&u===f.linkedParent.options.tickPixelInterval?f.tickInterval=f.linkedParent.tickInterval:(f.tickInterval=o(s,v?1:(f.max-f.min)*u/rb(f.len,u)),!l(s)&&u>f.len&&!this.isRadial&&!this.isLog&&!v&&h.startOnTick&&h.endOnTick&&(e=!0,f.tickInterval/=4)),m&&!a&&rc(f.series,function(a){a.processData(f.min!==f.oldMin||f.max!==f.oldMax)}),f.setAxisTranslation(!0),f.beforeSetTickPositions&&f.beforeSetTickPositions(),f.postProcessTickInterval&&(f.tickInterval=f.postProcessTickInterval(f.tickInterval)),f.pointRange&&(f.tickInterval=rb(f.pointRange,f.tickInterval)),!s&&t>f.tickInterval&&(f.tickInterval=t),k||j||s||(f.tickInterval=y(f.tickInterval,null,x(f.tickInterval),h)),f.minorTickInterval="auto"===h.minorTickInterval&&f.tickInterval?f.tickInterval/5:h.minorTickInterval,f.tickPositions=d=h.tickPositions?[].concat(h.tickPositions):p&&p.apply(f,[f.min,f.max]),d||(!f.ordinalPositions&&(f.max-f.min)/f.tickInterval>rb(2*f.len,200)&&F(19,!0),d=k?f.getTimeTicks(f.normalizeTimeTickInterval(f.tickInterval,h.units),f.min,f.max,h.startOfWeek,f.ordinalPositions,f.closestPointRange,!0):j?f.getLogTickPositions(f.tickInterval,f.min,f.max):f.getLinearTickPositions(f.tickInterval,f.min,f.max),e&&d.splice(1,d.length-2),f.tickPositions=d),!n){var w,z=d[0],A=d[d.length-1],B=f.minPointOffset||0;h.startOnTick?f.min=z:f.min-B>z&&d.shift(),h.endOnTick?f.max=A:A>f.max+B&&d.pop(),1===d.length&&(w=.001*tb(f.max||1),f.min-=w,f.max+=w)}},setMaxTicks:function(){var a=this.chart,b=a.maxTicks||{},c=this.tickPositions,d=this._maxTicksKey=[this.coll,this.pos,this.len].join("-");!this.isLinked&&!this.isDatetimeAxis&&c&&c.length>(b[d]||0)&&this.options.alignTicks!==!1&&(b[d]=c.length),a.maxTicks=b},adjustTickAmount:function(){var a=this,b=a.chart,c=a._maxTicksKey,d=a.tickPositions,e=b.maxTicks;if(e&&e[c]&&!a.isDatetimeAxis&&!a.categories&&!a.isLinked&&a.options.alignTicks!==!1&&this.min!==Q){var f,g=a.tickAmount,h=d.length;if(a.tickAmount=f=e[c],f>h){for(;f>d.length;)d.push(G(d[d.length-1]+a.tickInterval));a.transA*=(h-1)/(f-1),a.max=d[d.length-1]}l(g)&&f!==g&&(a.isDirty=!0)}},setScale:function(){var a,b,c,d,e=this,f=e.stacks;if(e.oldMin=e.min,e.oldMax=e.max,e.oldAxisLength=e.len,e.setAxisSize(),d=e.len!==e.oldAxisLength,rc(e.series,function(a){(a.isDirtyData||a.isDirty||a.xAxis.isDirty)&&(c=!0)}),d||c||e.isLinked||e.forceRedraw||e.userMin!==e.oldUserMin||e.userMax!==e.oldUserMax){if(!e.isXAxis)for(a in f)for(b in f[a])f[a][b].total=null,f[a][b].cum=0;e.forceRedraw=!1,e.getSeriesExtremes(),e.setTickPositions(),e.oldUserMin=e.userMin,e.oldUserMax=e.userMax,e.isDirty||(e.isDirty=d||e.min!==e.oldMin||e.max!==e.oldMax)}else if(!e.isXAxis){e.oldStacks&&(f=e.stacks=e.oldStacks);for(a in f)for(b in f[a])f[a][b].cum=f[a][b].total}e.setMaxTicks()},setExtremes:function(b,c,d,e,f){var g=this,h=g.chart;d=o(d,!0),f=a(f,{min:b,max:c}),xc(g,"setExtremes",f,function(){g.userMin=b,g.userMax=c,g.eventArgs=f,g.isDirtyExtremes=!0,d&&h.redraw(e)})},zoom:function(a,b){var c=this.dataMin,d=this.dataMax,e=this.options;return this.allowZoomOutside||(l(c)&&sb(c,o(e.min,c))>=a&&(a=Q),l(d)&&b>=rb(d,o(e.max,d))&&(b=Q)),this.displayBtn=a!==Q||b!==Q,this.setExtremes(a,b,!1,Q,{trigger:"zoom"}),!0},setAxisSize:function(){var a,b,c,d,e=this.chart,f=this.options,g=f.offsetLeft||0,h=f.offsetRight||0,i=this.horiz;this.left=d=o(f.left,e.plotLeft+g),this.top=c=o(f.top,e.plotTop),this.width=a=o(f.width,e.plotWidth-g+h),this.height=b=o(f.height,e.plotHeight),this.bottom=e.chartHeight-b-c,this.right=e.chartWidth-a-d,this.len=rb(i?a:b,0),this.pos=i?d:c},getExtremes:function(){var a=this,b=a.isLog;return{min:b?G(j(a.min)):a.min,max:b?G(j(a.max)):a.max,dataMin:a.dataMin,dataMax:a.dataMax,userMin:a.userMin,userMax:a.userMax}},getThreshold:function(a){var b=this,c=b.isLog,d=c?j(b.min):b.min,e=c?j(b.max):b.max;return d>a||null===a?a=d:a>e&&(a=e),b.translate(a,0,1,0,1)},autoLabelAlign:function(a){var b,c=(o(a,0)-90*this.side+720)%360;return b=c>15&&165>c?"right":c>195&&345>c?"left":"center"},getOffset:function(){var a,b,c,d,e,f,g,h,i,j,k,m,n,p=this,q=p.chart,r=q.renderer,s=p.options,t=p.tickPositions,u=p.ticks,v=p.horiz,w=p.side,x=q.inverted?[1,0,3,2][w]:w,y=0,z=0,A=s.title,B=s.labels,C=0,D=q.axisOffset,E=q.clipOffset,F=[-1,1,1,-1][w],G=1,H=o(B.maxStaggerLines,5);if(p.hasData=a=p.hasVisibleSeries||l(p.min)&&l(p.max)&&!!t,p.showAxis=b=a||o(s.showEmpty,!0),p.staggerLines=p.horiz&&B.staggerLines,p.axisGroup||(p.gridGroup=r.g("grid").attr({zIndex:s.gridZIndex||1}).add(),p.axisGroup=r.g("axis").attr({zIndex:s.zIndex||2}).add(),p.labelGroup=r.g("axis-labels").attr({zIndex:B.zIndex||7}).addClass(Tb+p.coll.toLowerCase()+"-labels").add()),a||p.isLinked){if(p.labelAlign=o(B.align||p.autoLabelAlign(B.rotation)),rc(t,function(a){u[a]?u[a].addLabel():u[a]=new M(p,a)}),p.horiz&&!p.staggerLines&&H&&!B.rotation){for(f=p.reversed?[].concat(t).reverse():t;H>G;){for(g=[],h=!1,e=0;f.length>e;e++)i=f[e],j=u[i].label&&u[i].label.getBBox(),m=j?j.width:0,n=e%G,m&&(k=p.translate(i),g[n]!==Q&&g[n]>k&&(h=!0),g[n]=k+m);if(!h)break;G++}G>1&&(p.staggerLines=G)}rc(t,function(a){(0===w||2===w||{1:"left",3:"right"}[w]===p.labelAlign)&&(C=rb(u[a].getLabelSize(),C))}),p.staggerLines&&(C*=p.staggerLines,p.labelOffset=C)}else for(d in u)u[d].destroy(),delete u[d];A&&A.text&&A.enabled!==!1&&(p.axisTitle||(p.axisTitle=r.text(A.text,0,0,A.useHTML).attr({zIndex:7,rotation:A.rotation||0,align:A.textAlign||{low:"left",middle:"center",high:"right"}[A.align]}).addClass(Tb+this.coll.toLowerCase()+"-title").css(A.style).add(p.axisGroup),p.axisTitle.isNew=!0),b&&(y=p.axisTitle.getBBox()[v?"height":"width"],z=o(A.margin,v?5:10),c=A.offset),p.axisTitle[b?"show":"hide"]()),p.offset=F*o(s.offset,D[w]),p.axisTitleMargin=o(c,C+z+(2!==w&&C&&F*s.labels[v?"y":"x"])),D[w]=rb(D[w],p.axisTitleMargin+y+F*p.offset),E[x]=rb(E[x],2*pb(s.lineWidth/2))},getLinePath:function(a){var b=this.chart,c=this.opposite,d=this.offset,e=this.horiz,f=this.left+(c?this.width:0)+d,g=b.chartHeight-this.bottom-(c?this.height:0)+d;return c&&(a*=-1),b.renderer.crispLine([Xb,e?this.left:f,e?g:this.top,Yb,e?b.chartWidth-this.right:f,e?g:b.chartHeight-this.bottom],a)},getTitlePosition:function(){var a=this.horiz,b=this.left,c=this.top,e=this.len,f=this.options.title,g=a?b:c,h=this.opposite,i=this.offset,j=d(f.style.fontSize||12),k={low:g+(a?0:e),middle:g+e/2,high:g+(a?e:0)}[f.align],l=(a?c+this.height:b)+(a?1:-1)*(h?-1:1)*this.axisTitleMargin+(2===this.side?j:0);return{x:a?k:l+(h?this.width:0)+i+(f.x||0),y:a?l-(h?this.height:0)+i:k+(f.y||0)}},render:function(){var a,b,c,d,e=this,f=e.horiz,g=e.reversed,h=e.chart,i=h.renderer,k=e.options,m=e.isLog,n=e.isLinked,o=e.tickPositions,p=e.axisTitle,q=e.ticks,r=e.minorTicks,s=e.alternateBands,t=k.stackLabels,u=k.alternateGridColor,v=e.tickmarkOffset,w=k.lineWidth,x=h.hasRendered,y=x&&l(e.oldMin)&&!isNaN(e.oldMin),z=e.hasData,A=e.showAxis,B=k.labels.overflow,C=e.justifyLabels=f&&B!==!1;e.labelEdge.length=0,e.justifyToPlot="justify"===B,rc([q,r,s],function(a){var b;for(b in a)a[b].isActive=!1}),(z||n)&&(e.minorTickInterval&&!e.categories&&rc(e.getMinorTickPositions(),function(a){r[a]||(r[a]=new M(e,a,"minor")),y&&r[a].isNew&&r[a].render(null,!0),r[a].render(null,!1,1)}),o.length&&(a=o.slice(),(f&&g||!f&&!g)&&a.reverse(),C&&(a=a.slice(1).concat([a[0]])),rc(a,function(b,c){C&&(c=c===a.length-1?0:c+1),(!n||b>=e.min&&e.max>=b)&&(q[b]||(q[b]=new M(e,b)),y&&q[b].isNew&&q[b].render(c,!0,.1),q[b].render(c,!1,1))}),v&&0===e.min&&(q[-1]||(q[-1]=new M(e,-1,null,!0)),q[-1].render(-1))),u&&rc(o,function(a,b){0===b%2&&e.max>a&&(s[a]||(s[a]=new lc.PlotLineOrBand(e)),c=a+v,d=o[b+1]!==Q?o[b+1]+v:e.max,s[a].options={from:m?j(c):c,to:m?j(d):d,color:u},s[a].render(),s[a].isActive=!0)
}),e._addedPlotLB||(rc((k.plotLines||[]).concat(k.plotBands||[]),function(a){e.addPlotBandOrLine(a)}),e._addedPlotLB=!0)),rc([q,r,s],function(a){var b,c,d=[],e=W?W.duration||500:0,f=function(){for(c=d.length;c--;)a[d[c]]&&!a[d[c]].isActive&&(a[d[c]].destroy(),delete a[d[c]])};for(b in a)a[b].isActive||(a[b].render(b,!1,0),a[b].isActive=!1,d.push(b));a!==s&&h.hasRendered&&e?e&&setTimeout(f,e):f()}),w&&(b=e.getLinePath(w),e.axisLine?e.axisLine.animate({d:b}):e.axisLine=i.path(b).attr({stroke:k.lineColor,"stroke-width":w,zIndex:7}).add(e.axisGroup),e.axisLine[A?"show":"hide"]()),p&&A&&(p[p.isNew?"attr":"animate"](e.getTitlePosition()),p.isNew=!1),t&&t.enabled&&e.renderStackTotals(),e.isDirty=!1},redraw:function(){var a=this,b=a.chart,c=b.pointer;c&&c.reset(!0),a.render(),rc(a.plotLinesAndBands,function(a){a.render()}),rc(a.series,function(a){a.isDirty=!0})},destroy:function(a){var b,c,d=this,e=d.stacks,f=d.plotLinesAndBands;a||wc(d);for(b in e)D(e[b]),e[b]=null;for(rc([d.ticks,d.minorTicks,d.alternateBands],function(a){D(a)}),c=f.length;c--;)f[c].destroy();rc(["stackTotalGroup","axisLine","axisTitle","axisGroup","cross","gridGroup","labelGroup"],function(a){d[a]&&(d[a]=d[a].destroy())}),this.cross&&this.cross.destroy()},drawCrosshair:function(a,b){if(this.crosshair){if((l(b)||!o(this.crosshair.snap,!0))===!1)return this.hideCrosshair(),void 0;var c,d,e=this.crosshair,f=e.animation;if(o(e.snap,!0)?l(b)&&(d=this.chart.inverted!=this.horiz?b.plotX:this.len-b.plotY):d=this.horiz?a.chartX-this.pos:this.len-a.chartY+this.pos,c=this.isRadial?this.getPlotLinePath(this.isXAxis?b.x:o(b.stackY,b.y)):this.getPlotLinePath(null,null,null,null,d),null===c)return this.hideCrosshair(),void 0;if(this.cross)this.cross.attr({visibility:Ub})[f?"animate":"attr"]({d:c},f);else{var g={"stroke-width":e.width||1,stroke:e.color||"#C0C0C0",zIndex:e.zIndex||2};e.dashStyle&&(g.dashstyle=e.dashStyle),this.cross=this.chart.renderer.path(c).attr(g).add()}}},hideCrosshair:function(){this.cross&&this.cross.hide()}},a(N.prototype,Z),N.prototype.getTimeTicks=function(b,c,d,e){var f,g,h=[],i={},j=U.global.useUTC,k=new Date(c-_),m=b.unitRange,n=b.count;if(l(c)){m>=Y[cc]&&(k.setMilliseconds(0),k.setSeconds(m>=Y[dc]?0:n*pb(k.getSeconds()/n))),m>=Y[dc]&&k[gb](m>=Y[ec]?0:n*pb(k[ab]()/n)),m>=Y[ec]&&k[hb](m>=Y[fc]?0:n*pb(k[bb]()/n)),m>=Y[fc]&&k[ib](m>=Y[hc]?1:n*pb(k[db]()/n)),m>=Y[hc]&&(k[jb](m>=Y[ic]?0:n*pb(k[eb]()/n)),g=k[fb]()),m>=Y[ic]&&(g-=g%n,k[kb](g)),m===Y[gc]&&k[ib](k[db]()-k[cb]()+o(e,1)),f=1,_&&(k=new Date(k.getTime()+_)),g=k[fb]();for(var p=k.getTime(),q=k[eb](),r=k[db](),s=j?_:(864e5+1e3*60*k.getTimezoneOffset())%864e5;d>p;)h.push(p),m===Y[ic]?p=$(g+f*n,0):m===Y[hc]?p=$(g,q+f*n):j||m!==Y[fc]&&m!==Y[gc]?p+=m*n:p=$(g,q,r+f*n*(m===Y[fc]?1:7)),f++;h.push(p),rc(sc(h,function(a){return Y[ec]>=m&&a%Y[fc]===s}),function(a){i[a]=fc})}return h.info=a(b,{higherRanks:i,totalRange:m*n}),h},N.prototype.normalizeTimeTickInterval=function(a,b){var c,d,e=b||[[bc,[1,2,5,10,20,25,50,100,200,500]],[cc,[1,2,5,10,15,30]],[dc,[1,2,5,10,15,30]],[ec,[1,2,3,4,6,8,12]],[fc,[1,2]],[gc,[1,2]],[hc,[1,2,3,4,6]],[ic,null]],f=e[e.length-1],g=Y[f[0]],h=f[1];for(d=0;e.length>d;d++)if(f=e[d],g=Y[f[0]],h=f[1],e[d+1]){var i=(g*h[h.length-1]+Y[e[d+1][0]])/2;if(i>=a)break}return g===Y[ic]&&5*g>a&&(h=[1,2,5]),c=y(a/g,h,f[0]===ic?rb(x(a/g),1):1),{unitRange:g,count:c,unitName:f[0]}},N.prototype.getLogTickPositions=function(a,b,c,d){var e=this,f=e.options,g=e.len,h=[];if(d||(e._minorAutoInterval=null),a>=.5)a=ob(a),h=e.getLinearTickPositions(a,b,c);else if(a>=.08){var k,l,m,n,p,q,r,s=pb(b);for(k=a>.3?[1,2,4]:a>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],l=s;c+1>l&&!r;l++)for(n=k.length,m=0;n>m&&!r;m++)p=i(j(l)*k[m]),p>b&&(!d||c>=q)&&h.push(q),q>c&&(r=!0),q=p}else{var t=j(b),u=j(c),v=f[d?"minorTickInterval":"tickInterval"],w="auto"===v?null:v,z=f.tickPixelInterval/(d?5:1),A=d?g/e.tickPositions.length:g;a=o(w,e._minorAutoInterval,(u-t)*z/(A||1)),a=y(a,null,x(a)),h=uc(e.getLinearTickPositions(a,t,u),i),d||(e._minorAutoInterval=a/5)}return d||(e.tickInterval=a),h};var Oc=lc.Tooltip=function(){this.init.apply(this,arguments)};Oc.prototype={init:function(a,b){var c=b.borderWidth,e=b.style,f=d(e.padding);this.chart=a,this.options=b,this.crosshairs=[],this.now={x:0,y:0},this.isHidden=!0,this.label=a.renderer.label("",0,0,b.shape,null,null,b.useHTML,null,"tooltip").attr({padding:f,fill:b.backgroundColor,"stroke-width":c,r:b.borderRadius,zIndex:8}).css(e).css({padding:0}).add().attr({y:-9999}),Ib||this.label.shadow(b.shadow),this.shared=b.shared},destroy:function(){this.label&&(this.label=this.label.destroy()),clearTimeout(this.hideTimer),clearTimeout(this.tooltipTimeout)},move:function(b,c,d,e){var f=this,g=f.now,h=f.options.animation!==!1&&!f.isHidden;a(g,{x:h?(2*g.x+b)/3:b,y:h?(g.y+c)/2:c,anchorX:h?(2*g.anchorX+d)/3:d,anchorY:h?(g.anchorY+e)/2:e}),f.label.attr(g),h&&(tb(b-g.x)>1||tb(c-g.y)>1)&&(clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout(function(){f&&f.move(b,c,d,e)},32))},hide:function(){var a,b=this;clearTimeout(this.hideTimer),this.isHidden||(a=this.chart.hoverPoints,this.hideTimer=setTimeout(function(){b.label.fadeOut(),b.isHidden=!0},o(this.options.hideDelay,500)),a&&rc(a,function(a){a.setState()}),this.chart.hoverPoints=null)},getAnchor:function(a,b){var c,d,e=this.chart,f=e.inverted,g=e.plotTop,h=0,i=0;return a=n(a),c=a[0].tooltipPos,this.followPointer&&b&&(b.chartX===Q&&(b=e.pointer.normalize(b)),c=[b.chartX-e.plotLeft,b.chartY-g]),c||(rc(a,function(a){d=a.series.yAxis,h+=a.plotX,i+=(a.plotLow?(a.plotLow+a.plotHigh)/2:a.plotY)+(!f&&d?d.top-g:0)}),h/=a.length,i/=a.length,c=[f?e.plotWidth-i:h,this.shared&&!f&&a.length>1&&b?b.chartY-g:f?e.plotHeight-h:i]),uc(c,ob)},getPosition:function(a,b,c){var d,e=this.chart,f=e.plotLeft,g=e.plotTop,h=e.plotWidth,i=e.plotHeight,j=o(this.options.distance,12),k=isNaN(c.plotX)?0:c.plotX,l=c.plotY,m=k+f+(e.inverted?j:-a-j),n=l-b+g+15;return 7>m&&(m=f+rb(k,0)+j),m+a>f+h&&(m-=m+a-(f+h),n=l-b+g-j,d=!0),g+5>n&&(n=g+5,d&&l>=n&&n+b>=l&&(n=l+g+j)),n+b>g+i&&(n=rb(g,g+i-b-j)),{x:m,y:n}},defaultFormatter:function(a){var b,c=this.points||n(this),d=c[0].series;return b=[a.tooltipHeaderFormatter(c[0])],rc(c,function(a){d=a.series,b.push(d.tooltipFormatter&&d.tooltipFormatter(a)||a.point.tooltipFormatter(d.tooltipOptions.pointFormat))}),b.push(a.options.footerFormat||""),b.join("")},refresh:function(a,b){var c,d,e,f,g,h,i=this,j=i.chart,k=i.label,l=i.options,m={},o=[],p=l.formatter||i.defaultFormatter,q=j.hoverPoints,r=i.shared;clearTimeout(this.hideTimer),i.followPointer=n(a)[0].series.tooltipOptions.followPointer,e=i.getAnchor(a,b),c=e[0],d=e[1],!r||a.series&&a.series.noSharedTooltip?m=a.getLabelConfig():(j.hoverPoints=a,q&&rc(q,function(a){a.setState()}),rc(a,function(a){a.setState(_b),o.push(a.getLabelConfig())}),m={x:a[0].category,y:a[0].y},m.points=o,a=a[0]),f=p.call(m,i),h=a.series,f===!1?this.hide():(i.isHidden&&(Ac(k),k.attr("opacity",1).show()),k.attr({text:f}),g=l.borderColor||a.color||h.color||"#606060",k.attr({stroke:g}),i.updatePosition({plotX:c,plotY:d}),this.isHidden=!1),xc(j,"tooltipRefresh",{text:f,x:c+j.plotLeft,y:d+j.plotTop,borderColor:g})},updatePosition:function(a){var b=this.chart,c=this.label,d=(this.options.positioner||this.getPosition).call(this,c.width,c.height,a);this.move(ob(d.x),ob(d.y),a.plotX+b.plotLeft,a.plotY+b.plotTop)},tooltipHeaderFormatter:function(a){var b,c=a.series,d=c.tooltipOptions,e=d.dateTimeLabelFormats,f=d.xDateFormat,g=c.xAxis,i=g&&"datetime"===g.options.type&&h(a.key),j=d.headerFormat,k=g&&g.closestPointRange;if(i&&!f){if(k){for(b in Y)if(Y[b]>=k||Y[b]<=Y[fc]&&a.key%Y[b]>0){f=e[b];break}}else f=e.day;f=f||e.year}return i&&f&&(j=j.replace("{point.key}","{point.key:"+f+"}")),w(j,{point:a,series:c})}};var Pc;S=lb.documentElement.ontouchstart!==Q;var Qc=lc.Pointer=function(a,b){this.init(a,b)};if(Qc.prototype={init:function(a,b){var c,d,e=b.chart,f=e.events,g=Ib?"":e.zoomType,h=a.inverted;this.options=b,this.chart=a,this.zoomX=c=/x/.test(g),this.zoomY=d=/y/.test(g),this.zoomHor=c&&!h||d&&h,this.zoomVert=d&&!h||c&&h,this.runChartClick=f&&!!f.click,this.pinchDown=[],this.lastValidTouch={},lc.Tooltip&&b.tooltip.enabled&&(a.tooltip=new Oc(a,b.tooltip)),this.setDOMEvents()},normalize:function(b,c){var d,e,f;return b=b||mb.event,b=yc(b),b.target||(b.target=b.srcElement),f=b.touches?b.touches.item(0):b,c||(this.chartPosition=c=tc(this.chart.container)),f.pageX===Q?(d=rb(b.x,b.clientX-c.left),e=b.y):(d=f.pageX-c.left,e=f.pageY-c.top),a(b,{chartX:ob(d),chartY:ob(e)})},getCoordinates:function(a){var b={xAxis:[],yAxis:[]};return rc(this.chart.axes,function(c){b[c.isXAxis?"xAxis":"yAxis"].push({axis:c,value:c.toValue(a[c.horiz?"chartX":"chartY"])})}),b},getIndex:function(a){var b=this.chart;return b.inverted?b.plotHeight+b.plotTop-a.chartY:a.chartX-b.plotLeft},runPointActions:function(a){var b,c,d,e,f,g=this,h=g.chart,i=h.series,j=h.tooltip,k=h.hoverPoint,m=h.hoverSeries,n=h.chartWidth,p=g.getIndex(a);if(j&&g.options.tooltip.shared&&(!m||!m.noSharedTooltip)){for(c=[],d=i.length,e=0;d>e;e++)i[e].visible&&i[e].options.enableMouseTracking!==!1&&!i[e].noSharedTooltip&&i[e].singularTooltips!==!0&&i[e].tooltipPoints.length&&(b=i[e].tooltipPoints[p],b&&b.series&&(b._dist=tb(p-b.clientX),n=sb(n,b._dist),c.push(b)));for(d=c.length;d--;)c[d]._dist>n&&c.splice(d,1);c.length&&c[0].clientX!==g.hoverX&&(j.refresh(c,a),g.hoverX=c[0].clientX)}!m||!m.tracker||j&&j.followPointer?j&&j.followPointer&&!j.isHidden&&(f=j.getAnchor([{}],a),j.updatePosition({plotX:f[0],plotY:f[1]})):(b=m.tooltipPoints[p],b&&b!==k&&b.onMouseOver(a)),j&&!g._onDocumentMouseMove&&(g._onDocumentMouseMove=function(a){l(Pc)&&Mb[Pc].pointer.onDocumentMouseMove(a)},vc(lb,"mousemove",g._onDocumentMouseMove)),rc(h.axes,function(c){c.drawCrosshair(a,o(b,k))})},reset:function(a){var b=this,c=b.chart,d=c.hoverSeries,e=c.hoverPoint,f=c.tooltip,g=f&&f.shared?c.hoverPoints:e;a=a&&f&&g,a&&n(g)[0].plotX===Q&&(a=!1),a?(f.refresh(g),e&&e.setState(e.state,!0)):(e&&e.onMouseOut(),d&&d.onMouseOut(),f&&f.hide(),b._onDocumentMouseMove&&(wc(lb,"mousemove",b._onDocumentMouseMove),b._onDocumentMouseMove=null),rc(c.axes,function(a){a.hideCrosshair()}),b.hoverX=null)},scaleGroups:function(a,b){var c,d=this.chart;rc(d.series,function(e){c=a||e.getPlotBox(),e.xAxis&&e.xAxis.zoomEnabled&&(e.group.attr(c),e.markerGroup&&(e.markerGroup.attr(c),e.markerGroup.clip(b?d.clipRect:null)),e.dataLabelsGroup&&e.dataLabelsGroup.attr(c))}),d.clipRect.attr(b||d.clipBox)},dragStart:function(a){var b=this.chart;b.mouseIsDown=a.type,b.cancelClick=!1,b.mouseDownX=this.mouseDownX=a.chartX,b.mouseDownY=this.mouseDownY=a.chartY},drag:function(a){var b,c,d=this.chart,e=d.options.chart,f=a.chartX,g=a.chartY,h=this.zoomHor,i=this.zoomVert,j=d.plotLeft,k=d.plotTop,l=d.plotWidth,m=d.plotHeight,n=this.mouseDownX,o=this.mouseDownY;j>f?f=j:f>j+l&&(f=j+l),k>g?g=k:g>k+m&&(g=k+m),this.hasDragged=Math.sqrt(Math.pow(n-f,2)+Math.pow(o-g,2)),this.hasDragged>10&&(b=d.isInsidePlot(n-j,o-k),d.hasCartesianSeries&&(this.zoomX||this.zoomY)&&b&&(this.selectionMarker||(this.selectionMarker=d.renderer.rect(j,k,h?1:l,i?1:m,0).attr({fill:e.selectionMarkerFill||"rgba(69,114,167,0.25)",zIndex:7}).add())),this.selectionMarker&&h&&(c=f-n,this.selectionMarker.attr({width:tb(c),x:(c>0?0:c)+n})),this.selectionMarker&&i&&(c=g-o,this.selectionMarker.attr({height:tb(c),y:(c>0?0:c)+o})),b&&!this.selectionMarker&&e.panning&&d.pan(a,e.panning))},drop:function(b){var c=this.chart,d=this.hasPinched;if(this.selectionMarker){var e,f={xAxis:[],yAxis:[],originalEvent:b.originalEvent||b},g=this.selectionMarker,h=g.x,i=g.y;(this.hasDragged||d)&&(rc(c.axes,function(a){if(a.zoomEnabled){var b=a.horiz,c=a.toValue(b?h:i),d=a.toValue(b?h+g.width:i+g.height);isNaN(c)||isNaN(d)||(f[a.coll].push({axis:a,min:sb(c,d),max:rb(c,d)}),e=!0)}}),e&&xc(c,"selection",f,function(b){c.zoom(a(b,d?{animation:!1}:null))})),this.selectionMarker=this.selectionMarker.destroy(),d&&this.scaleGroups()}c&&(p(c.container,{cursor:c._cursor}),c.cancelClick=this.hasDragged>10,c.mouseIsDown=this.hasDragged=this.hasPinched=!1,this.pinchDown=[])},onContainerMouseDown:function(a){a=this.normalize(a),a.preventDefault&&a.preventDefault(),this.dragStart(a)},onDocumentMouseUp:function(a){l(Pc)&&Mb[Pc].pointer.drop(a)},onDocumentMouseMove:function(a){var b=this.chart,c=this.chartPosition,d=b.hoverSeries;a=this.normalize(a,c),c&&d&&!this.inClass(a.target,"highcharts-tracker")&&!b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop)&&this.reset()},onContainerMouseLeave:function(){var a=Mb[Pc];a&&(a.pointer.reset(),a.pointer.chartPosition=null),Pc=null},onContainerMouseMove:function(a){var b=this.chart;Pc=b.index,a=this.normalize(a),"mousedown"===b.mouseIsDown&&this.drag(a),!this.inClass(a.target,"highcharts-tracker")&&!b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop)||b.openMenu||this.runPointActions(a)},inClass:function(a,b){for(var c;a;){if(c=m(a,"class")){if(-1!==c.indexOf(b))return!0;if(-1!==c.indexOf(Tb+"container"))return!1}a=a.parentNode}},onTrackerMouseOut:function(a){var b=this.chart.hoverSeries,c=a.relatedTarget||a.toElement,d=c&&c.point&&c.point.series;!b||b.options.stickyTracking||this.inClass(c,Tb+"tooltip")||d===b||b.onMouseOut()},onContainerClick:function(b){var c,d,e,f=this.chart,g=f.hoverPoint,h=f.plotLeft,i=f.plotTop,j=f.inverted;b=this.normalize(b),b.cancelBubble=!0,f.cancelClick||(g&&this.inClass(b.target,Tb+"tracker")?(c=this.chartPosition,d=g.plotX,e=g.plotY,a(g,{pageX:c.left+h+(j?f.plotWidth-e:d),pageY:c.top+i+(j?f.plotHeight-d:e)}),xc(g.series,"click",a(b,{point:g})),f.hoverPoint&&g.firePointEvent("click",b)):(a(b,this.getCoordinates(b)),f.isInsidePlot(b.chartX-h,b.chartY-i)&&xc(f,"click",b)))},setDOMEvents:function(){var a=this,b=a.chart.container;b.onmousedown=function(b){a.onContainerMouseDown(b)},b.onmousemove=function(b){a.onContainerMouseMove(b)},b.onclick=function(b){a.onContainerClick(b)},vc(b,"mouseleave",a.onContainerMouseLeave),vc(lb,"mouseup",a.onDocumentMouseUp),S&&(b.ontouchstart=function(b){a.onContainerTouchStart(b)},b.ontouchmove=function(b){a.onContainerTouchMove(b)},vc(lb,"touchend",a.onDocumentTouchEnd))},destroy:function(){var a;wc(this.chart.container,"mouseleave",this.onContainerMouseLeave),wc(lb,"mouseup",this.onDocumentMouseUp),wc(lb,"touchend",this.onDocumentTouchEnd),clearInterval(this.tooltipTimeout);for(a in this)this[a]=null}},a(lc.Pointer.prototype,{pinchTranslate:function(a,b,c,d,e,f,g,h){a&&this.pinchTranslateDirection(!0,c,d,e,f,g,h),b&&this.pinchTranslateDirection(!1,c,d,e,f,g,h)},pinchTranslateDirection:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o=this.chart,p=a?"x":"y",q=a?"X":"Y",r="chart"+q,s=a?"width":"height",t=o["plot"+(a?"Left":"Top")],u=h||1,v=o.inverted,w=o.bounds[a?"h":"v"],x=1===b.length,y=b[0][r],z=c[0][r],A=!x&&b[1][r],B=!x&&c[1][r],C=function(){!x&&tb(y-A)>20&&(u=h||tb(z-B)/tb(y-A)),k=(t-z)/u+y,i=o["plot"+(a?"Width":"Height")]/u};C(),j=k,w.min>j?(j=w.min,l=!0):j+i>w.max&&(j=w.max-i,l=!0),l?(z-=.8*(z-g[p][0]),x||(B-=.8*(B-g[p][1])),C()):g[p]=[z,B],v||(f[p]=k-t,f[s]=i),n=v?a?"scaleY":"scaleX":"scale"+q,m=v?1/u:u,e[s]=i,e[p]=j,d[n]=u,d["translate"+q]=m*t+(z-m*y)},pinch:function(b){var c=this,d=c.chart,e=c.pinchDown,f=d.tooltip&&d.tooltip.options.followTouchMove,g=b.touches,h=g.length,i=c.lastValidTouch,j=c.zoomHor||c.pinchHor,k=c.zoomVert||c.pinchVert,l=j||k,m=c.selectionMarker,n={},o=1===h&&(c.inClass(b.target,Tb+"tracker")&&d.runTrackerClick||d.runChartClick),p={};!l&&!f||o||b.preventDefault(),uc(g,function(a){return c.normalize(a)}),"touchstart"===b.type?(rc(g,function(a,b){e[b]={chartX:a.chartX,chartY:a.chartY}}),i.x=[e[0].chartX,e[1]&&e[1].chartX],i.y=[e[0].chartY,e[1]&&e[1].chartY],rc(d.axes,function(a){if(a.zoomEnabled){var b=d.bounds[a.horiz?"h":"v"],c=a.minPixelPadding,e=a.toPixels(a.dataMin),f=a.toPixels(a.dataMax),g=sb(e,f),h=rb(e,f);b.min=sb(a.pos,g-c),b.max=rb(a.pos+a.len,h+c)}})):e.length&&(m||(c.selectionMarker=m=a({destroy:Lb},d.plotBox)),c.pinchTranslate(j,k,e,g,n,m,p,i),c.hasPinched=l,c.scaleGroups(n,p),!l&&f&&1===h&&this.runPointActions(c.normalize(b)))},onContainerTouchStart:function(a){var b=this.chart;Pc=b.index,1===a.touches.length?(a=this.normalize(a),b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop)?(this.runPointActions(a),this.pinch(a)):this.reset()):2===a.touches.length&&this.pinch(a)},onContainerTouchMove:function(a){(1===a.touches.length||2===a.touches.length)&&this.pinch(a)},onDocumentTouchEnd:function(a){l(Pc)&&Mb[Pc].pointer.drop(a)}}),mb.PointerEvent||mb.MSPointerEvent){var Rc={},Sc=!!mb.PointerEvent,Tc=function(){var a,b=[];b.item=function(a){return this[a]};for(a in Rc)Rc.hasOwnProperty(a)&&b.push({pageX:Rc[a].pageX,pageY:Rc[a].pageY,target:Rc[a].target});return b},Uc=function(a,b,c,d){var e;a=a.originalEvent||a,"touch"!==a.pointerType&&a.pointerType!==a.MSPOINTER_TYPE_TOUCH||!Mb[Pc]||(d(a),e=Mb[Pc].pointer,e[b]({type:c,target:a.currentTarget,preventDefault:Lb,touches:Tc()}))};a(Qc.prototype,{onContainerPointerDown:function(a){Uc(a,"onContainerTouchStart","touchstart",function(a){Rc[a.pointerId]={pageX:a.pageX,pageY:a.pageY,target:a.currentTarget}})},onContainerPointerMove:function(a){Uc(a,"onContainerTouchMove","touchmove",function(a){Rc[a.pointerId]={pageX:a.pageX,pageY:a.pageY},Rc[a.pointerId].target||(Rc[a.pointerId].target=a.currentTarget)})},onDocumentPointerUp:function(a){Uc(a,"onContainerTouchEnd","touchend",function(a){delete Rc[a.pointerId]})},batchMSEvents:function(a){a(this.chart.container,Sc?"pointerdown":"MSPointerDown",this.onContainerPointerDown),a(this.chart.container,Sc?"pointermove":"MSPointerMove",this.onContainerPointerMove),a(lb,Sc?"pointerup":"MSPointerUp",this.onDocumentPointerUp)}}),u(Qc.prototype,"init",function(a,b,c){p(b.container,{"-ms-touch-action":Wb,"touch-action":Wb}),a.call(this,b,c)}),u(Qc.prototype,"setDOMEvents",function(a){a.apply(this),this.batchMSEvents(vc)}),u(Qc.prototype,"destroy",function(a){this.batchMSEvents(wc),a.call(this)})}var Vc=lc.Legend=function(a,b){this.init(a,b)};Vc.prototype={init:function(a,c){var e=this,f=c.itemStyle,g=o(c.padding,8),h=c.itemMarginTop||0;this.options=c,c.enabled&&(e.baseline=d(f.fontSize)+3+h,e.itemStyle=f,e.itemHiddenStyle=b(f,c.itemHiddenStyle),e.itemMarginTop=h,e.padding=g,e.initialItemX=g,e.initialItemY=g-5,e.maxItemWidth=0,e.chart=a,e.itemHeight=0,e.lastLineHeight=0,e.symbolWidth=o(c.symbolWidth,16),e.pages=[],e.render(),vc(e.chart,"endResize",function(){e.positionCheckboxes()}))},colorizeItem:function(a,b){var c,d,e=this,f=e.options,g=a.legendItem,h=a.legendLine,i=a.legendSymbol,j=e.itemHiddenStyle.color,k=b?f.itemStyle.color:j,l=b?a.legendColor||a.color||"#CCC":j,m=a.options&&a.options.marker,n={stroke:l,fill:l};if(g&&g.css({fill:k,color:k}),h&&h.attr({stroke:l}),i){if(m&&i.isMarker){m=a.convertAttribs(m);for(c in m)d=m[c],d!==Q&&(n[c]=d)}i.attr(n)}},positionItem:function(a){var b=this,c=b.options,d=c.symbolPadding,e=!c.rtl,f=a._legendItemPos,g=f[0],h=f[1],i=a.checkbox;a.legendGroup&&a.legendGroup.translate(e?g:b.legendWidth-g-2*d-4,h),i&&(i.x=g,i.y=h)},destroyItem:function(a){var b=a.checkbox;rc(["legendItem","legendLine","legendSymbol","legendGroup"],function(b){a[b]&&(a[b]=a[b].destroy())}),b&&E(a.checkbox)},destroy:function(){var a=this,b=a.group,c=a.box;c&&(a.box=c.destroy()),b&&(a.group=b.destroy())},positionCheckboxes:function(a){var b,c=this.group.alignAttr,d=this.clipHeight||this.legendHeight;c&&(b=c.translateY,rc(this.allItems,function(e){var f,g=e.checkbox;g&&(f=b+g.y+(a||0)+3,p(g,{left:c.translateX+e.legendItemWidth+g.x-20+Vb,top:f+Vb,display:f>b-6&&b+d-6>f?"":Wb}))}))},renderTitle:function(){var a,b=this.options,c=this.padding,d=b.title,e=0;d.text&&(this.title||(this.title=this.chart.renderer.label(d.text,c-3,c-4,null,null,null,null,null,"legend-title").attr({zIndex:1}).css(d.style).add(this.group)),a=this.title.getBBox(),e=a.height,this.offsetWidth=a.width,this.contentGroup.attr({translateY:e})),this.titleHeight=e},renderItem:function(a){var c,d,e,f=this,g=f.chart,h=g.renderer,i=f.options,j="horizontal"===i.layout,k=f.symbolWidth,l=i.symbolPadding,m=f.itemStyle,n=f.itemHiddenStyle,p=f.padding,q=j?o(i.itemDistance,8):0,r=!i.rtl,s=i.width,t=i.itemMarginBottom||0,u=f.itemMarginTop,v=f.initialItemX,x=a.legendItem,y=a.series&&a.series.drawLegendSymbol?a.series:a,z=y.options,A=f.createCheckboxForItem&&z&&z.showCheckbox,B=i.useHTML;x||(a.legendGroup=h.g("legend-item").attr({zIndex:1}).add(f.scrollGroup),y.drawLegendSymbol(f,a),a.legendItem=x=h.text(i.labelFormat?w(i.labelFormat,a):i.labelFormatter.call(a),r?k+l:-l,f.baseline,B).css(b(a.visible?m:n)).attr({align:r?"left":"right",zIndex:2}).add(a.legendGroup),f.setItemEvents&&f.setItemEvents(a,x,B,m,n),f.colorizeItem(a,a.visible),A&&f.createCheckboxForItem(a)),d=x.getBBox(),e=a.legendItemWidth=i.itemWidth||a.legendItemWidth||k+l+d.width+q+(A?20:0),f.itemHeight=c=ob(a.legendItemHeight||d.height),j&&f.itemX-v+e>(s||g.chartWidth-2*p-v-i.x)&&(f.itemX=v,f.itemY+=u+f.lastLineHeight+t,f.lastLineHeight=0),f.maxItemWidth=rb(f.maxItemWidth,e),f.lastItemY=u+f.itemY+t,f.lastLineHeight=rb(c,f.lastLineHeight),a._legendItemPos=[f.itemX,f.itemY],j?f.itemX+=e:(f.itemY+=u+c+t,f.lastLineHeight=c),f.offsetWidth=s||rb((j?f.itemX-v-q:e)+p,f.offsetWidth)},getAllItems:function(){var a=[];return rc(this.chart.series,function(b){var c=b.options;o(c.showInLegend,l(c.linkedTo)?!1:Q,!0)&&(a=a.concat(b.legendItems||("point"===c.legendType?b.data:b)))}),a},render:function(){var b,c,d,e,f=this,g=f.chart,h=g.renderer,i=f.group,j=f.box,k=f.options,l=f.padding,m=k.borderWidth,n=k.backgroundColor;f.itemX=f.initialItemX,f.itemY=f.initialItemY,f.offsetWidth=0,f.lastItemY=0,i||(f.group=i=h.g("legend").attr({zIndex:7}).add(),f.contentGroup=h.g().attr({zIndex:1}).add(i),f.scrollGroup=h.g().add(f.contentGroup)),f.renderTitle(),b=f.getAllItems(),A(b,function(a,b){return(a.options&&a.options.legendIndex||0)-(b.options&&b.options.legendIndex||0)}),k.reversed&&b.reverse(),f.allItems=b,f.display=c=!!b.length,rc(b,function(a){f.renderItem(a)}),d=k.width||f.offsetWidth,e=f.lastItemY+f.lastLineHeight+f.titleHeight,e=f.handleOverflow(e),(m||n)&&(d+=l,e+=l,j?d>0&&e>0&&(j[j.isNew?"attr":"animate"](j.crisp({width:d,height:e})),j.isNew=!1):(f.box=j=h.rect(0,0,d,e,k.borderRadius,m||0).attr({stroke:k.borderColor,"stroke-width":m||0,fill:n||Wb}).add(i).shadow(k.shadow),j.isNew=!0),j[c?"show":"hide"]()),f.legendWidth=d,f.legendHeight=e,rc(b,function(a){f.positionItem(a)}),c&&i.align(a({width:d,height:e},k),!0,"spacingBox"),g.isResizing||this.positionCheckboxes()},handleOverflow:function(a){var b,c,d=this,e=this.chart,f=e.renderer,g=this.options,h=g.y,i="top"===g.verticalAlign,j=e.spacingBox.height+(i?-h:h)-this.padding,k=g.maxHeight,l=this.clipRect,m=g.navigation,n=o(m.animation,!0),p=m.arrowSize||12,q=this.nav,r=this.pages,s=this.allItems;return"horizontal"===g.layout&&(j/=2),k&&(j=sb(j,k)),r.length=0,a>j&&!g.useHTML?(this.clipHeight=b=j-20-this.titleHeight-this.padding,this.currentPage=o(this.currentPage,1),this.fullHeight=a,rc(s,function(a,d){var e=a._legendItemPos[1],f=ob(a.legendItem.getBBox().height),g=r.length;(!g||e-r[g-1]>b&&(c||e)!==r[g-1])&&(r.push(c||e),g++),d===s.length-1&&e+f-r[g-1]>b&&r.push(e),e!==c&&(c=e)}),l||(l=d.clipRect=f.clipRect(0,this.padding,9999,0),d.contentGroup.clip(l)),l.attr({height:b}),q||(this.nav=q=f.g().attr({zIndex:1}).add(this.group),this.up=f.symbol("triangle",0,0,p,p).on("click",function(){d.scroll(-1,n)}).add(q),this.pager=f.text("",15,10).css(m.style).add(q),this.down=f.symbol("triangle-down",0,0,p,p).on("click",function(){d.scroll(1,n)}).add(q)),d.scroll(0),a=j):q&&(l.attr({height:e.chartHeight}),q.hide(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),a},scroll:function(a,b){var c,d=this.pages,e=d.length,f=this.currentPage+a,g=this.clipHeight,h=this.options.navigation,i=h.activeColor,j=h.inactiveColor,k=this.pager,l=this.padding;f>e&&(f=e),f>0&&(b!==Q&&H(b,this.chart),this.nav.attr({translateX:l,translateY:g+this.padding+7+this.titleHeight,visibility:Ub}),this.up.attr({fill:1===f?j:i}).css({cursor:1===f?"default":"pointer"}),k.attr({text:f+"/"+e}),this.down.attr({x:18+this.pager.getBBox().width,fill:f===e?j:i}).css({cursor:f===e?"default":"pointer"}),c=-d[f-1]+this.initialItemY,this.scrollGroup.animate({translateY:c}),this.currentPage=f,this.positionCheckboxes(c))}};var Wc=lc.LegendSymbolMixin={drawRectangle:function(a,b){var c=a.options.symbolHeight||12;b.legendSymbol=this.chart.renderer.rect(0,a.baseline-5-c/2,a.symbolWidth,c,o(a.options.symbolRadius,2)).attr({zIndex:3}).add(b.legendGroup)},drawLineMarker:function(a){var b,c,d,e=this.options,f=e.marker,g=a.options,h=a.symbolWidth,i=this.chart.renderer,j=this.legendGroup,k=a.baseline-ob(.3*i.fontMetrics(g.itemStyle.fontSize).b);e.lineWidth&&(d={"stroke-width":e.lineWidth},e.dashStyle&&(d.dashstyle=e.dashStyle),this.legendLine=i.path([Xb,0,k,Yb,h,k]).attr(d).add(j)),f&&f.enabled&&(b=f.radius,this.legendSymbol=c=i.symbol(this.symbol,h/2-b,k-b,2*b,2*b).add(j),c.isMarker=!0)}};(/Trident\/7\.0/.test(yb)||Db)&&u(Vc.prototype,"positionItem",function(a,b){var c=this,d=function(){b._legendItemPos&&a.call(c,b)};c.chart.renderer.forExport?d():setTimeout(d)}),O.prototype={init:function(a,c){var d,e=a.series;a.series=null,d=b(U,a),d.series=a.series=e,this.userOptions=a;var f=d.chart;this.margin=this.splashArray("margin",f),this.spacing=this.splashArray("spacing",f);var g=f.events;this.bounds={h:{},v:{}},this.callback=c,this.isResizing=0,this.options=d,this.axes=[],this.series=[],this.hasCartesianSeries=f.showAxes;var h,i=this;if(i.index=Mb.length,Mb.push(i),f.reflow!==!1&&vc(i,"load",function(){i.initReflow()}),g)for(h in g)vc(i,h,g[h]);i.xAxis=[],i.yAxis=[],i.animation=Ib?!1:o(f.animation,!0),i.pointCount=0,i.counters=new z,i.firstRender()},initSeries:function(a){var b,c=this,d=c.options.chart,e=a.type||d.type||d.defaultSeriesType,f=kc[e];return f||F(17,!0),b=new f,b.init(this,a),b},isInsidePlot:function(a,b,c){var d=c?b:a,e=c?a:b;return d>=0&&this.plotWidth>=d&&e>=0&&this.plotHeight>=e},adjustTickAmounts:function(){this.options.chart.alignTicks!==!1&&rc(this.axes,function(a){a.adjustTickAmount()}),this.maxTicks=null},redraw:function(b){var c,d,e,f=this,g=f.axes,h=f.series,i=f.pointer,j=f.legend,k=f.isDirtyLegend,l=f.isDirtyBox,m=h.length,n=m,o=f.renderer,p=o.isHidden(),q=[];for(H(b,f),p&&f.cloneRenderTo(),f.layOutTitles();n--;)if(e=h[n],e.options.stacking&&(c=!0,e.isDirty)){d=!0;break}if(d)for(n=m;n--;)e=h[n],e.options.stacking&&(e.isDirty=!0);rc(h,function(a){a.isDirty&&"point"===a.options.legendType&&(k=!0)}),k&&j.options.enabled&&(j.render(),f.isDirtyLegend=!1),c&&f.getStacks(),f.hasCartesianSeries&&(f.isResizing||(f.maxTicks=null,rc(g,function(a){a.setScale()})),f.adjustTickAmounts(),f.getMargins(),rc(g,function(a){a.isDirty&&(l=!0)}),rc(g,function(b){b.isDirtyExtremes&&(b.isDirtyExtremes=!1,q.push(function(){xc(b,"afterSetExtremes",a(b.eventArgs,b.getExtremes())),delete b.eventArgs})),(l||c)&&b.redraw()})),l&&f.drawChartBox(),rc(h,function(a){a.isDirty&&a.visible&&(!a.isCartesian||a.xAxis)&&a.redraw()}),i&&i.reset(!0),o.draw(),xc(f,"redraw"),p&&f.cloneRenderTo(!0),rc(q,function(a){a.call()})},get:function(a){var b,c,d,e=this,f=e.axes,g=e.series;for(b=0;f.length>b;b++)if(f[b].options.id===a)return f[b];for(b=0;g.length>b;b++)if(g[b].options.id===a)return g[b];for(b=0;g.length>b;b++)for(d=g[b].points||[],c=0;d.length>c;c++)if(d[c].id===a)return d[c];return null},getAxes:function(){var a,b,c=this,d=this.options,e=d.xAxis=n(d.xAxis||{}),f=d.yAxis=n(d.yAxis||{});rc(e,function(a,b){a.index=b,a.isX=!0}),rc(f,function(a,b){a.index=b}),a=e.concat(f),rc(a,function(a){b=new N(c,a)}),c.adjustTickAmounts()},getSelectedPoints:function(){var a=[];return rc(this.series,function(b){a=a.concat(sc(b.points||[],function(a){return a.selected}))}),a},getSelectedSeries:function(){return sc(this.series,function(a){return a.selected})},getStacks:function(){var a=this;rc(a.yAxis,function(a){a.stacks&&a.hasVisibleSeries&&(a.oldStacks=a.stacks)}),rc(a.series,function(b){!b.options.stacking||b.visible!==!0&&a.options.chart.ignoreHiddenSeries!==!1||(b.stackKey=b.type+o(b.options.stack,""))})},setTitle:function(a,c,d){var e,f,g=this,h=g.options;e=h.title=b(h.title,a),f=h.subtitle=b(h.subtitle,c),rc([["title",a,e],["subtitle",c,f]],function(a){var b=a[0],c=g[b],d=a[1],e=a[2];c&&d&&(g[b]=c=c.destroy()),e&&e.text&&!c&&(g[b]=g.renderer.text(e.text,0,0,e.useHTML).attr({align:e.align,"class":Tb+b,zIndex:e.zIndex||4}).css(e.style).add())}),g.layOutTitles(d)},layOutTitles:function(b){var c,d=0,e=this.title,f=this.subtitle,g=this.options,h=g.title,i=g.subtitle,j=this.spacingBox.width-44;e&&(e.css({width:(h.width||j)+Vb}).align(a({y:15},h),!1,"spacingBox"),h.floating||h.verticalAlign||(d=e.getBBox().height,d>=18&&25>=d&&(d=15))),f&&(f.css({width:(i.width||j)+Vb}).align(a({y:d+h.margin},i),!1,"spacingBox"),i.floating||i.verticalAlign||(d=qb(d+f.getBBox().height))),c=this.titleOffset!==d,this.titleOffset=d,!this.isDirtyBox&&c&&(this.isDirtyBox=c,this.hasRendered&&o(b,!0)&&this.isDirtyBox&&this.redraw())},getChartSize:function(){var a=this,b=a.options.chart,c=b.width,d=b.height,e=a.renderToClone||a.renderTo;l(c)||(a.containerWidth=oc(e,"width")),l(d)||(a.containerHeight=oc(e,"height")),a.chartWidth=rb(0,c||a.containerWidth||600),a.chartHeight=rb(0,o(d,a.containerHeight>19?a.containerHeight:400))},cloneRenderTo:function(a){var b=this.renderToClone,c=this.container;a?b&&(this.renderTo.appendChild(c),E(b),delete this.renderToClone):(c&&c.parentNode===this.renderTo&&this.renderTo.removeChild(c),this.renderToClone=b=this.renderTo.cloneNode(0),p(b,{position:Qb,top:"-9999px",display:"block"}),b.style.setProperty&&b.style.setProperty("display","block","important"),lb.body.appendChild(b),c&&b.appendChild(c))},getContainer:function(){var b,c,f,g,h,i,j=this,k=j.options.chart,l="data-highcharts-chart";j.renderTo=g=k.renderTo,i=Tb+Kb++,e(g)&&(j.renderTo=g=lb.getElementById(g)),g||F(13,!0),h=d(m(g,l)),!isNaN(h)&&Mb[h]&&Mb[h].hasRendered&&Mb[h].destroy(),m(g,l,j.index),g.innerHTML="",k.skipClone||g.offsetWidth||j.cloneRenderTo(),j.getChartSize(),c=j.chartWidth,f=j.chartHeight,j.container=b=q(Pb,{className:Tb+"container"+(k.className?" "+k.className:""),id:i},a({position:Rb,overflow:Sb,width:c+Vb,height:f+Vb,textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)"},k.style),j.renderToClone||g),j._cursor=b.style.cursor,j.renderer=k.forExport?new Ic(b,c,f,k.style,!0):new R(b,c,f,k.style),Ib&&j.renderer.create(j,b,c,f)},getMargins:function(){var a,b=this,c=b.spacing,d=b.legend,e=b.margin,f=b.options.legend,g=o(f.margin,10),h=f.x,i=f.y,j=f.align,k=f.verticalAlign,m=b.titleOffset;b.resetMargins(),a=b.axisOffset,m&&!l(e[0])&&(b.plotTop=rb(b.plotTop,m+b.options.title.margin+c[0])),d.display&&!f.floating&&("right"===j?l(e[1])||(b.marginRight=rb(b.marginRight,d.legendWidth-h+g+c[1])):"left"===j?l(e[3])||(b.plotLeft=rb(b.plotLeft,d.legendWidth+h+g+c[3])):"top"===k?l(e[0])||(b.plotTop=rb(b.plotTop,d.legendHeight+i+g+c[0])):"bottom"===k&&(l(e[2])||(b.marginBottom=rb(b.marginBottom,d.legendHeight-i+g+c[2])))),b.extraBottomMargin&&(b.marginBottom+=b.extraBottomMargin),b.extraTopMargin&&(b.plotTop+=b.extraTopMargin),b.hasCartesianSeries&&rc(b.axes,function(a){a.getOffset()}),l(e[3])||(b.plotLeft+=a[3]),l(e[0])||(b.plotTop+=a[0]),l(e[2])||(b.marginBottom+=a[2]),l(e[1])||(b.marginRight+=a[1]),b.setChartSize()},reflow:function(a){var b=this,c=b.options.chart,d=b.renderTo,e=c.width||oc(d,"width"),f=c.height||oc(d,"height"),g=a?a.target:mb,h=function(){b.container&&(b.setSize(e,f,!1),b.hasUserSize=null)};b.hasUserSize||!e||!f||g!==mb&&g!==lb||((e!==b.containerWidth||f!==b.containerHeight)&&(clearTimeout(b.reflowTimeout),a?b.reflowTimeout=setTimeout(h,100):h()),b.containerWidth=e,b.containerHeight=f)},initReflow:function(){var a=this,b=function(b){a.reflow(b)};vc(mb,"resize",b),vc(a,"destroy",function(){wc(mb,"resize",b)})},setSize:function(a,b,c){var d,e,f,g=this;g.isResizing+=1,f=function(){g&&xc(g,"endResize",null,function(){g.isResizing-=1
})},H(c,g),g.oldChartHeight=g.chartHeight,g.oldChartWidth=g.chartWidth,l(a)&&(g.chartWidth=d=rb(0,ob(a)),g.hasUserSize=!!d),l(b)&&(g.chartHeight=e=rb(0,ob(b))),(W?zc:p)(g.container,{width:d+Vb,height:e+Vb},W),g.setChartSize(!0),g.renderer.setSize(d,e,c),g.maxTicks=null,rc(g.axes,function(a){a.isDirty=!0,a.setScale()}),rc(g.series,function(a){a.isDirty=!0}),g.isDirtyLegend=!0,g.isDirtyBox=!0,g.getMargins(),g.redraw(c),g.oldChartHeight=null,xc(g,"resize"),W===!1?f():setTimeout(f,W&&W.duration||500)},setChartSize:function(a){var b,c,d,e,f,g,h,i=this,j=i.inverted,k=i.renderer,l=i.chartWidth,m=i.chartHeight,n=i.options.chart,o=i.spacing,p=i.clipOffset;i.plotLeft=d=ob(i.plotLeft),i.plotTop=e=ob(i.plotTop),i.plotWidth=f=rb(0,ob(l-d-i.marginRight)),i.plotHeight=g=rb(0,ob(m-e-i.marginBottom)),i.plotSizeX=j?g:f,i.plotSizeY=j?f:g,i.plotBorderWidth=n.plotBorderWidth||0,i.spacingBox=k.spacingBox={x:o[3],y:o[0],width:l-o[3]-o[1],height:m-o[0]-o[2]},i.plotBox=k.plotBox={x:d,y:e,width:f,height:g},h=2*pb(i.plotBorderWidth/2),b=qb(rb(h,p[3])/2),c=qb(rb(h,p[0])/2),i.clipBox={x:b,y:c,width:pb(i.plotSizeX-rb(h,p[1])/2-b),height:pb(i.plotSizeY-rb(h,p[2])/2-c)},a||rc(i.axes,function(a){a.setAxisSize(),a.setAxisTranslation()})},resetMargins:function(){var a=this,b=a.spacing,c=a.margin;a.plotTop=o(c[0],b[0]),a.marginRight=o(c[1],b[1]),a.marginBottom=o(c[2],b[2]),a.plotLeft=o(c[3],b[3]),a.axisOffset=[0,0,0,0],a.clipOffset=[0,0,0,0]},drawChartBox:function(){var a,b,c=this,d=c.options.chart,e=c.renderer,f=c.chartWidth,g=c.chartHeight,h=c.chartBackground,i=c.plotBackground,j=c.plotBorder,k=c.plotBGImage,l=d.borderWidth||0,m=d.backgroundColor,n=d.plotBackgroundColor,o=d.plotBackgroundImage,p=d.plotBorderWidth||0,q=c.plotLeft,r=c.plotTop,s=c.plotWidth,t=c.plotHeight,u=c.plotBox,v=c.clipRect,w=c.clipBox;a=l+(d.shadow?8:0),(l||m)&&(h?h.animate(h.crisp({width:f-a,height:g-a})):(b={fill:m||Wb},l&&(b.stroke=d.borderColor,b["stroke-width"]=l),c.chartBackground=e.rect(a/2,a/2,f-a,g-a,d.borderRadius,l).attr(b).addClass(Tb+"background").add().shadow(d.shadow))),n&&(i?i.animate(u):c.plotBackground=e.rect(q,r,s,t,0).attr({fill:n}).add().shadow(d.plotShadow)),o&&(k?k.animate(u):c.plotBGImage=e.image(o,q,r,s,t).add()),v?v.animate({width:w.width,height:w.height}):c.clipRect=e.clipRect(w),p&&(j?j.animate(j.crisp({x:q,y:r,width:s,height:t})):c.plotBorder=e.rect(q,r,s,t,0,-p).attr({stroke:d.plotBorderColor,"stroke-width":p,fill:Wb,zIndex:1}).add()),c.isDirtyBox=!1},propFromSeries:function(){var a,b,c,d=this,e=d.options.chart,f=d.options.series;rc(["inverted","angular","polar"],function(g){for(a=kc[e.type||e.defaultSeriesType],c=d[g]||e[g]||a&&a.prototype[g],b=f&&f.length;!c&&b--;)a=kc[f[b].type],a&&a.prototype[g]&&(c=!0);d[g]=c})},linkSeries:function(){var a=this,b=a.series;rc(b,function(a){a.linkedSeries.length=0}),rc(b,function(b){var c=b.options.linkedTo;e(c)&&(c=":previous"===c?a.series[b.index-1]:a.get(c),c&&(c.linkedSeries.push(b),b.linkedParent=c))})},renderSeries:function(){rc(this.series,function(a){a.translate(),a.setTooltipPoints&&a.setTooltipPoints(),a.render()})},render:function(){var b,c=this,e=c.axes,f=c.renderer,g=c.options,h=g.labels,i=g.credits;c.setTitle(),c.legend=new Vc(c,g.legend),c.getStacks(),rc(e,function(a){a.setScale()}),c.getMargins(),c.maxTicks=null,rc(e,function(a){a.setTickPositions(!0),a.setMaxTicks()}),c.adjustTickAmounts(),c.getMargins(),c.drawChartBox(),c.hasCartesianSeries&&rc(e,function(a){a.render()}),c.seriesGroup||(c.seriesGroup=f.g("series-group").attr({zIndex:3}).add()),c.renderSeries(),h.items&&rc(h.items,function(b){var e=a(h.style,b.style),g=d(e.left)+c.plotLeft,i=d(e.top)+c.plotTop+12;delete e.left,delete e.top,f.text(b.html,g,i).attr({zIndex:2}).css(e).add()}),i.enabled&&!c.credits&&(b=i.href,c.credits=f.text(i.text,0,0).on("click",function(){b&&(location.href=b)}).attr({align:i.position.align,zIndex:8}).css(i.style).add().align(i.position)),c.hasRendered=!0},destroy:function(){var a,b=this,c=b.axes,d=b.series,e=b.container,f=e&&e.parentNode;for(xc(b,"destroy"),Mb[b.index]=Q,b.renderTo.removeAttribute("data-highcharts-chart"),wc(b),a=c.length;a--;)c[a]=c[a].destroy();for(a=d.length;a--;)d[a]=d[a].destroy();rc(["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","scroller","rangeSelector","legend","resetZoomButton","tooltip","renderer"],function(a){var c=b[a];c&&c.destroy&&(b[a]=c.destroy())}),e&&(e.innerHTML="",wc(e),f&&E(e));for(a in b)delete b[a]},isReadyToRender:function(){var a=this;return!Gb&&mb==mb.top&&"complete"!==lb.readyState||Ib&&!mb.canvg?(Ib?Nc.push(function(){a.firstRender()},a.options.global.canvasToolsURL):lb.attachEvent("onreadystatechange",function(){lb.detachEvent("onreadystatechange",a.firstRender),"complete"===lb.readyState&&a.firstRender()}),!1):!0},firstRender:function(){var a=this,b=a.options,c=a.callback;a.isReadyToRender()&&(a.getContainer(),xc(a,"init"),a.resetMargins(),a.setChartSize(),a.propFromSeries(),a.getAxes(),rc(b.series||[],function(b){a.initSeries(b)}),a.linkSeries(),xc(a,"beforeRender"),lc.Pointer&&(a.pointer=new Qc(a,b)),a.render(),a.renderer.draw(),c&&c.apply(a,[a]),rc(a.callbacks,function(b){b.apply(a,[a])}),a.cloneRenderTo(!0),xc(a,"load"))},splashArray:function(a,b){var c=b[a],d=f(c)?c:[c,c,c,c];return[o(b[a+"Top"],d[0]),o(b[a+"Right"],d[1]),o(b[a+"Bottom"],d[2]),o(b[a+"Left"],d[3])]}},O.prototype.callbacks=[];var Xc=lc.CenteredSeriesMixin={getCenter:function(){var a,b,c=this.options,e=this.chart,f=2*(c.slicedOffset||0),g=e.plotWidth-2*f,h=e.plotHeight-2*f,i=c.center,j=[o(i[0],"50%"),o(i[1],"50%"),c.size||"100%",c.innerSize||0],k=sb(g,h);return uc(j,function(c,e){return b=/%$/.test(c),a=2>e||2===e&&b,(b?[g,h,k,k][e]*d(c)/100:c)+(a?f:0)})}},Yc=function(){};Yc.prototype={init:function(a,b,c){var d,e=this;return e.series=a,e.applyOptions(b,c),e.pointAttr={},a.options.colorByPoint&&(d=a.options.colors||a.chart.options.colors,e.color=e.color||d[a.colorCounter++],a.colorCounter===d.length&&(a.colorCounter=0)),a.chart.pointCount++,e},applyOptions:function(b,c){var d=this,e=d.series,f=e.pointValKey;return b=Yc.prototype.optionsToObject.call(this,b),a(d,b),d.options=d.options?a(d.options,b):b,f&&(d.y=d[f]),d.x===Q&&e&&(d.x=c===Q?e.autoIncrement():c),d},optionsToObject:function(a){var b,c={},d=this.series,e=d.pointArrayMap||["y"],f=e.length,h=0,i=0;if("number"==typeof a||null===a)c[e[0]]=a;else if(g(a))for(a.length>f&&(b=typeof a[0],"string"===b?c.name=a[0]:"number"===b&&(c.x=a[0]),h++);f>i;)c[e[i++]]=a[h++];else"object"==typeof a&&(c=a,a.dataLabels&&(d._hasPointLabels=!0),a.marker&&(d._hasPointMarkers=!0));return c},destroy:function(){var a,b=this,c=b.series,d=c.chart,e=d.hoverPoints;d.pointCount--,e&&(b.setState(),k(e,b),e.length||(d.hoverPoints=null)),b===d.hoverPoint&&b.onMouseOut(),(b.graphic||b.dataLabel)&&(wc(b),b.destroyElements()),b.legendItem&&d.legend.destroyItem(b);for(a in b)b[a]=null},destroyElements:function(){for(var a,b=this,c=["graphic","dataLabel","dataLabelUpper","group","connector","shadowGroup"],d=6;d--;)a=c[d],b[a]&&(b[a]=b[a].destroy())},getLabelConfig:function(){var a=this;return{x:a.category,y:a.y,key:a.name||a.category,series:a.series,point:a,percentage:a.percentage,total:a.total||a.stackTotal}},tooltipFormatter:function(a){var b=this.series,c=b.tooltipOptions,d=o(c.valueDecimals,""),e=c.valuePrefix||"",f=c.valueSuffix||"";return rc(b.pointArrayMap||["y"],function(b){b="{point."+b,(e||f)&&(a=a.replace(b+"}",e+b+"}"+f)),a=a.replace(b+"}",b+":,."+d+"f}")}),w(a,{point:this,series:this.series})}};var Zc=function(){};Zc.prototype={isCartesian:!0,type:"line",pointClass:Yc,sorted:!0,requireSorting:!0,pointAttrToOptions:{stroke:"lineColor","stroke-width":"lineWidth",fill:"fillColor",r:"radius"},axisTypes:["xAxis","yAxis"],colorCounter:0,parallelArrays:["x","y"],init:function(b,c){var d,e,f=this,g=b.series,h=function(a,b){return o(a.options.index,a._i)-o(b.options.index,b._i)};f.chart=b,f.options=c=f.setOptions(c),f.linkedSeries=[],f.bindAxes(),a(f,{name:c.name,state:$b,pointAttr:{},visible:c.visible!==!1,selected:c.selected===!0}),Ib&&(c.animation=!1),e=c.events;for(d in e)vc(f,d,e[d]);(e&&e.click||c.point&&c.point.events&&c.point.events.click||c.allowPointSelect)&&(b.runTrackerClick=!0),f.getColor(),f.getSymbol(),rc(f.parallelArrays,function(a){f[a+"Data"]=[]}),f.setData(c.data,!1),f.isCartesian&&(b.hasCartesianSeries=!0),g.push(f),f._i=g.length-1,A(g,h),this.yAxis&&A(this.yAxis.series,h),rc(g,function(a,b){a.index=b,a.name=a.name||"Series "+(b+1)})},bindAxes:function(){var a,b=this,c=b.options,d=b.chart;rc(b.axisTypes||[],function(e){rc(d[e],function(d){a=d.options,(c[e]===a.index||c[e]!==Q&&c[e]===a.id||c[e]===Q&&0===a.index)&&(d.series.push(b),b[e]=d,d.isDirty=!0)}),b[e]||b.optionalAxis===e||F(18,!0)})},updateParallelArrays:function(a,b){var c=a.series,d=arguments,e="number"==typeof b?function(d){var e="y"===d&&c.toYData?c.toYData(a):a[d];c[d+"Data"][b]=e}:function(a){Array.prototype[b].apply(c[a+"Data"],Array.prototype.slice.call(d,2))};rc(c.parallelArrays,e)},autoIncrement:function(){var a=this,b=a.options,c=a.xIncrement;return c=o(c,b.pointStart,0),a.pointInterval=o(a.pointInterval,b.pointInterval,1),a.xIncrement=c+a.pointInterval,c},getSegments:function(){var a,b=this,c=-1,d=[],e=b.points,f=e.length;if(f)if(b.options.connectNulls){for(a=f;a--;)null===e[a].y&&e.splice(a,1);e.length&&(d=[e])}else rc(e,function(a,b){null===a.y?(b>c+1&&d.push(e.slice(c+1,b)),c=b):b===f-1&&d.push(e.slice(c+1,b+1))});b.segments=d},setOptions:function(a){var c,d=this.chart,e=d.options,f=e.plotOptions,g=d.userOptions||{},h=g.plotOptions||{},i=f[this.type];return this.userOptions=a,c=b(i,f.series,a),this.tooltipOptions=b(U.tooltip,U.plotOptions[this.type].tooltip,g.tooltip,h.series&&h.series.tooltip,h[this.type]&&h[this.type].tooltip,a.tooltip),null===i.marker&&delete c.marker,c},getColor:function(){var a,b,c=this.options,d=this.userOptions,e=this.chart.options.colors,f=this.chart.counters;a=c.color||Cc[this.type].color,a||c.colorByPoint||(l(d._colorIndex)?b=d._colorIndex:(d._colorIndex=f.color,b=f.color++),a=e[b]),this.color=a,f.wrapColor(e.length)},getSymbol:function(){var a,b=this,c=b.userOptions,d=b.options.marker,e=b.chart,f=e.options.symbols,g=e.counters;b.symbol=d.symbol,b.symbol||(l(c._symbolIndex)?a=c._symbolIndex:(c._symbolIndex=g.symbol,a=g.symbol++),b.symbol=f[a]),/^url/.test(b.symbol)&&(d.radius=0),g.wrapSymbol(f.length)},drawLegendSymbol:Wc.drawLineMarker,setData:function(a,b,c,d){var f,i,j,k=this,l=k.points,m=l&&l.length||0,n=k.options,p=k.chart,q=null,r=k.xAxis,s=r&&!!r.categories,t=k.tooltipPoints,u=n.turboThreshold,v=this.xData,w=this.yData,x=k.pointArrayMap,y=x&&x.length;if(a=a||[],f=a.length,b=o(b,!0),d===!1||!f||m!==f||k.cropped||k.hasGroupedData){if(k.xIncrement=null,k.pointRange=s?1:n.pointRange,k.colorCounter=0,rc(this.parallelArrays,function(a){k[a+"Data"].length=0}),u&&f>u){for(i=0;null===q&&f>i;)q=a[i],i++;if(h(q)){var z=o(n.pointStart,0),A=o(n.pointInterval,1);for(i=0;f>i;i++)v[i]=z,w[i]=a[i],z+=A;k.xIncrement=z}else if(g(q))if(y)for(i=0;f>i;i++)j=a[i],v[i]=j[0],w[i]=j.slice(1,y+1);else for(i=0;f>i;i++)j=a[i],v[i]=j[0],w[i]=j[1];else F(12)}else for(i=0;f>i;i++)a[i]!==Q&&(j={series:k},k.pointClass.prototype.applyOptions.apply(j,[a[i]]),k.updateParallelArrays(j,i),s&&j.name&&(r.names[j.x]=j.name));for(e(w[0])&&F(14,!0),k.data=[],k.options.data=a,i=m;i--;)l[i]&&l[i].destroy&&l[i].destroy();t&&(t.length=0),r&&(r.minRange=r.userMinRange),k.isDirty=k.isDirtyData=p.isDirtyBox=!0,c=!1}else rc(a,function(a,b){l[b].update(a,!1)});b&&p.redraw(c)},processData:function(a){var b,c,d,e,f,g=this,h=g.xData,i=g.yData,j=h.length,k=0,l=g.xAxis,m=g.options,n=m.cropThreshold,o=g.isCartesian;if(o&&!g.isDirty&&!l.isDirty&&!g.yAxis.isDirty&&!a)return!1;if(o&&g.sorted&&(!n||j>n||g.forceCrop)){var p=l.min,q=l.max;p>h[j-1]||h[0]>q?(h=[],i=[]):(p>h[0]||h[j-1]>q)&&(b=this.cropData(g.xData,g.yData,p,q),h=b.xData,i=b.yData,k=b.start,c=!0)}for(f=h.length-1;f>=0;f--)d=h[f]-h[f-1],d>0&&(e===Q||e>d)?e=d:0>d&&g.requireSorting&&F(15);g.cropped=c,g.cropStart=k,g.processedXData=h,g.processedYData=i,null===m.pointRange&&(g.pointRange=e||1),g.closestPointRange=e},cropData:function(a,b,c,d){var e,f=a.length,g=0,h=f,i=o(this.cropShoulder,1);for(e=0;f>e;e++)if(a[e]>=c){g=rb(0,e-i);break}for(;f>e;e++)if(a[e]>d){h=e+i;break}return{xData:a.slice(g,h),yData:b.slice(g,h),start:g,end:h}},generatePoints:function(){var a,b,c,d,e=this,f=e.options,g=f.data,h=e.data,i=e.processedXData,j=e.processedYData,k=e.pointClass,l=i.length,m=e.cropStart||0,o=e.hasGroupedData,p=[];if(!h&&!o){var q=[];q.length=g.length,h=e.data=q}for(d=0;l>d;d++)b=m+d,o?p[d]=(new k).init(e,[i[d]].concat(n(j[d]))):(h[b]?c=h[b]:g[b]!==Q&&(h[b]=c=(new k).init(e,g[b],i[d])),p[d]=c);if(h&&(l!==(a=h.length)||o))for(d=0;a>d;d++)d!==m||o||(d+=l),h[d]&&(h[d].destroyElements(),h[d].plotX=Q);e.data=h,e.points=p},getExtremes:function(a){var b,c,d,e,f,g,h,i,j,k=this.xAxis,l=this.yAxis,m=this.processedXData,n=[],p=0,q=k.getExtremes(),r=q.min,s=q.max;for(a=a||this.stackedYData||this.processedYData,b=a.length,i=0;b>i;i++)if(g=m[i],h=a[i],c=null!==h&&h!==Q&&(!l.isLog||h.length||h>0),d=this.getExtremesFromAll||this.cropped||(m[i+1]||g)>=r&&s>=(m[i-1]||g),c&&d)if(j=h.length)for(;j--;)null!==h[j]&&(n[p++]=h[j]);else n[p++]=h;this.dataMin=o(e,B(n)),this.dataMax=o(f,C(n))},translate:function(){this.processedXData||this.processData(),this.generatePoints();var a,b=this,c=b.options,d=c.stacking,e=b.xAxis,f=e.categories,g=b.yAxis,i=b.points,j=i.length,k=!!b.modifyValue,m=c.pointPlacement,n="between"===m||h(m),p=c.threshold;for(a=0;j>a;a++){var q,r,s=i[a],t=s.x,u=s.y,v=s.low,w=d&&g.stacks[(b.negStacks&&p>u?"-":"")+b.stackKey];g.isLog&&0>=u&&(s.y=u=null),s.plotX=e.translate(t,0,0,0,1,m,"flags"===this.type),d&&b.visible&&w&&w[t]&&(q=w[t],r=q.points[b.index],v=r[0],u=r[1],0===v&&(v=o(p,g.min)),g.isLog&&0>=v&&(v=null),s.total=s.stackTotal=q.total,s.percentage=q.total&&100*(s.y/q.total),s.stackY=u,q.setOffset(b.pointXOffset||0,b.barW||0)),s.yBottom=l(v)?g.translate(v,0,1,0,1):null,k&&(u=b.modifyValue(u,s)),s.plotY="number"==typeof u&&1/0!==u?g.translate(u,0,1,0,1):Q,s.clientX=n?e.translate(t,0,0,0,1):s.plotX,s.negative=(p||0)>s.y,s.category=f&&f[s.x]!==Q?f[s.x]:s.x}b.getSegments()},animate:function(b){var c,d,e,g=this,h=g.chart,i=h.renderer,j=g.options.animation,k=h.clipBox,l=h.inverted;j&&!f(j)&&(j=Cc[g.type].animation),e="_sharedClip"+j.duration+j.easing,b?(c=h[e],d=h[e+"m"],c||(h[e]=c=i.clipRect(a(k,{width:0})),h[e+"m"]=d=i.clipRect(-99,l?-h.plotLeft:-h.plotTop,99,l?h.chartWidth:h.chartHeight)),g.group.clip(c),g.markerGroup.clip(d),g.sharedClipKey=e):(c=h[e],c&&(c.animate({width:h.plotSizeX},j),h[e+"m"].animate({width:h.plotSizeX+99},j)),g.animate=null,g.animationTimeout=setTimeout(function(){g.afterAnimate()},j.duration))},afterAnimate:function(){var a=this.chart,b=this.sharedClipKey,c=this.group;c&&this.options.clip!==!1&&(c.clip(a.clipRect),this.markerGroup.clip()),setTimeout(function(){b&&a[b]&&(a[b]=a[b].destroy(),a[b+"m"]=a[b+"m"].destroy())},100)},drawPoints:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n=this,p=n.points,q=n.chart,r=n.options,s=r.marker,t=n.pointAttr[""],u=n.markerGroup;if(s.enabled||n._hasPointMarkers)for(e=p.length;e--;)f=p[e],c=pb(f.plotX),d=f.plotY,j=f.graphic,k=f.marker||{},l=s.enabled&&k.enabled===Q||k.enabled,m=q.isInsidePlot(ob(c),d,q.inverted),l&&d!==Q&&!isNaN(d)&&null!==f.y?(b=f.pointAttr[f.selected?ac:$b]||t,g=b.r,h=o(k.symbol,n.symbol),i=0===h.indexOf("url"),j?j.attr({visibility:m?"inherit":Sb}).animate(a({x:c-g,y:d-g},j.symbolName?{width:2*g,height:2*g}:{})):m&&(g>0||i)&&(f.graphic=j=q.renderer.symbol(h,c-g,d-g,2*g,2*g).attr(b).add(u))):j&&(f.graphic=j.destroy())},convertAttribs:function(a,b,c,d){var e,f,g=this.pointAttrToOptions,h={};a=a||{},b=b||{},c=c||{},d=d||{};for(e in g)f=g[e],h[e]=o(a[f],b[e],c[e],d[e]);return h},getAttribs:function(){var b,c,d,e,f,g,h=this,i=h.options,j=Cc[h.type].marker?i.marker:i,k=j.states,m=k[_b],n=h.color,o={stroke:n,fill:n},p=h.points||[],q=[],r=h.pointAttrToOptions,s=h.hasPointSpecificOptions,t=i.negativeColor,u=j.lineColor,v=j.fillColor,w=i.turboThreshold;if(i.marker?(m.radius=m.radius||j.radius+2,m.lineWidth=m.lineWidth||j.lineWidth+1):m.color=m.color||Hc(m.color||n).brighten(m.brightness).get(),q[$b]=h.convertAttribs(j,o),rc([_b,ac],function(a){q[a]=h.convertAttribs(k[a],q[$b])}),h.pointAttr=q,c=p.length,!w||w>c||s)for(;c--;){if(d=p[c],j=d.options&&d.options.marker||d.options,j&&j.enabled===!1&&(j.radius=0),d.negative&&t&&(d.color=d.fillColor=t),s=i.colorByPoint||d.color,d.options)for(g in r)l(j[r[g]])&&(s=!0);s?(j=j||{},e=[],k=j.states||{},b=k[_b]=k[_b]||{},i.marker||(b.color=b.color||!d.options.color&&m.color||Hc(d.color).brighten(b.brightness||m.brightness).get()),f={color:d.color},v||(f.fillColor=d.color),u||(f.lineColor=d.color),e[$b]=h.convertAttribs(a(f,j),q[$b]),e[_b]=h.convertAttribs(k[_b],q[_b],e[$b]),e[ac]=h.convertAttribs(k[ac],q[ac],e[$b])):e=q,d.pointAttr=e}},destroy:function(){var a,b,c,d,e,f=this,g=f.chart,h=/AppleWebKit\/533/.test(yb),i=f.data||[];for(xc(f,"destroy"),wc(f),rc(f.axisTypes||[],function(a){e=f[a],e&&(k(e.series,f),e.isDirty=e.forceRedraw=!0)}),f.legendItem&&f.chart.legend.destroyItem(f),b=i.length;b--;)c=i[b],c&&c.destroy&&c.destroy();f.points=null,clearTimeout(f.animationTimeout),rc(["area","graph","dataLabelsGroup","group","markerGroup","tracker","graphNeg","areaNeg","posClip","negClip"],function(b){f[b]&&(a=h&&"group"===b?"hide":"destroy",f[b][a]())}),g.hoverSeries===f&&(g.hoverSeries=null),k(g.series,f);for(d in f)delete f[d]},getSegmentPath:function(a){var b=this,c=[],d=b.options.step;return rc(a,function(e,f){var g,h=e.plotX,i=e.plotY;b.getPointSpline?c.push.apply(c,b.getPointSpline(a,e,f)):(c.push(f?Yb:Xb),d&&f&&(g=a[f-1],"right"===d?c.push(g.plotX,i):"center"===d?c.push((g.plotX+h)/2,g.plotY,(g.plotX+h)/2,i):c.push(h,g.plotY)),c.push(e.plotX,e.plotY))}),c},getGraphPath:function(){var a,b=this,c=[],d=[];return rc(b.segments,function(e){a=b.getSegmentPath(e),e.length>1?c=c.concat(a):d.push(e[0])}),b.singlePoints=d,b.graphPath=c,c},drawGraph:function(){var a=this,b=this.options,c=[["graph",b.lineColor||this.color]],d=b.lineWidth,e=b.dashStyle,f="square"!==b.linecap,g=this.getGraphPath(),h=b.negativeColor;h&&c.push(["graphNeg",h]),rc(c,function(c,h){var i,j=c[0],k=a[j];k?(Ac(k),k.animate({d:g})):d&&g.length&&(i={stroke:c[1],"stroke-width":d,fill:Wb,zIndex:1},e?i.dashstyle=e:f&&(i["stroke-linecap"]=i["stroke-linejoin"]="round"),a[j]=a.chart.renderer.path(g).attr(i).add(a.group).shadow(!h&&b.shadow))})},clipNeg:function(){var a,b,c,d,e,f=this.options,g=this.chart,h=g.renderer,i=f.negativeColor||f.negativeFillColor,j=this.graph,k=this.area,l=this.posClip,m=this.negClip,n=g.chartWidth,o=g.chartHeight,p=rb(n,o),q=this.yAxis;i&&(j||k)&&(a=ob(q.toPixels(f.threshold||0,!0)),0>a&&(p-=a),d={x:0,y:0,width:p,height:a},e={x:0,y:a,width:p,height:p},g.inverted&&(d.height=e.y=g.plotWidth-a,h.isVML&&(d={x:g.plotWidth-a-g.plotLeft,y:0,width:n,height:o},e={x:a+g.plotLeft-n,y:0,width:g.plotLeft+a,height:n})),q.reversed?(b=e,c=d):(b=d,c=e),l?(l.animate(b),m.animate(c)):(this.posClip=l=h.clipRect(b),this.negClip=m=h.clipRect(c),j&&this.graphNeg&&(j.clip(l),this.graphNeg.clip(m)),k&&(k.clip(l),this.areaNeg.clip(m))))},invertGroups:function(){function a(){var a={width:b.yAxis.len,height:b.xAxis.len};rc(["group","markerGroup"],function(c){b[c]&&b[c].attr(a).invert()})}var b=this,c=b.chart;b.xAxis&&(vc(c,"resize",a),vc(b,"destroy",function(){wc(c,"resize",a)}),a(),b.invertGroups=a)},plotGroup:function(a,b,c,d,e){var f=this[a],g=!f;return g&&(this[a]=f=this.chart.renderer.g(b).attr({visibility:c,zIndex:d||.1}).add(e)),f[g?"attr":"animate"](this.getPlotBox()),f},getPlotBox:function(){return{translateX:this.xAxis?this.xAxis.left:this.chart.plotLeft,translateY:this.yAxis?this.yAxis.top:this.chart.plotTop,scaleX:1,scaleY:1}},render:function(){var a,b=this,c=b.chart,d=b.options,e=d.animation,f=e&&!!b.animate&&c.renderer.isSVG,g=b.visible?Ub:Sb,h=d.zIndex,i=b.hasRendered,j=c.seriesGroup;a=b.plotGroup("group","series",g,h,j),b.markerGroup=b.plotGroup("markerGroup","markers",g,h,j),f&&b.animate(!0),b.getAttribs(),a.inverted=b.isCartesian?c.inverted:!1,b.drawGraph&&(b.drawGraph(),b.clipNeg()),b.drawDataLabels&&b.drawDataLabels(),b.visible&&b.drawPoints(),b.drawTracker&&b.options.enableMouseTracking!==!1&&b.drawTracker(),c.inverted&&b.invertGroups(),d.clip===!1||b.sharedClipKey||i||a.clip(c.clipRect),f?b.animate():i||b.afterAnimate(),b.isDirty=b.isDirtyData=!1,b.hasRendered=!0},redraw:function(){var a=this,b=a.chart,c=a.isDirtyData,d=a.group,e=a.xAxis,f=a.yAxis;d&&(b.inverted&&d.attr({width:b.plotWidth,height:b.plotHeight}),d.animate({translateX:o(e&&e.left,b.plotLeft),translateY:o(f&&f.top,b.plotTop)})),a.translate(),a.setTooltipPoints(!0),a.render(),c&&xc(a,"updatedData")}},P.prototype={destroy:function(){D(this,this.axis)},render:function(a){var b=this.options,c=b.format,d=c?w(c,this):b.formatter.call(this);this.label?this.label.attr({text:d,visibility:Sb}):this.label=this.axis.chart.renderer.text(d,0,0,b.useHTML).css(b.style).attr({align:this.textAlign,rotation:b.rotation,visibility:Sb}).add(a)},setOffset:function(a,b){var c,d=this,e=d.axis,f=e.chart,g=f.inverted,h=this.isNegative,i=e.translate(this.percent?100:this.total,0,0,0,1),j=e.translate(0),k=tb(i-j),l=f.xAxis[0].translate(this.x)+a,m=f.plotHeight,n={x:g?h?i:i-k:l,y:g?m-l-b:h?m-i-k:m-i,width:g?k:b,height:g?b:k},o=this.label;o&&(o.align(this.alignOptions,null,n),c=o.alignAttr,o[this.options.crop===!1||f.isInsidePlot(c.x,c.y)?"show":"hide"](!0))}},N.prototype.buildStacks=function(){var a=this.series,b=o(this.options.reversedStacks,!0),c=a.length;if(!this.isXAxis){for(this.usePercentage=!1;c--;)a[b?c:a.length-c-1].setStackedPoints();if(this.usePercentage)for(c=0;a.length>c;c++)a[c].setPercentStacks()}},N.prototype.renderStackTotals=function(){var a,b,c,d=this,e=d.chart,f=e.renderer,g=d.stacks,h=d.stackTotalGroup;h||(d.stackTotalGroup=h=f.g("stack-labels").attr({visibility:Ub,zIndex:6}).add()),h.translate(e.plotLeft,e.plotTop);for(a in g){b=g[a];for(c in b)b[c].render(h)}},Zc.prototype.setStackedPoints=function(){if(this.options.stacking&&(this.visible===!0||this.chart.options.chart.ignoreHiddenSeries===!1)){var a,b,c,d,e,f,g,h=this,i=h.processedXData,j=h.processedYData,k=[],l=j.length,m=h.options,n=m.threshold,o=m.stack,p=m.stacking,q=h.stackKey,r="-"+q,s=h.negStacks,t=h.yAxis,u=t.stacks,v=t.oldStacks;for(e=0;l>e;e++)f=i[e],g=j[e],a=s&&n>g,d=a?r:q,u[d]||(u[d]={}),u[d][f]||(v[d]&&v[d][f]?(u[d][f]=v[d][f],u[d][f].total=null):u[d][f]=new P(t,t.options.stackLabels,a,f,o,p)),b=u[d][f],b.points[h.index]=[b.cum||0],"percent"===p?(c=a?q:r,s&&u[c]&&u[c][f]?(c=u[c][f],b.total=c.total=rb(c.total,b.total)+tb(g)||0):b.total=G(b.total+(tb(g)||0))):b.total=G(b.total+(g||0)),b.cum=(b.cum||0)+(g||0),b.points[h.index].push(b.cum),k[e]=b.cum;"percent"===p&&(t.usePercentage=!0),this.stackedYData=k,t.oldStacks={}}},Zc.prototype.setPercentStacks=function(){var a=this,b=a.stackKey,c=a.yAxis.stacks,d=a.processedXData;rc([b,"-"+b],function(b){for(var e,f,g,h,i=d.length;i--;)e=d[i],f=c[b]&&c[b][e],g=f&&f.points[a.index],g&&(h=f.total?100/f.total:0,g[0]=G(g[0]*h),g[1]=G(g[1]*h),a.stackedYData[i]=g[1])})},a(O.prototype,{addSeries:function(a,b,c){var d,e=this;return a&&(b=o(b,!0),xc(e,"addSeries",{options:a},function(){d=e.initSeries(a),e.isDirtyLegend=!0,e.linkSeries(),b&&e.redraw(c)})),d},addAxis:function(a,c,d,e){var f,g=c?"xAxis":"yAxis",h=this.options;f=new N(this,b(a,{index:this[g].length,isX:c})),h[g]=n(h[g]||{}),h[g].push(a),o(d,!0)&&this.redraw(e)},showLoading:function(b){var c=this,d=c.options,e=c.loadingDiv,f=d.loading;e||(c.loadingDiv=e=q(Pb,{className:Tb+"loading"},a(f.style,{zIndex:10,display:Wb}),c.container),c.loadingSpan=q("span",null,f.labelStyle,e)),c.loadingSpan.innerHTML=b||d.lang.loading,c.loadingShown||(p(e,{opacity:0,display:"",left:c.plotLeft+Vb,top:c.plotTop+Vb,width:c.plotWidth+Vb,height:c.plotHeight+Vb}),zc(e,{opacity:f.style.opacity},{duration:f.showDuration||0}),c.loadingShown=!0)},hideLoading:function(){var a=this.options,b=this.loadingDiv;b&&zc(b,{opacity:0},{duration:a.loading.hideDuration||100,complete:function(){p(b,{display:Wb})}}),this.loadingShown=!1}}),a(Yc.prototype,{update:function(a,b,c){var d,e=this,g=e.series,h=e.graphic,i=g.data,j=g.chart,k=g.options;b=o(b,!0),e.firePointEvent("update",{options:a},function(){e.applyOptions(a),f(a)&&(g.getAttribs(),h&&(a&&a.marker&&a.marker.symbol?e.graphic=h.destroy():h.attr(e.pointAttr[e.state||""])),a&&a.dataLabels&&e.dataLabel&&(e.dataLabel=e.dataLabel.destroy())),d=qc(e,i),g.updateParallelArrays(e,d),k.data[d]=e.options,g.isDirty=g.isDirtyData=!0,!g.fixedBox&&g.hasCartesianSeries&&(j.isDirtyBox=!0),"point"===k.legendType&&j.legend.destroyItem(e),b&&j.redraw(c)})},remove:function(a,b){var c,d=this,e=d.series,f=e.points,g=e.chart,h=e.data;H(b,g),a=o(a,!0),d.firePointEvent("remove",null,function(){c=qc(d,h),h.length===f.length&&f.splice(c,1),h.splice(c,1),e.options.data.splice(c,1),e.updateParallelArrays(d,"splice",c,1),d.destroy(),e.isDirty=!0,e.isDirtyData=!0,a&&g.redraw()})}}),a(Zc.prototype,{addPoint:function(a,b,c,d){var e,f,g,h,i=this,j=i.options,k=i.data,l=i.graph,m=i.area,n=i.chart,p=i.xAxis&&i.xAxis.names,q=l&&l.shift||0,r=j.data,s=i.xData;if(H(d,n),c&&rc([l,m,i.graphNeg,i.areaNeg],function(a){a&&(a.shift=q+1)}),m&&(m.isArea=!0),b=o(b,!0),e={series:i},i.pointClass.prototype.applyOptions.apply(e,[a]),g=e.x,h=s.length,i.requireSorting&&s[h-1]>g)for(f=!0;h&&s[h-1]>g;)h--;i.updateParallelArrays(e,"splice",h,0,0),i.updateParallelArrays(e,h),p&&(p[g]=e.name),r.splice(h,0,a),f&&(i.data.splice(h,0,null),i.processData()),"point"===j.legendType&&i.generatePoints(),c&&(k[0]&&k[0].remove?k[0].remove(!1):(k.shift(),i.updateParallelArrays(e,"shift"),r.shift())),i.isDirty=!0,i.isDirtyData=!0,b&&(i.getAttribs(),n.redraw())},remove:function(a,b){var c=this,d=c.chart;a=o(a,!0),c.isRemoving||(c.isRemoving=!0,xc(c,"remove",null,function(){c.destroy(),d.isDirtyLegend=d.isDirtyBox=!0,d.linkSeries(),a&&d.redraw(b)})),c.isRemoving=!1},update:function(c,d){var e,f=this.chart,g=this.userOptions,h=this.type,i=kc[h].prototype;c=b(g,{animation:!1,index:this.index,pointStart:this.xData[0]},{data:this.options.data},c),this.remove(!1);for(e in i)i.hasOwnProperty(e)&&(this[e]=Q);a(this,kc[c.type||h].prototype),this.init(f,c),o(d,!0)&&f.redraw(!1)}}),a(N.prototype,{update:function(c,d){var e=this.chart;c=e.options[this.coll][this.options.index]=b(this.userOptions,c),this.destroy(!0),this._addedPlotLB=this.userMin=this.userMax=Q,this.init(e,a(c,{events:Q})),e.isDirtyBox=!0,o(d,!0)&&e.redraw()},remove:function(a){for(var b=this.chart,c=this.coll,d=this.series,e=d.length;e--;)d[e]&&d[e].remove(!1);k(b.axes,this),k(b[c],this),b.options[c].splice(this.options.index,1),rc(b[c],function(a,b){a.options.index=b}),this.destroy(),b.isDirtyBox=!0,o(a,!0)&&b.redraw()},setTitle:function(a,b){this.update({title:a},b)},setCategories:function(a,b){this.update({categories:a},b)}});var $c=r(Zc);kc.line=$c,Cc.area=b(Dc,{threshold:0});var _c=r(Zc,{type:"area",getSegments:function(){var a,b,c,d,e,f=[],g=[],h=[],i=this.xAxis,j=this.yAxis,k=j.stacks[this.stackKey],l={},m=this.points,n=this.options.connectNulls;if(this.options.stacking&&!this.cropped){for(d=0;m.length>d;d++)l[m[d].x]=m[d];for(e in k)null!==k[e].total&&h.push(+e);h.sort(function(a,b){return a-b}),rc(h,function(d){(!n||l[d]&&null!==l[d].y)&&(l[d]?g.push(l[d]):(a=i.translate(d),c=k[d].percent?k[d].total?100*k[d].cum/k[d].total:0:k[d].cum,b=j.toPixels(c,!0),g.push({y:null,plotX:a,clientX:a,plotY:b,yBottom:b,onMouseOver:Lb})))}),g.length&&f.push(g)}else Zc.prototype.getSegments.call(this),f=this.segments;this.segments=f},getSegmentPath:function(a){var b,c,d=Zc.prototype.getSegmentPath.call(this,a),e=[].concat(d),f=this.options,g=d.length,h=this.yAxis.getThreshold(f.threshold);if(3===g&&e.push(Yb,d[1],d[2]),f.stacking&&!this.closedStacks)for(b=a.length-1;b>=0;b--)c=o(a[b].yBottom,h),a.length-1>b&&f.step&&e.push(a[b+1].plotX,c),e.push(a[b].plotX,c);else this.closeSegment(e,a,h);return this.areaPath=this.areaPath.concat(e),d},closeSegment:function(a,b,c){a.push(Yb,b[b.length-1].plotX,c,Yb,b[0].plotX,c)},drawGraph:function(){this.areaPath=[],Zc.prototype.drawGraph.apply(this);var a=this,b=this.areaPath,c=this.options,d=c.negativeColor,e=c.negativeFillColor,f=[["area",this.color,c.fillColor]];(d||e)&&f.push(["areaNeg",d,e]),rc(f,function(d){var e=d[0],f=a[e];f?f.animate({d:b}):a[e]=a.chart.renderer.path(b).attr({fill:o(d[2],Hc(d[1]).setOpacity(o(c.fillOpacity,.75)).get()),zIndex:0}).add(a.group)})},drawLegendSymbol:Wc.drawRectangle});kc.area=_c,Cc.spline=b(Dc);var ad=r(Zc,{type:"spline",getPointSpline:function(a,b,c){var d,e,f,g,h,i=1.5,j=i+1,k=b.plotX,l=b.plotY,m=a[c-1],n=a[c+1];if(m&&n){var o,p=m.plotX,q=m.plotY,r=n.plotX,s=n.plotY;d=(i*k+p)/j,e=(i*l+q)/j,f=(i*k+r)/j,g=(i*l+s)/j,o=(g-e)*(f-k)/(f-d)+l-g,e+=o,g+=o,e>q&&e>l?(e=rb(q,l),g=2*l-e):q>e&&l>e&&(e=sb(q,l),g=2*l-e),g>s&&g>l?(g=rb(s,l),e=2*l-g):s>g&&l>g&&(g=sb(s,l),e=2*l-g),b.rightContX=f,b.rightContY=g}return c?(h=["C",m.rightContX||m.plotX,m.rightContY||m.plotY,d||k,e||l,k,l],m.rightContX=m.rightContY=null):h=[Xb,k,l],h}});kc.spline=ad,Cc.areaspline=b(Cc.area);var bd=_c.prototype,cd=r(ad,{type:"areaspline",closedStacks:!0,getSegmentPath:bd.getSegmentPath,closeSegment:bd.closeSegment,drawGraph:bd.drawGraph,drawLegendSymbol:Wc.drawRectangle});kc.areaspline=cd,Cc.column=b(Dc,{borderColor:"#FFFFFF",borderWidth:1,borderRadius:0,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{brightness:.1,shadow:!1},select:{color:"#C0C0C0",borderColor:"#000000",shadow:!1}},dataLabels:{align:null,verticalAlign:null,y:null},stickyTracking:!1,threshold:0});var dd=r(Zc,{type:"column",pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color",r:"borderRadius"},cropShoulder:0,trackerGroups:["group","dataLabelsGroup"],negStacks:!0,init:function(){Zc.prototype.init.apply(this,arguments);var a=this,b=a.chart;b.hasRendered&&rc(b.series,function(b){b.type===a.type&&(b.isDirty=!0)})},getColumnMetrics:function(){var a,b,c=this,d=c.options,e=c.xAxis,f=c.yAxis,g=e.reversed,h={},i=0;d.grouping===!1?i=1:rc(c.chart.series,function(d){var e=d.options,g=d.yAxis;d.type===c.type&&d.visible&&f.len===g.len&&f.pos===g.pos&&(e.stacking?(a=d.stackKey,h[a]===Q&&(h[a]=i++),b=h[a]):e.grouping!==!1&&(b=i++),d.columnIndex=b)});var j=sb(tb(e.transA)*(e.ordinalSlope||d.pointRange||e.closestPointRange||e.tickInterval||1),e.len),k=j*d.groupPadding,m=j-2*k,n=m/i,p=d.pointWidth,q=l(p)?(n-p)/2:n*d.pointPadding,r=o(p,n-2*q),s=(g?i-(c.columnIndex||0):c.columnIndex)||0,t=q+(k+s*n-j/2)*(g?-1:1);return c.columnMetrics={width:r,offset:t}},translate:function(){var a=this,b=a.chart,c=a.options,d=c.borderWidth,e=a.yAxis,f=c.threshold,g=a.translatedThreshold=e.getThreshold(f),h=o(c.minPointLength,5),i=a.getColumnMetrics(),j=i.width,k=a.barW=qb(rb(j,1+2*d)),l=a.pointXOffset=i.offset,m=-(d%2?.5:0),n=d%2?.5:1;b.renderer.isVML&&b.inverted&&(n+=1),Zc.prototype.translate.apply(a),rc(a.points,function(a){var b,c,d,f,i=o(a.yBottom,g),p=sb(rb(-999-i,a.plotY),e.len+999+i),q=a.plotX+l,r=k,s=sb(p,i),t=rb(p,i)-s;h>tb(t)&&h&&(t=h,s=ob(tb(s-g)>h?i-h:g-(g>=e.translate(a.y,0,1,0,1)?h:0))),a.barX=q,a.pointWidth=j,f=.5>tb(q),b=ob(q+r)+m,q=ob(q)+m,r=b-q,d=.5>tb(s),c=ob(s+t)+n,s=ob(s)+n,t=c-s,f&&(q+=1,r-=1),d&&(s-=1,t+=1),a.shapeType="rect",a.shapeArgs={x:q,y:s,width:r,height:t}})},getSymbol:Lb,drawLegendSymbol:Wc.drawRectangle,drawGraph:Lb,drawPoints:function(){var a,c=this,d=this.chart,e=c.options,f=d.renderer,g=e.animationLimit||250;rc(c.points,function(d){var h=d.plotY,i=d.graphic;h===Q||isNaN(h)||null===d.y?i&&(d.graphic=i.destroy()):(a=d.shapeArgs,i?(Ac(i),i[g>c.points.length?"animate":"attr"](b(a))):d.graphic=i=f[d.shapeType](a).attr(d.pointAttr[d.selected?ac:$b]).add(c.group).shadow(e.shadow,null,e.stacking&&!e.borderRadius))
})},animate:function(a){var b,c=this,d=this.yAxis,e=c.options,f=this.chart.inverted,g={};Gb&&(a?(g.scaleY=.001,b=sb(d.pos+d.len,rb(d.pos,d.toPixels(e.threshold))),f?g.translateX=b-d.len:g.translateY=b,c.group.attr(g)):(g.scaleY=1,g[f?"translateX":"translateY"]=d.pos,c.group.animate(g,c.options.animation),c.animate=null))},remove:function(){var a=this,b=a.chart;b.hasRendered&&rc(b.series,function(b){b.type===a.type&&(b.isDirty=!0)}),Zc.prototype.remove.apply(a,arguments)}});kc.column=dd,Cc.bar=b(Cc.column);var ed=r(dd,{type:"bar",inverted:!0});kc.bar=ed,Cc.scatter=b(Dc,{lineWidth:0,tooltip:{headerFormat:'<span style="font-size: 10px; color:{series.color}">{series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>",followPointer:!0},stickyTracking:!1});var fd=r(Zc,{type:"scatter",sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["markerGroup"],takeOrdinalPosition:!1,singularTooltips:!0,drawGraph:function(){this.options.lineWidth&&Zc.prototype.drawGraph.call(this)}});kc.scatter=fd,Cc.pie=b(Dc,{borderColor:"#FFFFFF",borderWidth:1,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{distance:30,enabled:!0,formatter:function(){return this.point.name}},ignoreHiddenPoint:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,states:{hover:{brightness:.1,shadow:!1}},stickyTracking:!1,tooltip:{followPointer:!0}});var gd=r(Yc,{init:function(){Yc.prototype.init.apply(this,arguments);var b,c=this;return 0>c.y&&(c.y=null),a(c,{visible:c.visible!==!1,name:o(c.name,"Slice")}),b=function(a){c.slice("select"===a.type)},vc(c,"select",b),vc(c,"unselect",b),c},setVisible:function(a){var b=this,c=b.series,d=c.chart;b.visible=b.options.visible=a=a===Q?!b.visible:a,c.options.data[qc(b,c.data)]=b.options,rc(["graphic","dataLabel","connector","shadowGroup"],function(c){b[c]&&b[c][a?"show":"hide"](!0)}),b.legendItem&&d.legend.colorizeItem(b,a),!c.isDirty&&c.options.ignoreHiddenPoint&&(c.isDirty=!0,d.redraw())},slice:function(a,b,c){var d,e=this,f=e.series,g=f.chart;H(c,g),b=o(b,!0),e.sliced=e.options.sliced=a=l(a)?a:!e.sliced,f.options.data[qc(e,f.data)]=e.options,d=a?e.slicedTranslation:{translateX:0,translateY:0},e.graphic.animate(d),e.shadowGroup&&e.shadowGroup.animate(d)}}),hd={type:"pie",isCartesian:!1,pointClass:gd,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","dataLabelsGroup"],axisTypes:[],pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color"},singularTooltips:!0,getColor:Lb,animate:function(a){var b=this,c=b.points,d=b.startAngleRad;a||(rc(c,function(a){var c=a.graphic,e=a.shapeArgs;c&&(c.attr({r:b.center[3]/2,start:d,end:d}),c.animate({r:e.r,start:e.start,end:e.end},b.options.animation))}),b.animate=null)},setData:function(a,b,c,d){Zc.prototype.setData.call(this,a,!1,c,d),this.processData(),this.generatePoints(),o(b,!0)&&this.chart.redraw(c)},generatePoints:function(){var a,b,c,d,e=0,f=this.options.ignoreHiddenPoint;for(Zc.prototype.generatePoints.call(this),b=this.points,c=b.length,a=0;c>a;a++)d=b[a],e+=f&&!d.visible?0:d.y;for(this.total=e,a=0;c>a;a++)d=b[a],d.percentage=e>0?100*(d.y/e):0,d.total=e},translate:function(a){this.generatePoints();var b,c,d,e,f,g,h,i=this,j=0,k=1e3,l=i.options,m=l.slicedOffset,n=m+l.borderWidth,p=l.startAngle||0,q=i.startAngleRad=wb/180*(p-90),r=i.endAngleRad=wb/180*(o(l.endAngle,p+360)-90),s=r-q,t=i.points,u=l.dataLabels.distance,v=l.ignoreHiddenPoint,w=t.length;for(a||(i.center=a=i.getCenter()),i.getX=function(b,c){return d=nb.asin(sb((b-a[1])/(a[2]/2+u),1)),a[0]+(c?-1:1)*ub(d)*(a[2]/2+u)},g=0;w>g;g++)h=t[g],b=q+j*s,(!v||h.visible)&&(j+=h.percentage/100),c=q+j*s,h.shapeType="arc",h.shapeArgs={x:a[0],y:a[1],r:a[2]/2,innerR:a[3]/2,start:ob(b*k)/k,end:ob(c*k)/k},d=(c+b)/2,d>1.5*wb?d-=2*wb:-wb/2>d&&(d+=2*wb),h.slicedTranslation={translateX:ob(ub(d)*m),translateY:ob(vb(d)*m)},e=ub(d)*a[2]/2,f=vb(d)*a[2]/2,h.tooltipPos=[a[0]+.7*e,a[1]+.7*f],h.half=-wb/2>d||d>wb/2?1:0,h.angle=d,n=sb(n,u/2),h.labelPos=[a[0]+e+ub(d)*u,a[1]+f+vb(d)*u,a[0]+e+ub(d)*n,a[1]+f+vb(d)*n,a[0]+e,a[1]+f,0>u?"center":h.half?"right":"left",d]},drawGraph:null,drawPoints:function(){var b,c,d,e,f=this,g=f.chart,h=g.renderer,i=f.options.shadow;i&&!f.shadowGroup&&(f.shadowGroup=h.g("shadow").add(f.group)),rc(f.points,function(g){c=g.graphic,e=g.shapeArgs,d=g.shadowGroup,i&&!d&&(d=g.shadowGroup=h.g("shadow").add(f.shadowGroup)),b=g.sliced?g.slicedTranslation:{translateX:0,translateY:0},d&&d.attr(b),c?c.animate(a(e,b)):g.graphic=c=h[g.shapeType](e).setRadialReference(f.center).attr(g.pointAttr[g.selected?ac:$b]).attr({"stroke-linejoin":"round"}).attr(b).add(f.group).shadow(i,d),void 0!==g.visible&&g.setVisible(g.visible)})},sortByAngle:function(a,b){a.sort(function(a,c){return void 0!==a.angle&&(c.angle-a.angle)*b})},drawLegendSymbol:Wc.drawRectangle,getCenter:Xc.getCenter,getSymbol:Lb};hd=r(Zc,hd),kc.pie=hd,Zc.prototype.drawDataLabels=function(){var c,d,e,f,g=this,h=g.options,i=h.cursor,j=h.dataLabels,k=g.points;(j.enabled||g._hasPointLabels)&&(g.dlProcessOptions&&g.dlProcessOptions(j),f=g.plotGroup("dataLabelsGroup","data-labels",g.visible?Ub:Sb,j.zIndex||6),d=j,rc(k,function(h){var k,m,n,p,q,r=h.dataLabel,s=h.connector,t=!0;if(c=h.options&&h.options.dataLabels,k=o(c&&c.enabled,d.enabled),r&&!k)h.dataLabel=r.destroy();else if(k){if(j=b(d,c),q=j.rotation,m=h.getLabelConfig(),e=j.format?w(j.format,m):j.formatter.call(m,j),j.style.color=o(j.color,j.style.color,g.color,"black"),r)l(e)?(r.attr({text:e}),t=!1):(h.dataLabel=r=r.destroy(),s&&(h.connector=s.destroy()));else if(l(e)){n={fill:j.backgroundColor,stroke:j.borderColor,"stroke-width":j.borderWidth,r:j.borderRadius||0,rotation:q,padding:j.padding,zIndex:1};for(p in n)n[p]===Q&&delete n[p];r=h.dataLabel=g.chart.renderer[q?"text":"label"](e,0,-999,null,null,null,j.useHTML).attr(n).css(a(j.style,i&&{cursor:i})).add(f).shadow(j.shadow)}r&&g.alignDataLabel(h,r,j,null,t)}}))},Zc.prototype.alignDataLabel=function(b,c,d,e,f){var g,h=this.chart,i=h.inverted,j=o(b.plotX,-999),k=o(b.plotY,-999),l=c.getBBox(),m=this.visible&&(b.series.forceDL||h.isInsidePlot(j,ob(k),i)||e&&h.isInsidePlot(j,i?e.x+1:e.y+e.height-1,i));m&&(e=a({x:i?h.plotWidth-k:j,y:ob(i?h.plotHeight-j:k),width:0,height:0},e),a(d,{width:l.width,height:l.height}),d.rotation?(g={align:d.align,x:e.x+d.x+e.width/2,y:e.y+d.y+e.height/2},c[f?"attr":"animate"](g)):(c.align(d,null,e),g=c.alignAttr,"justify"===o(d.overflow,"justify")?this.justifyDataLabel(c,d,g,l,e,f):o(d.crop,!0)&&(m=h.isInsidePlot(g.x,g.y)&&h.isInsidePlot(g.x+l.width,g.y+l.height)))),m||(c.attr({y:-999}),c.placed=!1)},Zc.prototype.justifyDataLabel=function(a,b,c,d,e,f){var g,h,i=this.chart,j=b.align,k=b.verticalAlign;g=c.x,0>g&&("right"===j?b.align="left":b.x=-g,h=!0),g=c.x+d.width,g>i.plotWidth&&("left"===j?b.align="right":b.x=i.plotWidth-g,h=!0),g=c.y,0>g&&("bottom"===k?b.verticalAlign="top":b.y=-g,h=!0),g=c.y+d.height,g>i.plotHeight&&("top"===k?b.verticalAlign="bottom":b.y=i.plotHeight-g,h=!0),h&&(a.placed=!f,a.align(b,null,e))},kc.pie&&(kc.pie.prototype.drawDataLabels=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=this,p=n.data,q=n.chart,r=n.options.dataLabels,s=o(r.connectorPadding,10),t=o(r.connectorWidth,1),u=q.plotWidth,v=q.plotHeight,w=o(r.softConnector,!0),x=r.distance,y=n.center,z=y[2]/2,A=y[1],B=x>0,D=[[],[]],E=[0,0,0,0],F=function(a,b){return b.y-a.y};if(n.visible&&(r.enabled||n._hasPointLabels)){for(Zc.prototype.drawDataLabels.apply(n),rc(p,function(a){a.dataLabel&&a.visible&&D[a.half].push(a)}),l=0;!g&&p[l];)g=p[l]&&p[l].dataLabel&&(p[l].dataLabel.getBBox().height||21),l++;for(l=2;l--;){var G,H,I,J=[],K=[],L=D[l],M=L.length;if(n.sortByAngle(L,l-.5),x>0){for(H=A-z-x;A+z+x>=H;H+=g)J.push(H);if(G=J.length,M>G){for(k=[].concat(L),k.sort(F),m=M;m--;)k[m].rank=m;for(m=M;m--;)L[m].rank>=G&&L.splice(m,1);M=L.length}for(m=0;M>m;m++){a=L[m],f=a.labelPos;var N,O,P=9999;for(O=0;G>O;O++)N=tb(J[O]-f[1]),P>N&&(P=N,I=O);if(m>I&&null!==J[m])I=m;else if(M-m+I>G&&null!==J[m])for(I=G-M+m;null===J[I];)I++;else for(;null===J[I];)I++;K.push({i:I,y:J[I]}),J[I]=null}K.sort(F)}for(m=0;M>m;m++){var Q,R;a=L[m],f=a.labelPos,d=a.dataLabel,j=a.visible===!1?Sb:Ub,R=f[1],x>0?(Q=K.pop(),I=Q.i,i=Q.y,(R>i&&null!==J[I+1]||i>R&&null!==J[I-1])&&(i=R)):i=R,h=r.justify?y[0]+(l?-1:1)*(z+x):n.getX(0===I||I===J.length-1?R:i,l),d._attr={visibility:j,align:f[6]},d._pos={x:h+r.x+({left:s,right:-s}[f[6]]||0),y:i+r.y-10},d.connX=h,d.connY=i,null===this.options.size&&(e=d.width,s>h-e?E[3]=rb(ob(e-h+s),E[3]):h+e>u-s&&(E[1]=rb(ob(h+e-u+s),E[1])),0>i-g/2?E[0]=rb(ob(-i+g/2),E[0]):i+g/2>v&&(E[2]=rb(ob(i+g/2-v),E[2])))}}(0===C(E)||this.verifyDataLabelOverflow(E))&&(this.placeDataLabels(),B&&t&&rc(this.points,function(a){b=a.connector,f=a.labelPos,d=a.dataLabel,d&&d._pos?(j=d._attr.visibility,h=d.connX,i=d.connY,c=w?[Xb,h+("left"===f[6]?5:-5),i,"C",h,i,2*f[2]-f[4],2*f[3]-f[5],f[2],f[3],Yb,f[4],f[5]]:[Xb,h+("left"===f[6]?5:-5),i,Yb,f[2],f[3],Yb,f[4],f[5]],b?(b.animate({d:c}),b.attr("visibility",j)):a.connector=b=n.chart.renderer.path(c).attr({"stroke-width":t,stroke:r.connectorColor||a.color||"#606060",visibility:j}).add(n.group)):b&&(a.connector=b.destroy())}))}},kc.pie.prototype.placeDataLabels=function(){rc(this.points,function(a){var b,c=a.dataLabel;c&&(b=c._pos,b?(c.attr(c._attr),c[c.moved?"animate":"attr"](b),c.moved=!0):c&&c.attr({y:-999}))})},kc.pie.prototype.alignDataLabel=Lb,kc.pie.prototype.verifyDataLabelOverflow=function(a){var b,c=this.center,d=this.options,e=d.center,f=d.minSize||80,g=f;return null!==e[0]?g=rb(c[2]-rb(a[1],a[3]),f):(g=rb(c[2]-a[1]-a[3],f),c[0]+=(a[3]-a[1])/2),null!==e[1]?g=rb(sb(g,c[2]-rb(a[0],a[2])),f):(g=rb(sb(g,c[2]-a[0]-a[2]),f),c[1]+=(a[0]-a[2])/2),c[2]>g?(c[2]=g,this.translate(c),rc(this.points,function(a){a.dataLabel&&(a.dataLabel._pos=null)}),this.drawDataLabels&&this.drawDataLabels()):b=!0,b}),kc.column&&(kc.column.prototype.alignDataLabel=function(a,c,d,e,f){var g=this.chart,h=g.inverted,i=a.dlBox||a.shapeArgs,j=a.below||a.plotY>o(this.translatedThreshold,g.plotSizeY),k=o(d.inside,!!this.options.stacking);i&&(e=b(i),h&&(e={x:g.plotWidth-e.y-e.height,y:g.plotHeight-e.x-e.width,width:e.height,height:e.width}),k||(h?(e.x+=j?0:e.width,e.width=0):(e.y+=j?e.height:0,e.height=0))),d.align=o(d.align,!h||k?"center":j?"right":"left"),d.verticalAlign=o(d.verticalAlign,h||k?"middle":j?"top":"bottom"),Zc.prototype.alignDataLabel.call(this,a,c,d,e,f)});var id=lc.TrackerMixin={drawTrackerPoint:function(){var a=this,b=a.chart,c=b.pointer,d=a.options.cursor,e=d&&{cursor:d},f=function(c){var d,e=c.target;for(b.hoverSeries!==a&&a.onMouseOver();e&&!d;)d=e.point,e=e.parentNode;d!==Q&&d!==b.hoverPoint&&d.onMouseOver(c)};rc(a.points,function(a){a.graphic&&(a.graphic.element.point=a),a.dataLabel&&(a.dataLabel.element.point=a)}),a._hasTracking||(rc(a.trackerGroups,function(b){a[b]&&(a[b].addClass(Tb+"tracker").on("mouseover",f).on("mouseout",function(a){c.onTrackerMouseOut(a)}).css(e),S&&a[b].on("touchstart",f))}),a._hasTracking=!0)},drawTrackerGraph:function(){var a,b,c=this,d=c.options,e=d.trackByArea,f=[].concat(e?c.areaPath:c.graphPath),g=f.length,h=c.chart,i=h.pointer,j=h.renderer,k=h.options.tooltip.snap,l=c.tracker,m=d.cursor,n=m&&{cursor:m},o=c.singlePoints,p=function(){h.hoverSeries!==c&&c.onMouseOver()},q="rgba(192,192,192,"+(Gb?1e-4:.002)+")";if(g&&!e)for(b=g+1;b--;)f[b]===Xb&&f.splice(b+1,0,f[b+1]-k,f[b+2],Yb),(b&&f[b]===Xb||b===g)&&f.splice(b,0,Yb,f[b-2]+k,f[b-1]);for(b=0;o.length>b;b++)a=o[b],f.push(Xb,a.plotX-k,a.plotY,Yb,a.plotX+k,a.plotY);l?l.attr({d:f}):(c.tracker=j.path(f).attr({"stroke-linejoin":"round",visibility:c.visible?Ub:Sb,stroke:q,fill:e?q:Wb,"stroke-width":d.lineWidth+(e?0:2*k),zIndex:2}).add(c.group),rc([c.tracker,c.markerGroup],function(a){a.addClass(Tb+"tracker").on("mouseover",p).on("mouseout",function(a){i.onTrackerMouseOut(a)}).css(n),S&&a.on("touchstart",p)}))}};kc.column&&(dd.prototype.drawTracker=id.drawTrackerPoint),kc.pie&&(kc.pie.prototype.drawTracker=id.drawTrackerPoint),kc.scatter&&(fd.prototype.drawTracker=id.drawTrackerPoint),a(Vc.prototype,{setItemEvents:function(a,b,c,d,e){var f=this;(c?b:a.legendGroup).on("mouseover",function(){a.setState(_b),b.css(f.options.itemHoverStyle)}).on("mouseout",function(){b.css(a.visible?d:e),a.setState()}).on("click",function(b){var c="legendItemClick",d=function(){a.setVisible()};b={browserEvent:b},a.firePointEvent?a.firePointEvent(c,b,d):xc(a,c,b,d)})},createCheckboxForItem:function(a){var b=this;a.checkbox=q("input",{type:"checkbox",checked:a.selected,defaultChecked:a.selected},b.options.itemCheckboxStyle,b.chart.container),vc(a.checkbox,"click",function(b){var c=b.target;xc(a,"checkboxClick",{checked:c.checked},function(){a.select()})})}}),U.legend.itemStyle.cursor="pointer",a(O.prototype,{showResetZoom:function(){var a=this,b=U.lang,c=a.options.chart.resetZoomButton,d=c.theme,e=d.states,f="chart"===c.relativeTo?null:"plotBox";this.resetZoomButton=a.renderer.button(b.resetZoom,null,null,function(){a.zoomOut()},d,e&&e.hover).attr({align:c.position.align,title:b.resetZoomTitle}).add().align(c.position,!1,f)},zoomOut:function(){var a=this;xc(a,"selection",{resetSelection:!0},function(){a.zoom()})},zoom:function(a){var b,c,d=this,e=d.pointer,g=!1;!a||a.resetSelection?rc(d.axes,function(a){b=a.zoom()}):rc(a.xAxis.concat(a.yAxis),function(a){var c=a.axis,d=c.isXAxis;(e[d?"zoomX":"zoomY"]||e[d?"pinchX":"pinchY"])&&(b=c.zoom(a.min,a.max),c.displayBtn&&(g=!0))}),c=d.resetZoomButton,g&&!c?d.showResetZoom():!g&&f(c)&&(d.resetZoomButton=c.destroy()),b&&d.redraw(o(d.options.chart.animation,a&&a.animation,100>d.pointCount))},pan:function(a,b){var c,d=this,e=d.hoverPoints;e&&rc(e,function(a){a.setState()}),rc("xy"===b?[1,0]:[1],function(b){var e=a[b?"chartX":"chartY"],f=d[b?"xAxis":"yAxis"][0],g=d[b?"mouseDownX":"mouseDownY"],h=(f.pointRange||0)/2,i=f.getExtremes(),j=f.toValue(g-e,!0)+h,k=f.toValue(g+d[b?"plotWidth":"plotHeight"]-e,!0)-h;f.series.length&&j>sb(i.dataMin,i.min)&&rb(i.dataMax,i.max)>k&&(f.setExtremes(j,k,!1,!1,{trigger:"pan"}),c=!0),d[b?"mouseDownX":"mouseDownY"]=e}),c&&d.redraw(!1),p(d.container,{cursor:"move"})}}),a(Yc.prototype,{select:function(a,b){var c=this,d=c.series,e=d.chart;a=o(a,!c.selected),c.firePointEvent(a?"select":"unselect",{accumulate:b},function(){c.selected=c.options.selected=a,d.options.data[qc(c,d.data)]=c.options,c.setState(a&&ac),b||rc(e.getSelectedPoints(),function(a){a.selected&&a!==c&&(a.selected=a.options.selected=!1,d.options.data[qc(a,d.data)]=a.options,a.setState($b),a.firePointEvent("unselect"))})})},onMouseOver:function(a){var b=this,c=b.series,d=c.chart,e=d.tooltip,f=d.hoverPoint;f&&f!==b&&f.onMouseOut(),b.firePointEvent("mouseOver"),!e||e.shared&&!c.noSharedTooltip||e.refresh(b,a),b.setState(_b),d.hoverPoint=b},onMouseOut:function(){var a=this.series.chart,b=a.hoverPoints;b&&-1!==qc(this,b)||(this.firePointEvent("mouseOut"),this.setState(),a.hoverPoint=null)},firePointEvent:function(a,b,c){var d=this,e=this.series,f=e.options;(f.point.events[a]||d.options&&d.options.events&&d.options.events[a])&&this.importEvents(),"click"===a&&f.allowPointSelect&&(c=function(a){d.select(null,a.ctrlKey||a.metaKey||a.shiftKey)}),xc(this,a,b,c)},importEvents:function(){if(!this.hasImportedEvents){var a,c=this,d=b(c.series.options.point,c.options),e=d.events;c.events=e;for(a in e)vc(c,a,e[a]);this.hasImportedEvents=!0}},setState:function(a,c){var d,e,f=this,g=f.plotX,h=f.plotY,i=f.series,j=i.options.states,k=Cc[i.type].marker&&i.options.marker,l=k&&!k.enabled,m=k&&k.states[a],n=m&&m.enabled===!1,o=i.stateMarkerGraphic,p=f.marker||{},q=i.chart,r=f.pointAttr;a=a||$b,c=c&&o,a===f.state&&!c||f.selected&&a!==ac||j[a]&&j[a].enabled===!1||a&&(n||l&&!m.enabled)||a&&p.states&&p.states[a]&&p.states[a].enabled===!1||(f.graphic?(d=k&&f.graphic.symbolName&&r[a].r,f.graphic.attr(b(r[a],d?{x:g-d,y:h-d,width:2*d,height:2*d}:{}))):(a&&m&&(d=m.radius,e=p.symbol||i.symbol,o&&o.currentSymbol!==e&&(o=o.destroy()),o?o[c?"animate":"attr"]({x:g-d,y:h-d}):(i.stateMarkerGraphic=o=q.renderer.symbol(e,g-d,h-d,2*d,2*d).attr(r[a]).add(i.markerGroup),o.currentSymbol=e)),o&&o[a&&q.isInsidePlot(g,h,q.inverted)?"show":"hide"]()),f.state=a)}}),a(Zc.prototype,{onMouseOver:function(){var a=this,b=a.chart,c=b.hoverSeries;c&&c!==a&&c.onMouseOut(),a.options.events.mouseOver&&xc(a,"mouseOver"),a.setState(_b),b.hoverSeries=a},onMouseOut:function(){var a=this,b=a.options,c=a.chart,d=c.tooltip,e=c.hoverPoint;e&&e.onMouseOut(),a&&b.events.mouseOut&&xc(a,"mouseOut"),!d||b.stickyTracking||d.shared&&!a.noSharedTooltip||d.hide(),a.setState(),c.hoverSeries=null},setState:function(a){var b,c=this,d=c.options,e=c.graph,f=c.graphNeg,g=d.states,h=d.lineWidth;if(a=a||$b,c.state!==a){if(c.state=a,g[a]&&g[a].enabled===!1)return;a&&(h=g[a].lineWidth||h+1),e&&!e.dashstyle&&(b={"stroke-width":h},e.attr(b),f&&f.attr(b))}},setVisible:function(a,b){var c,d=this,e=d.chart,f=d.legendItem,g=e.options.chart.ignoreHiddenSeries,h=d.visible;d.visible=a=d.userOptions.visible=a===Q?!h:a,c=a?"show":"hide",rc(["group","dataLabelsGroup","markerGroup","tracker"],function(a){d[a]&&d[a][c]()}),e.hoverSeries===d&&d.onMouseOut(),f&&e.legend.colorizeItem(d,a),d.isDirty=!0,d.options.stacking&&rc(e.series,function(a){a.options.stacking&&a.visible&&(a.isDirty=!0)}),rc(d.linkedSeries,function(b){b.setVisible(a,!1)}),g&&(e.isDirtyBox=!0),b!==!1&&e.redraw(),xc(d,c)},setTooltipPoints:function(a){var b,c,d,e,f,g,h,i=this,j=[],k=i.xAxis,l=k&&k.getExtremes(),m=k?k.tooltipLen||k.len:i.chart.plotSizeX,n=[];if(i.options.enableMouseTracking!==!1&&!i.singularTooltips){for(a&&(i.tooltipPoints=null),rc(i.segments||i.points,function(a){j=j.concat(a)}),k&&k.reversed&&(j=j.reverse()),i.orderTooltipPoints&&i.orderTooltipPoints(j),b=j.length,h=0;b>h;h++)if(e=j[h],f=e.x,f>=l.min&&l.max>=f)for(g=j[h+1],c=d===Q?0:d+1,d=j[h+1]?sb(rb(0,pb((e.clientX+(g?g.wrappedClientX||g.clientX:m))/2)),m):m;c>=0&&d>=c;)n[c++]=e;i.tooltipPoints=n}},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},select:function(a){var b=this;b.selected=a=a===Q?!b.selected:a,b.checkbox&&(b.checkbox.checked=a),xc(b,a?"select":"unselect")},drawTracker:id.drawTrackerGraph}),a(lc,{Axis:N,Chart:O,Color:Hc,Point:Yc,Tick:M,Renderer:R,Series:Zc,SVGElement:L,SVGRenderer:Ic,arrayMin:B,arrayMax:C,charts:Mb,dateFormat:V,format:w,pathAnim:X,getOptions:K,hasBidiBug:Hb,isTouchDevice:Eb,numberFormat:s,seriesTypes:kc,setOptions:J,addEvent:vc,removeEvent:wc,createElement:q,discardElement:E,css:p,each:rc,extend:a,map:uc,merge:b,pick:o,splat:n,extendClass:r,pInt:d,wrap:u,svg:Gb,canvas:Ib,vml:!Gb&&!Ib,product:Nb,version:Ob})})();
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
(function(a){"use strict";var b=a.getOptions(),c=b.plotOptions,d=a.seriesTypes,e=a.merge,f=function(){},g=null,h=a.each;c.funnel=e(c.pie,{center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:!1,dataLabels:{connectorWidth:1,connectorColor:"#C0C0C0",crop:!1,overflow:"none"},size:!0,states:{select:{color:"#C0C0C0",borderColor:"#000000",shadow:!1}}}),d.funnel=a.extendClass(d.pie,{type:"funnel",animate:f,singularTooltips:!0,translate:function(){var a,b,c,d,e,i,j,k,l,m,n,o,p=function(a,b){return/%$/.test(a)?b*parseInt(a,10)/100:parseInt(a,10)},q=0,r=this,s=r.chart,t=0,u=r.options,v=u.reversed,w=s.plotWidth,x=s.plotHeight,y=0,u=r.options,z=u.center,A=p(z[0],w),B=p(z[0],x),C=p(u.width,w),D=p(u.height,x),E=p(u.neckWidth,w),F=p(u.neckHeight,x),G=r.data,H="left"===u.dataLabels.position?1:0;r.getWidthAt=b=function(a){return a>D-F||D===F?E:E+(C-E)*((D-F-a)/(D-F))},r.getX=function(a,c){return A+(c?-1:1)*(b(v?x-a:a)/2+u.dataLabels.distance)},r.center=[A,B,D],r.centerX=A,h(G,function(a){a.y>t&&(t=a.y)}),h(G,function(a){q+=a.y});var I=0,J=parseInt(D/G.length);c=[];for(var K=0;G.length>K;K++)c[K]=J;var L=C/t;L=.7*L,g=[],h(G,function(b){var h=null;(SO.isNundef(b.y)||SO.Number.isNaN(b.y))&&(b.y=0),h=G.length-1>I?G[I+1].y:b.y,o=null,e=q?b.y/q:0,j=B-D/2+y,m=j+c[I],a=L*h,1>a&&(a=2),0===I?(i=A-.7*C/2,k=i+.7*C):(i=l,k=n),G.length-1>I?(l=A-a/2,n=l+a):(l=i,k=n);var p=Math.min(k,n)+Math.abs(n-k)/2,r=Math.min(j,m)+Math.abs(m-j)/2;g.push([p,r]),d=["M",i,j,"L",k,j,n,m],d.push(l,m,"Z"),b.shapeType="path",b.shapeArgs={d:d},b.percentage=100*e,b.plotX=A,b.plotY=(j+(o||m))/2,b.tooltipPos=[A,b.plotY],b.slice=f,b.half=H,y+=c[I],I++}),r.setTooltipPoints()},drawPoints:function(){var a=this,b=a.options,c=a.chart,d=c.renderer;h(a.data,function(c){var e=c.graphic,f=c.shapeArgs;e?e.animate(f):c.graphic=d.path(f).attr({fill:c.color,stroke:b.borderColor,"stroke-width":b.borderWidth}).add(a.group)})},sortByAngle:function(a){a.sort(function(a,b){return a.plotY-b.plotY})},drawDataLabels:function(){for(var a,b,c,e,f,g=this.data,h=(this.options.dataLabels.distance,g.length);h--;)c=g[h],a=c.half,b=a?1:-1,f=c.plotY,e=this.getX(f,1),c.labelPos=[0,f,e,f,e,f,"left",0];d.pie.prototype.drawDataLabels.call(this)}}),b.chart.events={load:function(){var a=this;if("funnel"===a.options.chart.defaultSeriesType){for(var b=0;a.series[0].data.length>b;b++){var c,d=a.series[0].data[b],e=g[b],f=e[0],h=e[1],i=15,j=3,k=f+i,l=k+j;d.connector&&(c=$(d.connector.element),c.attr("d","M "+f+" "+h+"L "+k+" "+h)),d.dataLabel.element.setAttribute("transform","translate("+l+","+(h-11)+")")}a.redraw()}}},b.plotOptions.pyramid=a.merge(b.plotOptions.funnel,{neckWidth:"0%",neckHeight:"0%",reversed:!0}),a.seriesTypes.pyramid=a.extendClass(a.seriesTypes.funnel,{type:"pyramid"})})(Highcharts);
;// LICENSE Highcharts JS 3.0.10 - see licenses.txt §2.11
(function(a,b){function c(a,b,c){this.init.call(this,a,b,c)}var d=a.arrayMin,e=a.arrayMax,f=a.each,g=a.extend,h=a.merge,i=a.map,j=a.pick,k=a.pInt,l=a.getOptions().plotOptions,m=a.seriesTypes,n=a.extendClass,o=a.splat,p=a.wrap,q=a.Axis,r=a.Tick,s=a.Point,t=a.Pointer,u=a.TrackerMixin,v=a.CenteredSeriesMixin,w=a.Series,x=Math,y=x.round,z=x.floor,A=x.max,B=a.Color,C=function(){};g(c.prototype,{init:function(a,b,c){var d,e=this,g=e.defaultOptions;e.chart=b,b.angular&&(g.background={}),e.options=a=h(g,a),d=a.background,d&&f([].concat(o(d)).reverse(),function(a){var b=a.backgroundColor;a=h(e.defaultBackgroundOptions,a),b&&(a.backgroundColor=b),a.color=a.backgroundColor,c.options.plotBands.unshift(a)})},defaultOptions:{center:["50%","50%"],size:"85%",startAngle:0},defaultBackgroundOptions:{shape:"circle",borderWidth:1,borderColor:"silver",backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#FFF"],[1,"#DDD"]]},from:Number.MIN_VALUE,innerRadius:0,to:Number.MAX_VALUE,outerRadius:"105%"}});var D=q.prototype,E=r.prototype,F={getOffset:C,redraw:function(){this.isDirty=!1},render:function(){this.isDirty=!1},setScale:C,setCategories:C,setTitle:C},G={isRadial:!0,defaultRadialGaugeOptions:{labels:{align:"center",x:0,y:null},minorGridLineWidth:0,minorTickInterval:"auto",minorTickLength:10,minorTickPosition:"inside",minorTickWidth:1,tickLength:10,tickPosition:"inside",tickWidth:2,title:{rotation:0},zIndex:2},defaultRadialXOptions:{gridLineWidth:1,labels:{align:null,distance:15,x:0,y:null},maxPadding:0,minPadding:0,showLastLabel:!1,tickLength:0},defaultRadialYOptions:{gridLineInterpolation:"circle",labels:{align:"right",x:-3,y:-2},showLastLabel:!1,title:{x:4,text:null,rotation:90}},setOptions:function(a){var b=this.options=h(this.defaultOptions,this.defaultRadialOptions,a);b.plotBands||(b.plotBands=[])},getOffset:function(){D.getOffset.call(this),this.chart.axisOffset[this.side]=0,this.center=this.pane.center=v.getCenter.call(this.pane)},getLinePath:function(a,b){var c=this.center;return b=j(b,c[2]/2-this.offset),this.chart.renderer.symbols.arc(this.left+c[0],this.top+c[1],b,b,{start:this.startAngleRad,end:this.endAngleRad,open:!0,innerR:0})},setAxisTranslation:function(){D.setAxisTranslation.call(this),this.center&&(this.transA=this.isCircular?(this.endAngleRad-this.startAngleRad)/(this.max-this.min||1):this.center[2]/2/(this.max-this.min||1),this.minPixelPadding=this.isXAxis?this.transA*this.minPointOffset:0)},beforeSetTickPositions:function(){this.autoConnect&&(this.max+=this.categories&&1||this.pointRange||this.closestPointRange||0)},setAxisSize:function(){D.setAxisSize.call(this),this.isRadial&&(this.center=this.pane.center=a.CenteredSeriesMixin.getCenter.call(this.pane),this.isCircular&&(this.sector=this.endAngleRad-this.startAngleRad),this.len=this.width=this.height=this.center[2]*j(this.sector,1)/2)},getPosition:function(a,b){return this.isCircular||(b=this.translate(a),a=this.min),this.postTranslate(this.translate(a),j(b,this.center[2]/2)-this.offset)},postTranslate:function(a,b){var c=this.chart,d=this.center;return a=this.startAngleRad+a,{x:c.plotLeft+d[0]+Math.cos(a)*b,y:c.plotTop+d[1]+Math.sin(a)*b}},getPlotBandPath:function(a,b,c){var d,e,f,g,h=this.center,l=this.startAngleRad,m=h[2]/2,n=[j(c.outerRadius,"100%"),c.innerRadius,j(c.thickness,10)],o=/%$/,p=this.isCircular;return"polygon"===this.options.gridLineInterpolation?g=this.getPlotLinePath(a).concat(this.getPlotLinePath(b,!0)):(p||(n[0]=this.translate(a),n[1]=this.translate(b)),n=i(n,function(a){return o.test(a)&&(a=k(a,10)*m/100),a}),"circle"!==c.shape&&p?(d=l+this.translate(a),e=l+this.translate(b)):(d=-Math.PI/2,e=1.5*Math.PI,f=!0),g=this.chart.renderer.symbols.arc(this.left+h[0],this.top+h[1],n[0],n[0],{start:d,end:e,innerR:j(n[1],n[0]-n[2]),open:f})),g},getPlotLinePath:function(a,b){var c,d,e,g,h=this,i=h.center,j=h.chart,k=h.getPosition(a);return h.isCircular?g=["M",i[0]+j.plotLeft,i[1]+j.plotTop,"L",k.x,k.y]:"circle"===h.options.gridLineInterpolation?(a=h.translate(a),a&&(g=h.getLinePath(0,a))):(c=j.xAxis[0],g=[],a=h.translate(a),e=c.tickPositions,c.autoConnect&&(e=e.concat([e[0]])),b&&(e=[].concat(e).reverse()),f(e,function(b,e){d=c.getPosition(b,a),g.push(e?"L":"M",d.x,d.y)})),g},getTitlePosition:function(){var a=this.center,b=this.chart,c=this.options.title;return{x:b.plotLeft+a[0]+(c.x||0),y:b.plotTop+a[1]-{high:.5,middle:.25,low:0}[c.align]*a[2]+(c.y||0)}}};p(D,"init",function(a,d,e){var f,i,k,l,m,n,p=this,q=d.angular,r=d.polar,s=e.isX,t=q&&s,u=d.options,v=e.pane||0;q?(g(this,t?F:G),f=!s,f&&(this.defaultRadialOptions=this.defaultRadialGaugeOptions)):r&&(g(this,G),f=s,this.defaultRadialOptions=s?this.defaultRadialXOptions:h(this.defaultYAxisOptions,this.defaultRadialYOptions)),a.call(this,d,e),t||!q&&!r||(l=this.options,d.panes||(d.panes=[]),this.pane=m=d.panes[v]=d.panes[v]||new c(o(u.pane)[v],d,p),n=m.options,d.inverted=!1,u.chart.zoomType=null,this.startAngleRad=i=(n.startAngle-90)*Math.PI/180,this.endAngleRad=k=(j(n.endAngle,n.startAngle+360)-90)*Math.PI/180,this.offset=l.offset||0,this.isCircular=f,f&&e.max===b&&k-i===2*Math.PI&&(this.autoConnect=!0))}),p(E,"getPosition",function(a,b,c,d,e){var f=this.axis;return f.getPosition?f.getPosition(c):a.call(this,b,c,d,e)}),p(E,"getLabelPosition",function(a,b,c,d,e,f,g,h,i){var k,l=this.axis,m=f.y,n=f.align,o=180*((l.translate(this.pos)+l.startAngleRad+Math.PI/2)/Math.PI)%360;return l.isRadial?(k=l.getPosition(this.pos,l.center[2]/2+j(f.distance,-25)),"auto"===f.rotation?d.attr({rotation:o}):null===m&&(m=l.chart.renderer.fontMetrics(d.styles.fontSize).b-d.getBBox().height/2),null===n&&(n=l.isCircular?o>20&&160>o?"left":o>200&&340>o?"right":"center":"center",d.attr({align:n})),k.x+=f.x,k.y+=m):k=a.call(this,b,c,d,e,f,g,h,i),k}),p(E,"getMarkPath",function(a,b,c,d,e,f,g){var h,i,j=this.axis;return j.isRadial?(h=j.getPosition(this.pos,j.center[2]/2+d),i=["M",b,c,"L",h.x,h.y]):i=a.call(this,b,c,d,e,f,g),i}),l.arearange=h(l.area,{lineWidth:1,marker:null,threshold:null,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b><br/>'},trackByArea:!0,dataLabels:{verticalAlign:null,xLow:0,xHigh:0,yLow:0,yHigh:0}}),m.arearange=n(m.area,{type:"arearange",pointArrayMap:["low","high"],toYData:function(a){return[a.low,a.high]},pointValKey:"low",getSegments:function(){var a=this;f(a.points,function(b){a.options.connectNulls||null!==b.low&&null!==b.high?null===b.low&&null!==b.high&&(b.y=b.high):b.y=null}),w.prototype.getSegments.call(this)},translate:function(){var a=this,b=a.yAxis;m.area.prototype.translate.apply(a),f(a.points,function(a){var c=a.low,d=a.high,e=a.plotY;null===d&&null===c?a.y=null:null===c?(a.plotLow=a.plotY=null,a.plotHigh=b.translate(d,0,1,0,1)):null===d?(a.plotLow=e,a.plotHigh=null):(a.plotLow=e,a.plotHigh=b.translate(d,0,1,0,1))})},getSegmentPath:function(a){var b,c,d,e,f,g=[],h=a.length,i=w.prototype.getSegmentPath,j=this.options,k=j.step;for(b=HighchartsAdapter.grep(a,function(a){return null!==a.plotLow});h--;)c=a[h],null!==c.plotHigh&&g.push({plotX:c.plotX,plotY:c.plotHigh});return e=i.call(this,b),k&&(k===!0&&(k="left"),j.step={left:"right",center:"center",right:"left"}[k]),f=i.call(this,g),j.step=k,d=[].concat(e,f),f[0]="L",this.areaPath=this.areaPath.concat(e,f),d},drawDataLabels:function(){var a,b,c=this.data,d=c.length,e=[],f=w.prototype,g=this.options.dataLabels,h=this.chart.inverted;if(g.enabled||this._hasPointLabels){for(a=d;a--;)b=c[a],b.y=b.high,b._plotY=b.plotY,b.plotY=b.plotHigh,e[a]=b.dataLabel,b.dataLabel=b.dataLabelUpper,b.below=!1,h?(g.align="left",g.x=g.xHigh):g.y=g.yHigh;for(f.drawDataLabels&&f.drawDataLabels.apply(this,arguments),a=d;a--;)b=c[a],b.dataLabelUpper=b.dataLabel,b.dataLabel=e[a],b.y=b.low,b.plotY=b._plotY,b.below=!0,h?(g.align="right",g.x=g.xLow):g.y=g.yLow;f.drawDataLabels&&f.drawDataLabels.apply(this,arguments)}},alignDataLabel:function(){m.column.prototype.alignDataLabel.apply(this,arguments)},getSymbol:m.column.prototype.getSymbol,drawPoints:C}),l.areasplinerange=h(l.arearange),m.areasplinerange=n(m.arearange,{type:"areasplinerange",getPointSpline:m.spline.prototype.getPointSpline}),function(){var a=m.column.prototype;l.columnrange=h(l.column,l.arearange,{lineWidth:1,pointRange:null}),m.columnrange=n(m.arearange,{type:"columnrange",translate:function(){var b,c=this,d=c.yAxis;a.translate.apply(c),f(c.points,function(a){var e,f,g,h=a.shapeArgs,i=c.options.minPointLength;a.plotHigh=b=d.translate(a.high,0,1,0,1),a.plotLow=a.plotY,g=b,f=a.plotY-b,i>f&&(e=i-f,f+=e,g-=e/2),h.height=f,h.y=g})},trackerGroups:["group","dataLabels"],drawGraph:C,pointAttrToOptions:a.pointAttrToOptions,drawPoints:a.drawPoints,drawTracker:a.drawTracker,animate:a.animate,getColumnMetrics:a.getColumnMetrics})}(),l.gauge=h(l.line,{dataLabels:{enabled:!0,y:15,borderWidth:1,borderColor:"silver",borderRadius:3,crop:!1,style:{fontWeight:"bold"},verticalAlign:"top",zIndex:2},dial:{},pivot:{},tooltip:{headerFormat:""},showInLegend:!1});var H=n(s,{setState:function(a){this.state=a}}),I={type:"gauge",pointClass:H,angular:!0,drawGraph:C,fixedBox:!0,forceDL:!0,trackerGroups:["group","dataLabels"],translate:function(){var a=this,b=a.yAxis,c=a.options,d=b.center;a.generatePoints(),f(a.points,function(a){var e=h(c.dial,a.dial),f=k(j(e.radius,80))*d[2]/200,g=k(j(e.baseLength,70))*f/100,i=k(j(e.rearLength,10))*f/100,l=e.baseWidth||3,m=e.topWidth||1,n=c.overshoot,o=b.startAngleRad+b.translate(a.y,null,null,null,!0);n&&"number"==typeof n?(n=n/180*Math.PI,o=Math.max(b.startAngleRad-n,Math.min(b.endAngleRad+n,o))):c.wrap===!1&&(o=Math.max(b.startAngleRad,Math.min(b.endAngleRad,o))),o=180*o/Math.PI,a.shapeType="path",a.shapeArgs={d:e.path||["M",-i,-l/2,"L",g,-l/2,f,-m/2,f,m/2,g,l/2,-i,l/2,"z"],translateX:d[0],translateY:d[1],rotation:o},a.plotX=d[0],a.plotY=d[1]})},drawPoints:function(){var a=this,b=a.yAxis.center,c=a.pivot,d=a.options,e=d.pivot,g=a.chart.renderer;f(a.points,function(b){var c=b.graphic,e=b.shapeArgs,f=e.d,i=h(d.dial,b.dial);c?(c.animate(e),e.d=f):b.graphic=g[b.shapeType](e).attr({stroke:i.borderColor||"none","stroke-width":i.borderWidth||0,fill:i.backgroundColor||"black",rotation:e.rotation}).add(a.group)}),c?c.animate({translateX:b[0],translateY:b[1]}):a.pivot=g.circle(0,0,j(e.radius,5)).attr({"stroke-width":e.borderWidth||0,stroke:e.borderColor||"silver",fill:e.backgroundColor||"black"}).translate(b[0],b[1]).add(a.group)},animate:function(a){var b=this;a||(f(b.points,function(a){var c=a.graphic;c&&(c.attr({rotation:180*b.yAxis.startAngleRad/Math.PI}),c.animate({rotation:a.shapeArgs.rotation},b.options.animation))}),b.animate=null)},render:function(){this.group=this.plotGroup("group","series",this.visible?"visible":"hidden",this.options.zIndex,this.chart.seriesGroup),w.prototype.render.call(this),this.group.clip(this.chart.clipRect)},setData:function(a,b){w.prototype.setData.call(this,a,!1),this.processData(),this.generatePoints(),j(b,!0)&&this.chart.redraw()},drawTracker:u.drawTrackerPoint};m.gauge=n(m.line,I),l.boxplot=h(l.column,{fillColor:"#FFFFFF",lineWidth:1,medianWidth:2,states:{hover:{brightness:-.3}},threshold:null,tooltip:{pointFormat:'<span style="color:{series.color};font-weight:bold">{series.name}</span><br/>Maximum: {point.high}<br/>Upper quartile: {point.q3}<br/>Median: {point.median}<br/>Lower quartile: {point.q1}<br/>Minimum: {point.low}<br/>'},whiskerLength:"50%",whiskerWidth:2}),m.boxplot=n(m.column,{type:"boxplot",pointArrayMap:["low","q1","median","q3","high"],toYData:function(a){return[a.low,a.q1,a.median,a.q3,a.high]},pointValKey:"high",pointAttrToOptions:{fill:"fillColor",stroke:"color","stroke-width":"lineWidth"},drawDataLabels:C,translate:function(){var a=this,b=a.yAxis,c=a.pointArrayMap;m.column.prototype.translate.apply(a),f(a.points,function(a){f(c,function(c){null!==a[c]&&(a[c+"Plot"]=b.translate(a[c],0,1,0,1))})})},drawPoints:function(){var a,c,d,e,g,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,A,B=this,C=B.points,D=B.options,E=B.chart,F=E.renderer,G=B.doQuartiles!==!1,H=parseInt(B.options.whiskerLength,10)/100;f(C,function(f){l=f.graphic,x=f.shapeArgs,n={},q={},s={},A=f.color||B.color,f.plotY!==b&&(a=f.pointAttr[f.selected?"selected":""],t=x.width,u=z(x.x),v=u+t,w=y(t/2),c=z(G?f.q1Plot:f.lowPlot),d=z(G?f.q3Plot:f.lowPlot),e=z(f.highPlot),g=z(f.lowPlot),n.stroke=f.stemColor||D.stemColor||A,n["stroke-width"]=j(f.stemWidth,D.stemWidth,D.lineWidth),n.dashstyle=f.stemDashStyle||D.stemDashStyle,q.stroke=f.whiskerColor||D.whiskerColor||A,q["stroke-width"]=j(f.whiskerWidth,D.whiskerWidth,D.lineWidth),s.stroke=f.medianColor||D.medianColor||A,s["stroke-width"]=j(f.medianWidth,D.medianWidth,D.lineWidth),s["stroke-linecap"]="round",i=n["stroke-width"]%2/2,k=u+w+i,m=["M",k,d,"L",k,e,"M",k,c,"L",k,g,"z"],G&&(i=a["stroke-width"]%2/2,k=z(k)+i,c=z(c)+i,d=z(d)+i,u+=i,v+=i,o=["M",u,d,"L",u,c,"L",v,c,"L",v,d,"L",u,d,"z"]),H&&(i=q["stroke-width"]%2/2,e+=i,g+=i,p=["M",k-w*H,e,"L",k+w*H,e,"M",k-w*H,g,"L",k+w*H,g]),i=s["stroke-width"]%2/2,h=y(f.medianPlot)+i,r=["M",u,h,"L",v,h,"z"],l?(f.stem.animate({d:m}),H&&f.whiskers.animate({d:p}),G&&f.box.animate({d:o}),f.medianShape.animate({d:r})):(f.graphic=l=F.g().add(B.group),f.stem=F.path(m).attr(n).add(l),H&&(f.whiskers=F.path(p).attr(q).add(l)),G&&(f.box=F.path(o).attr(a).add(l)),f.medianShape=F.path(r).attr(s).add(l)))})}}),l.errorbar=h(l.boxplot,{color:"#000000",grouping:!1,linkedTo:":previous",tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b><br/>'},whiskerWidth:null}),m.errorbar=n(m.boxplot,{type:"errorbar",pointArrayMap:["low","high"],toYData:function(a){return[a.low,a.high]},pointValKey:"high",doQuartiles:!1,drawDataLabels:m.arearange?m.arearange.prototype.drawDataLabels:C,getColumnMetrics:function(){return this.linkedParent&&this.linkedParent.columnMetrics||m.column.prototype.getColumnMetrics.call(this)}}),l.waterfall=h(l.column,{lineWidth:1,lineColor:"#333",dashStyle:"dot",borderColor:"#333"}),m.waterfall=n(m.column,{type:"waterfall",upColorProp:"fill",pointArrayMap:["low","y"],pointValKey:"y",init:function(a,b){b.stacking=!0,m.column.prototype.init.call(this,a,b)},translate:function(){var a,b,c,d,e,f,g,h,i,j=this,k=j.options,l=j.yAxis,n=k.threshold,o=k.borderWidth%2/2;for(m.column.prototype.translate.apply(this),h=n,c=j.points,b=0,a=c.length;a>b;b++)d=c[b],e=d.shapeArgs,f=j.getStack(b),i=f.points[j.index],isNaN(d.y)&&(d.y=j.yData[b]),g=A(h,h+d.y)+i[0],e.y=l.translate(g,0,1),d.isSum||d.isIntermediateSum?(e.y=l.translate(i[1],0,1),e.height=l.translate(i[0],0,1)-e.y):h+=f.total,0>e.height&&(e.y+=e.height,e.height*=-1),d.plotY=e.y=y(e.y)-o,e.height=y(e.height),d.yBottom=e.y+e.height},processData:function(a){var b,c,d,e,f,g,h,i=this,j=i.options,k=i.yData,l=i.points,m=k.length,n=j.threshold||0;for(d=c=e=f=n,h=0;m>h;h++)g=k[h],b=l&&l[h]?l[h]:{},"sum"===g||b.isSum?k[h]=d:"intermediateSum"===g||b.isIntermediateSum?(k[h]=c,c=n):(d+=g,c+=g),e=Math.min(d,e),f=Math.max(d,f);w.prototype.processData.call(this,a),i.dataMin=e,i.dataMax=f},toYData:function(a){return a.isSum?"sum":a.isIntermediateSum?"intermediateSum":a.y},getAttribs:function(){m.column.prototype.getAttribs.apply(this,arguments);var b=this,c=b.options,d=c.states,e=c.upColor||b.color,g=a.Color(e).brighten(.1).get(),i=h(b.pointAttr),j=b.upColorProp;i[""][j]=e,i.hover[j]=d.hover.upColor||g,i.select[j]=d.select.upColor||e,f(b.points,function(a){a.y>0&&!a.color&&(a.pointAttr=i,a.color=e)})},getGraphPath:function(){var a,b,c,d,e=this.data,f=e.length,g=this.options.lineWidth+this.options.borderWidth,h=y(g)%2/2,i=[],j="M",k="L";for(c=1;f>c;c++)b=e[c].shapeArgs,a=e[c-1].shapeArgs,d=[j,a.x+a.width,a.y+h,k,b.x,a.y+h],0>e[c-1].y&&(d[2]+=a.height,d[5]+=a.height),i=i.concat(d);return i},getExtremes:C,getStack:function(a){var b=this.yAxis,c=b.stacks,d=this.stackKey;return this.processedYData[a]<this.options.threshold&&(d="-"+d),c[d][a]},drawGraph:w.prototype.drawGraph}),l.bubble=h(l.scatter,{dataLabels:{inside:!0,style:{color:"white",textShadow:"0px 0px 3px black"},verticalAlign:"middle"},marker:{lineColor:null,lineWidth:1},minSize:8,maxSize:"20%",tooltip:{pointFormat:"({point.x}, {point.y}), Size: {point.z}"},turboThreshold:0,zThreshold:0}),m.bubble=n(m.scatter,{type:"bubble",pointArrayMap:["y","z"],parallelArrays:["x","y","z"],trackerGroups:["group","dataLabelsGroup"],bubblePadding:!0,pointAttrToOptions:{stroke:"lineColor","stroke-width":"lineWidth",fill:"fillColor"},applyOpacity:function(a){var b=this.options.marker,c=j(b.fillOpacity,.5);return a=a||b.fillColor||this.color,1!==c&&(a=B(a).setOpacity(c).get("rgba")),a},convertAttribs:function(){var a=w.prototype.convertAttribs.apply(this,arguments);return a.fill=this.applyOpacity(a.fill),a},getRadii:function(a,b,c,d){var e,f,g,h,i=this.zData,j=[],k="width"!==this.options.sizeBy;for(f=0,e=i.length;e>f;f++)h=b-a,g=h>0?(i[f]-a)/(b-a):.5,k&&g>=0&&(g=Math.sqrt(g)),j.push(x.ceil(c+g*(d-c))/2);this.radii=j},animate:function(a){var b=this.options.animation;a||(f(this.points,function(a){var c=a.graphic,d=a.shapeArgs;c&&d&&(c.attr("r",1),c.animate({r:d.r},b))}),this.animate=null)},translate:function(){var a,c,d,e=this.data,f=this.radii;for(m.scatter.prototype.translate.call(this),a=e.length;a--;)c=e[a],d=f?f[a]:0,c.negative=c.z<(this.options.zThreshold||0),d>=this.minPxSize/2?(c.shapeType="circle",c.shapeArgs={x:c.plotX,y:c.plotY,r:d},c.dlBox={x:c.plotX-d,y:c.plotY-d,width:2*d,height:2*d}):c.shapeArgs=c.plotY=c.dlBox=b},drawLegendSymbol:function(a,b){var c=k(a.itemStyle.fontSize)/2;b.legendSymbol=this.chart.renderer.circle(c,a.baseline-c,c).attr({zIndex:3}).add(b.legendGroup),b.legendSymbol.isMarker=!0},drawPoints:m.column.prototype.drawPoints,alignDataLabel:m.column.prototype.alignDataLabel}),q.prototype.beforePadding=function(){var a=this,c=this.len,g=this.chart,h=0,i=c,l=this.isXAxis,m=l?"xData":"yData",n=this.min,o={},p=x.min(g.plotWidth,g.plotHeight),q=Number.MAX_VALUE,r=-Number.MAX_VALUE,s=this.max-n,t=c/s,u=[];this.tickPositions&&(f(this.series,function(b){var c,h=b.options;!b.bubblePadding||!b.visible&&g.options.chart.ignoreHiddenSeries||(a.allowZoomOutside=!0,u.push(b),l&&(f(["minSize","maxSize"],function(a){var b=h[a],c=/%$/.test(b);b=k(b),o[a]=c?p*b/100:b}),b.minPxSize=o.minSize,c=b.zData,c.length&&(q=x.min(q,x.max(d(c),h.displayNegative===!1?h.zThreshold:-Number.MAX_VALUE)),r=x.max(r,e(c)))))}),f(u,function(a){var b,c=a[m],d=c.length;if(l&&a.getRadii(q,r,o.minSize,o.maxSize),s>0)for(;d--;)"number"==typeof c[d]&&(b=a.radii[d],h=Math.min((c[d]-n)*t-b,h),i=Math.max((c[d]-n)*t+b,i))}),u.length&&s>0&&j(this.options.min,this.userMin)===b&&j(this.options.max,this.userMax)===b&&(i-=c,t*=(c+h-i)/c,this.min+=h/t,this.max+=i/t))},function(){function a(a,b,c){a.call(this,b,c),this.chart.polar&&(this.closeSegment=function(a){var b=this.xAxis.center;a.push("L",b[0],b[1])},this.closedStacks=!0)}function b(a,b){var c,d=this.chart,e=this.options.animation,f=this.group,g=this.markerGroup,h=this.xAxis.center,i=d.plotLeft,j=d.plotTop;d.polar?d.renderer.isSVG&&(e===!0&&(e={}),b?(c={translateX:h[0]+i,translateY:h[1]+j,scaleX:.001,scaleY:.001},f.attr(c),g&&(g.attrSetters=f.attrSetters,g.attr(c))):(c={translateX:i,translateY:j,scaleX:1,scaleY:1},f.animate(c,e),g&&g.animate(c,e),this.animate=null)):a.call(this,b)}var c,d=w.prototype,e=t.prototype;d.toXY=function(a){var b,c,d=this.chart,e=a.plotX,f=a.plotY;a.rectPlotX=e,a.rectPlotY=f,c=(180*(e/Math.PI)+this.xAxis.pane.options.startAngle)%360,0>c&&(c+=360),a.clientX=c,b=this.xAxis.postTranslate(a.plotX,this.yAxis.len-f),a.plotX=a.polarPlotX=b.x-d.plotLeft,a.plotY=a.polarPlotY=b.y-d.plotTop},d.orderTooltipPoints=function(a){this.chart.polar&&(a.sort(function(a,b){return a.clientX-b.clientX}),a[0]&&(a[0].wrappedClientX=a[0].clientX+360,a.push(a[0])))},m.area&&p(m.area.prototype,"init",a),m.areaspline&&p(m.areaspline.prototype,"init",a),m.spline&&p(m.spline.prototype,"getPointSpline",function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=1.5,x=w+1;return this.chart.polar?(f=c.plotX,g=c.plotY,h=b[d-1],i=b[d+1],this.connectEnds&&(h||(h=b[b.length-2]),i||(i=b[1])),h&&i&&(j=h.plotX,k=h.plotY,l=i.plotX,m=i.plotY,n=(w*f+j)/x,o=(w*g+k)/x,p=(w*f+l)/x,q=(w*g+m)/x,r=Math.sqrt(Math.pow(n-f,2)+Math.pow(o-g,2)),s=Math.sqrt(Math.pow(p-f,2)+Math.pow(q-g,2)),t=Math.atan2(o-g,n-f),u=Math.atan2(q-g,p-f),v=Math.PI/2+(t+u)/2,Math.abs(t-v)>Math.PI/2&&(v-=Math.PI),n=f+Math.cos(v)*r,o=g+Math.sin(v)*r,p=f+Math.cos(Math.PI+v)*s,q=g+Math.sin(Math.PI+v)*s,c.rightContX=p,c.rightContY=q),d?(e=["C",h.rightContX||h.plotX,h.rightContY||h.plotY,n||f,o||g,f,g],h.rightContX=h.rightContY=null):e=["M",f,g]):e=a.call(this,b,c,d),e}),p(d,"translate",function(a){if(a.call(this),this.chart.polar&&!this.preventPostTranslate)for(var b=this.points,c=b.length;c--;)this.toXY(b[c])}),p(d,"getSegmentPath",function(a,b){var c=this.points;return this.chart.polar&&this.options.connectEnds!==!1&&b[b.length-1]===c[c.length-1]&&null!==c[0].y&&(this.connectEnds=!0,b=[].concat(b,[c[0]])),a.call(this,b)}),p(d,"animate",b),p(d,"setTooltipPoints",function(a,b){return this.chart.polar&&g(this.xAxis,{tooltipLen:360}),a.call(this,b)}),m.column&&(c=m.column.prototype,p(c,"animate",b),p(c,"translate",function(a){var b,c,d,e,f=this.xAxis,g=this.yAxis.len,h=f.center,i=f.startAngleRad,k=this.chart.renderer;if(this.preventPostTranslate=!0,a.call(this),f.isRadial)for(c=this.points,e=c.length;e--;)d=c[e],b=d.barX+i,d.shapeType="path",d.shapeArgs={d:k.symbols.arc(h[0],h[1],g-d.plotY,null,{start:b,end:b+d.pointWidth,innerR:g-j(d.yBottom,g)})},this.toXY(d)}),p(c,"alignDataLabel",function(a,b,c,e,f,g){if(this.chart.polar){var h,i,j=180*(b.rectPlotX/Math.PI);null===e.align&&(h=j>20&&160>j?"left":j>200&&340>j?"right":"center",e.align=h),null===e.verticalAlign&&(i=45>j||j>315?"bottom":j>135&&225>j?"top":"middle",e.verticalAlign=i),d.alignDataLabel.call(this,b,c,e,f,g)}else a.call(this,b,c,e,f,g)})),p(e,"getIndex",function(a,b){var c,d,e,f,g=this.chart;return g.polar?(d=g.xAxis[0].center,e=b.chartX-d[0]-g.plotLeft,f=b.chartY-d[1]-g.plotTop,c=180-Math.round(180*(Math.atan2(e,f)/Math.PI))):c=a.call(this,b),c}),p(e,"getCoordinates",function(a,b){var c=this.chart,d={xAxis:[],yAxis:[]};return c.polar?f(c.axes,function(a){var e=a.isXAxis,f=a.center,g=b.chartX-f[0]-c.plotLeft,h=b.chartY-f[1]-c.plotTop;d[e?"xAxis":"yAxis"].push({axis:a,value:a.translate(e?Math.PI-Math.atan2(g,h):Math.sqrt(Math.pow(g,2)+Math.pow(h,2)),!0)})}):d=a.call(this,b),d})}()})(Highcharts);
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.Charts"),SO.Charts.AbstractChart=function(a,b){this._element=a instanceof jQuery?a[0]:a,this.element=$(a),this._renderingType=b.renderingType,this._highchartConf=null,this._chartRef=null,this._layoutOptions=b.layout,this._originalHeight=null,this._originalWidth=null,this._selectionChanged=b.onSelectionChanged,this._longClick=SO.isNundef(b.onLongClick)?function(){}:b.onLongClick,this._dataProvider=b.dataProvider,SO.assert(!b.data||!b.dataProvider,"You can not provide static data and use a data provider"),SO.assert(b.data||b.dataProvider,"You must provide static data or a data provider"),this._dimensions=b.data,this._measures=b.data,this._dataProvider||this._measures.dimensions&&(this._dimensions=this._measures.dimensions),this._dataProvider||this._measures.measures&&(this._measures=this._measures.measures),this._options=b,this._currentJob=null,this._dataProvider&&this._dataProvider.controller.registerJpathObserver(this._dataProvider.jpath,this);var c=["#8CC350","#5A6EAA","#D755A5","#1EBED7","#F0A01E","#9B8CE6","#3CB5A0","#3287D2","#F0557D","#C3D250","#EB782D","#78B4F5","#5FAF69","#AA5FA5","#FA5A50","#F5C841"];SO.isNundef(this._layoutOptions.defaultColors)&&(this._layoutOptions.defaultColors=c),SO.Widgets.LayoutManager.registerWidget(this)},SO.Charts.AbstractChart.prototype._initCheck=function(){return SO.assert(this._element instanceof HTMLDivElement,"Cannot create chart : invalid element "+this._element),this._dataProvider||("gauge"!==this._renderingType&&"bullet"!==this._renderingType&&SO.assert(!SO.isNundef(this._dimensions),"Cannot create chart : dimension values are required ("+this._dimensions+")"),SO.assert(!SO.isNundef(this._measures),"Cannot create chart : measure values are required ("+this._measures+")")),this._hasData()},SO.Charts.AbstractChart.prototype._updateColors=function(){var a=[];SO.assert(this._layoutOptions.colorOffset>0&&this._layoutOptions.colorOffset<this._layoutOptions.defaultColors.length,"AbstractChart: Bad value for offsetColor option in updateColors method ");var b=this._layoutOptions.defaultColors.slice(this._layoutOptions.colorOffset,this._layoutOptions.defaultColors.length),c=Math.ceil(this._measures.length/this._layoutOptions.defaultColors.length)-1;if(c>0)for(var d=0;1+c>=d;d++)a=a.concat(b);else a=b;this._highchartConf.colors=a},SO.Charts.AbstractChart.prototype._setOriginalSize=function(){if(SO.isString(this._layoutOptions.chartWidth)&&-1!==String(this._layoutOptions.chartWidth).indexOf("%")){var a=parseInt(this._layoutOptions.chartWidth.substring(-1),10),b=a/100,c=Math.ceil(this.element.width()*b);this._originalWidth=c,this._layoutOptions.chartWidth=c}else this._originalWidth=SO.isNundef(this._layoutOptions.chartWidth)?this.element.width():this._layoutOptions.chartWidth;if(SO.isString(this._layoutOptions.chartHeight)&&-1!==String(this._layoutOptions.chartHeight).indexOf("%")){var a=parseInt(this._layoutOptions.chartHeight.substring(-1),10),b=a/100,d=Math.ceil(this.element.height()*b);this._layoutOptions.chartHeight=d,this._originalHeight=Math.ceil(this.element.height()*b)}else this._originalHeight=SO.isNundef(this._layoutOptions.chartHeight)?this.element.height():this._layoutOptions.chartHeight},SO.Charts.AbstractChart.prototype._resize=function(a,b){SO.isNundef(this._chartRef)||a>0&&b>0&&(this._chartRef.setSize(a,b,!1),this._originalWidth=a,this._originalHeight=b)},SO.Charts.AbstractChart.prototype._hasData=function(){return this._dataProvider||!SO.isNundef(this._measures)&&!SO.isEmpty(this._measures)?{code:0,msg:""}:(this._highchartConf=null,this._chartRef=null,this.element.empty(),this.element.css({padding:"10px",textAlign:"center"}),{code:1,msg:xtk_core.charts_none()})},SO.Charts.AbstractChart.prototype.rebuildLayout=function(){var a=this.element.width(),b=this.element.height();(.9*this._originalHeight>=b||.9*this._originalWidth>=a)&&this._resize(a,b),(b>=1.1*this._originalHeight||a>=1.1*this._originalWidth)&&this._resize(a,b)},SO.Charts.AbstractChart.prototype.setTitle=function(a,b,c){this._layoutOptions.chartTitle=a,this._highchartConf.title.text=a,SO.isObject(b)&&(this._highchartConf.title.style=b),c||this._refresh()},SO.Charts.AbstractChart.prototype.setTitlePosition=function(a,b){switch(a){case"top":this._highchartConf.title.align="center",this._highchartConf.title.verticalAlign="top";break;case"topRight":this._highchartConf.title.align="right",this._highchartConf.title.verticalAlign="top";break;case"topLeft":this._highchartConf.title.align="left",this._highchartConf.title.verticalAlign="top";break;case"bottom":this._highchartConf.title.align="center",this._highchartConf.title.verticalAlign="bottom";break;case"bottomLeft":this._highchartConf.title.align="left",this._highchartConf.title.verticalAlign="bottom";break;case"bottomRight":this._highchartConf.title.align="right",this._highchartConf.title.verticalAlign="bottom";break;case"right":this._highchartConf.title.align="right",this._highchartConf.title.verticalAlign="middle";break;case"left":this._highchartConf.title.align="left",this._highchartConf.title.verticalAlign="middle";break;default:this._highchartConf.title.align="top",this._highchartConf.title.verticalAlign="middle"}b||this._refresh()},SO.Charts.AbstractChart.prototype.showLegend=function(a,b){this._layoutOptions.showLegend=a,this._highchartConf.legend.enabled=a,b||this._refresh()},SO.Charts.AbstractChart.prototype.showTooltip=function(a,b){this._layoutOptions.showTooltip=a,this._highchartConf.tooltip.enabled=a,b||this._refresh()},SO.Charts.AbstractChart.prototype.showLabels=function(a,b){if(this._layoutOptions.showLabels=a,this.getAllowedTypes()){var c=this._highchartsTypes[this._chartIndex];if(this._highchartConf.plotOptions[c]){var d={dataLabels:{enabled:a}};this._highchartConf.plotOptions[c]=SO.Utils.extend(this._highchartConf.plotOptions[c],d,!0)}else this._highchartConf.plotOptions[c]={dataLabels:{enabled:a}}}else this._highchartConf.plotOptions.column.dataLabels.enabled=a;b||this._refresh()},SO.Charts.AbstractChart.prototype._setTickInterval=function(a,b){var c=this;window.setTimeout(function(){c._highchartConf.xAxis.tickInterval=a,b||c._refresh()})},SO.Charts.AbstractChart.prototype.setTooltipFormat=function(a,b){var c=null;switch(a){case"numberValue":this._formatAsPercent(!0),c=function(){var a=this.y;return SO.isNundef(this.point.yFormatted)||(a=this.point.yFormatted),a};break;case"numberPoint":this._formatAsPercent(!0),c=function(){var a=this.y;return SO.isNundef(this.point.yFormatted)||(a=this.point.yFormatted),this.key+" : "+a};break;case"numberSerie":this._formatAsPercent(!0),c=function(){var a=this.y;return SO.isNundef(this.point.yFormatted)||(a=this.point.yFormatted),this.key+" : "+a+" ("+this.series.name+")"};break;case"numberStack":this._formatAsPercent(!0),c=function(){var a=this.series.stackKey,b="column",c=new RegExp(b,"gi");return a=a.replace(c,""),a+" ("+this.key+") : "+this.y};break;case"percentValue":this._formatAsPercent(),c=function(){return NL.Locale.formatPercent(parseFloat(this.y),2)};break;case"percentPoint":this._formatAsPercent(),c=function(){return this.key+" : "+NL.Locale.formatPercent(parseFloat(this.y),2)};break;case"percentSerie":this._formatAsPercent(),c=function(){return this.key+" : "+NL.Locale.formatPercent(parseFloat(this.y),2)+" ("+this.series.name+")"};break;case"percentStack":this._formatAsPercent(),c=function(){var a=this.series.stackKey,b="column",c=new RegExp(b,"gi");return a=a.replace(c,""),a+" ("+this.key+") : "+NL.Locale.formatPercent(parseFloat(this.y),2)};break;default:c=function(){return this.key+" : "+this.y}}this._highchartConf.tooltip.formatter=c,b||this._refresh()},SO.Charts.AbstractChart.prototype.setDataLabelsFormat=function(a,b){var c=null;switch(a){case"value":this._formatAsPercent(!0),c=function(){return this.y};break;case"key":this._formatAsPercent(!0),c=function(){return this.key};break;case"point":this._formatAsPercent(!0),c=function(){var a=this.y;return SO.isNundef(this.point.yFormatted)||(a=this.point.yFormatted),this.key+" ("+a+")"};break;case"serie":this._formatAsPercent(!0),c=function(){return this.key+" : "+this.y+" ("+this.series.name+")"};break;case"stack":this._formatAsPercent(!0),c=function(){var a=this.series.stackKey,b="column",c=new RegExp(b,"gi");return a=a.replace(c,""),a+"("+this.key+") :"+this.y};break;case"percentValue":this._formatAsPercent(),c=function(){return NL.Locale.formatPercent(parseFloat(this.y),2)};break;case"percentPoint":this._formatAsPercent(),c=function(){return this.key+" : "+NL.Locale.formatPercent(parseFloat(this.y),2)};break;case"percentSerie":this._formatAsPercent(),c=function(){return this.key+" : "+NL.Locale.formatPercent(parseFloat(this.y),2)+" ("+this.series.name+")"};break;case"percentStack":this._formatAsPercent(),c=function(){var a=this.series.stackKey,b="column",c=new RegExp(b,"gi");return a=a.replace(c,""),a+" ("+this.key+") : "+NL.Locale.formatPercent(parseFloat(this.y),2)};break;default:c=function(){return this.key}}if(this.getAllowedTypes()){var d=this._highchartsTypes[this._chartIndex];if(this._highchartConf.plotOptions[d]){var e={dataLabels:{formatter:c}};this._highchartConf.plotOptions[d]=SO.Utils.extend(this._highchartConf.plotOptions[d],e,!0)}else this._highchartConf.plotOptions[d]={dataLabels:{formatter:c}}}else this._highchartConf.plotOptions.column.dataLabels.formatter=c;this._layoutOptions.dataLabelsFormatter=c,b||this._refresh()},SO.Charts.AbstractChart.prototype.setRenderingType=function(){SO.log.err("Abstract function must be implemented in derived classes")},SO.Charts.AbstractChart.prototype._formatAsPercent=function(a){a?this._highchartConf.yAxis.labels={formatter:null}:(this._highchartConf.yAxis.allowDecimals=!0,this._highchartConf.yAxis.labels={formatter:function(){return NL.Locale.formatPercent(parseFloat(this.value),2)}})},SO.Charts.AbstractChart.prototype.setLegendPosition=function(a,b){switch(a){case"top":this._highchartConf.legend.align="center",this._highchartConf.legend.verticalAlign="top",this._highchartConf.legend.layout="horizontal";break;case"topRight":this._highchartConf.legend.align="right",this._highchartConf.legend.verticalAlign="top",this._highchartConf.legend.layout="horizontal";break;case"topLeft":this._highchartConf.legend.align="left",this._highchartConf.legend.verticalAlign="top",this._highchartConf.legend.layout="horizontal";break;case"bottomLeft":this._highchartConf.legend.align="left",this._highchartConf.legend.verticalAlign="bottom",this._highchartConf.legend.layout="horizontal";break;case"bottomRight":this._highchartConf.legend.align="right",this._highchartConf.legend.verticalAlign="bottom",this._highchartConf.legend.layout="horizontal";break;case"bottom":this._highchartConf.legend.align="center",this._highchartConf.legend.layout="horizontal",this._highchartConf.legend.verticalAlign="bottom";break;case"vBottom":this._highchartConf.legend.align="center",this._highchartConf.legend.layout="vertical",this._highchartConf.legend.verticalAlign="bottom";break;case"right":this._highchartConf.legend.align="right",this._highchartConf.legend.verticalAlign="middle",this._highchartConf.legend.layout="vertical";break;case"left":this._highchartConf.legend.align="left",this._highchartConf.legend.verticalAlign="middle",this._highchartConf.legend.layout="vertical";break;default:this._highchartConf.legend.align="left",this._highchartConf.legend.verticalAlign="middle",this._highchartConf.legend.layout="vertical"}b||this._refresh()},SO.Charts.AbstractChart.prototype._propagateSelection=function(){var a=this._chartRef.getSelectedPoints();SO.isNundef(this._selectionChanged)||this._selectionChanged(a)},SO.Charts.AbstractChart.prototype._refresh=function(){null!==this._chartRef&&this._chartRef.destroy(),this._chartRef=new Highcharts.Chart(this._highchartConf)},SO.Charts.AbstractChart.prototype.destroy=function(){null!==this._chartRef&&this._chartRef.destroy()},SO.Charts.AbstractChart.prototype.getAllowedTypes=function(){return this._allowedTypes},SO.Charts.AbstractChart.prototype.getRenderingType=function(){return this._renderingType};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.Charts"),SO.Charts.chart1D1=function(a,b){SO.Charts.AbstractChart.apply(this,arguments),SO.assert(this._element instanceof HTMLDivElement,"Cannot create chart : invalid element "+this._element),this._allowedTypes=["pie","donut","funnel","bar","line","spider","area"],this._highchartsTypes=["pie","pie","funnel","column","line","line","area"],this._updateChartType(),this._currentItems=[],this._initDataProvider(b.dataProvider,b.data);var c={chartWidth:null,chartHeight:null,chartTitle:"",chartTitleStyle:{"font-family":'"AdobeCleanLight", Arial, Verdana, Helvetica, sans-serif',"font-size":"22px",color:"rgb(75, 75, 75)"},serieTitle:"",yAxisTitle:"",colorOffset:0,tickInterval:null,minYAxis:null,maxYAxis:null,allowDecimals:!0,selectionable:!0,tooltipFormat:"numberPoint",dataLabelsFormat:"point",legendPosition:"right",titlePosition:"top",showLabels:!1,showTooltip:!0,showLegend:!0,bar:null,funnel:null,pie:null,area:null,spider:null,line:null,donut:{innerSize:"80%"}};this._layoutOptions=SO.Utils.extend(c,this._layoutOptions,!0),this._layoutOptions.locale=b.locale,this._layoutOptions.timezone=b.timezone,this._layoutOptions.autoTick=SO.isNundef(this._layoutOptions.tickInterval),this._setOriginalSize(),this._configure()},SO.OO.extend(SO.Charts.chart1D1,SO.Charts.AbstractChart),SO.Charts.chart1D1.prototype._initDataProvider=function(a,b){if(a)this._dataProvider=a,SO.assert(this._dataProvider.controller,"No controller defined in the data provider"),SO.assert(this._dataProvider.jpath,"No jpath defined in the data provider"),SO.assert(this._dataProvider.dimension,"No dimension defined in the data provider"),SO.assert(this._dataProvider.measure,"No measure defined in the data provider");else if(b){SO.assert(b.dimensions,"Dimensions are mandatory if you don't use a data provider"),SO.assert(b.measures,"Measures are mandatory if you don't use a data provider"),SO.assert(b.dimensions.length===b.measures.length,"Measures and dimensions must have the same size");for(var c=[],d=0;b.dimensions.length>d;d++)c.push({dimension:b.dimensions[d],measure:b.measures[d]});var e={data:c},f={data:{type:"chart",elements:{dimension:{type:"string"},measure:{type:"float"}}}},g=new SO.MVC.Controller({model:e,metamodel:f});this._dataProvider={controller:g,jpath:"data",dimension:"dimension",measure:"measure"}}},SO.Charts.chart1D1.prototype.setSerie=function(a,b){SO.assert(!this._dataProvider,"You should not set a static serie when you use a data provider: this is meaningless"),this._initDataProvider(null,{dimensions:a,measures:b}),this._fetchData()},SO.Charts.chart1D1.prototype._fetchData=function(){this._highchartConf.series||(this._highchartConf.series=[]),this._highchartConf.series[0]||(this._highchartConf.series[0]={}),this._highchartConf.series[0].data=[],this._highchartConf.series[0].name=this._layoutOptions.serieTitle;var a=this._dataProvider.controller,b=this._dataProvider.jpath,c=this;this._currentJob&&this._cancel(a,b);var d={onSuccess:function(a){c._currentItems=a,c._draw()},onError:function(){},onComplete:function(){c._currentJob=null}};this._currentJob=a.getCollection(b,0,0,d,!0)},SO.Charts.chart1D1.prototype._draw=function(){var a=this._dataProvider.dimension,b=this._dataProvider.measure;this._measures=this._currentItems;for(var c=0,d=0;this._currentItems.length>d;d++){var e=this._currentItems[d][b];SO.isNumber(e)||(e=SO.Float.parse(e)),("pie"!=this._currentHighchartsType||0!=e)&&this._highchartConf.series[0].data.push({name:this._currentItems[d][a],y:e,yFormatted:this._formatValue(b,e),rawData:this._currentItems[d]}),c+=e}0===this._currentItems.length||"pie"==this._currentHighchartsType&&0==c?(this._chartRef=null,this.element.empty(),this.element.css({padding:"10px",textAlign:"center"}),this.element.text(xtk_core.charts_none())):(this._setRenderingType(this._currentBusinessType),this._updateColors(),this._updateXAxisTickInterval(this._originalWidth),this._update())},SO.Charts.chart1D1.prototype._formatValue=function(a,b){var c="";if(SO.isNundef(a)||SO.isNundef(b))return c;var d=this._options.displayFormats[a];if(SO.isNundef(d))return b;var e={locale:this._layoutOptions.locale,timezone:this._layoutOptions.timezone},f=SO.Format.formatValue(b,d,e)||b;return f},SO.Charts.chart1D1.prototype._findItemPosition=function(a){for(var b=this._dataProvider.dimension,c=0;this._currentItems.length>c;c++)if(this._currentItems[c][b]===a)return c;return-1},SO.Charts.chart1D1.prototype._updateChartType=function(){this._chartIndex=this._allowedTypes.indexOf(this._renderingType),SO.assert(-1!==this._chartIndex,"Cannot create chart1D1 : invalid chart type "+this._renderingType),this._currentHighchartsType=this._highchartsTypes[this._chartIndex],this._currentBusinessType=this._allowedTypes[this._chartIndex]},SO.Charts.chart1D1.prototype._cancel=function(a,b){a.cancelGetCollection(b,this._currentJob)},SO.Charts.chart1D1.prototype.onJpathNotify=function(a){switch(a){case"strict":break;case"loading":break;case"add":case"cancelAdd":case"remove":case"cancelRemove":case"move":case"duplicate":case"cancelDuplicate":case"sort":case"filter":case"update":case"error":case"value":this._fetchData();break;default:throw"Unknown type in method onJpathNotify: "+a}},SO.Charts.chart1D1.prototype._configure=function(){var a=this,b=function(b){return function(){a._longClick(b)}};this._highchartConf={chart:{style:{fontFamily:"AdobeCleanLight, Arial, Verdana, Helvetica, sans-serif"},width:this._layoutOptions.chartWidth,height:this._layoutOptions.chartHeight,marginTop:20,spacingBottom:20,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,backgroundColor:"transparent",renderTo:this._element,type:this._currentHighchartsType,events:{click:function(a){a.preventDefault()},load:function(){var c,d=this,e=d.xAxis[0],f=this.chartWidth,g=0,h=0,i=e.names.length;!$.isEmptyObject(e.ticks)&&!a._highchartConf.xAxis.tickInterval&&e.ticks.length>=2&&(c=e.ticks[1].label.x-e.ticks[0].label.x);for(var j in e.ticks){var k=e.ticks[j];if(k.label){var l=$(k.label.element).width();if(g+=l+c,h++,g>f)break}}if(h>0&&!a._highchartConf.xAxis.tickInterval&&0===a._highchartConf.xAxis.categories.length){var m=Math.ceil(i/h);a._setTickInterval(m)}for(var n=function(b){return function(){b.selected?b.select(!1,!0):b.select(!0,!0),a._propagateSelection()}},o=0;d.series[0].data.length>o;o++){var p=d.series[0].data[o];SO.isNundef(d.series[0].data[o].graphic)||(d.series[0].data[o].graphic.on("dblclick",b(p)),SO.Event.bind(d.series[0].data[o].graphic.element,"tap",n(p)),SO.Event.bind(d.series[0].data[o].graphic.element,"holdtouch",b(p)))}},selection:function(b){for(var c=b.xAxis[0].min,d=b.xAxis[0].max,e=b.yAxis[0].min,f=b.yAxis[0].max,g=0;this.series.length>g;g++)for(var h=this.series[g].data,i=0;h.length>i;i++){var j=h[i];j.x>=c&&d>=j.x&&j.y>=e&&f>=j.y&&j.select(!0,!0)}a._propagateSelection(),b.preventDefault()}},zoomType:"xy"},xAxis:{tickInterval:this._layoutOptions.tickInterval},title:{text:this._layoutOptions.chartTitle,style:this._layoutOptions.chartTitleStyle},tooltip:{enabled:this._layoutOptions.showTooltip,style:{fontWeight:"bold"}},credits:{enabled:!1},legend:{enabled:this._layoutOptions.showLegend,borderWidth:0},yAxis:{allowDecimals:this._layoutOptions.allowDecimals,min:this._layoutOptions.minYAxis,max:this._layoutOptions.maxYaxis,title:{text:this._layoutOptions.yAxisTitle}},plotOptions:{series:{slicedOffset:10,allowPointSelect:this._layoutOptions.selectionable,events:{legendItemClick:function(b){var c=null,d=a._getPointsByMeasure(this.name);c=d.sum===d.selected?!1:!0;for(var e=0;this.data.length>e;e++)c?this.data[e].select(!0,!0):this.data[e].select(!1,!0);a._propagateSelection(),b.preventDefault()}},marker:{states:{select:{lineColor:"#8AB1D8",fillColor:null,lineWidth:2},hover:{radius:2}}},states:{select:{borderWidth:2,color:null,borderColor:"#8AB1D8"}},point:{events:{click:function(b){a._layoutOptions.selectionable&&(this.selected?this.select(!1,!0):this.select(!0,!0),a._propagateSelection(),b.preventDefault())}}}}}},this.setLegendPosition(this._layoutOptions.legendPosition,!0),this.setTitlePosition(this._layoutOptions.titlePosition,!0),this.setTooltipFormat(this._layoutOptions.tooltipFormat,!0),this.setDataLabelsFormat(this._layoutOptions.dataLabelsFormat,!0),this._fetchData()},SO.Charts.chart1D1.prototype._getPointsByMeasure=function(a){for(var b=0,c=0,d=0;this._highchartConf.series.length>d;d++){var e=this._highchartConf.series[d],f=e.name;if(f===a)for(var g=0;e.data.length>g;g++){var h=e.data[g];h.selected&&c++,b++}}return{sum:b,selected:c}},SO.Charts.chart1D1.prototype.setRenderingType=function(a){this._setRenderingType(a),this._update()},SO.Charts.chart1D1.prototype._setRenderingType=function(a){var b=this;switch(this._updateChartType(),delete this._highchartConf.plotOptions.pie,delete this._highchartConf.plotOptions.funnel,delete this._highchartConf.plotOptions.line,delete this._highchartConf.plotOptions.column,delete this._highchartConf.plotOptions.area,this._highchartConf.series||(this._highchartConf.series=[]),this._highchartConf.series[0]||(this._highchartConf.series[0]={}),a){case"pie":this._highchartConf.chart.polar=!1,this._highchartConf.xAxis.categories=null,this._highchartConf.series[0].type="pie",this._highchartConf.chart.type="pie",this._highchartConf.plotOptions.pie={cursor:this._layoutOptions.selectionable?"pointer":"default",showInLegend:!0,states:{select:{borderWidth:2,color:null,borderColor:"#8AB1D8"}},dataLabels:{enabled:this._layoutOptions.showLabels,formatter:this._layoutOptions.dataLabelsFormatter},point:{events:{legendItemClick:function(a){b._layoutOptions.selectionable&&(this.selected?this.select(!1,!0):this.select(!0,!0),b._propagateSelection(),a.preventDefault(),a.stopPropagation())}}}};break;case"funnel":this._highchartConf.chart.polar=!1,this._highchartConf.xAxis.categories=null,this._highchartConf.series[0].type="funnel",this._highchartConf.chart.type="funnel",this._highchartConf.plotOptions.funnel={cursor:this._layoutOptions.selectionable?"pointer":"default",size:"50%",showInLegend:!0,dataLabels:{enabled:this._layoutOptions.showLabels,formatter:this._layoutOptions.dataLabelsFormatter,softConnector:!0,connectorPadding:10,connectorWidth:1},states:{select:{borderColor:"#8AB1D8"}},point:{events:{legendItemClick:function(a){b._layoutOptions.selectionable&&(this.selected?this.select(!1,!0):this.select(!0,!0),b._propagateSelection(),a.preventDefault(),a.stopPropagation())}}}};break;case"donut":this._highchartConf.chart.type="pie",this._highchartConf.series[0].type="pie",this._highchartConf.chart.polar=!1;var c=[];if(this._highchartConf.xAxis.categories=c,this._highchartConf.xAxis.tickInterval=this._layoutOptions.tickInterval,this._highchartConf.plotOptions.pie={cursor:this._layoutOptions.selectionable?"pointer":"default",showInLegend:!0,dataLabels:{enabled:this._layoutOptions.showLabels,formatter:this._layoutOptions.dataLabelsFormatter},pointPadding:.2},SO.isNundef(this._layoutOptions.chartHeight))this._highchartConf.plotOptions.pie.innerSize=this._layoutOptions.donut.innerSize;else{var d=0;this._layoutOptions.showLabels&&(d=80),this._highchartConf.plotOptions.pie.size=this.element.height()-d>=this._originalHeight?this._originalHeight:this._layoutOptions.chartHeight-d,this._highchartConf.plotOptions.pie.innerSize=.7*this._highchartConf.plotOptions.pie.size}break;case"bar":this._highchartConf.chart.type="column",this._highchartConf.series[0].type="column",this._highchartConf.chart.polar=!1;var c=[];this._highchartConf.xAxis.categories=c,this._highchartConf.plotOptions.column={dataLabels:{enabled:this._layoutOptions.showLabels,formatter:this._layoutOptions.dataLabelsFormatter},states:{select:{borderWidth:2,color:null,borderColor:"#8AB1D8"}},pointPadding:.2,cursor:this._layoutOptions.selectionable?"pointer":"default"};break;case"line":this._highchartConf.series[0].type="line",this._highchartConf.chart.polar=!1;var c=[];this._highchartConf.plotOptions.line={dataLabels:{formatter:this._layoutOptions.datalabelsFormatter,enabled:this._layoutOptions.showLabels}},this._highchartConf.xAxis.categories=c;break;case"area":this._highchartConf.series[0].type="area",this._highchartConf.chart.polar=!1;var c=[];this._highchartConf.xAxis.categories=c,this._highchartConf.plotOptions.area={fillOpacity:.2,marker:{enabled:!1},dataLabels:{formatter:this._layoutOptions.datalabelsFormatter,enabled:this._layoutOptions.showLabels}};break;case"spider":this._highchartConf.series[0].type="line",this._highchartConf.chart.type="line",this._highchartConf.chart.polar=!0;var c=[];this._highchartConf.xAxis.categories=c,this._highchartConf.plotOptions.line={cursor:"pointer",dataLabels:{formatter:this._layoutOptions.datalabelsFormatter,enabled:this._layoutOptions.showLabels}}}},SO.Charts.chart1D1.prototype._bindAxisEvents=function(){var a=this,b=function(){var b=$(this).text(),c=a._findItemPosition(b);if(-1!==c){for(var d=0,e=0,f=0;a._chartRef.series.length>f;f++)a._chartRef.series[f].data[c].selected&&e++,d++;for(var g=d!==e,f=0;a._chartRef.series.length>f;f++)a._chartRef.series[f].data[c].select(g,!0)}},c=this._chartRef.xAxis[0];for(var d in c.ticks)if(void 0!==c.ticks[d].label){var e=$(c.ticks[d].label.element);e.unbind("click"),e.css("cursor","pointer"),e.click(b)}},SO.Charts.chart1D1.prototype._update=function(){this._refresh(),this._bindAxisEvents()},SO.Charts.chart1D1.prototype.rebuildLayout=function(){SO.Charts.AbstractChart.prototype.rebuildLayout.call(this),this._updateXAxisTickInterval()},SO.Charts.chart1D1.prototype._updateXAxisTickInterval=function(a){var b=200,c=this._renderingType;if(SO.isNundef(a)&&!SO.isNundef(this._chartRef)&&(a=this._chartRef.chartWidth),("line"==c||"area"==c)&&this._layoutOptions.autoTick&&!SO.isNundef(a)&&!SO.isNundef(this._measures)){var d=this._measures.length,e=parseInt(a/b),f=parseInt(d/e);this._layoutOptions.tickInterval=f,this._highchartConf.xAxis.tickInterval=f,SO.isNundef(this._chartRef)||(this._chartRef.xAxis[0].options.tickInterval=f)}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.Charts"),SO.Charts.chart1DN=function(a,b){SO.Charts.AbstractChart.apply(this,arguments);var c=this._initCheck();if(0!==c.code)return this.element.text(c.msg),void 0;this._allowedTypes=["bar","line","spider","area"],this._highchartsTypes=["column","line","line","line"],this._currentBusinessType=null,this._currentHighchartsType=null,this._updateChartType(),this._currentItems=[],this._initDataProvider(b.dataProvider,{data:b.data,metaData:b.metaData});var d={chartWidth:null,chartHeight:null,minYAxis:null,maxYAxis:null,allowDecimals:!0,chartTitle:"",colorOffset:0,chartTitleStyle:{"font-family":'"AdobeCleanLight", Arial, Verdana, Helvetica, sans-serif',"font-size":"22px",color:"rgb(75, 75, 75)"},axisTitle:"",tickInterval:null,tooltipFormat:"numberSerie",dataLabelsFormat:"serie",titlePosition:"top",legendPosition:"right",showLabels:!0,showTooltip:!0,showLegend:!0,bar:{stacked:!1},line:{stacked:!1},area:{stacked:!1},spider:{stacked:!1}};this._layoutOptions=SO.Utils.extend(d,this._layoutOptions),this._layoutOptions.locale=b.locale,this._layoutOptions.timezone=b.timezone,this._layoutOptions.autoTick=SO.isNundef(this._layoutOptions.tickInterval),this._chartIndex=this._allowedTypes.indexOf(this._renderingType),SO.assert(-1!==this._chartIndex,"Cannot create chart1DN : invalid chart type "+this._renderingType),this._setOriginalSize(),this._configure()},SO.OO.extend(SO.Charts.chart1DN,SO.Charts.AbstractChart),SO.Charts.chart1DN.prototype._initDataProvider=function(a,b){if(a)this._dataProvider=a,SO.assert(this._dataProvider.controller,"No controller defined in the data provider"),SO.assert(this._dataProvider.jpath,"No jpath defined in the data provider"),SO.assert(this._dataProvider.dimensionAttr,"No dimension defined in the data provider"),SO.assert(this._dataProvider.measureAttr,"No measure defined in the data provider");else if(b){var c=b.metaData.measureAttr,d=b.metaData.dimensionAttr;SO.assert(b.data,"Data are mandatory if you don't use a data provider"),SO.assert(d,"Dimension attribute is mandatory if you don't use a data provider"),SO.assert(c,"Measures attributes are mandatory if you don't use a data provider");var e={};e[d]={type:"string"};for(var f=0,g=c.length;g>f;f++)e[c[f]]={type:"float"};var h={data:b.data},i={data:{type:"chart",elements:e,keys:[d]}},j=new SO.MVC.Controller({model:h,metamodel:i});this._dataProvider={controller:j,jpath:"data",dimensionAttr:d,measureAttr:c}}},SO.Charts.chart1DN.prototype._fetchData=function(){var a=this,b=this._dataProvider.controller,c=this._dataProvider.jpath;this._currentJob&&this._cancel(b,c);var d={onSuccess:function(b){a._currentItems=b,a._draw()},onError:function(){},onComplete:function(){a._currentJob=null}};this._currentJob=b.getCollection(c,0,0,d,!0)},SO.Charts.chart1DN.prototype._draw=function(){var a=this._dataProvider.dimensionAttr,b=this._dataProvider.measureAttr,c=this._options.legend;this._highchartConf.xAxis.categories=[],this._highchartConf.series=[],this._measures=this._dataProvider.measureAttr;for(var d=0;this._currentItems.length>d;d++){var e=this._currentItems[d][a];this._highchartConf.xAxis.categories.push(e);for(var f=0,g=b.length;g>f;f++){var h=this._currentItems[d][b[f]];void 0===this._highchartConf.series[f]&&(this._highchartConf.series[f]={name:c[b[f]].label,color:c[b[f]].color,data:[]}),this._highchartConf.series[f].data.push({y:h,rawData:this._currentItems[d],yFormatted:this._formatValue(b[f],h)})}}0===this._currentItems.length?(this._chartRef=null,this.element.empty(),this.element.css({padding:"10px",textAlign:"center"}),this.element.text(xtk_core.charts_none())):(this._updateXAxisTickInterval(this._originalWidth),this.setRenderingType(this._currentBusinessType),this._updateColors(),this._update())},SO.Charts.chart1DN.prototype._formatValue=function(a,b){var c="";if(SO.isNundef(a)||SO.isNundef(b))return c;var d=this._options.displayFormats[a];if(SO.isNundef(d))return b;var e={locale:this._layoutOptions.locale,timezone:this._layoutOptions.timezone},f=SO.Format.formatValue(b,d,e)||b;return f},SO.Charts.chart1DN.prototype._findItemPosition=function(a){for(var b=this._dataProvider.dimension,c=0;this._currentItems[0][b].length>c;c++){var d=this._currentItems[0][b][c];if(d===a)return c}return-1},SO.Charts.chart1DN.prototype._updateChartType=function(){this._chartIndex=this._allowedTypes.indexOf(this._renderingType),SO.assert(-1!==this._chartIndex,"Cannot create chart1DN : invalid chart type "+this._renderingType),this._currentHighchartsType=this._highchartsTypes[this._chartIndex],this._currentBusinessType=this._allowedTypes[this._chartIndex]},SO.Charts.chart1DN.prototype._cancel=function(a,b){a.cancelGetCollection(b,this._currentJob)},SO.Charts.chart1DN.prototype.onJpathNotify=function(a,b){if(b=new SO.Structure.Jpath(b),b.contains(this._dataProvider.jpath))switch(a){case"strict":case"loading":break;case"add":case"cancelAdd":case"remove":case"cancelRemove":case"move":case"duplicate":case"cancelDuplicate":case"sort":case"filter":case"update":case"error":case"value":this._fetchData();break;default:throw"Unknown type in method onJpathNotify: "+a}},SO.Charts.chart1DN.prototype._configure=function(){var a=this,b=function(b){return function(){a._longClick(b)}};this._highchartConf={chart:{style:{fontFamily:"AdobeCleanLight, Arial, Verdana, Helvetica, sans-serif"},width:this._layoutOptions.chartWidth,height:this._layoutOptions.chartHeight,zoomType:"xy",renderTo:this._element,backgroundColor:"transparent",spacingBottom:20,type:this._highchartsTypes[this._chartIndex],events:{load:function(){for(var c=function(b){return function(){b.selected?b.select(!1,!0):b.select(!0,!0),a._propagateSelection()}},d=this,e=0;d.series.length>e;e++)for(var f=d.series[e].data,g=0;f.length>g;g++){var h=f[g];SO.isNundef(d.series[e].data[g].graphic)||(d.series[e].data[g].graphic.on("dblclick",b(h)),SO.Event.bind(d.series[e].data[g].graphic.element,"tap",c(h)),SO.Event.bind(d.series[e].data[g].graphic.element,"holdtouch",b(h)))}},selection:function(b){for(var c=b.xAxis[0].min,d=b.xAxis[0].max,e=b.yAxis[0].min,f=b.yAxis[0].max,g=0;this.series.length>g;g++)for(var h=this.series[g].data,i=0;h.length>i;i++){var j=h[i];j.x>=c&&d>=j.x&&j.y>=e&&f>=j.y&&j.select(!0,!0)}a._propagateSelection(),b.preventDefault()}}},title:{text:this._layoutOptions.chartTitle,style:this._layoutOptions.chartTitleStyle},xAxis:{categories:null,tickInterval:this._layoutOptions.tickInterval},yAxis:{min:this._layoutOptions.minYAxis,max:this._layoutOptions.maxYAxis,allowDecimals:this._layoutOptions.allowDecimals,title:{text:this._layoutOptions.axisTitle}},credits:{enabled:!1},tooltip:{enabled:this._layoutOptions.showTooltip,style:{fontWeight:"bold"}},plotOptions:{series:{allowPointSelect:!0,cursor:"pointer",events:{},point:{events:{click:function(b){this.selected?this.select(!1,!0):this.select(!0,!0),a._propagateSelection(),b.preventDefault()}}},marker:{states:{select:{lineColor:"#8AB1D8",fillColor:null,lineWidth:2},hover:{radius:2}}},states:{select:{borderWidth:2,color:null,borderColor:"#8AB1D8"}}}},legend:{enabled:this._layoutOptions.showLegend,borderWidth:0}},this.setLegendPosition(this._layoutOptions.legendPosition,!0),this.setTitlePosition(this._layoutOptions.titlePosition,!0),this.setTooltipFormat(this._layoutOptions.tooltipFormat,!0),this.setDataLabelsFormat(this._layoutOptions.dataLabelsFormat,!0),this._highchartConf.series=[],this._fetchData()},SO.Charts.chart1DN.prototype._getPointsByMeasure=function(a){for(var b=0,c=0,d=0;this._highchartConf.series.length>d;d++){var e=this._highchartConf.series[d],f=e.name;if(f===a)for(var g=0;e.data.length>g;g++){var h=e.data[g];h.selected&&c++,b++}}return{sum:b,selected:c}},SO.Charts.chart1DN.prototype.removeMeasure=function(a){for(var b=!1,c=this._dataProvider.measureAttr,d=0;c.length>d;d++){var e=c[d];e===a&&(c.splice(d,1),b=0)}b||SO.log.warn("The measure "+a+" doesn't exist"),this._fetchData()},SO.Charts.chart1DN.prototype.addMeasure=function(a,b,c,d){var e=this._dataProvider.controller.getValue(this._dataProvider.jpath).slice();this._options.legend[a]={label:b},d&&(this._options.legend[a].color=d),this._dataProvider.measureAttr.push(a);for(var f=0,g=e.length;g>f;f++){var h=e[f];h[a]=c[f]}this._dataProvider.controller.setValue(this._dataProvider.jpath,e),this._fetchData()},SO.Charts.chart1DN.prototype.setRenderingType=function(a){this._setRenderingType(a),this._update()},SO.Charts.chart1DN.prototype._setRenderingType=function(a){SO.assert(SO.isObject(this._highchartConf),"Cannot create chart1DN : invalid chart configuration ");var b=this._allowedTypes.indexOf(a);switch(SO.assert(-1!==b,"Cannot create chart chart1DN : invalid chart type "+a),this._chartIndex=b,delete this._highchartConf.plotOptions.line,delete this._highchartConf.plotOptions.column,delete this._highchartConf.plotOptions.area,a){case"bar":this._highchartConf.chart.type="column",this._highchartConf.chart.polar=!1;for(var c=0;this._highchartConf.series.length>c;c++)this._highchartConf.series[c].type="column";this._highchartConf.plotOptions.column={pointPadding:.2,borderWidth:0,cursor:"pointer",dataLabels:{enabled:this._layoutOptions.showLabels,formatter:this._layoutOptions.dataLabelsFormatter},states:{select:{borderColor:"#8AB1D8"}}},this._layoutOptions.bar.stacked&&(this._highchartConf.plotOptions.column.stacking="normal");break;case"line":for(var c=0;this._highchartConf.series.length>c;c++)this._highchartConf.series[c].type="line";this._highchartConf.chart.polar=!1,this._highchartConf.plotOptions.line={dataLabels:{formatter:this._layoutOptions.dataLabelsFormatter,enabled:this._layoutOptions.showLabels}},this._layoutOptions.line.stacked&&(this._highchartConf.plotOptions.line.stacking="normal");break;case"area":SO.isObject(this._highchartConf.series[0])&&(this._highchartConf.series[0].type="area"),this._highchartConf.chart.polar=!1;for(var c=0;this._highchartConf.series.length>c;c++)this._highchartConf.series[c].type="area";this._highchartConf.plotOptions.area={fillOpacity:.2,marker:{enabled:!1},dataLabels:{formatter:this._layoutOptions.dataLabelsFormatter,enabled:this._layoutOptions.showLabels}},this._layoutOptions.area.stacked&&(this._highchartConf.plotOptions.area.stacking="normal");break;case"spider":for(var c=0;this._highchartConf.series.length>c;c++)this._highchartConf.series[c].type="line";this._highchartConf.chart.type="line",this._highchartConf.chart.polar=!0,this._highchartConf.plotOptions.line={cursor:"pointer",dataLabels:{formatter:this._layoutOptions.dataLabelsFormatter,enabled:this._layoutOptions.showLabels}},this._layoutOptions.line.stacked&&(this._highchartConf.plotOptions.line.stacking="normal")}},SO.Charts.chart1DN.prototype._bindAxisEvents=function(){var a=this,b=function(){for(var b=$(this).text(),c=a._findItemPosition(b),d=null,e=0,f=0,g=0;a._chartRef.series.length>g;g++)a._chartRef.series[g].data[c].selected&&f++,e++;d=e===f?!1:!0;for(var g=0;a._chartRef.series.length>g;g++)a._chartRef.series[g].data[c].select(d,!0)},c=this._chartRef.xAxis[0];for(var d in c.ticks)if(void 0!==c.ticks[d].label){var e=$(c.ticks[d].label.element);e.unbind("click"),e.css("cursor","pointer"),e.click(b)}},SO.Charts.chart1DN.prototype._update=function(){this._refresh(),this._bindAxisEvents()},SO.Charts.chart1DN.prototype.rebuildLayout=function(){this._updateXAxisTickInterval()},SO.Charts.chart1DN.prototype._updateXAxisTickInterval=function(a){var b=200,c=this._renderingType;if(SO.isNundef(a)&&!SO.isNundef(this._chartRef)&&(a=this._chartRef.chartWidth),("line"==c||"area"==c)&&this._layoutOptions.autoTick&&!SO.isNundef(a)&&!SO.isNundef(this._currentItems)){var d=this._currentItems.length,e=parseInt(a/b),f=parseInt(d/e);this._layoutOptions.tickInterval=f,this._highchartConf.xAxis.tickInterval=f,SO.isNundef(this._chartRef)||(this._chartRef.xAxis[0].options.tickInterval=f)}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.Charts"),SO.Charts.chart2DN=function(a,b){SO.Charts.AbstractChart.apply(this,arguments);var c=this._initCheck();if(0!==c.code)return this.element.text(c.msg),void 0;this._currentItems=[],this._initDataProvider(b.dataProvider,b.data);var d={chartWidth:null,chartHeight:null,chartTitle:"",chartTitleStyle:{"font-family":'"AdobeCleanLight", Arial, Verdana, Helvetica, sans-serif',"font-size":"22px",color:"rgb(75, 75, 75)"},axisTitle:"",minYAxis:null,maxYAxis:null,allowDecimals:!0,tickInterval:null,colorOffset:0,tooltipFormat:"numberStack",tooltipDataLabels:"value",legendPosition:"right",titlePosition:"top",showLabels:!1,showTooltip:!0,showLegend:!0,mainDimension:0};if(this._layoutOptions=SO.Utils.extend(d,this._layoutOptions),this._serieColors={},this._options.data)for(var e=0;this._measures.length>e;e++){var f=this._measures[e].color||this._layoutOptions.defaultColors[e];this._serieColors[this._measures[e].name]=f}this._setOriginalSize(),this._configure()},SO.OO.extend(SO.Charts.chart2DN,SO.Charts.AbstractChart),SO.Charts.chart2DN.prototype._initDataProvider=function(a,b){if(a)this._dataProvider=a,SO.assert(this._dataProvider.controller,"No controller defined in the data provider"),SO.assert(this._dataProvider.jpath,"No jpath defined in the data provider"),SO.assert(this._dataProvider.dimension,"No dimension defined in the data provider"),SO.assert(this._dataProvider.measure,"No measure defined in the data provider");else if(b){SO.assert(b.dimensions,"Dimensions are mandatory if you don't use a data provider"),SO.assert(b.measures,"Measures are mandatory if you don't use a data provider");var c=[];c[0]={dimension:b.dimensions,measure:b.measures};var d={data:c},e={data:{type:"chart",elements:{dimension:{type:"collection",elements:{row:{type:"collection",elements:{value:{type:"float"}}}}},measure:{type:"collection",elements:{label:{type:"string"},name:{type:"string"},color:{type:"string"},data:{type:"collection",elements:{row:{type:"collection",elements:{value:{type:"float"}}}}}}}}}},f=new SO.MVC.Controller({model:d,metamodel:e});this._dataProvider={controller:f,jpath:"data",dimension:"dimension",measure:"measure"}}},SO.Charts.chart2DN.prototype._fetchData=function(){var a=this,b=this._dataProvider.controller,c=this._dataProvider.jpath;this._currentJob&&this._cancel();var d={onSuccess:function(b){a._currentItems=b,a._draw()},onError:function(){},onComplete:function(){a._currentJob=null}};this._currentJob=b.getCollection(c,0,0,d,!0)},SO.Charts.chart2DN.prototype._draw=function(){var a=this._dataProvider.dimension,b=this._dataProvider.measure;if(!this._options.data)for(var c=0;this._currentItems[0][b].length>c;c++){var d=this._currentItems[0][b][c].color||this._layoutOptions.defaultColors[c];this._serieColors[this._currentItems[0][b][c].name]=d}SO.assert(2===SO.Utils.count(this._currentItems[0][a]),"Cannot create chart2DN, chart need 2 dimensions"),this._highchartConf.xAxis={},this._highchartConf.xAxis.categories=this._currentItems[0][a][this._layoutOptions.mainDimension],this._highchartConf.series=[],this._measures=this._currentItems[0][b],this._dimensions=this._currentItems[0][a];for(var e=0===this._layoutOptions.mainDimension?1:0,f=this._dimensions[e],g=0,h=!0,c=0;f.length>c;c++)for(var i=this._transpose(c),j=0;i.length>j;j++){SO.assert(SO.isString(this._measures[j].label),"Cannot create chart2DN : measures must be identified with a correct name");var k=this._highchartConf.series.push({name:this._measures[j].label,color:this._serieColors[this._measures[j].name],showInLegend:h,stack:f[c]}),l=k-1;g++,this._highchartConf.series[l].data=[];for(var m=i[0].length,n=this._currentItems[0][b],o=0;m>o;o++)this._highchartConf.series[l].data[o]={y:i[j][o],rowData:n[o]};g===this._measures.length&&(h=!1)}0===this._currentItems.length?(this._chartRef=null,this.element.empty(),this.element.css({padding:"10px",textAlign:"center"}),this.element.text(xtk_core.charts_none())):(this._updateColors(),this._update())},SO.Charts.chart2DN.prototype._findItemPosition=function(a){for(var b=this._dataProvider.dimension,c=0;this._currentItems[0][b].length>c;c++){var d=this._currentItems[0][b][c];if(d===a)return c}return-1},SO.Charts.chart2DN.prototype._cancel=function(a,b){a.cancelGetCollection(b,this._currentJob)},SO.Charts.chart2DN.prototype.onJpathNotify=function(a,b){if(b=new SO.Jpath(b),b.contains(this._dataProvider.jpath)){switch(a){case"add":case"cancelAdd":case"remove":case"cancelRemove":case"move":case"duplicate":case"cancelDuplicate":case"strict":case"sort":case"filter":case"update":case"error":case"value":break;default:throw"Unknown type in method onJpathNotify: "+a}this._fetchData()}},SO.Charts.chart2DN.prototype._configure=function(){var a=this,b=function(b){return function(){a._longClick(b)}};this._highchartConf={chart:{width:this._layoutOptions.chartWidth,height:this._layoutOptions.chartHeight,type:"column",spacingBottom:20,backgroundColor:"transparent",renderTo:this._element,events:{load:function(){for(var c=this,d=function(b){return function(){b.selected?b.select(!1,!0):b.select(!0,!0),a._propagateSelection()}},e=0;c.series.length>e;e++)for(var f=c.series[e].data,g=0;f.length>g;g++){var h=f[g];c.series[e].data[g].graphic.on("dblclick",b(h)),SO.Event.bind(c.series[e].data[g].graphic.element,"tap",d(h)),SO.Event.bind(c.series[e].data[g].graphic.element,"holdtouch",b(h))}},selection:function(b){for(var c=b.xAxis[0].min,d=b.xAxis[0].max,e=b.yAxis[0].min,f=b.yAxis[0].max,g=0;this.series.length>g;g++)for(var h=this.series[g].data,i=0;h.length>i;i++){var j=h[i];j.x>=c&&d>=j.x&&j.y>=e&&f>=j.y&&j.select(!0,!0)}a._propagateSelection(),b.preventDefault()}},zoomType:"xy"},title:{text:this._layoutOptions.chartTitle,style:this._layoutOptions.chartTitleStyle},xAxis:{tickInterval:this._layoutOptions.tickInterval},yAxis:{min:this._layoutOptions.minYAxis,max:this._layoutOptions.maxYAxis,allowDecimals:this._layoutOptions.allowDecimals,stackLabels:{enabled:!0,formatter:function(){return this.stack}},title:{text:this._layoutOptions.axisTitle}},credits:{enabled:!1},tooltip:{enabled:this._layoutOptions.showTooltip,style:{fontWeight:"bold"}},plotOptions:{series:{cursor:"pointer",events:{legendItemClick:function(){for(var b=this.name,c=0,d=0,e=null,f=0;this.chart.series.length>f;f++){var g=this.chart.series[f],h=this.chart.series[f].data;if(g.name===b)for(var i=0;h.length>i;i++){var j=h[i];j.selected&&d++,c++}}e=c===d?!1:!0;for(var f=0;this.chart.series.length>f;f++){var g=this.chart.series[f],h=this.chart.series[f].data;if(g.name===b)for(var i=0;h.length>i;i++){var j=h[i];j.select(e,!0)}}return a._propagateSelection(),!1}},marker:{states:{select:{lineColor:"#8AB1D8",fillColor:null,lineWidth:2},hover:{radius:"2"}}},states:{select:{borderWidth:2,color:null,borderColor:"#8AB1D8"}},point:{events:{click:function(b){this.selected?this.select(!1,!0):this.select(!0,!0),a._propagateSelection(),b.preventDefault()}}}},column:{dataLabels:{enabled:this._layoutOptions.showLabels},stacking:"normal"},states:{select:{borderWidth:2,borderColor:"#8AB1D8",color:"red",fillColor:"red"},hover:{radius:2}}},legend:{enabled:this._layoutOptions.showLegend}},this.setLegendPosition(this._layoutOptions.legendPosition,!0),this.setTitlePosition(this._layoutOptions.titlePosition,!0),this.setTooltipFormat(this._layoutOptions.tooltipFormat,!0),this.setDataLabelsFormat(this._layoutOptions.dataLabelsFormat,!0),this._fetchData()},SO.Charts.chart2DN.prototype._transpose=function(a){for(var b=[],c=this._dataProvider.measure,d=this,e=0;this._currentItems[0][c].length>e;e++)b.push(d._currentItems[0][c][e].data[a]);return b},SO.Charts.chart2DN.prototype._reorder=function(a){for(var b=[],c=0;this._measures.length>c;c++){for(var d=[],e=this._measures[c].data,f=0;e.length>f;f++){var g=e[f];d.push(g[a])}b.push(d)}return b},SO.Charts.chart2DN.prototype.switchDimension=function(){var a=0===this._layoutOptions.mainDimension?1:0,b=this._dimensions[a],c=this._dimensions[this._layoutOptions.mainDimension];this._highchartConf.xAxis={},this._highchartConf.xAxis.categories=b,this._highchartConf.series=[];for(var d=0,e=!0,f=0;b.length>f;f++){var g=null;g=0===this._layoutOptions.mainDimension?this._reorder(f):this._transpose(f);for(var h=0;g.length>h;h++)this._highchartConf.series.push({name:this._measures[h].label,data:g[h],visible:NL.XTK.parseBoolean(b[f].visible,!0),color:this._serieColors[this._measures[h].name],showInLegend:e,stack:c[f]}),d++,d===this._measures.length&&(e=!1)}this._update(),this._layoutOptions.mainDimension=a},SO.Charts.chart2DN.prototype.removeMeasure=function(a){for(var b=!1,c=this._dataProvider.measure,d=0;this._currentItems[0][c].length>d;d++){var e=this._currentItems[0][c][d];e.name===a&&(this._currentItems[0][c].splice(d,1),b=0)}b||SO.log.warn("The measure "+a+" doesn't exist"),this._fetchData()},SO.Charts.chart2DN.prototype.addMeasure=function(a,b,c,d){var e=this._dataProvider.dimension,f=this._dataProvider.measure;SO.isNundef(d)&&(d=this._layoutOptions.defaultColors[this._measures.length]),this._currentItems[0][f].push({name:a,data:c,color:d,label:b}),this._serieColors[a]=d,this._initDataProvider(null,{dimensions:this._currentItems[0][e],measures:this._currentItems[0][f]}),this._fetchData()},SO.Charts.chart2DN.prototype._bindAxisEvents=function(){var a=this,b=function(){for(var b=$(this).text(),c=a._dimensions[a._layoutOptions.mainDimension].indexOf(b),d=null,e=0,f=0,g=0;a._chartRef.series.length>g;g++)a._chartRef.series[g].data[c].selected&&f++,e++;d=e===f?!1:!0;for(var g=0;a._chartRef.series.length>g;g++)a._chartRef.series[g].data[c].select(d,!0)},c=this._chartRef.xAxis[0],d=function(){for(var a in c.ticks)if(void 0!==c.ticks[a].label){var d=$(c.ticks[a].label.element);d.unbind("click"),d.css("cursor","pointer"),d.click(b)}};d()},SO.Charts.chart2DN.prototype._update=function(){this._refresh(),this._bindAxisEvents()};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.Charts"),SO.Charts.chart0DN=function(a,b){SO.Charts.AbstractChart.apply(this,arguments);var c=this._initCheck();if(0!==c.code)return this.element.text(c.msg),void 0;this._allowedTypes=["gauge","bullet"],this._highchartsTypes=["gauge","bar"],this._markers=b.markers,this._minValue=b.minValue,this._maxValue=b.maxValue,this._ranges=b.ranges;var d={chartWidth:null,chartHeight:null,chartTitle:"",colorOffset:0,chartTitleStyle:{"font-family":'"AdobeCleanLight", Arial, Verdana, Helvetica, sans-serif',"font-size":"22px",color:"rgb(75, 75, 75)"},axisTitle:{x:null,y:null},tooltipFormat:"numberValue",dataLabelsFormat:"value",legendPosition:"right",titlePosition:"top",showLabels:!1,showTooltip:!0,showLegend:!1,showMarkerLabels:!1,gauge:null,bullet:{layout:"horizontal"}};this._layoutOptions=SO.Utils.extend(d,this._layoutOptions),SO.isNundef(this._minValue)&&SO.log.warn("Cannot create chart0DN : invalid min value "),SO.isNumber(this._maxValue)||SO.log.warn("Cannot create chart chart0DN : invalid max value "),this._minValue>this._maxValue&&SO.log.warn("Cannot create chart chart0DN : min value must be smaller than max value"),this._chartIndex=this._allowedTypes.indexOf(this._renderingType),SO.assert(-1!==this._chartIndex,"Cannot create chart chart0DN : invalid chart type "+this._renderingType),this._setOriginalSize(),this._configure(),this._updateColors()},SO.OO.extend(SO.Charts.chart0DN,SO.Charts.AbstractChart),SO.Charts.chart0DN.prototype._updateColors=function(){this._highchartConf.colors=this._layoutOptions.defaultColors;for(var a=0;this._measures.length>a;a++){var b=this._measures[a];b.color&&this._highchartConf.colors.unshift(b.color)}for(var a=0;this._markers.length>a;a++){var c=this._markers[a];c.color&&this._highchartConf.colors.unshift(c.color)}},SO.Charts.chart0DN.prototype._configure=function(){if(this._highchartConf={chart:{width:this._layoutOptions.chartWidth,height:this._layoutOptions.chartHeight,renderTo:this._element,backgroundColor:"transparent",margin:[0,0,0,0],borderWidth:1,borderColor:5},credits:{enabled:!1},title:{text:this._layoutOptions.chartTitle,style:this._layoutOptions.chartTitleStyle,margin:0},plotOptions:{},xAxis:{gridLineWidth:0,title:{text:this._layoutOptions.axisTitle.x,rotation:0,align:"middle"},labels:{enabled:this._layoutOptions.showLabels,formatter:this._layoutOptions.datalabelsFormatter}},yAxis:{min:this._minValue,max:this._maxValue,gridLineWidth:0,tickWidth:2,title:{text:this._layoutOptions.axisTitle.y}},legend:{enabled:this._layoutOptions.showLegend},tooltip:{enabled:this._layoutOptions.showTooltip,style:{fontWeight:"bold"}}},SO.isNundef(this._ranges))this._highchartConf.yAxis.plotBands=[{color:{linearGradient:[400,400,0,0],stops:[[0,"rgb(255, 0, 0)"],[1,"rgb(0, 255, 0)"]]},from:this._minValue,to:this._maxValue}];else{this._highchartConf.yAxis.plotBands=[];for(var a=0;this._ranges.length>a;a++)this._highchartConf.yAxis.plotBands.push({from:this._ranges[a].from,to:this._ranges[a].to,color:this._ranges[a].color})}this.setLegendPosition(this._layoutOptions.legendPosition,!0),this.setTitlePosition(this._layoutOptions.titlePosition,!0),this.setTooltipFormat(this._layoutOptions.tooltipFormat,!0),this.setDataLabelsFormat(this._layoutOptions.datalabelsFormat,!0);var b=this._allowedTypes[this._chartIndex];this._updateColors(),this.setRenderingType(b)},SO.Charts.chart0DN.prototype.showLabels=function(a){this._layoutOptions.showLabels=a,a?(this._highchartConf.xAxis.title.text=this._layoutOptions.axisTitle.x,this._highchartConf.yAxis.title.text=this._layoutOptions.axisTitle.y):(this._highchartConf.xAxis.title.text=null,this._highchartConf.yAxis.title.text=null),this._refresh()},SO.Charts.chart0DN.prototype.removeMeasure=function(a){for(var b=this._allowedTypes[this._chartIndex],c=!1,d=0;this._measures.length>d;d++){var e=this._measures[d];e.name===a&&(this._measures.splice(d,1),c=0)}c||SO.log.warn("The measure "+a+" doesn't exist"),this.setRenderingType(b)},SO.Charts.chart0DN.prototype.addMeasure=function(a,b,c,d){var e=this._allowedTypes[this._chartIndex];this._measures.push({name:a,data:[c],color:d,label:b}),this.setRenderingType(e)},SO.Charts.chart0DN.prototype.removeMarker=function(a){for(var b=this._allowedTypes[this._chartIndex],c=!1,d=0;this._markers.length>d;d++){var e=this._markers[d];e.name===a&&(this._markers.splice(d,1),c=0)}c||SO.log.warn("The marker "+a+" doesn't exist"),this.setRenderingType(b)},SO.Charts.chart0DN.prototype.addMarker=function(a,b,c,d){var e=this._allowedTypes[this._chartIndex];this._markers.push({name:a,data:[c],color:d,label:b}),this.setRenderingType(e)},SO.Charts.chart0DN.prototype.setRenderingType=function(a){SO.assert(SO.isObject(this._highchartConf),"Cannot create chart0DN  : invalid chart configuration ");var b=this._allowedTypes.indexOf(a);switch(SO.assert(-1!==b,"Cannot create chart0DN : invalid chart type "+a),this._chartIndex=b,delete this._highchartConf.plotOptions.gauge,delete this._highchartConf.plotOptions.scatter,delete this._highchartConf.plotOptions.bar,delete this._highchartConf.series,delete this._highchartConf.pane,a){case"gauge":this._highchartConf.chart.height=null,this._highchartConf.chart.margin=[0,0,0,0],this._highchartConf.title.text=this._layoutOptions.chartTitle,this._highchartConf.yAxis.title.text=this._layoutOptions.axisTitle.y,this._highchartConf.pane={startAngle:-90,endAngle:90,background:"#CCCCCC",center:["50%","95%"],size:300},this._highchartConf.chart.type="gauge",this._highchartConf.plotOptions.gauge={dataLabels:{enabled:this._layoutOptions.showLabels,formatter:this._layoutOptions.datalabelsFormatter},dial:{baseWidth:4,topWidth:1},showInLegend:!0},this._highchartConf.series=[];for(var c=0;this._measures.length>c;c++){SO.assert(SO.isString(this._measures[c].label),"Cannot create chart0DN : measures must be identified with a correct name");var d=this._measures[c].color||this._layoutOptions.defaultColors[c];this._highchartConf.series.push({name:this._measures[c].label,data:[this._measures[c].data],color:d,dial:{backgroundColor:d}})}if(!SO.isNundef(this._markers))for(var c=0;this._markers.length>c;c++){SO.assert(SO.isString(this._markers[c].label),"Cannot create chart0DN : markers must be identified with a correct name");var d=this._markers[c].color||this._layoutOptions.defaultColors[this._markers.length+c];this._highchartConf.series.push({name:this._markers[c].label,data:[this._markers[c].data],dial:{backgroundColor:d}})}break;case"bullet":var e="/nl/core/widgets/charts/chartMarker.png",f=null;"horizontal"===this._layoutOptions.bullet.layout&&(f="bar",this._highchartConf.chart.type="bar",this._highchartConf.xAxis.tickWidth=0,this._highchartConf.xAxis.gridLineWidth=0,this._highchartConf.chart.height=100,this._highchartConf.chart.width=null,this._highchartConf.chart.margin=[10,10,50,100],this._highchartConf.title.text=null,this._highchartConf.plotOptions.bar={borderColor:null},this._highchartConf.xAxis.title.text=this._layoutOptions.axisTitle.x,this._highchartConf.yAxis.title.text=this._layoutOptions.chartTitle),"vertical"===this._layoutOptions.bullet.layout&&(f="column",this._highchartConf.chart.type="column",this._highchartConf.xAxis.tickWidth=0,this._highchartConf.xAxis.gridLineWidth=0,this._highchartConf.chart.height=420,this._highchartConf.chart.width=150,this._highchartConf.chart.margin=[10,10,50,100],this._highchartConf.title.text=null,this._highchartConf.plotOptions.column={borderColor:null},this._highchartConf.yAxis.title.text=this._layoutOptions.chartTitle,this._highchartConf.xAxis.title.text=this._layoutOptions.axisTitle.x),this._highchartConf.plotOptions.scatter={lineColor:"#000000",showInLegend:!1,dataLabels:{enabled:this._layoutOptions.showMarkerLabels,color:"#DDDDDD",rotation:-45,formatter:function(){return"<b>"+this.series.name+"</b>"}},marker:{lineWidth:1,symbol:"url("+e+")"}},this._highchartConf.series=[];var g=this._measures[0];if(SO.assert(!SO.isString(g.label),"Cannot create chart0DN : measures must be identified with a correct name"),this._highchartConf.series.push({name:g.label,data:[g.data],color:g.color,type:f}),!SO.isNundef(this._markers))for(var c=0;this._markers.length>c;c++)SO.assert(SO.isString(this._markers[c].label),"Cannot create chart0DN : markers must be identified with a correct name"),this._markers[c].name||this._markers[c].label,this._highchartConf.series.push({name:this._markers[c].name,data:[this._markers[c].data],color:this._markers[c].color,type:"scatter"})}this._update()},SO.Charts.chart0DN.prototype._update=function(){this._refresh()};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.RenderFunctions"),SO.RenderFunctions._listRailStyleItemRenderer=function(a,b,c,d){d.parent().removeClass("nlui-list-item-default").addClass("nlui-list-item-rail"),d.addClass("nlui-list-rail-line"),d.addClass(a&&"right"===a.align?"nlui-list-rail-line-right":"nlui-list-rail-line-left");var e=$('<div class="nlui-list-rail-cell"></div>');if(a&&a.withIcons){var f=$('<span class="nlui-icon20"></span>').appendTo(e);SO.isEmpty(c)?f.addClass("nlui-icon-none"):f.addClass("nlui-icon-inverse "+c)}return $("<span></span>").text(b).appendTo(e),e},SO.RenderFunctions.railItemRenderer=function(a){return function(b,c,d){return SO.RenderFunctions._listRailStyleItemRenderer(a,b.label,b.icon,d)}};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("TextFormat",{_modeClasses:{"default":"nlui-textformat-mode-default",primary:"nlui-textformat-mode-primary",error:"nlui-textformat-mode-error",success:"nlui-textformat-mode-success",warning:"nlui-textformat-mode-warning"},_typeClasses:{info:"coral-infoCircle",help:"coral-helpCircle",error:"coral-alert",success:"coral-checkCircle",warning:"coral-alert"},DEFAULT_OPTIONS:{value:"",icon:null,params:{style:""}},_create:function(){return this._$text=null,this._$iconContainer=null,this._type=this._options.params.type||null,this._type&&(this._options.params.icon=this._typeClasses[this._type],this._options.params.style="emphasis"),this._icon=this._options.params.icon,this._updateValue(this._options.value),this._mode=this._options.params.mode||null,this._refreshDisplay(!0),this},_updateValue:function(a){var b={locale:this._options.locale,timezone:this._options.timezone};this._value=SO.Format.formatValue(a,void 0,b)||"",this._value=this._value.trim()},_refreshDisplay:function(a){if(a&&this._createMarkup(),this._$text.text(this._value),a&&this._$text.appendTo(this.$el),this._icon){var b=SO.IMG.genIcon(this._icon,12),c="nlui-textformat-wrap "+(this._type?"nlui-textformat-type":"");this._$iconContainer.html(b.el||b),this._$iconContainer.show(),this.$el.wrapInner($("<span />").addClass(c))}else this._$iconContainer.empty(),this._$iconContainer.hide();return this},_createMarkup:function(){this._$text&&this._$text.remove(),this._$text=$("<span />"),this._$iconContainer&&this._$iconContainer.remove(),this._$iconContainer=$("<span />").addClass("nlui-textformat-image"),this._$iconContainer.hide(),this.$el.prepend(this._$iconContainer),this.$el.addClass("nlui-textformat");var a=""!==this._options.params.style?"nlui-textformat-"+this._options.params.style:"";return this._$text.addClass(a),this._mode&&this._$text.addClass(this._modeClasses[this._mode]),this},getValue:function(){return this._value},setValue:function(a){this._updateValue(a),this._refreshDisplay(!0)},getStyle:function(){return this._options.params.style},setStyle:function(a){this._options.params.style=a,this._refreshDisplay(!0)},setMode:function(a){this._$text.removeClass(this._mode),this._mode=a,this._refreshDisplay(!0)}}),$.widget("SO.soTextFormat",{_create:function(){this._widget=new SO.Widgets.TextFormat(this.element,this.options)},getValue:function(){return this._widget.getValue()},setValue:function(a){this._widget.setValue(a)},getStyle:function(){return this._widget.getStyle()},setStyle:function(a){this._widget.setStyle(a)},setMode:function(a){this._widget.setMode(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Well",{DEFAULT_OPTIONS:{children:[],params:{title:null}},_create:function(){return this.$el.addClass("nlui-well"),this._$container=null,this._$children=this._options.children,this._$content=null,this._createMarkup(),this},_createMarkup:function(){this._$container=$("<section />").addClass("nlui-well-container"),this._options.params.title&&$("<h4 />").addClass("nlui-well-title").text(this._options.params.title).appendTo(this._$container),this._$content=$("<div />").addClass("nlui-well-content");for(var a in this._$children)this._$content.append(this._$children[a]);return this._$container.append(this._$content),this.$el.append(this._$container),this}}),$.widget("SO.soWell",{_create:function(){this._widget=new SO.Widgets.Well(this.element,this.options)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Section",{DEFAULT_OPTIONS:{children:[],params:{title:"",headLine:!0,style:"",expandable:!1,collapsed:!0}},_create:function(){return this._$container=null,this._$children=this._options.children,this._$content=null,this._title=this._options.params.title||"",this._style=this._options.params.style,this._expandable=this._options.params.expandable,this._collapsed=this._options.params.collapsed,this._refreshDisplay(!0),this},_refreshDisplay:function(a){return a&&(this._createMarkup(),this.$el.html(this._$container)),this},_createMarkup:function(){this.$el.addClass("nlui-section");var a="nlui-sectionTab"+(""!==this._style?" nlui-sectionTab-"+this._style:""),b=$("<span />").addClass("nlui-section-collapse");this._$container=$("<section />").addClass("nlui-sectionContainer"),this._$title=$("<div />").addClass("nlui-section-header"),this._expandable&&("large"===this._style&&b.addClass("nlui-section-large"),SO.IMG.genIcon(this._collapsed?"section-collapsed":"section-opened",12).appendTo(b),this._$title.append(b).addClass("nlui-section-cursor")),this._$title.append($("<h4 />").addClass(a).text(this._title)),this._options.params.headLine?$("<hr />").addClass("nlui-sectionLine").appendTo(this._$container):this._$title.addClass("nlui-sectionWithoutLine"),this._$content=$("<div />").addClass("nlui-sectionContent");for(var c in this._$children)this._$content.append(this._$children[c]);return this._expandable&&(this._collapsed&&this._$content.hide(),this._$title.click({display:this._collapsed,$content:this._$content,$headerIcon:b},this._toggle)),this._$title.prependTo(this._$container),this._$content.appendTo(this._$container),this},setTitle:function(a){this._options.params.title=a,this._refreshDisplay(!0)},_toggle:function(a){var b=a.data;b.$headerIcon.empty(),b.display?(b.$content.slideDown(),SO.IMG.genIcon("section-opened",12).prependTo(b.$headerIcon)):(b.$content.slideUp(),SO.IMG.genIcon("section-collapsed",12).prependTo(b.$headerIcon)),b.display=!b.display}}),$.widget("SO.soSection",{_create:function(){this._widget=new SO.Widgets.Section(this.element,this.options)},setTitle:function(a){this._widget.setTitle(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Tile",{DEFAULT_OPTIONS:{clickArea:"button",mode:"flip",dialogMode:null,navigationURL:null,width:"auto",height:"auto",front:{},back:{},fullWidth:!1,fullHeight:!1,defaultSide:"front"},_create:function(){var a;return this._options.params&&(this._options=SO.Utils.extend(this._options,this._options.params),SO.assert(!this._options.params,"Tile _options.params is deprecated, use _options instead.")),this._$stateBars={front:null,back:null},this._sides={front:{$container:null,$body:null,$header:null,$title:null,$actionBar:null,$stateBar:null,$headerIcon:null},back:{$container:null,$body:null,$header:null,$title:null,$actionBar:null,$stateBar:null,$headerIcon:null}},this._currentSide=this._options.defaultSide,this._switchSideClassName="nlui-tile-sideback",this._isFrontBuilt=!1,this._isBackBuilt=!1,this._$container=$('<div class="nlui-tile-container"></div>'),a=["nlui-tile"],"flip"===this._options.mode?a.push("nlui-tile-mode-flip"):"dialog"===this._options.mode&&a.push("nlui-tile-mode-dialog"),this._options.fullWidth&&a.push("nlui-tile-fullwidth"),this._options.fullHeight&&a.push("nlui-tile-fullheight"),this.$el.css({width:this._options.fullWidth?null:this._options.width,height:this._options.fullHeight?null:this._options.height}),this.$el.addClass(a.join(" ")).append(this._$container),"back"===this._currentSide?this.showBack():this.showFront(),"body"===this._options.clickArea&&this.$el.addClass("nlui-tile-clickarea-body"),(this._options.front.vAlign||this._options.front.hAlign||this._options.back.vAlign||this._options.back.hAlign)&&this._options.layoutManager.registerWidget(this),this},rebuildLayout:function(){return this._options.front.vAlign&&this._isFrontBuilt&&this._verticalAlign("front"),this._options.back.vAlign&&this._isBackBuilt&&this._verticalAlign("back"),this._options.front.hAlign&&this._isFrontBuilt&&this._horizontalAlign("front"),this._options.back.hAlign&&this._isBackBuilt&&this._horizontalAlign("back"),this},setTitle:function(a,b){return"back"===a&&"dialog"===this._options.mode?this._backDialog.setTitle(b):(this._sides[a].$header||this._buildHeader(a),this._sides[a].$title.text(b)),this},_buildHeader:function(a){var b,c,d,e,f;e=this._sides[a],c=e.$container,f=this._options[a],b=f.header,b&&null!==b.title&&(e.$title=$('<span class="nlui-tile-header-title"></span>'),e.$header=d=$('<div class="nlui-tile-header"></div>').append(e.$title),c.append(d),f.state&&this.setState(a,f.state),b.title&&this.setTitle(a,b.title),b.icon&&this.setHeaderIcon(a,b.icon))},setHeaderIcon:function(a,b){var c=this._sides[a];return c.$headerIcon||(c.$headerIcon=$('<div class="nlui-tile-header-icon-container"></div>'),c.$header.append(c.$headerIcon)),c.$headerIcon.append(NL.View.genImage(b,20,!1,0)),this},setState:function(a,b){var c,d;switch(c=this._sides[a],c.$stateBar||this._addStateBar(a),b){case"error":d="nlui-tile-statebar-error";break;case"success":d="nlui-tile-statebar-success";break;case"primary":d="nlui-tile-statebar-primary";break;case"normal":d="nlui-tile-statebar-normal"}return c.$stateBar.addClass(d),this},_addStateBar:function(a){var b=this._sides[a];return b.$stateBar=$('<div class="nlui-tile-statebar"></div>'),b.$header.addClass("nlui-tile-header-hasstate").append(b.$stateBar),this},_buildFront:function(a){var b,c,d,e;if(b=this,d="front",a=void 0===a?!0:a,c=this._options.front,this._sides[d].$container=e=$('<div class="nlui-tile-front nlui-tile-side"></div>'),this._buildHeader(d),this._$container.append(e),e.append(this._sides.front.$body=$('<div class="nlui-tile-body nlui-tile-front-body"></div>')),this._sides.front.$body.addClass("nlui-tile-haspadding"),this._options.front.padding===!1&&this._sides.front.$body.removeClass("nlui-tile-haspadding"),c.content)if(SO.isFunction(c.content)){this._prepareInsertion("front");var f=c.content(this._sides.front.$body);f&&!f[0].parentElement&&this._sides.front.$body.append(f)}else this.insertContent("front",c.content);return a||this.showBack(),"body"!==this._options.clickArea&&this._options.footer!==!1?this._genFooter("front"):"body"===this._options.clickArea?(e.addClass("nlui-tile-side-nofooter"),this._sides.front.$body.on("click",function(){b._executeToggleAction("back")})):this._options.footer===!1&&e.addClass("nlui-tile-side-nofooter"),this},_buildBack:function(a){var b,c,d,e;switch(b=this,c="back",a=void 0===a?!0:a,e=this._options.back.header,this._options.mode){case"flip":this._sides[c].$container=d=$('<div class="nlui-tile-back nlui-tile-side"></div>'),this._buildHeader(c),d.append(this._sides.back.$body=$('<div class="nlui-tile-body nlui-tile-back-body"></div>')),this._$container.append(d),"body"!==this._options.clickArea&&this._options.footer!==!1?this._genFooter("back"):this._options.footer===!1&&d.addClass("nlui-tile-side-nofooter"),this._appendBackContent();break;case"dialog":this._isBackBuilt=!0,this._appendBackContent()}return a||this.showFront(),this},_appendBackContent:function(){if(this._options.back.content)if(SO.isFunction(this._options.back.content)){this._prepareInsertion("back");var a=this._options.back.content(this._sides.back.$body);a&&!a[0].parentElement&&this._sides.back.$body.append(a)}else this.insertContent("back",this._options.back.content);return this},_genFooter:function(a){var b,c,d,e,f;return b=this,c=this._options[a],e=this._sides[a].$container,f=c.footer&&c.footer.icon?c.footer.icon:"nlui-icon-tile-toggle",d="back"===a?"front":"back",this._$footer=$("<div class='nlui-tile-footer'></div>").append(NL.View.genImage(f,20,!1,0).addClass("nlui-tile-bar-icon").on("click",function(){b._executeToggleAction(d)})).appendTo(e),this},_executeToggleAction:function(a){return"navigation"===this._options.mode?this._navigate():this._show(a),this},showFront:function(){return this._show("front"),this},showBack:function(){return this},toggle:function(){return this},_show:function(a){var b=this._sides.back;return this._currentSide=a,"front"===this._currentSide?(this._isFrontBuilt||(this._isFrontBuilt=!0,this._buildFront()),"flip"===this._options.mode||"navigation"===this._options.mode?this.$el.removeClass(this._switchSideClassName):"dialog"===this._options.mode&&b.$container&&this._backDialog.close()):(this._buildBack(),("flip"===this._options.mode||"navigation"===this._options.mode)&&this.$el.addClass(this._switchSideClassName)),this._refreshCurrentSideSize(),this._options.layoutManager.rebuildLayout(this._sides[a].$container),this._options[a].vAlign&&this._verticalAlign(a),this._options[a].hAlign&&this._horizontalAlign(a),this},_verticalAlign:function(a){var a,b;return a=this._sides[a],b=a.$body,a.$alignContainer||(a.$alignContainer=$("<div></div>").append(b.children()),b.append(a.$alignContainer)),a.$alignContainer.addClass("nlui-tile-side-valign").css("margin-top",-(a.$alignContainer[0].offsetHeight/2)+"px"),this},_horizontalAlign:function(a){var a,b;return a=this._sides[a],b=a.$body,a.$alignContainer||(a.$alignContainer=$("<div></div>").append(b.children()),b.append(a.$alignContainer)),a.$alignContainer.addClass("nlui-tile-side-halign"),this},_prepareInsertion:function(a){return"front"===a?this._isFrontBuilt||(this._isFrontBuilt=!0,this._buildFront("front"===this._currentSide)):this._isBackBuilt||(this._isBackBuilt=!0,this._buildBack("back"===this._currentSide)),this},insertContent:function(a,b){return this._prepareInsertion(a),this._sides[a].$body.append(b),this},_refreshCurrentSideSize:function(){var a=this._options[this._currentSide].width,b=a?a:this._options.width,c=this._options[this._currentSide].height,d=c?c:this._options.height;return b&&"auto"!==b?this.$el.width(b):this.$el[0].style.width=null,d&&"auto"!==d?this.$el.height(d):this.$el[0].style.height=null,this},_navigate:function(){return window.location.href=this._options.navigationURL,this},setNavigationURL:function(a){return this._options.navigationURL=a,this}}),$.widget("SO.soTile",{_create:function(){this._widget=new SO.Widgets.Tile(this.element,this.options)},setNavigationURL:function(a){this._widget.setNavigationURL(a)},setTitle:function(a,b){this._widget.setTitle(a,b)},destroy:function(){this._widget.destroy()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Wizard",{DEFAULT_OPTIONS:{theme:"light",lastButtonConfig:{label:xtk_sirocco.wizard_lastButtonLabel(),mode:"transparent",icon:"coral-addCircle",onSuccess:null},navigationBar:{navigationLeft:null,navigationRight:null,breadCrumb:null,originalStyle:!1},parent:null,stepPadding:!0,beginingStep:1,onAbort:null,steps:[]},_statusClass:{current:{line:"nlui-wizard-line-current",dot:"nlui-wizard-dot-current"},complete:{line:"nlui-wizard-line-complete",dot:"nlui-wizard-dot-complete"}},_create:function(){this._steps=SO.Utils.extend(this._options.steps),this._speciaButton=null,this._beginingStep=this._options.beginingStep,this._cmdBar={left:null,right:null},this._content=null,this._buttonsMode="start",this._stepsHandler=this._stepsHandler(),this._stepsHandler._init(),SO.assert(0!==this._steps.length,"Wizard Widget initialized without steps"),this._stepElements=[],this._buildMarkup();var a=this._getMaxZindex();SO.isInteger(a)&&this.$el.css("z-index",a)},_getMaxZindex:function(){var a,b,c,d;return d=$("body > .nlui-wizard, body > .nlui-dialog"),c=Math.max.apply(null,$.map(d,function(c){return a=$(c),b=a.css("position"),"absolute"===b||"fixed"===b?parseInt($(c).css("z-index"),10)||1:void 0}))},_stepsHandler:function(){var a=this;return{_init:function(){this._currentStep=1,this._stepsValidation={};for(var b=a._beginingStep,c=0;a._steps.length>c;c++){var d=a._steps[c].id,e=!1,f=!1;b-1>c&&(e=!0,f=!0),this._stepsValidation[d]={validated:e,requested:f},SO.assert(!SO.isNundef(d),"Error in widget wizard, steps required an id"),SO.assert(null!==a._steps[c].onValidation,"Error in widget wizard, validation function is required")}},_getCurrentStep:function(){return this._currentStep},_setCurrentStep:function(a){this._currentStep=a},_isStepValidated:function(a){return this._stepsValidation[a].validated},_isStepRequested:function(a){return this._stepsValidation[a].requested},_lastStepValidation:function(b){this._allStepsValide()?(a._options.lastButtonConfig.onSuccess&&a._options.lastButtonConfig.onSuccess(),a.destroy()):(a._updateStepsContainer(),this._stepsValidation[b].requested=!1)},_nextStep:function(){var b=this,c=a._steps[this._currentStep-1].id;this._stepsValidation[c].requested=!0,a._options.steps[this._currentStep-1].onValidation(function(){if(b._stepsValidation[c].validated){if(b._currentStep++,b._currentStep===a._steps.length+1||b._allStepsValide()&&b._currentStep===a._steps.length+1)return b._lastStepValidation(c),void 0;var d=a._steps[b._currentStep-1].id;a._setMode(),a._buildStep(d)}a._updateStepsContainer()})},_previousStep:function(){var b=a._steps[this._currentStep-1].id,c=a._steps[this._currentStep-2].id;this._stepsValidation[b].validated=!1,this._stepsValidation[b].requested=!1,this._stepsValidation[c].validated=!0,this._stepsValidation[c].requested=!1,this._currentStep--,a._setMode(),a._buildStep(a._steps[this._currentStep-1].id),a._updateStepsContainer()},_validateStep:function(b,c){-1!==a._findStepNumberById(b)?("validated"===c&&(this._stepsValidation[b].validated=!0,this._stepsValidation[b].requested=!0),"unvalidated"===c&&(this._stepsValidation[b].validated=!1,this._stepsValidation[b].requested=!0)):SO.log.warn("In widget wizard, trying to validate a step that didn't exist "+b)},_allStepsValide:function(){var a=!0;for(var b in this._stepsValidation)this._stepsValidation.hasOwnProperty(b)&&(this._stepsValidation[b].validated||(a=!1));return a}}},_setMode:function(){var a=this._stepsHandler._getCurrentStep();this._buttonsMode=a===this._steps.length?"finish":1===a?"start":"run"},validateStep:function(a,b){this._stepsHandler._validateStep(a,b),this._setButtonsMode()},getStepStatus:function(a,b){return-1===this._findStepNumberById(a)?!1:"validated"===b?this._stepsHandler._isStepValidated(a):"requested"===b?this._stepsHandler._isStepRequested(a):!1},_findStepNumberById:function(a){for(var b=0;this._steps.length>b;b++){var c=this._steps[b].id;if(c===a)return b+1}return-1},_buildStep:function(a){for(var b=0;this._steps.length>b;b++){var c=this._steps[b].id;c===a&&(null!==this._content&&this._content.detach(),this._content=this._steps[b].content,this._content.addClass("nlui-wizard-stepcontent"),this._content.addClass("haspadding"),this._options.stepPadding===!1&&this._content.removeClass("haspadding"),this.$el.append(this._content),this._content.show(),this._setButtonsMode(),this._addSpecialButton(a),this._steps[b].onDisplay&&this._steps[b].onDisplay())}},_addSpecialButton:function(a){var b=this._findStepNumberById(a);if(-1!==b){var c=b-1,d=this._steps[c].specialButton;if(d){var e={icon:null,label:d.label,mode:d.mode||"transparent",command:function(){d.onClick()}};this._cmdBar.left.soCmdBar("addCommand","special",e);var f=this._cmdBar.left.soCmdBar("getCommands")[1];f.addClass("nlui-wizard-specialbutton")}else this._cmdBar.left.soCmdBar("removeCommand","special")}},_addCloseButton:function(){var a;return a=this,this._$closeBt=new SO.Widgets.SimpleButton($("<span>"),{icon:"coral-closeCircle",mode:"quiet",iconSize:18,label:this._options.cancelButtonCommand.label,onClick:function(){a._cancel()}}),this._$closeBt.$el.css("padding-right","10px"),this._$rightHeaderContent.prepend(this._$closeBt.$el),this._$closeBt},_addHeader:function(){var a="nlui-wizard-header originalstyle nlui-wizard-header-align-center";this._$headerContent=$('<div class="nlui-wizard-header-content"></div>'),this._$header=$('<div class="'+a+'"></div>').append(this._$headerContent),this._$leftHeaderContent=$('<div class="nlui-wizard-header-left"></div>'),this._$rightHeaderContent=$('<div class="nlui-wizard-header-right"></div>'),this._$header.prepend(this._$leftHeaderContent,this._$rightHeaderContent),this.$el.append(this._$header)},_addCmdBar:function(a,b){var c,d,e;d="nlui-wizard-cmdbar","right"===a?(d+=" nlui-wizard-cmdbar-right",e=this._$rightHeaderContent):(d+=" nlui-wizard-cmdbar-left",e=this._$leftHeaderContent),this._cmdBar[a]=c=$('<div class="'+d+'"></div>').soCmdBar({iconSize:b.iconSize,separators:!1,rightSeparator:!1,leftSeparator:!1,commands:b.commands,commandConfigs:b.commandConfigs,controller:b.controller,onRefreshVisibility:b.onRefreshVisibility}),e.append(c),"right"===a&&this._$title&&this._$title.css("margin-left",c.outerWidth(!0)+"px")},_cancel:function(){var a=this;if(!a._stepsHandler._allStepsValide())var b=$("<div></div>").soMessageBox({message:xtk_sirocco.wizard_abortMessage(),type:"confirm",confirmButtonLabel:"Ok",title:xtk_sirocco.wizard_abortTitle(),onConfirm:function(){a._options.onAbort&&a._options.onAbort(),a.destroy(),b.remove()}})},_outsourcedRendering:function(a,b){null!==this._options.navigationBar[a]?(this._options.navigationBar[a].addClass("nlui-wizard-header"),this._options.navigationBar.originalStyle&&this._options.navigationBar[a].addClass("originalstyle"),"breadCrumb"===a?this._$headerContent.appendTo(this._options.navigationBar[a]):"navigationLeft"===a?this._$leftHeaderContent.appendTo(this._options.navigationBar[a]):"navigationRight"===a&&this._$rightHeaderContent.appendTo(this._options.navigationBar[a])):b.full=!1},_buildMarkup:function(){var a,b,c;a=this,this.$el.addClass("nlui-wizard"),this._createStepsContainer(),this._addHeader(),this._$headerContent.empty().append(this._$stepsContainer),this.$el.append(this._content),b={iconSize:24,commandConfigs:{prev:{icon:"coral-arrowLeft",mode:"quiet",command:function(){a._stepsHandler._previousStep()}}},commands:["prev"]},c={iconSize:18,commandConfigs:{next:{icon:"coral-arrowRight",mode:"transparent",iconSize:24,command:function(){a._stepsHandler._nextStep()}},end:{icon:this._options.lastButtonConfig.icon,label:this._options.lastButtonConfig.label,mode:"transparent",command:function(){a._stepsHandler._nextStep()}}},commands:["end","next"]},this._addCmdBar("left",b),this._addCmdBar("right",c);var d=this._cmdBar.right.soCmdBar("getCommands")[1];d.addClass("nlui-wizard-endbutton"),this.cancelCallback=function(b,c){27===b.keyCode&&a._cancel(b,c)},$("body").on("keydown",this.cancelCallback),this._addCloseButton(),this._stepsHandler._setCurrentStep(this._options.beginingStep),this._buildStep(this._steps[this._options.beginingStep-1].id),this._updateStepsContainer(),this._options.parent?this.$el.appendTo(this._options.parent):(this.$el.appendTo($("body")),this.$el.addClass("fullsize"));var e={full:!0};return this._outsourcedRendering("breadCrumb",e),this._outsourcedRendering("navigationLeft",e),this._outsourcedRendering("navigationRight",e),e.full&&this._$header.remove(),this},_updateStepsContainer:function(){var a,b,c,d,e;a=this;var f=this._options.navigationBar.breadCrumb?this._options.navigationBar.breadCrumb:this._$stepsContainer;return $(".nlui-wizard-line",f).each(function(f){a.clearStepStatus(f),b=a._steps[f].id,c=!1,d=a._stepsHandler._isStepValidated(b),e=a._stepsHandler._isStepRequested(b),f===a._stepsHandler._getCurrentStep()-1&&(c=!0,a.setStepStatus(f,"current")),c&&!e&&a.setStepStatus(f,"current"),d&&e&&a.setStepStatus(f,"complete"),!c&&e&&a.setStepStatus(f,"complete")}),this},_createStepsContainer:function(){var a,b,c,d,e,f;b=this,e=this.getTheme()||"clui-light",f="clui-dark",this._$stepsContainer=$("<div class='nlui-wizard-line-container "+f+"'></div>");for(var a=0;this._steps.length>a;a++)c=this._steps[a].label,d=this._steps[a].id,SO.assert(SO.isString(c),"In soWizard, step "+(a+1)+" has no label defined"),SO.assert(SO.isString(c),"In soWizard, step "+(a+1)+" has no id defined"),this.addStep(c),a===b._stepsHandler._getCurrentStep()-1&&this.setStepStatus(a,"current"),b._stepsHandler._isStepValidated(d)&&b._stepsHandler._isStepRequested(d)&&this.setStepStatus(a,"complete");return this},addStep:function(a){var b,c,d;return b=this._stepElements.length+1,c=$('<div class="nlui-wizard-line"></div>').text(a),d=$('<div class="nlui-wizard-dot"></div>').text(b),this._$stepsContainer.append(d,c),this._stepElements.push({$line:c,$dot:d}),this},removeStepStatus:function(a,b){var c;return c=this._stepElements[a],c.$line.removeClass(this._statusClass[b].line),c.$dot.removeClass(this._statusClass[b].dot),c.status=null,this},clearStepStatus:function(a){var b;return b=this._stepElements[a],b.$line.removeClass(this._statusClass.complete.line+" "+this._statusClass.current.line),b.$dot.removeClass(this._statusClass.complete.dot+" "+this._statusClass.current.dot),this},setStepStatus:function(a,b){var c,d;return c=this._stepElements[a],d=SO.IMG.genIcon("coral-check",18),d.setState("parent"),c.status&&("complete"===c.status&&c.$dot.text(a+1),this.removeStepStatus(a,c.status)),c.$line.addClass(this._statusClass[b].line),c.$dot.addClass(this._statusClass[b].dot),"clui-dark"===this.getTheme()&&d.setState("inverse"),"complete"===b&&c.$dot.text("").append($(d.el).addClass("nlui-wizard-complete-icon")),c.status=b,this},_setButtonsMode:function(){switch(this._buttonsMode){case"start":this._cmdBar.left.soCmdBar("setCommandAttribute","prev","hidden",!0),this._cmdBar.right.soCmdBar("setCommandAttribute","next","disabled",!1),this._cmdBar.right.soCmdBar("setCommandAttribute","next","hidden",!1),this._cmdBar.right.soCmdBar("setCommandAttribute","next","mode","transparent"),this._cmdBar.right.soCmdBar("setCommandAttribute","end","hidden",!0);break;case"run":this._cmdBar.left.soCmdBar("setCommandAttribute","prev","hidden",!0),this._cmdBar.right.soCmdBar("setCommandAttribute","next","hidden",!1),this._cmdBar.right.soCmdBar("setCommandAttribute","next","disabled",!1),this._cmdBar.right.soCmdBar("setCommandAttribute","next","mode","transparent"),this._cmdBar.right.soCmdBar("setCommandAttribute","end","hidden",!0);break;case"finish":this._cmdBar.left.soCmdBar("setCommandAttribute","prev","hidden",!0),this._cmdBar.right.soCmdBar("setCommandAttribute","next","hidden",!0),this._cmdBar.right.soCmdBar("setCommandAttribute","next","mode","default"),this._cmdBar.right.soCmdBar("setCommandAttribute","end","hidden",!1),this._cmdBar.right.soCmdBar("setCommandAttribute","end","disabled",!1)}},destroy:function(){this._options.navigationBar.breadCrumb&&this._options.navigationBar.breadCrumb.remove(),this._options.navigationBar.navigationLeft&&this._options.navigationBar.navigationLeft.remove(),this._options.navigationBar.navigationRight&&this._options.navigationBar.navigationRight.remove(),$("body").off("keydown",this.cancelCallback),this.$el.children().remove()}}),$.widget("SO.soWizard",{_create:function(){this._widget=new SO.Widgets.Wizard(this.element,this.options)},validateStep:function(a,b){this._widget.validateStep(a,b)},getStepStatus:function(a,b){return this._widget.getStepStatus(a,b)},_destroy:function(){this._widget.destroy(),this._super()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Accordion",{DEFAULT_OPTIONS:{defaultOpen:0,section:{width:null,maxHeight:null},panels:[],sortPanels:!1,onOpen:function(){},onClose:function(){}},_create:function(){this._panels=[],this._currentPanel=this._options.defaultOpen,this.$el.addClass("nlui-accordion"),this._buildpanels(),this._options.layoutManager.registerWidget(this),this._currentPanel!==!1&&this.expandPanel(this._currentPanel,!1)},rebuildLayout:function(){this._currentPanel!==!1&&this.expandPanel(this._currentPanel,!1)},addPanel:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;d=this,e=this._panels.length,f=document.createElement("div"),f.classList.add("nlui-accordion-section"),a.width&&(f.style.width=this._options.panel.width+"px"),g=document.createElement("div"),g.classList.add("nlui-accordion-header"),j=SO.IMG.genIcon("coral-accordionRight",12),j.el.classList.add("nlui-accordion-toggleicon"),g.appendChild(j.el),l=document.createElement("span"),l.textContent=a.title,g.appendChild(l),a.note&&(m=document.createElement("span"),m.classList.add("nlui-text-regular"),m.textContent=a.note,g.appendChild(m)),h=document.createElement("div"),h.classList.add("nlui-accordion-contents"),i=document.createElement("div"),i.classList.add("nlui-accordion-content-wrapper"),this._addWrapperContent(i,a.content),h.appendChild(i),f.appendChild(g),f.appendChild(h);var n={id:a.id,element:f,content:h,elements:{panel:f,content:h,header:g,contentWrapper:a.content||i},toggleIcon:j,expanded:!1,header:g};if(this._options.sortPanels)for(b=0,c=this._panels.length;c>b;b+=1)if(-1===n.id.localeCompare(this._panels[b].id)){k=b;break}return void 0!==k?(this.el.insertBefore(f,this._panels[k].element),this._panels.splice(k,0,n),e=k):(this.el.appendChild(f),this._panels.push(n)),f.classList.add("nlui-accordion-collapsed"),function(a){$(f).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){var b=$(this);this._expanded?d._options.onOpen(b,d._panels.indexOf(a)):d._options.onClose(b,d._panels.indexOf(a))}),SO.Event.bind(g,"vclick",function(){d.togglePanel(a)})}(n),f},addPanelContent:function(a,b,c){return"number"==typeof a&&(a=this.getPanel(a)),a&&this._addWrapperContent(a.elements.contentWrapper,b,c),a.expanded&&this._refreshPanelSize(a),this},_addWrapperContent:function(a,b,c){return SO.isFunction(b)?b($(a)):"string"==typeof b?a.innerHTML=b:"object"==typeof b&&(b=b instanceof jQuery?b[0]:b,a instanceof jQuery&&(a=a[0]),void 0!==c?a.insertBefore(b,a.children[c]):a.appendChild(b)),this},_buildpanels:function(){var a,b;for(a=0,b=this._options.panels.length;b>a;a++)this.addPanel(this._options.panels[a]);return this},getPanel:function(a){return this._panels[a]},getPanelById:function(a){var b,c,d,e;for(b=0,c=this._panels.length;c>b;b+=1)if(d=this._panels[b],d.id===a){e=d;break}return e},togglePanel:function(a){return a=this._proxyGetPanel(a),a.expanded?this.collapsePanel(a):this.expandPanel(a),this},_proxyGetPanel:function(a){var b;return b="number"==typeof a?this.getPanel(a):"string"==typeof a?this.getPanelById(a):a},expandPanel:function(a,b){var c;return a=this._proxyGetPanel(a),a&&(c=a.elements,b=void 0===b?!0:b,this._currentPanel&&this.collapsePanel(this._currentPanel),b?c.panel.classList.remove("nlui-accordion-no-transition"):c.panel.classList.add("nlui-accordion-no-transition"),this._refreshPanelSize(a),c.panel._expanded=a.expanded=!0,this._currentPanel=a,a.element.classList.remove("nlui-accordion-collapsed"),a.toggleIcon.setName("coral-accordionDown")),this},_refreshPanelSize:function(a){return a=this._proxyGetPanel(a),null===this._options.section.maxHeight?a.elements.panel.style.maxHeight=a.elements.header.offsetHeight+a.elements.content.offsetHeight+"px":(a.elements.panel.style.maxHeight=this._options.section.maxHeight+"px",a.elements.panel.style.overflowY="auto"),this},collapsePanel:function(a){var b;return"number"==typeof a&&(a=this.getPanel(a)),b=a.elements,b.panel.classList.remove("nlui-accordion-no-transition"),b.panel.style.maxHeight="",b.panel.style.overflowY="hidden",b.panel._expanded=a.expanded=!1,a.element.classList.add("nlui-accordion-collapsed"),a.toggleIcon.setName("coral-accordionRight"),this._currentPanel=null,this},open:function(a){var b=this.getPanelById(a);return b&&this.expandPanel(b),this},close:function(){return this._currentPanel&&this.collapsePanel(this._currentPanel),this}}),$.widget("SO.soAccordion",{_create:function(){this._widget=new SO.Widgets.Accordion(this.element,this.options)},open:function(a){this._widget.open(a)},close:function(){this._widget.close()}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("Pager",{DEFAULT_OPTIONS:{height:null,width:null,navigationBar:{hideIfOneItem:!0,position:"bottom",appendTo:null},pages:[],onDisplay:null},_create:function(){this._pagesConfig=this._options.pages,this._$pages=[],this._$slider=null,this._currentPage=0,this._buildMarkup(),this._navigationBar=this._buildNavigationBar(),this._navigationBar._init();var a=this._navigationBar._getElement(),b=this._options.navigationBar.hideIfOneItem&&1===this._$pages.length;if(!b)if(null!==this._options.navigationBar.appendTo){var c=$('<div class="nlui-pager-navigationbar-adapter"></div>');this._options.navigationBar.appendTo.append(c),c.append(a)}else"bottom"===this._options.navigationBar.position?(a.insertAfter(this._$slider),a.addClass("nlui-pager-bottom-navigation"),this._$slider.addClass("nlui-pager-bottom-navigation")):(a.insertAfter(this._$slider),a.addClass("nlui-pager-top-navigation"),this._$slider.addClass("nlui-pager-top-navigation"))},_addPages:function(){for(var a=0,b=this._pagesConfig.length;b>a;a++){var c=this._pagesConfig[a].content,d=$('<div class="nlui-pager-page"></div>');d.append(c),this._$pages.push(d)}},_displayPageAt:function(a){if(a!==this._currentPage){var b=this;this._$slider.css("transform","translate3d(-"+100*a+"%, 0, 0)"),this._currentPage=a,this._navigationBar._refreshButtons(a),SO.isFunction(b._options.onDisplay)&&b._options.onDisplay(this._pagesConfig[a].id,a)}},_buildMarkup:function(){var a=this,b=this.$el.parent();this.$el.addClass("nlui-pager"),this._$sliderWrapper=$('<div class="nlui-pager-slider-wrapper"></div>'),this._$slider=$('<div class="nlui-pager-slider"></div>'),this._options.width=this._options.width||b.width(),this._options.height=this._options.height||b.height(),this.$el.width(this._options.width),this.$el.height(this._options.height),this._addPages(),this._$slider.append(this._$pages),this._$sliderWrapper.append(this._$slider),this.$el.append(this._$sliderWrapper),SO.Event.bind(this._$slider,"swipe",function(b){"left"===b.direction&&a._navigationBar._next(),"right"===b.direction&&a._navigationBar._previous()})},_buildNavigationBar:function(){var a=this;return{_init:function(){this._$html=$("<div class='nlui-pager-navigationbar'></div>"),this._$commands=$("<div class='nlui-pager-navigator'></div>"),this._createButtons(),this._$commands.appendTo(this._$html)},_refreshButtons:function(a){var b=this._$commands.children().not(".nlui-pager-arrow");b.removeClass("currentpage"),b.eq(a).addClass("currentpage")},_createButtons:function(){var b=this,c=$("<div></div>").addClass("nlui-pager-arrow nlui-pager-nextarrow");c.append(SO.IMG.genIcon("pager_previous",12)),SO.Event.bind(c,"vclick",function(){b._previous()}),this._$commands.append(c);for(var d=0,e=a._pagesConfig.length;e>d;d++){var f=$('<div class="nlui-pager-dot"></div>');d===a._currentPage&&f.addClass("currentpage"),d===e-1&&f.addClass("last-dot"),function(b,c){SO.Event.bind(b,"vclick",function(){a._displayPageAt(c)})}(f,d),this._$commands.append(f)}var g=$("<div></div>").addClass("nlui-pager-arrow nlui-pager-prevarrow");g.append(SO.IMG.genIcon("pager_next",12)),SO.Event.bind(g,"vclick",function(){b._next()}),this._$commands.append(g)},_getElement:function(){return this._$html},_next:function(){if(a._currentPage<a._$pages.length-1){var b=a._currentPage+1;a._displayPageAt(b)}},_previous:function(){if(a._currentPage>0){var b=a._currentPage-1;a._displayPageAt(b)}}}}}),$.widget("SO.soPager",{_create:function(){this._widget=new SO.Widgets.Pager(this.element,this.options)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("formLayout",{PRESETS:{vertical:{classes:"",breakClasses:"",maxCol:1},stackLeft:{classes:"",breakClasses:"",maxCol:1},stackRight:{classes:"",breakClasses:"",maxCol:1},col2:{classes:"col-12-xs col-6-sm",breakClasses:"pull-0-xs pull-6-sm",maxCol:2},col3:{classes:"col-12-xs col-6-sm col-4-lg",breakClasses:"pull-0-xs pull-6-sm pull-8-lg",maxCol:3},"col2-smallLeft":{classes:["col-12-xs col-4-md","col-12-xs col-8-md"],breakClasses:["pull-0-xs pull-8-md","pull-0-xs pull-4-md"],maxCol:2},"col2-smallRight":{classes:["col-12-xs col-8-md","col-12-xs col-4-md"],breakClasses:["pull-0-xs pull-4-md","pull-0-xs pull-8-md"],maxCol:2}},DEFAULT_OPTIONS:{labelPosition:"above",labelSize:"medium",layout:"vertical",offset:null,cells:[]},_create:function(){this.$el.addClass("nlui-formlayout nlui-flex-grid"),this._$grid=$("<div></div>"),this.$el.append(this._$grid),this._colIndex=0,this._maxColumns=this._getPresets(this._options.layout).maxCol,this._switcher=!0,"vertical"===this._options.layout?this._$grid.addClass("nlui-formlayout-vertical"):(this._$grid.addClass("nlui-flex-row"),"stackRight"===this._options.layout?this._$grid.addClass("nlui-flex-row nlui-flex-row-stack-right"):"stackLeft"===this._options.layout&&this._$grid.addClass("nlui-flex-row nlui-flex-row-stack-left")),this._options.offset&&this._$grid.addClass("offset-"+parseInt(this._options.offset,10));for(var a=0;this._options.cells.length>a;a++)this._processCell(this._options.cells[a])},_getPresets:function(a){var b={},c=this.PRESETS[a];return SO.isArray(c.classes)?(b.classes=c.classes[this._colIndex],b.breakClasses=c.breakClasses[this._colIndex]):(b.classes=c.classes,b.breakClasses=c.breakClasses),b.maxCol=c.maxCol,b},_applyColspanClass:function(a,b){"col3"===this._options.layout&&2===a?b.addClass("col-12-xs col-8-lg"):a>1&&b.addClass("col-12-xs")},_applyAlignClass:function(a,b){"right"===a.halign&&b.addClass("halign-right"),"left"===a.halign&&b.addClass("halign-left"),"center"===a.halign&&b.addClass("halign-center"),"top"===a.valign&&b.addClass("valign-right"),"bottom"===a.valign&&b.addClass("valign-bottom"),"middle"===a.valign&&b.addClass("valign-middle")},appendCell:function(a){this._processCell(a)},getOptions:function(){return this._userOptions},_processCell:function(a){this._colIndex===this._maxColumns&&"stackLeft"!==this._options.layout&&"stackRight"!==this._options.layout&&(this._colIndex=0);var b=this._getPresets(this._options.layout);a.sets({labelPosition:this._options.labelPosition,labelSize:this._options.labelSize}),a.build();var c=a.getCellConf(),d=a.getContainer();c.offset||0,this._applyAlignClass(c,d),SO.isInteger(c.offset)&&d.addClass("offset-"+c.offset+"-xs"),SO.isInteger(c.colSpan)?this._applyColspanClass(c.colSpan,d):d.addClass(b.classes),this._$grid.append(d),c.breakLine===!0?(this._colIndex=this._maxColumns,d.addClass(b.breakClasses)):this._colIndex++}}),$.widget("SO.soFormLayout",{_create:function(){this._widget=new SO.Widgets.formLayout(this.element,this.options)},appendCell:function(a){this._widget.appendCell(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("cellLayout",{DEFAULT_OPTIONS:{dataProvider:{jpath:null,controller:null},cellConfig:{}},_defaultConfig:{labelPosition:"above",mandatory:!1,labelSize:"medium",breakLine:!1,hidden:!1,renderTo:null,colSpan:null,offset:null,element:null,verticalExpand:!1},_create:function(){this._$cell=null,this._built=!1,this._cellConf=null,this._cellController=this._options.dataProvider.controller,this._cellJpath=this._options.dataProvider.jpath,this._initialize()},_applyCellChange:function(a,b){"mandatory"===a&&b!==this._cellConf[a]&&this.set("mandatory",b,!0),"hidden"===a&&b!==this._cellConf[a]&&this.set("hidden",b,!0),this._refreshCell()},_initialize:function(){var a=this;if(this._cellJpath&&this._cellController){var b={label:this._cellController.getLabel(this._cellJpath),labelPosition:this._cellController.getLabelsPosition(this._cellJpath)||"above",mandatory:this._cellController.isMandatory(this._cellJpath)};this._cellConf=SO.Utils.extend({},this._defaultConfig,b,this._options.cellConfig),this._cellConf.jpath=this._cellJpath,this._cellController.registerJpathObserver(this._cellJpath,{onJpathNotify:function(b,c,d){a._applyCellChange(b,d)}})}else this._cellConf=SO.Utils.extend({},this._defaultConfig,this._options.cellConfig)},getCellConf:function(){return this._cellConf},getContainer:function(){return this._built||this._buildCell(),this._$cell},getContentContainer:function(){return this._built||this._buildCell(),this._$elementContainer},_refreshCell:function(){this._built&&(this._cellConf.hidden?this._$cell.addClass("hiddencell"):this._$cell.removeClass("hiddencell"),void 0!==this._$mandatory&&this._$mandatory.toggle(this._cellConf.mandatory),this._$cell.toggleClass("nlui-celllayout-expanded",this._cellConf.verticalExpand))},_buildHorizontalCell:function(){if(null===this._$cell&&(this._$cell=$("<div class='nlui-celllayout nlui-celllayout-horizontal'></div>")),!SO.isNundef(this._cellConf.label)&&!this._cellConf.noLabel){this._$cell.addClass("nlui-celllayout-label-left");var a;"small"===this._cellConf.labelSize?a="nlui-celllayout-small-label":"medium"===this._cellConf.labelSize&&(a="nlui-celllayout-medium-label");var b=$('<div class="label-container"></div>');this._$cell.addClass(a).append(b);var c=$("<div class='nlui-text-regular nlui-celllayout-cell-label'></div>").text(this._cellConf.label);b.append(c),this._cellConf.mandatory&&""!==this._cellConf.label&&(this._$mandatory=$("<span class='nlui-text-regular label-mandatory'></span>").text("("+xtk_sirocco.inputs_mandatoryLabel()+")"),b.append(this._$mandatory))}this._$elementContainer=$("<div class='nlui-celllayout-cell nlui-celllayout-element'></div>").append(this._cellConf.element),this._$cell.append(this._$elementContainer)},_renderTo:function(a){a.append(this._$cell)},_buildVerticalCell:function(){if(null===this._$cell&&(this._$cell=$("<div class='nlui-celllayout nlui-celllayout-vertical'></div>")),!SO.isNundef(this._cellConf.label)&&!this._cellConf.noLabel){this._$cell.addClass("nlui-celllayout-label-top");var a=$('<div class="label-container"></div>');this._$cell.append(a);var b=$("<div class='nlui-text-regular nlui-celllayout-cell-label'></div>").text(this._cellConf.label);a.append(b),this._cellConf.mandatory&&""!==this._cellConf.label&&(this._$mandatory=$("<div class='label-mandatory'></div>").text("("+xtk_sirocco.inputs_mandatoryLabel()+")"),a.append(this._$mandatory))}this._$elementContainer=$("<div class='nlui-celllayout-cell nlui-celllayout-element'></div>").append(this._cellConf.element),this._$cell.append(this._$elementContainer)},_buildCell:function(){"none"===this._cellConf.labelPosition&&(this._cellConf.labelPosition="above",this._cellConf.noLabel=!0),"above"===this._cellConf.labelPosition?this._buildVerticalCell():"left"===this._cellConf.labelPosition&&this._buildHorizontalCell(),this._cellConf.renderTo&&this._$cell.appendTo(this._cellConf.renderTo),this._built=!0,this._refreshCell()},build:function(){this._built||this._buildCell()},get:function(a){return SO.isNundef(this._cellConf[a])?(SO.log.warn('The property "'+a+'"" is not part of a celllayout object'),null):this._cellConf[a]},setElement:function(a){this._built?(this._$elementContainer.empty(),this._$elementContainer.append(a)):this._cellConf.element=a},sets:function(a){for(var b in a)a.hasOwnProperty(b)&&this.set(b,a[b],!0);this._refreshCell()},set:function(a,b,c){SO.isNundef(this._cellConf[a])?SO.log.warn('The property "'+a+'" is not part of a celllayout object'):(this._cellConf[a]=b,c||this._refreshCell())}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("ProgressBar",{DEFAULT_OPTIONS:{value:0,size:"large",theme:"light",showPercent:!0,infinite:!1},_create:function(){this._progress=this._options.value,this._refreshDisplay(!0)},_createMarkup:function(){this._$mainContent&&this._$mainContent.remove(),this._$mainContent=$('<div class="nlui-progressbar-maincontainer"></div>'),this._$progress=$('<div class="nlui-progressbar-progress"></div>'),this._$progressBarContainer=$('<div class="nlui-progressbar-bar-container"></div>'),this._$progressBar=$('<div class="nlui-progressbar-bar"></div>'),this._$progressBar.append($("<span></span>")),this._$progressBarContainer.append(this._$progressBar),"large"===this._options.size?this._$mainContent.addClass("nlui-progressbar-large"):this._$mainContent.addClass("nlui-progressbar-small"),"light"===this._options.theme?this._$mainContent.addClass("nlui-progressbar-light"):"dark"===this._options.theme?this._$mainContent.addClass("nlui-progressbar-dark"):this._$mainContent.addClass("nlui-progressbar-white"),this._options.showPercent&&this._$mainContent.append(this._$progress),this._options.infinite&&this._$mainContent.addClass("nlui-progressbar-infinite-loading"),this._$mainContent.append(this._$progressBarContainer),this.$el.append(this._$mainContent)},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents()),this._$progress.html(this._progress+"%"),this._$progressBar.css("width",this._progress+"%")},_bindEvents:function(){},setValue:function(a){if(SO.isNumber(a)){var b=this,c=this._progress;a>this._progress?$({value:c}).animate({value:a},{duration:500,easing:"easeOutQuint",step:function(){b._progress=Math.round(this.value),b._refreshDisplay()},complete:function(){b._progress=Math.round(this.value),b._refreshDisplay()}}):(b._progress=Math.round(a),b._refreshDisplay())}}}),$.widget("SO.soProgressBar",{_create:function(){this._widget=new SO.Widgets.ProgressBar(this.element,this.options)},setValue:function(a){this._widget.setValue(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("ProgressCircle",{DEFAULT_OPTIONS:{value:0,size:"large",theme:"light",showPercent:!0,onCancel:null},PRESETS:{sizes:{large:{radius:70,lineWidth:12,progressionFontSize:25,percentCharFontSize:22,gutter:.006},medium:{radius:16,lineWidth:3,progressionFontSize:20,percentCharFontSize:18,gutter:.02},normal:{radius:12,lineWidth:4,progressionFontSize:14,percentCharFontSize:12,gutter:.025},small:{radius:8,lineWidth:4,progressionFontSize:12,percentCharFontSize:8,gutter:2.8/100}},themes:{white:{lineColor:"#ffffff",backgroundLineColor:"rgba(255,255,255,0.2)",fontColor:"#ffffff"},light:{lineColor:"#3287d2",backgroundLineColor:"#c8c8c8",fontColor:"#828282"},dark:{lineColor:"#3287d2",backgroundLineColor:"#c8c8c8",fontColor:"#e7e7e7"}}},_create:function(){this._progress=this._options.value,this.$el.addClass("nlui-progresscircle"),SO.assert(this.PRESETS.sizes[this._options.size]&&this.PRESETS.themes[this._options.theme],"Size & theme should exist in progressCircle presets"),this._settings=SO.Utils.extend(!0,{},this.PRESETS.sizes[this._options.size],this.PRESETS.themes[this._options.theme]),this._refreshDisplay(!0)},_createMarkup:function(){this._canvas=document.createElement("canvas"),this._canvasContext=this._canvas.getContext("2d"),this._size=2*this._settings.radius,this._canvas.width=this._size,this._canvas.height=this._size,this._ratio=window.devicePixelRatio||1,1!==this._ratio&&(this._canvas.style.width=this._canvas.width+"px",this._canvas.style.height=this._canvas.height+"px",this._canvas.width*=this._ratio,this._canvas.height*=this._ratio,this._canvasContext.scale(this._ratio,this._ratio)),this._initContext(this._settings),this.$el.append(this._canvas),"large"!==this._options.size&&this._options.showPercent&&(this._percentContainer=$('<div class="nlui-progresscircle-percent-container"></div>').css({color:this._settings.fontColor}),this.$el.append(this._percentContainer))},_bindEvents:function(){var a=this;"function"==typeof this._options.onCancel&&this._canvas.addEventListener("click",function(){a._options.onCancel.call(a)})},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents());var b=2*this._settings.gutter*Math.PI,c=2*Math.PI*Math.ceil(this._progress)/100-.5*Math.PI,d=this._size/2,e=d,f=d;this._canvasContext.clearRect(0,0,this._size,this._size);var g=c,h=1.5*Math.PI;this._canvasContext.strokeStyle=this._settings.backgroundLineColor,this._canvasContext.beginPath(),this._canvasContext.arc(e,f,d-this._canvasContext.lineWidth/2,g+b/2,h-b/2,!1),this._canvasContext.stroke(),this._canvasContext.strokeStyle=this._settings.lineColor,this._canvasContext.beginPath(),this._canvasContext.arc(e,f,d-this._canvasContext.lineWidth/2,-(.5*Math.PI)+b/2,c>-(.5*Math.PI)?c-b/2:c+b/2,!1),this._canvasContext.stroke(),this._canvasContext.font=this._settings.progressionFontSize+"pt adobe-clean";var i=this._progress,j=this._canvasContext.measureText(i).width;this._canvasContext.font=this._settings.percentCharFontSize+"pt adobe-clean";var k="%",l=this._canvasContext.measureText(k).width;if("large"===this._options.size&&this._options.showPercent?(this._canvasContext.font=this._settings.progressionFontSize+"pt adobe-clean",this._canvasContext.fillText(i,e-(j+l)/2+1,f+this._settings.progressionFontSize/2.5-1),this._canvasContext.font=this._settings.percentCharFontSize+"pt adobe-clean",this._canvasContext.fillText(k,e-(l-j)/2+1,f+this._settings.progressionFontSize/2.5-1)):this._options.showPercent&&(this._percentContainer.empty(),this._percentContainer.append($("<span>"+this._progress+"</span>").css({fontSize:this._settings.progressionFontSize+"pt"}),$("<span>%</span>").css({fontSize:this._settings.percentCharFontSize+"pt"}))),"function"==typeof this._options.onCancel){var m=2*(this._settings.radius/Math.PI),n=m/2;this._canvasContext.beginPath(),this._canvasContext.rect(e-n,f-n,m,m),this._canvasContext.fillStyle=this._settings.lineColor,this._canvasContext.fill()}$("<span></span>").html(this._progress).css({fontSize:this._settings.progressionFontSize+"pt"})},_initContext:function(a){this._canvasContext.lineWidth=a.lineWidth,this._canvasContext.strokeStyle=a.lineColor,this._canvasContext.fillStyle=a.fontColor},setValue:function(a){if(SO.isNumber(a)){var b=this,c=this._progress;a>this._progress?$({value:c}).animate({value:a},{duration:500,easing:"easeOutQuint",step:function(){b._progress=Math.round(this.value),b._refreshDisplay()},complete:function(){b._progress=Math.round(this.value),b._refreshDisplay()}}):(b._progress=Math.round(a),b._refreshDisplay())}}}),$.widget("SO.soProgressCircle",{_create:function(){this._widget=new SO.Widgets.ProgressCircle(this.element,this.options)},setValue:function(a){this._widget.setValue(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("GrayBar",{DEFAULT_OPTIONS:{zones:{railTabs:!1,globalActions:!1,localActions:!1,viewConfig:!1,viewSwitcher:!1,reports:!1}},_create:function(){this._$zones={railTabs:null,globalActions:null,localActions:null,viewConfig:null,viewSwitcher:null,reports:null},this._createMarkup()},_createMarkup:function(){var a,b,c,d,e,f;b=["railTabs","globalActions","localActions","reports","viewSwitcher","viewConfig"],this.$el.addClass("nlui-graybar");for(var g=0;b.length>g;g+=1){switch(c=b[g],a=this._options.zones[c],c){case"railTabs":f="left",e="nlui-graybar-zone-railTabs";break;case"globalActions":f="left",e="nlui-graybar-zone-globalActions";break;case"localActions":f="left",e="nlui-graybar-zone-localActions";break;case"viewConfig":f="right",e="nlui-graybar-zone-viewConfig";break;case"viewSwitcher":f="right",e="nlui-graybar-zone-viewSwitcher";break;case"reports":f="right",e="nlui-graybar-zone-reports"}if(this._$zones[c]=d=$('<div class="nlui-graybar-zone '+e+'" data-side="'+f+'"></div>'),SO.isArray(a))for(var h=0;a.length>h;h++)d.append(a[h]);this.$el.append(d)}return this},addActionBarContent:function(a,b){var c=["railTabs","globalActions","localActions","viewConfig","viewSwitcher","reports"];return SO.assert(-1!==c.indexOf(a),'[GrayBar] - Invalid zone "'+a+'"'),this._$zones[a].append(b),this},getActionBar:function(a){return this._$zones[a]},hide:function(){return this.$el.addClass("nlui-graybar-hidden"),this},show:function(){return this.$el.removeClass("nlui-graybar-hidden"),this}}),$.widget("SO.soGrayBar",{_create:function(){this._widget=new SO.Widgets.GrayBar(this.element,this.options)},addActionBarContent:function(a,b){this._widget.addActionBarContent(a,b)},getActionBar:function(a){return this._widget.getActionBar(a)}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
SO.ns("SO.ErrorDecorator"),SO.ErrorDecorator=function(a,b,c){var d={};d=SO.tie(d,{tag:"div",cls:"nlui-input-error-wrapper",cld:[{tag:"div",field:"_$field"},{tag:"i",cls:"nlui-input-error-icon soui-icon-18-alert",field:"_$errorIcon"}]});var e=new SO.Widgets.Tooltip(d._$errorIcon,{mode:"error",gravity:"n"});return b.append(d.el),c.errorDisplay=function(a){a&&e.setTitle(a.message),d._$errorIcon.style.display=a?"inherit":"none"},new a(d._$field,c)};
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("PathEdit","Input",{DEFAULT_OPTIONS:{metaDataService:new NL.MetaDataService(void 0,{dataSourceType:"metadata"}),placeHolder:xtk_sirocco.pathEdit_placeholder(),params:{filters:[],inlineDisplay:function(a){return a},onItemSelected:function(){},dialogTitle:xtk_sirocco.pathEdit_walkerDialogTitle()}},_create:function(){this._super();var a=this;this._controller=new SO.MVC.Controller({model:{resWalker:[]},metamodel:{resWalker:{type:"tree",elements:{PKey:{type:"string",label:"PKey"},apiName:{type:"string",label:"apiName"},desc:{type:"string",label:"desc"},help:{type:"string",label:"help"},icon:{type:"string",label:"icon"},label:{type:"string",label:"label"},lazyLoaded:{type:"boolean",label:"lazyLoaded"},length:{type:"string",label:"length"},privacy:{type:"number",label:"privacy"},readOnly:{type:"boolean",label:"readOnly"},required:{type:"boolean",label:"required"},resName:{type:"string",label:"resName"},resType:{type:"string",label:"resType"},type:{type:"string",label:"type"},nodePath:{type:"string",label:"nodePath"}},keys:["PKey","apiName"],dataSource:new NL.DataSource.MetaDataService({url:this._options.params.targetResource,metaDataService:this._options.metaDataService})}}}),SO.Utils.each(this._options.params.filters,function(b,c){a._controller.addFilter("resWalker",{wildcard:"$"+c})}),this._customEditor.rebuildActions()},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents())},_bindEvents:function(){},_createMarkup:function(){var a=this,b=a._options.params,c={onInternalChange:function(b){a._setValue(b)},value:this._value,readOnly:this._state.readOnly,params:{dialogPadding:!0,icon:"folderSearch",extraActions:{},ok:function(){var b=a._resWalker.getValue().getItem();return a._options.params.onItemSelected.call(a,b),{value:a._formatValue(b.nodePath,b.metadata),valid:void 0!==b.nodePath}},cancel:function(){a._resWalker.setValue(a._value)},inlineDisplay:b.inlineDisplay,placeHolder:this._options.placeHolder,injectDialogContent:function(b){a._injectDialogContent(b)},dialogTitle:b.dialogTitle,dialogFullHeight:!0,dialogOpen:function(){this.hideCommandBar(),this.toggleCloseButton(!0)}}};this.$el.addClass("nlui-input nlui-pathedit"),this._customEditor=new SO.Widgets.CustomInput(this.$el,c)},_injectDialogContent:function(a){var b=this,c=SO.tie({},{tag:"div",cld:[{tag:"div",field:"$treelist"}]});b._resWalker=new SO.Widgets.Treelist(c.$treelist,{onSelection:function(){var a=b._customEditor.getDialog();a.showCommandBar(),a.toggleCloseButton(!1)},onDblClick:function(a){var c=b._customEditor.getDialog(),d=a.getItem();b._options.params.onItemSelected.call(b,d),b._setValue(b._formatValue(d.nodePath,d.metadata)),c.close()},fitToParentHeight:!0,controller:b._controller,jpath:"resWalker",selection:b._value instanceof SO.Selection||null===b._value?b._value:new SO.Selection({selectionMode:"mono",items:[b._value]}),selectable:!0,renderingMethods:{defaultTreeRender:{family:"treeNode",renderer:NL.RenderFunctions.defaultTree,icon:"",label:xtk_core.treeList_hide_advanced_fields_help}},defaultRendering:"defaultTreeRender"}),a.append($(c.el))},setValue:function(a){this._customEditor.setValue(a),this._super(a)},_setValue:function(a){this._customEditor.setValue(a),this._refreshDisplay(!1),this._super(a)},_formatValue:function(a,b){if(a=a.substr(1),-1!==a.indexOf("/")){var c="/";"attribute"===b&&(c+="@"),c+="$1",a="["+a.replace(/\/([^\/]*)$/,c)+"]"}else"attribute"===b&&(a="@"+a);return a}});
;// Copyright Adobe Corporation, 2015 - confidential. See licenses.txt for more details
"use strict";SO.Widgets.define("ExprEdit","Input",{DEFAULT_OPTIONS:{metaDataService:new NL.MetaDataService(void 0,{dataSourceType:"metadata"}),placeHolder:xtk_sirocco.exprEdit_placeholder(),params:{builderPrefix:null,builderMode:"js",displayPickerButton:!0,displayBuilder:!0,help:null,targetResource:null,filters:[],inlineDisplay:function(a){return a},onItemSelected:function(){},dialogTitle:xtk_sirocco.exprEdit_walkerDialogTitle()}},_create:function(){this._super();var a=this;this._controller=new SO.MVC.Controller({model:{resWalker:[]},metamodel:{resWalker:{type:"tree",elements:{PKey:{type:"string",label:"PKey"},apiName:{type:"string",label:"apiName"},desc:{type:"string",label:"desc"},help:{type:"string",label:"help"},icon:{type:"string",label:"icon"},label:{type:"string",label:"label"},lazyLoaded:{type:"boolean",label:"lazyLoaded"},length:{type:"string",label:"length"},privacy:{type:"number",label:"privacy"},readOnly:{type:"boolean",label:"readOnly"},required:{type:"boolean",label:"required"},resName:{type:"string",label:"resName"},resType:{type:"string",label:"resType"},type:{type:"string",label:"type"},nodePath:{type:"string",label:"nodePath"}},keys:["PKey","apiName"],dataSource:new NL.DataSource.MetaDataService({url:this._options.params.targetResource,metaDataService:this._options.metaDataService})}}}),SO.Utils.each(this._options.params.filters,function(b,c){a._controller.addFilter("resWalker",{wildcard:"$"+c})}),this._customEditor.rebuildActions()},_refreshDisplay:function(a){a&&(this._createMarkup(),this._bindEvents())},_bindEvents:function(){},_createMarkup:function(){var a=this,b=a._options.params,c={onInternalChange:function(b){a._setValue(b)},value:this._value,readOnly:this._state.readOnly,params:{dialogPadding:!0,displayPickerButton:b.displayPickerButton,icon:"folderSearch",ok:function(){var b=a._resWalker.getValue().getItem();return a._options.params.onItemSelected.call(a,b),{value:a._formatValue(b.nodePath,b.metadata),valid:void 0!==b.nodePath}},cancel:function(){a._resWalker.setValue(a._value)},inlineDisplay:b.inlineDisplay,placeHolder:this._options.placeHolder,injectDialogContent:function(b){a._injectDialogContent(b)},dialogTitle:b.dialogTitle,dialogFullHeight:!0,dialogOpen:function(){this.hideCommandBar(),this.toggleCloseButton(!0)}}};b.displayBuilder&&(c.params.extraActions={advanced:{tooltip:xtk_sirocco.exprEdit_advancedButtonTooltip(),icon:"coral-gear",action:function(c){var d=this,e=$("<div>");a._exprEdit=new SO.Widgets.ExprBuilder(document.createElement("div"),{value:c.getValue(),metaDataService:a._options.metaDataService,placeHolder:a._options.placeHolder,params:{mode:b.builderMode,prefix:b.builderPrefix,targetResource:b.targetResource,help:b.help},onInternalChange:function(){var a=d._advancedDialog;a.showCommandBar(),a.toggleCloseButton(!1)}}),d._advancedDialog=new SO.Widgets.Dialog(e,{title:xtk_sirocco.exprEdit_expressionBuilder(),parent:"body",mode:"maximize",fullHeightElement:!0,noPrimaryFirstButton:!0,closeButton:!0,commandBarHidden:!0,buttons:[{mode:"quiet",text:xtk_core.dialog_cancel(),icon:"coral-closeCircle",click:function(){d._advancedDialog.close()}},{text:xtk_core.dialog_ok(),mode:"transparent",icon:"coral-checkCircle",click:function(){a._setValue(a._exprEdit.getValue()),d._advancedDialog.close()}}]}),d._advancedDialog.setContent(a._exprEdit.el),d._advancedDialog.open()},displayWithEmptyValue:!0}}),this.$el.addClass("nlui-input nlui-expredit"),this._customEditor=new SO.Widgets.CustomInput(this.$el,c)},_injectDialogContent:function(a){var b=this,c=SO.tie({},{tag:"div",cld:[{tag:"div",field:"$treelist"}]});b._resWalker=new SO.Widgets.Treelist(c.$treelist,{onSelection:function(){var a=b._customEditor.getDialog();a.showCommandBar(),a.toggleCloseButton(!1)},onDblClick:function(a){var c=b._customEditor.getDialog(),d=a.getItem();b._options.params.onItemSelected.call(b,d),b._setValue(b._formatValue(d.nodePath,d.metadata)),c.close()},fitToParentHeight:!0,controller:b._controller,jpath:"resWalker",selection:b._value instanceof SO.Selection||null===b._value?b._value:new SO.Selection({selectionMode:"mono",items:[b._value]}),selectable:!0,renderingMethods:{defaultTreeRender:{family:"treeNode",renderer:NL.RenderFunctions.defaultTree,icon:"",label:xtk_core.treeList_hide_advanced_fields_help}},defaultRendering:"defaultTreeRender"}),a.append($(c.el))},setValue:function(a){this._exprEdit&&this._exprEdit.setValue(a),this._customEditor.setValue(a),this._super(a)},_setValue:function(a){this._exprEdit&&this._exprEdit.setValue(a),this._customEditor.setValue(a),this._refreshDisplay(!1),this._super(a)},_formatValue:function(a,b){if(a=a.substr(1),-1!==a.indexOf("/")){var c="/";"attribute"===b&&(c+="@"),c+="$1",a="["+a.replace(/\/([^\/]*)$/,c)+"]"}else"attribute"===b&&(a="@"+a);return a}});
