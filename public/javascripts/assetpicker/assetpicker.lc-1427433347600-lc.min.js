(function(M,e,y,C){var H=".foundation-content-current",T=".assetpicker-content",J=".asset-picker-done",P=".asset-picker-clear",q=".assetpicker-selection-count",B=".assetpicker-filters-bar .tags",U=false,o,x=".assetpicker-rail-options",t=".assetpicker-rail-toggle",g,E,b="#rail-switcher-view-search > i",S=".assetpicker-sortinfo",W=".assetpicker-togglelayout",i=0,ac=20,p=20,ab=20,Q=".dam-assetpicker-browse-in-activator",r=".dam-assetpicker-browse-up-activator",G=".dam-assetpicker-board-activator",D,O=null,n="",R,aa,Y={},m=".assetpicker-mimetype-predicate",u=".assetpicker-default-content",v="clear-all-filter";
C.assetpicker={};
C.assetpicker.searchRoot="/content/dam";
C.assetpicker.collection="";
C.assetpicker.dispalyMode="card";
C.assetpicker.send=[];
C.assetpicker.sort=false;
C.assetpicker.filters=[];
C.assetpicker.requests=C(T).queue();
var I=C({});
C(e).on("foundation-contentloaded",function(){C(".rail").addClass("closed");
E=C(H).find(".resultspinner");
D=C(H).find(".assetfinder-content-container");
Z();
L();
C(H).find(".assetpicker-content").on("scroll",j);
o=CUI.CardView.get(D);
C(".toolbar a:not(.active) ").addClass("disabled");
var ad=C(T);
V(ad.attr("mode"),ad.attr("type"),ad.attr("typeFilters"),ad.attr("root"));
C.assetpicker.invoke(false)
});
function V(ag,af,ah,ad){if(ag&&ag.trim()!=""&&ag==="single"&&o){o.setSelectionModeCount(CUI.CardView.SELECTION_MODE_COUNT_SINGLE)
}if(af&&af.trim()!=""){C.assetpicker.mimetype=af;
var ae={};
ae.text=af;
ae.id="mandatory_type_filter_"+af;
ae.isMandatory=true;
C.assetpicker.filters=[];
C.assetpicker.filters.push(ae);
C.enableMandatoryType(af)
}if(ah&&ah==="disable"){C(m).addClass("disable-mimetype-filters");
C(m+" input").attr("disabled","disabled")
}if(ad){C.assetpicker.searchRoot=ad
}}C(e).on("click button"+x,x,function(ad){a(C(ad.target).data("view"))
});
C(e).on("click button"+t,t,function(ad){C(ad.target).addClass("hide");
C(".assetpicker-rail-options").toggle()
});
function a(ad){C(t).removeClass("hide");
C(x).toggle();
C(".rail nav.toolbar a").addClass("disabled");
C(".rail nav.toolbar a").removeClass("active");
C(".rail .rail-view.group").removeClass("active");
C(".rail .rail-view.group[data-view='"+ad+"']").addClass("active");
C(".rail nav.toolbar a[data-view='"+ad+"']").addClass("active");
C(".rail nav.toolbar a[data-view='"+ad+"']").removeClass("disabled")
}C(e).fipo("tap"+J,"click."+J,J,function(ad){ad.stopImmediatePropagation();
A(ad)
});
C(e).fipo("tap"+W,"click."+W,W,function(ae){o.setDisplayMode(CUI.CardView.DISPLAY_LIST);
C(W+" > i").toggle();
var ad=C(W+" > i:visible").data("value");
if(ad==="list"){o.setDisplayMode(CUI.CardView.DISPLAY_LIST);
o.setGridSelectionMode(true);
C.assetpicker.dispalyMode="list"
}else{o.setDisplayMode(CUI.CardView.DISPLAY_GRID);
o.setGridSelectionMode(true);
C.assetpicker.dispalyMode="card"
}});
C(e).fipo("tap"+S,"click."+S,S,function(ad){C.assetpicker.sort=C(".assetpicker-sortinfo .cyclebuttons-active").data("value");
C.assetpicker.invoke(false)
});
C(e).fipo("tap"+P,"click."+P,P,function(ae){if(X()===0){h(true,C.getSelectedMimeType(),n)
}var ad={action:"close"};
C.assetpicker.send={config:ad};
N().postMessage(JSON.stringify(C.assetpicker.send),D.data("targetorigin"))
});
C(e).on("change",".search input[name='fulltext']",function(ad){n=C(".search input[name='fulltext']").val();
if(n&&n.trim()!=""){if(Y&&Y!={}){var ae=C.assetpicker.filters.indexOf(Y);
if(ae>-1){C.assetpicker.filters.splice(ae,1)
}}Y.text=n;
Y.callback=function(){L();
C(".search input[name='fulltext']").val("");
n="";
Y={};
C.assetpicker.invoke(false)
};
C.assetpicker.filters.push(Y)
}L();
C.assetpicker.invoke(true)
});
C(e).on("change:selection",".foundation-collection",function(ad){if(o.getSelection().length>0){C(".asset-picker-done").removeClass("disabled")
}else{C(".asset-picker-done").addClass("disabled")
}});
C(e).on("click.toolbar a",function(ad){if(ad.target.className.indexOf("icon-")===0){C(".toolbar a").addClass("disabled");
C(ad.target.parentElement).removeClass("disabled")
}});
C(e).fipo("tap"+B+"button","click."+B+"button",B,function(ae){var ad=C.data(e.body,C(ae.target.parentElement).data("id"));
if(ad){var af=C.assetpicker.filters.indexOf(ad);
if(af>-1){C.assetpicker.filters.splice(af,1)
}ad.callback(ae)
}});
C(e).fipo("tap."+v+"-button","click."+v+"-button","#"+v+" button",function(ae){var ad=C.assetpicker.filters.slice(0);
C.each(ad,function(af,ag){if(!ag.isMandatory){C(B+' li[data-id="'+ag.id+'"] button').click()
}})
});
function A(ae){var ad=e.location.origin;
var ag=C(".assetfinder-content-container article.selected");
var af=new Array();
ag.map(function(){var ah=new Object();
ah.path=C(this).data("path");
ah.url=ad+C(this).data("path");
ah.type=C(this).data("assetMimetype");
ah.title=C(this).data("title");
ah.size=C(this).find(".size").text();
ah.img=ad+C(this).find("img.show-grid:not(.multiplied)").attr("src");
af.push(ah)
});
C.assetpicker.send={data:af,config:{action:"done"}};
N().postMessage(JSON.stringify(C.assetpicker.send),D.data("targetorigin"))
}function h(ae,al,ad,am,an,ah,ag,ak){Z();
var ai="";
if(an){C.each(an,function(ao,ap){ai=ai.concat('tags:"'+ap+'" ')
})
}if(ad){ai=ai.concat('"'+ad+'" ')
}var af=C.assetpicker.sort;
if(ah=="asc"){ai=ai.concat('order:"-jcr:content/jcr:lastModified" ')
}else{if(ah=="desc"){ai=ai.concat('order:"+jcr:content/jcr:lastModified" ')
}}if(am){ai=ai.concat(am+" ")
}var aj=C.assetpicker.searchRoot;
if(ak){aj=ak
}d(ai,al,ag,aj,i,ac).done(function(ao){k();
l(ao,ae);
s()
}).fail(function(aq,ao,ap){console.log("Error while getting assets",aq,ao,ap)
})
}function d(ah,ak,ae,aj,al,ag){var af=y.HTTP.externalize("/view"),ai=aj,ad={_dc:new Date().getTime(),query:ah,mimeType:ak,itemResourceType:"dam/gui/components/admin/assetpicker/asset",memberOf:ae,limit:al+".."+ag,_charset_:"utf-8"};
if(aa){aa.abort()
}aa=C.ajax({type:"GET",dataType:"html",url:af+ai,data:ad});
return aa
}function Z(){g=true;
E.show();
C(u).css("display","none")
}function k(){g=false;
E.hide()
}function l(af,ad){var ae=C(af).filter("article").toArray();
U=(ae.length<(ac-i));
if(!ad){CUI.CardView.get(D).removeAllItems()
}if(ae.length){if(U){C(q).text(i+ae.length)
}else{C(q).text(ac)
}CUI.CardView.get(D).append(ae)
}else{C(q).text(0)
}if(D.find("article").length===0){C(u).css("display","")
}else{C(u).css("display","none")
}}function s(){if(C.assetpicker.dispalyMode==="list"){o.setDisplayMode(CUI.CardView.DISPLAY_LIST)
}else{o.setDisplayMode(CUI.CardView.DISPLAY_GRID)
}o.setGridSelectionMode(true)
}function j(ag){var af=C(ag.currentTarget),ah=af.scrollTop(),ae=af.get(0).scrollHeight,ad=af.height();
C.toe.off();
if(O){clearTimeout(O)
}O=setTimeout(function(){C.toe.on();
O=null
},500);
if(!g&&(ah>0&&(ae-(ah+ad))<20)){if(!U){i=ac;
ac=ac+p;
h(true,C.getSelectedMimeType())
}}g=false
}function K(){i=0;
ac=ab;
U=false
}function L(){K();
CUI.CardView.get(D).removeAllItems()
}function z(){c("",C(".dam-assetpicker-browse-up-activator").parent().data("title"));
C(G).removeClass("selected");
C.assetpicker.collection=""
}function X(){return C(".assetpicker-content article").length
}function F(){C(".search input[name='fulltext']").val("");
n="";
C.clearTypeFilters()
}C.assetpicker.invoke=function(ad,af){if(!af){K();
z()
}C(B+" li").remove();
var ae=0;
C.each(C.assetpicker.filters,function(ag,ah){var ai=w(ah.text,ah.id,ah.isMandatory);
C.data(e.body,ai,ah);
if(!ah.isMandatory){ae++
}});
if(ae>1){f()
}h(ad,C.getSelectedMimeType(),n,C.getRangePredicates(),C.getSelectedTags(),C.assetpicker.sort,C.assetpicker.collection)
};
function N(){if(M.opener){return M.opener
}return parent
}function f(){var ad='<li id="'+v+'"><button data-dismiss="filter">x</button><span><b>'+y.I18n.get("Clear All")+"</b></span></li>";
C(B).append(ad)
}function w(ah,ai,ag){var ae;
if(ai){ae=ai
}else{ae=ah+"_"+Math.round(Math.random()*1000000)
}var af="";
if(ag){af="style=display:none;"
}var ad='<li data-id="'+ae+'"><button data-dismiss="filter" '+af+">x</button><span><b>"+y.I18n.getVar(ah)+"</b></span></li>";
C(B).append(ad);
return ae
}function c(ad,ae){if(ad){C.assetpicker.searchRoot=ad
}C(".assetpicker-levelinfo .level").text(y.I18n.getVar(ae))
}C(e).fipo("tap"+r,"click"+r,r,function(ai){var ah=C(this);
var ae=ah.parent().data("path");
var ad=ah.data("href");
var ag=C("#rail-switcher-view-browse");
var af=C.data(e.body,ae+".parent");
if(af){ag.html(af);
c(C(af).data("path"),C(af).data("title"))
}else{C.ajax({type:"GET",url:ad,async:false}).done(function(aj){C.data(e.body,ae+".parent",aj);
C.data(e.body,ae+".child",ag.html())
});
ag.html(C.data(e.body,ae+".parent"));
c(ah.parent().data("parent-path"),ah.parent().data("parent-title"))
}L();
C.assetpicker.invoke(false)
});
C(e).fipo("tap"+Q,"click"+Q,Q,function(ah){var ag=C(this);
var ad=ag.data("href");
var ae=ag.parent().data("path");
var af=C("#rail-switcher-view-browse");
if(!C.data(e.body,ae+".child")){C.ajax({type:"GET",url:ad,async:false}).done(function(ai){C.data(e.body,ae+".child",ai);
C.data(e.body,ae+".parent",af.html())
})
}af.html(C.data(e.body,ae+".child"));
c(ag.parent().data("path"),ag.parent().data("title"));
L();
C.assetpicker.invoke(false)
});
C(e).fipo("tap"+G,"click"+G,G,function(ae){var ad=C(this);
c("","Collection: "+ad.data("title"));
ad.siblings().removeClass("selected");
ad.addClass("selected");
C.assetpicker.collection=ad.data("path");
L();
h(false,C.getSelectedMimeType(),n,C.getRangePredicates(),C.getSelectedTags(),C.assetpicker.sort,C.assetpicker.collection,"/content/dam")
})
})(window,document,Granite,Granite.$);
(function(f,c,e,g){var b=".assetpicker-mimetype-predicate",a={};
g(c).on("change",b+" input",function(h){var j=g(h.target).attr("checked");
if(j){var l=g(h.target).data("tag");
var i=g(h.target).data("tag");
var k={rel:b};
k.callback=function(m){d(g(m.target).parent().data("id"));
g.assetpicker.invoke(false,true)
};
k.text=i;
k.id=l;
a[l]=k;
g.assetpicker.filters.push(a[l])
}else{var l=g(h.target).data("tag");
d(l)
}g.assetpicker.invoke(false,true)
});
g.enableMandatoryType=function(h){g(b+" input[value='"+h+"']").prop("checked",true).attr("disabled","disabled").css("cursor","not-allowed").css("pointer-events","visible")
};
g.getSelectedMimeType=function(){var h="";
g(b+" input").map(function(){if(g(this).attr("checked")){h=g(this).val()+","+h
}});
return h
};
function d(i){g(b).find("input[data-tag='"+i+"']").attr("checked",false);
if(a[i]){var h=g.assetpicker.filters.indexOf(a[i]);
if(h>-1){g.assetpicker.filters.splice(h,1)
}}delete a[i]
}})(window,document,Granite,Granite.$);
(function(g,c,f,h){var d=[],b=".assetpicker-tags-predicate";
var a={};
h(c).on("change",b+" input",function(i){var j=h(i.target).attr("checked");
if(j){var l=h(i.target).data("tagid");
d.push(l);
var k=new Object();
k.rel=b;
k.callback=function(m){e(h(m.target.parentElement).data("id"));
h.assetpicker.invoke(false)
};
k.text=h(i.target).data("filter");
k.id=l;
a[l]=k;
h.assetpicker.filters.push(a[l])
}else{var l=h(i.target).data("tagid");
e(l)
}h.assetpicker.invoke(false)
});
h.getSelectedTags=function(){var i=[];
for(var j in a){i.push(j)
}return i
};
function e(j){h(b).find("input[data-tagid='"+j+"']").attr("checked",false);
if(a[j]){var i=h.assetpicker.filters.indexOf(a[j]);
if(i>-1){h.assetpicker.filters.splice(i,1)
}}delete a[j]
}})(window,document,Granite,Granite.$);
(function(g,h,c,d){var k=".assetpicker-range-predicate",b=".assetpicker-range-filter-",i={};
d(h).on("keydown",k+" input",function(u){if(u.keyCode!==13){return
}var v=d(this).closest(k);
var n=v.data("tag");
var p=e(v);
var t=j(v);
if((p===undefined&&t===undefined)||(p!==undefined&&t!==undefined&&p>=t)){a(n);
f(v)
}else{a(n);
var q=n;
var o=k+"-"+n;
var r={rel:o};
r.callback=function(w){a(d(w.target).parent().data("id"));
f(v);
d.assetpicker.invoke(false)
};
var m=v.data("tag-text");
var l=v.find(b+"min").val();
var s=v.find(b+"max").val();
if(p!==undefined&&t!==undefined){r.text=l+"&lt;"+m+"&lt;"+s
}else{if(p!==undefined){r.text=m+"&gt;"+l;
v.find(b+"max").val("")
}else{r.text=m+"&lt;"+s;
v.find(b+"min").val("")
}}r.id=n;
i[n]=r;
d.assetpicker.filters.push(i[n])
}d.assetpicker.invoke(false)
});
d(h).on("input",k+" input",function(l){if(/^\d*[.]?\d*$/.test(d(l.target).val())){d(l.target).removeClass("error")
}else{d(l.target).addClass("error")
}});
function e(l){var m=parseInt(l.data("global-min"));
var n=Math.floor(parseFloat(l.find("[class$=min]").val())*parseInt(l.data("multiplier")));
var o=!isNaN(n)&&(isNaN(m)?true:n>=m);
if(o){return n
}else{return undefined
}}function j(m){var o=parseInt(m.data("global-max"));
var l=Math.ceil(parseFloat(m.find("[class$=max]").val())*parseInt(m.data("multiplier")));
var n=!isNaN(l)&&(isNaN(o)?true:l<=o);
if(n){return l
}else{return undefined
}}d.getRangePredicates=function(){var l=" ";
d(k).each(function(){var n=d(this);
var r=n.data("tag");
var q=d.assetpicker.filters.indexOf(i[r]);
if(q>-1){var o=e(n);
var m=j(n);
var p=n.data("mapped-property");
if(o!=undefined||m!=undefined){l+='"'+p+'":"'+(o!=undefined?o:"")+".."+(m!=undefined?m:"")+'" '
}}});
return l
};
function a(m){if(i[m]){var l=d.assetpicker.filters.indexOf(i[m]);
if(l>-1){d.assetpicker.filters.splice(l,1)
}}delete i[m]
}function f(l){l.find("input").val("")
}})(window,document,Granite,Granite.$);