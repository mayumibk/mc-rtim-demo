(function(h,k,e,c){var f=!!("ontouchstart" in k);
var a=[];
var m;
function i(n,o){return(f?n.touch:n.pointer)+"."+o
}function d(o,s,n,q,r,p){return{top:Math.round(s-n-(Math.cos(p*q)*r)),left:Math.round(o-n-(Math.sin(p*q)*-r))}
}function g(n,p){var q=5;
var s=p.layout.details.distance+p.layout.details.radius+q;
var o=h(p.container);
var t=function(w,v,u){if(w-v<0){return v
}else{return k.Math.min(w,u-v)
}};
return{x:t(n.x,s,o.innerWidth()),y:t(n.y,s,o.innerHeight())}
}function b(n){if(!n){return c
}if(h.isFunction(n)){return n(event)
}if(typeof n==="string"){return h(event.target).closest(n)
}return h(n)
}function j(r,o){var q=b(o.anchor);
if(q){var t=q.position();
return g({x:t.left+Math.round(q.width()/2),y:t.top+Math.round(q.height()/2)},o)
}else{var n={pageX:r.pageX,pageY:r.pageY};
var s=h(o.container).offset();
return g({x:n.pageX-s.left,y:n.pageY-s.top},o)
}}function l(p,n,o){if(typeof n.startPos=="number"){return n.startPos
}return -1*((p?p.length-1:0)/2)
}h.quickaction=function(p,q,o){var n=h.extend(true,h.quickaction.settings,o);
if(q===c){h.quickaction.settings.layout.destroy(n)
}else{h.quickaction.settings.layout.render(q,n,p)
}};
h.quickaction.LAYOUT_CIRCLE={tag:"<div/>",cssClass:"quickaction-circle",closeButton:"<button class='icon-close'>"+e.I18n.get("Close")+"</a>",effect:{duration:150,easing:"easeInQuad"},details:{zIndex:9999,distance:100,angle:2*Math.PI/11,radius:21,startPos:"auto"},render:function(q,n,p){var o=i(n.event.closeMenu,n.event.namespace);
h.quickaction.settings.layout.destroy(n);
m=h("<div class='quickaction-mask'>").css("z-index",this.details.zIndex).appendTo(f?n.container:"body");
this.renderActions(q,n,p);
h(n.container).trigger(h.quickaction.events.openMenu,{cfg:n,target:p.target})
},destroy:function(n){var o=false;
while(a.length>0){o=true;
a.pop().remove()
}if(o){h(n.container).trigger(h.quickaction.events.closeMenu,{cfg:n})
}if(m){k.setTimeout(function(){if(m){m.remove();
m=c
}},400)
}},renderActions:function(u,y,p){var q=h(y.container);
var z=h(p.target);
var o=j(p,y);
var n=y.layout.details;
var x=n.radius*2;
var v={top:o.y-n.radius,left:o.x-n.radius,height:x,width:x,borderRadius:x,position:"absolute","z-index":n.zIndex-1};
var s=i(y.event.executeHandler,y.event.namespace);
var w=l(u,y,p);
if(y.displayCloseButton){var r={display:h.quickaction.settings.layout.closeButton,touchpoint:true,handler:function(t){h.quickaction.settings.layout.destroy(y)
}};
u.push(r)
}h.each(u,function(){var B=this;
if(h.isFunction(B.condition)&&!B.condition(z)){return true
}var A=h(y.layout.tag).addClass(y.layout.cssClass);
q.append(A);
a.push(A);
A.css(v);
A.append(B.display);
if(B.customEvent){h.each(B.customEvent,function(E,D){A.on(E,function(F){F.target=z;
D(F)
})
})
}if(B.handler){A.on(s,function(D){D.target=z;
if(!B.handler(D)){h.quickaction.settings.layout.destroy(y)
}})
}if(y.autoClose&&B.pinned!==true){A.on(s,function(){k.setTimeout(function(){h.quickaction.settings.layout.destroy(y)
},500)
})
}if(!B.touchpoint){var t=y.layout.details;
var C=d(o.x,o.y,t.radius,t.angle,t.distance,w);
w++;
A.delay(10).animate({top:C.top,left:C.left},{duration:y.layout.effect.duration,easing:y.layout.effect.easing,complete:function(){h(this).css("z-index",t.zIndex+1)
}})
}else{A.css("z-index",y.layout.details.zIndex+1)
}})
}};
h.quickaction.LAYOUT_BAR={tag:"<ul/>",cssClass:"quickaction-bar",details:{zIndex:9999,size:28},render:function(s,n,r){var o=this;
if(n.container.find("."+this.cssClass).length){return
}this.destroy(n);
this.renderActions(s,n,r);
h(n.container).trigger(h.quickaction.events.openMenu,{cfg:n,target:r.target});
if(n.autoClose){var p=i(n.event.closeMenu,n.event.namespace);
var q=o.getQuickactionsBar();
n.anchor.off(p);
n.anchor.on(p,function(t){if(h(t.relatedTarget).closest("."+n.layout.cssClass).length){return
}if(q&&q.data("quickaction.internal.pinned")===true){return
}o.destroy(n);
n.anchor.off(p)
});
if(q){q.off(p);
q.on(p,function(t){if(h(t.relatedTarget).closest(n.anchor).length){return
}if(q.data("quickaction.internal.pinned")===true){return
}o.destroy(n);
q.off(p)
})
}}},destroy:function(n){var o=false;
while(a.length>0){o=true;
a.pop().remove()
}if(o){h(n.container).trigger(h.quickaction.events.closeMenu,{cfg:n})
}},getQuickactionsBar:function(){return(a&&a.length)?a[0]:c
},renderActions:function(v,w,o){var z=this;
var p=h(w.container);
var y=h(o.target);
var x=b(w.anchor);
var n=this.details;
var r=h(w.layout.tag).addClass(w.layout.cssClass);
var q=parseInt(x.css("margin-top").replace("px",""));
var u=h(x).find(".label").outerHeight(true);
p.append(r);
r.css("position","absolute");
r.css("top",x.position().top+q+x.height()-u-n.size-10);
r.css("left",x.position().left-1);
r.css("width",x.width());
r.css("height",n.size);
r.css("z-index",n.zIndex);
a.push(r);
var s=i(w.event.executeHandler,w.event.namespace);
h.each(v,function(){var A=this;
if(h.isFunction(A.condition)&&!A.condition(y)){return true
}var t=h("<li/>").css({width:n.size,height:n.size});
r.append(t);
a.push(t);
t.append(A.display);
if(A.customEvent){h.each(A.customEvent,function(C,B){t.on(C,function(D){D.target=y;
B(D)
})
})
}if(A.handler){t.on(s,function(B){B.target=y;
if(!A.handler(B)){h.quickaction.settings.layout.destroy(w)
}})
}if(w.autoClose&&A.pinned===true){t.on(s,function(){r.data("quickaction.internal.pinned",true)
})
}});
r.addClass("quickaction-fadein")
}};
h.quickaction.settings={event:{namespace:"quickaction",openMenu:{touch:"taphold",pointer:"mouseover"},closeMenu:{touch:"tap",pointer:"mouseleave"},executeHandler:{touch:"tap",pointer:"click"}},container:"body",layout:h.quickaction.LAYOUT_CIRCLE,autoClose:false};
h.quickaction.events={openMenu:"quickactionopenmenu",closeMenu:"quickactionclosemenu"};
h.fn.extend({quickaction:function(r,q){var n=h.extend(true,h.quickaction.settings,q);
var p=i(n.event.openMenu,n.event.namespace);
var o=function(s){h.quickaction.settings.layout.render(r,n,s)
};
return this.each(function(){h(this).on(p,o)
})
}})
}(jQuery,this,Granite));